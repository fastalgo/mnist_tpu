Removing gs://yangyou-mnist/log/#1565553496239336...
Removing gs://yangyou-mnist/log/checkpoint#1565553539790325...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565553509106121...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565553496.v3-8-tpu#1565553543043996...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565553513677900...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565553508255891...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565553501027576...
Removing gs://yangyou-mnist/log/model.ckpt-1758.index#1565553537335722...
Removing gs://yangyou-mnist/log/model.ckpt-1758.data-00000-of-00001#1565553536443908...
Removing gs://yangyou-mnist/log/model.ckpt-1758.meta#1565553542087582...
Removing gs://yangyou-mnist/log/eval/#1565553591934903...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565553592.v3-8-tpu#1565553595282955...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:06:31.081413 139881578649024 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:06:31.082453 139881578649024 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:06:31.084985 139881578649024 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:06:31.085792 139881578649024 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:06:31.086388 139881578649024 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:06:31.086517 139881578649024 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:06:31.468739 139881578649024 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:06:31.475152 139881578649024 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:06:31.478807 139881578649024 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:06:31.526443 139881578649024 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:06:31.526756 139881578649024 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:06:31.646774 139881578649024 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:06:31.691337 139881578649024 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:06:31.691606 139881578649024 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:06:31.812352 139881578649024 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3891f7b090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3894159190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:06:31.812715 139881578649024 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:06:32.139924 139881578649024 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:06:32.142889: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:06:32.155392 139881578649024 tpu_system_metadata.py:148] Found TPU system:
I0811 20:06:32.155663 139881578649024 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:06:32.156186 139881578649024 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:06:32.156270 139881578649024 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:06:32.156327 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:06:32.156652 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:06:32.156728 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:06:32.156781 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:06:32.156831 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:06:32.156877 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:06:32.156924 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:06:32.156970 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:06:32.157027 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:06:32.157074 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:06:32.157123 139881578649024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:06:32.163336 139881578649024 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:06:32.175970 139881578649024 estimator.py:1145] Calling model_fn.
W0811 20:06:32.176595 139881578649024 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:06:32.514996 139881578649024 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:06:33.022274 139881578649024 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:06:33.082742 139881578649024 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:06:33.088504 139881578649024 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:06:33.270432 139881578649024 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:06:33.284184 139881578649024 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:06:33.296521 139881578649024 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:06:33.296840 139881578649024 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:06:33.722496 139881578649024 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:06:33.737792 139881578649024 estimator.py:1147] Done calling model_fn.
I0811 20:06:37.365101 139881578649024 tpu_estimator.py:499] TPU job name worker
I0811 20:06:37.477749 139881578649024 monitored_session.py:240] Graph was finalized.
I0811 20:06:38.044228 139881578649024 session_manager.py:500] Running local_init_op.
I0811 20:06:38.080262 139881578649024 session_manager.py:502] Done running local_init_op.
I0811 20:06:40.671091 139881578649024 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:06:53.108139 139881578649024 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:06:53.220426 139881578649024 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:06:53.220997 139881578649024 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:06:53.222549: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:06:53.226949 139881578649024 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:06:53.229154 139881578649024 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:06:53.233160 139881578649024 tpu_estimator.py:557] Init TPU system
I0811 20:06:58.913127 139881578649024 tpu_estimator.py:566] Initialized TPU in 5 seconds
I0811 20:06:58.914105 139880685098752 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:06:58.914922 139880676706048 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:06:58.955194 139881578649024 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:06:58.956053 139881578649024 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:06:58.969296 139880668313344 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:06:59.158345 139880668313344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:07:03.626023 139880676706048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:07:08.065944 139881578649024 basic_session_run_hooks.py:262] loss = 1.0047946, step = 30
I0811 20:07:08.068542 139881578649024 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:07:21.153650 139881578649024 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:07:21.153954 139881578649024 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:07:21.154246 139880685098752 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:07:21.154561 139880685098752 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:07:21.154772 139881578649024 error_handling.py:96] infeed marked as finished
I0811 20:07:21.154973 139881578649024 tpu_estimator.py:602] Stop output thread controller
I0811 20:07:21.155034 139881578649024 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:07:21.155236 139880676706048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:07:21.155428 139880676706048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:07:21.155647 139881578649024 error_handling.py:96] outfeed marked as finished
I0811 20:07:21.155832 139881578649024 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:07:29.292004 139881578649024 estimator.py:368] Loss for final step: 1.0047946.
I0811 20:07:29.292799 139881578649024 error_handling.py:96] training_loop marked as finished
I0811 20:07:30.091751 139881578649024 estimator.py:1145] Calling model_fn.
E0811 20:07:31.496697 139881578649024 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:07:31.687643 139881578649024 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:07:31.714720 139881578649024 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:07:31.736309 139881578649024 estimator.py:1147] Done calling model_fn.
I0811 20:07:31.752585 139881578649024 evaluation.py:255] Starting evaluation at 2019-08-11T20:07:31Z
I0811 20:07:31.752815 139881578649024 tpu_estimator.py:499] TPU job name worker
I0811 20:07:31.826036 139881578649024 monitored_session.py:240] Graph was finalized.
W0811 20:07:31.826777 139881578649024 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:07:32.008670 139881578649024 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:07:34.716124 139881578649024 session_manager.py:500] Running local_init_op.
I0811 20:07:34.739310 139881578649024 session_manager.py:502] Done running local_init_op.
I0811 20:07:34.784416 139881578649024 tpu_estimator.py:557] Init TPU system
I0811 20:07:43.863512 139881578649024 tpu_estimator.py:566] Initialized TPU in 9 seconds
I0811 20:07:43.864428 139880681166592 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:07:43.865134 139880672773888 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:07:43.930082 139881578649024 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:07:43.957333 139881578649024 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:07:43.957763 139881578649024 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:07:43.986082 139880659658496 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:07:44.211194 139880659658496 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:07:44.624501 139880672773888 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:07:44.972961 139881578649024 evaluation.py:167] Evaluation [10/10]
I0811 20:07:44.973305 139881578649024 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:07:44.973376 139881578649024 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:07:44.973628 139880681166592 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:07:44.973891 139880681166592 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:07:44.974086 139881578649024 error_handling.py:96] infeed marked as finished
I0811 20:07:44.974267 139881578649024 tpu_estimator.py:602] Stop output thread controller
I0811 20:07:44.974328 139881578649024 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:07:44.974509 139880672773888 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:07:44.974697 139880672773888 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:07:44.974904 139881578649024 error_handling.py:96] outfeed marked as finished
I0811 20:07:44.975066 139881578649024 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:08:14.302544 139881578649024 evaluation.py:275] Finished evaluation at 2019-08-11-20:08:14
I0811 20:08:14.302866 139881578649024 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8187, global_step = 30, loss = 0.9174908
I0811 20:08:18.690637 139881578649024 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:08:19.489105 139881578649024 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.9174908, 'global_step': 30, 'accuracy': 0.8187}

Removing gs://yangyou-mnist/log/#1565553995211992...
Removing gs://yangyou-mnist/log/checkpoint#1565554037652635...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565553995.v3-8-tpu#1565554040784576...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565554000082517...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565554007942555...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565554034594563...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565554012576961...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565554007089041...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565554035497078...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565554039898575...
Removing gs://yangyou-mnist/log/eval/#1565554095915596...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565554096.v3-8-tpu#1565554099133172...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:08:23.319566 139768278205888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:08:23.320383 139768278205888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:08:23.323066 139768278205888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:08:23.323895 139768278205888 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:08:23.324508 139768278205888 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:08:23.324657 139768278205888 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:08:23.715266 139768278205888 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:08:23.721546 139768278205888 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:08:23.725166 139768278205888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:08:23.818795 139768278205888 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:08:23.819081 139768278205888 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:08:23.937242 139768278205888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:08:23.981275 139768278205888 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:08:23.981618 139768278205888 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:08:24.092334 139768278205888 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1e30bc2150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1e32da0190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:08:24.092704 139768278205888 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:08:24.419938 139768278205888 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:08:24.423141: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:08:24.436196 139768278205888 tpu_system_metadata.py:148] Found TPU system:
I0811 20:08:24.436455 139768278205888 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:08:24.436985 139768278205888 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:08:24.437045 139768278205888 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:08:24.437098 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:08:24.437397 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:08:24.437453 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:08:24.437505 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:08:24.437552 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:08:24.437657 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:08:24.437716 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:08:24.437762 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:08:24.437813 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:08:24.437871 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:08:24.437922 139768278205888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:08:24.443974 139768278205888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:08:24.456655 139768278205888 estimator.py:1145] Calling model_fn.
W0811 20:08:24.457267 139768278205888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:08:24.754463 139768278205888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:08:25.213912 139768278205888 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:08:25.278834 139768278205888 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:08:25.284955 139768278205888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:08:25.465627 139768278205888 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:08:25.479245 139768278205888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:08:25.490899 139768278205888 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:08:25.491213 139768278205888 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:08:25.907742 139768278205888 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:08:25.923372 139768278205888 estimator.py:1147] Done calling model_fn.
Removing gs://yangyou-mnist/log/#1565554107319240...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565554107.v3-8-tpu#1565554108054099...
/ [1/2 objects]  50% Done                                                       / [2/2 objects] 100% Done                                                       
Operation completed over 2 objects.                                              
WARNING: Logging before flag parsing goes to stderr.
W0811 20:08:58.067698 140253842097600 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:08:58.068471 140253842097600 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:08:58.071173 140253842097600 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:08:58.072016 140253842097600 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:08:58.072633 140253842097600 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:08:58.072758 140253842097600 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:08:58.472604 140253842097600 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:08:58.479342 140253842097600 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:08:58.482955 140253842097600 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:08:58.529045 140253842097600 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:08:58.529320 140253842097600 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:08:58.642514 140253842097600 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:08:58.731964 140253842097600 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:08:58.732253 140253842097600 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:08:58.851032 140253842097600 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8f3e9920d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8f40b70190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:08:58.851414 140253842097600 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:08:59.200359 140253842097600 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:08:59.203352: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:08:59.215537 140253842097600 tpu_system_metadata.py:148] Found TPU system:
I0811 20:08:59.215773 140253842097600 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:08:59.216357 140253842097600 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:08:59.216417 140253842097600 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:08:59.216475 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:08:59.216752 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:08:59.216815 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:08:59.216873 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:08:59.216922 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:08:59.216970 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:08:59.217016 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:08:59.217063 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:08:59.217111 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:08:59.217155 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:08:59.217202 140253842097600 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:08:59.223280 140253842097600 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:08:59.235496 140253842097600 estimator.py:1145] Calling model_fn.
W0811 20:08:59.236129 140253842097600 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:08:59.568526 140253842097600 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:09:00.052544 140253842097600 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:09:00.116221 140253842097600 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:09:00.122431 140253842097600 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:09:00.309083 140253842097600 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:09:00.322995 140253842097600 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:09:00.334863 140253842097600 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:09:00.335179 140253842097600 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:09:00.757994 140253842097600 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:09:00.773371 140253842097600 estimator.py:1147] Done calling model_fn.
I0811 20:09:04.089355 140253842097600 tpu_estimator.py:499] TPU job name worker
I0811 20:09:04.203577 140253842097600 monitored_session.py:240] Graph was finalized.
I0811 20:09:04.748960 140253842097600 session_manager.py:500] Running local_init_op.
I0811 20:09:04.779745 140253842097600 session_manager.py:502] Done running local_init_op.
I0811 20:09:07.605422 140253842097600 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:09:20.498425 140253842097600 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:09:20.616436 140253842097600 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:09:20.616961 140253842097600 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:09:20.617368: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:09:20.622071 140253842097600 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:09:20.624078 140253842097600 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:09:20.628762 140253842097600 tpu_estimator.py:557] Init TPU system
I0811 20:09:29.578413 140253842097600 tpu_estimator.py:566] Initialized TPU in 8 seconds
I0811 20:09:29.579293 140252945569536 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:09:29.579776 140252937176832 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:09:29.621037 140253842097600 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:09:29.621977 140253842097600 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:09:29.635401 140252928784128 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:09:29.747330 140252928784128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:09:34.152442 140252937176832 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:09:38.406537 140253842097600 basic_session_run_hooks.py:262] loss = 1.0694585, step = 30
I0811 20:09:38.408755 140253842097600 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:09:51.665290 140253842097600 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:09:51.665648 140253842097600 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:09:51.666039 140252945569536 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:09:51.666383 140252945569536 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:09:51.666634 140253842097600 error_handling.py:96] infeed marked as finished
I0811 20:09:51.666851 140253842097600 tpu_estimator.py:602] Stop output thread controller
I0811 20:09:51.666917 140253842097600 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:09:51.667082 140252937176832 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:09:51.667254 140252937176832 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:09:51.667445 140253842097600 error_handling.py:96] outfeed marked as finished
I0811 20:09:51.667675 140253842097600 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:09:59.869405 140253842097600 estimator.py:368] Loss for final step: 1.0694585.
I0811 20:09:59.870285 140253842097600 error_handling.py:96] training_loop marked as finished
I0811 20:10:00.626931 140253842097600 estimator.py:1145] Calling model_fn.
E0811 20:10:01.329345 140253842097600 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:10:01.522454 140253842097600 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:10:01.549376 140253842097600 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:10:01.570327 140253842097600 estimator.py:1147] Done calling model_fn.
I0811 20:10:01.587241 140253842097600 evaluation.py:255] Starting evaluation at 2019-08-11T20:10:01Z
I0811 20:10:01.587472 140253842097600 tpu_estimator.py:499] TPU job name worker
I0811 20:10:01.661659 140253842097600 monitored_session.py:240] Graph was finalized.
W0811 20:10:01.662410 140253842097600 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:10:01.846296 140253842097600 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:10:04.314301 140253842097600 session_manager.py:500] Running local_init_op.
I0811 20:10:04.336743 140253842097600 session_manager.py:502] Done running local_init_op.
I0811 20:10:04.381352 140253842097600 tpu_estimator.py:557] Init TPU system
I0811 20:10:13.552151 140253842097600 tpu_estimator.py:566] Initialized TPU in 9 seconds
I0811 20:10:13.553183 140252944258816 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:10:13.553919 140252935866112 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:10:13.623161 140253842097600 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:10:13.651468 140253842097600 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:10:13.651817 140253842097600 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:10:13.733865 140252927473408 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:10:13.848258 140252927473408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:10:14.322823 140252935866112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:10:14.636919 140253842097600 evaluation.py:167] Evaluation [10/10]
I0811 20:10:14.637304 140253842097600 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:10:14.637387 140253842097600 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:10:14.637691 140252944258816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:10:14.637998 140252944258816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:10:14.638207 140253842097600 error_handling.py:96] infeed marked as finished
I0811 20:10:14.638350 140253842097600 tpu_estimator.py:602] Stop output thread controller
I0811 20:10:14.638403 140253842097600 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:10:14.638583 140252935866112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:10:14.638734 140252935866112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:10:14.638883 140253842097600 error_handling.py:96] outfeed marked as finished
I0811 20:10:14.639014 140253842097600 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:10:43.941843 140253842097600 evaluation.py:275] Finished evaluation at 2019-08-11-20:10:43
I0811 20:10:43.942208 140253842097600 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8276, global_step = 30, loss = 0.9785404
I0811 20:10:48.847541 140253842097600 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:10:49.658395 140253842097600 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.9785404, 'global_step': 30, 'accuracy': 0.8276}

Removing gs://yangyou-mnist/log/checkpoint#1565554188163787...
Removing gs://yangyou-mnist/log/#1565554142180782...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565554142.v3-8-tpu#1565554191308699...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565554147031070...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565554153917456...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565554154872273...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565554184991221...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565554185844275...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565554159962930...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565554190377680...
Removing gs://yangyou-mnist/log/eval/#1565554246058316...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565554246.v3-8-tpu#1565554249296838...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:10:53.528697 140425977431488 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:10:53.529460 140425977431488 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:10:53.532075 140425977431488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:10:53.532887 140425977431488 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:10:53.533442 140425977431488 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:10:53.533567 140425977431488 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:10:53.947335 140425977431488 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:10:53.954124 140425977431488 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:10:53.957941 140425977431488 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:10:54.004772 140425977431488 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:10:54.005059 140425977431488 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:10:54.112574 140425977431488 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:10:54.158308 140425977431488 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:10:54.158593 140425977431488 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:10:54.257478 140425977431488 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb752a9e290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb754c7c190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:10:54.257889 140425977431488 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:10:54.596585 140425977431488 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:10:54.599607: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:10:54.611371 140425977431488 tpu_system_metadata.py:148] Found TPU system:
I0811 20:10:54.611603 140425977431488 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:10:54.612114 140425977431488 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:10:54.612186 140425977431488 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:10:54.612240 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:10:54.612521 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:10:54.612576 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:10:54.612626 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:10:54.612673 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:10:54.612720 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:10:54.612772 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:10:54.612819 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:10:54.612867 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:10:54.612911 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:10:54.612960 140425977431488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:10:54.619061 140425977431488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:10:54.631460 140425977431488 estimator.py:1145] Calling model_fn.
W0811 20:10:54.632050 140425977431488 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:10:54.938055 140425977431488 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:10:55.410119 140425977431488 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:10:55.474572 140425977431488 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:10:55.480792 140425977431488 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:10:55.661461 140425977431488 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:10:55.675750 140425977431488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:10:55.688468 140425977431488 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:10:55.688828 140425977431488 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:10:56.115586 140425977431488 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:10:56.131598 140425977431488 estimator.py:1147] Done calling model_fn.
I0811 20:10:59.395229 140425977431488 tpu_estimator.py:499] TPU job name worker
I0811 20:10:59.510464 140425977431488 monitored_session.py:240] Graph was finalized.
I0811 20:11:00.074212 140425977431488 session_manager.py:500] Running local_init_op.
I0811 20:11:00.109018 140425977431488 session_manager.py:502] Done running local_init_op.
I0811 20:11:02.679821 140425977431488 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:11:14.591761 140425977431488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:11:14.703963 140425977431488 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:11:14.704437 140425977431488 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:11:14.704850: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:11:14.709759 140425977431488 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:11:14.711926 140425977431488 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:11:14.715481 140425977431488 tpu_estimator.py:557] Init TPU system
I0811 20:11:26.686682 140425977431488 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:11:26.687688 140425071412992 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:11:26.688277 140425063020288 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:11:26.733153 140425977431488 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:11:26.734015 140425977431488 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:11:26.744226 140425054627584 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:11:26.983308 140425054627584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:11:31.228271 140425063020288 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:11:35.604581 140425977431488 basic_session_run_hooks.py:262] loss = 0.51250476, step = 30
I0811 20:11:35.606839 140425977431488 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:11:48.542074 140425977431488 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:11:48.542367 140425977431488 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:11:48.542669 140425071412992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:11:48.543051 140425071412992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:11:48.543277 140425977431488 error_handling.py:96] infeed marked as finished
I0811 20:11:48.543498 140425977431488 tpu_estimator.py:602] Stop output thread controller
I0811 20:11:48.543570 140425977431488 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:11:48.543735 140425063020288 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:11:48.543958 140425063020288 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:11:48.544177 140425977431488 error_handling.py:96] outfeed marked as finished
I0811 20:11:48.544348 140425977431488 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:11:57.108207 140425977431488 estimator.py:368] Loss for final step: 0.51250476.
I0811 20:11:57.109040 140425977431488 error_handling.py:96] training_loop marked as finished
I0811 20:11:57.812494 140425977431488 estimator.py:1145] Calling model_fn.
E0811 20:11:58.518515 140425977431488 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:11:58.711462 140425977431488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:11:58.738961 140425977431488 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:11:58.760238 140425977431488 estimator.py:1147] Done calling model_fn.
I0811 20:11:58.777312 140425977431488 evaluation.py:255] Starting evaluation at 2019-08-11T20:11:58Z
I0811 20:11:58.777549 140425977431488 tpu_estimator.py:499] TPU job name worker
I0811 20:11:58.852469 140425977431488 monitored_session.py:240] Graph was finalized.
W0811 20:11:58.853188 140425977431488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:11:59.040425 140425977431488 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:12:01.611695 140425977431488 session_manager.py:500] Running local_init_op.
I0811 20:12:01.636729 140425977431488 session_manager.py:502] Done running local_init_op.
I0811 20:12:01.684242 140425977431488 tpu_estimator.py:557] Init TPU system
I0811 20:12:13.513967 140425977431488 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:12:13.514906 140425071412992 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:12:13.515724 140425063020288 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:12:13.583736 140425977431488 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:12:13.612603 140425977431488 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:12:13.612941 140425977431488 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:12:13.685458 140425054627584 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:12:13.857959 140425054627584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:12:14.308326 140425063020288 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:12:14.754081 140425977431488 evaluation.py:167] Evaluation [10/10]
I0811 20:12:14.754446 140425977431488 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:12:14.754520 140425977431488 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:12:14.754708 140425071412992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:12:14.754805 140425071412992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:12:14.754940 140425977431488 error_handling.py:96] infeed marked as finished
I0811 20:12:14.755038 140425977431488 tpu_estimator.py:602] Stop output thread controller
I0811 20:12:14.755110 140425977431488 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:12:14.755254 140425063020288 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:12:14.755330 140425063020288 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:12:14.755446 140425977431488 error_handling.py:96] outfeed marked as finished
I0811 20:12:14.755522 140425977431488 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:12:43.945219 140425977431488 evaluation.py:275] Finished evaluation at 2019-08-11-20:12:43
I0811 20:12:43.945627 140425977431488 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8829, global_step = 30, loss = 0.4611299
I0811 20:12:48.380125 140425977431488 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:12:49.150449 140425977431488 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.4611299, 'global_step': 30, 'accuracy': 0.8829}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565554269582962...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565554274055411...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565554302040755...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565554257.v3-8-tpu#1565554308181203...
Removing gs://yangyou-mnist/log/#1565554257591249...
Removing gs://yangyou-mnist/log/checkpoint#1565554305125883...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565554262092453...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565554268747958...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565554302940892...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565554307233226...
Removing gs://yangyou-mnist/log/eval/#1565554365564276...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565554365.v3-8-tpu#1565554368784992...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:12:53.017513 140270038721984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:12:53.018348 140270038721984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:12:53.020906 140270038721984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:12:53.021856 140270038721984 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:12:53.022449 140270038721984 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:12:53.022594 140270038721984 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:12:53.437345 140270038721984 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:12:53.444690 140270038721984 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:12:53.448437 140270038721984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:12:53.493185 140270038721984 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:12:53.493479 140270038721984 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:12:53.604047 140270038721984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:12:53.648209 140270038721984 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:12:53.648484 140270038721984 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:12:53.873018 140270038721984 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f9303fc9510>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f93061be190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:12:53.873390 140270038721984 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:12:54.198837 140270038721984 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:12:54.202367: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:12:54.215208 140270038721984 tpu_system_metadata.py:148] Found TPU system:
I0811 20:12:54.215464 140270038721984 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:12:54.216008 140270038721984 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:12:54.216068 140270038721984 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:12:54.216130 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:12:54.216419 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:12:54.216500 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:12:54.216552 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:12:54.216600 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:12:54.216655 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:12:54.216705 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:12:54.216752 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:12:54.216799 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:12:54.216845 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:12:54.216892 140270038721984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:12:54.223354 140270038721984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:12:54.236068 140270038721984 estimator.py:1145] Calling model_fn.
W0811 20:12:54.236713 140270038721984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:12:54.540324 140270038721984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:12:55.000721 140270038721984 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:12:55.061417 140270038721984 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:12:55.067423 140270038721984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:12:55.250489 140270038721984 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:12:55.267846 140270038721984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:12:55.279917 140270038721984 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:12:55.280219 140270038721984 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:12:55.700937 140270038721984 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:12:55.716428 140270038721984 estimator.py:1147] Done calling model_fn.
I0811 20:12:59.091545 140270038721984 tpu_estimator.py:499] TPU job name worker
I0811 20:12:59.209069 140270038721984 monitored_session.py:240] Graph was finalized.
I0811 20:12:59.771694 140270038721984 session_manager.py:500] Running local_init_op.
I0811 20:12:59.810756 140270038721984 session_manager.py:502] Done running local_init_op.
I0811 20:13:02.367420 140270038721984 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:13:15.244282 140270038721984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:13:15.362565 140270038721984 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:13:15.363056 140270038721984 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:13:15.363458: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:13:15.368081 140270038721984 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:13:15.370585 140270038721984 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:13:15.374330 140270038721984 tpu_estimator.py:557] Init TPU system
I0811 20:13:26.531424 140270038721984 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:13:26.532449 140268867155712 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:13:26.533376 140268858763008 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:13:26.577750 140270038721984 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:13:26.578731 140270038721984 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:13:26.633702 140268850370304 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:13:26.786974 140268850370304 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:13:30.994754 140268858763008 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:13:35.387804 140270038721984 basic_session_run_hooks.py:262] loss = 0.27337733, step = 30
I0811 20:13:35.389692 140270038721984 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:13:48.923253 140270038721984 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:13:48.923563 140270038721984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:13:48.925683 140268867155712 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:13:48.926043 140268867155712 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:13:48.926234 140270038721984 error_handling.py:96] infeed marked as finished
I0811 20:13:48.926433 140270038721984 tpu_estimator.py:602] Stop output thread controller
I0811 20:13:48.926492 140270038721984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:13:48.926695 140268858763008 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:13:48.926938 140268858763008 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:13:48.927122 140270038721984 error_handling.py:96] outfeed marked as finished
I0811 20:13:48.927261 140270038721984 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:13:56.911556 140270038721984 estimator.py:368] Loss for final step: 0.27337733.
I0811 20:13:56.912377 140270038721984 error_handling.py:96] training_loop marked as finished
I0811 20:13:57.705291 140270038721984 estimator.py:1145] Calling model_fn.
E0811 20:13:58.379466 140270038721984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:13:58.574845 140270038721984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:13:58.603013 140270038721984 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:13:58.624779 140270038721984 estimator.py:1147] Done calling model_fn.
I0811 20:13:58.641797 140270038721984 evaluation.py:255] Starting evaluation at 2019-08-11T20:13:58Z
I0811 20:13:58.642025 140270038721984 tpu_estimator.py:499] TPU job name worker
I0811 20:13:58.716996 140270038721984 monitored_session.py:240] Graph was finalized.
W0811 20:13:58.717773 140270038721984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:13:58.900280 140270038721984 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:14:01.581470 140270038721984 session_manager.py:500] Running local_init_op.
I0811 20:14:01.609710 140270038721984 session_manager.py:502] Done running local_init_op.
I0811 20:14:01.660049 140270038721984 tpu_estimator.py:557] Init TPU system
I0811 20:14:13.169717 140270038721984 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:14:13.170715 140268867155712 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:14:13.171471 140268858763008 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:14:13.236264 140270038721984 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:14:13.259970 140270038721984 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:14:13.260425 140270038721984 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:14:13.291938 140268850370304 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:14:13.510354 140268850370304 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:14:13.973455 140268858763008 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:14:14.304162 140270038721984 evaluation.py:167] Evaluation [10/10]
I0811 20:14:14.304506 140270038721984 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:14:14.304573 140270038721984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:14:14.304840 140268867155712 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:14:14.305111 140268867155712 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:14:14.305299 140270038721984 error_handling.py:96] infeed marked as finished
I0811 20:14:14.305454 140270038721984 tpu_estimator.py:602] Stop output thread controller
I0811 20:14:14.305505 140270038721984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:14:14.305715 140268858763008 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:14:14.305897 140268858763008 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:14:14.306147 140270038721984 error_handling.py:96] outfeed marked as finished
I0811 20:14:14.306327 140270038721984 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:14:43.610204 140270038721984 evaluation.py:275] Finished evaluation at 2019-08-11-20:14:43
I0811 20:14:43.610547 140270038721984 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9302, global_step = 30, loss = 0.27626175
I0811 20:14:47.926707 140270038721984 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:14:48.714811 140270038721984 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.27626175, 'global_step': 30, 'accuracy': 0.9302}

Removing gs://yangyou-mnist/log/#1565554377149547...
Removing gs://yangyou-mnist/log/checkpoint#1565554425068352...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565554390212439...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565554377.v3-8-tpu#1565554428390649...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565554421826672...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565554389402198...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565554381765079...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565554422779682...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565554394712142...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565554427249329...
Removing gs://yangyou-mnist/log/eval/#1565554485189076...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565554485.v3-8-tpu#1565554488328879...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:14:52.467724 140596577531328 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:14:52.468508 140596577531328 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:14:52.471191 140596577531328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:14:52.472014 140596577531328 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:14:52.472656 140596577531328 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:14:52.472793 140596577531328 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:14:52.872313 140596577531328 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:14:52.879317 140596577531328 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:14:52.883177 140596577531328 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:14:52.933988 140596577531328 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:14:52.934282 140596577531328 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:14:53.326867 140596577531328 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:14:53.366354 140596577531328 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:14:53.366636 140596577531328 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:14:53.572283 140596577531328 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fdf0b38d090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fdf0d56b190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:14:53.572686 140596577531328 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:14:53.896506 140596577531328 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:14:53.899654: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:14:53.911032 140596577531328 tpu_system_metadata.py:148] Found TPU system:
I0811 20:14:53.911247 140596577531328 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:14:53.911791 140596577531328 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:14:53.911849 140596577531328 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:14:53.911905 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:14:53.912201 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:14:53.912259 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:14:53.912321 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:14:53.912369 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:14:53.912439 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:14:53.912486 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:14:53.912533 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:14:53.912579 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:14:53.912625 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:14:53.912672 140596577531328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:14:53.918566 140596577531328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:14:53.930397 140596577531328 estimator.py:1145] Calling model_fn.
W0811 20:14:53.930932 140596577531328 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:14:54.200092 140596577531328 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:14:54.610593 140596577531328 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:14:54.670887 140596577531328 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:14:54.676366 140596577531328 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:14:54.844511 140596577531328 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:14:54.858191 140596577531328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:14:54.869571 140596577531328 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:14:54.869859 140596577531328 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:14:55.282190 140596577531328 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:14:55.297429 140596577531328 estimator.py:1147] Done calling model_fn.
I0811 20:14:58.591051 140596577531328 tpu_estimator.py:499] TPU job name worker
I0811 20:14:58.699979 140596577531328 monitored_session.py:240] Graph was finalized.
I0811 20:14:59.255435 140596577531328 session_manager.py:500] Running local_init_op.
I0811 20:14:59.292747 140596577531328 session_manager.py:502] Done running local_init_op.
I0811 20:15:01.858055 140596577531328 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:15:13.841236 140596577531328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:15:13.948215 140596577531328 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:15:13.948677 140596577531328 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:15:13.949080: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:15:13.953850 140596577531328 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:15:13.956018 140596577531328 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:15:13.959614 140596577531328 tpu_estimator.py:557] Init TPU system
I0811 20:15:25.999104 140596577531328 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:15:26.000181 140595544712960 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:15:26.001002 140595536320256 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:15:26.052782 140596577531328 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:15:26.053724 140596577531328 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:15:26.075783 140595527927552 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:15:26.344007 140595527927552 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:15:30.340259 140595536320256 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:15:34.648649 140596577531328 basic_session_run_hooks.py:262] loss = 0.25535807, step = 30
I0811 20:15:34.650609 140596577531328 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:15:48.116478 140596577531328 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:15:48.116770 140596577531328 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:15:48.117094 140595544712960 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:15:48.117439 140595544712960 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:15:48.117693 140596577531328 error_handling.py:96] infeed marked as finished
I0811 20:15:48.117902 140596577531328 tpu_estimator.py:602] Stop output thread controller
I0811 20:15:48.118010 140596577531328 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:15:48.118216 140595536320256 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:15:48.118402 140595536320256 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:15:48.118555 140596577531328 error_handling.py:96] outfeed marked as finished
I0811 20:15:48.118680 140596577531328 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:15:56.469276 140596577531328 estimator.py:368] Loss for final step: 0.25535807.
I0811 20:15:56.470266 140596577531328 error_handling.py:96] training_loop marked as finished
I0811 20:15:57.244606 140596577531328 estimator.py:1145] Calling model_fn.
E0811 20:15:57.973337 140596577531328 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:15:58.164689 140596577531328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:15:58.192153 140596577531328 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:15:58.213507 140596577531328 estimator.py:1147] Done calling model_fn.
I0811 20:15:58.230426 140596577531328 evaluation.py:255] Starting evaluation at 2019-08-11T20:15:58Z
I0811 20:15:58.230667 140596577531328 tpu_estimator.py:499] TPU job name worker
I0811 20:15:58.308669 140596577531328 monitored_session.py:240] Graph was finalized.
W0811 20:15:58.309406 140596577531328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:15:58.485903 140596577531328 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:16:01.146471 140596577531328 session_manager.py:500] Running local_init_op.
I0811 20:16:01.169728 140596577531328 session_manager.py:502] Done running local_init_op.
I0811 20:16:01.221257 140596577531328 tpu_estimator.py:557] Init TPU system
I0811 20:16:13.038362 140596577531328 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:16:13.039347 140595536320256 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:16:13.040061 140595527927552 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:16:13.106163 140596577531328 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:16:13.133542 140596577531328 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:16:13.133914 140596577531328 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:16:13.159734 140595519534848 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:16:13.296267 140595519534848 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:16:13.803276 140595527927552 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:16:14.359148 140596577531328 evaluation.py:167] Evaluation [10/10]
I0811 20:16:14.359488 140596577531328 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:16:14.359555 140596577531328 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:16:14.359919 140595536320256 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:16:14.360199 140595536320256 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:16:14.360421 140596577531328 error_handling.py:96] infeed marked as finished
I0811 20:16:14.360611 140596577531328 tpu_estimator.py:602] Stop output thread controller
I0811 20:16:14.360673 140596577531328 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:16:14.360893 140595527927552 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:16:14.361084 140595527927552 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:16:14.361258 140596577531328 error_handling.py:96] outfeed marked as finished
I0811 20:16:14.361399 140596577531328 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:16:43.382687 140596577531328 evaluation.py:275] Finished evaluation at 2019-08-11-20:16:43
I0811 20:16:43.383027 140596577531328 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9356, global_step = 30, loss = 0.24387622
I0811 20:16:47.582636 140596577531328 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:16:48.380161 140596577531328 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.24387622, 'global_step': 30, 'accuracy': 0.9356}

Removing gs://yangyou-mnist/log/#1565554496670643...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565554508922205...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565554496.v3-8-tpu#1565554547740788...
Removing gs://yangyou-mnist/log/checkpoint#1565554544678638...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565554501263487...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565554541574980...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565554508004241...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565554542424467...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565554513283880...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565554546815638...
Removing gs://yangyou-mnist/log/eval/#1565554604951384...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565554605.v3-8-tpu#1565554608003608...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:16:52.100784 139793095861696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:16:52.101576 139793095861696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:16:52.104412 139793095861696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:16:52.105223 139793095861696 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:16:52.105866 139793095861696 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:16:52.106013 139793095861696 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:16:52.526438 139793095861696 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:16:52.533277 139793095861696 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:16:52.536978 139793095861696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:16:52.580677 139793095861696 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:16:52.580939 139793095861696 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:16:52.800554 139793095861696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:16:52.887310 139793095861696 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:16:52.887593 139793095861696 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:16:53.108001 139793095861696 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f23f7fb80d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f23fa196190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:16:53.108354 139793095861696 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:16:53.461332 139793095861696 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:16:53.464257: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:16:53.476700 139793095861696 tpu_system_metadata.py:148] Found TPU system:
I0811 20:16:53.476936 139793095861696 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:16:53.477493 139793095861696 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:16:53.477555 139793095861696 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:16:53.477649 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:16:53.478004 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:16:53.478064 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:16:53.478115 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:16:53.478163 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:16:53.478224 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:16:53.478274 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:16:53.478321 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:16:53.478368 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:16:53.478415 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:16:53.478461 139793095861696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:16:53.484404 139793095861696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:16:53.496625 139793095861696 estimator.py:1145] Calling model_fn.
W0811 20:16:53.497216 139793095861696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:16:53.827225 139793095861696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:16:54.247582 139793095861696 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:16:54.307789 139793095861696 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:16:54.313477 139793095861696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:16:54.496692 139793095861696 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:16:54.510332 139793095861696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:16:54.522232 139793095861696 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:16:54.522556 139793095861696 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:16:54.933443 139793095861696 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:16:54.948688 139793095861696 estimator.py:1147] Done calling model_fn.
I0811 20:16:58.256654 139793095861696 tpu_estimator.py:499] TPU job name worker
I0811 20:16:58.372406 139793095861696 monitored_session.py:240] Graph was finalized.
I0811 20:16:58.946676 139793095861696 session_manager.py:500] Running local_init_op.
I0811 20:16:58.976520 139793095861696 session_manager.py:502] Done running local_init_op.
I0811 20:17:01.440736 139793095861696 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:17:13.740065 139793095861696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:17:13.855633 139793095861696 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:17:13.856188 139793095861696 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:17:13.856611: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:17:13.861110 139793095861696 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:17:13.863372 139793095861696 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:17:13.867290 139793095861696 tpu_estimator.py:557] Init TPU system
I0811 20:17:25.743338 139793095861696 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:17:25.744302 139792403711744 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:17:25.744894 139791924459264 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:17:25.789305 139793095861696 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:17:25.790277 139793095861696 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:17:25.800801 139791916066560 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:17:26.019814 139791916066560 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:17:30.267412 139791924459264 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:17:34.894289 139793095861696 basic_session_run_hooks.py:262] loss = 0.23740359, step = 30
I0811 20:17:34.896744 139793095861696 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:17:47.817109 139793095861696 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:17:47.817414 139793095861696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:17:47.817650 139792403711744 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:17:47.817770 139792403711744 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:17:47.817909 139793095861696 error_handling.py:96] infeed marked as finished
I0811 20:17:47.818017 139793095861696 tpu_estimator.py:602] Stop output thread controller
I0811 20:17:47.818067 139793095861696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:17:47.818183 139791924459264 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:17:47.818262 139791924459264 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:17:47.818377 139793095861696 error_handling.py:96] outfeed marked as finished
I0811 20:17:47.818464 139793095861696 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:17:56.147979 139793095861696 estimator.py:368] Loss for final step: 0.23740359.
I0811 20:17:56.148792 139793095861696 error_handling.py:96] training_loop marked as finished
I0811 20:17:57.101814 139793095861696 estimator.py:1145] Calling model_fn.
E0811 20:17:57.788192 139793095861696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:17:57.984028 139793095861696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:17:58.011684 139793095861696 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:17:58.032630 139793095861696 estimator.py:1147] Done calling model_fn.
I0811 20:17:58.050854 139793095861696 evaluation.py:255] Starting evaluation at 2019-08-11T20:17:58Z
I0811 20:17:58.051094 139793095861696 tpu_estimator.py:499] TPU job name worker
I0811 20:17:58.125149 139793095861696 monitored_session.py:240] Graph was finalized.
W0811 20:17:58.125951 139793095861696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:17:58.297297 139793095861696 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:18:00.779268 139793095861696 session_manager.py:500] Running local_init_op.
I0811 20:18:00.807743 139793095861696 session_manager.py:502] Done running local_init_op.
I0811 20:18:00.858700 139793095861696 tpu_estimator.py:557] Init TPU system
I0811 20:18:12.989150 139793095861696 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:18:12.990220 139791916066560 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:18:12.990829 139791907673856 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:18:13.057774 139793095861696 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:18:13.085014 139793095861696 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:18:13.085402 139793095861696 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:18:13.112142 139791899281152 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:18:13.338279 139791899281152 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:18:13.819747 139791907673856 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:18:14.168355 139793095861696 evaluation.py:167] Evaluation [10/10]
I0811 20:18:14.168713 139793095861696 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:18:14.168838 139793095861696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:18:14.169085 139791916066560 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:18:14.169207 139791916066560 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:18:14.169420 139793095861696 error_handling.py:96] infeed marked as finished
I0811 20:18:14.169534 139793095861696 tpu_estimator.py:602] Stop output thread controller
I0811 20:18:14.169634 139793095861696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:18:14.169802 139791907673856 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:18:14.169886 139791907673856 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:18:14.170032 139793095861696 error_handling.py:96] outfeed marked as finished
I0811 20:18:14.170128 139793095861696 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:18:43.438646 139793095861696 evaluation.py:275] Finished evaluation at 2019-08-11-20:18:43
I0811 20:18:43.438993 139793095861696 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9401, global_step = 30, loss = 0.2305553
I0811 20:18:47.752011 139793095861696 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:18:48.538270 139793095861696 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.2305553, 'global_step': 30, 'accuracy': 0.9401}

Removing gs://yangyou-mnist/log/checkpoint#1565554664385246...
Removing gs://yangyou-mnist/log/#1565554616367069...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565554616.v3-8-tpu#1565554667439482...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565554633175473...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565554620845308...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565554628676597...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565554627881454...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565554661359821...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565554662243066...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565554666474168...
Removing gs://yangyou-mnist/log/eval/#1565554725041847...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565554725.v3-8-tpu#1565554728159134...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:18:52.279129 139874784368064 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:18:52.279921 139874784368064 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:18:52.282566 139874784368064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:18:52.283376 139874784368064 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:18:52.283948 139874784368064 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:18:52.284076 139874784368064 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:18:52.702738 139874784368064 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:18:52.710232 139874784368064 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:18:52.714196 139874784368064 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:18:52.762434 139874784368064 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:18:52.762722 139874784368064 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:18:52.983654 139874784368064 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:18:53.070843 139874784368064 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:18:53.071135 139874784368064 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:18:53.336319 139874784368064 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f36fcff30d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f36ff1d1190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:18:53.336692 139874784368064 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:18:53.664722 139874784368064 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:18:53.668002: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:18:53.679344 139874784368064 tpu_system_metadata.py:148] Found TPU system:
I0811 20:18:53.679577 139874784368064 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:18:53.680078 139874784368064 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:18:53.680136 139874784368064 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:18:53.680191 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:18:53.680478 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:18:53.680535 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:18:53.680583 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:18:53.680632 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:18:53.680679 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:18:53.680737 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:18:53.680785 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:18:53.680831 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:18:53.680877 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:18:53.680927 139874784368064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:18:53.687108 139874784368064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:18:53.699639 139874784368064 estimator.py:1145] Calling model_fn.
W0811 20:18:53.700253 139874784368064 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:18:53.963124 139874784368064 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:18:54.468683 139874784368064 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:18:54.530447 139874784368064 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:18:54.536556 139874784368064 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:18:54.713689 139874784368064 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:18:54.727157 139874784368064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:18:54.739049 139874784368064 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:18:54.739356 139874784368064 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:18:55.154622 139874784368064 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:18:55.170300 139874784368064 estimator.py:1147] Done calling model_fn.
I0811 20:18:58.403306 139874784368064 tpu_estimator.py:499] TPU job name worker
I0811 20:18:58.519855 139874784368064 monitored_session.py:240] Graph was finalized.
I0811 20:18:59.087449 139874784368064 session_manager.py:500] Running local_init_op.
I0811 20:18:59.126451 139874784368064 session_manager.py:502] Done running local_init_op.
I0811 20:19:01.586592 139874784368064 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:19:13.758883 139874784368064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:19:13.879734 139874784368064 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:19:13.880177 139874784368064 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:19:13.880632: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:19:13.885230 139874784368064 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:19:13.887535 139874784368064 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:19:13.890829 139874784368064 tpu_estimator.py:557] Init TPU system
I0811 20:19:25.829297 139874784368064 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:19:25.830367 139874025060096 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:19:25.830770 139874016667392 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:19:25.872939 139874784368064 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:19:25.873992 139874784368064 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:19:25.884552 139874008274688 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:19:26.082562 139874008274688 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:19:30.488862 139874016667392 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:19:35.024802 139874784368064 basic_session_run_hooks.py:262] loss = 0.18692215, step = 30
I0811 20:19:35.027178 139874784368064 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:19:47.923180 139874784368064 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:19:47.923481 139874784368064 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:19:47.923804 139874025060096 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:19:47.924149 139874025060096 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:19:47.924355 139874784368064 error_handling.py:96] infeed marked as finished
I0811 20:19:47.924561 139874784368064 tpu_estimator.py:602] Stop output thread controller
I0811 20:19:47.924616 139874784368064 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:19:47.924823 139874016667392 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:19:47.925038 139874016667392 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:19:47.925196 139874784368064 error_handling.py:96] outfeed marked as finished
I0811 20:19:47.925316 139874784368064 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:19:56.209237 139874784368064 estimator.py:368] Loss for final step: 0.18692215.
I0811 20:19:56.210117 139874784368064 error_handling.py:96] training_loop marked as finished
I0811 20:19:56.891308 139874784368064 estimator.py:1145] Calling model_fn.
E0811 20:19:57.574060 139874784368064 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:19:57.769866 139874784368064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:19:57.797537 139874784368064 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:19:57.819658 139874784368064 estimator.py:1147] Done calling model_fn.
I0811 20:19:57.837544 139874784368064 evaluation.py:255] Starting evaluation at 2019-08-11T20:19:57Z
I0811 20:19:57.838022 139874784368064 tpu_estimator.py:499] TPU job name worker
I0811 20:19:57.913760 139874784368064 monitored_session.py:240] Graph was finalized.
W0811 20:19:57.914653 139874784368064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:19:58.091314 139874784368064 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:20:00.691381 139874784368064 session_manager.py:500] Running local_init_op.
I0811 20:20:00.722165 139874784368064 session_manager.py:502] Done running local_init_op.
I0811 20:20:00.778260 139874784368064 tpu_estimator.py:557] Init TPU system
I0811 20:20:12.670495 139874784368064 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:20:12.671504 139874012735232 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:20:12.672796 139873528837888 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:20:12.741338 139874784368064 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:20:12.767653 139874784368064 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:20:12.768047 139874784368064 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:20:12.795726 139873520445184 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:20:13.042591 139873520445184 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:20:13.489306 139873528837888 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:20:13.798111 139874784368064 evaluation.py:167] Evaluation [10/10]
I0811 20:20:13.798481 139874784368064 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:20:13.798574 139874784368064 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:20:13.798870 139874012735232 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:20:13.799249 139874012735232 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:20:13.799453 139874784368064 error_handling.py:96] infeed marked as finished
I0811 20:20:13.799609 139874784368064 tpu_estimator.py:602] Stop output thread controller
I0811 20:20:13.799665 139874784368064 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:20:13.799850 139873528837888 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:20:13.800033 139873528837888 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:20:13.800189 139874784368064 error_handling.py:96] outfeed marked as finished
I0811 20:20:13.800312 139874784368064 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:20:43.139590 139874784368064 evaluation.py:275] Finished evaluation at 2019-08-11-20:20:43
I0811 20:20:43.139970 139874784368064 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9492, global_step = 30, loss = 0.18597616
I0811 20:20:47.155498 139874784368064 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:20:47.985755 139874784368064 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.18597616, 'global_step': 30, 'accuracy': 0.9492}

Removing gs://yangyou-mnist/log/#1565554736608253...
Removing gs://yangyou-mnist/log/checkpoint#1565554784380630...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565554753217430...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565554740985614...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565554781335984...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565554736.v3-8-tpu#1565554787556377...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565554748972886...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565554782182996...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565554748069832...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565554786661297...
Removing gs://yangyou-mnist/log/eval/#1565554844651642...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565554844.v3-8-tpu#1565554847627258...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:20:51.679202 140556856305088 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:20:51.679981 140556856305088 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:20:51.682588 140556856305088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:20:51.683394 140556856305088 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:20:51.683973 140556856305088 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:20:51.684102 140556856305088 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:20:52.073967 140556856305088 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:20:52.081197 140556856305088 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:20:52.085356 140556856305088 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:20:52.128705 140556856305088 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:20:52.129023 140556856305088 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:20:52.258874 140556856305088 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:20:52.307557 140556856305088 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:20:52.307852 140556856305088 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:20:52.470652 140556856305088 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd5cba70250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd5cdc4e190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:20:52.471028 140556856305088 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:20:52.797262 140556856305088 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:20:52.799923: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:20:52.812490 140556856305088 tpu_system_metadata.py:148] Found TPU system:
I0811 20:20:52.812747 140556856305088 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:20:52.813293 140556856305088 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:20:52.813353 140556856305088 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:20:52.813405 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:20:52.813735 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:20:52.813793 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:20:52.813844 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:20:52.813894 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:20:52.813941 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:20:52.813990 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:20:52.814035 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:20:52.814110 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:20:52.814157 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:20:52.814207 140556856305088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:20:52.820045 140556856305088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:20:52.831821 140556856305088 estimator.py:1145] Calling model_fn.
W0811 20:20:52.832393 140556856305088 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:20:53.096584 140556856305088 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:20:53.569154 140556856305088 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:20:53.632364 140556856305088 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:20:53.638771 140556856305088 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:20:53.814218 140556856305088 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:20:53.827467 140556856305088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:20:53.839665 140556856305088 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:20:53.839971 140556856305088 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:20:54.257230 140556856305088 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:20:54.273291 140556856305088 estimator.py:1147] Done calling model_fn.
I0811 20:20:57.604947 140556856305088 tpu_estimator.py:499] TPU job name worker
I0811 20:20:57.718008 140556856305088 monitored_session.py:240] Graph was finalized.
I0811 20:20:58.309722 140556856305088 session_manager.py:500] Running local_init_op.
I0811 20:20:58.341752 140556856305088 session_manager.py:502] Done running local_init_op.
I0811 20:21:00.995215 140556856305088 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:21:13.366663 140556856305088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:21:13.480169 140556856305088 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:21:13.480711 140556856305088 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:21:13.481104: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:21:13.485555 140556856305088 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:21:13.487523 140556856305088 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:21:13.491503 140556856305088 tpu_estimator.py:557] Init TPU system
I0811 20:21:25.801866 140556856305088 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:21:25.802730 140555824658176 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:21:25.803283 140555816265472 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:21:25.845716 140556856305088 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:21:25.846631 140556856305088 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:21:25.856789 140555807872768 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:21:25.983910 140555807872768 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:21:30.253067 140555816265472 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:21:34.506089 140556856305088 basic_session_run_hooks.py:262] loss = 0.12820767, step = 30
I0811 20:21:34.507925 140556856305088 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:21:47.548001 140556856305088 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:21:47.548285 140556856305088 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:21:47.548511 140555824658176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:21:47.548624 140555824658176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:21:47.548759 140556856305088 error_handling.py:96] infeed marked as finished
I0811 20:21:47.548882 140556856305088 tpu_estimator.py:602] Stop output thread controller
I0811 20:21:47.548932 140556856305088 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:21:47.549046 140555816265472 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:21:47.549122 140555816265472 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:21:47.549233 140556856305088 error_handling.py:96] outfeed marked as finished
I0811 20:21:47.549313 140556856305088 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:21:56.096318 140556856305088 estimator.py:368] Loss for final step: 0.12820767.
I0811 20:21:56.097177 140556856305088 error_handling.py:96] training_loop marked as finished
I0811 20:21:56.791354 140556856305088 estimator.py:1145] Calling model_fn.
E0811 20:21:57.471290 140556856305088 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:21:57.663645 140556856305088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:21:57.691550 140556856305088 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:21:57.712974 140556856305088 estimator.py:1147] Done calling model_fn.
I0811 20:21:57.729882 140556856305088 evaluation.py:255] Starting evaluation at 2019-08-11T20:21:57Z
I0811 20:21:57.730114 140556856305088 tpu_estimator.py:499] TPU job name worker
I0811 20:21:57.803812 140556856305088 monitored_session.py:240] Graph was finalized.
W0811 20:21:57.804563 140556856305088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:21:57.986444 140556856305088 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:22:00.445200 140556856305088 session_manager.py:500] Running local_init_op.
I0811 20:22:00.468071 140556856305088 session_manager.py:502] Done running local_init_op.
I0811 20:22:00.520334 140556856305088 tpu_estimator.py:557] Init TPU system
I0811 20:22:12.644495 140556856305088 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:22:12.645387 140555824396032 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:22:12.645935 140555816003328 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:22:12.716111 140556856305088 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:22:12.746121 140556856305088 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:22:12.746515 140556856305088 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:22:12.773489 140555807610624 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:22:12.893119 140555807610624 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:22:13.477843 140555816003328 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:22:13.889528 140556856305088 evaluation.py:167] Evaluation [10/10]
I0811 20:22:13.889935 140556856305088 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:22:13.890008 140556856305088 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:22:13.890263 140555824396032 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:22:13.890544 140555824396032 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:22:13.890758 140556856305088 error_handling.py:96] infeed marked as finished
I0811 20:22:13.890981 140556856305088 tpu_estimator.py:602] Stop output thread controller
I0811 20:22:13.891045 140556856305088 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:22:13.891258 140555816003328 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:22:13.891441 140555816003328 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:22:13.891613 140556856305088 error_handling.py:96] outfeed marked as finished
I0811 20:22:13.891752 140556856305088 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:22:42.989391 140556856305088 evaluation.py:275] Finished evaluation at 2019-08-11-20:22:42
I0811 20:22:42.989753 140556856305088 estimator.py:2039] Saving dict for global step 30: accuracy = 0.967, global_step = 30, loss = 0.12073479
I0811 20:22:47.064728 140556856305088 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:22:48.021992 140556856305088 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12073479, 'global_step': 30, 'accuracy': 0.967}

Removing gs://yangyou-mnist/log/#1565554855658337...
Removing gs://yangyou-mnist/log/checkpoint#1565554904068173...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565554868457469...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565554860418264...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565554855.v3-8-tpu#1565554907197626...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565554872837338...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565554867562177...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565554901239165...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565554902109766...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565554906265927...
Removing gs://yangyou-mnist/log/eval/#1565554964526758...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565554964.v3-8-tpu#1565554967669391...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:22:51.749335 140046209222080 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:22:51.750193 140046209222080 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:22:51.752854 140046209222080 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:22:51.753854 140046209222080 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:22:51.754468 140046209222080 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:22:51.754604 140046209222080 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:22:52.141767 140046209222080 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:22:52.149481 140046209222080 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:22:52.153429 140046209222080 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:22:52.201639 140046209222080 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:22:52.201934 140046209222080 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:22:52.354984 140046209222080 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:22:52.444348 140046209222080 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:22:52.444669 140046209222080 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:22:52.573806 140046209222080 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5ee6b6e110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5ee8d4c190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:22:52.574191 140046209222080 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:22:52.899549 140046209222080 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:22:52.902561: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:22:52.914462 140046209222080 tpu_system_metadata.py:148] Found TPU system:
I0811 20:22:52.914758 140046209222080 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:22:52.915303 140046209222080 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:22:52.915361 140046209222080 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:22:52.915414 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:22:52.915721 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:22:52.915780 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:22:52.915832 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:22:52.915882 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:22:52.915930 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:22:52.915977 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:22:52.916024 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:22:52.916073 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:22:52.916120 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:22:52.916188 140046209222080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:22:52.922350 140046209222080 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:22:52.934510 140046209222080 estimator.py:1145] Calling model_fn.
W0811 20:22:52.935094 140046209222080 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:22:53.206744 140046209222080 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:22:53.722620 140046209222080 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:22:53.781894 140046209222080 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:22:53.787569 140046209222080 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:22:53.960730 140046209222080 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:22:53.974226 140046209222080 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:22:53.986156 140046209222080 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:22:53.986468 140046209222080 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:22:54.403497 140046209222080 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:22:54.419142 140046209222080 estimator.py:1147] Done calling model_fn.
I0811 20:22:57.680500 140046209222080 tpu_estimator.py:499] TPU job name worker
I0811 20:22:57.793731 140046209222080 monitored_session.py:240] Graph was finalized.
I0811 20:22:58.378722 140046209222080 session_manager.py:500] Running local_init_op.
I0811 20:22:58.416919 140046209222080 session_manager.py:502] Done running local_init_op.
I0811 20:23:00.847800 140046209222080 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:23:12.441339 140046209222080 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:23:12.553188 140046209222080 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:23:12.553704 140046209222080 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:23:12.554152: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:23:12.559360 140046209222080 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:23:12.561444 140046209222080 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:23:12.565251 140046209222080 tpu_estimator.py:557] Init TPU system
I0811 20:23:25.682590 140046209222080 tpu_estimator.py:566] Initialized TPU in 13 seconds
I0811 20:23:25.683717 140045302351616 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:23:25.684509 140045293958912 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:23:25.732343 140046209222080 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:23:25.733620 140046209222080 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:23:25.744487 140045285566208 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:23:25.880511 140045285566208 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:23:30.356442 140045293958912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:23:34.802700 140046209222080 basic_session_run_hooks.py:262] loss = 0.12597731, step = 30
I0811 20:23:34.804877 140046209222080 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:23:48.352777 140046209222080 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:23:48.353116 140046209222080 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:23:48.354566 140045302351616 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:23:48.354840 140045302351616 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:23:48.355025 140046209222080 error_handling.py:96] infeed marked as finished
I0811 20:23:48.355225 140046209222080 tpu_estimator.py:602] Stop output thread controller
I0811 20:23:48.355290 140046209222080 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:23:48.355448 140045293958912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:23:48.355632 140045293958912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:23:48.355801 140046209222080 error_handling.py:96] outfeed marked as finished
I0811 20:23:48.355989 140046209222080 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:23:56.008049 140046209222080 estimator.py:368] Loss for final step: 0.12597731.
I0811 20:23:56.008930 140046209222080 error_handling.py:96] training_loop marked as finished
I0811 20:23:56.707755 140046209222080 estimator.py:1145] Calling model_fn.
E0811 20:23:57.442080 140046209222080 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:23:57.640628 140046209222080 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:23:57.668258 140046209222080 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:23:57.689205 140046209222080 estimator.py:1147] Done calling model_fn.
I0811 20:23:57.706363 140046209222080 evaluation.py:255] Starting evaluation at 2019-08-11T20:23:57Z
I0811 20:23:57.706600 140046209222080 tpu_estimator.py:499] TPU job name worker
I0811 20:23:57.782000 140046209222080 monitored_session.py:240] Graph was finalized.
W0811 20:23:57.782751 140046209222080 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:23:57.975292 140046209222080 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:24:00.381110 140046209222080 session_manager.py:500] Running local_init_op.
I0811 20:24:00.406243 140046209222080 session_manager.py:502] Done running local_init_op.
I0811 20:24:00.460772 140046209222080 tpu_estimator.py:557] Init TPU system
I0811 20:24:12.770832 140046209222080 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:24:12.771862 140045302351616 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:24:12.772747 140045293958912 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:24:12.840063 140046209222080 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:24:12.862365 140046209222080 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:24:12.862811 140046209222080 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:24:12.892230 140045285566208 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:24:13.037527 140045285566208 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:24:13.558382 140045293958912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:24:13.849468 140046209222080 evaluation.py:167] Evaluation [10/10]
I0811 20:24:13.849888 140046209222080 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:24:13.849966 140046209222080 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:24:13.850208 140045302351616 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:24:13.850502 140045302351616 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:24:13.850725 140046209222080 error_handling.py:96] infeed marked as finished
I0811 20:24:13.850923 140046209222080 tpu_estimator.py:602] Stop output thread controller
I0811 20:24:13.850984 140046209222080 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:24:13.851140 140045293958912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:24:13.851279 140045293958912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:24:13.851424 140046209222080 error_handling.py:96] outfeed marked as finished
I0811 20:24:13.851561 140046209222080 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:24:43.134563 140046209222080 evaluation.py:275] Finished evaluation at 2019-08-11-20:24:43
I0811 20:24:43.134897 140046209222080 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9698, global_step = 30, loss = 0.09804611
I0811 20:24:47.225805 140046209222080 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:24:48.003799 140046209222080 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09804611, 'global_step': 30, 'accuracy': 0.9698}

Removing gs://yangyou-mnist/log/#1565554975849650...
Removing gs://yangyou-mnist/log/checkpoint#1565555024862211...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565554976.v3-8-tpu#1565555027984331...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565555021758086...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565554987752840...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565554991904418...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565554980267743...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565554986863207...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565555022621941...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565555026999469...
Removing gs://yangyou-mnist/log/eval/#1565555084724509...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565555084.v3-8-tpu#1565555087642768...
/ [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:24:51.805799 140674101462464 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:24:51.806575 140674101462464 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:24:51.809117 140674101462464 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:24:51.810043 140674101462464 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:24:51.810617 140674101462464 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:24:51.810744 140674101462464 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:24:52.230318 140674101462464 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:24:52.236582 140674101462464 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:24:52.240267 140674101462464 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:24:52.290158 140674101462464 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:24:52.290507 140674101462464 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:24:52.502746 140674101462464 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:24:52.548721 140674101462464 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:24:52.549010 140674101462464 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:24:52.780860 140674101462464 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff118022110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff11a200190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:24:52.781383 140674101462464 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:24:53.103285 140674101462464 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:24:53.106203: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:24:53.117774 140674101462464 tpu_system_metadata.py:148] Found TPU system:
I0811 20:24:53.118014 140674101462464 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:24:53.118515 140674101462464 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:24:53.118583 140674101462464 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:24:53.118644 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:24:53.118932 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:24:53.118999 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:24:53.119050 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:24:53.119107 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:24:53.119157 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:24:53.119209 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:24:53.119257 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:24:53.119304 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:24:53.119350 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:24:53.119399 140674101462464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:24:53.125454 140674101462464 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:24:53.137819 140674101462464 estimator.py:1145] Calling model_fn.
W0811 20:24:53.138432 140674101462464 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:24:53.416662 140674101462464 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:24:53.831088 140674101462464 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:24:53.891746 140674101462464 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:24:53.897439 140674101462464 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:24:54.073157 140674101462464 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:24:54.086802 140674101462464 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:24:54.098596 140674101462464 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:24:54.098926 140674101462464 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:24:54.527209 140674101462464 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:24:54.542829 140674101462464 estimator.py:1147] Done calling model_fn.
I0811 20:24:57.876795 140674101462464 tpu_estimator.py:499] TPU job name worker
I0811 20:24:57.988126 140674101462464 monitored_session.py:240] Graph was finalized.
I0811 20:24:58.551403 140674101462464 session_manager.py:500] Running local_init_op.
I0811 20:24:58.590953 140674101462464 session_manager.py:502] Done running local_init_op.
I0811 20:25:01.173981 140674101462464 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:25:13.049165 140674101462464 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:25:13.163043 140674101462464 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:25:13.163536 140674101462464 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:25:13.164007: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:25:13.168319 140674101462464 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:25:13.170584 140674101462464 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:25:13.174352 140674101462464 tpu_estimator.py:557] Init TPU system
I0811 20:25:25.146270 140674101462464 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:25:25.147350 140672929625856 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:25:25.148231 140672921233152 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:25:25.190565 140674101462464 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:25:25.192071 140674101462464 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:25:25.202199 140672912840448 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:25:25.441260 140672912840448 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:25:29.639522 140672921233152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:25:34.112356 140674101462464 basic_session_run_hooks.py:262] loss = 0.081639014, step = 30
I0811 20:25:34.114531 140674101462464 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:25:47.276983 140674101462464 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:25:47.277291 140674101462464 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:25:47.277656 140672929625856 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:25:47.277959 140672929625856 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:25:47.278197 140674101462464 error_handling.py:96] infeed marked as finished
I0811 20:25:47.278404 140674101462464 tpu_estimator.py:602] Stop output thread controller
I0811 20:25:47.278465 140674101462464 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:25:47.278636 140672921233152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:25:47.278808 140672921233152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:25:47.278969 140674101462464 error_handling.py:96] outfeed marked as finished
I0811 20:25:47.279119 140674101462464 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:25:55.569268 140674101462464 estimator.py:368] Loss for final step: 0.081639014.
I0811 20:25:55.570250 140674101462464 error_handling.py:96] training_loop marked as finished
I0811 20:25:56.375722 140674101462464 estimator.py:1145] Calling model_fn.
E0811 20:25:57.060851 140674101462464 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:25:57.259035 140674101462464 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:25:57.286891 140674101462464 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:25:57.309334 140674101462464 estimator.py:1147] Done calling model_fn.
I0811 20:25:57.327603 140674101462464 evaluation.py:255] Starting evaluation at 2019-08-11T20:25:57Z
I0811 20:25:57.327852 140674101462464 tpu_estimator.py:499] TPU job name worker
I0811 20:25:57.404973 140674101462464 monitored_session.py:240] Graph was finalized.
W0811 20:25:57.405786 140674101462464 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:25:57.587136 140674101462464 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:26:00.134841 140674101462464 session_manager.py:500] Running local_init_op.
I0811 20:26:00.162951 140674101462464 session_manager.py:502] Done running local_init_op.
I0811 20:26:00.213241 140674101462464 tpu_estimator.py:557] Init TPU system
I0811 20:26:12.440016 140674101462464 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:26:12.441123 140672929625856 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:26:12.441867 140672921233152 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:26:12.508302 140674101462464 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:26:12.534387 140674101462464 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:26:12.534746 140674101462464 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:26:12.563155 140672912840448 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:26:12.745636 140672912840448 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:26:13.264276 140672921233152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:26:13.564774 140674101462464 evaluation.py:167] Evaluation [10/10]
I0811 20:26:13.565103 140674101462464 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:26:13.565222 140674101462464 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:26:13.565536 140672929625856 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:26:13.566030 140672929625856 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:26:13.566236 140674101462464 error_handling.py:96] infeed marked as finished
I0811 20:26:13.566399 140674101462464 tpu_estimator.py:602] Stop output thread controller
I0811 20:26:13.566456 140674101462464 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:26:13.566646 140672921233152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:26:13.566826 140672921233152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:26:13.566999 140674101462464 error_handling.py:96] outfeed marked as finished
I0811 20:26:13.567117 140674101462464 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:26:42.847394 140674101462464 evaluation.py:275] Finished evaluation at 2019-08-11-20:26:42
I0811 20:26:42.847758 140674101462464 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9789, global_step = 30, loss = 0.07531819
I0811 20:26:47.110477 140674101462464 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:26:47.915405 140674101462464 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07531819, 'global_step': 30, 'accuracy': 0.9789}

Removing gs://yangyou-mnist/log/#1565555095976264...
Removing gs://yangyou-mnist/log/checkpoint#1565555143802917...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565555096.v3-8-tpu#1565555146924825...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565555108220302...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565555100608763...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565555112504276...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565555107410367...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565555140750787...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565555141659038...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565555145964839...
Removing gs://yangyou-mnist/log/eval/#1565555204470329...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565555204.v3-8-tpu#1565555207574374...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:26:51.633658 140598328038848 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:26:51.634464 140598328038848 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:26:51.636997 140598328038848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:26:51.637996 140598328038848 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:26:51.638645 140598328038848 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:26:51.638773 140598328038848 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:26:52.052005 140598328038848 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:26:52.058233 140598328038848 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:26:52.061995 140598328038848 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:26:52.107103 140598328038848 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:26:52.107389 140598328038848 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:26:52.349663 140598328038848 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:26:52.395823 140598328038848 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:26:52.396109 140598328038848 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:26:52.623078 140598328038848 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fdf738f7050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fdf75ad5190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:26:52.623467 140598328038848 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:26:52.955609 140598328038848 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:26:52.958971: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:26:52.970731 140598328038848 tpu_system_metadata.py:148] Found TPU system:
I0811 20:26:52.970978 140598328038848 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:26:52.971529 140598328038848 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:26:52.971596 140598328038848 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:26:52.971649 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:26:52.971940 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:26:52.971999 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:26:52.972058 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:26:52.972106 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:26:52.972153 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:26:52.972199 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:26:52.972245 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:26:52.972290 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:26:52.972337 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:26:52.972389 140598328038848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:26:52.978493 140598328038848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:26:52.990910 140598328038848 estimator.py:1145] Calling model_fn.
W0811 20:26:52.991538 140598328038848 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:26:53.240911 140598328038848 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:26:53.650168 140598328038848 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:26:53.710251 140598328038848 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:26:53.716114 140598328038848 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:26:53.889528 140598328038848 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:26:53.903163 140598328038848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:26:53.915107 140598328038848 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:26:53.915406 140598328038848 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:26:54.324579 140598328038848 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:26:54.340487 140598328038848 estimator.py:1147] Done calling model_fn.
I0811 20:26:57.754254 140598328038848 tpu_estimator.py:499] TPU job name worker
I0811 20:26:57.865556 140598328038848 monitored_session.py:240] Graph was finalized.
I0811 20:26:58.443856 140598328038848 session_manager.py:500] Running local_init_op.
I0811 20:26:58.483248 140598328038848 session_manager.py:502] Done running local_init_op.
I0811 20:27:01.029222 140598328038848 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:27:13.133450 140598328038848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:27:13.247731 140598328038848 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:27:13.248212 140598328038848 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:27:13.248604: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:27:13.253321 140598328038848 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:27:13.255372 140598328038848 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:27:13.259882 140598328038848 tpu_estimator.py:557] Init TPU system
I0811 20:27:25.267072 140598328038848 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:27:25.268089 140597297936128 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:27:25.268794 140597289543424 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:27:25.311351 140598328038848 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:27:25.312230 140598328038848 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:27:25.323432 140597281150720 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:27:25.426354 140597281150720 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:27:29.855835 140597289543424 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:27:34.260514 140598328038848 basic_session_run_hooks.py:262] loss = 0.1334228, step = 30
I0811 20:27:34.262680 140598328038848 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:27:47.709167 140598328038848 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:27:47.709542 140598328038848 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:27:47.709827 140597297936128 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:27:47.709925 140597297936128 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:27:47.710062 140598328038848 error_handling.py:96] infeed marked as finished
I0811 20:27:47.710172 140598328038848 tpu_estimator.py:602] Stop output thread controller
I0811 20:27:47.710222 140598328038848 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:27:47.710331 140597289543424 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:27:47.710402 140597289543424 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:27:47.710515 140598328038848 error_handling.py:96] outfeed marked as finished
I0811 20:27:47.710597 140598328038848 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:27:55.556670 140598328038848 estimator.py:368] Loss for final step: 0.1334228.
I0811 20:27:55.557535 140598328038848 error_handling.py:96] training_loop marked as finished
I0811 20:27:56.242811 140598328038848 estimator.py:1145] Calling model_fn.
E0811 20:27:56.919862 140598328038848 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:27:57.111861 140598328038848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:27:57.139614 140598328038848 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:27:57.161164 140598328038848 estimator.py:1147] Done calling model_fn.
I0811 20:27:57.178891 140598328038848 evaluation.py:255] Starting evaluation at 2019-08-11T20:27:57Z
I0811 20:27:57.179138 140598328038848 tpu_estimator.py:499] TPU job name worker
I0811 20:27:57.255413 140598328038848 monitored_session.py:240] Graph was finalized.
W0811 20:27:57.256213 140598328038848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:27:57.436557 140598328038848 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:28:00.045073 140598328038848 session_manager.py:500] Running local_init_op.
I0811 20:28:00.072660 140598328038848 session_manager.py:502] Done running local_init_op.
I0811 20:28:00.119420 140598328038848 tpu_estimator.py:557] Init TPU system
I0811 20:28:12.446466 140598328038848 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:28:12.447289 140597296101120 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:28:12.447726 140597287708416 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:28:12.513541 140598328038848 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:28:12.538583 140598328038848 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:28:12.538963 140598328038848 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:28:12.613873 140597279315712 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:28:12.892062 140597279315712 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:28:13.266542 140597287708416 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:28:13.592550 140598328038848 evaluation.py:167] Evaluation [10/10]
I0811 20:28:13.592926 140598328038848 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:28:13.593003 140598328038848 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:28:13.593177 140597296101120 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:28:13.593281 140597296101120 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:28:13.593419 140598328038848 error_handling.py:96] infeed marked as finished
I0811 20:28:13.593511 140598328038848 tpu_estimator.py:602] Stop output thread controller
I0811 20:28:13.593558 140598328038848 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:28:13.593733 140597287708416 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:28:13.593815 140597287708416 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:28:13.593930 140598328038848 error_handling.py:96] outfeed marked as finished
I0811 20:28:13.594012 140598328038848 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:28:42.986517 140598328038848 evaluation.py:275] Finished evaluation at 2019-08-11-20:28:42
I0811 20:28:42.986845 140598328038848 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9665, global_step = 30, loss = 0.1311866
I0811 20:28:47.394705 140598328038848 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:28:48.225788 140598328038848 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.1311866, 'global_step': 30, 'accuracy': 0.9665}

Removing gs://yangyou-mnist/log/checkpoint#1565555264194856...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565555228141618...
Removing gs://yangyou-mnist/log/#1565555215838080...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565555232609051...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565555260973609...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565555216.v3-8-tpu#1565555267373104...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565555220472017...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565555261840135...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565555227234530...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565555266414549...
Removing gs://yangyou-mnist/log/eval/#1565555324619475...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565555324.v3-8-tpu#1565555327891531...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:28:52.031833 140018749011392 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:28:52.032628 140018749011392 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:28:52.035299 140018749011392 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:28:52.036086 140018749011392 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:28:52.036648 140018749011392 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:28:52.036773 140018749011392 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:28:52.432192 140018749011392 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:28:52.438757 140018749011392 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:28:52.442317 140018749011392 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:28:52.489994 140018749011392 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:28:52.490288 140018749011392 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:28:52.595717 140018749011392 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:28:52.643378 140018749011392 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:28:52.643663 140018749011392 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:28:52.751415 140018749011392 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5881f55110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5884133190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:28:52.751823 140018749011392 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:28:53.077680 140018749011392 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:28:53.080547: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:28:53.092117 140018749011392 tpu_system_metadata.py:148] Found TPU system:
I0811 20:28:53.092360 140018749011392 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:28:53.092866 140018749011392 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:28:53.092925 140018749011392 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:28:53.092977 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:28:53.093270 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:28:53.093332 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:28:53.093389 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:28:53.093439 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:28:53.093486 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:28:53.093539 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:28:53.093625 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:28:53.093693 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:28:53.093741 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:28:53.093790 140018749011392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:28:53.099917 140018749011392 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:28:53.112438 140018749011392 estimator.py:1145] Calling model_fn.
W0811 20:28:53.113054 140018749011392 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:28:53.385958 140018749011392 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:28:53.824244 140018749011392 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:28:53.885298 140018749011392 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:28:53.891223 140018749011392 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:28:54.070116 140018749011392 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:28:54.083647 140018749011392 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:28:54.095498 140018749011392 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:28:54.095805 140018749011392 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:28:54.524135 140018749011392 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:28:54.540024 140018749011392 estimator.py:1147] Done calling model_fn.
I0811 20:28:57.910840 140018749011392 tpu_estimator.py:499] TPU job name worker
I0811 20:28:58.024791 140018749011392 monitored_session.py:240] Graph was finalized.
I0811 20:28:58.593215 140018749011392 session_manager.py:500] Running local_init_op.
I0811 20:28:58.632916 140018749011392 session_manager.py:502] Done running local_init_op.
I0811 20:29:01.199227 140018749011392 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:29:13.390149 140018749011392 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:29:13.510467 140018749011392 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:29:13.510994 140018749011392 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:29:13.511414: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:29:13.516916 140018749011392 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:29:13.519231 140018749011392 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:29:13.523036 140018749011392 tpu_estimator.py:557] Init TPU system
I0811 20:29:25.549913 140018749011392 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:29:25.550852 140017854826240 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:29:25.551441 140017846433536 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:29:25.594506 140018749011392 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:29:25.595362 140018749011392 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:29:25.605856 140017838040832 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:29:25.711114 140017838040832 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:29:30.121273 140017846433536 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:29:34.607072 140018749011392 basic_session_run_hooks.py:262] loss = 0.110575594, step = 30
I0811 20:29:34.609278 140018749011392 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:29:48.579416 140018749011392 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:29:48.579766 140018749011392 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:29:48.580097 140017854826240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:29:48.580411 140017854826240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:29:48.580619 140018749011392 error_handling.py:96] infeed marked as finished
I0811 20:29:48.580879 140018749011392 tpu_estimator.py:602] Stop output thread controller
I0811 20:29:48.580949 140018749011392 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:29:48.581151 140017846433536 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:29:48.581336 140017846433536 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:29:48.581795 140018749011392 error_handling.py:96] outfeed marked as finished
I0811 20:29:48.581983 140018749011392 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:29:55.837524 140018749011392 estimator.py:368] Loss for final step: 0.110575594.
I0811 20:29:55.838438 140018749011392 error_handling.py:96] training_loop marked as finished
I0811 20:29:56.536725 140018749011392 estimator.py:1145] Calling model_fn.
E0811 20:29:57.215950 140018749011392 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:29:57.419778 140018749011392 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:29:57.448014 140018749011392 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:29:57.469959 140018749011392 estimator.py:1147] Done calling model_fn.
I0811 20:29:57.488271 140018749011392 evaluation.py:255] Starting evaluation at 2019-08-11T20:29:57Z
I0811 20:29:57.488523 140018749011392 tpu_estimator.py:499] TPU job name worker
I0811 20:29:57.565660 140018749011392 monitored_session.py:240] Graph was finalized.
W0811 20:29:57.566442 140018749011392 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:29:57.746087 140018749011392 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:30:00.327373 140018749011392 session_manager.py:500] Running local_init_op.
I0811 20:30:00.350899 140018749011392 session_manager.py:502] Done running local_init_op.
I0811 20:30:00.405901 140018749011392 tpu_estimator.py:557] Init TPU system
I0811 20:30:12.346726 140018749011392 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:30:12.347707 140017842763520 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:30:12.348479 140017834370816 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:30:12.416203 140018749011392 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:30:12.441139 140018749011392 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:30:12.441499 140018749011392 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:30:12.469754 140017825978112 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:30:12.746653 140017825978112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:30:13.184578 140017834370816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:30:13.493725 140018749011392 evaluation.py:167] Evaluation [10/10]
I0811 20:30:13.494072 140018749011392 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:30:13.494151 140018749011392 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:30:13.494501 140017842763520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:30:13.494776 140017842763520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:30:13.494993 140018749011392 error_handling.py:96] infeed marked as finished
I0811 20:30:13.495182 140018749011392 tpu_estimator.py:602] Stop output thread controller
I0811 20:30:13.495242 140018749011392 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:30:13.495445 140017834370816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:30:13.495584 140017834370816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:30:13.495770 140018749011392 error_handling.py:96] outfeed marked as finished
I0811 20:30:13.495912 140018749011392 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:30:42.846321 140018749011392 evaluation.py:275] Finished evaluation at 2019-08-11-20:30:42
I0811 20:30:42.846652 140018749011392 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9742, global_step = 30, loss = 0.09332553
I0811 20:30:47.143688 140018749011392 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:30:47.925941 140018749011392 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09332553, 'global_step': 30, 'accuracy': 0.9742}

Removing gs://yangyou-mnist/log/#1565555335967440...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565555336.v3-8-tpu#1565555388245393...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565555340651407...
Removing gs://yangyou-mnist/log/checkpoint#1565555385161127...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565555348450357...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565555347622852...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565555352881511...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565555382035072...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565555382893767...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565555387351536...
Removing gs://yangyou-mnist/log/eval/#1565555444499894...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565555444.v3-8-tpu#1565555447592687...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:30:51.721189 139933831357888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:30:51.722150 139933831357888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:30:51.724858 139933831357888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:30:51.725797 139933831357888 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:30:51.726421 139933831357888 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:30:51.726653 139933831357888 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:30:52.121074 139933831357888 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:30:52.127918 139933831357888 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:30:52.131654 139933831357888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:30:52.181176 139933831357888 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:30:52.181468 139933831357888 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:30:52.374963 139933831357888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:30:52.423747 139933831357888 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:30:52.424062 139933831357888 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:30:52.543708 139933831357888 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f44bc78c210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f44be96a190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:30:52.544111 139933831357888 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:30:52.862195 139933831357888 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:30:52.865165: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:30:52.878184 139933831357888 tpu_system_metadata.py:148] Found TPU system:
I0811 20:30:52.878463 139933831357888 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:30:52.878966 139933831357888 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:30:52.879021 139933831357888 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:30:52.879074 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:30:52.879368 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:30:52.879424 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:30:52.879475 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:30:52.879523 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:30:52.879570 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:30:52.879616 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:30:52.879663 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:30:52.879709 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:30:52.879757 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:30:52.879805 139933831357888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:30:52.885879 139933831357888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:30:52.898294 139933831357888 estimator.py:1145] Calling model_fn.
W0811 20:30:52.898900 139933831357888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:30:53.166454 139933831357888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:30:53.591200 139933831357888 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:30:53.651150 139933831357888 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:30:53.656933 139933831357888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:30:53.830364 139933831357888 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:30:53.843811 139933831357888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:30:53.855469 139933831357888 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:30:53.855772 139933831357888 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:30:54.272742 139933831357888 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:30:54.288093 139933831357888 estimator.py:1147] Done calling model_fn.
I0811 20:30:57.490545 139933831357888 tpu_estimator.py:499] TPU job name worker
I0811 20:30:57.603620 139933831357888 monitored_session.py:240] Graph was finalized.
I0811 20:30:58.190862 139933831357888 session_manager.py:500] Running local_init_op.
I0811 20:30:58.225384 139933831357888 session_manager.py:502] Done running local_init_op.
I0811 20:31:00.589764 139933831357888 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:31:12.704251 139933831357888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:31:12.818334 139933831357888 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:31:12.818850 139933831357888 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:31:12.819287: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:31:12.823544 139933831357888 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:31:12.825608 139933831357888 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:31:12.830070 139933831357888 tpu_estimator.py:557] Init TPU system
I0811 20:31:24.990982 139933831357888 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:31:24.991828 139933063550720 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:31:24.992352 139932584638208 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:31:25.035957 139933831357888 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:31:25.036825 139933831357888 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:31:25.136051 139932576245504 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:31:25.259629 139932576245504 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:31:29.535784 139932584638208 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:31:33.908353 139933831357888 basic_session_run_hooks.py:262] loss = 0.20474158, step = 30
I0811 20:31:33.910273 139933831357888 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:31:47.745660 139933831357888 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:31:47.745987 139933831357888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:31:47.746296 139933063550720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:31:47.746613 139933063550720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:31:47.746912 139933831357888 error_handling.py:96] infeed marked as finished
I0811 20:31:47.747159 139933831357888 tpu_estimator.py:602] Stop output thread controller
I0811 20:31:47.747225 139933831357888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:31:47.747400 139932584638208 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:31:47.747574 139932584638208 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:31:47.747735 139933831357888 error_handling.py:96] outfeed marked as finished
I0811 20:31:47.747876 139933831357888 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:31:55.394246 139933831357888 estimator.py:368] Loss for final step: 0.20474158.
I0811 20:31:55.395080 139933831357888 error_handling.py:96] training_loop marked as finished
I0811 20:31:56.090501 139933831357888 estimator.py:1145] Calling model_fn.
E0811 20:31:56.761265 139933831357888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:31:56.951273 139933831357888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:31:56.978549 139933831357888 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:31:56.999283 139933831357888 estimator.py:1147] Done calling model_fn.
I0811 20:31:57.015819 139933831357888 evaluation.py:255] Starting evaluation at 2019-08-11T20:31:57Z
I0811 20:31:57.016050 139933831357888 tpu_estimator.py:499] TPU job name worker
I0811 20:31:57.095433 139933831357888 monitored_session.py:240] Graph was finalized.
W0811 20:31:57.096224 139933831357888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:31:57.310352 139933831357888 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:31:59.677377 139933831357888 session_manager.py:500] Running local_init_op.
I0811 20:31:59.713228 139933831357888 session_manager.py:502] Done running local_init_op.
I0811 20:31:59.765959 139933831357888 tpu_estimator.py:557] Init TPU system
I0811 20:32:12.076643 139933831357888 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:32:12.077652 139933068011264 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:32:12.078412 139932584638208 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:32:12.144224 139933831357888 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:32:12.168339 139933831357888 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:32:12.168760 139933831357888 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:32:12.193232 139932576245504 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:32:12.388082 139932576245504 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:32:12.900913 139932584638208 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:32:13.203421 139933831357888 evaluation.py:167] Evaluation [10/10]
I0811 20:32:13.203839 139933831357888 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:32:13.203916 139933831357888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:32:13.204188 139933068011264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:32:13.204500 139933068011264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:32:13.204726 139933831357888 error_handling.py:96] infeed marked as finished
I0811 20:32:13.204883 139933831357888 tpu_estimator.py:602] Stop output thread controller
I0811 20:32:13.204941 139933831357888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:32:13.205096 139932584638208 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:32:13.205284 139932584638208 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:32:13.205466 139933831357888 error_handling.py:96] outfeed marked as finished
I0811 20:32:13.205621 139933831357888 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:32:42.484810 139933831357888 evaluation.py:275] Finished evaluation at 2019-08-11-20:32:42
I0811 20:32:42.485188 139933831357888 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9484, global_step = 30, loss = 0.16105476
I0811 20:32:46.708964 139933831357888 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:32:47.585381 139933831357888 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.16105476, 'global_step': 30, 'accuracy': 0.9484}

Removing gs://yangyou-mnist/log/#1565555455732983...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565555467905015...
Removing gs://yangyou-mnist/log/checkpoint#1565555504166277...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565555455.v3-8-tpu#1565555507410510...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565555472189297...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565555501391923...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565555460032994...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565555500510943...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565555467038964...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565555506390436...
Removing gs://yangyou-mnist/log/eval/#1565555564132304...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565555564.v3-8-tpu#1565555567243773...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:32:51.258985 139767495308736 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:32:51.259758 139767495308736 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:32:51.262356 139767495308736 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:32:51.263164 139767495308736 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:32:51.263757 139767495308736 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:32:51.263885 139767495308736 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:32:51.658842 139767495308736 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:32:51.666021 139767495308736 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:32:51.669816 139767495308736 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:32:51.762866 139767495308736 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:32:51.763160 139767495308736 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:32:51.926882 139767495308736 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:32:51.972733 139767495308736 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:32:51.973033 139767495308736 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:32:52.175854 139767495308736 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1e021211d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1e042ff190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:32:52.176234 139767495308736 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:32:52.534682 139767495308736 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:32:52.537621: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:32:52.549009 139767495308736 tpu_system_metadata.py:148] Found TPU system:
I0811 20:32:52.549237 139767495308736 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:32:52.549877 139767495308736 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:32:52.549937 139767495308736 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:32:52.549994 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:32:52.550312 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:32:52.550369 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:32:52.550419 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:32:52.550467 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:32:52.550514 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:32:52.550570 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:32:52.550620 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:32:52.550666 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:32:52.550710 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:32:52.550757 139767495308736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:32:52.556725 139767495308736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:32:52.568985 139767495308736 estimator.py:1145] Calling model_fn.
W0811 20:32:52.569626 139767495308736 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:32:52.838941 139767495308736 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:32:53.249340 139767495308736 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:32:53.310076 139767495308736 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:32:53.315949 139767495308736 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:32:53.490808 139767495308736 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:32:53.504262 139767495308736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:32:53.516067 139767495308736 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:32:53.516376 139767495308736 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:32:53.933198 139767495308736 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:32:53.948672 139767495308736 estimator.py:1147] Done calling model_fn.
I0811 20:32:57.223606 139767495308736 tpu_estimator.py:499] TPU job name worker
I0811 20:32:57.339576 139767495308736 monitored_session.py:240] Graph was finalized.
I0811 20:32:57.917784 139767495308736 session_manager.py:500] Running local_init_op.
I0811 20:32:57.956475 139767495308736 session_manager.py:502] Done running local_init_op.
I0811 20:33:00.474428 139767495308736 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:33:12.562553 139767495308736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:33:12.665213 139767495308736 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:33:12.665693 139767495308736 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:33:12.666157: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:33:12.670777 139767495308736 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:33:12.672900 139767495308736 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:33:12.677145 139767495308736 tpu_estimator.py:557] Init TPU system
I0811 20:33:24.867840 139767495308736 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:33:24.868880 139766593210112 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:33:24.869772 139766584817408 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:33:24.913645 139767495308736 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:33:24.914570 139767495308736 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:33:24.924792 139766576424704 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:33:25.060050 139766576424704 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:33:29.559603 139766584817408 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:33:34.087078 139767495308736 basic_session_run_hooks.py:262] loss = 2.305932, step = 30
I0811 20:33:34.088973 139767495308736 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:33:47.567517 139767495308736 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:33:47.567802 139767495308736 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:33:47.568115 139766593210112 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:33:47.568403 139766593210112 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:33:47.568593 139767495308736 error_handling.py:96] infeed marked as finished
I0811 20:33:47.568773 139767495308736 tpu_estimator.py:602] Stop output thread controller
I0811 20:33:47.568828 139767495308736 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:33:47.568978 139766584817408 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:33:47.569137 139766584817408 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:33:47.569308 139767495308736 error_handling.py:96] outfeed marked as finished
I0811 20:33:47.569417 139767495308736 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:33:55.191848 139767495308736 estimator.py:368] Loss for final step: 2.305932.
I0811 20:33:55.192703 139767495308736 error_handling.py:96] training_loop marked as finished
I0811 20:33:55.904586 139767495308736 estimator.py:1145] Calling model_fn.
E0811 20:33:56.597721 139767495308736 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:33:56.789303 139767495308736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:33:56.816591 139767495308736 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:33:56.837883 139767495308736 estimator.py:1147] Done calling model_fn.
I0811 20:33:56.855092 139767495308736 evaluation.py:255] Starting evaluation at 2019-08-11T20:33:56Z
I0811 20:33:56.855348 139767495308736 tpu_estimator.py:499] TPU job name worker
I0811 20:33:56.930210 139767495308736 monitored_session.py:240] Graph was finalized.
W0811 20:33:56.930944 139767495308736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:33:57.114155 139767495308736 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:33:59.555537 139767495308736 session_manager.py:500] Running local_init_op.
I0811 20:33:59.578280 139767495308736 session_manager.py:502] Done running local_init_op.
I0811 20:33:59.631143 139767495308736 tpu_estimator.py:557] Init TPU system
I0811 20:34:11.655023 139767495308736 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:34:11.655812 139766593210112 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:34:11.656562 139766584817408 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:34:11.735831 139767495308736 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:34:11.760044 139767495308736 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:34:11.760369 139767495308736 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:34:11.790477 139766576424704 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:34:11.895459 139766576424704 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:34:12.485960 139766584817408 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:34:12.910216 139767495308736 evaluation.py:167] Evaluation [10/10]
I0811 20:34:12.910542 139767495308736 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:34:12.910667 139767495308736 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:34:12.910854 139766593210112 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:34:12.910949 139766593210112 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:34:12.911087 139767495308736 error_handling.py:96] infeed marked as finished
I0811 20:34:12.911180 139767495308736 tpu_estimator.py:602] Stop output thread controller
I0811 20:34:12.911227 139767495308736 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:34:12.911336 139766584817408 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:34:12.911406 139766584817408 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:34:12.911521 139767495308736 error_handling.py:96] outfeed marked as finished
I0811 20:34:12.911607 139767495308736 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:34:41.989764 139767495308736 evaluation.py:275] Finished evaluation at 2019-08-11-20:34:41
I0811 20:34:41.990094 139767495308736 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 2.299771
I0811 20:34:46.329200 139767495308736 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:34:47.131031 139767495308736 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.299771, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/#1565555575378327...
Removing gs://yangyou-mnist/log/checkpoint#1565555624116776...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565555587732815...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565555575.v3-8-tpu#1565555627233907...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565555592039444...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565555620931603...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565555579913491...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565555586838277...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565555621835927...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565555626334092...
Removing gs://yangyou-mnist/log/eval/#1565555683656317...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565555683.v3-8-tpu#1565555686787510...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:34:50.802340 139832513553856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:34:50.803095 139832513553856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:34:50.805727 139832513553856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:34:50.806526 139832513553856 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:34:50.807075 139832513553856 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:34:50.807197 139832513553856 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:34:51.203675 139832513553856 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:34:51.212371 139832513553856 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:34:51.217005 139832513553856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:34:51.265187 139832513553856 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:34:51.265491 139832513553856 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:34:51.398797 139832513553856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:34:51.449008 139832513553856 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:34:51.449299 139832513553856 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:34:51.679627 139832513553856 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2d2575c110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2d2793a190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:34:51.680012 139832513553856 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:34:51.993733 139832513553856 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:34:51.996671: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:34:52.009303 139832513553856 tpu_system_metadata.py:148] Found TPU system:
I0811 20:34:52.009546 139832513553856 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:34:52.010163 139832513553856 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:34:52.010236 139832513553856 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:34:52.010298 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:34:52.010596 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:34:52.010658 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:34:52.010715 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:34:52.010762 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:34:52.010809 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:34:52.010857 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:34:52.010902 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:34:52.010946 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:34:52.010992 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:34:52.011039 139832513553856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:34:52.017187 139832513553856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:34:52.029697 139832513553856 estimator.py:1145] Calling model_fn.
W0811 20:34:52.030318 139832513553856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:34:52.300071 139832513553856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:34:52.813111 139832513553856 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:34:52.874726 139832513553856 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:34:52.880953 139832513553856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:34:53.058182 139832513553856 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:34:53.071614 139832513553856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:34:53.083484 139832513553856 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:34:53.083811 139832513553856 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:34:53.503137 139832513553856 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:34:53.518318 139832513553856 estimator.py:1147] Done calling model_fn.
I0811 20:34:56.946974 139832513553856 tpu_estimator.py:499] TPU job name worker
I0811 20:34:57.058707 139832513553856 monitored_session.py:240] Graph was finalized.
I0811 20:34:57.656176 139832513553856 session_manager.py:500] Running local_init_op.
I0811 20:34:57.696402 139832513553856 session_manager.py:502] Done running local_init_op.
I0811 20:35:00.270709 139832513553856 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:35:12.581065 139832513553856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:35:12.685163 139832513553856 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:35:12.685682 139832513553856 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:35:12.686101: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:35:12.690654 139832513553856 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:35:12.692787 139832513553856 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:35:12.697637 139832513553856 tpu_estimator.py:557] Init TPU system
I0811 20:35:24.963532 139832513553856 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:35:24.964411 139831753553664 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:35:24.965130 139831745160960 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:35:25.008996 139832513553856 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:35:25.009874 139832513553856 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:35:25.019943 139831736768256 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:35:25.126784 139831736768256 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:35:29.370870 139831745160960 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:35:33.641670 139832513553856 basic_session_run_hooks.py:262] loss = 2.3027403, step = 30
I0811 20:35:33.644459 139832513553856 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:35:46.738353 139832513553856 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:35:46.738687 139832513553856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:35:46.739011 139831753553664 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:35:46.739303 139831753553664 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:35:46.739501 139832513553856 error_handling.py:96] infeed marked as finished
I0811 20:35:46.739701 139832513553856 tpu_estimator.py:602] Stop output thread controller
I0811 20:35:46.739754 139832513553856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:35:46.739907 139831745160960 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:35:46.740056 139831745160960 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:35:46.740226 139832513553856 error_handling.py:96] outfeed marked as finished
I0811 20:35:46.740371 139832513553856 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:35:55.253474 139832513553856 estimator.py:368] Loss for final step: 2.3027403.
I0811 20:35:55.254381 139832513553856 error_handling.py:96] training_loop marked as finished
I0811 20:35:55.956172 139832513553856 estimator.py:1145] Calling model_fn.
E0811 20:35:56.726329 139832513553856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:35:56.922547 139832513553856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:35:56.950155 139832513553856 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:35:56.971784 139832513553856 estimator.py:1147] Done calling model_fn.
I0811 20:35:56.989476 139832513553856 evaluation.py:255] Starting evaluation at 2019-08-11T20:35:56Z
I0811 20:35:56.989769 139832513553856 tpu_estimator.py:499] TPU job name worker
I0811 20:35:57.066168 139832513553856 monitored_session.py:240] Graph was finalized.
W0811 20:35:57.066922 139832513553856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:35:57.248452 139832513553856 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:35:59.806725 139832513553856 session_manager.py:500] Running local_init_op.
I0811 20:35:59.829945 139832513553856 session_manager.py:502] Done running local_init_op.
I0811 20:35:59.881228 139832513553856 tpu_estimator.py:557] Init TPU system
I0811 20:36:11.960680 139832513553856 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:36:11.961529 139831749883648 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:36:11.962042 139831741490944 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:36:12.027295 139832513553856 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:36:12.051295 139832513553856 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:36:12.051692 139832513553856 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:36:12.084269 139831733098240 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:36:12.231702 139831733098240 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:36:12.796780 139831741490944 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:36:13.098804 139832513553856 evaluation.py:167] Evaluation [10/10]
I0811 20:36:13.099194 139832513553856 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:36:13.099299 139832513553856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:36:13.099503 139831749883648 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:36:13.099608 139831749883648 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:36:13.099757 139832513553856 error_handling.py:96] infeed marked as finished
I0811 20:36:13.099853 139832513553856 tpu_estimator.py:602] Stop output thread controller
I0811 20:36:13.099906 139832513553856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:36:13.100029 139831741490944 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:36:13.100107 139831741490944 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:36:13.100233 139832513553856 error_handling.py:96] outfeed marked as finished
I0811 20:36:13.100317 139832513553856 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:36:42.326715 139832513553856 evaluation.py:275] Finished evaluation at 2019-08-11-20:36:42
I0811 20:36:42.327063 139832513553856 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3003793
I0811 20:36:47.527601 139832513553856 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:36:48.330185 139832513553856 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3003793, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565555707691715...
Removing gs://yangyou-mnist/log/#1565555695001983...
Removing gs://yangyou-mnist/log/checkpoint#1565555743297373...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565555712060161...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565555695.v3-8-tpu#1565555746398654...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565555699705324...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565555706869889...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565555741200471...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565555740224752...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565555745433719...
Removing gs://yangyou-mnist/log/eval/#1565555804776878...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565555804.v3-8-tpu#1565555807996617...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:36:52.103600 140013213930944 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:36:52.104429 140013213930944 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:36:52.107178 140013213930944 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:36:52.108055 140013213930944 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:36:52.108784 140013213930944 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:36:52.108923 140013213930944 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:36:52.530786 140013213930944 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:36:52.538882 140013213930944 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:36:52.542928 140013213930944 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:36:52.593173 140013213930944 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:36:52.593451 140013213930944 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:36:52.697961 140013213930944 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:36:52.741238 140013213930944 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:36:52.741514 140013213930944 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:36:52.860743 140013213930944 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f57380ab110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f573a289190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:36:52.861100 140013213930944 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:36:53.231890 140013213930944 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:36:53.235026: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:36:53.247299 140013213930944 tpu_system_metadata.py:148] Found TPU system:
I0811 20:36:53.247567 140013213930944 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:36:53.248115 140013213930944 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:36:53.248178 140013213930944 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:36:53.248234 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:36:53.248550 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:36:53.248613 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:36:53.248663 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:36:53.248713 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:36:53.248761 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:36:53.248811 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:36:53.248861 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:36:53.248908 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:36:53.248966 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:36:53.249020 140013213930944 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:36:53.255240 140013213930944 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:36:53.267693 140013213930944 estimator.py:1145] Calling model_fn.
W0811 20:36:53.268301 140013213930944 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:36:53.537034 140013213930944 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:36:53.948585 140013213930944 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:36:54.010235 140013213930944 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:36:54.016004 140013213930944 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:36:54.196862 140013213930944 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:36:54.210807 140013213930944 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:36:54.223299 140013213930944 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:36:54.223628 140013213930944 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:36:54.650419 140013213930944 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:36:54.665817 140013213930944 estimator.py:1147] Done calling model_fn.
I0811 20:36:58.027168 140013213930944 tpu_estimator.py:499] TPU job name worker
I0811 20:36:58.141160 140013213930944 monitored_session.py:240] Graph was finalized.
I0811 20:36:58.697551 140013213930944 session_manager.py:500] Running local_init_op.
I0811 20:36:58.736624 140013213930944 session_manager.py:502] Done running local_init_op.
I0811 20:37:01.461822 140013213930944 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:37:13.692027 140013213930944 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:37:13.812870 140013213930944 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:37:13.813335 140013213930944 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:37:13.813794: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:37:13.818730 140013213930944 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:37:13.820949 140013213930944 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:37:13.824827 140013213930944 tpu_estimator.py:557] Init TPU system
I0811 20:37:25.575577 140013213930944 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:37:25.576524 140012521780992 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:37:25.577327 140012041533184 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:37:25.620400 140013213930944 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:37:25.621223 140013213930944 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:37:25.686096 140012033140480 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:37:25.931771 140012033140480 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:37:30.100608 140012041533184 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:37:34.663372 140013213930944 basic_session_run_hooks.py:262] loss = 1.9209857, step = 30
I0811 20:37:34.665465 140013213930944 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:37:47.558670 140013213930944 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:37:47.558981 140013213930944 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:37:47.559180 140012521780992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:37:47.559278 140012521780992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:37:47.559448 140013213930944 error_handling.py:96] infeed marked as finished
I0811 20:37:47.559556 140013213930944 tpu_estimator.py:602] Stop output thread controller
I0811 20:37:47.559603 140013213930944 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:37:47.559714 140012041533184 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:37:47.559786 140012041533184 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:37:47.559901 140013213930944 error_handling.py:96] outfeed marked as finished
I0811 20:37:47.559987 140013213930944 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:37:56.062014 140013213930944 estimator.py:368] Loss for final step: 1.9209857.
I0811 20:37:56.062858 140013213930944 error_handling.py:96] training_loop marked as finished
I0811 20:37:56.767494 140013213930944 estimator.py:1145] Calling model_fn.
E0811 20:37:57.456371 140013213930944 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:37:57.651989 140013213930944 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:37:57.679476 140013213930944 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:37:57.700763 140013213930944 estimator.py:1147] Done calling model_fn.
I0811 20:37:57.717463 140013213930944 evaluation.py:255] Starting evaluation at 2019-08-11T20:37:57Z
I0811 20:37:57.717767 140013213930944 tpu_estimator.py:499] TPU job name worker
I0811 20:37:57.791692 140013213930944 monitored_session.py:240] Graph was finalized.
W0811 20:37:57.792460 140013213930944 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:37:58.030323 140013213930944 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:38:00.646365 140013213930944 session_manager.py:500] Running local_init_op.
I0811 20:38:00.670494 140013213930944 session_manager.py:502] Done running local_init_op.
I0811 20:38:00.740039 140013213930944 tpu_estimator.py:557] Init TPU system
I0811 20:38:12.577399 140013213930944 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:38:12.578305 140012041533184 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:38:12.578844 140012033140480 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:38:12.643274 140013213930944 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:38:12.671019 140013213930944 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:38:12.671391 140013213930944 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:38:12.699054 140012024747776 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:38:12.841058 140012024747776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:38:13.408334 140012033140480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:38:13.742460 140013213930944 evaluation.py:167] Evaluation [10/10]
I0811 20:38:13.742850 140013213930944 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:38:13.742928 140013213930944 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:38:13.743096 140012041533184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:38:13.743196 140012041533184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:38:13.743360 140013213930944 error_handling.py:96] infeed marked as finished
I0811 20:38:13.743453 140013213930944 tpu_estimator.py:602] Stop output thread controller
I0811 20:38:13.743516 140013213930944 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:38:13.743626 140012033140480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:38:13.743700 140012033140480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:38:13.743818 140013213930944 error_handling.py:96] outfeed marked as finished
I0811 20:38:13.743899 140013213930944 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:38:42.935327 140013213930944 evaluation.py:275] Finished evaluation at 2019-08-11-20:38:42
I0811 20:38:42.935667 140013213930944 estimator.py:2039] Saving dict for global step 30: accuracy = 0.3381, global_step = 30, loss = 1.7947509
I0811 20:38:47.278515 140013213930944 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:38:48.150943 140013213930944 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.7947509, 'global_step': 30, 'accuracy': 0.3381}

Removing gs://yangyou-mnist/log/#1565555816079080...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565555828854773...
Removing gs://yangyou-mnist/log/checkpoint#1565555864150950...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565555816.v3-8-tpu#1565555867217231...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565555833176788...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565555861235212...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565555820900829...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565555862112927...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565555827958871...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565555866293891...
Removing gs://yangyou-mnist/log/eval/#1565555924714224...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565555924.v3-8-tpu#1565555927801695...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:38:52.003817 139858914055616 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:38:52.004601 139858914055616 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:38:52.007163 139858914055616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:38:52.007982 139858914055616 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:38:52.008575 139858914055616 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:38:52.008719 139858914055616 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:38:52.425471 139858914055616 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:38:52.432216 139858914055616 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:38:52.436002 139858914055616 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:38:52.532402 139858914055616 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:38:52.532706 139858914055616 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:38:52.636985 139858914055616 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:38:52.686773 139858914055616 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:38:52.687067 139858914055616 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:38:52.835190 139858914055616 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f334b0d7150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f334d2b5150>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:38:52.835561 139858914055616 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:38:53.154963 139858914055616 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:38:53.158105: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:38:53.172049 139858914055616 tpu_system_metadata.py:148] Found TPU system:
I0811 20:38:53.172363 139858914055616 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:38:53.173218 139858914055616 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:38:53.173316 139858914055616 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:38:53.173401 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:38:53.174068 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:38:53.174185 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:38:53.174278 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:38:53.174377 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:38:53.174469 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:38:53.174559 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:38:53.174638 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:38:53.174726 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:38:53.174808 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:38:53.174894 139858914055616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:38:53.189421 139858914055616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:38:53.203557 139858914055616 estimator.py:1145] Calling model_fn.
W0811 20:38:53.204196 139858914055616 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:38:53.471963 139858914055616 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:38:53.989070 139858914055616 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:38:54.051651 139858914055616 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:38:54.057854 139858914055616 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:38:54.240930 139858914055616 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:38:54.254869 139858914055616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:38:54.267036 139858914055616 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:38:54.267365 139858914055616 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:38:54.695664 139858914055616 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:38:54.711163 139858914055616 estimator.py:1147] Done calling model_fn.
I0811 20:38:58.193578 139858914055616 tpu_estimator.py:499] TPU job name worker
I0811 20:38:58.308213 139858914055616 monitored_session.py:240] Graph was finalized.
I0811 20:38:58.882004 139858914055616 session_manager.py:500] Running local_init_op.
I0811 20:38:58.912244 139858914055616 session_manager.py:502] Done running local_init_op.
I0811 20:39:01.403681 139858914055616 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:39:13.539535 139858914055616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:39:13.640990 139858914055616 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:39:13.641501 139858914055616 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:39:13.641958: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:39:13.646658 139858914055616 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:39:13.648766 139858914055616 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:39:13.652789 139858914055616 tpu_estimator.py:557] Init TPU system
I0811 20:39:25.672919 139858914055616 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:39:25.673810 139857884079872 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:39:25.674316 139857875687168 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:39:25.731036 139858914055616 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:39:25.731889 139858914055616 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:39:25.771262 139857867294464 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:39:25.916085 139857867294464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:39:30.241630 139857875687168 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:39:34.536814 139858914055616 basic_session_run_hooks.py:262] loss = 2.303968, step = 30
I0811 20:39:34.538944 139858914055616 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:39:48.230953 139858914055616 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:39:48.231251 139858914055616 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:39:48.231483 139857884079872 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:39:48.231611 139857884079872 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:39:48.231823 139858914055616 error_handling.py:96] infeed marked as finished
I0811 20:39:48.232033 139858914055616 tpu_estimator.py:602] Stop output thread controller
I0811 20:39:48.232095 139858914055616 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:39:48.232249 139857875687168 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:39:48.232409 139857875687168 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:39:48.232552 139858914055616 error_handling.py:96] outfeed marked as finished
I0811 20:39:48.232640 139858914055616 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:39:56.034478 139858914055616 estimator.py:368] Loss for final step: 2.303968.
I0811 20:39:56.035331 139858914055616 error_handling.py:96] training_loop marked as finished
I0811 20:39:56.721297 139858914055616 estimator.py:1145] Calling model_fn.
E0811 20:39:57.412420 139858914055616 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:39:57.612646 139858914055616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:39:57.641087 139858914055616 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:39:57.662951 139858914055616 estimator.py:1147] Done calling model_fn.
I0811 20:39:57.679981 139858914055616 evaluation.py:255] Starting evaluation at 2019-08-11T20:39:57Z
I0811 20:39:57.680233 139858914055616 tpu_estimator.py:499] TPU job name worker
I0811 20:39:57.756129 139858914055616 monitored_session.py:240] Graph was finalized.
W0811 20:39:57.756937 139858914055616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:39:57.944036 139858914055616 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:40:00.759459 139858914055616 session_manager.py:500] Running local_init_op.
I0811 20:40:00.783812 139858914055616 session_manager.py:502] Done running local_init_op.
I0811 20:40:00.834465 139858914055616 tpu_estimator.py:557] Init TPU system
I0811 20:40:12.898524 139858914055616 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:40:12.899400 139857881982720 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:40:12.899836 139857873590016 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:40:12.963658 139858914055616 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:40:12.991287 139858914055616 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:40:12.991646 139858914055616 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:40:13.018621 139857865197312 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:40:13.289493 139857865197312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:40:13.748887 139857873590016 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:40:14.053297 139858914055616 evaluation.py:167] Evaluation [10/10]
I0811 20:40:14.053683 139858914055616 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:40:14.053774 139858914055616 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:40:14.053957 139857881982720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:40:14.054064 139857881982720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:40:14.054215 139858914055616 error_handling.py:96] infeed marked as finished
I0811 20:40:14.054313 139858914055616 tpu_estimator.py:602] Stop output thread controller
I0811 20:40:14.054361 139858914055616 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:40:14.054481 139857873590016 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:40:14.054570 139857873590016 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:40:14.054688 139858914055616 error_handling.py:96] outfeed marked as finished
I0811 20:40:14.054769 139858914055616 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:40:43.388366 139858914055616 evaluation.py:275] Finished evaluation at 2019-08-11-20:40:43
I0811 20:40:43.388789 139858914055616 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1143, global_step = 30, loss = 2.3010375
I0811 20:40:47.751549 139858914055616 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:40:48.536084 139858914055616 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3010375, 'global_step': 30, 'accuracy': 0.1143}

Removing gs://yangyou-mnist/log/#1565555936132237...
Removing gs://yangyou-mnist/log/checkpoint#1565555984700563...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565555936.v3-8-tpu#1565555987892107...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565555947657010...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565555948697925...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565555940841795...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565555953036024...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565555981637396...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565555982511644...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565555986943858...
Removing gs://yangyou-mnist/log/eval/#1565556045069082...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565556045.v3-8-tpu#1565556048191984...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:40:52.390342 140620342224320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:40:52.391123 140620342224320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:40:52.393784 140620342224320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:40:52.394629 140620342224320 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:40:52.395216 140620342224320 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:40:52.395344 140620342224320 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:40:52.809858 140620342224320 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:40:52.816961 140620342224320 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:40:52.820633 140620342224320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:40:52.866916 140620342224320 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:40:52.867197 140620342224320 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:40:53.035617 140620342224320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:40:53.083376 140620342224320 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:40:53.083647 140620342224320 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:40:53.318276 140620342224320 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe493b3d290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe495d32190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:40:53.318639 140620342224320 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:40:53.647828 140620342224320 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:40:53.650969: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:40:53.663048 140620342224320 tpu_system_metadata.py:148] Found TPU system:
I0811 20:40:53.663291 140620342224320 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:40:53.663881 140620342224320 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:40:53.663943 140620342224320 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:40:53.663996 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:40:53.664285 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:40:53.664355 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:40:53.664421 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:40:53.664469 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:40:53.664518 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:40:53.664563 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:40:53.664613 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:40:53.664659 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:40:53.664704 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:40:53.664751 140620342224320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:40:53.671011 140620342224320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:40:53.683547 140620342224320 estimator.py:1145] Calling model_fn.
W0811 20:40:53.684166 140620342224320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:40:53.948683 140620342224320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:40:54.408032 140620342224320 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:40:54.469039 140620342224320 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:40:54.474627 140620342224320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:40:54.653176 140620342224320 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:40:54.666807 140620342224320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:40:54.678811 140620342224320 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:40:54.679236 140620342224320 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:40:55.097567 140620342224320 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:40:55.113188 140620342224320 estimator.py:1147] Done calling model_fn.
I0811 20:40:58.329786 140620342224320 tpu_estimator.py:499] TPU job name worker
I0811 20:40:58.444751 140620342224320 monitored_session.py:240] Graph was finalized.
I0811 20:40:59.007769 140620342224320 session_manager.py:500] Running local_init_op.
I0811 20:40:59.038430 140620342224320 session_manager.py:502] Done running local_init_op.
I0811 20:41:01.430073 140620342224320 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:41:13.676197 140620342224320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:41:13.800052 140620342224320 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:41:13.800594 140620342224320 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:41:13.801008: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:41:13.805891 140620342224320 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:41:13.808136 140620342224320 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:41:13.812253 140620342224320 tpu_estimator.py:557] Init TPU system
I0811 20:41:25.879762 140620342224320 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:41:25.880618 140619309643520 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:41:25.881520 140619301250816 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:41:25.922899 140620342224320 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:41:25.924005 140620342224320 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:41:25.934900 140619292858112 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:41:26.087495 140619292858112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:41:30.272993 140619301250816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:41:34.568878 140620342224320 basic_session_run_hooks.py:262] loss = 1.1669, step = 30
I0811 20:41:34.571111 140620342224320 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:41:47.768352 140620342224320 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:41:47.768661 140620342224320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:41:47.768909 140619309643520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:41:47.769022 140619309643520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:41:47.769165 140620342224320 error_handling.py:96] infeed marked as finished
I0811 20:41:47.769284 140620342224320 tpu_estimator.py:602] Stop output thread controller
I0811 20:41:47.769331 140620342224320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:41:47.769443 140619301250816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:41:47.769516 140619301250816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:41:47.769681 140620342224320 error_handling.py:96] outfeed marked as finished
I0811 20:41:47.769774 140620342224320 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:41:56.215199 140620342224320 estimator.py:368] Loss for final step: 1.1669.
I0811 20:41:56.216048 140620342224320 error_handling.py:96] training_loop marked as finished
I0811 20:41:57.025048 140620342224320 estimator.py:1145] Calling model_fn.
E0811 20:41:57.707866 140620342224320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:41:57.909110 140620342224320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:41:57.937051 140620342224320 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:41:57.960220 140620342224320 estimator.py:1147] Done calling model_fn.
I0811 20:41:57.979228 140620342224320 evaluation.py:255] Starting evaluation at 2019-08-11T20:41:57Z
I0811 20:41:57.979474 140620342224320 tpu_estimator.py:499] TPU job name worker
I0811 20:41:58.055682 140620342224320 monitored_session.py:240] Graph was finalized.
W0811 20:41:58.056498 140620342224320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:41:58.236814 140620342224320 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:42:00.646670 140620342224320 session_manager.py:500] Running local_init_op.
I0811 20:42:00.674220 140620342224320 session_manager.py:502] Done running local_init_op.
I0811 20:42:00.728406 140620342224320 tpu_estimator.py:557] Init TPU system
I0811 20:42:12.655601 140620342224320 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:42:12.656582 140619309643520 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:42:12.657308 140619301250816 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:42:12.726342 140620342224320 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:42:12.755132 140620342224320 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:42:12.755496 140620342224320 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:42:12.778810 140619292858112 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:42:12.923691 140619292858112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:42:13.490926 140619301250816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:42:13.779808 140620342224320 evaluation.py:167] Evaluation [10/10]
I0811 20:42:13.780144 140620342224320 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:42:13.780230 140620342224320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:42:13.780484 140619309643520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:42:13.780781 140619309643520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:42:13.781197 140620342224320 error_handling.py:96] infeed marked as finished
I0811 20:42:13.781374 140620342224320 tpu_estimator.py:602] Stop output thread controller
I0811 20:42:13.781426 140620342224320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:42:13.781562 140619301250816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:42:13.781713 140619301250816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:42:13.781862 140620342224320 error_handling.py:96] outfeed marked as finished
I0811 20:42:13.781946 140620342224320 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:42:43.019592 140620342224320 evaluation.py:275] Finished evaluation at 2019-08-11-20:42:43
I0811 20:42:43.019912 140620342224320 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8253, global_step = 30, loss = 1.0736076
I0811 20:42:47.387382 140620342224320 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:42:48.161320 140620342224320 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.0736076, 'global_step': 30, 'accuracy': 0.8253}

Removing gs://yangyou-mnist/log/#1565556056518835...
Removing gs://yangyou-mnist/log/checkpoint#1565556104214867...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565556073171292...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565556068675404...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565556101124895...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565556060871886...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565556101932320...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565556056.v3-8-tpu#1565556107436839...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565556067713221...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565556106326942...
Removing gs://yangyou-mnist/log/eval/#1565556164599497...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565556164.v3-8-tpu#1565556167822024...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:42:51.896471 140587030541760 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:42:51.897255 140587030541760 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:42:51.900350 140587030541760 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:42:51.901179 140587030541760 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:42:51.901952 140587030541760 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:42:51.902091 140587030541760 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:42:52.312571 140587030541760 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:42:52.319797 140587030541760 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:42:52.323859 140587030541760 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:42:52.364721 140587030541760 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:42:52.365020 140587030541760 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:42:52.472232 140587030541760 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:42:52.515158 140587030541760 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:42:52.515439 140587030541760 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:42:52.616736 140587030541760 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fdcd22d51d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fdcd44b3190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:42:52.617124 140587030541760 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:42:52.943886 140587030541760 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:42:52.946888: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:42:52.960328 140587030541760 tpu_system_metadata.py:148] Found TPU system:
I0811 20:42:52.960578 140587030541760 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:42:52.961162 140587030541760 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:42:52.961220 140587030541760 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:42:52.961276 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:42:52.961572 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:42:52.961688 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:42:52.961745 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:42:52.961807 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:42:52.961854 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:42:52.961903 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:42:52.961950 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:42:52.962007 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:42:52.962054 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:42:52.962102 140587030541760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:42:52.968091 140587030541760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:42:52.980299 140587030541760 estimator.py:1145] Calling model_fn.
W0811 20:42:52.980931 140587030541760 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:42:53.248868 140587030541760 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:42:53.673345 140587030541760 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:42:53.733994 140587030541760 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:42:53.739648 140587030541760 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:42:53.913893 140587030541760 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:42:53.927248 140587030541760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:42:53.938927 140587030541760 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:42:53.939254 140587030541760 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:42:54.360214 140587030541760 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:42:54.375581 140587030541760 estimator.py:1147] Done calling model_fn.
I0811 20:42:57.803725 140587030541760 tpu_estimator.py:499] TPU job name worker
I0811 20:42:57.917365 140587030541760 monitored_session.py:240] Graph was finalized.
I0811 20:42:58.467581 140587030541760 session_manager.py:500] Running local_init_op.
I0811 20:42:58.498668 140587030541760 session_manager.py:502] Done running local_init_op.
I0811 20:43:01.156354 140587030541760 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:43:14.008085 140587030541760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:43:14.122140 140587030541760 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:43:14.122657 140587030541760 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:43:14.123079: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:43:14.127753 140587030541760 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:43:14.129890 140587030541760 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:43:14.133260 140587030541760 tpu_estimator.py:557] Init TPU system
I0811 20:43:26.379112 140587030541760 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:43:26.379980 140586136884992 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:43:26.380974 140586128492288 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:43:26.423386 140587030541760 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:43:26.424268 140587030541760 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:43:26.438436 140586120099584 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:43:26.519248 140586120099584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:43:30.892488 140586128492288 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:43:35.407630 140587030541760 basic_session_run_hooks.py:262] loss = 0.4583892, step = 30
I0811 20:43:35.409965 140587030541760 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:43:48.399204 140587030541760 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:43:48.399509 140587030541760 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:43:48.399709 140586136884992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:43:48.399815 140586136884992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:43:48.399985 140587030541760 error_handling.py:96] infeed marked as finished
I0811 20:43:48.400088 140587030541760 tpu_estimator.py:602] Stop output thread controller
I0811 20:43:48.400136 140587030541760 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:43:48.400281 140586128492288 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:43:48.400367 140586128492288 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:43:48.400485 140587030541760 error_handling.py:96] outfeed marked as finished
I0811 20:43:48.400578 140587030541760 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:43:56.642704 140587030541760 estimator.py:368] Loss for final step: 0.4583892.
I0811 20:43:56.643650 140587030541760 error_handling.py:96] training_loop marked as finished
I0811 20:43:57.337460 140587030541760 estimator.py:1145] Calling model_fn.
E0811 20:43:58.080159 140587030541760 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:43:58.283771 140587030541760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:43:58.312128 140587030541760 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:43:58.334701 140587030541760 estimator.py:1147] Done calling model_fn.
I0811 20:43:58.354391 140587030541760 evaluation.py:255] Starting evaluation at 2019-08-11T20:43:58Z
I0811 20:43:58.354660 140587030541760 tpu_estimator.py:499] TPU job name worker
I0811 20:43:58.438858 140587030541760 monitored_session.py:240] Graph was finalized.
W0811 20:43:58.439670 140587030541760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:43:58.623553 140587030541760 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:44:01.138076 140587030541760 session_manager.py:500] Running local_init_op.
I0811 20:44:01.161936 140587030541760 session_manager.py:502] Done running local_init_op.
I0811 20:44:01.214432 140587030541760 tpu_estimator.py:557] Init TPU system
I0811 20:44:13.595438 140587030541760 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:44:13.596342 140586132952832 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:44:13.596865 140586124560128 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:44:13.663050 140587030541760 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:44:13.689910 140587030541760 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:44:13.690291 140587030541760 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:44:13.715450 140586111444736 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:44:13.862807 140586111444736 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:44:14.398777 140586124560128 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:44:14.755656 140587030541760 evaluation.py:167] Evaluation [10/10]
I0811 20:44:14.755992 140587030541760 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:44:14.756062 140587030541760 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:44:14.756237 140586132952832 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:44:14.756335 140586132952832 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:44:14.756469 140587030541760 error_handling.py:96] infeed marked as finished
I0811 20:44:14.756563 140587030541760 tpu_estimator.py:602] Stop output thread controller
I0811 20:44:14.756620 140587030541760 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:44:14.756732 140586124560128 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:44:14.756804 140586124560128 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:44:14.756916 140587030541760 error_handling.py:96] outfeed marked as finished
I0811 20:44:14.757000 140587030541760 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:44:43.959763 140587030541760 evaluation.py:275] Finished evaluation at 2019-08-11-20:44:43
I0811 20:44:43.960094 140587030541760 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8963, global_step = 30, loss = 0.43270785
I0811 20:44:48.090301 140587030541760 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:44:48.836205 140587030541760 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.43270785, 'global_step': 30, 'accuracy': 0.8963}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565556188952698...
Removing gs://yangyou-mnist/log/#1565556175900149...
Removing gs://yangyou-mnist/log/checkpoint#1565556224898750...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565556193501563...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565556176.v3-8-tpu#1565556228060244...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565556221793606...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565556180504463...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565556188075322...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565556222629277...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565556227044351...
Removing gs://yangyou-mnist/log/eval/#1565556285571076...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565556285.v3-8-tpu#1565556288503939...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:44:52.549252 140574728979904 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:44:52.550056 140574728979904 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:44:52.552640 140574728979904 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:44:52.553441 140574728979904 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:44:52.554219 140574728979904 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:44:52.554356 140574728979904 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:44:52.962407 140574728979904 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:44:52.969933 140574728979904 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:44:52.974296 140574728979904 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:44:53.021362 140574728979904 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:44:53.021672 140574728979904 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:44:53.133491 140574728979904 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:44:53.225413 140574728979904 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:44:53.225771 140574728979904 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:44:53.379049 140574728979904 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd9f4f26050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd9f7104190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:44:53.379425 140574728979904 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:44:53.700501 140574728979904 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:44:53.703441: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:44:53.714844 140574728979904 tpu_system_metadata.py:148] Found TPU system:
I0811 20:44:53.715086 140574728979904 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:44:53.715595 140574728979904 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:44:53.715652 140574728979904 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:44:53.715704 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:44:53.716053 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:44:53.716113 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:44:53.716164 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:44:53.716212 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:44:53.716259 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:44:53.716320 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:44:53.716371 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:44:53.716418 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:44:53.716464 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:44:53.716512 140574728979904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:44:53.722440 140574728979904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:44:53.734778 140574728979904 estimator.py:1145] Calling model_fn.
W0811 20:44:53.735397 140574728979904 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:44:54.005136 140574728979904 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:44:54.517363 140574728979904 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:44:54.578521 140574728979904 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:44:54.584198 140574728979904 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:44:54.757375 140574728979904 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:44:54.770891 140574728979904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:44:54.782726 140574728979904 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:44:54.783041 140574728979904 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:44:55.190462 140574728979904 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:44:55.206049 140574728979904 estimator.py:1147] Done calling model_fn.
I0811 20:44:58.497279 140574728979904 tpu_estimator.py:499] TPU job name worker
I0811 20:44:58.608071 140574728979904 monitored_session.py:240] Graph was finalized.
I0811 20:44:59.156459 140574728979904 session_manager.py:500] Running local_init_op.
I0811 20:44:59.186664 140574728979904 session_manager.py:502] Done running local_init_op.
I0811 20:45:01.698643 140574728979904 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:45:13.657305 140574728979904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:45:13.779515 140574728979904 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:45:13.780047 140574728979904 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:45:13.780459: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:45:13.785991 140574728979904 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:45:13.788162 140574728979904 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:45:13.792260 140574728979904 tpu_estimator.py:557] Init TPU system
I0811 20:45:26.353705 140574728979904 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:45:26.354751 140573969196800 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:45:26.355529 140573960804096 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:45:26.397929 140574728979904 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:45:26.398871 140574728979904 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:45:26.454006 140573474289408 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:45:26.689220 140573474289408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:45:30.874963 140573960804096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:45:35.401925 140574728979904 basic_session_run_hooks.py:262] loss = 0.25878057, step = 30
I0811 20:45:35.404582 140574728979904 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:45:48.846524 140574728979904 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:45:48.846878 140574728979904 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:45:48.848395 140573969196800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:45:48.848735 140573969196800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:45:48.848977 140574728979904 error_handling.py:96] infeed marked as finished
I0811 20:45:48.849190 140574728979904 tpu_estimator.py:602] Stop output thread controller
I0811 20:45:48.849247 140574728979904 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:45:48.849401 140573960804096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:45:48.849541 140573960804096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:45:48.849704 140574728979904 error_handling.py:96] outfeed marked as finished
I0811 20:45:48.849822 140574728979904 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:45:56.821533 140574728979904 estimator.py:368] Loss for final step: 0.25878057.
I0811 20:45:56.822388 140574728979904 error_handling.py:96] training_loop marked as finished
I0811 20:45:57.496239 140574728979904 estimator.py:1145] Calling model_fn.
E0811 20:45:58.186239 140574728979904 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:45:58.385937 140574728979904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:45:58.413506 140574728979904 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:45:58.434597 140574728979904 estimator.py:1147] Done calling model_fn.
I0811 20:45:58.451694 140574728979904 evaluation.py:255] Starting evaluation at 2019-08-11T20:45:58Z
I0811 20:45:58.451939 140574728979904 tpu_estimator.py:499] TPU job name worker
I0811 20:45:58.528817 140574728979904 monitored_session.py:240] Graph was finalized.
W0811 20:45:58.529552 140574728979904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:45:58.709922 140574728979904 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:46:01.218439 140574728979904 session_manager.py:500] Running local_init_op.
I0811 20:46:01.246742 140574728979904 session_manager.py:502] Done running local_init_op.
I0811 20:46:01.297662 140574728979904 tpu_estimator.py:557] Init TPU system
I0811 20:46:13.399621 140574728979904 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:46:13.400599 140573965526784 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:46:13.401448 140573957134080 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:46:13.467832 140574728979904 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:46:13.494719 140574728979904 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:46:13.495147 140574728979904 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:46:13.570797 140573474289408 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:46:13.796511 140573474289408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:46:14.213495 140573957134080 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:46:14.509191 140574728979904 evaluation.py:167] Evaluation [10/10]
I0811 20:46:14.509546 140574728979904 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:46:14.509669 140574728979904 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:46:14.509918 140573965526784 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:46:14.510195 140573965526784 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:46:14.510440 140574728979904 error_handling.py:96] infeed marked as finished
I0811 20:46:14.510658 140574728979904 tpu_estimator.py:602] Stop output thread controller
I0811 20:46:14.510724 140574728979904 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:46:14.510929 140573957134080 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:46:14.511101 140573957134080 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:46:14.511270 140574728979904 error_handling.py:96] outfeed marked as finished
I0811 20:46:14.511418 140574728979904 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:46:43.890352 140574728979904 evaluation.py:275] Finished evaluation at 2019-08-11-20:46:43
I0811 20:46:43.890688 140574728979904 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9323, global_step = 30, loss = 0.26935378
I0811 20:46:48.102638 140574728979904 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:46:48.881845 140574728979904 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.26935378, 'global_step': 30, 'accuracy': 0.9323}

Removing gs://yangyou-mnist/log/#1565556296644925...
Removing gs://yangyou-mnist/log/checkpoint#1565556345153321...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565556296.v3-8-tpu#1565556348504770...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565556301145359...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565556307921671...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565556313147786...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565556308774254...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565556342134120...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565556342963630...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565556347558797...
Removing gs://yangyou-mnist/log/eval/#1565556405518218...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565556405.v3-8-tpu#1565556408536329...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:46:52.712083 140030074807744 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:46:52.712877 140030074807744 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:46:52.715516 140030074807744 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:46:52.716362 140030074807744 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:46:52.716970 140030074807744 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:46:52.717103 140030074807744 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:46:53.116235 140030074807744 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:46:53.123267 140030074807744 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:46:53.126931 140030074807744 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:46:53.219844 140030074807744 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:46:53.220154 140030074807744 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:46:53.443186 140030074807744 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:46:53.490360 140030074807744 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:46:53.490648 140030074807744 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:46:53.594060 140030074807744 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5b25074250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5b27252190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:46:53.594428 140030074807744 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:46:53.919503 140030074807744 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:46:53.922542: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:46:53.935717 140030074807744 tpu_system_metadata.py:148] Found TPU system:
I0811 20:46:53.935964 140030074807744 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:46:53.936475 140030074807744 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:46:53.936534 140030074807744 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:46:53.936593 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:46:53.936881 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:46:53.936950 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:46:53.937006 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:46:53.937056 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:46:53.937103 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:46:53.937150 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:46:53.937197 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:46:53.937259 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:46:53.937306 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:46:53.937355 140030074807744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:46:53.943296 140030074807744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:46:53.955444 140030074807744 estimator.py:1145] Calling model_fn.
W0811 20:46:53.956063 140030074807744 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:46:54.227612 140030074807744 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:46:54.639838 140030074807744 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:46:54.700912 140030074807744 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:46:54.707178 140030074807744 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:46:54.886750 140030074807744 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:46:54.900542 140030074807744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:46:54.912473 140030074807744 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:46:54.912785 140030074807744 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:46:55.337023 140030074807744 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:46:55.352454 140030074807744 estimator.py:1147] Done calling model_fn.
I0811 20:46:58.569314 140030074807744 tpu_estimator.py:499] TPU job name worker
I0811 20:46:58.682482 140030074807744 monitored_session.py:240] Graph was finalized.
I0811 20:46:59.257003 140030074807744 session_manager.py:500] Running local_init_op.
I0811 20:46:59.292752 140030074807744 session_manager.py:502] Done running local_init_op.
I0811 20:47:01.846214 140030074807744 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:47:13.945983 140030074807744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:47:14.052966 140030074807744 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:47:14.053473 140030074807744 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:47:14.053950: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:47:14.058773 140030074807744 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:47:14.060995 140030074807744 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:47:14.065808 140030074807744 tpu_estimator.py:557] Init TPU system
I0811 20:47:26.486918 140030074807744 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:47:26.488029 140029315495680 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:47:26.488900 140029307102976 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:47:26.532674 140030074807744 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:47:26.533689 140030074807744 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:47:26.546384 140029298710272 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:47:26.806662 140029298710272 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:47:30.990948 140029307102976 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:47:35.437375 140030074807744 basic_session_run_hooks.py:262] loss = 0.2101849, step = 30
I0811 20:47:35.439996 140030074807744 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:47:48.447560 140030074807744 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:47:48.447865 140030074807744 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:47:48.448188 140029315495680 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:47:48.448481 140029315495680 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:47:48.448710 140030074807744 error_handling.py:96] infeed marked as finished
I0811 20:47:48.448906 140030074807744 tpu_estimator.py:602] Stop output thread controller
I0811 20:47:48.448962 140030074807744 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:47:48.449114 140029307102976 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:47:48.449256 140029307102976 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:47:48.449412 140030074807744 error_handling.py:96] outfeed marked as finished
I0811 20:47:48.449552 140030074807744 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:47:56.938378 140030074807744 estimator.py:368] Loss for final step: 0.2101849.
I0811 20:47:56.939255 140030074807744 error_handling.py:96] training_loop marked as finished
I0811 20:47:57.722413 140030074807744 estimator.py:1145] Calling model_fn.
E0811 20:47:58.403563 140030074807744 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:47:58.615550 140030074807744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:47:58.645921 140030074807744 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:47:58.668843 140030074807744 estimator.py:1147] Done calling model_fn.
I0811 20:47:58.686079 140030074807744 evaluation.py:255] Starting evaluation at 2019-08-11T20:47:58Z
I0811 20:47:58.686332 140030074807744 tpu_estimator.py:499] TPU job name worker
I0811 20:47:58.762142 140030074807744 monitored_session.py:240] Graph was finalized.
W0811 20:47:58.762916 140030074807744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:47:58.956207 140030074807744 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:48:01.517882 140030074807744 session_manager.py:500] Running local_init_op.
I0811 20:48:01.545671 140030074807744 session_manager.py:502] Done running local_init_op.
I0811 20:48:01.592869 140030074807744 tpu_estimator.py:557] Init TPU system
I0811 20:48:13.912623 140030074807744 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:48:13.913561 140029311563520 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:48:13.914300 140029303170816 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:48:13.976974 140030074807744 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:48:14.003534 140030074807744 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:48:14.003912 140030074807744 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:48:14.033664 140028818749184 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:48:14.136686 140028818749184 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:48:14.705358 140029303170816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:48:15.123610 140030074807744 evaluation.py:167] Evaluation [10/10]
I0811 20:48:15.124044 140030074807744 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:48:15.124135 140030074807744 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:48:15.124516 140029311563520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:48:15.124815 140029311563520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:48:15.125051 140030074807744 error_handling.py:96] infeed marked as finished
I0811 20:48:15.125242 140030074807744 tpu_estimator.py:602] Stop output thread controller
I0811 20:48:15.125303 140030074807744 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:48:15.125564 140029303170816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:48:15.125797 140029303170816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:48:15.125998 140030074807744 error_handling.py:96] outfeed marked as finished
I0811 20:48:15.126163 140030074807744 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:48:44.687360 140030074807744 evaluation.py:275] Finished evaluation at 2019-08-11-20:48:44
I0811 20:48:44.687696 140030074807744 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9433, global_step = 30, loss = 0.20782158
I0811 20:48:49.145155 140030074807744 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:48:50.001269 140030074807744 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.20782158, 'global_step': 30, 'accuracy': 0.9433}

Removing gs://yangyou-mnist/log/#1565556416814389...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565556429127226...
Removing gs://yangyou-mnist/log/checkpoint#1565556465003583...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565556433432495...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565556421269254...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565556461888558...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565556417.v3-8-tpu#1565556468107044...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565556462735251...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565556428233654...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565556467136250...
Removing gs://yangyou-mnist/log/eval/#1565556526365242...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565556526.v3-8-tpu#1565556529580487...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:48:53.782682 140659066926528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:48:53.783438 140659066926528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:48:53.785978 140659066926528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:48:53.786783 140659066926528 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:48:53.787338 140659066926528 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:48:53.787465 140659066926528 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:48:54.195151 140659066926528 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:48:54.202107 140659066926528 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:48:54.206114 140659066926528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:48:54.303178 140659066926528 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:48:54.303514 140659066926528 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:48:54.411134 140659066926528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:48:54.459180 140659066926528 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:48:54.459496 140659066926528 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:48:54.687151 140659066926528 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fed97e15150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fed99ff3190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:48:54.687551 140659066926528 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:48:55.017363 140659066926528 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:48:55.020603: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:48:55.032856 140659066926528 tpu_system_metadata.py:148] Found TPU system:
I0811 20:48:55.033126 140659066926528 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:48:55.033653 140659066926528 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:48:55.033715 140659066926528 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:48:55.033766 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:48:55.034138 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:48:55.034205 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:48:55.034257 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:48:55.034307 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:48:55.034354 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:48:55.034405 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:48:55.034455 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:48:55.034506 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:48:55.034574 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:48:55.034625 140659066926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:48:55.040694 140659066926528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:48:55.053380 140659066926528 estimator.py:1145] Calling model_fn.
W0811 20:48:55.054092 140659066926528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:48:55.319331 140659066926528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:48:55.745062 140659066926528 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:48:55.805418 140659066926528 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:48:55.811269 140659066926528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:48:55.984081 140659066926528 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:48:55.997342 140659066926528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:48:56.009119 140659066926528 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:48:56.009440 140659066926528 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:48:56.428730 140659066926528 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:48:56.444437 140659066926528 estimator.py:1147] Done calling model_fn.
I0811 20:48:59.856844 140659066926528 tpu_estimator.py:499] TPU job name worker
I0811 20:48:59.966640 140659066926528 monitored_session.py:240] Graph was finalized.
I0811 20:49:00.589821 140659066926528 session_manager.py:500] Running local_init_op.
I0811 20:49:00.620611 140659066926528 session_manager.py:502] Done running local_init_op.
I0811 20:49:03.102802 140659066926528 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:49:14.997111 140659066926528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:49:15.114855 140659066926528 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:49:15.115325 140659066926528 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:49:15.115772: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:49:15.120721 140659066926528 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:49:15.122852 140659066926528 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:49:15.126859 140659066926528 tpu_estimator.py:557] Init TPU system
I0811 20:49:27.463848 140659066926528 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:49:27.464829 140658031458048 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:49:27.465343 140658023065344 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:49:27.509113 140659066926528 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:49:27.510035 140659066926528 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:49:27.519857 140658014672640 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:49:27.635260 140658014672640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:49:32.048382 140658023065344 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:49:36.656930 140659066926528 basic_session_run_hooks.py:262] loss = 0.23621231, step = 30
I0811 20:49:36.659081 140659066926528 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:49:50.037678 140659066926528 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:49:50.037985 140659066926528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:49:50.038290 140658031458048 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:49:50.038608 140658031458048 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:49:50.038826 140659066926528 error_handling.py:96] infeed marked as finished
I0811 20:49:50.039062 140659066926528 tpu_estimator.py:602] Stop output thread controller
I0811 20:49:50.039120 140659066926528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:49:50.039287 140658023065344 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:49:50.039443 140658023065344 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:49:50.039592 140659066926528 error_handling.py:96] outfeed marked as finished
I0811 20:49:50.039725 140659066926528 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:49:57.765842 140659066926528 estimator.py:368] Loss for final step: 0.23621231.
I0811 20:49:57.766753 140659066926528 error_handling.py:96] training_loop marked as finished
I0811 20:49:58.558408 140659066926528 estimator.py:1145] Calling model_fn.
E0811 20:49:59.237083 140659066926528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:49:59.426387 140659066926528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:49:59.453402 140659066926528 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:49:59.474061 140659066926528 estimator.py:1147] Done calling model_fn.
I0811 20:49:59.490526 140659066926528 evaluation.py:255] Starting evaluation at 2019-08-11T20:49:59Z
I0811 20:49:59.490750 140659066926528 tpu_estimator.py:499] TPU job name worker
I0811 20:49:59.564960 140659066926528 monitored_session.py:240] Graph was finalized.
W0811 20:49:59.565748 140659066926528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:50:00.227525 140659066926528 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:50:02.884634 140659066926528 session_manager.py:500] Running local_init_op.
I0811 20:50:02.907865 140659066926528 session_manager.py:502] Done running local_init_op.
I0811 20:50:02.953660 140659066926528 tpu_estimator.py:557] Init TPU system
I0811 20:50:14.445131 140659066926528 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:50:14.445980 140658031458048 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:50:14.446391 140658023065344 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:50:14.514930 140659066926528 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:50:14.540858 140659066926528 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:50:14.541205 140659066926528 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:50:14.572299 140658014672640 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:50:14.731734 140658014672640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:50:15.255599 140658023065344 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:50:15.698923 140659066926528 evaluation.py:167] Evaluation [10/10]
I0811 20:50:15.699281 140659066926528 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:50:15.699368 140659066926528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:50:15.699544 140658031458048 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:50:15.699637 140658031458048 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:50:15.699800 140659066926528 error_handling.py:96] infeed marked as finished
I0811 20:50:15.699894 140659066926528 tpu_estimator.py:602] Stop output thread controller
I0811 20:50:15.699943 140659066926528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:50:15.700054 140658023065344 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:50:15.700129 140658023065344 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:50:15.700247 140659066926528 error_handling.py:96] outfeed marked as finished
I0811 20:50:15.700324 140659066926528 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:50:44.824549 140659066926528 evaluation.py:275] Finished evaluation at 2019-08-11-20:50:44
I0811 20:50:44.824887 140659066926528 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9398, global_step = 30, loss = 0.23611753
I0811 20:50:49.445221 140659066926528 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:50:50.228686 140659066926528 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.23611753, 'global_step': 30, 'accuracy': 0.9398}

Removing gs://yangyou-mnist/log/#1565556538030425...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565556538.v3-8-tpu#1565556589645306...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565556550109810...
Removing gs://yangyou-mnist/log/checkpoint#1565556586527448...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565556554480273...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565556583500541...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565556584306448...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565556542537295...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565556549282795...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565556588663708...
Removing gs://yangyou-mnist/log/eval/#1565556646402625...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565556646.v3-8-tpu#1565556649878208...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:50:53.926862 140402536572352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:50:53.927638 140402536572352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:50:53.930293 140402536572352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:50:53.931077 140402536572352 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:50:53.931642 140402536572352 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:50:53.931768 140402536572352 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:50:54.326396 140402536572352 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:50:54.338234 140402536572352 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:50:54.342674 140402536572352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:50:54.434926 140402536572352 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:50:54.435199 140402536572352 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:50:54.658878 140402536572352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:50:54.702405 140402536572352 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:50:54.702677 140402536572352 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:50:54.812148 140402536572352 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb1dd7ac0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb1df98a190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:50:54.812537 140402536572352 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:50:55.137218 140402536572352 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:50:55.140129: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:50:55.152405 140402536572352 tpu_system_metadata.py:148] Found TPU system:
I0811 20:50:55.152626 140402536572352 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:50:55.153127 140402536572352 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:50:55.153186 140402536572352 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:50:55.153239 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:50:55.153531 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:50:55.153620 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:50:55.153697 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:50:55.153750 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:50:55.153835 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:50:55.153883 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:50:55.153930 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:50:55.153976 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:50:55.154022 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:50:55.154069 140402536572352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:50:55.160000 140402536572352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:50:55.172187 140402536572352 estimator.py:1145] Calling model_fn.
W0811 20:50:55.172775 140402536572352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:50:55.441385 140402536572352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:50:55.865101 140402536572352 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:50:55.925561 140402536572352 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:50:55.931447 140402536572352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:50:56.108084 140402536572352 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:50:56.121646 140402536572352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:50:56.133567 140402536572352 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:50:56.133912 140402536572352 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:50:56.563137 140402536572352 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:50:56.578557 140402536572352 estimator.py:1147] Done calling model_fn.
I0811 20:50:59.774389 140402536572352 tpu_estimator.py:499] TPU job name worker
I0811 20:50:59.888221 140402536572352 monitored_session.py:240] Graph was finalized.
I0811 20:51:00.438633 140402536572352 session_manager.py:500] Running local_init_op.
I0811 20:51:00.477250 140402536572352 session_manager.py:502] Done running local_init_op.
I0811 20:51:02.921943 140402536572352 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:51:14.610826 140402536572352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:51:14.716909 140402536572352 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:51:14.717449 140402536572352 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:51:14.718200: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:51:14.722872 140402536572352 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:51:14.724951 140402536572352 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:51:14.728610 140402536572352 tpu_estimator.py:557] Init TPU system
I0811 20:51:26.749461 140402536572352 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:51:26.750461 140401643079424 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:51:26.751554 140401634686720 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:51:26.795073 140402536572352 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:51:26.795974 140402536572352 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:51:26.811392 140401626294016 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:51:27.036186 140401626294016 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:51:31.302740 140401634686720 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:51:35.739347 140402536572352 basic_session_run_hooks.py:262] loss = 0.21957214, step = 30
I0811 20:51:35.741714 140402536572352 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:51:49.050493 140402536572352 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:51:49.050815 140402536572352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:51:49.052479 140401643079424 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:51:49.052762 140401643079424 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:51:49.053008 140402536572352 error_handling.py:96] infeed marked as finished
I0811 20:51:49.053277 140402536572352 tpu_estimator.py:602] Stop output thread controller
I0811 20:51:49.053344 140402536572352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:51:49.053503 140401634686720 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:51:49.053685 140401634686720 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:51:49.053832 140402536572352 error_handling.py:96] outfeed marked as finished
I0811 20:51:49.053967 140402536572352 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:51:57.149218 140402536572352 estimator.py:368] Loss for final step: 0.21957214.
I0811 20:51:57.150131 140402536572352 error_handling.py:96] training_loop marked as finished
I0811 20:51:57.935197 140402536572352 estimator.py:1145] Calling model_fn.
E0811 20:51:58.668153 140402536572352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:51:58.862914 140402536572352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:51:58.890474 140402536572352 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:51:58.911840 140402536572352 estimator.py:1147] Done calling model_fn.
I0811 20:51:58.928920 140402536572352 evaluation.py:255] Starting evaluation at 2019-08-11T20:51:58Z
I0811 20:51:58.929162 140402536572352 tpu_estimator.py:499] TPU job name worker
I0811 20:51:59.004251 140402536572352 monitored_session.py:240] Graph was finalized.
W0811 20:51:59.005021 140402536572352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:51:59.194174 140402536572352 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:52:01.861984 140402536572352 session_manager.py:500] Running local_init_op.
I0811 20:52:01.885387 140402536572352 session_manager.py:502] Done running local_init_op.
I0811 20:52:01.935389 140402536572352 tpu_estimator.py:557] Init TPU system
I0811 20:52:14.665057 140402536572352 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:52:14.666172 140401639147264 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:52:14.667136 140401630754560 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:52:14.735012 140402536572352 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:52:14.761694 140402536572352 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:52:14.762044 140402536572352 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:52:14.790611 140401617639168 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:52:14.893953 140401617639168 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:52:15.455853 140401630754560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:52:15.988472 140402536572352 evaluation.py:167] Evaluation [10/10]
I0811 20:52:15.988806 140402536572352 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:52:15.988926 140402536572352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:52:15.989094 140401639147264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:52:15.989182 140401639147264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:52:15.989316 140402536572352 error_handling.py:96] infeed marked as finished
I0811 20:52:15.989407 140402536572352 tpu_estimator.py:602] Stop output thread controller
I0811 20:52:15.989455 140402536572352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:52:15.989562 140401630754560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:52:15.989684 140401630754560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:52:15.989792 140402536572352 error_handling.py:96] outfeed marked as finished
I0811 20:52:15.989877 140402536572352 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:52:44.986557 140402536572352 evaluation.py:275] Finished evaluation at 2019-08-11-20:52:44
I0811 20:52:44.986896 140402536572352 estimator.py:2039] Saving dict for global step 30: accuracy = 0.943, global_step = 30, loss = 0.21807602
I0811 20:52:49.077429 140402536572352 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:52:49.856030 140402536572352 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.21807602, 'global_step': 30, 'accuracy': 0.943}

Removing gs://yangyou-mnist/log/#1565556657996850...
Removing gs://yangyou-mnist/log/checkpoint#1565556705670206...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565556658.v3-8-tpu#1565556708703483...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565556674080509...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565556662339074...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565556669731448...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565556702562506...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565556668936314...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565556703446687...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565556707788522...
Removing gs://yangyou-mnist/log/eval/#1565556766640072...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565556766.v3-8-tpu#1565556769507443...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:52:53.663264 140013023749568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:52:53.664083 140013023749568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:52:53.666721 140013023749568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:52:53.667536 140013023749568 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:52:53.668103 140013023749568 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:52:53.668242 140013023749568 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:52:54.075798 140013023749568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:52:54.082089 140013023749568 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:52:54.085784 140013023749568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:52:54.136996 140013023749568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:52:54.137295 140013023749568 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:52:54.242994 140013023749568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:52:54.334963 140013023749568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:52:54.335252 140013023749568 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:52:54.595491 140013023749568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f572cb4c150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f572ed2a190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:52:54.595875 140013023749568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:52:54.921678 140013023749568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:52:54.924629: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:52:54.937284 140013023749568 tpu_system_metadata.py:148] Found TPU system:
I0811 20:52:54.937511 140013023749568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:52:54.938129 140013023749568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:52:54.938189 140013023749568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:52:54.938244 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:52:54.938528 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:52:54.938596 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:52:54.938647 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:52:54.938695 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:52:54.938744 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:52:54.938791 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:52:54.938838 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:52:54.938884 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:52:54.938931 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:52:54.938982 140013023749568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:52:54.944772 140013023749568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:52:54.956820 140013023749568 estimator.py:1145] Calling model_fn.
W0811 20:52:54.957385 140013023749568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:52:55.229029 140013023749568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:52:55.636661 140013023749568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:52:55.697396 140013023749568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:52:55.703217 140013023749568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:52:55.878304 140013023749568 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:52:55.891711 140013023749568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:52:55.903378 140013023749568 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:52:55.903693 140013023749568 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:52:56.318156 140013023749568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:52:56.333719 140013023749568 estimator.py:1147] Done calling model_fn.
I0811 20:52:59.401060 140013023749568 tpu_estimator.py:499] TPU job name worker
I0811 20:52:59.514162 140013023749568 monitored_session.py:240] Graph was finalized.
I0811 20:53:00.074925 140013023749568 session_manager.py:500] Running local_init_op.
I0811 20:53:00.104192 140013023749568 session_manager.py:502] Done running local_init_op.
I0811 20:53:02.586064 140013023749568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:53:14.552910 140013023749568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:53:14.664195 140013023749568 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:53:14.664712 140013023749568 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:53:14.665134: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:53:14.670406 140013023749568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:53:14.672746 140013023749568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:53:14.677452 140013023749568 tpu_estimator.py:557] Init TPU system
I0811 20:53:27.059052 140013023749568 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:53:27.060046 140012264335104 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:53:27.060667 140012255942400 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:53:27.101784 140013023749568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:53:27.102691 140013023749568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:53:27.173964 140011773097728 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:53:27.266937 140011773097728 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:53:31.472961 140012255942400 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:53:35.938973 140013023749568 basic_session_run_hooks.py:262] loss = 0.123541705, step = 30
I0811 20:53:35.941327 140013023749568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:53:49.312726 140013023749568 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:53:49.313224 140013023749568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:53:49.314656 140012264335104 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:53:49.314943 140012264335104 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:53:49.315125 140013023749568 error_handling.py:96] infeed marked as finished
I0811 20:53:49.315258 140013023749568 tpu_estimator.py:602] Stop output thread controller
I0811 20:53:49.315387 140013023749568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:53:49.315525 140012255942400 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:53:49.315627 140012255942400 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:53:49.315764 140013023749568 error_handling.py:96] outfeed marked as finished
I0811 20:53:49.315861 140013023749568 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:53:57.395551 140013023749568 estimator.py:368] Loss for final step: 0.123541705.
I0811 20:53:57.396503 140013023749568 error_handling.py:96] training_loop marked as finished
I0811 20:53:58.080554 140013023749568 estimator.py:1145] Calling model_fn.
E0811 20:53:58.765846 140013023749568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:53:58.960314 140013023749568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:53:58.988028 140013023749568 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:53:59.009005 140013023749568 estimator.py:1147] Done calling model_fn.
I0811 20:53:59.026015 140013023749568 evaluation.py:255] Starting evaluation at 2019-08-11T20:53:59Z
I0811 20:53:59.026252 140013023749568 tpu_estimator.py:499] TPU job name worker
I0811 20:53:59.102998 140013023749568 monitored_session.py:240] Graph was finalized.
W0811 20:53:59.103790 140013023749568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:53:59.288937 140013023749568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:54:01.809134 140013023749568 session_manager.py:500] Running local_init_op.
I0811 20:54:01.837364 140013023749568 session_manager.py:502] Done running local_init_op.
I0811 20:54:01.891088 140013023749568 tpu_estimator.py:557] Init TPU system
I0811 20:54:14.061891 140013023749568 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:54:14.062802 140012260402944 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:54:14.063393 140011773097728 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:54:14.130348 140013023749568 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:54:14.154268 140013023749568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:54:14.154681 140013023749568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:54:14.234036 140011764705024 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:54:14.343827 140011764705024 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:54:14.902564 140011773097728 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:54:15.256046 140013023749568 evaluation.py:167] Evaluation [10/10]
I0811 20:54:15.256445 140013023749568 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:54:15.256542 140013023749568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:54:15.256762 140012260402944 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:54:15.256865 140012260402944 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:54:15.257018 140013023749568 error_handling.py:96] infeed marked as finished
I0811 20:54:15.257124 140013023749568 tpu_estimator.py:602] Stop output thread controller
I0811 20:54:15.257178 140013023749568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:54:15.257301 140011773097728 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:54:15.257379 140011773097728 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:54:15.257517 140013023749568 error_handling.py:96] outfeed marked as finished
I0811 20:54:15.257644 140013023749568 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:54:44.442150 140013023749568 evaluation.py:275] Finished evaluation at 2019-08-11-20:54:44
I0811 20:54:44.442527 140013023749568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9655, global_step = 30, loss = 0.12524398
I0811 20:54:48.780214 140013023749568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:54:49.622929 140013023749568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12524398, 'global_step': 30, 'accuracy': 0.9655}

Removing gs://yangyou-mnist/log/#1565556777695567...
Removing gs://yangyou-mnist/log/checkpoint#1565556825870387...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565556788882609...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565556789740888...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565556782020253...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565556794026245...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565556777.v3-8-tpu#1565556828953981...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565556822051280...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565556822896021...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565556828063120...
Removing gs://yangyou-mnist/log/eval/#1565556886076188...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565556886.v3-8-tpu#1565556889274615...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:54:53.378767 139678774658496 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:54:53.379568 139678774658496 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:54:53.382302 139678774658496 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:54:53.383136 139678774658496 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:54:53.383714 139678774658496 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:54:53.383857 139678774658496 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:54:53.788880 139678774658496 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:54:53.794876 139678774658496 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:54:53.798178 139678774658496 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:54:53.845114 139678774658496 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:54:53.845390 139678774658496 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:54:53.989180 139678774658496 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:54:54.036752 139678774658496 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:54:54.037039 139678774658496 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:54:54.270886 139678774658496 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0959e860d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f095c064190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:54:54.271274 139678774658496 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:54:54.600512 139678774658496 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:54:54.603439: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:54:54.616878 139678774658496 tpu_system_metadata.py:148] Found TPU system:
I0811 20:54:54.617120 139678774658496 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:54:54.617670 139678774658496 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:54:54.617739 139678774658496 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:54:54.617794 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:54:54.618123 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:54:54.618179 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:54:54.618230 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:54:54.618279 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:54:54.618331 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:54:54.618379 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:54:54.618426 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:54:54.618473 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:54:54.618519 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:54:54.618567 139678774658496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:54:54.624620 139678774658496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:54:54.637279 139678774658496 estimator.py:1145] Calling model_fn.
W0811 20:54:54.637957 139678774658496 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:54:54.899842 139678774658496 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:54:55.311748 139678774658496 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:54:55.374731 139678774658496 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:54:55.380707 139678774658496 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:54:55.557759 139678774658496 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:54:55.571276 139678774658496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:54:55.583046 139678774658496 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:54:55.583345 139678774658496 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:54:55.995920 139678774658496 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:54:56.011394 139678774658496 estimator.py:1147] Done calling model_fn.
I0811 20:54:59.415313 139678774658496 tpu_estimator.py:499] TPU job name worker
I0811 20:54:59.527365 139678774658496 monitored_session.py:240] Graph was finalized.
I0811 20:55:00.119582 139678774658496 session_manager.py:500] Running local_init_op.
I0811 20:55:00.156188 139678774658496 session_manager.py:502] Done running local_init_op.
I0811 20:55:02.682091 139678774658496 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:55:14.774565 139678774658496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:55:14.892915 139678774658496 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:55:14.893357 139678774658496 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:55:14.893825: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:55:14.898751 139678774658496 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:55:14.900813 139678774658496 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:55:14.904253 139678774658496 tpu_estimator.py:557] Init TPU system
I0811 20:55:27.083328 139678774658496 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0811 20:55:27.084352 139677881059072 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:55:27.085320 139677872666368 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:55:27.127178 139678774658496 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:55:27.128138 139678774658496 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:55:27.139455 139677864273664 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:55:27.451008 139677864273664 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:55:31.943888 139677872666368 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:55:36.430078 139678774658496 basic_session_run_hooks.py:262] loss = 0.09804677, step = 30
I0811 20:55:36.431994 139678774658496 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:55:49.580837 139678774658496 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:55:49.581121 139678774658496 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:55:49.581325 139677881059072 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:55:49.581422 139677881059072 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:55:49.581548 139678774658496 error_handling.py:96] infeed marked as finished
I0811 20:55:49.581701 139678774658496 tpu_estimator.py:602] Stop output thread controller
I0811 20:55:49.581753 139678774658496 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:55:49.581861 139677872666368 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:55:49.581932 139677872666368 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:55:49.582037 139678774658496 error_handling.py:96] outfeed marked as finished
I0811 20:55:49.582115 139678774658496 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:55:57.582467 139678774658496 estimator.py:368] Loss for final step: 0.09804677.
I0811 20:55:57.583230 139678774658496 error_handling.py:96] training_loop marked as finished
I0811 20:55:58.380729 139678774658496 estimator.py:1145] Calling model_fn.
E0811 20:55:59.062799 139678774658496 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:55:59.256725 139678774658496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:55:59.284187 139678774658496 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:55:59.305521 139678774658496 estimator.py:1147] Done calling model_fn.
I0811 20:55:59.323185 139678774658496 evaluation.py:255] Starting evaluation at 2019-08-11T20:55:59Z
I0811 20:55:59.323420 139678774658496 tpu_estimator.py:499] TPU job name worker
I0811 20:55:59.399444 139678774658496 monitored_session.py:240] Graph was finalized.
W0811 20:55:59.400254 139678774658496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:55:59.581491 139678774658496 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:56:02.305031 139678774658496 session_manager.py:500] Running local_init_op.
I0811 20:56:02.332798 139678774658496 session_manager.py:502] Done running local_init_op.
I0811 20:56:02.382618 139678774658496 tpu_estimator.py:557] Init TPU system
I0811 20:56:14.365432 139678774658496 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0811 20:56:14.366358 139677877126912 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:56:14.366877 139677868734208 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:56:14.432104 139678774658496 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:56:14.455753 139678774658496 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:56:14.456110 139678774658496 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:56:14.486670 139677855618816 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:56:14.808927 139677855618816 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:56:15.200313 139677868734208 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:56:15.518045 139678774658496 evaluation.py:167] Evaluation [10/10]
I0811 20:56:15.518409 139678774658496 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:56:15.518488 139678774658496 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:56:15.518666 139677877126912 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:56:15.518757 139677877126912 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:56:15.518915 139678774658496 error_handling.py:96] infeed marked as finished
I0811 20:56:15.519013 139678774658496 tpu_estimator.py:602] Stop output thread controller
I0811 20:56:15.519062 139678774658496 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:56:15.519175 139677868734208 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:56:15.519246 139677868734208 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:56:15.519377 139678774658496 error_handling.py:96] outfeed marked as finished
I0811 20:56:15.519462 139678774658496 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:56:44.905178 139678774658496 evaluation.py:275] Finished evaluation at 2019-08-11-20:56:44
I0811 20:56:44.905515 139678774658496 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9736, global_step = 30, loss = 0.08467637
I0811 20:56:49.443512 139678774658496 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 20:56:50.207765 139678774658496 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08467637, 'global_step': 30, 'accuracy': 0.9736}

Removing gs://yangyou-mnist/log/#1565556897555779...
Removing gs://yangyou-mnist/log/checkpoint#1565556946043090...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565556897.v3-8-tpu#1565556949233918...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565556902111494...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565556910024304...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565556909132632...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565556914255790...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565556942996799...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565556943868957...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565556948314840...
Removing gs://yangyou-mnist/log/eval/#1565557006557372...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565557006.v3-8-tpu#1565557009861332...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 20:56:53.931762 139885831828928 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 20:56:53.932493 139885831828928 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 20:56:53.935491 139885831828928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 20:56:53.936274 139885831828928 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 20:56:53.936813 139885831828928 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 20:56:53.936939 139885831828928 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 20:56:54.347157 139885831828928 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 20:56:54.353898 139885831828928 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 20:56:54.357389 139885831828928 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:56:54.449150 139885831828928 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:56:54.449435 139885831828928 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:56:54.590321 139885831828928 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 20:56:54.637778 139885831828928 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 20:56:54.638062 139885831828928 transport.py:157] Attempting refresh to obtain initial access_token
I0811 20:56:54.877103 139885831828928 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f398f78a350>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f399197f190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 20:56:54.877491 139885831828928 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 20:56:55.203547 139885831828928 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 20:56:55.206416: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:56:55.217950 139885831828928 tpu_system_metadata.py:148] Found TPU system:
I0811 20:56:55.218233 139885831828928 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 20:56:55.218740 139885831828928 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 20:56:55.218799 139885831828928 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 20:56:55.218851 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 20:56:55.219130 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 20:56:55.219193 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 20:56:55.219244 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 20:56:55.219293 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 20:56:55.219341 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 20:56:55.219388 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 20:56:55.219434 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 20:56:55.219480 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 20:56:55.219526 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 20:56:55.219573 139885831828928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 20:56:55.225428 139885831828928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 20:56:55.237251 139885831828928 estimator.py:1145] Calling model_fn.
W0811 20:56:55.237842 139885831828928 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 20:56:55.502979 139885831828928 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 20:56:55.958765 139885831828928 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 20:56:56.018796 139885831828928 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 20:56:56.024322 139885831828928 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:56:56.198597 139885831828928 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 20:56:56.212090 139885831828928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 20:56:56.223675 139885831828928 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 20:56:56.223978 139885831828928 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 20:56:56.639547 139885831828928 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 20:56:56.654848 139885831828928 estimator.py:1147] Done calling model_fn.
I0811 20:57:00.086150 139885831828928 tpu_estimator.py:499] TPU job name worker
I0811 20:57:00.197977 139885831828928 monitored_session.py:240] Graph was finalized.
I0811 20:57:00.766952 139885831828928 session_manager.py:500] Running local_init_op.
I0811 20:57:00.795936 139885831828928 session_manager.py:502] Done running local_init_op.
I0811 20:57:03.419946 139885831828928 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 20:57:15.630966 139885831828928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 20:57:15.751756 139885831828928 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:57:15.752240 139885831828928 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 20:57:15.752635: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 20:57:15.757369 139885831828928 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 20:57:15.759429 139885831828928 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 20:57:15.763267 139885831828928 tpu_estimator.py:557] Init TPU system
I0811 20:57:40.724642 139885831828928 tpu_estimator.py:566] Initialized TPU in 24 seconds
I0811 20:57:40.725647 139884803127040 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:57:40.726161 139884794734336 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:57:40.768053 139885831828928 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 20:57:40.768907 139885831828928 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 20:57:40.778898 139884786341632 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:57:41.005261 139884786341632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:57:45.294259 139884794734336 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:57:49.929884 139885831828928 basic_session_run_hooks.py:262] loss = 0.10777631, step = 30
I0811 20:57:49.932257 139885831828928 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 20:58:03.292678 139885831828928 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:58:03.292973 139885831828928 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:58:03.293289 139884803127040 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:58:03.293680 139884803127040 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:58:03.293898 139885831828928 error_handling.py:96] infeed marked as finished
I0811 20:58:03.294140 139885831828928 tpu_estimator.py:602] Stop output thread controller
I0811 20:58:03.294199 139885831828928 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:58:03.294433 139884794734336 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:58:03.294630 139884794734336 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:58:03.294795 139885831828928 error_handling.py:96] outfeed marked as finished
I0811 20:58:03.294934 139885831828928 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:58:11.118226 139885831828928 estimator.py:368] Loss for final step: 0.10777631.
I0811 20:58:11.119040 139885831828928 error_handling.py:96] training_loop marked as finished
I0811 20:58:11.889369 139885831828928 estimator.py:1145] Calling model_fn.
E0811 20:58:13.097302 139885831828928 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 20:58:13.291104 139885831828928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 20:58:13.318600 139885831828928 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 20:58:13.339499 139885831828928 estimator.py:1147] Done calling model_fn.
I0811 20:58:13.356497 139885831828928 evaluation.py:255] Starting evaluation at 2019-08-11T20:58:13Z
I0811 20:58:13.356739 139885831828928 tpu_estimator.py:499] TPU job name worker
I0811 20:58:13.432871 139885831828928 monitored_session.py:240] Graph was finalized.
W0811 20:58:13.433640 139885831828928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 20:58:13.613764 139885831828928 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 20:58:16.289110 139885831828928 session_manager.py:500] Running local_init_op.
I0811 20:58:16.313534 139885831828928 session_manager.py:502] Done running local_init_op.
I0811 20:58:16.360500 139885831828928 tpu_estimator.py:557] Init TPU system
I0811 20:59:24.642251 139885831828928 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 20:59:24.643161 139884799719168 tpu_estimator.py:514] Starting infeed thread controller.
I0811 20:59:24.643594 139884791326464 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 20:59:24.708376 139885831828928 util.py:98] Initialized dataset iterators in 0 seconds
I0811 20:59:24.734817 139885831828928 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 20:59:24.735176 139885831828928 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 20:59:24.763437 139884782933760 transport.py:157] Attempting refresh to obtain initial access_token
W0811 20:59:24.868376 139884782933760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 20:59:25.474419 139884791326464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 20:59:25.825377 139885831828928 evaluation.py:167] Evaluation [10/10]
I0811 20:59:25.825767 139885831828928 tpu_estimator.py:598] Stop infeed thread controller
I0811 20:59:25.825897 139885831828928 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 20:59:25.826056 139884799719168 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 20:59:25.826143 139884799719168 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 20:59:25.826278 139885831828928 error_handling.py:96] infeed marked as finished
I0811 20:59:25.826385 139885831828928 tpu_estimator.py:602] Stop output thread controller
I0811 20:59:25.826445 139885831828928 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 20:59:25.826555 139884791326464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 20:59:25.826623 139884791326464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 20:59:25.826734 139885831828928 error_handling.py:96] outfeed marked as finished
I0811 20:59:25.826819 139885831828928 tpu_estimator.py:606] Shutdown TPU system.
I0811 20:59:54.960396 139885831828928 evaluation.py:275] Finished evaluation at 2019-08-11-20:59:54
I0811 20:59:54.960803 139885831828928 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9701, global_step = 30, loss = 0.09344779
I0811 20:59:59.708439 139885831828928 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:00:00.513767 139885831828928 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09344779, 'global_step': 30, 'accuracy': 0.9701}

Removing gs://yangyou-mnist/log/#1565557018167658...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565557030772367...
Removing gs://yangyou-mnist/log/checkpoint#1565557079820837...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565557018.v3-8-tpu#1565557082944363...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565557035109169...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565557029820393...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565557076819278...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565557022847560...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565557077689978...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565557082000316...
Removing gs://yangyou-mnist/log/eval/#1565557196638344...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565557196.v3-8-tpu#1565557200165487...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:00:04.293026 140579130627520 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:00:04.293869 140579130627520 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:00:04.296480 140579130627520 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:00:04.297297 140579130627520 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:00:04.297930 140579130627520 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:00:04.298062 140579130627520 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:00:04.695383 140579130627520 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:00:04.701822 140579130627520 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:00:04.705555 140579130627520 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:00:04.752074 140579130627520 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:00:04.752347 140579130627520 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:00:04.863873 140579130627520 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:00:04.957290 140579130627520 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:00:04.957601 140579130627520 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:00:05.088428 140579130627520 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fdafb4e3150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fdafd6c1190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:00:05.088823 140579130627520 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:00:05.423525 140579130627520 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:00:05.426538: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:00:05.439318 140579130627520 tpu_system_metadata.py:148] Found TPU system:
I0811 21:00:05.439618 140579130627520 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:00:05.440146 140579130627520 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:00:05.440207 140579130627520 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:00:05.440265 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:00:05.440557 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:00:05.440614 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:00:05.440665 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:00:05.440713 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:00:05.440761 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:00:05.440809 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:00:05.440857 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:00:05.440907 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:00:05.440953 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:00:05.441006 140579130627520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:00:05.447184 140579130627520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:00:05.459754 140579130627520 estimator.py:1145] Calling model_fn.
W0811 21:00:05.460385 140579130627520 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:00:05.747018 140579130627520 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:00:06.172235 140579130627520 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:00:06.233841 140579130627520 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:00:06.239892 140579130627520 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:00:06.428343 140579130627520 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:00:06.442560 140579130627520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:00:06.454514 140579130627520 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:00:06.454829 140579130627520 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:00:06.887659 140579130627520 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:00:06.903115 140579130627520 estimator.py:1147] Done calling model_fn.
I0811 21:00:10.399048 140579130627520 tpu_estimator.py:499] TPU job name worker
I0811 21:00:10.509393 140579130627520 monitored_session.py:240] Graph was finalized.
I0811 21:00:11.060473 140579130627520 session_manager.py:500] Running local_init_op.
I0811 21:00:11.089576 140579130627520 session_manager.py:502] Done running local_init_op.
I0811 21:00:13.703728 140579130627520 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:00:26.109899 140579130627520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:00:26.228691 140579130627520 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:00:26.229197 140579130627520 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:00:26.229691: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:00:26.235064 140579130627520 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:00:26.237060 140579130627520 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:00:26.241156 140579130627520 tpu_estimator.py:557] Init TPU system
I0811 21:01:08.675014 140579130627520 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 21:01:08.675932 140578096408320 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:01:08.676448 140578088015616 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:01:08.719515 140579130627520 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:01:08.720371 140579130627520 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:01:08.731842 140578079622912 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:01:08.954863 140578079622912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 21:01:13.137037 140578088015616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:01:17.834659 140579130627520 basic_session_run_hooks.py:262] loss = 0.11673876, step = 30
I0811 21:01:17.836762 140579130627520 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:01:31.129723 140579130627520 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:01:31.130078 140579130627520 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:01:31.130357 140578096408320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:01:31.130651 140578096408320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:01:31.130856 140579130627520 error_handling.py:96] infeed marked as finished
I0811 21:01:31.131050 140579130627520 tpu_estimator.py:602] Stop output thread controller
I0811 21:01:31.131104 140579130627520 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:01:31.131330 140578088015616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:01:31.131536 140578088015616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:01:31.131691 140579130627520 error_handling.py:96] outfeed marked as finished
I0811 21:01:31.131819 140579130627520 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:01:39.085709 140579130627520 estimator.py:368] Loss for final step: 0.11673876.
I0811 21:01:39.086565 140579130627520 error_handling.py:96] training_loop marked as finished
I0811 21:01:39.879582 140579130627520 estimator.py:1145] Calling model_fn.
E0811 21:01:40.557945 140579130627520 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:01:40.744008 140579130627520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:01:40.770469 140579130627520 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:01:40.790731 140579130627520 estimator.py:1147] Done calling model_fn.
I0811 21:01:40.807432 140579130627520 evaluation.py:255] Starting evaluation at 2019-08-11T21:01:40Z
I0811 21:01:40.807656 140579130627520 tpu_estimator.py:499] TPU job name worker
I0811 21:01:40.880600 140579130627520 monitored_session.py:240] Graph was finalized.
W0811 21:01:40.881314 140579130627520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:01:41.067815 140579130627520 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:01:43.784265 140579130627520 session_manager.py:500] Running local_init_op.
I0811 21:01:43.807950 140579130627520 session_manager.py:502] Done running local_init_op.
I0811 21:01:43.853945 140579130627520 tpu_estimator.py:557] Init TPU system
I0811 21:02:52.625483 140579130627520 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:02:52.626452 140578096408320 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:02:52.626977 140578088015616 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:02:52.692351 140579130627520 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:02:52.718266 140579130627520 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:02:52.718643 140579130627520 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:02:52.793710 140578079622912 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:02:53.031949 140578079622912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:02:53.456908 140578088015616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:02:53.767496 140579130627520 evaluation.py:167] Evaluation [10/10]
I0811 21:02:53.767832 140579130627520 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:02:53.767906 140579130627520 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:02:53.768121 140578096408320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:02:53.768281 140578096408320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:02:53.768410 140579130627520 error_handling.py:96] infeed marked as finished
I0811 21:02:53.768505 140579130627520 tpu_estimator.py:602] Stop output thread controller
I0811 21:02:53.768556 140579130627520 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:02:53.768672 140578088015616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:02:53.768748 140578088015616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:02:53.768862 140579130627520 error_handling.py:96] outfeed marked as finished
I0811 21:02:53.768939 140579130627520 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:03:23.127077 140579130627520 evaluation.py:275] Finished evaluation at 2019-08-11-21:03:23
I0811 21:03:23.127423 140579130627520 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9723, global_step = 30, loss = 0.084177114
I0811 21:03:27.554744 140579130627520 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:03:28.417789 140579130627520 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.084177114, 'global_step': 30, 'accuracy': 0.9723}

Removing gs://yangyou-mnist/log/#1565557208352173...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565557225592174...
Removing gs://yangyou-mnist/log/checkpoint#1565557287770782...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565557285696666...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565557221054251...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565557284728763...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565557208.v3-8-tpu#1565557290791766...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565557213129970...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565557220190141...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565557289913635...
Removing gs://yangyou-mnist/log/eval/#1565557404735910...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565557404.v3-8-tpu#1565557408080284...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:03:32.130058 140719884289472 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:03:32.130835 140719884289472 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:03:32.133455 140719884289472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:03:32.134304 140719884289472 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:03:32.134885 140719884289472 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:03:32.135016 140719884289472 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:03:32.543360 140719884289472 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:03:32.550066 140719884289472 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:03:32.553735 140719884289472 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:03:32.603882 140719884289472 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:03:32.604178 140719884289472 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:03:32.705519 140719884289472 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:03:32.750055 140719884289472 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:03:32.750323 140719884289472 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:03:32.975850 140719884289472 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ffbc0e0a210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ffbc2fe8190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:03:32.976221 140719884289472 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:03:33.304959 140719884289472 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:03:33.307957: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:03:33.319883 140719884289472 tpu_system_metadata.py:148] Found TPU system:
I0811 21:03:33.320174 140719884289472 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:03:33.320672 140719884289472 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:03:33.320740 140719884289472 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:03:33.320792 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:03:33.321089 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:03:33.321146 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:03:33.321197 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:03:33.321244 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:03:33.321291 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:03:33.321337 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:03:33.321383 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:03:33.321429 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:03:33.321476 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:03:33.321523 140719884289472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:03:33.327589 140719884289472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:03:33.339888 140719884289472 estimator.py:1145] Calling model_fn.
W0811 21:03:33.340502 140719884289472 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:03:33.613045 140719884289472 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:03:34.023483 140719884289472 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:03:34.083739 140719884289472 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:03:34.089512 140719884289472 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:03:34.262855 140719884289472 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:03:34.276129 140719884289472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:03:34.287683 140719884289472 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:03:34.287997 140719884289472 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:03:34.700244 140719884289472 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:03:34.715514 140719884289472 estimator.py:1147] Done calling model_fn.
I0811 21:03:37.933803 140719884289472 tpu_estimator.py:499] TPU job name worker
I0811 21:03:38.045861 140719884289472 monitored_session.py:240] Graph was finalized.
I0811 21:03:38.605120 140719884289472 session_manager.py:500] Running local_init_op.
I0811 21:03:38.643754 140719884289472 session_manager.py:502] Done running local_init_op.
I0811 21:03:42.227154 140719884289472 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:03:54.250602 140719884289472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:03:54.375027 140719884289472 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:03:54.375552 140719884289472 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:03:54.375961: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:03:54.381208 140719884289472 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:03:54.383361 140719884289472 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:03:54.387676 140719884289472 tpu_estimator.py:557] Init TPU system
I0811 21:04:36.680035 140719884289472 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 21:04:36.680927 140719124883200 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:04:36.681440 140719116490496 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:04:36.723294 140719884289472 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:04:36.724128 140719884289472 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:04:36.736330 140718630762240 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:04:36.847332 140718630762240 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:04:41.312263 140719116490496 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:04:45.828906 140719884289472 basic_session_run_hooks.py:262] loss = 0.13795385, step = 30
I0811 21:04:45.831317 140719884289472 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:04:59.559202 140719884289472 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:04:59.559488 140719884289472 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:04:59.559761 140719124883200 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:04:59.560086 140719124883200 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:04:59.560280 140719884289472 error_handling.py:96] infeed marked as finished
I0811 21:04:59.560475 140719884289472 tpu_estimator.py:602] Stop output thread controller
I0811 21:04:59.560528 140719884289472 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:04:59.560709 140719116490496 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:04:59.560862 140719116490496 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:04:59.561075 140719884289472 error_handling.py:96] outfeed marked as finished
I0811 21:04:59.561256 140719884289472 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:05:06.966382 140719884289472 estimator.py:368] Loss for final step: 0.13795385.
I0811 21:05:06.967267 140719884289472 error_handling.py:96] training_loop marked as finished
I0811 21:05:07.790821 140719884289472 estimator.py:1145] Calling model_fn.
E0811 21:05:08.471524 140719884289472 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:05:08.663803 140719884289472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:05:08.691188 140719884289472 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:05:08.712276 140719884289472 estimator.py:1147] Done calling model_fn.
I0811 21:05:08.729346 140719884289472 evaluation.py:255] Starting evaluation at 2019-08-11T21:05:08Z
I0811 21:05:08.729578 140719884289472 tpu_estimator.py:499] TPU job name worker
I0811 21:05:08.803081 140719884289472 monitored_session.py:240] Graph was finalized.
W0811 21:05:08.803807 140719884289472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:05:08.987554 140719884289472 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:05:11.864151 140719884289472 session_manager.py:500] Running local_init_op.
I0811 21:05:11.892056 140719884289472 session_manager.py:502] Done running local_init_op.
I0811 21:05:11.943183 140719884289472 tpu_estimator.py:557] Init TPU system
I0811 21:06:20.887195 140719884289472 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:06:20.888089 140719120951040 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:06:20.888474 140718630762240 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:06:20.953331 140719884289472 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:06:20.977946 140719884289472 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:06:20.978288 140719884289472 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:06:21.056826 140718622369536 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:06:21.297910 140718622369536 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:06:21.708635 140718630762240 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:06:22.016129 140719884289472 evaluation.py:167] Evaluation [10/10]
I0811 21:06:22.016542 140719884289472 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:06:22.016622 140719884289472 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:06:22.016803 140719120951040 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:06:22.016895 140719120951040 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:06:22.017031 140719884289472 error_handling.py:96] infeed marked as finished
I0811 21:06:22.017118 140719884289472 tpu_estimator.py:602] Stop output thread controller
I0811 21:06:22.017167 140719884289472 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:06:22.017282 140718630762240 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:06:22.017353 140718630762240 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:06:22.017462 140719884289472 error_handling.py:96] outfeed marked as finished
I0811 21:06:22.017546 140719884289472 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:06:51.381205 140719884289472 evaluation.py:275] Finished evaluation at 2019-08-11-21:06:51
I0811 21:06:51.381534 140719884289472 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9641, global_step = 30, loss = 0.11651595
I0811 21:06:55.666800 140719884289472 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:06:56.440184 140719884289472 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.11651595, 'global_step': 30, 'accuracy': 0.9641}

Removing gs://yangyou-mnist/log/checkpoint#1565557496068506...
Removing gs://yangyou-mnist/log/#1565557416122383...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565557429212741...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565557416.v3-8-tpu#1565557499211902...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565557492897337...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565557420743482...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565557493810560...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565557433736844...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565557428405626...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565557498291503...
Removing gs://yangyou-mnist/log/eval/#1565557612981245...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565557613.v3-8-tpu#1565557616104473...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:07:00.164453 140289368675776 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:07:00.165252 140289368675776 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:07:00.167886 140289368675776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:07:00.168711 140289368675776 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:07:00.169373 140289368675776 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:07:00.169509 140289368675776 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:07:00.571366 140289368675776 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:07:00.578063 140289368675776 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:07:00.582343 140289368675776 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:07:00.629914 140289368675776 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:07:00.630204 140289368675776 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:07:00.750371 140289368675776 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:07:00.795578 140289368675776 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:07:00.795861 140289368675776 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:07:00.957456 140289368675776 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f978425b210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f9786439190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:07:00.957871 140289368675776 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:07:01.284408 140289368675776 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:07:01.287283: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:07:01.298541 140289368675776 tpu_system_metadata.py:148] Found TPU system:
I0811 21:07:01.298831 140289368675776 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:07:01.299325 140289368675776 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:07:01.299382 140289368675776 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:07:01.299439 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:07:01.299736 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:07:01.299793 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:07:01.299844 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:07:01.299894 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:07:01.299941 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:07:01.299988 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:07:01.300040 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:07:01.300086 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:07:01.300136 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:07:01.300184 140289368675776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:07:01.306116 140289368675776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:07:01.318454 140289368675776 estimator.py:1145] Calling model_fn.
W0811 21:07:01.319051 140289368675776 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:07:01.594378 140289368675776 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:07:02.020901 140289368675776 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:07:02.082323 140289368675776 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:07:02.088007 140289368675776 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:07:02.275074 140289368675776 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:07:02.288676 140289368675776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:07:02.300407 140289368675776 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:07:02.300729 140289368675776 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:07:02.724488 140289368675776 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:07:02.739940 140289368675776 estimator.py:1147] Done calling model_fn.
I0811 21:07:06.214927 140289368675776 tpu_estimator.py:499] TPU job name worker
I0811 21:07:06.360874 140289368675776 monitored_session.py:240] Graph was finalized.
I0811 21:07:06.925750 140289368675776 session_manager.py:500] Running local_init_op.
I0811 21:07:06.954551 140289368675776 session_manager.py:502] Done running local_init_op.
I0811 21:07:09.477432 140289368675776 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:07:21.845550 140289368675776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:07:21.949230 140289368675776 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:07:21.949723 140289368675776 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:07:21.950157: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:07:21.955173 140289368675776 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:07:21.957248 140289368675776 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:07:21.960933 140289368675776 tpu_estimator.py:557] Init TPU system
I0811 21:08:04.701792 140289368675776 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 21:08:04.702857 140288676525824 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:08:04.703397 140288194508544 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:08:04.747956 140289368675776 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:08:04.748857 140289368675776 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:08:04.806189 140288186115840 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:08:04.915380 140288186115840 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 21:08:09.311729 140288194508544 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:08:13.900908 140289368675776 basic_session_run_hooks.py:262] loss = 0.50947106, step = 30
I0811 21:08:13.902962 140289368675776 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:08:27.795551 140289368675776 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:08:27.795849 140289368675776 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:08:27.796046 140288676525824 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:08:27.796168 140288676525824 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:08:27.796303 140289368675776 error_handling.py:96] infeed marked as finished
I0811 21:08:27.796395 140289368675776 tpu_estimator.py:602] Stop output thread controller
I0811 21:08:27.796442 140289368675776 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:08:27.796546 140288194508544 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:08:27.796617 140288194508544 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:08:27.796740 140289368675776 error_handling.py:96] outfeed marked as finished
I0811 21:08:27.796821 140289368675776 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:08:35.048701 140289368675776 estimator.py:368] Loss for final step: 0.50947106.
I0811 21:08:35.049499 140289368675776 error_handling.py:96] training_loop marked as finished
I0811 21:08:35.734957 140289368675776 estimator.py:1145] Calling model_fn.
E0811 21:08:36.458532 140289368675776 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:08:36.657138 140289368675776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:08:36.684871 140289368675776 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:08:36.706592 140289368675776 estimator.py:1147] Done calling model_fn.
I0811 21:08:36.723912 140289368675776 evaluation.py:255] Starting evaluation at 2019-08-11T21:08:36Z
I0811 21:08:36.724153 140289368675776 tpu_estimator.py:499] TPU job name worker
I0811 21:08:36.798954 140289368675776 monitored_session.py:240] Graph was finalized.
W0811 21:08:36.799726 140289368675776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:08:37.023335 140289368675776 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:08:39.627229 140289368675776 session_manager.py:500] Running local_init_op.
I0811 21:08:39.655319 140289368675776 session_manager.py:502] Done running local_init_op.
I0811 21:08:39.712599 140289368675776 tpu_estimator.py:557] Init TPU system
I0811 21:09:48.636490 140289368675776 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:09:48.637407 140288194508544 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:09:48.638362 140288186115840 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:09:48.708817 140289368675776 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:09:48.739727 140289368675776 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:09:48.740084 140289368675776 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:09:48.760833 140288177723136 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:09:48.957149 140288177723136 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:09:49.460386 140288186115840 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:09:49.933167 140289368675776 evaluation.py:167] Evaluation [10/10]
I0811 21:09:49.933522 140289368675776 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:09:49.933629 140289368675776 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:09:49.933794 140288194508544 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:09:49.933911 140288194508544 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:09:49.934048 140289368675776 error_handling.py:96] infeed marked as finished
I0811 21:09:49.934132 140289368675776 tpu_estimator.py:602] Stop output thread controller
I0811 21:09:49.934179 140289368675776 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:09:49.934283 140288186115840 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:09:49.934365 140288186115840 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:09:49.934479 140289368675776 error_handling.py:96] outfeed marked as finished
I0811 21:09:49.934555 140289368675776 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:10:19.048122 140289368675776 evaluation.py:275] Finished evaluation at 2019-08-11-21:10:19
I0811 21:10:19.048485 140289368675776 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8694, global_step = 30, loss = 0.43944663
I0811 21:10:23.419843 140289368675776 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:10:24.210822 140289368675776 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.43944663, 'global_step': 30, 'accuracy': 0.8694}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565557636965402...
Removing gs://yangyou-mnist/log/#1565557624244025...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565557641339600...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565557624.v3-8-tpu#1565557707457192...
Removing gs://yangyou-mnist/log/checkpoint#1565557704282707...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565557701985906...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565557628908968...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565557701102313...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565557636090591...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565557706419970...
Removing gs://yangyou-mnist/log/eval/#1565557820736699...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565557820.v3-8-tpu#1565557823871222...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:10:28.018663 139917398988224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:10:28.019418 139917398988224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:10:28.022047 139917398988224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:10:28.022867 139917398988224 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:10:28.023452 139917398988224 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:10:28.023590 139917398988224 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:10:28.449795 139917398988224 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:10:28.456252 139917398988224 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:10:28.460038 139917398988224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:10:28.555265 139917398988224 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:10:28.555546 139917398988224 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:10:28.665671 139917398988224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:10:28.712265 139917398988224 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:10:28.712553 139917398988224 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:10:28.960230 139917398988224 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f40e906b090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f40eb249190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:10:28.960609 139917398988224 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:10:29.284723 139917398988224 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:10:29.287827: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:10:29.299758 139917398988224 tpu_system_metadata.py:148] Found TPU system:
I0811 21:10:29.299982 139917398988224 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:10:29.300506 139917398988224 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:10:29.300564 139917398988224 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:10:29.300638 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:10:29.300923 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:10:29.300978 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:10:29.301028 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:10:29.301079 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:10:29.301129 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:10:29.301175 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:10:29.301220 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:10:29.301265 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:10:29.301316 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:10:29.301364 139917398988224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:10:29.307379 139917398988224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:10:29.319931 139917398988224 estimator.py:1145] Calling model_fn.
W0811 21:10:29.320537 139917398988224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:10:29.584137 139917398988224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:10:30.005410 139917398988224 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:10:30.068367 139917398988224 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:10:30.074688 139917398988224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:10:30.259224 139917398988224 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:10:30.272912 139917398988224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:10:30.285166 139917398988224 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:10:30.285480 139917398988224 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:10:30.714992 139917398988224 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:10:30.730235 139917398988224 estimator.py:1147] Done calling model_fn.
I0811 21:10:34.728202 139917398988224 tpu_estimator.py:499] TPU job name worker
I0811 21:10:34.839059 139917398988224 monitored_session.py:240] Graph was finalized.
I0811 21:10:35.452912 139917398988224 session_manager.py:500] Running local_init_op.
I0811 21:10:35.490478 139917398988224 session_manager.py:502] Done running local_init_op.
I0811 21:10:38.009697 139917398988224 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:10:50.389226 139917398988224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:10:50.501461 139917398988224 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:10:50.502005 139917398988224 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:10:50.502377: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:10:50.507247 139917398988224 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:10:50.509481 139917398988224 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:10:50.513308 139917398988224 tpu_estimator.py:557] Init TPU system
I0811 21:11:32.690649 139917398988224 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 21:11:32.691775 139916639713024 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:11:32.692712 139916631320320 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:11:32.736686 139917398988224 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:11:32.737663 139917398988224 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:11:32.751815 139916622927616 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:11:32.908102 139916622927616 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 21:11:37.163043 139916631320320 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:11:41.760499 139917398988224 basic_session_run_hooks.py:262] loss = 2.3047333, step = 30
I0811 21:11:41.762563 139917398988224 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:11:57.221658 139917398988224 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:11:57.221977 139917398988224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:11:57.222198 139916639713024 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:11:57.222337 139916639713024 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:11:57.222479 139917398988224 error_handling.py:96] infeed marked as finished
I0811 21:11:57.222570 139917398988224 tpu_estimator.py:602] Stop output thread controller
I0811 21:11:57.222635 139917398988224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:11:57.222743 139916631320320 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:11:57.222815 139916631320320 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:11:57.222932 139917398988224 error_handling.py:96] outfeed marked as finished
I0811 21:11:57.223012 139917398988224 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:12:03.032387 139917398988224 estimator.py:368] Loss for final step: 2.3047333.
I0811 21:12:03.033149 139917398988224 error_handling.py:96] training_loop marked as finished
I0811 21:12:03.722023 139917398988224 estimator.py:1145] Calling model_fn.
E0811 21:12:04.405006 139917398988224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:12:04.605357 139917398988224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:12:04.634852 139917398988224 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:12:04.658066 139917398988224 estimator.py:1147] Done calling model_fn.
I0811 21:12:04.675964 139917398988224 evaluation.py:255] Starting evaluation at 2019-08-11T21:12:04Z
I0811 21:12:04.676218 139917398988224 tpu_estimator.py:499] TPU job name worker
I0811 21:12:04.753254 139917398988224 monitored_session.py:240] Graph was finalized.
W0811 21:12:04.754028 139917398988224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:12:04.940738 139917398988224 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:12:07.763973 139917398988224 session_manager.py:500] Running local_init_op.
I0811 21:12:07.786561 139917398988224 session_manager.py:502] Done running local_init_op.
I0811 21:12:07.837964 139917398988224 tpu_estimator.py:557] Init TPU system
I0811 21:13:16.678785 139917398988224 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:13:16.679694 139916635780864 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:13:16.680108 139916627388160 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:13:16.747221 139917398988224 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:13:16.769364 139917398988224 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:13:16.769768 139917398988224 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:13:16.845407 139916142966528 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:13:17.044095 139916142966528 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:13:17.527420 139916627388160 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:13:17.835565 139917398988224 evaluation.py:167] Evaluation [10/10]
I0811 21:13:17.835903 139917398988224 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:13:17.835974 139917398988224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:13:17.836219 139916635780864 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:13:17.836570 139916635780864 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:13:17.836865 139917398988224 error_handling.py:96] infeed marked as finished
I0811 21:13:17.837075 139917398988224 tpu_estimator.py:602] Stop output thread controller
I0811 21:13:17.837153 139917398988224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:13:17.837372 139916627388160 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:13:17.837559 139916627388160 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:13:17.837841 139917398988224 error_handling.py:96] outfeed marked as finished
I0811 21:13:17.838001 139917398988224 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:13:47.139070 139917398988224 evaluation.py:275] Finished evaluation at 2019-08-11-21:13:47
I0811 21:13:47.139447 139917398988224 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.298782
I0811 21:13:51.459376 139917398988224 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:13:52.345822 139917398988224 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.298782, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565557832184411...
Removing gs://yangyou-mnist/log/checkpoint#1565557913800526...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565557845556568...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565557849880775...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565557910726895...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565557832.v3-8-tpu#1565557916885980...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565557911647367...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565557837449041...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565557844288644...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565557915922386...
Removing gs://yangyou-mnist/log/eval/#1565558028745665...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565558028.v3-8-tpu#1565558031993477...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:13:56.015398 139868249269696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:13:56.016175 139868249269696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:13:56.018718 139868249269696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:13:56.019522 139868249269696 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:13:56.020092 139868249269696 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:13:56.020231 139868249269696 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:13:56.431865 139868249269696 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:13:56.438083 139868249269696 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:13:56.441791 139868249269696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:13:56.487507 139868249269696 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:13:56.487781 139868249269696 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:13:56.642724 139868249269696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:13:56.690052 139868249269696 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:13:56.690321 139868249269696 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:13:56.791829 139868249269696 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3577798190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3579976190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:13:56.792184 139868249269696 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:13:57.113511 139868249269696 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:13:57.116416: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:13:57.128051 139868249269696 tpu_system_metadata.py:148] Found TPU system:
I0811 21:13:57.128295 139868249269696 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:13:57.128833 139868249269696 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:13:57.128937 139868249269696 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:13:57.128999 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:13:57.129298 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:13:57.129374 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:13:57.129436 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:13:57.129486 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:13:57.129537 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:13:57.129620 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:13:57.129692 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:13:57.129744 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:13:57.129791 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:13:57.129838 139868249269696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:13:57.135799 139868249269696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:13:57.147933 139868249269696 estimator.py:1145] Calling model_fn.
W0811 21:13:57.148502 139868249269696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:13:57.420376 139868249269696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:13:57.839298 139868249269696 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:13:57.899821 139868249269696 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:13:57.905529 139868249269696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:13:58.081768 139868249269696 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:13:58.094934 139868249269696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:13:58.106580 139868249269696 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:13:58.106884 139868249269696 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:13:58.524570 139868249269696 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:13:58.539800 139868249269696 estimator.py:1147] Done calling model_fn.
I0811 21:14:02.541145 139868249269696 tpu_estimator.py:499] TPU job name worker
I0811 21:14:02.652117 139868249269696 monitored_session.py:240] Graph was finalized.
I0811 21:14:03.219316 139868249269696 session_manager.py:500] Running local_init_op.
I0811 21:14:03.249202 139868249269696 session_manager.py:502] Done running local_init_op.
I0811 21:14:05.689085 139868249269696 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:14:19.201564 139868249269696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:14:19.318907 139868249269696 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:14:19.319377 139868249269696 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:14:19.320755: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:14:19.326004 139868249269696 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:14:19.328072 139868249269696 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:14:19.332071 139868249269696 tpu_estimator.py:557] Init TPU system
I0811 21:15:00.688913 139868249269696 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0811 21:15:00.689970 139867220604672 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:15:00.690685 139867212211968 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:15:00.734347 139868249269696 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:15:00.735234 139868249269696 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:15:00.746004 139867203819264 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:15:00.853475 139867203819264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:15:05.214875 139867212211968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:15:09.969898 139868249269696 basic_session_run_hooks.py:262] loss = 0.5934849, step = 30
I0811 21:15:09.972745 139868249269696 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:15:23.688627 139868249269696 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:15:23.688935 139868249269696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:15:23.690450 139867220604672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:15:23.690718 139867220604672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:15:23.691032 139868249269696 error_handling.py:96] infeed marked as finished
I0811 21:15:23.691241 139868249269696 tpu_estimator.py:602] Stop output thread controller
I0811 21:15:23.691301 139868249269696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:15:23.691457 139867212211968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:15:23.691612 139867212211968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:15:23.691790 139868249269696 error_handling.py:96] outfeed marked as finished
I0811 21:15:23.691967 139868249269696 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:15:30.988027 139868249269696 estimator.py:368] Loss for final step: 0.5934849.
I0811 21:15:30.988817 139868249269696 error_handling.py:96] training_loop marked as finished
I0811 21:15:31.807351 139868249269696 estimator.py:1145] Calling model_fn.
E0811 21:15:32.485666 139868249269696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:15:32.676830 139868249269696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:15:32.704170 139868249269696 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:15:32.725213 139868249269696 estimator.py:1147] Done calling model_fn.
I0811 21:15:32.742798 139868249269696 evaluation.py:255] Starting evaluation at 2019-08-11T21:15:32Z
I0811 21:15:32.743036 139868249269696 tpu_estimator.py:499] TPU job name worker
I0811 21:15:32.818181 139868249269696 monitored_session.py:240] Graph was finalized.
W0811 21:15:32.818947 139868249269696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:15:33.007816 139868249269696 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:15:35.598985 139868249269696 session_manager.py:500] Running local_init_op.
I0811 21:15:35.622715 139868249269696 session_manager.py:502] Done running local_init_op.
I0811 21:15:35.675503 139868249269696 tpu_estimator.py:557] Init TPU system
I0811 21:16:44.614845 139868249269696 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:16:44.615768 139867217196800 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:16:44.616215 139867208804096 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:16:44.679358 139868249269696 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:16:44.702672 139868249269696 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:16:44.703068 139868249269696 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:16:44.736452 139867200411392 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:16:44.857438 139867200411392 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:16:45.398248 139867208804096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:16:45.894700 139868249269696 evaluation.py:167] Evaluation [10/10]
I0811 21:16:45.895045 139868249269696 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:16:45.895126 139868249269696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:16:45.895315 139867217196800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:16:45.895407 139867217196800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:16:45.895544 139868249269696 error_handling.py:96] infeed marked as finished
I0811 21:16:45.895632 139868249269696 tpu_estimator.py:602] Stop output thread controller
I0811 21:16:45.895678 139868249269696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:16:45.895781 139867208804096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:16:45.895849 139867208804096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:16:45.895992 139868249269696 error_handling.py:96] outfeed marked as finished
I0811 21:16:45.896069 139868249269696 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:17:14.946757 139868249269696 evaluation.py:275] Finished evaluation at 2019-08-11-21:17:14
I0811 21:17:14.947112 139868249269696 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8568, global_step = 30, loss = 0.49529806
I0811 21:17:19.645795 139868249269696 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:17:20.484179 139868249269696 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.49529806, 'global_step': 30, 'accuracy': 0.8568}

Removing gs://yangyou-mnist/log/#1565558040248209...
Removing gs://yangyou-mnist/log/checkpoint#1565558119920814...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565558058682754...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565558040.v3-8-tpu#1565558123351864...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565558116681878...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565558052488747...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565558045119053...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565558053385500...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565558117577152...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565558122269525...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565558237.v3-8-tpu#1565558240126078...
Removing gs://yangyou-mnist/log/eval/#1565558236801760...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:17:24.315407 140150459946432 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:17:24.316203 140150459946432 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:17:24.318861 140150459946432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:17:24.319747 140150459946432 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:17:24.320375 140150459946432 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:17:24.320518 140150459946432 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:17:24.757812 140150459946432 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:17:24.764096 140150459946432 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:17:24.767673 140150459946432 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:17:24.814378 140150459946432 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:17:24.814668 140150459946432 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:17:25.046967 140150459946432 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:17:25.095046 140150459946432 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:17:25.095321 140150459946432 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:17:25.272839 140150459946432 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f772c8ab210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f772ea89190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:17:25.273181 140150459946432 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:17:25.597806 140150459946432 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:17:25.600899: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:17:25.613821 140150459946432 tpu_system_metadata.py:148] Found TPU system:
I0811 21:17:25.614064 140150459946432 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:17:25.614572 140150459946432 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:17:25.614629 140150459946432 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:17:25.614682 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:17:25.614969 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:17:25.615032 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:17:25.615115 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:17:25.615164 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:17:25.615211 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:17:25.615258 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:17:25.615305 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:17:25.615351 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:17:25.615397 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:17:25.615444 140150459946432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:17:25.621573 140150459946432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:17:25.634263 140150459946432 estimator.py:1145] Calling model_fn.
W0811 21:17:25.634902 140150459946432 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:17:25.913454 140150459946432 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:17:26.382617 140150459946432 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:17:26.444295 140150459946432 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:17:26.450443 140150459946432 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:17:26.626996 140150459946432 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:17:26.640738 140150459946432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:17:26.652582 140150459946432 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:17:26.652901 140150459946432 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:17:27.071923 140150459946432 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:17:27.087280 140150459946432 estimator.py:1147] Done calling model_fn.
I0811 21:17:30.500982 140150459946432 tpu_estimator.py:499] TPU job name worker
I0811 21:17:30.611718 140150459946432 monitored_session.py:240] Graph was finalized.
I0811 21:17:31.162411 140150459946432 session_manager.py:500] Running local_init_op.
I0811 21:17:31.200752 140150459946432 session_manager.py:502] Done running local_init_op.
I0811 21:17:33.725606 140150459946432 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:17:45.810071 140150459946432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:17:45.929476 140150459946432 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:17:45.930006 140150459946432 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:17:45.930442: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:17:45.935803 140150459946432 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:17:45.938021 140150459946432 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:17:45.941936 140150459946432 tpu_estimator.py:557] Init TPU system
I0811 21:18:29.289299 140150459946432 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 21:18:29.290260 140149700667136 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:18:29.290782 140149692274432 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:18:29.334013 140150459946432 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:18:29.334835 140150459946432 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:18:29.347837 140149212051200 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:18:29.590112 140149212051200 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:18:33.970076 140149692274432 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:18:38.681248 140150459946432 basic_session_run_hooks.py:262] loss = 2.305788, step = 30
I0811 21:18:38.683618 140150459946432 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:18:52.214407 140150459946432 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:18:52.214725 140150459946432 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:18:52.216379 140149700667136 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:18:52.216696 140149700667136 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:18:52.216969 140150459946432 error_handling.py:96] infeed marked as finished
I0811 21:18:52.217220 140150459946432 tpu_estimator.py:602] Stop output thread controller
I0811 21:18:52.217294 140150459946432 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:18:52.217504 140149692274432 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:18:52.217756 140149692274432 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:18:52.218056 140150459946432 error_handling.py:96] outfeed marked as finished
I0811 21:18:52.218236 140150459946432 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:18:59.721216 140150459946432 estimator.py:368] Loss for final step: 2.305788.
I0811 21:18:59.722029 140150459946432 error_handling.py:96] training_loop marked as finished
I0811 21:19:00.423860 140150459946432 estimator.py:1145] Calling model_fn.
E0811 21:19:01.128813 140150459946432 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:19:01.322495 140150459946432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:19:01.349663 140150459946432 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:19:01.370089 140150459946432 estimator.py:1147] Done calling model_fn.
I0811 21:19:01.386410 140150459946432 evaluation.py:255] Starting evaluation at 2019-08-11T21:19:01Z
I0811 21:19:01.386641 140150459946432 tpu_estimator.py:499] TPU job name worker
I0811 21:19:01.460483 140150459946432 monitored_session.py:240] Graph was finalized.
W0811 21:19:01.461209 140150459946432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:19:01.662909 140150459946432 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:19:04.130826 140150459946432 session_manager.py:500] Running local_init_op.
I0811 21:19:04.153862 140150459946432 session_manager.py:502] Done running local_init_op.
I0811 21:19:04.207176 140150459946432 tpu_estimator.py:557] Init TPU system
I0811 21:20:12.687089 140150459946432 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:20:12.688122 140149696734976 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:20:12.689531 140149212051200 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:20:12.757292 140150459946432 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:20:12.781858 140150459946432 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:20:12.782202 140150459946432 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:20:12.812745 140149203658496 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:20:12.936451 140149203658496 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:20:13.517271 140149212051200 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:20:13.892117 140150459946432 evaluation.py:167] Evaluation [10/10]
I0811 21:20:13.892505 140150459946432 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:20:13.892601 140150459946432 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:20:13.892863 140149696734976 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:20:13.893141 140149696734976 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:20:13.893322 140150459946432 error_handling.py:96] infeed marked as finished
I0811 21:20:13.893520 140150459946432 tpu_estimator.py:602] Stop output thread controller
I0811 21:20:13.893609 140150459946432 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:20:13.893769 140149212051200 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:20:13.893950 140149212051200 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:20:13.894094 140150459946432 error_handling.py:96] outfeed marked as finished
I0811 21:20:13.894217 140150459946432 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:20:43.034761 140150459946432 evaluation.py:275] Finished evaluation at 2019-08-11-21:20:43
I0811 21:20:43.035094 140150459946432 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3030572
I0811 21:20:47.276447 140150459946432 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:20:48.290414 140150459946432 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3030572, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565558248584490...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565558260900329...
Removing gs://yangyou-mnist/log/checkpoint#1565558328488331...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565558248.v3-8-tpu#1565558331873954...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565558265289719...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565558326152497...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565558260066172...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565558325277088...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565558253151344...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565558330659986...
Removing gs://yangyou-mnist/log/eval/#1565558444612160...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565558444.v3-8-tpu#1565558447955055...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:20:52.073126 140479693436352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:20:52.073973 140479693436352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:20:52.076586 140479693436352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:20:52.077395 140479693436352 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:20:52.078131 140479693436352 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:20:52.078289 140479693436352 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:20:52.508244 140479693436352 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:20:52.514815 140479693436352 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:20:52.518573 140479693436352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:20:52.566509 140479693436352 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:20:52.566783 140479693436352 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:20:52.672065 140479693436352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:20:52.718486 140479693436352 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:20:52.718761 140479693436352 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:20:52.829519 140479693436352 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc3d46311d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc3d680f150>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:20:52.829920 140479693436352 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:20:53.190910 140479693436352 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:20:53.193917: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:20:53.206022 140479693436352 tpu_system_metadata.py:148] Found TPU system:
I0811 21:20:53.206264 140479693436352 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:20:53.206777 140479693436352 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:20:53.206836 140479693436352 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:20:53.206891 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:20:53.207181 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:20:53.207241 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:20:53.207293 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:20:53.207340 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:20:53.207405 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:20:53.207453 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:20:53.207504 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:20:53.207551 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:20:53.207597 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:20:53.207647 140479693436352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:20:53.213689 140479693436352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:20:53.226233 140479693436352 estimator.py:1145] Calling model_fn.
W0811 21:20:53.226843 140479693436352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:20:53.502578 140479693436352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:20:53.937010 140479693436352 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:20:53.997406 140479693436352 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:20:54.003124 140479693436352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:20:54.181843 140479693436352 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:20:54.196105 140479693436352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:20:54.208280 140479693436352 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:20:54.208600 140479693436352 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:20:54.658472 140479693436352 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:20:54.673903 140479693436352 estimator.py:1147] Done calling model_fn.
I0811 21:20:57.916255 140479693436352 tpu_estimator.py:499] TPU job name worker
I0811 21:20:58.031527 140479693436352 monitored_session.py:240] Graph was finalized.
I0811 21:20:58.584244 140479693436352 session_manager.py:500] Running local_init_op.
I0811 21:20:58.625408 140479693436352 session_manager.py:502] Done running local_init_op.
I0811 21:21:01.027156 140479693436352 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:21:13.519001 140479693436352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:21:13.622371 140479693436352 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:21:13.622832 140479693436352 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:21:13.623237: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:21:13.627830 140479693436352 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:21:13.630081 140479693436352 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:21:13.635675 140479693436352 tpu_estimator.py:557] Init TPU system
I0811 21:21:56.685529 140479693436352 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 21:21:56.686768 140479001286400 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:21:56.687588 140478515246848 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:21:56.730268 140479693436352 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:21:56.731255 140479693436352 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:21:56.742136 140478506854144 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:21:56.855531 140478506854144 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:22:01.136528 140478515246848 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:22:05.521716 140479693436352 basic_session_run_hooks.py:262] loss = 2.306142, step = 30
I0811 21:22:05.523425 140479693436352 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:22:19.549952 140479693436352 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:22:19.550268 140479693436352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:22:19.551809 140479001286400 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:22:19.552109 140479001286400 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:22:19.552342 140479693436352 error_handling.py:96] infeed marked as finished
I0811 21:22:19.552547 140479693436352 tpu_estimator.py:602] Stop output thread controller
I0811 21:22:19.552611 140479693436352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:22:19.552846 140478515246848 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:22:19.553041 140478515246848 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:22:19.553235 140479693436352 error_handling.py:96] outfeed marked as finished
I0811 21:22:19.553402 140479693436352 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:22:26.984819 140479693436352 estimator.py:368] Loss for final step: 2.306142.
I0811 21:22:26.985724 140479693436352 error_handling.py:96] training_loop marked as finished
I0811 21:22:27.799521 140479693436352 estimator.py:1145] Calling model_fn.
E0811 21:22:28.479604 140479693436352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:22:28.672070 140479693436352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:22:28.699784 140479693436352 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:22:28.720797 140479693436352 estimator.py:1147] Done calling model_fn.
I0811 21:22:28.738078 140479693436352 evaluation.py:255] Starting evaluation at 2019-08-11T21:22:28Z
I0811 21:22:28.738323 140479693436352 tpu_estimator.py:499] TPU job name worker
I0811 21:22:28.813148 140479693436352 monitored_session.py:240] Graph was finalized.
W0811 21:22:28.813916 140479693436352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:22:28.998127 140479693436352 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:22:31.537936 140479693436352 session_manager.py:500] Running local_init_op.
I0811 21:22:31.565249 140479693436352 session_manager.py:502] Done running local_init_op.
I0811 21:22:31.614196 140479693436352 tpu_estimator.py:557] Init TPU system
I0811 21:23:40.598779 140479693436352 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:23:40.599904 140478515246848 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:23:40.600634 140478506854144 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:23:40.667032 140479693436352 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:23:40.701016 140479693436352 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:23:40.701392 140479693436352 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:23:40.721921 140478498461440 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:23:40.858603 140478498461440 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:23:41.415432 140478506854144 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:23:41.891088 140479693436352 evaluation.py:167] Evaluation [10/10]
I0811 21:23:41.891443 140479693436352 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:23:41.891513 140479693436352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:23:41.891746 140478515246848 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:23:41.892010 140478515246848 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:23:41.892249 140479693436352 error_handling.py:96] infeed marked as finished
I0811 21:23:41.892447 140479693436352 tpu_estimator.py:602] Stop output thread controller
I0811 21:23:41.892513 140479693436352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:23:41.892704 140478506854144 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:23:41.892904 140478506854144 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:23:41.893075 140479693436352 error_handling.py:96] outfeed marked as finished
I0811 21:23:41.893207 140479693436352 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:24:10.948702 140479693436352 evaluation.py:275] Finished evaluation at 2019-08-11-21:24:10
I0811 21:24:10.949079 140479693436352 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 2.3030572
I0811 21:24:15.459065 140479693436352 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:24:16.238770 140479693436352 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3030572, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/#1565558456079234...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565558468372561...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565558456.v3-8-tpu#1565558539212974...
Removing gs://yangyou-mnist/log/checkpoint#1565558535945488...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565558460463349...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565558473012039...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565558532591324...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565558467465273...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565558533551981...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565558538235994...
Removing gs://yangyou-mnist/log/eval/#1565558652545803...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565558652.v3-8-tpu#1565558655896164...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:24:20.034485 139936307303872 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:24:20.035273 139936307303872 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:24:20.037867 139936307303872 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:24:20.038671 139936307303872 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:24:20.039254 139936307303872 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:24:20.039383 139936307303872 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:24:20.460433 139936307303872 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:24:20.467320 139936307303872 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:24:20.470966 139936307303872 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:24:20.562334 139936307303872 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:24:20.562647 139936307303872 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:24:20.676659 139936307303872 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:24:20.768080 139936307303872 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:24:20.768363 139936307303872 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:24:20.850570 139936307303872 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f45500b4510>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f45522a9190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:24:20.850935 139936307303872 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:24:21.176562 139936307303872 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:24:21.179491: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:24:21.192384 139936307303872 tpu_system_metadata.py:148] Found TPU system:
I0811 21:24:21.192663 139936307303872 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:24:21.193218 139936307303872 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:24:21.193299 139936307303872 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:24:21.193367 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:24:21.193721 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:24:21.193794 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:24:21.193859 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:24:21.193908 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:24:21.193962 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:24:21.194010 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:24:21.194077 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:24:21.194123 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:24:21.194170 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:24:21.194219 139936307303872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:24:21.200541 139936307303872 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:24:21.213769 139936307303872 estimator.py:1145] Calling model_fn.
W0811 21:24:21.214401 139936307303872 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:24:21.486368 139936307303872 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:24:21.912796 139936307303872 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:24:21.975096 139936307303872 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:24:21.981036 139936307303872 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:24:22.159161 139936307303872 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:24:22.172964 139936307303872 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:24:22.184693 139936307303872 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:24:22.185015 139936307303872 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:24:22.613059 139936307303872 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:24:22.628530 139936307303872 estimator.py:1147] Done calling model_fn.
I0811 21:24:26.005501 139936307303872 tpu_estimator.py:499] TPU job name worker
I0811 21:24:26.119072 139936307303872 monitored_session.py:240] Graph was finalized.
I0811 21:24:26.663404 139936307303872 session_manager.py:500] Running local_init_op.
I0811 21:24:26.695441 139936307303872 session_manager.py:502] Done running local_init_op.
I0811 21:24:29.191802 139936307303872 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:24:41.218158 139936307303872 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:24:41.331947 139936307303872 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:24:41.332408 139936307303872 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:24:41.332857: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:24:41.338108 139936307303872 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:24:41.340204 139936307303872 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:24:41.347656 139936307303872 tpu_estimator.py:557] Init TPU system
I0811 21:25:24.545239 139936307303872 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 21:25:24.546391 139935615153920 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:25:24.547482 139935134775040 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:25:24.590416 139936307303872 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:25:24.591511 139936307303872 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:25:24.682133 139935126382336 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:25:24.799995 139935126382336 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:25:29.362766 139935134775040 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:25:33.965254 139936307303872 basic_session_run_hooks.py:262] loss = 1.0907081, step = 30
I0811 21:25:33.968152 139936307303872 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:25:47.259896 139936307303872 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:25:47.260217 139936307303872 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:25:47.260459 139935615153920 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:25:47.260575 139935615153920 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:25:47.260730 139936307303872 error_handling.py:96] infeed marked as finished
I0811 21:25:47.260843 139936307303872 tpu_estimator.py:602] Stop output thread controller
I0811 21:25:47.260898 139936307303872 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:25:47.261018 139935134775040 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:25:47.261094 139935134775040 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:25:47.261214 139936307303872 error_handling.py:96] outfeed marked as finished
I0811 21:25:47.261305 139936307303872 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:25:54.914932 139936307303872 estimator.py:368] Loss for final step: 1.0907081.
I0811 21:25:54.915762 139936307303872 error_handling.py:96] training_loop marked as finished
I0811 21:25:55.711019 139936307303872 estimator.py:1145] Calling model_fn.
E0811 21:25:56.421315 139936307303872 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:25:56.610822 139936307303872 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:25:56.638400 139936307303872 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:25:56.660202 139936307303872 estimator.py:1147] Done calling model_fn.
I0811 21:25:56.677218 139936307303872 evaluation.py:255] Starting evaluation at 2019-08-11T21:25:56Z
I0811 21:25:56.677464 139936307303872 tpu_estimator.py:499] TPU job name worker
I0811 21:25:56.751871 139936307303872 monitored_session.py:240] Graph was finalized.
W0811 21:25:56.752671 139936307303872 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:25:56.936837 139936307303872 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:25:59.603313 139936307303872 session_manager.py:500] Running local_init_op.
I0811 21:25:59.627527 139936307303872 session_manager.py:502] Done running local_init_op.
I0811 21:25:59.686074 139936307303872 tpu_estimator.py:557] Init TPU system
I0811 21:27:08.634623 139936307303872 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:27:08.635647 139935134775040 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:27:08.636328 139935126382336 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:27:08.716114 139936307303872 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:27:08.741234 139936307303872 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:27:08.741580 139936307303872 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:27:08.778053 139935117989632 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:27:08.927428 139935117989632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:27:09.502882 139935126382336 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:27:09.782416 139936307303872 evaluation.py:167] Evaluation [10/10]
I0811 21:27:09.782764 139936307303872 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:27:09.782833 139936307303872 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:27:09.783123 139935134775040 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:27:09.783399 139935134775040 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:27:09.783586 139936307303872 error_handling.py:96] infeed marked as finished
I0811 21:27:09.783746 139936307303872 tpu_estimator.py:602] Stop output thread controller
I0811 21:27:09.783797 139936307303872 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:27:09.784061 139935126382336 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:27:09.784234 139935126382336 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:27:09.784408 139936307303872 error_handling.py:96] outfeed marked as finished
I0811 21:27:09.784542 139936307303872 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:27:39.032227 139936307303872 evaluation.py:275] Finished evaluation at 2019-08-11-21:27:39
I0811 21:27:39.032593 139936307303872 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8227, global_step = 30, loss = 1.0177771
I0811 21:27:43.970074 139936307303872 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:27:44.762939 139936307303872 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.0177771, 'global_step': 30, 'accuracy': 0.8227}

Removing gs://yangyou-mnist/log/#1565558664069135...
Removing gs://yangyou-mnist/log/checkpoint#1565558743650058...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565558676235556...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565558664.v3-8-tpu#1565558746902933...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565558680645522...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565558668631562...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565558675284281...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565558740657827...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565558741516971...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565558746003182...
Removing gs://yangyou-mnist/log/eval/#1565558860615855...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565558860.v3-8-tpu#1565558864427023...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:27:48.668389 140650246190528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:27:48.669176 140650246190528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:27:48.671895 140650246190528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:27:48.672700 140650246190528 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:27:48.673368 140650246190528 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:27:48.673495 140650246190528 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:27:49.088174 140650246190528 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:27:49.094561 140650246190528 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:27:49.098217 140650246190528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:27:49.144892 140650246190528 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:27:49.145159 140650246190528 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:27:49.267054 140650246190528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:27:49.314846 140650246190528 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:27:49.315121 140650246190528 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:27:49.512973 140650246190528 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7feb8a1e2290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7feb8c3d7190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:27:49.513326 140650246190528 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:27:49.839490 140650246190528 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:27:49.842698: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:27:49.855441 140650246190528 tpu_system_metadata.py:148] Found TPU system:
I0811 21:27:49.855674 140650246190528 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:27:49.856183 140650246190528 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:27:49.856241 140650246190528 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:27:49.856296 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:27:49.856580 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:27:49.856637 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:27:49.856688 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:27:49.856745 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:27:49.856795 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:27:49.856842 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:27:49.856889 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:27:49.856950 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:27:49.856997 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:27:49.857047 140650246190528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:27:49.863153 140650246190528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:27:49.875358 140650246190528 estimator.py:1145] Calling model_fn.
W0811 21:27:49.875962 140650246190528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:27:50.139678 140650246190528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:27:50.567368 140650246190528 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:27:50.629579 140650246190528 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:27:50.635854 140650246190528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:27:50.806319 140650246190528 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:27:50.819416 140650246190528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:27:50.830704 140650246190528 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:27:50.831006 140650246190528 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:27:51.245321 140650246190528 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:27:51.260889 140650246190528 estimator.py:1147] Done calling model_fn.
I0811 21:27:54.677216 140650246190528 tpu_estimator.py:499] TPU job name worker
I0811 21:27:54.796741 140650246190528 monitored_session.py:240] Graph was finalized.
I0811 21:27:55.349608 140650246190528 session_manager.py:500] Running local_init_op.
I0811 21:27:55.379208 140650246190528 session_manager.py:502] Done running local_init_op.
I0811 21:27:57.944853 140650246190528 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:28:10.023395 140650246190528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:28:10.135394 140650246190528 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:28:10.135840 140650246190528 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:28:10.136284: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:28:10.141228 140650246190528 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:28:10.143301 140650246190528 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:28:10.147228 140650246190528 tpu_estimator.py:557] Init TPU system
I0811 21:28:52.815638 140650246190528 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 21:28:52.816735 140649352648448 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:28:52.817519 140649344255744 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:28:52.859069 140650246190528 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:28:52.859999 140650246190528 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:28:52.870915 140649335863040 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:28:53.014345 140649335863040 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:28:57.464648 140649344255744 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:29:02.022857 140650246190528 basic_session_run_hooks.py:262] loss = 0.5016487, step = 30
I0811 21:29:02.025221 140650246190528 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:29:15.287269 140650246190528 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:29:15.287718 140650246190528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:29:15.287990 140649352648448 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:29:15.288088 140649352648448 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:29:15.288237 140650246190528 error_handling.py:96] infeed marked as finished
I0811 21:29:15.288337 140650246190528 tpu_estimator.py:602] Stop output thread controller
I0811 21:29:15.288389 140650246190528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:29:15.288501 140649344255744 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:29:15.288578 140649344255744 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:29:15.288691 140650246190528 error_handling.py:96] outfeed marked as finished
I0811 21:29:15.288779 140650246190528 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:29:23.145226 140650246190528 estimator.py:368] Loss for final step: 0.5016487.
I0811 21:29:23.146148 140650246190528 error_handling.py:96] training_loop marked as finished
I0811 21:29:23.951139 140650246190528 estimator.py:1145] Calling model_fn.
E0811 21:29:24.736375 140650246190528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:29:24.928890 140650246190528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:29:24.955862 140650246190528 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:29:24.976862 140650246190528 estimator.py:1147] Done calling model_fn.
I0811 21:29:24.994227 140650246190528 evaluation.py:255] Starting evaluation at 2019-08-11T21:29:24Z
I0811 21:29:24.994466 140650246190528 tpu_estimator.py:499] TPU job name worker
I0811 21:29:25.070158 140650246190528 monitored_session.py:240] Graph was finalized.
W0811 21:29:25.070918 140650246190528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:29:25.257205 140650246190528 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:29:27.782875 140650246190528 session_manager.py:500] Running local_init_op.
I0811 21:29:27.807068 140650246190528 session_manager.py:502] Done running local_init_op.
I0811 21:29:27.853507 140650246190528 tpu_estimator.py:557] Init TPU system
I0811 21:30:36.655735 140650246190528 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:30:36.656686 140649348716288 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:30:36.657243 140649340323584 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:30:36.740765 140650246190528 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:30:36.773385 140650246190528 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:30:36.773844 140650246190528 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:30:36.797518 140649327208192 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:30:36.909842 140649327208192 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:30:37.564168 140649340323584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:30:37.876631 140650246190528 evaluation.py:167] Evaluation [10/10]
I0811 21:30:37.877012 140650246190528 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:30:37.877090 140650246190528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:30:37.877307 140649348716288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:30:37.877449 140649348716288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:30:37.877665 140650246190528 error_handling.py:96] infeed marked as finished
I0811 21:30:37.877768 140650246190528 tpu_estimator.py:602] Stop output thread controller
I0811 21:30:37.877820 140650246190528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:30:37.877929 140649340323584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:30:37.878004 140649340323584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:30:37.878114 140650246190528 error_handling.py:96] outfeed marked as finished
I0811 21:30:37.878192 140650246190528 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:31:07.004426 140650246190528 evaluation.py:275] Finished evaluation at 2019-08-11-21:31:07
I0811 21:31:07.004777 140650246190528 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8857, global_step = 30, loss = 0.4616819
I0811 21:31:11.240704 140650246190528 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:31:12.097224 140650246190528 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.4616819, 'global_step': 30, 'accuracy': 0.8857}

Removing gs://yangyou-mnist/log/events.out.tfevents.1565558872.v3-8-tpu#1565558954952220...
Removing gs://yangyou-mnist/log/checkpoint#1565558951676966...
Removing gs://yangyou-mnist/log/#1565558872780452...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565558877390196...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565558948674302...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565558949512300...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565558884980814...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565558889517700...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565558884154841...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565558953979501...
Removing gs://yangyou-mnist/log/eval/#1565559068630495...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565559068.v3-8-tpu#1565559071763555...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:31:15.850393 139840498169280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:31:15.851191 139840498169280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:31:15.853749 139840498169280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:31:15.854547 139840498169280 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:31:15.855133 139840498169280 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:31:15.855257 139840498169280 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:31:16.253253 139840498169280 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:31:16.259814 139840498169280 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:31:16.263653 139840498169280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:31:16.310447 139840498169280 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:31:16.310728 139840498169280 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:31:16.539663 139840498169280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:31:16.588826 139840498169280 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:31:16.589131 139840498169280 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:31:16.691795 139840498169280 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2f015fe490>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2f037f3190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:31:16.692187 139840498169280 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:31:17.012413 139840498169280 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:31:17.015517: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:31:17.028359 139840498169280 tpu_system_metadata.py:148] Found TPU system:
I0811 21:31:17.028633 139840498169280 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:31:17.029174 139840498169280 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:31:17.029232 139840498169280 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:31:17.029284 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:31:17.029570 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:31:17.029684 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:31:17.029738 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:31:17.029788 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:31:17.029840 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:31:17.029887 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:31:17.029936 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:31:17.029989 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:31:17.030036 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:31:17.030107 139840498169280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:31:17.036340 139840498169280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:31:17.049007 139840498169280 estimator.py:1145] Calling model_fn.
W0811 21:31:17.049640 139840498169280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:31:17.316710 139840498169280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:31:17.744056 139840498169280 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:31:17.805651 139840498169280 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:31:17.811804 139840498169280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:31:17.988379 139840498169280 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:31:18.002051 139840498169280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:31:18.013947 139840498169280 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:31:18.014260 139840498169280 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:31:18.436834 139840498169280 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:31:18.452555 139840498169280 estimator.py:1147] Done calling model_fn.
I0811 21:31:21.679860 139840498169280 tpu_estimator.py:499] TPU job name worker
I0811 21:31:21.794536 139840498169280 monitored_session.py:240] Graph was finalized.
I0811 21:31:22.355072 139840498169280 session_manager.py:500] Running local_init_op.
I0811 21:31:22.392697 139840498169280 session_manager.py:502] Done running local_init_op.
I0811 21:31:25.071608 139840498169280 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:31:37.170272 139840498169280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:31:37.291352 139840498169280 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:31:37.291831 139840498169280 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:31:37.292254: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:31:37.297483 139840498169280 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:31:37.299698 139840498169280 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:31:37.303448 139840498169280 tpu_estimator.py:557] Init TPU system
I0811 21:32:20.686280 139840498169280 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 21:32:20.687416 139839738722048 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:32:20.688232 139839730329344 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:32:20.733606 139840498169280 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:32:20.734479 139840498169280 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:32:20.746165 139839721936640 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:32:20.851622 139839721936640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:32:25.272922 139839730329344 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:32:29.884557 139840498169280 basic_session_run_hooks.py:262] loss = 0.28069282, step = 30
I0811 21:32:29.886790 139840498169280 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:32:42.879384 139840498169280 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:32:42.879676 139840498169280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:32:42.879995 139839738722048 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:32:42.880307 139839738722048 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:32:42.880577 139840498169280 error_handling.py:96] infeed marked as finished
I0811 21:32:42.880852 139840498169280 tpu_estimator.py:602] Stop output thread controller
I0811 21:32:42.880938 139840498169280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:32:42.881113 139839730329344 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:32:42.881273 139839730329344 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:32:42.881464 139840498169280 error_handling.py:96] outfeed marked as finished
I0811 21:32:42.881673 139840498169280 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:32:50.985696 139840498169280 estimator.py:368] Loss for final step: 0.28069282.
I0811 21:32:50.986519 139840498169280 error_handling.py:96] training_loop marked as finished
I0811 21:32:51.697575 139840498169280 estimator.py:1145] Calling model_fn.
E0811 21:32:52.363142 139840498169280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:32:52.559125 139840498169280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:32:52.586489 139840498169280 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:32:52.608798 139840498169280 estimator.py:1147] Done calling model_fn.
I0811 21:32:52.626025 139840498169280 evaluation.py:255] Starting evaluation at 2019-08-11T21:32:52Z
I0811 21:32:52.626271 139840498169280 tpu_estimator.py:499] TPU job name worker
I0811 21:32:52.700339 139840498169280 monitored_session.py:240] Graph was finalized.
W0811 21:32:52.701107 139840498169280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:32:52.886378 139840498169280 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:32:55.457952 139840498169280 session_manager.py:500] Running local_init_op.
I0811 21:32:55.487592 139840498169280 session_manager.py:502] Done running local_init_op.
I0811 21:32:55.544512 139840498169280 tpu_estimator.py:557] Init TPU system
I0811 21:34:04.628794 139840498169280 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 21:34:04.630032 139839734789888 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:34:04.630729 139839726397184 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:34:04.699346 139840498169280 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:34:04.726195 139840498169280 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:34:04.726574 139840498169280 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:34:04.756792 139839236208384 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:34:04.837219 139839236208384 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:34:05.470609 139839726397184 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:34:05.852375 139840498169280 evaluation.py:167] Evaluation [10/10]
I0811 21:34:05.852715 139840498169280 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:34:05.852792 139840498169280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:34:05.853035 139839734789888 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:34:05.853300 139839734789888 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:34:05.853490 139840498169280 error_handling.py:96] infeed marked as finished
I0811 21:34:05.853693 139840498169280 tpu_estimator.py:602] Stop output thread controller
I0811 21:34:05.853750 139840498169280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:34:05.853912 139839726397184 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:34:05.854091 139839726397184 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:34:05.854289 139840498169280 error_handling.py:96] outfeed marked as finished
I0811 21:34:05.854460 139840498169280 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:34:34.936487 139840498169280 evaluation.py:275] Finished evaluation at 2019-08-11-21:34:34
I0811 21:34:34.936825 139840498169280 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9294, global_step = 30, loss = 0.28344575
I0811 21:34:39.074667 139840498169280 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:34:39.842982 139840498169280 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.28344575, 'global_step': 30, 'accuracy': 0.9294}

Removing gs://yangyou-mnist/log/#1565559079889412...
Removing gs://yangyou-mnist/log/checkpoint#1565559159592244...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565559092354065...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565559096657583...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565559156581026...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565559084514436...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565559080.v3-8-tpu#1565559162545337...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565559157385107...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565559091522906...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565559161679525...
Removing gs://yangyou-mnist/log/eval/#1565559276508885...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565559276.v3-8-tpu#1565559279511699...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:34:43.571623 140279378240960 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:34:43.572392 140279378240960 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:34:43.574881 140279378240960 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:34:43.575647 140279378240960 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:34:43.576217 140279378240960 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:34:43.576339 140279378240960 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:34:43.963598 140279378240960 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:34:43.970752 140279378240960 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:34:43.974509 140279378240960 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:34:44.021720 140279378240960 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:34:44.021994 140279378240960 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:34:44.167591 140279378240960 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:34:44.256653 140279378240960 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:34:44.256947 140279378240960 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:34:44.374845 140279378240960 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f9530abc090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f9532c9a190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:34:44.375230 140279378240960 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:34:44.701107 140279378240960 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:34:44.703779: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:34:44.716811 140279378240960 tpu_system_metadata.py:148] Found TPU system:
I0811 21:34:44.717048 140279378240960 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:34:44.717573 140279378240960 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:34:44.717681 140279378240960 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:34:44.717737 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:34:44.718046 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:34:44.718110 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:34:44.718162 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:34:44.718210 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:34:44.718259 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:34:44.718314 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:34:44.718363 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:34:44.718409 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:34:44.718455 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:34:44.718502 140279378240960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:34:44.724286 140279378240960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:34:44.736362 140279378240960 estimator.py:1145] Calling model_fn.
W0811 21:34:44.736963 140279378240960 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:34:45.011050 140279378240960 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:34:45.442406 140279378240960 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:34:45.503750 140279378240960 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:34:45.510415 140279378240960 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:34:45.690567 140279378240960 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:34:45.704293 140279378240960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:34:45.716505 140279378240960 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:34:45.716826 140279378240960 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:34:46.137206 140279378240960 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:34:46.152630 140279378240960 estimator.py:1147] Done calling model_fn.
I0811 21:34:49.435532 140279378240960 tpu_estimator.py:499] TPU job name worker
I0811 21:34:49.547418 140279378240960 monitored_session.py:240] Graph was finalized.
I0811 21:34:50.129889 140279378240960 session_manager.py:500] Running local_init_op.
I0811 21:34:50.159284 140279378240960 session_manager.py:502] Done running local_init_op.
I0811 21:34:52.811374 140279378240960 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:35:05.111344 140279378240960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:35:05.215514 140279378240960 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:35:05.216032 140279378240960 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:35:05.216436: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:35:05.221184 140279378240960 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:35:05.223377 140279378240960 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:35:05.226766 140279378240960 tpu_estimator.py:557] Init TPU system
I0811 21:35:48.680500 140279378240960 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 21:35:48.681839 140278618892032 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:35:48.682703 140278610499328 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:35:48.727952 140279378240960 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:35:48.728842 140279378240960 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:35:48.781913 140278128178944 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:35:48.935997 140278128178944 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:35:53.412223 140278610499328 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:35:57.990422 140279378240960 basic_session_run_hooks.py:262] loss = 0.24984933, step = 30
I0811 21:35:57.993001 140279378240960 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:36:11.511734 140279378240960 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:36:11.512016 140279378240960 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:36:11.512259 140278618892032 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:36:11.512361 140278618892032 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:36:11.512495 140279378240960 error_handling.py:96] infeed marked as finished
I0811 21:36:11.512598 140279378240960 tpu_estimator.py:602] Stop output thread controller
I0811 21:36:11.512650 140279378240960 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:36:11.512758 140278610499328 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:36:11.512830 140278610499328 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:36:11.512939 140279378240960 error_handling.py:96] outfeed marked as finished
I0811 21:36:11.513019 140279378240960 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:36:19.038804 140279378240960 estimator.py:368] Loss for final step: 0.24984933.
I0811 21:36:19.039630 140279378240960 error_handling.py:96] training_loop marked as finished
I0811 21:36:19.849257 140279378240960 estimator.py:1145] Calling model_fn.
E0811 21:36:20.520651 140279378240960 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:36:20.716590 140279378240960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:36:20.744334 140279378240960 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:36:20.765254 140279378240960 estimator.py:1147] Done calling model_fn.
I0811 21:36:20.782793 140279378240960 evaluation.py:255] Starting evaluation at 2019-08-11T21:36:20Z
I0811 21:36:20.783046 140279378240960 tpu_estimator.py:499] TPU job name worker
I0811 21:36:20.858501 140279378240960 monitored_session.py:240] Graph was finalized.
W0811 21:36:20.859330 140279378240960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:36:21.046216 140279378240960 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:36:23.782787 140279378240960 session_manager.py:500] Running local_init_op.
I0811 21:36:23.806793 140279378240960 session_manager.py:502] Done running local_init_op.
I0811 21:36:23.858755 140279378240960 tpu_estimator.py:557] Init TPU system
I0811 21:37:32.797821 140279378240960 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:37:32.798940 140278614959872 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:37:32.799683 140278128178944 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:37:32.866421 140279378240960 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:37:32.890594 140279378240960 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:37:32.890959 140279378240960 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:37:32.912208 140278119786240 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:37:33.025537 140278119786240 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:37:33.612417 140278128178944 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:37:33.966804 140279378240960 evaluation.py:167] Evaluation [10/10]
I0811 21:37:33.967170 140279378240960 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:37:33.967245 140279378240960 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:37:33.967513 140278614959872 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:37:33.967806 140278614959872 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:37:33.967995 140279378240960 error_handling.py:96] infeed marked as finished
I0811 21:37:33.968152 140279378240960 tpu_estimator.py:602] Stop output thread controller
I0811 21:37:33.968204 140279378240960 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:37:33.968353 140278128178944 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:37:33.968492 140278128178944 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:37:33.968642 140279378240960 error_handling.py:96] outfeed marked as finished
I0811 21:37:33.968765 140279378240960 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:38:03.120724 140279378240960 evaluation.py:275] Finished evaluation at 2019-08-11-21:38:03
I0811 21:38:03.121162 140279378240960 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9373, global_step = 30, loss = 0.2485921
I0811 21:38:07.276323 140279378240960 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:38:08.448817 140279378240960 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.2485921, 'global_step': 30, 'accuracy': 0.9373}

Removing gs://yangyou-mnist/log/checkpoint#1565559367954368...
Removing gs://yangyou-mnist/log/#1565559287607742...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565559287.v3-8-tpu#1565559371170815...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565559299990872...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565559292263683...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565559304604229...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565559365699876...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565559364878727...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565559299125456...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565559370226986...
Removing gs://yangyou-mnist/log/eval/#1565559484743404...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565559484.v3-8-tpu#1565559488123700...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:38:12.186566 140450026468800 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:38:12.187374 140450026468800 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:38:12.190006 140450026468800 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:38:12.190814 140450026468800 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:38:12.191405 140450026468800 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:38:12.191529 140450026468800 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:38:12.589076 140450026468800 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:38:12.596084 140450026468800 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:38:12.599934 140450026468800 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:38:12.646704 140450026468800 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:38:12.647000 140450026468800 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:38:12.757468 140450026468800 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:38:12.804076 140450026468800 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:38:12.804384 140450026468800 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:38:12.915501 140450026468800 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fbcec1911d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fbcee36f190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:38:12.915882 140450026468800 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:38:13.232897 140450026468800 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:38:13.235803: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:38:13.248162 140450026468800 tpu_system_metadata.py:148] Found TPU system:
I0811 21:38:13.248425 140450026468800 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:38:13.248929 140450026468800 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:38:13.248986 140450026468800 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:38:13.249039 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:38:13.249319 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:38:13.249382 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:38:13.249433 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:38:13.249490 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:38:13.249540 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:38:13.249619 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:38:13.249686 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:38:13.249735 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:38:13.249782 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:38:13.249840 140450026468800 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:38:13.255748 140450026468800 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:38:13.268151 140450026468800 estimator.py:1145] Calling model_fn.
W0811 21:38:13.268743 140450026468800 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:38:13.537024 140450026468800 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:38:14.058523 140450026468800 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:38:14.119606 140450026468800 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:38:14.125272 140450026468800 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:38:14.300395 140450026468800 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:38:14.314162 140450026468800 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:38:14.326090 140450026468800 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:38:14.326414 140450026468800 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:38:14.750490 140450026468800 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:38:14.765921 140450026468800 estimator.py:1147] Done calling model_fn.
I0811 21:38:18.051134 140450026468800 tpu_estimator.py:499] TPU job name worker
I0811 21:38:18.165311 140450026468800 monitored_session.py:240] Graph was finalized.
I0811 21:38:18.754930 140450026468800 session_manager.py:500] Running local_init_op.
I0811 21:38:18.793059 140450026468800 session_manager.py:502] Done running local_init_op.
I0811 21:38:21.369097 140450026468800 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:38:33.321890 140450026468800 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:38:33.428221 140450026468800 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:38:33.428699 140450026468800 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:38:33.429108: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:38:33.433804 140450026468800 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:38:33.435987 140450026468800 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:38:33.439740 140450026468800 tpu_estimator.py:557] Init TPU system
I0811 21:39:16.669986 140450026468800 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 21:39:16.670892 140449334318848 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:39:16.671405 140448853128960 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:39:16.714739 140450026468800 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:39:16.715652 140450026468800 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:39:16.726459 140448844736256 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:39:16.836694 140448844736256 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:39:21.057496 140448853128960 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:39:25.526016 140450026468800 basic_session_run_hooks.py:262] loss = 0.2544211, step = 30
I0811 21:39:25.528369 140450026468800 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:39:38.711505 140450026468800 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:39:38.711796 140450026468800 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:39:38.712023 140449334318848 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:39:38.712127 140449334318848 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:39:38.712275 140450026468800 error_handling.py:96] infeed marked as finished
I0811 21:39:38.712373 140450026468800 tpu_estimator.py:602] Stop output thread controller
I0811 21:39:38.712424 140450026468800 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:39:38.712533 140448853128960 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:39:38.712606 140448853128960 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:39:38.712718 140450026468800 error_handling.py:96] outfeed marked as finished
I0811 21:39:38.712805 140450026468800 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:39:46.965818 140450026468800 estimator.py:368] Loss for final step: 0.2544211.
I0811 21:39:46.966675 140450026468800 error_handling.py:96] training_loop marked as finished
I0811 21:39:47.783369 140450026468800 estimator.py:1145] Calling model_fn.
E0811 21:39:48.468895 140450026468800 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:39:48.666295 140450026468800 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:39:48.693804 140450026468800 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:39:48.715410 140450026468800 estimator.py:1147] Done calling model_fn.
I0811 21:39:48.732960 140450026468800 evaluation.py:255] Starting evaluation at 2019-08-11T21:39:48Z
I0811 21:39:48.733208 140450026468800 tpu_estimator.py:499] TPU job name worker
I0811 21:39:48.807868 140450026468800 monitored_session.py:240] Graph was finalized.
W0811 21:39:48.808661 140450026468800 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:39:48.997792 140450026468800 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:39:51.437246 140450026468800 session_manager.py:500] Running local_init_op.
I0811 21:39:51.459650 140450026468800 session_manager.py:502] Done running local_init_op.
I0811 21:39:51.514446 140450026468800 tpu_estimator.py:557] Init TPU system
I0811 21:41:00.644412 140450026468800 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 21:41:00.645490 140448853128960 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:41:00.646198 140448844736256 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:41:00.733858 140450026468800 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:41:00.759694 140450026468800 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:41:00.760020 140450026468800 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:41:00.833651 140448836343552 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:41:00.980964 140448836343552 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:41:01.483849 140448844736256 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:41:01.916770 140450026468800 evaluation.py:167] Evaluation [10/10]
I0811 21:41:01.917119 140450026468800 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:41:01.917201 140450026468800 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:41:01.917469 140448853128960 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:41:01.917848 140448853128960 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:41:01.918082 140450026468800 error_handling.py:96] infeed marked as finished
I0811 21:41:01.918318 140450026468800 tpu_estimator.py:602] Stop output thread controller
I0811 21:41:01.918382 140450026468800 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:41:01.918554 140448844736256 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:41:01.918744 140448844736256 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:41:01.918910 140450026468800 error_handling.py:96] outfeed marked as finished
I0811 21:41:01.919055 140450026468800 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:41:31.081803 140450026468800 evaluation.py:275] Finished evaluation at 2019-08-11-21:41:31
I0811 21:41:31.082170 140450026468800 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9381, global_step = 30, loss = 0.243602
I0811 21:41:35.675856 140450026468800 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:41:36.558428 140450026468800 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.243602, 'global_step': 30, 'accuracy': 0.9381}

Removing gs://yangyou-mnist/log/#1565559496179202...
Removing gs://yangyou-mnist/log/checkpoint#1565559575126926...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565559496.v3-8-tpu#1565559578383766...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565559508510092...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565559512826286...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565559507700013...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565559572129046...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565559572957149...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565559500817928...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565559577331607...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565559692698983...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565559692.v3-8-tpu#1565559696216048...
/ [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:41:40.347326 140091834873280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:41:40.348097 140091834873280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:41:40.350796 140091834873280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:41:40.351588 140091834873280 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:41:40.352176 140091834873280 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:41:40.352307 140091834873280 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:41:40.741276 140091834873280 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:41:40.747747 140091834873280 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:41:40.751357 140091834873280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:41:40.797038 140091834873280 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:41:40.797322 140091834873280 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:41:41.006177 140091834873280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:41:41.049633 140091834873280 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:41:41.049916 140091834873280 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:41:41.175340 140091834873280 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f69863710d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f698854f190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:41:41.175726 140091834873280 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:41:41.495317 140091834873280 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:41:41.498185: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:41:41.509190 140091834873280 tpu_system_metadata.py:148] Found TPU system:
I0811 21:41:41.509462 140091834873280 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:41:41.510039 140091834873280 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:41:41.510099 140091834873280 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:41:41.510153 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:41:41.510447 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:41:41.510504 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:41:41.510555 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:41:41.510602 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:41:41.510651 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:41:41.510696 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:41:41.510742 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:41:41.510790 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:41:41.510835 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:41:41.510891 140091834873280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:41:41.516969 140091834873280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:41:41.529721 140091834873280 estimator.py:1145] Calling model_fn.
W0811 21:41:41.530339 140091834873280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:41:41.791734 140091834873280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:41:42.214910 140091834873280 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:41:42.275233 140091834873280 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:41:42.281110 140091834873280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:41:42.463886 140091834873280 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:41:42.478921 140091834873280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:41:42.490673 140091834873280 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:41:42.490986 140091834873280 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:41:42.908298 140091834873280 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:41:42.923624 140091834873280 estimator.py:1147] Done calling model_fn.
I0811 21:41:46.311424 140091834873280 tpu_estimator.py:499] TPU job name worker
I0811 21:41:46.423456 140091834873280 monitored_session.py:240] Graph was finalized.
I0811 21:41:46.991188 140091834873280 session_manager.py:500] Running local_init_op.
I0811 21:41:47.032514 140091834873280 session_manager.py:502] Done running local_init_op.
I0811 21:41:49.460711 140091834873280 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:42:01.661206 140091834873280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:42:01.768390 140091834873280 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:42:01.768837 140091834873280 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:42:01.769306: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:42:01.773961 140091834873280 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:42:01.776029 140091834873280 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:42:01.779671 140091834873280 tpu_estimator.py:557] Init TPU system
I0811 21:42:44.661951 140091834873280 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 21:42:44.662738 140090941363968 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:42:44.663259 140090932971264 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:42:44.708117 140091834873280 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:42:44.708997 140091834873280 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:42:44.763082 140090924578560 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:42:45.048269 140090924578560 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 21:42:49.267554 140090932971264 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:42:53.720433 140091834873280 basic_session_run_hooks.py:262] loss = 0.18256357, step = 30
I0811 21:42:53.722878 140091834873280 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:43:06.703771 140091834873280 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:43:06.704073 140091834873280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:43:06.704289 140090941363968 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:43:06.704405 140090941363968 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:43:06.704545 140091834873280 error_handling.py:96] infeed marked as finished
I0811 21:43:06.704644 140091834873280 tpu_estimator.py:602] Stop output thread controller
I0811 21:43:06.704693 140091834873280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:43:06.704809 140090932971264 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:43:06.704884 140090932971264 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:43:06.704998 140091834873280 error_handling.py:96] outfeed marked as finished
I0811 21:43:06.705080 140091834873280 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:43:15.174731 140091834873280 estimator.py:368] Loss for final step: 0.18256357.
I0811 21:43:15.175592 140091834873280 error_handling.py:96] training_loop marked as finished
I0811 21:43:15.962888 140091834873280 estimator.py:1145] Calling model_fn.
E0811 21:43:16.656016 140091834873280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:43:16.851774 140091834873280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:43:16.879363 140091834873280 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:43:16.900496 140091834873280 estimator.py:1147] Done calling model_fn.
I0811 21:43:16.917927 140091834873280 evaluation.py:255] Starting evaluation at 2019-08-11T21:43:16Z
I0811 21:43:16.918171 140091834873280 tpu_estimator.py:499] TPU job name worker
I0811 21:43:16.994687 140091834873280 monitored_session.py:240] Graph was finalized.
W0811 21:43:16.995413 140091834873280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:43:17.179593 140091834873280 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:43:20.005367 140091834873280 session_manager.py:500] Running local_init_op.
I0811 21:43:20.028417 140091834873280 session_manager.py:502] Done running local_init_op.
I0811 21:43:20.079667 140091834873280 tpu_estimator.py:557] Init TPU system
I0811 21:44:28.630557 140091834873280 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:44:28.631752 140090937431808 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:44:28.632601 140090929039104 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:44:28.701922 140091834873280 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:44:28.725269 140091834873280 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:44:28.725620 140091834873280 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:44:28.753343 140090915923712 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:44:28.867413 140090915923712 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:44:29.445764 140090929039104 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:44:30.009985 140091834873280 evaluation.py:167] Evaluation [10/10]
I0811 21:44:30.010337 140091834873280 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:44:30.010407 140091834873280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:44:30.010682 140090937431808 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:44:30.010972 140090937431808 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:44:30.011231 140091834873280 error_handling.py:96] infeed marked as finished
I0811 21:44:30.011441 140091834873280 tpu_estimator.py:602] Stop output thread controller
I0811 21:44:30.011503 140091834873280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:44:30.011661 140090929039104 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:44:30.011820 140090929039104 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:44:30.011966 140091834873280 error_handling.py:96] outfeed marked as finished
I0811 21:44:30.012089 140091834873280 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:44:58.962805 140091834873280 evaluation.py:275] Finished evaluation at 2019-08-11-21:44:58
I0811 21:44:58.963161 140091834873280 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9476, global_step = 30, loss = 0.19973871
I0811 21:45:03.299084 140091834873280 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:45:04.153311 140091834873280 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.19973871, 'global_step': 30, 'accuracy': 0.9476}

Removing gs://yangyou-mnist/log/checkpoint#1565559783318946...
Removing gs://yangyou-mnist/log/#1565559704386362...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565559704.v3-8-tpu#1565559786377574...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565559716837338...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565559721163138...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565559708914202...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565559715973096...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565559780212604...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565559781133393...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565559785466696...
Removing gs://yangyou-mnist/log/eval/#1565559900634619...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565559900.v3-8-tpu#1565559903829118...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:45:07.832860 140326328735168 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:45:07.833655 140326328735168 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:45:07.836200 140326328735168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:45:07.836993 140326328735168 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:45:07.837570 140326328735168 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:45:07.837774 140326328735168 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:45:08.225826 140326328735168 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:45:08.233694 140326328735168 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:45:08.250600 140326328735168 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:45:08.298798 140326328735168 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:45:08.299107 140326328735168 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:45:08.402017 140326328735168 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:45:08.449289 140326328735168 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:45:08.449574 140326328735168 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:45:08.673152 140326328735168 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa01f237050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa021415190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:45:08.673547 140326328735168 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:45:09.004475 140326328735168 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:45:09.007716: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:45:09.022346 140326328735168 tpu_system_metadata.py:148] Found TPU system:
I0811 21:45:09.022578 140326328735168 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:45:09.023083 140326328735168 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:45:09.023159 140326328735168 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:45:09.023215 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:45:09.023507 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:45:09.023564 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:45:09.023622 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:45:09.023673 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:45:09.023721 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:45:09.023768 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:45:09.023817 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:45:09.023864 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:45:09.023912 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:45:09.023962 140326328735168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:45:09.030170 140326328735168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:45:09.042880 140326328735168 estimator.py:1145] Calling model_fn.
W0811 21:45:09.043543 140326328735168 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:45:09.312093 140326328735168 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:45:09.741734 140326328735168 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:45:09.803042 140326328735168 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:45:09.808887 140326328735168 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:45:09.988305 140326328735168 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:45:10.001501 140326328735168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:45:10.013067 140326328735168 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:45:10.013394 140326328735168 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:45:10.434520 140326328735168 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:45:10.449902 140326328735168 estimator.py:1147] Done calling model_fn.
I0811 21:45:13.895220 140326328735168 tpu_estimator.py:499] TPU job name worker
I0811 21:45:14.006064 140326328735168 monitored_session.py:240] Graph was finalized.
I0811 21:45:14.568197 140326328735168 session_manager.py:500] Running local_init_op.
I0811 21:45:14.597862 140326328735168 session_manager.py:502] Done running local_init_op.
I0811 21:45:17.686988 140326328735168 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:45:29.404412 140326328735168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:45:29.508294 140326328735168 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:45:29.508771 140326328735168 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:45:29.509199: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:45:29.513999 140326328735168 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:45:29.516092 140326328735168 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:45:29.521470 140326328735168 tpu_estimator.py:557] Init TPU system
I0811 21:46:12.705940 140326328735168 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 21:46:12.707030 140325297317632 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:46:12.707798 140325288924928 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:46:12.751698 140326328735168 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:46:12.753055 140326328735168 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:46:12.763711 140325280532224 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:46:12.866312 140325280532224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:46:17.378092 140325288924928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:46:21.921279 140326328735168 basic_session_run_hooks.py:262] loss = 0.13350417, step = 30
I0811 21:46:21.923698 140326328735168 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:46:34.988270 140326328735168 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:46:34.988548 140326328735168 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:46:34.988738 140325297317632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:46:34.988827 140325297317632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:46:34.988960 140326328735168 error_handling.py:96] infeed marked as finished
I0811 21:46:34.989065 140326328735168 tpu_estimator.py:602] Stop output thread controller
I0811 21:46:34.989123 140326328735168 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:46:34.989231 140325288924928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:46:34.989301 140325288924928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:46:34.989411 140326328735168 error_handling.py:96] outfeed marked as finished
I0811 21:46:34.989486 140326328735168 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:46:43.000833 140326328735168 estimator.py:368] Loss for final step: 0.13350417.
I0811 21:46:43.001699 140326328735168 error_handling.py:96] training_loop marked as finished
I0811 21:46:43.777633 140326328735168 estimator.py:1145] Calling model_fn.
E0811 21:46:44.487467 140326328735168 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:46:44.678180 140326328735168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:46:44.705626 140326328735168 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:46:44.726571 140326328735168 estimator.py:1147] Done calling model_fn.
I0811 21:46:44.743537 140326328735168 evaluation.py:255] Starting evaluation at 2019-08-11T21:46:44Z
I0811 21:46:44.743777 140326328735168 tpu_estimator.py:499] TPU job name worker
I0811 21:46:44.817642 140326328735168 monitored_session.py:240] Graph was finalized.
W0811 21:46:44.818393 140326328735168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:46:45.005147 140326328735168 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:46:47.714140 140326328735168 session_manager.py:500] Running local_init_op.
I0811 21:46:47.746841 140326328735168 session_manager.py:502] Done running local_init_op.
I0811 21:46:47.794392 140326328735168 tpu_estimator.py:557] Init TPU system
I0811 21:47:56.672036 140326328735168 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:47:56.672990 140325296793344 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:47:56.673439 140325288400640 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:47:56.743560 140326328735168 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:47:56.769992 140326328735168 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:47:56.770387 140326328735168 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:47:56.795242 140325280007936 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:47:56.953021 140325280007936 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:47:57.509485 140325288400640 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:47:57.817703 140326328735168 evaluation.py:167] Evaluation [10/10]
I0811 21:47:57.818124 140326328735168 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:47:57.818196 140326328735168 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:47:57.818381 140325296793344 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:47:57.818475 140325296793344 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:47:57.818598 140326328735168 error_handling.py:96] infeed marked as finished
I0811 21:47:57.818694 140326328735168 tpu_estimator.py:602] Stop output thread controller
I0811 21:47:57.818751 140326328735168 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:47:57.818856 140325288400640 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:47:57.818928 140325288400640 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:47:57.819041 140326328735168 error_handling.py:96] outfeed marked as finished
I0811 21:47:57.819119 140326328735168 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:48:27.044431 140326328735168 evaluation.py:275] Finished evaluation at 2019-08-11-21:48:27
I0811 21:48:27.044774 140326328735168 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9612, global_step = 30, loss = 0.12806988
I0811 21:48:31.473934 140326328735168 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:48:32.295378 140326328735168 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12806988, 'global_step': 30, 'accuracy': 0.9612}

Removing gs://yangyou-mnist/log/#1565559912001352...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565559924611976...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565559912.v3-8-tpu#1565559994663534...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565559928921157...
Removing gs://yangyou-mnist/log/checkpoint#1565559991644189...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565559989661726...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565559988812266...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565559917140448...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565559923817297...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565559993774659...
Removing gs://yangyou-mnist/log/eval/#1565560108759026...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565560108.v3-8-tpu#1565560111904709...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:48:36.011241 140183809406400 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:48:36.012020 140183809406400 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:48:36.014622 140183809406400 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:48:36.015399 140183809406400 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:48:36.015945 140183809406400 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:48:36.016073 140183809406400 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:48:36.439059 140183809406400 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:48:36.445413 140183809406400 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:48:36.449258 140183809406400 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:48:36.498274 140183809406400 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:48:36.498562 140183809406400 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:48:36.598040 140183809406400 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:48:36.645040 140183809406400 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:48:36.645317 140183809406400 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:48:36.720884 140183809406400 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f7ef0531110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f7ef270f190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:48:36.721261 140183809406400 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:48:37.039866 140183809406400 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:48:37.042847: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:48:37.054761 140183809406400 tpu_system_metadata.py:148] Found TPU system:
I0811 21:48:37.055005 140183809406400 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:48:37.055597 140183809406400 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:48:37.055666 140183809406400 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:48:37.055740 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:48:37.056054 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:48:37.056108 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:48:37.056158 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:48:37.056212 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:48:37.056261 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:48:37.056307 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:48:37.056353 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:48:37.056399 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:48:37.056443 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:48:37.056490 140183809406400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:48:37.062517 140183809406400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:48:37.074940 140183809406400 estimator.py:1145] Calling model_fn.
W0811 21:48:37.075520 140183809406400 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:48:37.350709 140183809406400 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:48:37.894972 140183809406400 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:48:37.957448 140183809406400 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:48:37.963421 140183809406400 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:48:38.137140 140183809406400 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:48:38.150607 140183809406400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:48:38.162182 140183809406400 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:48:38.162472 140183809406400 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:48:38.576030 140183809406400 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:48:38.591434 140183809406400 estimator.py:1147] Done calling model_fn.
I0811 21:48:41.969885 140183809406400 tpu_estimator.py:499] TPU job name worker
I0811 21:48:42.084805 140183809406400 monitored_session.py:240] Graph was finalized.
I0811 21:48:42.656395 140183809406400 session_manager.py:500] Running local_init_op.
I0811 21:48:42.689377 140183809406400 session_manager.py:502] Done running local_init_op.
I0811 21:48:45.349246 140183809406400 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:48:57.201320 140183809406400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:48:57.309154 140183809406400 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:48:57.309685 140183809406400 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:48:57.310173: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:48:57.315201 140183809406400 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:48:57.317316 140183809406400 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:48:57.321429 140183809406400 tpu_estimator.py:557] Init TPU system
I0811 21:49:40.666560 140183809406400 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 21:49:40.667781 140183117256448 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:49:40.668628 140182632265472 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:49:40.711822 140183809406400 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:49:40.712693 140183809406400 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:49:40.723347 140182623872768 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:49:40.826993 140182623872768 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 21:49:45.339148 140182632265472 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:49:49.878432 140183809406400 basic_session_run_hooks.py:262] loss = 0.094247304, step = 30
I0811 21:49:49.880721 140183809406400 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:50:03.087462 140183809406400 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:50:03.087759 140183809406400 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:50:03.088085 140183117256448 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:50:03.088430 140183117256448 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:50:03.088674 140183809406400 error_handling.py:96] infeed marked as finished
I0811 21:50:03.088916 140183809406400 tpu_estimator.py:602] Stop output thread controller
I0811 21:50:03.089031 140183809406400 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:50:03.089216 140182632265472 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:50:03.089435 140182632265472 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:50:03.089665 140183809406400 error_handling.py:96] outfeed marked as finished
I0811 21:50:03.089845 140183809406400 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:50:10.957809 140183809406400 estimator.py:368] Loss for final step: 0.094247304.
I0811 21:50:10.958617 140183809406400 error_handling.py:96] training_loop marked as finished
I0811 21:50:12.046437 140183809406400 estimator.py:1145] Calling model_fn.
E0811 21:50:12.736397 140183809406400 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:50:12.927782 140183809406400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:50:12.954962 140183809406400 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:50:12.975752 140183809406400 estimator.py:1147] Done calling model_fn.
I0811 21:50:12.993700 140183809406400 evaluation.py:255] Starting evaluation at 2019-08-11T21:50:12Z
I0811 21:50:12.993941 140183809406400 tpu_estimator.py:499] TPU job name worker
I0811 21:50:13.067982 140183809406400 monitored_session.py:240] Graph was finalized.
W0811 21:50:13.068753 140183809406400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:50:13.246408 140183809406400 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:50:15.881514 140183809406400 session_manager.py:500] Running local_init_op.
I0811 21:50:15.905097 140183809406400 session_manager.py:502] Done running local_init_op.
I0811 21:50:15.957050 140183809406400 tpu_estimator.py:557] Init TPU system
I0811 21:51:24.726238 140183809406400 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 21:51:24.727227 140182632265472 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:51:24.727612 140182623872768 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:51:24.796598 140183809406400 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:51:24.821538 140183809406400 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:51:24.821914 140183809406400 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:51:24.852081 140182615480064 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:51:25.045711 140182615480064 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:51:25.583313 140182623872768 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:51:25.927803 140183809406400 evaluation.py:167] Evaluation [10/10]
I0811 21:51:25.928167 140183809406400 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:51:25.928245 140183809406400 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:51:25.928533 140182632265472 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:51:25.928885 140182632265472 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:51:25.929122 140183809406400 error_handling.py:96] infeed marked as finished
I0811 21:51:25.929308 140183809406400 tpu_estimator.py:602] Stop output thread controller
I0811 21:51:25.929368 140183809406400 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:51:25.929672 140182623872768 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:51:25.929824 140182623872768 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:51:25.929975 140183809406400 error_handling.py:96] outfeed marked as finished
I0811 21:51:25.930108 140183809406400 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:51:55.146862 140183809406400 evaluation.py:275] Finished evaluation at 2019-08-11-21:51:55
I0811 21:51:55.147186 140183809406400 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9716, global_step = 30, loss = 0.09478953
I0811 21:51:59.520878 140183809406400 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:52:00.328253 140183809406400 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09478953, 'global_step': 30, 'accuracy': 0.9716}

Removing gs://yangyou-mnist/log/#1565560120025442...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565560120.v3-8-tpu#1565560202759695...
Removing gs://yangyou-mnist/log/checkpoint#1565560199680078...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565560124734710...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565560132317204...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565560131454511...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565560196542944...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565560136694176...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565560197379311...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565560201864948...
Removing gs://yangyou-mnist/log/eval/#1565560316789473...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565560316.v3-8-tpu#1565560319996459...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:52:04.089505 139865526375872 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:52:04.090384 139865526375872 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:52:04.092952 139865526375872 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:52:04.093822 139865526375872 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:52:04.094428 139865526375872 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:52:04.094556 139865526375872 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:52:04.508621 139865526375872 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:52:04.515906 139865526375872 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:52:04.519800 139865526375872 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:52:04.614947 139865526375872 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:52:04.615236 139865526375872 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:52:04.745615 139865526375872 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:52:04.791162 139865526375872 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:52:04.791454 139865526375872 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:52:04.890893 139865526375872 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f34d52c0590>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f34d74b5190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:52:04.891249 139865526375872 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:52:05.211330 139865526375872 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:52:05.214337: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:52:05.227204 139865526375872 tpu_system_metadata.py:148] Found TPU system:
I0811 21:52:05.227441 139865526375872 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:52:05.227945 139865526375872 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:52:05.228009 139865526375872 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:52:05.228063 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:52:05.228352 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:52:05.228410 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:52:05.228460 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:52:05.228518 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:52:05.228565 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:52:05.228611 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:52:05.228658 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:52:05.228704 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:52:05.228751 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:52:05.228800 139865526375872 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:52:05.234797 139865526375872 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:52:05.246997 139865526375872 estimator.py:1145] Calling model_fn.
W0811 21:52:05.247589 139865526375872 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:52:05.524086 139865526375872 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:52:06.059734 139865526375872 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:52:06.121834 139865526375872 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:52:06.127959 139865526375872 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:52:06.324311 139865526375872 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:52:06.338440 139865526375872 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:52:06.350698 139865526375872 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:52:06.351016 139865526375872 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:52:06.792376 139865526375872 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:52:06.807915 139865526375872 estimator.py:1147] Done calling model_fn.
I0811 21:52:10.321116 139865526375872 tpu_estimator.py:499] TPU job name worker
I0811 21:52:10.444005 139865526375872 monitored_session.py:240] Graph was finalized.
I0811 21:52:11.028460 139865526375872 session_manager.py:500] Running local_init_op.
I0811 21:52:11.058125 139865526375872 session_manager.py:502] Done running local_init_op.
I0811 21:52:13.593251 139865526375872 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:52:25.505536 139865526375872 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:52:25.618213 139865526375872 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:52:25.618647 139865526375872 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:52:25.619104: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:52:25.623886 139865526375872 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:52:25.626014 139865526375872 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:52:25.630139 139865526375872 tpu_estimator.py:557] Init TPU system
I0811 21:53:08.661181 139865526375872 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 21:53:08.662136 139864766920448 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:53:08.662540 139864758527744 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:53:08.706684 139865526375872 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:53:08.707511 139865526375872 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:53:08.761715 139864750135040 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:53:08.921964 139864750135040 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 21:53:13.510319 139864758527744 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:53:18.133577 139865526375872 basic_session_run_hooks.py:262] loss = 0.1180118, step = 30
I0811 21:53:18.135853 139865526375872 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:53:31.673028 139865526375872 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:53:31.673326 139865526375872 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:53:31.673703 139864766920448 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:53:31.674034 139864766920448 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:53:31.674266 139865526375872 error_handling.py:96] infeed marked as finished
I0811 21:53:31.674499 139865526375872 tpu_estimator.py:602] Stop output thread controller
I0811 21:53:31.674560 139865526375872 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:53:31.674802 139864758527744 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:53:31.675019 139864758527744 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:53:31.675226 139865526375872 error_handling.py:96] outfeed marked as finished
I0811 21:53:31.675409 139865526375872 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:53:39.051513 139865526375872 estimator.py:368] Loss for final step: 0.1180118.
I0811 21:53:39.052396 139865526375872 error_handling.py:96] training_loop marked as finished
I0811 21:53:39.782985 139865526375872 estimator.py:1145] Calling model_fn.
E0811 21:53:40.462949 139865526375872 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:53:40.655015 139865526375872 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:53:40.682792 139865526375872 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:53:40.703973 139865526375872 estimator.py:1147] Done calling model_fn.
I0811 21:53:40.721831 139865526375872 evaluation.py:255] Starting evaluation at 2019-08-11T21:53:40Z
I0811 21:53:40.722067 139865526375872 tpu_estimator.py:499] TPU job name worker
I0811 21:53:40.796834 139865526375872 monitored_session.py:240] Graph was finalized.
W0811 21:53:40.797621 139865526375872 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:53:40.982647 139865526375872 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:53:43.504981 139865526375872 session_manager.py:500] Running local_init_op.
I0811 21:53:43.528439 139865526375872 session_manager.py:502] Done running local_init_op.
I0811 21:53:43.584011 139865526375872 tpu_estimator.py:557] Init TPU system
I0811 21:54:52.598516 139865526375872 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 21:54:52.599430 139864762988288 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:54:52.600094 139864754595584 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:54:52.667108 139865526375872 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:54:52.695595 139865526375872 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:54:52.695940 139865526375872 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:54:52.728001 139864267814656 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:54:52.850586 139864267814656 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:54:53.421566 139864754595584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:54:53.888113 139865526375872 evaluation.py:167] Evaluation [10/10]
I0811 21:54:53.888425 139865526375872 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:54:53.888493 139865526375872 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:54:53.888688 139864762988288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:54:53.888782 139864762988288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:54:53.888919 139865526375872 error_handling.py:96] infeed marked as finished
I0811 21:54:53.889010 139865526375872 tpu_estimator.py:602] Stop output thread controller
I0811 21:54:53.889060 139865526375872 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:54:53.889205 139864754595584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:54:53.889283 139864754595584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:54:53.889404 139865526375872 error_handling.py:96] outfeed marked as finished
I0811 21:54:53.889480 139865526375872 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:55:22.942285 139865526375872 evaluation.py:275] Finished evaluation at 2019-08-11-21:55:22
I0811 21:55:22.942670 139865526375872 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9688, global_step = 30, loss = 0.11654472
I0811 21:55:27.552325 139865526375872 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:55:28.379303 139865526375872 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.11654472, 'global_step': 30, 'accuracy': 0.9688}

Removing gs://yangyou-mnist/log/#1565560328242979...
Removing gs://yangyou-mnist/log/checkpoint#1565560408301065...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565560328.v3-8-tpu#1565560411345579...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565560345003384...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565560333036179...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565560340565275...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565560405257133...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565560406121758...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565560339631862...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565560410416361...
Removing gs://yangyou-mnist/log/eval/#1565560524721067...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565560524.v3-8-tpu#1565560528043339...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:55:32.120554 140311252993472 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:55:32.121361 140311252993472 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:55:32.124243 140311252993472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:55:32.125101 140311252993472 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:55:32.125780 140311252993472 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:55:32.125946 140311252993472 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:55:32.519711 140311252993472 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:55:32.526544 140311252993472 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:55:32.530282 140311252993472 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:55:32.575237 140311252993472 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:55:32.575536 140311252993472 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:55:32.805371 140311252993472 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:55:32.895633 140311252993472 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:55:32.895946 140311252993472 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:55:33.101083 140311252993472 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f9c9c8de150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f9c9eabc190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:55:33.101490 140311252993472 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:55:33.428175 140311252993472 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:55:33.431468: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:55:33.444178 140311252993472 tpu_system_metadata.py:148] Found TPU system:
I0811 21:55:33.444413 140311252993472 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:55:33.445033 140311252993472 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:55:33.445099 140311252993472 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:55:33.445151 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:55:33.445466 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:55:33.445524 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:55:33.445575 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:55:33.445683 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:55:33.445739 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:55:33.445787 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:55:33.445835 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:55:33.445880 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:55:33.445950 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:55:33.446002 140311252993472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:55:33.452202 140311252993472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:55:33.464611 140311252993472 estimator.py:1145] Calling model_fn.
W0811 21:55:33.465215 140311252993472 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:55:33.726640 140311252993472 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:55:34.139440 140311252993472 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:55:34.199167 140311252993472 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:55:34.204857 140311252993472 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:55:34.378068 140311252993472 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:55:34.395246 140311252993472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:55:34.407067 140311252993472 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:55:34.407366 140311252993472 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:55:34.822849 140311252993472 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:55:34.838416 140311252993472 estimator.py:1147] Done calling model_fn.
I0811 21:55:38.667500 140311252993472 tpu_estimator.py:499] TPU job name worker
I0811 21:55:38.780708 140311252993472 monitored_session.py:240] Graph was finalized.
I0811 21:55:39.367053 140311252993472 session_manager.py:500] Running local_init_op.
I0811 21:55:39.405520 140311252993472 session_manager.py:502] Done running local_init_op.
I0811 21:55:42.008879 140311252993472 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:55:54.162144 140311252993472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:55:54.283405 140311252993472 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:55:54.283895 140311252993472 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:55:54.284288: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:55:54.289693 140311252993472 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:55:54.291929 140311252993472 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:55:54.295751 140311252993472 tpu_estimator.py:557] Init TPU system
I0811 21:56:36.696288 140311252993472 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 21:56:36.697278 140310493505280 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:56:36.698003 140310485112576 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:56:36.742943 140311252993472 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 21:56:36.743940 140311252993472 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 21:56:36.754249 140310004889344 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:56:36.948087 140310004889344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:56:41.253206 140310485112576 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:56:45.789896 140311252993472 basic_session_run_hooks.py:262] loss = 0.116858795, step = 30
I0811 21:56:45.792170 140311252993472 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 21:56:58.780164 140311252993472 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:56:58.780451 140311252993472 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:56:58.780709 140310493505280 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:56:58.780848 140310493505280 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:56:58.780978 140311252993472 error_handling.py:96] infeed marked as finished
I0811 21:56:58.781110 140311252993472 tpu_estimator.py:602] Stop output thread controller
I0811 21:56:58.781161 140311252993472 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:56:58.781306 140310485112576 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:56:58.781447 140310485112576 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:56:58.781728 140311252993472 error_handling.py:96] outfeed marked as finished
I0811 21:56:58.781837 140311252993472 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:57:07.081682 140311252993472 estimator.py:368] Loss for final step: 0.116858795.
I0811 21:57:07.082511 140311252993472 error_handling.py:96] training_loop marked as finished
I0811 21:57:07.761502 140311252993472 estimator.py:1145] Calling model_fn.
E0811 21:57:08.438182 140311252993472 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:57:08.629169 140311252993472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 21:57:08.657310 140311252993472 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 21:57:08.679044 140311252993472 estimator.py:1147] Done calling model_fn.
I0811 21:57:08.705059 140311252993472 evaluation.py:255] Starting evaluation at 2019-08-11T21:57:08Z
I0811 21:57:08.705351 140311252993472 tpu_estimator.py:499] TPU job name worker
I0811 21:57:08.783596 140311252993472 monitored_session.py:240] Graph was finalized.
W0811 21:57:08.784363 140311252993472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 21:57:08.965404 140311252993472 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 21:57:11.499794 140311252993472 session_manager.py:500] Running local_init_op.
I0811 21:57:11.524081 140311252993472 session_manager.py:502] Done running local_init_op.
I0811 21:57:11.580508 140311252993472 tpu_estimator.py:557] Init TPU system
I0811 21:58:20.816529 140311252993472 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 21:58:20.817553 140310489573120 tpu_estimator.py:514] Starting infeed thread controller.
I0811 21:58:20.818492 140310004889344 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 21:58:20.884212 140311252993472 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:58:20.910907 140311252993472 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 21:58:20.911252 140311252993472 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 21:58:20.989032 140309996496640 transport.py:157] Attempting refresh to obtain initial access_token
W0811 21:58:21.099935 140309996496640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 21:58:21.660073 140310004889344 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 21:58:21.976578 140311252993472 evaluation.py:167] Evaluation [10/10]
I0811 21:58:21.976980 140311252993472 tpu_estimator.py:598] Stop infeed thread controller
I0811 21:58:21.977052 140311252993472 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 21:58:21.977323 140310489573120 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 21:58:21.977642 140310489573120 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 21:58:21.977828 140311252993472 error_handling.py:96] infeed marked as finished
I0811 21:58:21.978013 140311252993472 tpu_estimator.py:602] Stop output thread controller
I0811 21:58:21.978069 140311252993472 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 21:58:21.978235 140310004889344 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 21:58:21.978408 140310004889344 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 21:58:21.978672 140311252993472 error_handling.py:96] outfeed marked as finished
I0811 21:58:21.978842 140311252993472 tpu_estimator.py:606] Shutdown TPU system.
I0811 21:58:51.198435 140311252993472 evaluation.py:275] Finished evaluation at 2019-08-11-21:58:51
I0811 21:58:51.198775 140311252993472 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9737, global_step = 30, loss = 0.08650951
I0811 21:58:55.804373 140311252993472 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 21:58:56.628480 140311252993472 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08650951, 'global_step': 30, 'accuracy': 0.9737}

Removing gs://yangyou-mnist/log/#1565560536301846...
Removing gs://yangyou-mnist/log/checkpoint#1565560615260602...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565560548377199...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565560553603771...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565560612376096...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565560536.v3-8-tpu#1565560618446311...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565560541452571...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565560613164412...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565560549204542...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565560617467617...
Removing gs://yangyou-mnist/log/eval/#1565560733127563...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565560733.v3-8-tpu#1565560736304985...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 21:59:00.392839 140449033930176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 21:59:00.393697 140449033930176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 21:59:00.396270 140449033930176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 21:59:00.397066 140449033930176 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 21:59:00.397845 140449033930176 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 21:59:00.398003 140449033930176 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 21:59:00.789263 140449033930176 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 21:59:00.795732 140449033930176 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 21:59:00.799340 140449033930176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:59:00.893870 140449033930176 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:59:00.894160 140449033930176 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:59:01.013005 140449033930176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 21:59:01.058490 140449033930176 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 21:59:01.058772 140449033930176 transport.py:157] Attempting refresh to obtain initial access_token
I0811 21:59:01.143707 140449033930176 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fbcb0f02350>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fbcb30e0190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 21:59:01.144083 140449033930176 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 21:59:01.479902 140449033930176 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 21:59:01.482879: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:59:01.494803 140449033930176 tpu_system_metadata.py:148] Found TPU system:
I0811 21:59:01.495057 140449033930176 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 21:59:01.495562 140449033930176 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 21:59:01.495619 140449033930176 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 21:59:01.495671 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 21:59:01.496048 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 21:59:01.496108 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 21:59:01.496159 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 21:59:01.496206 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 21:59:01.496254 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 21:59:01.496309 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 21:59:01.496356 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 21:59:01.496409 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 21:59:01.496462 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 21:59:01.496510 140449033930176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 21:59:01.502610 140449033930176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 21:59:01.514982 140449033930176 estimator.py:1145] Calling model_fn.
W0811 21:59:01.515574 140449033930176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 21:59:01.783039 140449033930176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 21:59:02.220603 140449033930176 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 21:59:02.281234 140449033930176 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 21:59:02.287024 140449033930176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 21:59:02.469522 140449033930176 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 21:59:02.482986 140449033930176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 21:59:02.494761 140449033930176 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 21:59:02.495064 140449033930176 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 21:59:02.917996 140449033930176 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 21:59:02.933507 140449033930176 estimator.py:1147] Done calling model_fn.
I0811 21:59:06.324481 140449033930176 tpu_estimator.py:499] TPU job name worker
I0811 21:59:06.441885 140449033930176 monitored_session.py:240] Graph was finalized.
I0811 21:59:07.027749 140449033930176 session_manager.py:500] Running local_init_op.
I0811 21:59:07.057084 140449033930176 session_manager.py:502] Done running local_init_op.
I0811 21:59:09.640626 140449033930176 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 21:59:22.034755 140449033930176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 21:59:22.141846 140449033930176 util.py:98] Initialized dataset iterators in 0 seconds
I0811 21:59:22.142348 140449033930176 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 21:59:22.142752: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 21:59:22.149383 140449033930176 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 21:59:22.151567 140449033930176 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 21:59:22.155183 140449033930176 tpu_estimator.py:557] Init TPU system
I0811 22:00:04.683940 140449033930176 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 22:00:04.685126 140448274294528 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:00:04.686089 140448265901824 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:00:04.729305 140449033930176 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:00:04.730251 140449033930176 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:00:04.740690 140447779387136 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:00:04.850353 140447779387136 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:00:09.307518 140448265901824 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:00:13.819437 140449033930176 basic_session_run_hooks.py:262] loss = 0.17627355, step = 30
I0811 22:00:13.822052 140449033930176 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:00:27.947454 140449033930176 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:00:27.947726 140449033930176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:00:27.947942 140448274294528 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:00:27.948043 140448274294528 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:00:27.948195 140449033930176 error_handling.py:96] infeed marked as finished
I0811 22:00:27.948302 140449033930176 tpu_estimator.py:602] Stop output thread controller
I0811 22:00:27.948350 140449033930176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:00:27.948462 140448265901824 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:00:27.948549 140448265901824 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:00:27.948663 140449033930176 error_handling.py:96] outfeed marked as finished
I0811 22:00:27.948745 140449033930176 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:00:35.172079 140449033930176 estimator.py:368] Loss for final step: 0.17627355.
I0811 22:00:35.172930 140449033930176 error_handling.py:96] training_loop marked as finished
I0811 22:00:35.850898 140449033930176 estimator.py:1145] Calling model_fn.
E0811 22:00:36.536525 140449033930176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:00:36.730762 140449033930176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:00:36.758136 140449033930176 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:00:36.779125 140449033930176 estimator.py:1147] Done calling model_fn.
I0811 22:00:36.795977 140449033930176 evaluation.py:255] Starting evaluation at 2019-08-11T22:00:36Z
I0811 22:00:36.796211 140449033930176 tpu_estimator.py:499] TPU job name worker
I0811 22:00:36.869760 140449033930176 monitored_session.py:240] Graph was finalized.
W0811 22:00:36.870518 140449033930176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:00:37.089139 140449033930176 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:00:39.656068 140449033930176 session_manager.py:500] Running local_init_op.
I0811 22:00:39.687175 140449033930176 session_manager.py:502] Done running local_init_op.
I0811 22:00:39.738498 140449033930176 tpu_estimator.py:557] Init TPU system
I0811 22:01:48.641937 140449033930176 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:01:48.642858 140448270362368 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:01:48.643338 140448261969664 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:01:48.733764 140449033930176 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:01:48.760219 140449033930176 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:01:48.760571 140449033930176 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:01:48.785501 140447779387136 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:01:48.892251 140447779387136 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:01:49.520796 140448261969664 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:01:49.861969 140449033930176 evaluation.py:167] Evaluation [10/10]
I0811 22:01:49.862364 140449033930176 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:01:49.862441 140449033930176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:01:49.862631 140448270362368 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:01:49.862736 140448270362368 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:01:49.862864 140449033930176 error_handling.py:96] infeed marked as finished
I0811 22:01:49.862962 140449033930176 tpu_estimator.py:602] Stop output thread controller
I0811 22:01:49.863012 140449033930176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:01:49.863120 140448261969664 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:01:49.863208 140448261969664 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:01:49.863322 140449033930176 error_handling.py:96] outfeed marked as finished
I0811 22:01:49.863404 140449033930176 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:02:18.974113 140449033930176 evaluation.py:275] Finished evaluation at 2019-08-11-22:02:18
I0811 22:02:18.974452 140449033930176 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9538, global_step = 30, loss = 0.16669886
I0811 22:02:23.235572 140449033930176 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:02:24.034157 140449033930176 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.16669886, 'global_step': 30, 'accuracy': 0.9538}

Removing gs://yangyou-mnist/log/#1565560744517925...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565560756830754...
Removing gs://yangyou-mnist/log/checkpoint#1565560824379707...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565560744.v3-8-tpu#1565560827610279...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565560749080378...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565560761483346...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565560821416485...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565560822264694...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565560755936320...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565560826692403...
Removing gs://yangyou-mnist/log/eval/#1565560940638283...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565560940.v3-8-tpu#1565560943676229...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:02:27.857748 140633336780224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:02:27.858505 140633336780224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:02:27.861026 140633336780224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:02:27.861865 140633336780224 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:02:27.862443 140633336780224 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:02:27.862567 140633336780224 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:02:28.285340 140633336780224 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:02:28.292021 140633336780224 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:02:28.295511 140633336780224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:02:28.340864 140633336780224 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:02:28.341160 140633336780224 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:02:28.620867 140633336780224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:02:28.667073 140633336780224 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:02:28.667401 140633336780224 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:02:28.841308 140633336780224 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe79a3e7090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe79c5c5190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:02:28.841706 140633336780224 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:02:29.175765 140633336780224 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:02:29.178972: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:02:29.191378 140633336780224 tpu_system_metadata.py:148] Found TPU system:
I0811 22:02:29.191647 140633336780224 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:02:29.192241 140633336780224 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:02:29.192301 140633336780224 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:02:29.192361 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:02:29.192651 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:02:29.192708 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:02:29.192774 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:02:29.192833 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:02:29.192882 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:02:29.192928 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:02:29.192974 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:02:29.193020 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:02:29.193065 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:02:29.193113 140633336780224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:02:29.199275 140633336780224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:02:29.211697 140633336780224 estimator.py:1145] Calling model_fn.
W0811 22:02:29.212310 140633336780224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:02:29.486994 140633336780224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:02:29.905294 140633336780224 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:02:29.964390 140633336780224 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:02:29.970175 140633336780224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:02:30.142959 140633336780224 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:02:30.156454 140633336780224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:02:30.168111 140633336780224 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:02:30.168457 140633336780224 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:02:30.590105 140633336780224 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:02:30.605545 140633336780224 estimator.py:1147] Done calling model_fn.
I0811 22:02:33.912714 140633336780224 tpu_estimator.py:499] TPU job name worker
I0811 22:02:34.021251 140633336780224 monitored_session.py:240] Graph was finalized.
I0811 22:02:34.579134 140633336780224 session_manager.py:500] Running local_init_op.
I0811 22:02:34.609424 140633336780224 session_manager.py:502] Done running local_init_op.
I0811 22:02:37.090915 140633336780224 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:02:49.122289 140633336780224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:02:49.229895 140633336780224 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:02:49.230336 140633336780224 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:02:49.230716: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:02:49.235579 140633336780224 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:02:49.237716 140633336780224 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:02:49.241369 140633336780224 tpu_estimator.py:557] Init TPU system
I0811 22:03:32.683820 140633336780224 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 22:03:32.684760 140632443049728 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:03:32.685376 140632434657024 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:03:32.728874 140633336780224 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:03:32.729748 140633336780224 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:03:32.739392 140632426264320 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:03:33.011495 140632426264320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:03:37.616797 140632434657024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:03:42.161576 140633336780224 basic_session_run_hooks.py:262] loss = 2.301241, step = 30
I0811 22:03:42.163356 140633336780224 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:03:55.370733 140633336780224 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:03:55.371031 140633336780224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:03:55.371247 140632443049728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:03:55.371357 140632443049728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:03:55.371499 140633336780224 error_handling.py:96] infeed marked as finished
I0811 22:03:55.371598 140633336780224 tpu_estimator.py:602] Stop output thread controller
I0811 22:03:55.371645 140633336780224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:03:55.371754 140632434657024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:03:55.371853 140632434657024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:03:55.371968 140633336780224 error_handling.py:96] outfeed marked as finished
I0811 22:03:55.372057 140633336780224 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:04:03.146684 140633336780224 estimator.py:368] Loss for final step: 2.301241.
I0811 22:04:03.147826 140633336780224 error_handling.py:96] training_loop marked as finished
I0811 22:04:03.982978 140633336780224 estimator.py:1145] Calling model_fn.
E0811 22:04:04.655147 140633336780224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:04:04.844166 140633336780224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:04:04.871561 140633336780224 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:04:04.893271 140633336780224 estimator.py:1147] Done calling model_fn.
I0811 22:04:04.910049 140633336780224 evaluation.py:255] Starting evaluation at 2019-08-11T22:04:04Z
I0811 22:04:04.910296 140633336780224 tpu_estimator.py:499] TPU job name worker
I0811 22:04:04.984368 140633336780224 monitored_session.py:240] Graph was finalized.
W0811 22:04:04.985209 140633336780224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:04:05.170820 140633336780224 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:04:07.618231 140633336780224 session_manager.py:500] Running local_init_op.
I0811 22:04:07.646434 140633336780224 session_manager.py:502] Done running local_init_op.
I0811 22:04:07.691615 140633336780224 tpu_estimator.py:557] Init TPU system
I0811 22:05:16.664647 140633336780224 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:05:16.665541 140632439117568 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:05:16.666076 140632430724864 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:05:16.733653 140633336780224 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:05:16.760396 140633336780224 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:05:16.760750 140633336780224 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:05:16.790802 140632417609472 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:05:16.984726 140632417609472 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:05:17.467771 140632430724864 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:05:17.981895 140633336780224 evaluation.py:167] Evaluation [10/10]
I0811 22:05:17.982259 140633336780224 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:05:17.982333 140633336780224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:05:17.982503 140632439117568 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:05:17.982611 140632439117568 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:05:17.982754 140633336780224 error_handling.py:96] infeed marked as finished
I0811 22:05:17.982848 140633336780224 tpu_estimator.py:602] Stop output thread controller
I0811 22:05:17.982897 140633336780224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:05:17.983006 140632430724864 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:05:17.983077 140632430724864 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:05:17.983189 140633336780224 error_handling.py:96] outfeed marked as finished
I0811 22:05:17.983272 140633336780224 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:05:47.078752 140633336780224 evaluation.py:275] Finished evaluation at 2019-08-11-22:05:47
I0811 22:05:47.079111 140633336780224 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.299463
I0811 22:05:51.246731 140633336780224 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:05:52.055799 140633336780224 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.299463, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565560952049220...
Removing gs://yangyou-mnist/log/checkpoint#1565561032010730...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565560964139391...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565560968613314...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565561028973892...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565560952.v3-8-tpu#1565561035037758...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565560956531661...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565561029865682...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565560963235029...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565561034131075...
Removing gs://yangyou-mnist/log/eval/#1565561148678933...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565561148.v3-8-tpu#1565561151728426...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:05:55.833280 140211747763648 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:05:55.834253 140211747763648 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:05:55.836822 140211747763648 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:05:55.837686 140211747763648 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:05:55.838299 140211747763648 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:05:55.838427 140211747763648 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:05:56.252624 140211747763648 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:05:56.259094 140211747763648 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:05:56.262969 140211747763648 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:05:56.309022 140211747763648 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:05:56.309318 140211747763648 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:05:56.408947 140211747763648 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:05:56.454479 140211747763648 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:05:56.454755 140211747763648 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:05:56.615003 140211747763648 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8571949110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8573b27190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:05:56.615365 140211747763648 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:05:56.941101 140211747763648 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:05:56.943990: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:05:56.955991 140211747763648 tpu_system_metadata.py:148] Found TPU system:
I0811 22:05:56.956229 140211747763648 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:05:56.956739 140211747763648 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:05:56.956794 140211747763648 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:05:56.956846 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:05:56.957132 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:05:56.957187 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:05:56.957237 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:05:56.957300 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:05:56.957349 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:05:56.957397 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:05:56.957447 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:05:56.957493 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:05:56.957542 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:05:56.957648 140211747763648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:05:56.963560 140211747763648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:05:56.976325 140211747763648 estimator.py:1145] Calling model_fn.
W0811 22:05:56.976939 140211747763648 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:05:57.239640 140211747763648 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:05:57.653234 140211747763648 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:05:57.713665 140211747763648 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:05:57.719518 140211747763648 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:05:57.892781 140211747763648 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:05:57.906234 140211747763648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:05:57.917845 140211747763648 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:05:57.918157 140211747763648 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:05:58.337050 140211747763648 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:05:58.352488 140211747763648 estimator.py:1147] Done calling model_fn.
I0811 22:06:01.760953 140211747763648 tpu_estimator.py:499] TPU job name worker
I0811 22:06:01.872026 140211747763648 monitored_session.py:240] Graph was finalized.
I0811 22:06:02.430852 140211747763648 session_manager.py:500] Running local_init_op.
I0811 22:06:02.470309 140211747763648 session_manager.py:502] Done running local_init_op.
I0811 22:06:04.965962 140211747763648 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:06:17.648688 140211747763648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:06:17.776671 140211747763648 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:06:17.777132 140211747763648 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:06:17.777520: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:06:17.782511 140211747763648 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:06:17.784681 140211747763648 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:06:17.788497 140211747763648 tpu_estimator.py:557] Init TPU system
I0811 22:07:00.694603 140211747763648 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 22:07:00.695455 140210854151936 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:07:00.695959 140210845759232 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:07:00.738780 140211747763648 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:07:00.739646 140211747763648 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:07:00.752141 140210837366528 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:07:00.860791 140210837366528 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:07:05.198613 140210845759232 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:07:09.625153 140211747763648 basic_session_run_hooks.py:262] loss = 2.3027475, step = 30
I0811 22:07:09.628256 140211747763648 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:07:22.644752 140211747763648 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:07:22.645035 140211747763648 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:07:22.645318 140210854151936 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:07:22.645648 140210854151936 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:07:22.645879 140211747763648 error_handling.py:96] infeed marked as finished
I0811 22:07:22.646110 140211747763648 tpu_estimator.py:602] Stop output thread controller
I0811 22:07:22.646169 140211747763648 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:07:22.646341 140210845759232 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:07:22.646518 140210845759232 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:07:22.646678 140211747763648 error_handling.py:96] outfeed marked as finished
I0811 22:07:22.646821 140211747763648 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:07:30.993932 140211747763648 estimator.py:368] Loss for final step: 2.3027475.
I0811 22:07:30.994760 140211747763648 error_handling.py:96] training_loop marked as finished
I0811 22:07:31.794059 140211747763648 estimator.py:1145] Calling model_fn.
E0811 22:07:33.247822 140211747763648 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:07:33.440712 140211747763648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:07:33.467941 140211747763648 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:07:33.488873 140211747763648 estimator.py:1147] Done calling model_fn.
I0811 22:07:33.506479 140211747763648 evaluation.py:255] Starting evaluation at 2019-08-11T22:07:33Z
I0811 22:07:33.506717 140211747763648 tpu_estimator.py:499] TPU job name worker
I0811 22:07:33.582218 140211747763648 monitored_session.py:240] Graph was finalized.
W0811 22:07:33.582964 140211747763648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:07:33.767858 140211747763648 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:07:36.240490 140211747763648 session_manager.py:500] Running local_init_op.
I0811 22:07:36.268085 140211747763648 session_manager.py:502] Done running local_init_op.
I0811 22:07:36.317569 140211747763648 tpu_estimator.py:557] Init TPU system
I0811 22:08:44.606581 140211747763648 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:08:44.607558 140210850219776 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:08:44.608602 140210841827072 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:08:44.673362 140211747763648 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:08:44.700607 140211747763648 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:08:44.700974 140211747763648 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:08:44.730129 140210828711680 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:08:44.835803 140210828711680 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:08:45.452060 140210841827072 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:08:45.771414 140211747763648 evaluation.py:167] Evaluation [10/10]
I0811 22:08:45.771743 140211747763648 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:08:45.771816 140211747763648 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:08:45.772046 140210850219776 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:08:45.772357 140210850219776 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:08:45.772562 140211747763648 error_handling.py:96] infeed marked as finished
I0811 22:08:45.772754 140211747763648 tpu_estimator.py:602] Stop output thread controller
I0811 22:08:45.772815 140211747763648 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:08:45.772973 140210841827072 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:08:45.773117 140210841827072 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:08:45.773293 140211747763648 error_handling.py:96] outfeed marked as finished
I0811 22:08:45.773420 140211747763648 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:09:14.932878 140211747763648 evaluation.py:275] Finished evaluation at 2019-08-11-22:09:14
I0811 22:09:14.933233 140211747763648 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3013725
I0811 22:09:19.385970 140211747763648 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:09:20.239826 140211747763648 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3013725, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565561159842125...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565561164413759...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565561177115890...
Removing gs://yangyou-mnist/log/checkpoint#1565561239202179...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565561160.v3-8-tpu#1565561242319994...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565561237087003...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565561236201514...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565561171718641...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565561172682823...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565561241382414...
Removing gs://yangyou-mnist/log/eval/#1565561356722766...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565561356.v3-8-tpu#1565561359901819...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:09:23.970057 139718019982784 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:09:23.970819 139718019982784 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:09:23.973357 139718019982784 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:09:23.974163 139718019982784 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:09:23.974709 139718019982784 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:09:23.974833 139718019982784 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:09:24.399441 139718019982784 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:09:24.406750 139718019982784 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:09:24.410693 139718019982784 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:09:24.459084 139718019982784 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:09:24.459373 139718019982784 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:09:24.678184 139718019982784 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:09:24.724709 139718019982784 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:09:24.724991 139718019982784 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:09:24.818232 139718019982784 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f127d1c8050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f127f3a6190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:09:24.818593 139718019982784 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:09:25.142436 139718019982784 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:09:25.145275: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:09:25.157813 139718019982784 tpu_system_metadata.py:148] Found TPU system:
I0811 22:09:25.158098 139718019982784 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:09:25.158600 139718019982784 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:09:25.158663 139718019982784 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:09:25.158718 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:09:25.159007 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:09:25.159064 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:09:25.159120 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:09:25.159168 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:09:25.159216 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:09:25.159277 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:09:25.159324 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:09:25.159370 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:09:25.159420 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:09:25.159467 139718019982784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:09:25.165420 139718019982784 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:09:25.177721 139718019982784 estimator.py:1145] Calling model_fn.
W0811 22:09:25.178333 139718019982784 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:09:25.457366 139718019982784 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:09:25.962236 139718019982784 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:09:26.022274 139718019982784 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:09:26.028187 139718019982784 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:09:26.201554 139718019982784 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:09:26.214948 139718019982784 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:09:26.226620 139718019982784 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:09:26.226933 139718019982784 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:09:26.648919 139718019982784 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:09:26.664159 139718019982784 estimator.py:1147] Done calling model_fn.
I0811 22:09:31.158058 139718019982784 tpu_estimator.py:499] TPU job name worker
I0811 22:09:31.275324 139718019982784 monitored_session.py:240] Graph was finalized.
I0811 22:09:31.854468 139718019982784 session_manager.py:500] Running local_init_op.
I0811 22:09:31.884222 139718019982784 session_manager.py:502] Done running local_init_op.
I0811 22:09:34.591712 139718019982784 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:09:46.823904 139718019982784 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:09:46.928338 139718019982784 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:09:46.928812 139718019982784 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:09:46.929207: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:09:46.934564 139718019982784 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:09:46.936680 139718019982784 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:09:46.940789 139718019982784 tpu_estimator.py:557] Init TPU system
I0811 22:10:28.587827 139718019982784 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0811 22:10:28.588900 139717260588800 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:10:28.589560 139717252196096 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:10:28.633780 139718019982784 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:10:28.634686 139718019982784 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:10:28.654576 139717243803392 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:10:28.744782 139717243803392 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:10:33.263361 139717252196096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:10:37.833215 139718019982784 basic_session_run_hooks.py:262] loss = 2.3016698, step = 30
I0811 22:10:37.835709 139718019982784 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:10:51.139493 139718019982784 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:10:51.139775 139718019982784 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:10:51.140095 139717260588800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:10:51.140455 139717260588800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:10:51.140697 139718019982784 error_handling.py:96] infeed marked as finished
I0811 22:10:51.140918 139718019982784 tpu_estimator.py:602] Stop output thread controller
I0811 22:10:51.140978 139718019982784 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:10:51.141134 139717252196096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:10:51.141283 139717252196096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:10:51.141535 139718019982784 error_handling.py:96] outfeed marked as finished
I0811 22:10:51.141745 139718019982784 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:10:58.876578 139718019982784 estimator.py:368] Loss for final step: 2.3016698.
I0811 22:10:58.877357 139718019982784 error_handling.py:96] training_loop marked as finished
I0811 22:10:59.659852 139718019982784 estimator.py:1145] Calling model_fn.
E0811 22:11:00.350246 139718019982784 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:11:00.543322 139718019982784 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:11:00.571224 139718019982784 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:11:00.593086 139718019982784 estimator.py:1147] Done calling model_fn.
I0811 22:11:00.611134 139718019982784 evaluation.py:255] Starting evaluation at 2019-08-11T22:11:00Z
I0811 22:11:00.611368 139718019982784 tpu_estimator.py:499] TPU job name worker
I0811 22:11:00.685935 139718019982784 monitored_session.py:240] Graph was finalized.
W0811 22:11:00.686713 139718019982784 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:11:00.875272 139718019982784 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:11:03.483351 139718019982784 session_manager.py:500] Running local_init_op.
I0811 22:11:03.506890 139718019982784 session_manager.py:502] Done running local_init_op.
I0811 22:11:03.558193 139718019982784 tpu_estimator.py:557] Init TPU system
I0811 22:12:12.672442 139718019982784 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 22:12:12.673455 139717256656640 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:12:12.673991 139717248263936 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:12:12.740190 139718019982784 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:12:12.764653 139718019982784 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:12:12.765018 139718019982784 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:12:12.843204 139716762531584 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:12:12.937786 139716762531584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:12:13.509346 139717248263936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:12:13.810751 139718019982784 evaluation.py:167] Evaluation [10/10]
I0811 22:12:13.811093 139718019982784 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:12:13.811158 139718019982784 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:12:13.811379 139717256656640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:12:13.811486 139717256656640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:12:13.811628 139718019982784 error_handling.py:96] infeed marked as finished
I0811 22:12:13.811718 139718019982784 tpu_estimator.py:602] Stop output thread controller
I0811 22:12:13.811769 139718019982784 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:12:13.811877 139717248263936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:12:13.811952 139717248263936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:12:13.812063 139718019982784 error_handling.py:96] outfeed marked as finished
I0811 22:12:13.812139 139718019982784 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:12:43.037041 139718019982784 evaluation.py:275] Finished evaluation at 2019-08-11-22:12:43
I0811 22:12:43.037359 139718019982784 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3006055
I0811 22:12:47.636473 139718019982784 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:12:48.420070 139718019982784 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3006055, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565561369176788...
Removing gs://yangyou-mnist/log/checkpoint#1565561447665721...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565561381961566...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565561369.v3-8-tpu#1565561450810065...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565561374026710...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565561386312464...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565561381001455...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565561444467404...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565561445332155...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565561449894685...
Removing gs://yangyou-mnist/log/eval/#1565561564662076...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565561564.v3-8-tpu#1565561568087475...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:12:52.161972 140214448616896 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:12:52.162749 140214448616896 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:12:52.165337 140214448616896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:12:52.166188 140214448616896 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:12:52.166800 140214448616896 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:12:52.166937 140214448616896 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:12:52.583318 140214448616896 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:12:52.590256 140214448616896 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:12:52.593862 140214448616896 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:12:52.692198 140214448616896 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:12:52.692488 140214448616896 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:12:52.803605 140214448616896 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:12:52.850596 140214448616896 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:12:52.850881 140214448616896 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:12:53.123910 140214448616896 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f86129050d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8614ae3190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:12:53.124296 140214448616896 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:12:53.448721 140214448616896 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:12:53.451767: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:12:53.465321 140214448616896 tpu_system_metadata.py:148] Found TPU system:
I0811 22:12:53.465554 140214448616896 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:12:53.466100 140214448616896 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:12:53.466161 140214448616896 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:12:53.466214 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:12:53.466510 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:12:53.466590 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:12:53.466643 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:12:53.466691 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:12:53.466738 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:12:53.466788 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:12:53.466835 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:12:53.466892 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:12:53.466938 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:12:53.466988 140214448616896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:12:53.472739 140214448616896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:12:53.484716 140214448616896 estimator.py:1145] Calling model_fn.
W0811 22:12:53.485296 140214448616896 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:12:53.754800 140214448616896 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:12:54.178778 140214448616896 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:12:54.239835 140214448616896 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:12:54.245644 140214448616896 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:12:54.425357 140214448616896 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:12:54.438548 140214448616896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:12:54.450104 140214448616896 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:12:54.450387 140214448616896 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:12:54.862900 140214448616896 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:12:54.877844 140214448616896 estimator.py:1147] Done calling model_fn.
I0811 22:12:58.144280 140214448616896 tpu_estimator.py:499] TPU job name worker
I0811 22:12:58.257401 140214448616896 monitored_session.py:240] Graph was finalized.
I0811 22:12:58.816643 140214448616896 session_manager.py:500] Running local_init_op.
I0811 22:12:58.850091 140214448616896 session_manager.py:502] Done running local_init_op.
I0811 22:13:01.316879 140214448616896 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:13:13.199727 140214448616896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:13:13.317173 140214448616896 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:13:13.317692 140214448616896 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:13:13.318114: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:13:13.322890 140214448616896 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:13:13.324959 140214448616896 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:13:13.330210 140214448616896 tpu_estimator.py:557] Init TPU system
I0811 22:13:56.674571 140214448616896 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 22:13:56.675714 140213552666368 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:13:56.676505 140213544273664 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:13:56.727211 140214448616896 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:13:56.731106 140214448616896 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:13:56.739784 140213535880960 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:13:56.835593 140213535880960 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:14:01.392976 140213544273664 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:14:05.966969 140214448616896 basic_session_run_hooks.py:262] loss = 2.3045447, step = 30
I0811 22:14:05.969139 140214448616896 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:14:19.141079 140214448616896 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:14:19.141362 140214448616896 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:14:19.141566 140213552666368 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:14:19.141717 140213552666368 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:14:19.141856 140214448616896 error_handling.py:96] infeed marked as finished
I0811 22:14:19.141946 140214448616896 tpu_estimator.py:602] Stop output thread controller
I0811 22:14:19.142016 140214448616896 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:14:19.142138 140213544273664 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:14:19.142210 140213544273664 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:14:19.142323 140214448616896 error_handling.py:96] outfeed marked as finished
I0811 22:14:19.142405 140214448616896 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:14:26.964792 140214448616896 estimator.py:368] Loss for final step: 2.3045447.
I0811 22:14:26.965647 140214448616896 error_handling.py:96] training_loop marked as finished
I0811 22:14:27.647222 140214448616896 estimator.py:1145] Calling model_fn.
E0811 22:14:28.795795 140214448616896 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:14:28.988221 140214448616896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:14:29.015840 140214448616896 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:14:29.036506 140214448616896 estimator.py:1147] Done calling model_fn.
I0811 22:14:29.054270 140214448616896 evaluation.py:255] Starting evaluation at 2019-08-11T22:14:29Z
I0811 22:14:29.054511 140214448616896 tpu_estimator.py:499] TPU job name worker
I0811 22:14:29.130028 140214448616896 monitored_session.py:240] Graph was finalized.
W0811 22:14:29.130805 140214448616896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:14:29.316906 140214448616896 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:14:31.699918 140214448616896 session_manager.py:500] Running local_init_op.
I0811 22:14:31.727682 140214448616896 session_manager.py:502] Done running local_init_op.
I0811 22:14:31.781128 140214448616896 tpu_estimator.py:557] Init TPU system
I0811 22:15:40.656228 140214448616896 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:15:40.657305 140213550831360 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:15:40.658091 140213542438656 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:15:40.732512 140214448616896 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:15:40.756861 140214448616896 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:15:40.757209 140214448616896 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:15:40.786412 140213534045952 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:15:41.019897 140213534045952 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:15:41.512377 140213542438656 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:15:41.783144 140214448616896 evaluation.py:167] Evaluation [10/10]
I0811 22:15:41.783514 140214448616896 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:15:41.783591 140214448616896 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:15:41.783864 140213550831360 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:15:41.784141 140213550831360 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:15:41.784374 140214448616896 error_handling.py:96] infeed marked as finished
I0811 22:15:41.784590 140214448616896 tpu_estimator.py:602] Stop output thread controller
I0811 22:15:41.784651 140214448616896 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:15:41.784813 140213542438656 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:15:41.784953 140213542438656 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:15:41.785110 140214448616896 error_handling.py:96] outfeed marked as finished
I0811 22:15:41.785240 140214448616896 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:16:11.116694 140214448616896 evaluation.py:275] Finished evaluation at 2019-08-11-22:16:11
I0811 22:16:11.117100 140214448616896 estimator.py:2039] Saving dict for global step 30: accuracy = 0.098, global_step = 30, loss = 2.3050504
I0811 22:16:15.414505 140214448616896 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:16:16.252815 140214448616896 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3050504, 'global_step': 30, 'accuracy': 0.098}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565561588133397...
Removing gs://yangyou-mnist/log/#1565561576386089...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565561592694945...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565561576.v3-8-tpu#1565561658811938...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565561587222547...
Removing gs://yangyou-mnist/log/checkpoint#1565561655680334...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565561580770197...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565561652620951...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565561653455193...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565561657816446...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565561773.v3-8-tpu#1565561775897952...
Removing gs://yangyou-mnist/log/eval/#1565561772881715...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:16:20.075422 139924415768000 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:16:20.076201 139924415768000 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:16:20.078805 139924415768000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:16:20.079619 139924415768000 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:16:20.080209 139924415768000 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:16:20.080333 139924415768000 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:16:20.481420 139924415768000 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:16:20.487992 139924415768000 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:16:20.491890 139924415768000 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:16:20.539748 139924415768000 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:16:20.540026 139924415768000 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:16:20.632041 139924415768000 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:16:20.726239 139924415768000 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:16:20.726536 139924415768000 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:16:20.925133 139924415768000 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f428b424110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f428d602150>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:16:20.925493 139924415768000 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:16:21.257045 139924415768000 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:16:21.260191: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:16:21.274533 139924415768000 tpu_system_metadata.py:148] Found TPU system:
I0811 22:16:21.274786 139924415768000 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:16:21.275295 139924415768000 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:16:21.275355 139924415768000 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:16:21.275408 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:16:21.275701 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:16:21.275757 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:16:21.275806 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:16:21.275854 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:16:21.275901 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:16:21.275948 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:16:21.275994 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:16:21.276038 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:16:21.276122 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:16:21.276174 139924415768000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:16:21.282327 139924415768000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:16:21.294951 139924415768000 estimator.py:1145] Calling model_fn.
W0811 22:16:21.295577 139924415768000 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:16:21.558744 139924415768000 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:16:21.967884 139924415768000 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:16:22.028784 139924415768000 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:16:22.034992 139924415768000 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:16:22.212033 139924415768000 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:16:22.225514 139924415768000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:16:22.237525 139924415768000 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:16:22.237873 139924415768000 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:16:22.662636 139924415768000 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:16:22.678013 139924415768000 estimator.py:1147] Done calling model_fn.
I0811 22:16:25.953622 139924415768000 tpu_estimator.py:499] TPU job name worker
I0811 22:16:26.070095 139924415768000 monitored_session.py:240] Graph was finalized.
I0811 22:16:26.673017 139924415768000 session_manager.py:500] Running local_init_op.
I0811 22:16:26.705724 139924415768000 session_manager.py:502] Done running local_init_op.
I0811 22:16:29.316282 139924415768000 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:16:41.556658 139924415768000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:16:41.661106 139924415768000 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:16:41.661571 139924415768000 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:16:41.662009: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:16:41.666532 139924415768000 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:16:41.668585 139924415768000 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:16:41.671710 139924415768000 tpu_estimator.py:557] Init TPU system
I0811 22:17:24.556924 139924415768000 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 22:17:24.557846 139923382331136 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:17:24.558322 139923373938432 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:17:24.605118 139924415768000 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:17:24.606062 139924415768000 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:17:24.616997 139923365545728 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:17:24.732335 139923365545728 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 22:17:29.402998 139923373938432 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:17:34.043720 139924415768000 basic_session_run_hooks.py:262] loss = 2.3058565, step = 30
I0811 22:17:34.046109 139924415768000 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:17:47.477444 139924415768000 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:17:47.477854 139924415768000 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:17:47.479465 139923382331136 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:17:47.479628 139923382331136 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:17:47.479787 139924415768000 error_handling.py:96] infeed marked as finished
I0811 22:17:47.479898 139924415768000 tpu_estimator.py:602] Stop output thread controller
I0811 22:17:47.480037 139924415768000 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:17:47.480166 139923373938432 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:17:47.480253 139923373938432 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:17:47.480375 139924415768000 error_handling.py:96] outfeed marked as finished
I0811 22:17:47.480473 139924415768000 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:17:54.868119 139924415768000 estimator.py:368] Loss for final step: 2.3058565.
I0811 22:17:54.868993 139924415768000 error_handling.py:96] training_loop marked as finished
I0811 22:17:55.565974 139924415768000 estimator.py:1145] Calling model_fn.
E0811 22:17:56.245127 139924415768000 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:17:56.442826 139924415768000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:17:56.470046 139924415768000 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:17:56.490861 139924415768000 estimator.py:1147] Done calling model_fn.
I0811 22:17:56.507947 139924415768000 evaluation.py:255] Starting evaluation at 2019-08-11T22:17:56Z
I0811 22:17:56.508182 139924415768000 tpu_estimator.py:499] TPU job name worker
I0811 22:17:56.582758 139924415768000 monitored_session.py:240] Graph was finalized.
W0811 22:17:56.583487 139924415768000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:17:56.772383 139924415768000 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:17:59.306301 139924415768000 session_manager.py:500] Running local_init_op.
I0811 22:17:59.329117 139924415768000 session_manager.py:502] Done running local_init_op.
I0811 22:17:59.380886 139924415768000 tpu_estimator.py:557] Init TPU system
I0811 22:19:08.623790 139924415768000 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 22:19:08.624675 139923382331136 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:19:08.625082 139923373938432 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:19:08.703422 139924415768000 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:19:08.726766 139924415768000 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:19:08.727108 139924415768000 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:19:08.756337 139923365545728 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:19:08.871997 139923365545728 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:19:09.472696 139923373938432 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:19:09.843945 139924415768000 evaluation.py:167] Evaluation [10/10]
I0811 22:19:09.844333 139924415768000 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:19:09.844427 139924415768000 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:19:09.844618 139923382331136 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:19:09.844722 139923382331136 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:19:09.844858 139924415768000 error_handling.py:96] infeed marked as finished
I0811 22:19:09.844949 139924415768000 tpu_estimator.py:602] Stop output thread controller
I0811 22:19:09.845005 139924415768000 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:19:09.845113 139923373938432 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:19:09.845202 139923373938432 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:19:09.845314 139924415768000 error_handling.py:96] outfeed marked as finished
I0811 22:19:09.845402 139924415768000 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:19:38.970334 139924415768000 evaluation.py:275] Finished evaluation at 2019-08-11-22:19:38
I0811 22:19:38.970722 139924415768000 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3010235
I0811 22:19:43.219954 139924415768000 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:19:44.455589 139924415768000 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3010235, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565561784156900...
Removing gs://yangyou-mnist/log/checkpoint#1565561863823283...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565561784.v3-8-tpu#1565561867128766...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565561788747054...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565561795642460...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565561796517512...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565561800947968...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565561860652735...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565561861466400...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565561866226215...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565561980594875...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565561980.v3-8-tpu#1565561984099351...
/ [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:19:48.197410 140474770146752 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:19:48.198225 140474770146752 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:19:48.200720 140474770146752 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:19:48.201481 140474770146752 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:19:48.202171 140474770146752 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:19:48.202299 140474770146752 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:19:48.615102 140474770146752 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:19:48.621406 140474770146752 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:19:48.625228 140474770146752 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:19:48.677018 140474770146752 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:19:48.677304 140474770146752 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:19:48.835324 140474770146752 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:19:48.883976 140474770146752 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:19:48.884246 140474770146752 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:19:48.983326 140474770146752 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc2aeee3490>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc2b10d8190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:19:48.983714 140474770146752 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:19:49.312127 140474770146752 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:19:49.315099: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:19:49.327852 140474770146752 tpu_system_metadata.py:148] Found TPU system:
I0811 22:19:49.328103 140474770146752 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:19:49.328619 140474770146752 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:19:49.328689 140474770146752 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:19:49.328747 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:19:49.329054 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:19:49.329229 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:19:49.329318 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:19:49.329401 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:19:49.329483 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:19:49.329566 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:19:49.329675 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:19:49.329730 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:19:49.329780 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:19:49.329829 140474770146752 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:19:49.335896 140474770146752 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:19:49.348375 140474770146752 estimator.py:1145] Calling model_fn.
W0811 22:19:49.348968 140474770146752 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:19:49.612934 140474770146752 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:19:50.045741 140474770146752 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:19:50.106193 140474770146752 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:19:50.111908 140474770146752 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:19:50.286545 140474770146752 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:19:50.300024 140474770146752 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:19:50.311671 140474770146752 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:19:50.311975 140474770146752 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:19:50.725538 140474770146752 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:19:50.740772 140474770146752 estimator.py:1147] Done calling model_fn.
I0811 22:19:54.084482 140474770146752 tpu_estimator.py:499] TPU job name worker
I0811 22:19:54.197674 140474770146752 monitored_session.py:240] Graph was finalized.
I0811 22:19:54.780052 140474770146752 session_manager.py:500] Running local_init_op.
I0811 22:19:54.818629 140474770146752 session_manager.py:502] Done running local_init_op.
I0811 22:19:57.268759 140474770146752 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:20:09.523808 140474770146752 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:20:09.629354 140474770146752 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:20:09.629897 140474770146752 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:20:09.630325: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:20:09.634597 140474770146752 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:20:09.636687 140474770146752 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:20:09.640446 140474770146752 tpu_estimator.py:557] Init TPU system
I0811 22:20:52.684945 140474770146752 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 22:20:52.685786 140473742124800 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:20:52.686280 140473733732096 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:20:52.730887 140474770146752 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:20:52.731759 140474770146752 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:20:52.742681 140473725339392 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:20:52.937386 140473725339392 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:20:57.134902 140473733732096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:21:01.680356 140474770146752 basic_session_run_hooks.py:262] loss = 1.0700127, step = 30
I0811 22:21:01.682877 140474770146752 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:21:14.918596 140474770146752 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:21:14.918941 140474770146752 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:21:14.919178 140473742124800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:21:14.919298 140473742124800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:21:14.919441 140474770146752 error_handling.py:96] infeed marked as finished
I0811 22:21:14.919548 140474770146752 tpu_estimator.py:602] Stop output thread controller
I0811 22:21:14.919606 140474770146752 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:21:14.919723 140473733732096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:21:14.919800 140473733732096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:21:14.919934 140474770146752 error_handling.py:96] outfeed marked as finished
I0811 22:21:14.920022 140474770146752 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:21:23.069935 140474770146752 estimator.py:368] Loss for final step: 1.0700127.
I0811 22:21:23.070744 140474770146752 error_handling.py:96] training_loop marked as finished
I0811 22:21:23.861187 140474770146752 estimator.py:1145] Calling model_fn.
E0811 22:21:24.684453 140474770146752 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:21:24.873892 140474770146752 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:21:24.901104 140474770146752 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:21:24.921648 140474770146752 estimator.py:1147] Done calling model_fn.
I0811 22:21:24.937777 140474770146752 evaluation.py:255] Starting evaluation at 2019-08-11T22:21:24Z
I0811 22:21:24.938019 140474770146752 tpu_estimator.py:499] TPU job name worker
I0811 22:21:25.011318 140474770146752 monitored_session.py:240] Graph was finalized.
W0811 22:21:25.012026 140474770146752 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:21:25.199238 140474770146752 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:21:27.763597 140474770146752 session_manager.py:500] Running local_init_op.
I0811 22:21:27.787198 140474770146752 session_manager.py:502] Done running local_init_op.
I0811 22:21:27.843203 140474770146752 tpu_estimator.py:557] Init TPU system
I0811 22:22:36.596581 140474770146752 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:22:36.597440 140473738192640 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:22:36.598275 140473729799936 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:22:36.670047 140474770146752 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:22:36.699179 140474770146752 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:22:36.699522 140474770146752 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:22:36.730128 140473721407232 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:22:36.853295 140473721407232 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:22:37.466025 140473729799936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:22:37.883260 140474770146752 evaluation.py:167] Evaluation [10/10]
I0811 22:22:37.883600 140474770146752 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:22:37.883687 140474770146752 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:22:37.883954 140473738192640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:22:37.884248 140473738192640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:22:37.884500 140474770146752 error_handling.py:96] infeed marked as finished
I0811 22:22:37.884771 140474770146752 tpu_estimator.py:602] Stop output thread controller
I0811 22:22:37.884839 140474770146752 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:22:37.885015 140473729799936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:22:37.885174 140473729799936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:22:37.885309 140474770146752 error_handling.py:96] outfeed marked as finished
I0811 22:22:37.885426 140474770146752 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:23:06.949657 140474770146752 evaluation.py:275] Finished evaluation at 2019-08-11-22:23:06
I0811 22:23:06.950011 140474770146752 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8327, global_step = 30, loss = 0.97933304
I0811 22:23:11.536962 140474770146752 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:23:12.386339 140474770146752 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.97933304, 'global_step': 30, 'accuracy': 0.8327}

Removing gs://yangyou-mnist/log/#1565561992204860...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565562004405503...
Removing gs://yangyou-mnist/log/checkpoint#1565562071487215...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565561996696455...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565562009013017...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565561992.v3-8-tpu#1565562074585004...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565562068319361...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565562003457853...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565562069210175...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565562073634101...
Removing gs://yangyou-mnist/log/eval/#1565562188596823...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565562188.v3-8-tpu#1565562192054570...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:23:16.207874 140472583902656 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:23:16.208693 140472583902656 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:23:16.211308 140472583902656 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:23:16.212119 140472583902656 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:23:16.212672 140472583902656 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:23:16.212800 140472583902656 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:23:16.634116 140472583902656 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:23:16.640455 140472583902656 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:23:16.644253 140472583902656 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:23:16.689901 140472583902656 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:23:16.690188 140472583902656 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:23:16.799427 140472583902656 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:23:16.849497 140472583902656 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:23:16.849827 140472583902656 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:23:17.041517 140472583902656 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc22c9ec510>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc22ebe1190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:23:17.041930 140472583902656 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:23:17.371346 140472583902656 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:23:17.374321: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:23:17.387048 140472583902656 tpu_system_metadata.py:148] Found TPU system:
I0811 22:23:17.387311 140472583902656 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:23:17.391160 140472583902656 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:23:17.391309 140472583902656 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:23:17.391370 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:23:17.391874 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:23:17.391935 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:23:17.391989 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:23:17.392041 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:23:17.392091 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:23:17.392153 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:23:17.392208 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:23:17.392266 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:23:17.392313 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:23:17.392360 140472583902656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:23:17.398658 140472583902656 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:23:17.411180 140472583902656 estimator.py:1145] Calling model_fn.
W0811 22:23:17.411776 140472583902656 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:23:17.673338 140472583902656 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:23:18.119896 140472583902656 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:23:18.182894 140472583902656 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:23:18.188919 140472583902656 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:23:18.366841 140472583902656 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:23:18.380310 140472583902656 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:23:18.392045 140472583902656 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:23:18.392376 140472583902656 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:23:18.790502 140472583902656 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:23:18.805800 140472583902656 estimator.py:1147] Done calling model_fn.
I0811 22:23:22.294224 140472583902656 tpu_estimator.py:499] TPU job name worker
I0811 22:23:22.408334 140472583902656 monitored_session.py:240] Graph was finalized.
I0811 22:23:22.975007 140472583902656 session_manager.py:500] Running local_init_op.
I0811 22:23:23.008127 140472583902656 session_manager.py:502] Done running local_init_op.
I0811 22:23:25.515665 140472583902656 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:23:37.790930 140472583902656 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:23:37.903230 140472583902656 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:23:37.903707 140472583902656 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:23:37.904069: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:23:37.908319 140472583902656 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:23:37.910352 140472583902656 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:23:37.914077 140472583902656 tpu_estimator.py:557] Init TPU system
I0811 22:24:20.696003 140472583902656 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 22:24:20.696906 140471824525056 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:24:20.697427 140471816132352 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:24:20.741113 140472583902656 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:24:20.743002 140472583902656 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:24:20.754221 140471334598400 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:24:20.834522 140471334598400 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:24:25.413780 140471816132352 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:24:29.882167 140472583902656 basic_session_run_hooks.py:262] loss = 0.4572305, step = 30
I0811 22:24:29.884366 140472583902656 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:24:43.071417 140472583902656 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:24:43.071728 140472583902656 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:24:43.071959 140471824525056 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:24:43.072067 140471824525056 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:24:43.072204 140472583902656 error_handling.py:96] infeed marked as finished
I0811 22:24:43.072299 140472583902656 tpu_estimator.py:602] Stop output thread controller
I0811 22:24:43.072346 140472583902656 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:24:43.072463 140471816132352 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:24:43.072535 140471816132352 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:24:43.072645 140472583902656 error_handling.py:96] outfeed marked as finished
I0811 22:24:43.072726 140472583902656 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:24:50.969552 140472583902656 estimator.py:368] Loss for final step: 0.4572305.
I0811 22:24:50.970370 140472583902656 error_handling.py:96] training_loop marked as finished
I0811 22:24:51.647178 140472583902656 estimator.py:1145] Calling model_fn.
E0811 22:24:52.352066 140472583902656 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:24:52.544790 140472583902656 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:24:52.571844 140472583902656 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:24:52.592962 140472583902656 estimator.py:1147] Done calling model_fn.
I0811 22:24:52.610933 140472583902656 evaluation.py:255] Starting evaluation at 2019-08-11T22:24:52Z
I0811 22:24:52.611162 140472583902656 tpu_estimator.py:499] TPU job name worker
I0811 22:24:52.686997 140472583902656 monitored_session.py:240] Graph was finalized.
W0811 22:24:52.687767 140472583902656 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:24:52.874650 140472583902656 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:24:55.403723 140472583902656 session_manager.py:500] Running local_init_op.
I0811 22:24:55.426712 140472583902656 session_manager.py:502] Done running local_init_op.
I0811 22:24:55.471524 140472583902656 tpu_estimator.py:557] Init TPU system
I0811 22:26:04.619894 140472583902656 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 22:26:04.620827 140471820592896 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:26:04.621243 140471334598400 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:26:04.685347 140472583902656 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:26:04.709805 140472583902656 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:26:04.710160 140472583902656 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:26:04.742572 140471326205696 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:26:04.860083 140471326205696 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:26:05.448493 140471334598400 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:26:05.788440 140472583902656 evaluation.py:167] Evaluation [10/10]
I0811 22:26:05.788860 140472583902656 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:26:05.788939 140472583902656 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:26:05.789140 140471820592896 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:26:05.789266 140471820592896 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:26:05.789396 140472583902656 error_handling.py:96] infeed marked as finished
I0811 22:26:05.789495 140472583902656 tpu_estimator.py:602] Stop output thread controller
I0811 22:26:05.789557 140472583902656 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:26:05.789710 140471334598400 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:26:05.789787 140471334598400 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:26:05.789901 140472583902656 error_handling.py:96] outfeed marked as finished
I0811 22:26:05.789983 140472583902656 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:26:34.954242 140472583902656 evaluation.py:275] Finished evaluation at 2019-08-11-22:26:34
I0811 22:26:34.954616 140472583902656 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8951, global_step = 30, loss = 0.43330303
I0811 22:26:39.368175 140472583902656 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:26:40.194854 140472583902656 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.43330303, 'global_step': 30, 'accuracy': 0.8951}

Removing gs://yangyou-mnist/log/#1565562200290242...
Removing gs://yangyou-mnist/log/checkpoint#1565562279674031...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565562200.v3-8-tpu#1565562282720426...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565562212720224...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565562204961396...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565562217144142...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565562277476123...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565562211848977...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565562276540495...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565562281755953...
Removing gs://yangyou-mnist/log/eval/#1565562396567347...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565562396.v3-8-tpu#1565562399856247...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:26:44.078133 140368719963584 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:26:44.078936 140368719963584 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:26:44.081475 140368719963584 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:26:44.082382 140368719963584 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:26:44.082984 140368719963584 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:26:44.083110 140368719963584 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:26:44.491616 140368719963584 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:26:44.500761 140368719963584 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:26:44.505819 140368719963584 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:26:44.555764 140368719963584 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:26:44.556085 140368719963584 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:26:44.808523 140368719963584 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:26:44.857966 140368719963584 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:26:44.858264 140368719963584 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:26:44.976790 140368719963584 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa9fdda4150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa9fff82190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:26:44.977179 140368719963584 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:26:45.310806 140368719963584 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:26:45.314649: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:26:45.327166 140368719963584 tpu_system_metadata.py:148] Found TPU system:
I0811 22:26:45.327434 140368719963584 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:26:45.328027 140368719963584 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:26:45.328094 140368719963584 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:26:45.328161 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:26:45.328490 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:26:45.328562 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:26:45.328619 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:26:45.328680 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:26:45.328735 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:26:45.328788 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:26:45.328840 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:26:45.328892 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:26:45.328944 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:26:45.329006 140368719963584 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:26:45.335968 140368719963584 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:26:45.350805 140368719963584 estimator.py:1145] Calling model_fn.
W0811 22:26:45.351522 140368719963584 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:26:45.631999 140368719963584 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:26:46.071957 140368719963584 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:26:46.133521 140368719963584 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:26:46.139683 140368719963584 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:26:46.316237 140368719963584 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:26:46.329750 140368719963584 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:26:46.341371 140368719963584 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:26:46.341711 140368719963584 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:26:46.760720 140368719963584 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:26:46.776072 140368719963584 estimator.py:1147] Done calling model_fn.
I0811 22:26:50.290067 140368719963584 tpu_estimator.py:499] TPU job name worker
I0811 22:26:50.401206 140368719963584 monitored_session.py:240] Graph was finalized.
I0811 22:26:50.957787 140368719963584 session_manager.py:500] Running local_init_op.
I0811 22:26:50.996124 140368719963584 session_manager.py:502] Done running local_init_op.
I0811 22:26:53.532207 140368719963584 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:27:05.332273 140368719963584 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:27:05.436058 140368719963584 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:27:05.436583 140368719963584 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:27:05.436975: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:27:05.442217 140368719963584 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:27:05.444359 140368719963584 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:27:05.447870 140368719963584 tpu_estimator.py:557] Init TPU system
I0811 22:27:48.683140 140368719963584 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 22:27:48.684137 140367960459008 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:27:48.684617 140367952066304 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:27:48.733721 140368719963584 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:27:48.734616 140368719963584 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:27:48.744141 140367943673600 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:27:48.897620 140367943673600 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:27:53.409095 140367952066304 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:27:57.901546 140368719963584 basic_session_run_hooks.py:262] loss = 0.26817188, step = 30
I0811 22:27:57.903898 140368719963584 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:28:10.708595 140368719963584 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:28:10.708885 140368719963584 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:28:10.709095 140367960459008 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:28:10.709199 140367960459008 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:28:10.709364 140368719963584 error_handling.py:96] infeed marked as finished
I0811 22:28:10.709471 140368719963584 tpu_estimator.py:602] Stop output thread controller
I0811 22:28:10.709520 140368719963584 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:28:10.709672 140367952066304 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:28:10.709752 140367952066304 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:28:10.709871 140368719963584 error_handling.py:96] outfeed marked as finished
I0811 22:28:10.709952 140368719963584 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:28:19.029288 140368719963584 estimator.py:368] Loss for final step: 0.26817188.
I0811 22:28:19.030199 140368719963584 error_handling.py:96] training_loop marked as finished
I0811 22:28:19.730479 140368719963584 estimator.py:1145] Calling model_fn.
E0811 22:28:20.456372 140368719963584 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:28:20.646473 140368719963584 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:28:20.673321 140368719963584 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:28:20.694103 140368719963584 estimator.py:1147] Done calling model_fn.
I0811 22:28:20.710848 140368719963584 evaluation.py:255] Starting evaluation at 2019-08-11T22:28:20Z
I0811 22:28:20.711087 140368719963584 tpu_estimator.py:499] TPU job name worker
I0811 22:28:20.785525 140368719963584 monitored_session.py:240] Graph was finalized.
W0811 22:28:20.786281 140368719963584 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:28:20.976196 140368719963584 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:28:23.570257 140368719963584 session_manager.py:500] Running local_init_op.
I0811 22:28:23.594400 140368719963584 session_manager.py:502] Done running local_init_op.
I0811 22:28:23.647711 140368719963584 tpu_estimator.py:557] Init TPU system
I0811 22:29:32.609940 140368719963584 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:29:32.611090 140367956526848 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:29:32.611865 140367948134144 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:29:32.677728 140368719963584 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:29:32.700567 140368719963584 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:29:32.700958 140368719963584 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:29:32.733858 140367935018752 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:29:32.885305 140367935018752 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:29:33.429652 140367948134144 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:29:33.908523 140368719963584 evaluation.py:167] Evaluation [10/10]
I0811 22:29:33.908874 140368719963584 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:29:33.908960 140368719963584 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:29:33.909126 140367956526848 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:29:33.909215 140367956526848 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:29:33.909353 140368719963584 error_handling.py:96] infeed marked as finished
I0811 22:29:33.909440 140368719963584 tpu_estimator.py:602] Stop output thread controller
I0811 22:29:33.909488 140368719963584 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:29:33.909631 140367948134144 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:29:33.909715 140367948134144 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:29:33.909832 140368719963584 error_handling.py:96] outfeed marked as finished
I0811 22:29:33.909912 140368719963584 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:30:02.978984 140368719963584 evaluation.py:275] Finished evaluation at 2019-08-11-22:30:02
I0811 22:30:02.979326 140368719963584 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9331, global_step = 30, loss = 0.2594932
I0811 22:30:07.346857 140368719963584 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:30:08.153656 140368719963584 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.2594932, 'global_step': 30, 'accuracy': 0.9331}

Removing gs://yangyou-mnist/log/#1565562408329993...
Removing gs://yangyou-mnist/log/checkpoint#1565562487449541...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565562413022272...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565562420644518...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565562424866850...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565562408.v3-8-tpu#1565562490381673...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565562484530030...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565562485292110...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565562419823819...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565562489467947...
Removing gs://yangyou-mnist/log/eval/#1565562604666920...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565562604.v3-8-tpu#1565562607807371...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:30:11.918113 139814928508352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:30:11.918925 139814928508352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:30:11.921565 139814928508352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:30:11.922466 139814928508352 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:30:11.923072 139814928508352 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:30:11.923204 139814928508352 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:30:12.327903 139814928508352 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:30:12.334707 139814928508352 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:30:12.338736 139814928508352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:30:12.431468 139814928508352 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:30:12.431744 139814928508352 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:30:12.584233 139814928508352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:30:12.630382 139814928508352 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:30:12.630651 139814928508352 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:30:12.725214 139814928508352 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f290d4dd490>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f290f6d2190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:30:12.725620 139814928508352 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:30:13.074100 139814928508352 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:30:13.077134: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:30:13.090198 139814928508352 tpu_system_metadata.py:148] Found TPU system:
I0811 22:30:13.090496 139814928508352 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:30:13.091003 139814928508352 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:30:13.091062 139814928508352 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:30:13.091115 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:30:13.091411 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:30:13.091468 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:30:13.091517 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:30:13.091567 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:30:13.091614 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:30:13.091660 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:30:13.091713 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:30:13.091764 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:30:13.091810 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:30:13.091859 139814928508352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:30:13.098177 139814928508352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:30:13.111116 139814928508352 estimator.py:1145] Calling model_fn.
W0811 22:30:13.111752 139814928508352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:30:13.379947 139814928508352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:30:13.885426 139814928508352 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:30:13.945806 139814928508352 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:30:13.951817 139814928508352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:30:14.130534 139814928508352 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:30:14.143954 139814928508352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:30:14.155915 139814928508352 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:30:14.156213 139814928508352 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:30:14.585721 139814928508352 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:30:14.601269 139814928508352 estimator.py:1147] Done calling model_fn.
I0811 22:30:18.182154 139814928508352 tpu_estimator.py:499] TPU job name worker
I0811 22:30:18.298388 139814928508352 monitored_session.py:240] Graph was finalized.
I0811 22:30:18.868211 139814928508352 session_manager.py:500] Running local_init_op.
I0811 22:30:18.907164 139814928508352 session_manager.py:502] Done running local_init_op.
I0811 22:30:21.486228 139814928508352 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:30:34.615849 139814928508352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:30:34.734989 139814928508352 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:30:34.735460 139814928508352 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:30:34.735861: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:30:34.740799 139814928508352 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:30:34.742958 139814928508352 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:30:34.746366 139814928508352 tpu_estimator.py:557] Init TPU system
I0811 22:31:16.694545 139814928508352 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0811 22:31:16.695583 139814177588992 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:31:16.696418 139814169196288 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:31:16.740158 139814928508352 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:31:16.741091 139814928508352 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:31:16.756223 139814160803584 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:31:16.873508 139814160803584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:31:21.483761 139814169196288 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:31:26.117130 139814928508352 basic_session_run_hooks.py:262] loss = 0.23015617, step = 30
I0811 22:31:26.119519 139814928508352 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:31:39.620713 139814928508352 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:31:39.621031 139814928508352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:31:39.621365 139814177588992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:31:39.621758 139814177588992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:31:39.622075 139814928508352 error_handling.py:96] infeed marked as finished
I0811 22:31:39.622339 139814928508352 tpu_estimator.py:602] Stop output thread controller
I0811 22:31:39.622401 139814928508352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:31:39.622571 139814169196288 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:31:39.622773 139814169196288 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:31:39.622946 139814928508352 error_handling.py:96] outfeed marked as finished
I0811 22:31:39.623099 139814928508352 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:31:47.011859 139814928508352 estimator.py:368] Loss for final step: 0.23015617.
I0811 22:31:47.012701 139814928508352 error_handling.py:96] training_loop marked as finished
I0811 22:31:47.818325 139814928508352 estimator.py:1145] Calling model_fn.
E0811 22:31:48.510374 139814928508352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:31:48.703063 139814928508352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:31:48.730600 139814928508352 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:31:48.752027 139814928508352 estimator.py:1147] Done calling model_fn.
I0811 22:31:48.769679 139814928508352 evaluation.py:255] Starting evaluation at 2019-08-11T22:31:48Z
I0811 22:31:48.769906 139814928508352 tpu_estimator.py:499] TPU job name worker
I0811 22:31:48.846154 139814928508352 monitored_session.py:240] Graph was finalized.
W0811 22:31:48.846874 139814928508352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:31:49.040004 139814928508352 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:31:51.523664 139814928508352 session_manager.py:500] Running local_init_op.
I0811 22:31:51.548007 139814928508352 session_manager.py:502] Done running local_init_op.
I0811 22:31:51.595523 139814928508352 tpu_estimator.py:557] Init TPU system
I0811 22:33:00.654604 139814928508352 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 22:33:00.655472 139814173656832 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:33:00.655859 139814165264128 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:33:00.731374 139814928508352 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:33:00.757325 139814928508352 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:33:00.757747 139814928508352 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:33:00.793046 139814152148736 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:33:00.947381 139814152148736 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:33:01.508505 139814165264128 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:33:01.781920 139814928508352 evaluation.py:167] Evaluation [10/10]
I0811 22:33:01.782284 139814928508352 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:33:01.782363 139814928508352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:33:01.782541 139814173656832 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:33:01.782629 139814173656832 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:33:01.782761 139814928508352 error_handling.py:96] infeed marked as finished
I0811 22:33:01.782856 139814928508352 tpu_estimator.py:602] Stop output thread controller
I0811 22:33:01.782903 139814928508352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:33:01.783020 139814165264128 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:33:01.783090 139814165264128 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:33:01.783202 139814928508352 error_handling.py:96] outfeed marked as finished
I0811 22:33:01.783288 139814928508352 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:33:31.020528 139814928508352 evaluation.py:275] Finished evaluation at 2019-08-11-22:33:31
I0811 22:33:31.020879 139814928508352 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9416, global_step = 30, loss = 0.23044164
I0811 22:33:36.368294 139814928508352 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:33:37.274907 139814928508352 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.23044164, 'global_step': 30, 'accuracy': 0.9416}

Removing gs://yangyou-mnist/log/#1565562616110143...
Removing gs://yangyou-mnist/log/checkpoint#1565562696070347...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565562629183558...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565562620915881...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565562633561477...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565562692943550...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565562616.v3-8-tpu#1565562699282275...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565562628312980...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565562693760789...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565562698357053...
Removing gs://yangyou-mnist/log/eval/#1565562813629159...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565562813.v3-8-tpu#1565562816932825...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:33:40.994679 140384263898560 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:33:40.995467 140384263898560 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:33:40.998060 140384263898560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:33:40.998827 140384263898560 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:33:40.999385 140384263898560 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:33:40.999511 140384263898560 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:33:41.415771 140384263898560 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:33:41.422281 140384263898560 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:33:41.425928 140384263898560 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:33:41.466573 140384263898560 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:33:41.466847 140384263898560 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:33:41.806431 140384263898560 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:33:41.855884 140384263898560 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:33:41.856161 140384263898560 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:33:42.056150 140384263898560 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fad9c57e090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fad9e75c190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:33:42.056526 140384263898560 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:33:42.386498 140384263898560 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:33:42.389516: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:33:42.402348 140384263898560 tpu_system_metadata.py:148] Found TPU system:
I0811 22:33:42.402611 140384263898560 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:33:42.403120 140384263898560 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:33:42.403177 140384263898560 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:33:42.403233 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:33:42.403605 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:33:42.403671 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:33:42.403732 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:33:42.403786 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:33:42.403856 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:33:42.403911 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:33:42.403959 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:33:42.404006 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:33:42.404063 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:33:42.404114 140384263898560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:33:42.410490 140384263898560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:33:42.423223 140384263898560 estimator.py:1145] Calling model_fn.
W0811 22:33:42.423861 140384263898560 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:33:42.696974 140384263898560 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:33:43.104588 140384263898560 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:33:43.165719 140384263898560 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:33:43.171472 140384263898560 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:33:43.361747 140384263898560 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:33:43.375190 140384263898560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:33:43.386955 140384263898560 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:33:43.387268 140384263898560 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:33:43.804610 140384263898560 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:33:43.820441 140384263898560 estimator.py:1147] Done calling model_fn.
I0811 22:33:47.304574 140384263898560 tpu_estimator.py:499] TPU job name worker
I0811 22:33:47.420314 140384263898560 monitored_session.py:240] Graph was finalized.
I0811 22:33:47.980761 140384263898560 session_manager.py:500] Running local_init_op.
I0811 22:33:48.019861 140384263898560 session_manager.py:502] Done running local_init_op.
I0811 22:33:50.763217 140384263898560 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:34:03.089925 140384263898560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:34:03.213232 140384263898560 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:34:03.213751 140384263898560 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:34:03.214202: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:34:03.219763 140384263898560 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:34:03.221995 140384263898560 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:34:03.226470 140384263898560 tpu_estimator.py:557] Init TPU system
I0811 22:34:44.699064 140384263898560 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0811 22:34:44.700076 140383571748608 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:34:44.700930 140383086442240 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:34:44.744316 140384263898560 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:34:44.746135 140384263898560 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:34:44.755275 140383078049536 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:34:44.886646 140383078049536 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:34:49.343200 140383086442240 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:34:53.916439 140384263898560 basic_session_run_hooks.py:262] loss = 0.21917716, step = 30
I0811 22:34:53.918977 140384263898560 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:35:07.391660 140384263898560 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:35:07.391973 140384263898560 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:35:07.392183 140383571748608 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:35:07.392287 140383571748608 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:35:07.392421 140384263898560 error_handling.py:96] infeed marked as finished
I0811 22:35:07.392517 140384263898560 tpu_estimator.py:602] Stop output thread controller
I0811 22:35:07.392565 140384263898560 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:35:07.392680 140383086442240 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:35:07.392762 140383086442240 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:35:07.392869 140384263898560 error_handling.py:96] outfeed marked as finished
I0811 22:35:07.392946 140384263898560 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:35:15.020301 140384263898560 estimator.py:368] Loss for final step: 0.21917716.
I0811 22:35:15.021157 140384263898560 error_handling.py:96] training_loop marked as finished
I0811 22:35:15.822109 140384263898560 estimator.py:1145] Calling model_fn.
E0811 22:35:16.515743 140384263898560 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:35:16.705255 140384263898560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:35:16.732136 140384263898560 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:35:16.753060 140384263898560 estimator.py:1147] Done calling model_fn.
I0811 22:35:16.769885 140384263898560 evaluation.py:255] Starting evaluation at 2019-08-11T22:35:16Z
I0811 22:35:16.770121 140384263898560 tpu_estimator.py:499] TPU job name worker
I0811 22:35:16.844625 140384263898560 monitored_session.py:240] Graph was finalized.
W0811 22:35:16.845334 140384263898560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:35:17.033998 140384263898560 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:35:19.707237 140384263898560 session_manager.py:500] Running local_init_op.
I0811 22:35:19.741259 140384263898560 session_manager.py:502] Done running local_init_op.
I0811 22:35:19.789733 140384263898560 tpu_estimator.py:557] Init TPU system
I0811 22:36:28.683403 140384263898560 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:36:28.684331 140383086442240 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:36:28.684779 140383078049536 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:36:28.753855 140384263898560 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:36:28.781213 140384263898560 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:36:28.781567 140384263898560 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:36:28.810668 140383069656832 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:36:28.913000 140383069656832 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:36:29.533112 140383078049536 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:36:29.800674 140384263898560 evaluation.py:167] Evaluation [10/10]
I0811 22:36:29.801001 140384263898560 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:36:29.801085 140384263898560 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:36:29.801258 140383086442240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:36:29.801348 140383086442240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:36:29.801496 140384263898560 error_handling.py:96] infeed marked as finished
I0811 22:36:29.801615 140384263898560 tpu_estimator.py:602] Stop output thread controller
I0811 22:36:29.801686 140384263898560 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:36:29.801796 140383078049536 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:36:29.801873 140383078049536 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:36:29.801985 140384263898560 error_handling.py:96] outfeed marked as finished
I0811 22:36:29.802064 140384263898560 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:36:59.010997 140384263898560 evaluation.py:275] Finished evaluation at 2019-08-11-22:36:59
I0811 22:36:59.011414 140384263898560 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9445, global_step = 30, loss = 0.20801607
I0811 22:37:03.316972 140384263898560 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:37:04.158555 140384263898560 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.20801607, 'global_step': 30, 'accuracy': 0.9445}

Removing gs://yangyou-mnist/log/#1565562825310229...
Removing gs://yangyou-mnist/log/checkpoint#1565562903909407...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565562825.v3-8-tpu#1565562907052278...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565562842572240...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565562838354056...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565562900579896...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565562830191586...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565562901507125...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565562837330939...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565562906154778...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565563020652696...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565563020.v3-8-tpu#1565563023816362...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:37:07.943804 140588900869568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:37:07.944605 140588900869568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:37:07.947271 140588900869568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:37:07.948093 140588900869568 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:37:07.948693 140588900869568 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:37:07.948846 140588900869568 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:37:08.345069 140588900869568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:37:08.352143 140588900869568 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:37:08.355947 140588900869568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:37:08.406825 140588900869568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:37:08.407130 140588900869568 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:37:08.533376 140588900869568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:37:08.581046 140588900869568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:37:08.581352 140588900869568 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:37:08.661393 140588900869568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fdd41a6d290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fdd43c62190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:37:08.661819 140588900869568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:37:08.992734 140588900869568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:37:08.995781: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:37:09.009907 140588900869568 tpu_system_metadata.py:148] Found TPU system:
I0811 22:37:09.010190 140588900869568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:37:09.010755 140588900869568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:37:09.010813 140588900869568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:37:09.010865 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:37:09.011167 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:37:09.011239 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:37:09.011310 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:37:09.011363 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:37:09.011419 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:37:09.011476 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:37:09.011533 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:37:09.011588 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:37:09.011643 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:37:09.011698 140588900869568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:37:09.017887 140588900869568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:37:09.030199 140588900869568 estimator.py:1145] Calling model_fn.
W0811 22:37:09.030813 140588900869568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:37:09.324641 140588900869568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:37:09.746494 140588900869568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:37:09.806308 140588900869568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:37:09.812127 140588900869568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:37:09.987746 140588900869568 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:37:10.001146 140588900869568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:37:10.012823 140588900869568 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:37:10.013137 140588900869568 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:37:10.432055 140588900869568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:37:10.449666 140588900869568 estimator.py:1147] Done calling model_fn.
I0811 22:37:13.862467 140588900869568 tpu_estimator.py:499] TPU job name worker
I0811 22:37:13.971498 140588900869568 monitored_session.py:240] Graph was finalized.
I0811 22:37:14.532402 140588900869568 session_manager.py:500] Running local_init_op.
I0811 22:37:14.570173 140588900869568 session_manager.py:502] Done running local_init_op.
I0811 22:37:17.240984 140588900869568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:37:30.428112 140588900869568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:37:30.539892 140588900869568 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:37:30.540368 140588900869568 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:37:30.540769: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:37:30.545567 140588900869568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:37:30.547722 140588900869568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:37:30.552244 140588900869568 tpu_estimator.py:557] Init TPU system
I0811 22:38:12.700643 140588900869568 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 22:38:12.701662 140588007278336 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:38:12.702069 140587998885632 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:38:12.744734 140588900869568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:38:12.745645 140588900869568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:38:12.759696 140587990492928 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:38:12.862957 140587990492928 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 22:38:17.184716 140587998885632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:38:21.660151 140588900869568 basic_session_run_hooks.py:262] loss = 0.22524597, step = 30
I0811 22:38:21.662909 140588900869568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:38:36.240875 140588900869568 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:38:36.241169 140588900869568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:38:36.241374 140588007278336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:38:36.241485 140588007278336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:38:36.241663 140588900869568 error_handling.py:96] infeed marked as finished
I0811 22:38:36.241774 140588900869568 tpu_estimator.py:602] Stop output thread controller
I0811 22:38:36.241828 140588900869568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:38:36.241949 140587998885632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:38:36.242021 140587998885632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:38:36.242136 140588900869568 error_handling.py:96] outfeed marked as finished
I0811 22:38:36.242221 140588900869568 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:38:42.999439 140588900869568 estimator.py:368] Loss for final step: 0.22524597.
I0811 22:38:43.000185 140588900869568 error_handling.py:96] training_loop marked as finished
I0811 22:38:43.692994 140588900869568 estimator.py:1145] Calling model_fn.
E0811 22:38:44.393743 140588900869568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:38:44.584733 140588900869568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:38:44.611713 140588900869568 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:38:44.632742 140588900869568 estimator.py:1147] Done calling model_fn.
I0811 22:38:44.649439 140588900869568 evaluation.py:255] Starting evaluation at 2019-08-11T22:38:44Z
I0811 22:38:44.649705 140588900869568 tpu_estimator.py:499] TPU job name worker
I0811 22:38:44.723104 140588900869568 monitored_session.py:240] Graph was finalized.
W0811 22:38:44.723846 140588900869568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:38:44.907584 140588900869568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:38:47.554399 140588900869568 session_manager.py:500] Running local_init_op.
I0811 22:38:47.578774 140588900869568 session_manager.py:502] Done running local_init_op.
I0811 22:38:47.630924 140588900869568 tpu_estimator.py:557] Init TPU system
I0811 22:39:56.650569 140588900869568 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 22:39:56.651527 140588003346176 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:39:56.652013 140587994953472 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:39:56.731533 140588900869568 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:39:56.759686 140588900869568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:39:56.760070 140588900869568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:39:56.790242 140587981838080 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:39:56.896488 140587981838080 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:39:57.520109 140587994953472 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:39:57.805027 140588900869568 evaluation.py:167] Evaluation [10/10]
I0811 22:39:57.805439 140588900869568 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:39:57.805516 140588900869568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:39:57.805758 140588003346176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:39:57.805876 140588003346176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:39:57.806022 140588900869568 error_handling.py:96] infeed marked as finished
I0811 22:39:57.806123 140588900869568 tpu_estimator.py:602] Stop output thread controller
I0811 22:39:57.806173 140588900869568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:39:57.806293 140587994953472 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:39:57.806365 140587994953472 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:39:57.806478 140588900869568 error_handling.py:96] outfeed marked as finished
I0811 22:39:57.806555 140588900869568 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:40:26.991560 140588900869568 evaluation.py:275] Finished evaluation at 2019-08-11-22:40:26
I0811 22:40:26.991961 140588900869568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9428, global_step = 30, loss = 0.21690948
I0811 22:40:31.939376 140588900869568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:40:32.691256 140588900869568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.21690948, 'global_step': 30, 'accuracy': 0.9428}

Removing gs://yangyou-mnist/log/checkpoint#1565563111259316...
Removing gs://yangyou-mnist/log/#1565563031955501...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565563032.v3-8-tpu#1565563115904985...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565563045565875...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565563049921930...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565563036672912...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565563108275388...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565563044570068...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565563109148584...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565563114974414...
Removing gs://yangyou-mnist/log/eval/#1565563228593134...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565563228.v3-8-tpu#1565563232372838...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:40:36.252363 139888525370816 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:40:36.253143 139888525370816 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:40:36.255695 139888525370816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:40:36.256520 139888525370816 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:40:36.257097 139888525370816 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:40:36.257221 139888525370816 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:40:36.678423 139888525370816 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:40:36.685075 139888525370816 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:40:36.689399 139888525370816 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:40:36.742801 139888525370816 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:40:36.743104 139888525370816 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:40:36.975950 139888525370816 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:40:37.022566 139888525370816 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:40:37.022836 139888525370816 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:40:37.204823 139888525370816 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3a30064210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3a32242190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:40:37.205173 139888525370816 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:40:37.510304 139888525370816 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:40:37.513122: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:40:37.525847 139888525370816 tpu_system_metadata.py:148] Found TPU system:
I0811 22:40:37.526110 139888525370816 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:40:37.526629 139888525370816 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:40:37.526686 139888525370816 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:40:37.526758 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:40:37.527046 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:40:37.527103 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:40:37.527153 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:40:37.527209 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:40:37.527256 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:40:37.527303 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:40:37.527349 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:40:37.527395 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:40:37.527441 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:40:37.527488 139888525370816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:40:37.533395 139888525370816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:40:37.545371 139888525370816 estimator.py:1145] Calling model_fn.
W0811 22:40:37.545972 139888525370816 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:40:37.843688 139888525370816 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:40:38.289810 139888525370816 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:40:38.352478 139888525370816 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:40:38.358447 139888525370816 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:40:38.539815 139888525370816 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:40:38.553060 139888525370816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:40:38.564840 139888525370816 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:40:38.565136 139888525370816 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:40:38.979439 139888525370816 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:40:38.994632 139888525370816 estimator.py:1147] Done calling model_fn.
I0811 22:40:42.352236 139888525370816 tpu_estimator.py:499] TPU job name worker
I0811 22:40:42.467879 139888525370816 monitored_session.py:240] Graph was finalized.
I0811 22:40:43.014080 139888525370816 session_manager.py:500] Running local_init_op.
I0811 22:40:43.046024 139888525370816 session_manager.py:502] Done running local_init_op.
I0811 22:40:45.402417 139888525370816 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:40:56.947417 139888525370816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:40:57.061028 139888525370816 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:40:57.061553 139888525370816 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:40:57.061986: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:40:57.067961 139888525370816 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:40:57.070161 139888525370816 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:40:57.073857 139888525370816 tpu_estimator.py:557] Init TPU system
I0811 22:41:40.662188 139888525370816 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 22:41:40.663193 139887833220864 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:41:40.664110 139887353263872 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:41:40.707014 139888525370816 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:41:40.708231 139888525370816 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:41:40.718678 139887344871168 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:41:40.856688 139887344871168 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:41:45.055474 139887353263872 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:41:49.485635 139888525370816 basic_session_run_hooks.py:262] loss = 0.095516816, step = 30
I0811 22:41:49.487515 139888525370816 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:42:02.391563 139888525370816 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:42:02.391858 139888525370816 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:42:02.392055 139887833220864 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:42:02.392189 139887833220864 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:42:02.392333 139888525370816 error_handling.py:96] infeed marked as finished
I0811 22:42:02.392441 139888525370816 tpu_estimator.py:602] Stop output thread controller
I0811 22:42:02.392491 139888525370816 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:42:02.392608 139887353263872 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:42:02.392688 139887353263872 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:42:02.392802 139888525370816 error_handling.py:96] outfeed marked as finished
I0811 22:42:02.392888 139888525370816 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:42:10.991111 139888525370816 estimator.py:368] Loss for final step: 0.095516816.
I0811 22:42:10.992012 139888525370816 error_handling.py:96] training_loop marked as finished
I0811 22:42:11.711406 139888525370816 estimator.py:1145] Calling model_fn.
E0811 22:42:12.416944 139888525370816 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:42:12.617918 139888525370816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:42:12.645956 139888525370816 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:42:12.667012 139888525370816 estimator.py:1147] Done calling model_fn.
I0811 22:42:12.684222 139888525370816 evaluation.py:255] Starting evaluation at 2019-08-11T22:42:12Z
I0811 22:42:12.684458 139888525370816 tpu_estimator.py:499] TPU job name worker
I0811 22:42:12.758470 139888525370816 monitored_session.py:240] Graph was finalized.
W0811 22:42:12.759243 139888525370816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:42:12.947953 139888525370816 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:42:15.537998 139888525370816 session_manager.py:500] Running local_init_op.
I0811 22:42:15.562288 139888525370816 session_manager.py:502] Done running local_init_op.
I0811 22:42:15.611160 139888525370816 tpu_estimator.py:557] Init TPU system
I0811 22:43:24.619242 139888525370816 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 22:43:24.620199 139887353263872 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:43:24.620964 139887344871168 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:43:24.686309 139888525370816 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:43:24.721472 139888525370816 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:43:24.721856 139888525370816 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:43:24.742706 139887336478464 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:43:25.007309 139887336478464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:43:25.483273 139887344871168 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:43:25.798623 139888525370816 evaluation.py:167] Evaluation [10/10]
I0811 22:43:25.798944 139888525370816 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:43:25.799078 139888525370816 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:43:25.799366 139887353263872 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:43:25.799685 139887353263872 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:43:25.799871 139888525370816 error_handling.py:96] infeed marked as finished
I0811 22:43:25.800110 139888525370816 tpu_estimator.py:602] Stop output thread controller
I0811 22:43:25.800277 139888525370816 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:43:25.800590 139887344871168 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:43:25.800776 139887344871168 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:43:25.800955 139888525370816 error_handling.py:96] outfeed marked as finished
I0811 22:43:25.801100 139888525370816 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:43:55.104059 139888525370816 evaluation.py:275] Finished evaluation at 2019-08-11-22:43:55
I0811 22:43:55.104429 139888525370816 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9733, global_step = 30, loss = 0.09750111
I0811 22:43:59.489322 139888525370816 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:44:00.348022 139888525370816 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09750111, 'global_step': 30, 'accuracy': 0.9733}

Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565563256486270...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565563252482271...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565563315828716...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565563316689085...
Removing gs://yangyou-mnist/log/#1565563240455219...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565563240.v3-8-tpu#1565563322061268...
Removing gs://yangyou-mnist/log/checkpoint#1565563318921348...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565563244886299...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565563251640634...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565563321163203...
Removing gs://yangyou-mnist/log/eval/#1565563436845212...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565563437.v3-8-tpu#1565563440008615...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:44:04.105062 140521010881984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:44:04.105834 140521010881984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:44:04.108359 140521010881984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:44:04.109168 140521010881984 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:44:04.109905 140521010881984 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:44:04.110039 140521010881984 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:44:04.526520 140521010881984 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:44:04.533224 140521010881984 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:44:04.536978 140521010881984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:44:04.589531 140521010881984 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:44:04.589867 140521010881984 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:44:04.690608 140521010881984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:44:04.738898 140521010881984 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:44:04.739180 140521010881984 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:44:04.834934 140521010881984 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcd73194210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcd75372190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:44:04.835282 140521010881984 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:44:05.173934 140521010881984 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:44:05.176730: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:44:05.190040 140521010881984 tpu_system_metadata.py:148] Found TPU system:
I0811 22:44:05.190340 140521010881984 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:44:05.190838 140521010881984 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:44:05.190896 140521010881984 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:44:05.190968 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:44:05.191279 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:44:05.191338 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:44:05.191389 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:44:05.191437 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:44:05.191484 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:44:05.191530 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:44:05.191580 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:44:05.191626 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:44:05.191672 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:44:05.191720 140521010881984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:44:05.197621 140521010881984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:44:05.210041 140521010881984 estimator.py:1145] Calling model_fn.
W0811 22:44:05.210659 140521010881984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:44:05.515609 140521010881984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:44:05.943046 140521010881984 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:44:06.004514 140521010881984 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:44:06.010461 140521010881984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:44:06.191910 140521010881984 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:44:06.205813 140521010881984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:44:06.218090 140521010881984 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:44:06.218403 140521010881984 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:44:06.652338 140521010881984 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:44:06.667646 140521010881984 estimator.py:1147] Done calling model_fn.
I0811 22:44:10.113723 140521010881984 tpu_estimator.py:499] TPU job name worker
I0811 22:44:10.227077 140521010881984 monitored_session.py:240] Graph was finalized.
I0811 22:44:10.786915 140521010881984 session_manager.py:500] Running local_init_op.
I0811 22:44:10.825551 140521010881984 session_manager.py:502] Done running local_init_op.
I0811 22:44:13.379661 140521010881984 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:44:25.465239 140521010881984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:44:25.580373 140521010881984 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:44:25.580881 140521010881984 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:44:25.581263: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:44:25.585988 140521010881984 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:44:25.588179 140521010881984 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:44:25.592319 140521010881984 tpu_estimator.py:557] Init TPU system
I0811 22:45:08.699865 140521010881984 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 22:45:08.700789 140519980132096 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:45:08.701276 140519971739392 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:45:08.744491 140521010881984 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:45:08.745421 140521010881984 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:45:08.758733 140519963346688 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:45:08.976665 140519963346688 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 22:45:13.358149 140519971739392 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:45:17.974091 140521010881984 basic_session_run_hooks.py:262] loss = 0.107657015, step = 30
I0811 22:45:17.976524 140521010881984 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:45:31.430457 140521010881984 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:45:31.430759 140521010881984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:45:31.431088 140519980132096 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:45:31.431394 140519980132096 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:45:31.431615 140521010881984 error_handling.py:96] infeed marked as finished
I0811 22:45:31.431833 140521010881984 tpu_estimator.py:602] Stop output thread controller
I0811 22:45:31.431924 140521010881984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:45:31.432092 140519971739392 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:45:31.432243 140519971739392 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:45:31.432436 140521010881984 error_handling.py:96] outfeed marked as finished
I0811 22:45:31.432614 140521010881984 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:45:39.116317 140521010881984 estimator.py:368] Loss for final step: 0.107657015.
I0811 22:45:39.117183 140521010881984 error_handling.py:96] training_loop marked as finished
I0811 22:45:39.940577 140521010881984 estimator.py:1145] Calling model_fn.
E0811 22:45:40.632977 140521010881984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:45:40.825283 140521010881984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:45:40.852387 140521010881984 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:45:40.884922 140521010881984 estimator.py:1147] Done calling model_fn.
I0811 22:45:40.902369 140521010881984 evaluation.py:255] Starting evaluation at 2019-08-11T22:45:40Z
I0811 22:45:40.902606 140521010881984 tpu_estimator.py:499] TPU job name worker
I0811 22:45:40.976963 140521010881984 monitored_session.py:240] Graph was finalized.
W0811 22:45:40.977710 140521010881984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:45:41.177719 140521010881984 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:45:44.119908 140521010881984 session_manager.py:500] Running local_init_op.
I0811 22:45:44.143439 140521010881984 session_manager.py:502] Done running local_init_op.
I0811 22:45:44.197566 140521010881984 tpu_estimator.py:557] Init TPU system
I0811 22:46:52.663161 140521010881984 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:46:52.664136 140519978821376 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:46:52.664860 140519970428672 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:46:52.731486 140521010881984 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:46:52.755568 140521010881984 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:46:52.755903 140521010881984 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:46:52.834515 140519962035968 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:46:52.983108 140519962035968 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:46:53.499486 140519970428672 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:46:53.855432 140521010881984 evaluation.py:167] Evaluation [10/10]
I0811 22:46:53.855778 140521010881984 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:46:53.855860 140521010881984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:46:53.856110 140519978821376 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:46:53.856395 140519978821376 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:46:53.856621 140521010881984 error_handling.py:96] infeed marked as finished
I0811 22:46:53.856825 140521010881984 tpu_estimator.py:602] Stop output thread controller
I0811 22:46:53.856910 140521010881984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:46:53.857110 140519970428672 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:46:53.857256 140519970428672 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:46:53.857456 140521010881984 error_handling.py:96] outfeed marked as finished
I0811 22:46:53.857680 140521010881984 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:47:23.057282 140521010881984 evaluation.py:275] Finished evaluation at 2019-08-11-22:47:23
I0811 22:47:23.057682 140521010881984 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9723, global_step = 30, loss = 0.09998939
I0811 22:47:27.501060 140521010881984 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:47:28.335046 140521010881984 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09998939, 'global_step': 30, 'accuracy': 0.9723}

Removing gs://yangyou-mnist/log/#1565563448296523...
Removing gs://yangyou-mnist/log/checkpoint#1565563527974862...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565563448.v3-8-tpu#1565563531098205...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565563460567603...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565563452830633...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565563524684236...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565563464954028...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565563525634588...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565563459680189...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565563530152604...
Removing gs://yangyou-mnist/log/eval/#1565563644788194...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565563644.v3-8-tpu#1565563648007545...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:47:32.076426 140303270233536 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:47:32.077203 140303270233536 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:47:32.079761 140303270233536 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:47:32.080569 140303270233536 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:47:32.081171 140303270233536 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:47:32.081319 140303270233536 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:47:32.502298 140303270233536 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:47:32.509156 140303270233536 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:47:32.513125 140303270233536 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:47:32.563716 140303270233536 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:47:32.564022 140303270233536 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:47:32.665110 140303270233536 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:47:32.716481 140303270233536 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:47:32.716768 140303270233536 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:47:32.964401 140303270233536 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f9ac0bea110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f9ac2dc8190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:47:32.964746 140303270233536 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:47:33.321980 140303270233536 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:47:33.325007: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:47:33.337362 140303270233536 tpu_system_metadata.py:148] Found TPU system:
I0811 22:47:33.337663 140303270233536 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:47:33.339725 140303270233536 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:47:33.339869 140303270233536 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:47:33.339930 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:47:33.340501 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:47:33.340574 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:47:33.340627 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:47:33.340676 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:47:33.340727 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:47:33.340773 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:47:33.340818 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:47:33.340864 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:47:33.340909 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:47:33.340956 140303270233536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:47:33.347054 140303270233536 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:47:33.359575 140303270233536 estimator.py:1145] Calling model_fn.
W0811 22:47:33.360215 140303270233536 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:47:33.628528 140303270233536 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:47:34.033160 140303270233536 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:47:34.095077 140303270233536 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:47:34.100805 140303270233536 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:47:34.275408 140303270233536 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:47:34.288717 140303270233536 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:47:34.300481 140303270233536 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:47:34.300792 140303270233536 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:47:34.724309 140303270233536 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:47:34.739582 140303270233536 estimator.py:1147] Done calling model_fn.
I0811 22:47:38.075427 140303270233536 tpu_estimator.py:499] TPU job name worker
I0811 22:47:38.186628 140303270233536 monitored_session.py:240] Graph was finalized.
I0811 22:47:38.775722 140303270233536 session_manager.py:500] Running local_init_op.
I0811 22:47:38.808123 140303270233536 session_manager.py:502] Done running local_init_op.
I0811 22:47:41.417280 140303270233536 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:47:54.329822 140303270233536 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:47:54.438070 140303270233536 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:47:54.438749 140303270233536 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:47:54.439209: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:47:54.444209 140303270233536 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:47:54.446330 140303270233536 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:47:54.450367 140303270233536 tpu_estimator.py:557] Init TPU system
I0811 22:48:36.684165 140303270233536 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 22:48:36.685560 140302510958336 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:48:36.685998 140302502565632 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:48:36.730380 140303270233536 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:48:36.731237 140303270233536 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:48:36.741820 140302018934528 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:48:36.881055 140302018934528 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 22:48:41.103564 140302502565632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:48:45.459887 140303270233536 basic_session_run_hooks.py:262] loss = 0.09285117, step = 30
I0811 22:48:45.462135 140303270233536 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:48:58.960702 140303270233536 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:48:58.961024 140303270233536 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:48:58.961302 140302510958336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:48:58.961579 140302510958336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:48:58.961874 140303270233536 error_handling.py:96] infeed marked as finished
I0811 22:48:58.962076 140303270233536 tpu_estimator.py:602] Stop output thread controller
I0811 22:48:58.962138 140303270233536 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:48:58.962326 140302502565632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:48:58.962495 140302502565632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:48:58.962690 140303270233536 error_handling.py:96] outfeed marked as finished
I0811 22:48:58.962901 140303270233536 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:49:07.018140 140303270233536 estimator.py:368] Loss for final step: 0.09285117.
I0811 22:49:07.018937 140303270233536 error_handling.py:96] training_loop marked as finished
I0811 22:49:07.815360 140303270233536 estimator.py:1145] Calling model_fn.
E0811 22:49:08.509819 140303270233536 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:49:08.705315 140303270233536 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:49:08.732616 140303270233536 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:49:08.753930 140303270233536 estimator.py:1147] Done calling model_fn.
I0811 22:49:08.773344 140303270233536 evaluation.py:255] Starting evaluation at 2019-08-11T22:49:08Z
I0811 22:49:08.773638 140303270233536 tpu_estimator.py:499] TPU job name worker
I0811 22:49:08.850006 140303270233536 monitored_session.py:240] Graph was finalized.
W0811 22:49:08.850734 140303270233536 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:49:09.037229 140303270233536 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:49:11.777400 140303270233536 session_manager.py:500] Running local_init_op.
I0811 22:49:11.805890 140303270233536 session_manager.py:502] Done running local_init_op.
I0811 22:49:11.860078 140303270233536 tpu_estimator.py:557] Init TPU system
I0811 22:50:20.610852 140303270233536 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:50:20.611846 140302507026176 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:50:20.612453 140302018934528 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:50:20.678824 140303270233536 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:50:20.710696 140303270233536 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:50:20.711076 140303270233536 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:50:20.739475 140302010541824 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:50:20.959810 140302010541824 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:50:21.458830 140302018934528 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:50:21.840317 140303270233536 evaluation.py:167] Evaluation [10/10]
I0811 22:50:21.840691 140303270233536 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:50:21.840763 140303270233536 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:50:21.840962 140302507026176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:50:21.841084 140302507026176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:50:21.841223 140303270233536 error_handling.py:96] infeed marked as finished
I0811 22:50:21.841316 140303270233536 tpu_estimator.py:602] Stop output thread controller
I0811 22:50:21.841373 140303270233536 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:50:21.841486 140302018934528 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:50:21.841562 140302018934528 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:50:21.841738 140303270233536 error_handling.py:96] outfeed marked as finished
I0811 22:50:21.841824 140303270233536 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:50:51.051402 140303270233536 evaluation.py:275] Finished evaluation at 2019-08-11-22:50:51
I0811 22:50:51.051726 140303270233536 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9771, global_step = 30, loss = 0.070205525
I0811 22:50:55.321147 140303270233536 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:50:56.155013 140303270233536 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.070205525, 'global_step': 30, 'accuracy': 0.9771}

Removing gs://yangyou-mnist/log/#1565563656170618...
Removing gs://yangyou-mnist/log/checkpoint#1565563735544116...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565563656.v3-8-tpu#1565563738633190...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565563669286933...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565563660850524...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565563673824631...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565563732324757...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565563733253120...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565563668358102...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565563737664273...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565563852.v3-8-tpu#1565563855827672...
Removing gs://yangyou-mnist/log/eval/#1565563852778289...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:51:01.185045 140524843763136 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:51:01.185861 140524843763136 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:51:01.188400 140524843763136 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:51:01.189192 140524843763136 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:51:01.190156 140524843763136 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:51:01.190294 140524843763136 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:51:01.583065 140524843763136 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:51:01.590029 140524843763136 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:51:01.593978 140524843763136 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:51:01.642132 140524843763136 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:51:01.642417 140524843763136 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:51:01.796880 140524843763136 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:51:01.845258 140524843763136 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:51:01.845556 140524843763136 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:51:02.042839 140524843763136 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fce578e6150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fce59ac4190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:51:02.043205 140524843763136 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:51:02.362546 140524843763136 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:51:02.365630: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:51:02.378928 140524843763136 tpu_system_metadata.py:148] Found TPU system:
I0811 22:51:02.379170 140524843763136 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:51:02.379702 140524843763136 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:51:02.379770 140524843763136 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:51:02.379823 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:51:02.380116 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:51:02.380172 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:51:02.380239 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:51:02.380295 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:51:02.380343 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:51:02.380389 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:51:02.380435 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:51:02.380481 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:51:02.380527 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:51:02.380573 140524843763136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:51:02.386926 140524843763136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:51:02.399887 140524843763136 estimator.py:1145] Calling model_fn.
W0811 22:51:02.400568 140524843763136 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:51:02.672905 140524843763136 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:51:03.097731 140524843763136 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:51:03.160285 140524843763136 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:51:03.166498 140524843763136 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:51:03.351710 140524843763136 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:51:03.365788 140524843763136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:51:03.378314 140524843763136 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:51:03.378638 140524843763136 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:51:03.807244 140524843763136 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:51:03.822966 140524843763136 estimator.py:1147] Done calling model_fn.
I0811 22:51:07.265949 140524843763136 tpu_estimator.py:499] TPU job name worker
I0811 22:51:07.384115 140524843763136 monitored_session.py:240] Graph was finalized.
I0811 22:51:07.953273 140524843763136 session_manager.py:500] Running local_init_op.
I0811 22:51:07.983563 140524843763136 session_manager.py:502] Done running local_init_op.
I0811 22:51:10.362598 140524843763136 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:51:22.549685 140524843763136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:51:22.655742 140524843763136 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:51:22.656214 140524843763136 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:51:22.656650: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:51:22.662076 140524843763136 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:51:22.664329 140524843763136 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:51:22.668622 140524843763136 tpu_estimator.py:557] Init TPU system
I0811 22:52:04.661806 140524843763136 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0811 22:52:04.662849 140523813730048 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:52:04.663408 140523805337344 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:52:04.710095 140524843763136 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:52:04.711003 140524843763136 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:52:04.721652 140523796944640 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:52:04.838460 140523796944640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:52:09.467246 140523805337344 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:52:13.906042 140524843763136 basic_session_run_hooks.py:262] loss = 0.114899576, step = 30
I0811 22:52:13.908574 140524843763136 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:52:27.618846 140524843763136 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:52:27.619132 140524843763136 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:52:27.619472 140523813730048 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:52:27.619792 140523813730048 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:52:27.620004 140524843763136 error_handling.py:96] infeed marked as finished
I0811 22:52:27.620234 140524843763136 tpu_estimator.py:602] Stop output thread controller
I0811 22:52:27.620305 140524843763136 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:52:27.620542 140523805337344 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:52:27.620918 140523805337344 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:52:27.621246 140524843763136 error_handling.py:96] outfeed marked as finished
I0811 22:52:27.621426 140524843763136 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:52:35.307686 140524843763136 estimator.py:368] Loss for final step: 0.114899576.
I0811 22:52:35.308522 140524843763136 error_handling.py:96] training_loop marked as finished
I0811 22:52:36.149817 140524843763136 estimator.py:1145] Calling model_fn.
E0811 22:52:36.840728 140524843763136 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:52:37.033468 140524843763136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:52:37.062011 140524843763136 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:52:37.083376 140524843763136 estimator.py:1147] Done calling model_fn.
I0811 22:52:37.101695 140524843763136 evaluation.py:255] Starting evaluation at 2019-08-11T22:52:37Z
I0811 22:52:37.101939 140524843763136 tpu_estimator.py:499] TPU job name worker
I0811 22:52:37.177515 140524843763136 monitored_session.py:240] Graph was finalized.
W0811 22:52:37.178252 140524843763136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:52:37.366614 140524843763136 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:52:39.639086 140524843763136 session_manager.py:500] Running local_init_op.
I0811 22:52:39.663474 140524843763136 session_manager.py:502] Done running local_init_op.
I0811 22:52:39.717519 140524843763136 tpu_estimator.py:557] Init TPU system
I0811 22:53:48.671642 140524843763136 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:53:48.672667 140523811632896 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:53:48.673397 140523803240192 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:53:48.744015 140524843763136 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:53:48.768301 140524843763136 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:53:48.768640 140524843763136 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:53:48.844966 140523794847488 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:53:48.965733 140523794847488 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:53:49.500180 140523803240192 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:53:49.961041 140524843763136 evaluation.py:167] Evaluation [10/10]
I0811 22:53:49.961388 140524843763136 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:53:49.961467 140524843763136 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:53:49.961731 140523811632896 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:53:49.962016 140523811632896 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:53:49.962197 140524843763136 error_handling.py:96] infeed marked as finished
I0811 22:53:49.962369 140524843763136 tpu_estimator.py:602] Stop output thread controller
I0811 22:53:49.962429 140524843763136 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:53:49.962584 140523803240192 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:53:49.962735 140523803240192 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:53:49.962884 140524843763136 error_handling.py:96] outfeed marked as finished
I0811 22:53:49.963007 140524843763136 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:54:19.059663 140524843763136 evaluation.py:275] Finished evaluation at 2019-08-11-22:54:19
I0811 22:54:19.060009 140524843763136 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9693, global_step = 30, loss = 0.093735084
I0811 22:54:23.346319 140524843763136 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:54:24.285934 140524843763136 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.093735084, 'global_step': 30, 'accuracy': 0.9693}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565563877485130...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565563882047640...
Removing gs://yangyou-mnist/log/#1565563865322032...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565563940570810...
Removing gs://yangyou-mnist/log/checkpoint#1565563943738382...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565563869809836...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565563865.v3-8-tpu#1565563947288767...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565563876647731...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565563941471760...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565563946097204...
Removing gs://yangyou-mnist/log/eval/#1565564060733436...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565564060.v3-8-tpu#1565564063955825...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:54:27.987873 140637641971136 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:54:27.988615 140637641971136 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:54:27.991100 140637641971136 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:54:27.991858 140637641971136 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:54:27.992402 140637641971136 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:54:27.992525 140637641971136 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:54:28.399521 140637641971136 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:54:28.406974 140637641971136 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:54:28.410793 140637641971136 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:54:28.457931 140637641971136 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:54:28.458215 140637641971136 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:54:28.734438 140637641971136 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:54:28.781085 140637641971136 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:54:28.781393 140637641971136 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:54:28.988886 140637641971136 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe89ada7250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe89cf85190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:54:28.989237 140637641971136 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:54:29.334645 140637641971136 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:54:29.337511: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:54:29.348745 140637641971136 tpu_system_metadata.py:148] Found TPU system:
I0811 22:54:29.349029 140637641971136 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:54:29.349546 140637641971136 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:54:29.349646 140637641971136 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:54:29.349705 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:54:29.350035 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:54:29.350092 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:54:29.350143 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:54:29.350192 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:54:29.350251 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:54:29.350300 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:54:29.350347 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:54:29.350395 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:54:29.350441 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:54:29.350488 140637641971136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:54:29.356487 140637641971136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:54:29.368922 140637641971136 estimator.py:1145] Calling model_fn.
W0811 22:54:29.369512 140637641971136 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:54:29.639482 140637641971136 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:54:30.071851 140637641971136 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:54:30.132313 140637641971136 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:54:30.138108 140637641971136 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:54:30.314671 140637641971136 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:54:30.328380 140637641971136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:54:30.340548 140637641971136 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:54:30.340878 140637641971136 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:54:30.760051 140637641971136 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:54:30.775141 140637641971136 estimator.py:1147] Done calling model_fn.
I0811 22:54:34.093296 140637641971136 tpu_estimator.py:499] TPU job name worker
I0811 22:54:34.206876 140637641971136 monitored_session.py:240] Graph was finalized.
I0811 22:54:34.780591 140637641971136 session_manager.py:500] Running local_init_op.
I0811 22:54:34.819156 140637641971136 session_manager.py:502] Done running local_init_op.
I0811 22:54:37.413816 140637641971136 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:54:49.476425 140637641971136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:54:49.586666 140637641971136 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:54:49.587163 140637641971136 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:54:49.587763: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:54:49.592418 140637641971136 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:54:49.594538 140637641971136 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:54:49.598021 140637641971136 tpu_estimator.py:557] Init TPU system
I0811 22:55:32.838953 140637641971136 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 22:55:32.840303 140636741162752 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:55:32.841654 140636732770048 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:55:32.883991 140637641971136 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:55:32.884862 140637641971136 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:55:32.897183 140636724377344 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:55:33.132386 140636724377344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:55:37.346412 140636732770048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:55:41.732031 140637641971136 basic_session_run_hooks.py:262] loss = 0.09643236, step = 30
I0811 22:55:41.734760 140637641971136 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:55:54.905354 140637641971136 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:55:54.905706 140637641971136 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:55:54.906022 140636741162752 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:55:54.906337 140636741162752 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:55:54.906532 140637641971136 error_handling.py:96] infeed marked as finished
I0811 22:55:54.906716 140637641971136 tpu_estimator.py:602] Stop output thread controller
I0811 22:55:54.906771 140637641971136 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:55:54.906955 140636732770048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:55:54.907150 140636732770048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:55:54.907291 140637641971136 error_handling.py:96] outfeed marked as finished
I0811 22:55:54.907428 140637641971136 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:56:03.262373 140637641971136 estimator.py:368] Loss for final step: 0.09643236.
I0811 22:56:03.263253 140637641971136 error_handling.py:96] training_loop marked as finished
I0811 22:56:04.299946 140637641971136 estimator.py:1145] Calling model_fn.
E0811 22:56:05.016624 140637641971136 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:56:05.214957 140637641971136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:56:05.242652 140637641971136 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:56:05.263812 140637641971136 estimator.py:1147] Done calling model_fn.
I0811 22:56:05.281095 140637641971136 evaluation.py:255] Starting evaluation at 2019-08-11T22:56:05Z
I0811 22:56:05.281333 140637641971136 tpu_estimator.py:499] TPU job name worker
I0811 22:56:05.355814 140637641971136 monitored_session.py:240] Graph was finalized.
W0811 22:56:05.356543 140637641971136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:56:05.543179 140637641971136 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:56:08.087146 140637641971136 session_manager.py:500] Running local_init_op.
I0811 22:56:08.110459 140637641971136 session_manager.py:502] Done running local_init_op.
I0811 22:56:08.156634 140637641971136 tpu_estimator.py:557] Init TPU system
I0811 22:57:16.733808 140637641971136 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 22:57:16.734989 140636741162752 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:57:16.735800 140636732770048 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:57:16.802017 140637641971136 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:57:16.825709 140637641971136 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 22:57:16.826039 140637641971136 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 22:57:16.861646 140636724377344 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:57:16.956963 140636724377344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:57:17.570605 140636732770048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:57:17.882388 140637641971136 evaluation.py:167] Evaluation [10/10]
I0811 22:57:17.882738 140637641971136 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:57:17.882807 140637641971136 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:57:17.883049 140636741162752 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:57:17.883313 140636741162752 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:57:17.883503 140637641971136 error_handling.py:96] infeed marked as finished
I0811 22:57:17.883795 140637641971136 tpu_estimator.py:602] Stop output thread controller
I0811 22:57:17.883891 140637641971136 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:57:17.884126 140636732770048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:57:17.884339 140636732770048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:57:17.884608 140637641971136 error_handling.py:96] outfeed marked as finished
I0811 22:57:17.884764 140637641971136 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:57:47.220204 140637641971136 evaluation.py:275] Finished evaluation at 2019-08-11-22:57:47
I0811 22:57:47.220572 140637641971136 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9744, global_step = 30, loss = 0.07715561
I0811 22:57:51.512115 140637641971136 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 22:57:52.413912 140637641971136 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07715561, 'global_step': 30, 'accuracy': 0.9744}

Removing gs://yangyou-mnist/log/checkpoint#1565564151436118...
Removing gs://yangyou-mnist/log/#1565564072233799...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565564084573333...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565564072.v3-8-tpu#1565564154586282...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565564088981311...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565564148303278...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565564149266754...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565564076866502...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565564083724367...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565564153611146...
Removing gs://yangyou-mnist/log/eval/#1565564268895698...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565564269.v3-8-tpu#1565564272087678...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 22:57:56.177088 140291311015360 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 22:57:56.178095 140291311015360 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 22:57:56.180793 140291311015360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 22:57:56.181660 140291311015360 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 22:57:56.182265 140291311015360 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 22:57:56.182405 140291311015360 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 22:57:56.601733 140291311015360 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 22:57:56.608757 140291311015360 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 22:57:56.612878 140291311015360 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:57:56.658399 140291311015360 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:57:56.658689 140291311015360 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:57:56.740780 140291311015360 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 22:57:56.788899 140291311015360 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 22:57:56.789181 140291311015360 transport.py:157] Attempting refresh to obtain initial access_token
I0811 22:57:56.921267 140291311015360 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f97f7ea0510>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f97fa095190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 22:57:56.921686 140291311015360 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 22:57:57.248987 140291311015360 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 22:57:57.252036: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:57:57.264503 140291311015360 tpu_system_metadata.py:148] Found TPU system:
I0811 22:57:57.264797 140291311015360 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 22:57:57.265350 140291311015360 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 22:57:57.265408 140291311015360 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 22:57:57.265460 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 22:57:57.265840 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 22:57:57.265898 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 22:57:57.265949 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 22:57:57.265997 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 22:57:57.266045 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 22:57:57.266092 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 22:57:57.266155 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 22:57:57.266206 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 22:57:57.266252 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 22:57:57.266299 140291311015360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 22:57:57.272263 140291311015360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 22:57:57.284974 140291311015360 estimator.py:1145] Calling model_fn.
W0811 22:57:57.285612 140291311015360 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 22:57:57.561311 140291311015360 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 22:57:58.020354 140291311015360 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 22:57:58.082881 140291311015360 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 22:57:58.088759 140291311015360 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:57:58.265841 140291311015360 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 22:57:58.279267 140291311015360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 22:57:58.291440 140291311015360 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 22:57:58.291784 140291311015360 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 22:57:58.715482 140291311015360 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 22:57:58.730954 140291311015360 estimator.py:1147] Done calling model_fn.
I0811 22:58:02.125655 140291311015360 tpu_estimator.py:499] TPU job name worker
I0811 22:58:02.239212 140291311015360 monitored_session.py:240] Graph was finalized.
I0811 22:58:02.803688 140291311015360 session_manager.py:500] Running local_init_op.
I0811 22:58:02.835002 140291311015360 session_manager.py:502] Done running local_init_op.
I0811 22:58:05.374027 140291311015360 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 22:58:18.259473 140291311015360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 22:58:18.370323 140291311015360 util.py:98] Initialized dataset iterators in 0 seconds
I0811 22:58:18.370788 140291311015360 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 22:58:18.371179: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 22:58:18.375691 140291311015360 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 22:58:18.377865 140291311015360 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 22:58:18.382184 140291311015360 tpu_estimator.py:557] Init TPU system
I0811 22:59:00.845309 140291311015360 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 22:59:00.846183 140290618865408 tpu_estimator.py:514] Starting infeed thread controller.
I0811 22:59:00.847023 140290140665600 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 22:59:00.889785 140291311015360 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 22:59:00.890892 140291311015360 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 22:59:00.902584 140290132272896 transport.py:157] Attempting refresh to obtain initial access_token
W0811 22:59:01.136329 140290132272896 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 22:59:05.463191 140290140665600 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 22:59:10.081041 140291311015360 basic_session_run_hooks.py:262] loss = 2.3004248, step = 30
I0811 22:59:10.083584 140291311015360 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 22:59:23.147356 140291311015360 tpu_estimator.py:598] Stop infeed thread controller
I0811 22:59:23.147676 140291311015360 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 22:59:23.147994 140290618865408 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 22:59:23.148289 140290618865408 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 22:59:23.148495 140291311015360 error_handling.py:96] infeed marked as finished
I0811 22:59:23.148677 140291311015360 tpu_estimator.py:602] Stop output thread controller
I0811 22:59:23.148730 140291311015360 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 22:59:23.148885 140290140665600 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 22:59:23.149033 140290140665600 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 22:59:23.149183 140291311015360 error_handling.py:96] outfeed marked as finished
I0811 22:59:23.149312 140291311015360 tpu_estimator.py:606] Shutdown TPU system.
I0811 22:59:31.267884 140291311015360 estimator.py:368] Loss for final step: 2.3004248.
I0811 22:59:31.268768 140291311015360 error_handling.py:96] training_loop marked as finished
I0811 22:59:32.064254 140291311015360 estimator.py:1145] Calling model_fn.
E0811 22:59:32.758003 140291311015360 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 22:59:32.945889 140291311015360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 22:59:32.972971 140291311015360 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 22:59:32.993674 140291311015360 estimator.py:1147] Done calling model_fn.
I0811 22:59:33.010181 140291311015360 evaluation.py:255] Starting evaluation at 2019-08-11T22:59:33Z
I0811 22:59:33.010423 140291311015360 tpu_estimator.py:499] TPU job name worker
I0811 22:59:33.084752 140291311015360 monitored_session.py:240] Graph was finalized.
W0811 22:59:33.085484 140291311015360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 22:59:33.275223 140291311015360 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 22:59:35.894972 140291311015360 session_manager.py:500] Running local_init_op.
I0811 22:59:35.918344 140291311015360 session_manager.py:502] Done running local_init_op.
I0811 22:59:35.973151 140291311015360 tpu_estimator.py:557] Init TPU system
I0811 23:00:44.626883 140291311015360 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:00:44.627861 140290140665600 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:00:44.628640 140290132272896 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:00:44.698898 140291311015360 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:00:44.722551 140291311015360 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:00:44.722922 140291311015360 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:00:44.753295 140290123618048 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:00:44.991513 140290123618048 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:00:45.450177 140290132272896 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:00:45.935460 140291311015360 evaluation.py:167] Evaluation [10/10]
I0811 23:00:45.935859 140291311015360 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:00:45.935941 140291311015360 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:00:45.936227 140290140665600 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:00:45.936522 140290140665600 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:00:45.936753 140291311015360 error_handling.py:96] infeed marked as finished
I0811 23:00:45.936929 140291311015360 tpu_estimator.py:602] Stop output thread controller
I0811 23:00:45.936984 140291311015360 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:00:45.937155 140290132272896 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:00:45.937300 140290132272896 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:00:45.937436 140291311015360 error_handling.py:96] outfeed marked as finished
I0811 23:00:45.937563 140291311015360 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:01:15.086205 140291311015360 evaluation.py:275] Finished evaluation at 2019-08-11-23:01:15
I0811 23:01:15.086574 140291311015360 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3000402
I0811 23:01:19.547466 140291311015360 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:01:20.298697 140291311015360 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3000402, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565564280267225...
Removing gs://yangyou-mnist/log/checkpoint#1565564359776210...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565564280.v3-8-tpu#1565564362825655...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565564284827357...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565564297758163...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565564356649896...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565564357527400...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565564292620385...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565564291766784...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565564361924659...
Removing gs://yangyou-mnist/log/eval/#1565564476755858...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565564476.v3-8-tpu#1565564479973210...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:01:24.096436 139883674883520 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:01:24.097223 139883674883520 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:01:24.099879 139883674883520 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:01:24.100728 139883674883520 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:01:24.101339 139883674883520 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:01:24.101481 139883674883520 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:01:24.522329 139883674883520 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:01:24.529012 139883674883520 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:01:24.532783 139883674883520 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:01:24.574145 139883674883520 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:01:24.574417 139883674883520 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:01:24.852416 139883674883520 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:01:24.902029 139883674883520 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:01:24.902303 139883674883520 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:01:25.002578 139883674883520 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f390ee9b150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3911079190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:01:25.002926 139883674883520 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:01:25.378128 139883674883520 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:01:25.381229: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:01:25.392961 139883674883520 tpu_system_metadata.py:148] Found TPU system:
I0811 23:01:25.393249 139883674883520 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:01:25.393827 139883674883520 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:01:25.393892 139883674883520 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:01:25.393953 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:01:25.394272 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:01:25.394332 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:01:25.394385 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:01:25.394449 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:01:25.394496 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:01:25.394547 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:01:25.394597 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:01:25.394655 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:01:25.394702 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:01:25.394750 139883674883520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:01:25.400860 139883674883520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:01:25.413058 139883674883520 estimator.py:1145] Calling model_fn.
W0811 23:01:25.413707 139883674883520 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:01:25.688079 139883674883520 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:01:26.105468 139883674883520 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:01:26.167361 139883674883520 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:01:26.173240 139883674883520 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:01:26.350902 139883674883520 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:01:26.364480 139883674883520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:01:26.376413 139883674883520 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:01:26.376729 139883674883520 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:01:26.793826 139883674883520 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:01:26.808929 139883674883520 estimator.py:1147] Done calling model_fn.
I0811 23:01:29.989015 139883674883520 tpu_estimator.py:499] TPU job name worker
I0811 23:01:30.103003 139883674883520 monitored_session.py:240] Graph was finalized.
I0811 23:01:30.690325 139883674883520 session_manager.py:500] Running local_init_op.
I0811 23:01:30.721502 139883674883520 session_manager.py:502] Done running local_init_op.
I0811 23:01:35.423124 139883674883520 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:01:47.706475 139883674883520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:01:47.814780 139883674883520 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:01:47.815279 139883674883520 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:01:47.815688: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:01:47.820483 139883674883520 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:01:47.822597 139883674883520 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:01:47.826252 139883674883520 tpu_estimator.py:557] Init TPU system
I0811 23:02:28.580478 139883674883520 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0811 23:02:28.581669 139882646988544 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:02:28.582509 139882638595840 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:02:28.626885 139883674883520 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:02:28.627767 139883674883520 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:02:28.640177 139882630203136 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:02:28.760863 139882630203136 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:02:33.161403 139882638595840 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:02:37.805099 139883674883520 basic_session_run_hooks.py:262] loss = 2.3039227, step = 30
I0811 23:02:37.807682 139883674883520 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:02:51.332885 139883674883520 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:02:51.333159 139883674883520 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:02:51.333509 139882646988544 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:02:51.334052 139882646988544 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:02:51.334331 139883674883520 error_handling.py:96] infeed marked as finished
I0811 23:02:51.334542 139883674883520 tpu_estimator.py:602] Stop output thread controller
I0811 23:02:51.334604 139883674883520 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:02:51.334772 139882638595840 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:02:51.334932 139882638595840 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:02:51.335119 139883674883520 error_handling.py:96] outfeed marked as finished
I0811 23:02:51.335340 139883674883520 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:02:58.897979 139883674883520 estimator.py:368] Loss for final step: 2.3039227.
I0811 23:02:58.898824 139883674883520 error_handling.py:96] training_loop marked as finished
I0811 23:02:59.833749 139883674883520 estimator.py:1145] Calling model_fn.
E0811 23:03:00.520817 139883674883520 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:03:00.713835 139883674883520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:03:00.741700 139883674883520 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:03:00.763031 139883674883520 estimator.py:1147] Done calling model_fn.
I0811 23:03:00.780797 139883674883520 evaluation.py:255] Starting evaluation at 2019-08-11T23:03:00Z
I0811 23:03:00.781037 139883674883520 tpu_estimator.py:499] TPU job name worker
I0811 23:03:00.854944 139883674883520 monitored_session.py:240] Graph was finalized.
W0811 23:03:00.855650 139883674883520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:03:01.064882 139883674883520 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:03:03.661730 139883674883520 session_manager.py:500] Running local_init_op.
I0811 23:03:03.691623 139883674883520 session_manager.py:502] Done running local_init_op.
I0811 23:03:03.740241 139883674883520 tpu_estimator.py:557] Init TPU system
I0811 23:04:12.587471 139883674883520 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:04:12.588550 139882643056384 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:04:12.589332 139882634663680 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:04:12.656232 139883674883520 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:04:12.688015 139883674883520 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:04:12.688369 139883674883520 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:04:12.715024 139882621548288 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:04:12.986660 139882621548288 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:04:13.443331 139882634663680 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:04:13.824544 139883674883520 evaluation.py:167] Evaluation [10/10]
I0811 23:04:13.824894 139883674883520 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:04:13.824971 139883674883520 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:04:13.825226 139882643056384 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:04:13.825501 139882643056384 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:04:13.825732 139883674883520 error_handling.py:96] infeed marked as finished
I0811 23:04:13.825903 139883674883520 tpu_estimator.py:602] Stop output thread controller
I0811 23:04:13.825958 139883674883520 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:04:13.826123 139882634663680 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:04:13.826271 139882634663680 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:04:13.826457 139883674883520 error_handling.py:96] outfeed marked as finished
I0811 23:04:13.826585 139883674883520 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:04:43.083370 139883674883520 evaluation.py:275] Finished evaluation at 2019-08-11-23:04:43
I0811 23:04:43.083731 139883674883520 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2988422
I0811 23:04:47.642247 139883674883520 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:04:48.529021 139883674883520 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2988422, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565564488250891...
Removing gs://yangyou-mnist/log/checkpoint#1565564567439212...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565564507209259...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565564564275935...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565564488.v3-8-tpu#1565564571007126...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565564502996155...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565564502040733...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565564494872085...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565564565127989...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565564569557815...
Removing gs://yangyou-mnist/log/eval/#1565564684864099...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565564685.v3-8-tpu#1565564688153072...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:04:52.276922 140231006078400 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:04:52.277894 140231006078400 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:04:52.280474 140231006078400 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:04:52.281282 140231006078400 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:04:52.281868 140231006078400 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:04:52.282012 140231006078400 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:04:52.692625 140231006078400 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:04:52.698854 140231006078400 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:04:52.702653 140231006078400 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:04:52.751127 140231006078400 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:04:52.751409 140231006078400 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:04:52.988224 140231006078400 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:04:53.031193 140231006078400 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:04:53.031536 140231006078400 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:04:53.167592 140231006078400 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f89ed772190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f89ef950190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:04:53.167946 140231006078400 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:04:53.496962 140231006078400 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:04:53.499979: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:04:53.513525 140231006078400 tpu_system_metadata.py:148] Found TPU system:
I0811 23:04:53.513816 140231006078400 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:04:53.514307 140231006078400 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:04:53.514364 140231006078400 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:04:53.514417 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:04:53.514725 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:04:53.514784 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:04:53.514838 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:04:53.514888 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:04:53.514935 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:04:53.514981 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:04:53.515027 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:04:53.515073 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:04:53.515119 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:04:53.515189 140231006078400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:04:53.521378 140231006078400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:04:53.533282 140231006078400 estimator.py:1145] Calling model_fn.
W0811 23:04:53.533921 140231006078400 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:04:53.809122 140231006078400 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:04:54.222256 140231006078400 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:04:54.283087 140231006078400 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:04:54.290254 140231006078400 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:04:54.466840 140231006078400 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:04:54.480555 140231006078400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:04:54.492316 140231006078400 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:04:54.492628 140231006078400 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:04:54.892478 140231006078400 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:04:54.907915 140231006078400 estimator.py:1147] Done calling model_fn.
I0811 23:04:58.190850 140231006078400 tpu_estimator.py:499] TPU job name worker
I0811 23:04:58.305955 140231006078400 monitored_session.py:240] Graph was finalized.
I0811 23:04:58.908792 140231006078400 session_manager.py:500] Running local_init_op.
I0811 23:04:58.939939 140231006078400 session_manager.py:502] Done running local_init_op.
I0811 23:05:01.450788 140231006078400 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:05:13.571321 140231006078400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:05:13.685928 140231006078400 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:05:13.686400 140231006078400 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:05:13.686831: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:05:13.692205 140231006078400 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:05:13.694549 140231006078400 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:05:13.698939 140231006078400 tpu_estimator.py:557] Init TPU system
I0811 23:05:56.668132 140231006078400 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:05:56.669081 140230112560896 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:05:56.669624 140230104168192 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:05:56.714960 140231006078400 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:05:56.715811 140231006078400 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:05:56.726243 140230095775488 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:05:56.884852 140230095775488 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:06:01.284837 140230104168192 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:06:05.857542 140231006078400 basic_session_run_hooks.py:262] loss = 2.3060758, step = 30
I0811 23:06:05.860029 140231006078400 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:06:19.735738 140231006078400 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:06:19.736021 140231006078400 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:06:19.736330 140230112560896 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:06:19.736671 140230112560896 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:06:19.736968 140231006078400 error_handling.py:96] infeed marked as finished
I0811 23:06:19.737312 140231006078400 tpu_estimator.py:602] Stop output thread controller
I0811 23:06:19.737385 140231006078400 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:06:19.737570 140230104168192 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:06:19.737802 140230104168192 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:06:19.737972 140231006078400 error_handling.py:96] outfeed marked as finished
I0811 23:06:19.738149 140231006078400 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:06:27.019711 140231006078400 estimator.py:368] Loss for final step: 2.3060758.
I0811 23:06:27.020533 140231006078400 error_handling.py:96] training_loop marked as finished
I0811 23:06:28.523571 140231006078400 estimator.py:1145] Calling model_fn.
E0811 23:06:29.210342 140231006078400 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:06:29.408035 140231006078400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:06:29.435165 140231006078400 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:06:29.456279 140231006078400 estimator.py:1147] Done calling model_fn.
I0811 23:06:29.472855 140231006078400 evaluation.py:255] Starting evaluation at 2019-08-11T23:06:29Z
I0811 23:06:29.473099 140231006078400 tpu_estimator.py:499] TPU job name worker
I0811 23:06:29.551503 140231006078400 monitored_session.py:240] Graph was finalized.
W0811 23:06:29.552320 140231006078400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:06:29.738760 140231006078400 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:06:32.249411 140231006078400 session_manager.py:500] Running local_init_op.
I0811 23:06:32.277997 140231006078400 session_manager.py:502] Done running local_init_op.
I0811 23:06:32.330621 140231006078400 tpu_estimator.py:557] Init TPU system
I0811 23:07:40.623143 140231006078400 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:07:40.624174 140230108628736 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:07:40.624532 140230100236032 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:07:40.699295 140231006078400 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:07:40.726198 140231006078400 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:07:40.726546 140231006078400 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:07:40.757335 140230087120640 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:07:40.867935 140230087120640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:07:41.498353 140230100236032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:07:41.845963 140231006078400 evaluation.py:167] Evaluation [10/10]
I0811 23:07:41.846318 140231006078400 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:07:41.846417 140231006078400 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:07:41.846662 140230108628736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:07:41.846947 140230108628736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:07:41.847203 140231006078400 error_handling.py:96] infeed marked as finished
I0811 23:07:41.847393 140231006078400 tpu_estimator.py:602] Stop output thread controller
I0811 23:07:41.847449 140231006078400 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:07:41.847598 140230100236032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:07:41.847764 140230100236032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:07:41.847904 140231006078400 error_handling.py:96] outfeed marked as finished
I0811 23:07:41.848025 140231006078400 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:08:10.965713 140231006078400 evaluation.py:275] Finished evaluation at 2019-08-11-23:08:10
I0811 23:08:10.966093 140231006078400 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3037677
I0811 23:08:15.429270 140231006078400 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:08:16.325041 140231006078400 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3037677, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565564696351558...
Removing gs://yangyou-mnist/log/checkpoint#1565564776158322...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565564700906533...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565564708812633...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565564696.v3-8-tpu#1565564779411030...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565564713070410...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565564773906160...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565564773045606...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565564707916492...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565564778425820...
Removing gs://yangyou-mnist/log/eval/#1565564892574639...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565564892.v3-8-tpu#1565564895997907...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:08:20.057276 140057626273216 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:08:20.058154 140057626273216 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:08:20.060760 140057626273216 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:08:20.061666 140057626273216 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:08:20.062279 140057626273216 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:08:20.062407 140057626273216 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:08:20.453830 140057626273216 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:08:20.460093 140057626273216 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:08:20.463635 140057626273216 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:08:20.514962 140057626273216 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:08:20.515238 140057626273216 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:08:20.595647 140057626273216 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:08:20.701028 140057626273216 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:08:20.701330 140057626273216 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:08:20.840679 140057626273216 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f618f394090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f6191572190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:08:20.841078 140057626273216 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:08:21.163022 140057626273216 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:08:21.165969: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:08:21.179224 140057626273216 tpu_system_metadata.py:148] Found TPU system:
I0811 23:08:21.179466 140057626273216 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:08:21.179975 140057626273216 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:08:21.180032 140057626273216 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:08:21.180094 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:08:21.180378 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:08:21.180435 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:08:21.180491 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:08:21.180541 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:08:21.180593 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:08:21.180640 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:08:21.180687 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:08:21.180735 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:08:21.180783 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:08:21.180833 140057626273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:08:21.186970 140057626273216 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:08:21.199978 140057626273216 estimator.py:1145] Calling model_fn.
W0811 23:08:21.200623 140057626273216 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:08:21.471957 140057626273216 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:08:21.887793 140057626273216 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:08:21.948997 140057626273216 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:08:21.955007 140057626273216 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:08:22.132471 140057626273216 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:08:22.146150 140057626273216 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:08:22.157949 140057626273216 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:08:22.158262 140057626273216 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:08:22.578419 140057626273216 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:08:22.593710 140057626273216 estimator.py:1147] Done calling model_fn.
I0811 23:08:25.846648 140057626273216 tpu_estimator.py:499] TPU job name worker
I0811 23:08:25.960097 140057626273216 monitored_session.py:240] Graph was finalized.
I0811 23:08:26.516979 140057626273216 session_manager.py:500] Running local_init_op.
I0811 23:08:26.548233 140057626273216 session_manager.py:502] Done running local_init_op.
I0811 23:08:29.066612 140057626273216 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:08:41.125792 140057626273216 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:08:41.248383 140057626273216 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:08:41.248887 140057626273216 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:08:41.249299: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:08:41.253879 140057626273216 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:08:41.256009 140057626273216 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:08:41.259671 140057626273216 tpu_estimator.py:557] Init TPU system
I0811 23:09:24.661464 140057626273216 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 23:09:24.662444 140056593426176 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:09:24.662974 140056585033472 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:09:24.706851 140057626273216 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:09:24.707753 140057626273216 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:09:24.718199 140056576640768 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:09:24.943128 140056576640768 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:09:29.399743 140056585033472 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:09:33.933254 140057626273216 basic_session_run_hooks.py:262] loss = 2.3030686, step = 30
I0811 23:09:33.935635 140057626273216 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:09:47.464055 140057626273216 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:09:47.464406 140057626273216 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:09:47.464756 140056593426176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:09:47.465063 140056593426176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:09:47.465313 140057626273216 error_handling.py:96] infeed marked as finished
I0811 23:09:47.465560 140057626273216 tpu_estimator.py:602] Stop output thread controller
I0811 23:09:47.465686 140057626273216 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:09:47.465847 140056585033472 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:09:47.466025 140056585033472 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:09:47.466180 140057626273216 error_handling.py:96] outfeed marked as finished
I0811 23:09:47.466310 140057626273216 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:09:55.080214 140057626273216 estimator.py:368] Loss for final step: 2.3030686.
I0811 23:09:55.081053 140057626273216 error_handling.py:96] training_loop marked as finished
I0811 23:09:55.795205 140057626273216 estimator.py:1145] Calling model_fn.
E0811 23:09:56.480308 140057626273216 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:09:56.672449 140057626273216 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:09:56.699656 140057626273216 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:09:56.721117 140057626273216 estimator.py:1147] Done calling model_fn.
I0811 23:09:56.738589 140057626273216 evaluation.py:255] Starting evaluation at 2019-08-11T23:09:56Z
I0811 23:09:56.738842 140057626273216 tpu_estimator.py:499] TPU job name worker
I0811 23:09:56.814097 140057626273216 monitored_session.py:240] Graph was finalized.
W0811 23:09:56.814929 140057626273216 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:09:56.998516 140057626273216 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:09:59.550636 140057626273216 session_manager.py:500] Running local_init_op.
I0811 23:09:59.575784 140057626273216 session_manager.py:502] Done running local_init_op.
I0811 23:09:59.631998 140057626273216 tpu_estimator.py:557] Init TPU system
I0811 23:11:08.646501 140057626273216 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 23:11:08.647443 140056593426176 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:11:08.648627 140056585033472 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:11:08.725270 140057626273216 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:11:08.750276 140057626273216 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:11:08.750658 140057626273216 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:11:08.782289 140056576640768 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:11:08.889280 140056576640768 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:11:09.472353 140056585033472 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:11:09.908283 140057626273216 evaluation.py:167] Evaluation [10/10]
I0811 23:11:09.908646 140057626273216 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:11:09.908725 140057626273216 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:11:09.908996 140056593426176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:11:09.909118 140056593426176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:11:09.909270 140057626273216 error_handling.py:96] infeed marked as finished
I0811 23:11:09.909377 140057626273216 tpu_estimator.py:602] Stop output thread controller
I0811 23:11:09.909449 140057626273216 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:11:09.909574 140056585033472 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:11:09.909718 140056585033472 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:11:09.909864 140057626273216 error_handling.py:96] outfeed marked as finished
I0811 23:11:09.909951 140057626273216 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:11:38.984889 140057626273216 evaluation.py:275] Finished evaluation at 2019-08-11-23:11:38
I0811 23:11:38.985285 140057626273216 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2998939
I0811 23:11:43.452035 140057626273216 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:11:44.274107 140057626273216 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2998939, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565564904081041...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565564916301521...
Removing gs://yangyou-mnist/log/checkpoint#1565564983954932...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565564904.v3-8-tpu#1565564987145385...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565564920622667...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565564908519757...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565564980847337...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565564915232752...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565564981694924...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565564986149781...
Removing gs://yangyou-mnist/log/eval/#1565565100647695...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565565100.v3-8-tpu#1565565103938840...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:11:48.098078 139972642502080 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:11:48.098840 139972642502080 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:11:48.101355 139972642502080 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:11:48.102168 139972642502080 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:11:48.102735 139972642502080 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:11:48.102864 139972642502080 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:11:48.506189 139972642502080 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:11:48.513849 139972642502080 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:11:48.517729 139972642502080 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:11:48.566952 139972642502080 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:11:48.567222 139972642502080 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:11:48.676213 139972642502080 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:11:48.721898 139972642502080 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:11:48.722172 139972642502080 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:11:48.958149 139972642502080 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4dc5cbd210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4dc7e9b150>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:11:48.958522 139972642502080 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:11:49.278531 139972642502080 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:11:49.281548: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:11:49.293515 139972642502080 tpu_system_metadata.py:148] Found TPU system:
I0811 23:11:49.293823 139972642502080 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:11:49.294321 139972642502080 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:11:49.294377 139972642502080 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:11:49.294429 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:11:49.294711 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:11:49.294766 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:11:49.294816 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:11:49.294863 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:11:49.294910 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:11:49.294958 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:11:49.295003 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:11:49.295049 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:11:49.295098 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:11:49.295146 139972642502080 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:11:49.301141 139972642502080 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:11:49.313370 139972642502080 estimator.py:1145] Calling model_fn.
W0811 23:11:49.313981 139972642502080 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:11:49.579225 139972642502080 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:11:50.089574 139972642502080 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:11:50.149924 139972642502080 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:11:50.155631 139972642502080 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:11:50.332792 139972642502080 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:11:50.346251 139972642502080 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:11:50.357923 139972642502080 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:11:50.358227 139972642502080 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:11:50.775660 139972642502080 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:11:50.790725 139972642502080 estimator.py:1147] Done calling model_fn.
I0811 23:11:54.047261 139972642502080 tpu_estimator.py:499] TPU job name worker
I0811 23:11:54.159495 139972642502080 monitored_session.py:240] Graph was finalized.
I0811 23:11:54.775531 139972642502080 session_manager.py:500] Running local_init_op.
I0811 23:11:54.814487 139972642502080 session_manager.py:502] Done running local_init_op.
I0811 23:11:57.365108 139972642502080 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:12:09.579169 139972642502080 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:12:09.706780 139972642502080 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:12:09.707283 139972642502080 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:12:09.707657: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:12:09.713134 139972642502080 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:12:09.715301 139972642502080 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:12:09.718981 139972642502080 tpu_estimator.py:557] Init TPU system
I0811 23:12:52.658052 139972642502080 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:12:52.658960 139971748939520 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:12:52.659502 139971740546816 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:12:52.706301 139972642502080 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:12:52.707173 139972642502080 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:12:52.718732 139971732154112 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:12:52.941787 139971732154112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:12:57.465377 139971740546816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:13:02.121160 139972642502080 basic_session_run_hooks.py:262] loss = 0.64195323, step = 30
I0811 23:13:02.123945 139972642502080 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:13:15.680918 139972642502080 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:13:15.681278 139972642502080 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:13:15.682698 139971748939520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:13:15.682997 139971748939520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:13:15.683321 139972642502080 error_handling.py:96] infeed marked as finished
I0811 23:13:15.683567 139972642502080 tpu_estimator.py:602] Stop output thread controller
I0811 23:13:15.683634 139972642502080 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:13:15.683804 139971740546816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:13:15.683986 139971740546816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:13:15.684154 139972642502080 error_handling.py:96] outfeed marked as finished
I0811 23:13:15.684298 139972642502080 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:13:23.078318 139972642502080 estimator.py:368] Loss for final step: 0.64195323.
I0811 23:13:23.079109 139972642502080 error_handling.py:96] training_loop marked as finished
I0811 23:13:23.861709 139972642502080 estimator.py:1145] Calling model_fn.
E0811 23:13:24.564033 139972642502080 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:13:24.756211 139972642502080 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:13:24.783390 139972642502080 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:13:24.804255 139972642502080 estimator.py:1147] Done calling model_fn.
I0811 23:13:24.820863 139972642502080 evaluation.py:255] Starting evaluation at 2019-08-11T23:13:24Z
I0811 23:13:24.821110 139972642502080 tpu_estimator.py:499] TPU job name worker
I0811 23:13:24.896260 139972642502080 monitored_session.py:240] Graph was finalized.
W0811 23:13:24.896991 139972642502080 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:13:25.097956 139972642502080 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:13:27.688268 139972642502080 session_manager.py:500] Running local_init_op.
I0811 23:13:27.712575 139972642502080 session_manager.py:502] Done running local_init_op.
I0811 23:13:27.761039 139972642502080 tpu_estimator.py:557] Init TPU system
I0811 23:14:36.604557 139972642502080 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:14:36.605504 139971745007360 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:14:36.605922 139971736614656 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:14:36.671957 139972642502080 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:14:36.702430 139972642502080 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:14:36.702807 139972642502080 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:14:36.731103 139971723499264 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:14:36.940989 139971723499264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:14:37.438498 139971736614656 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:14:37.919862 139972642502080 evaluation.py:167] Evaluation [10/10]
I0811 23:14:37.920217 139972642502080 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:14:37.920289 139972642502080 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:14:37.920475 139971745007360 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:14:37.920578 139971745007360 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:14:37.920722 139972642502080 error_handling.py:96] infeed marked as finished
I0811 23:14:37.920824 139972642502080 tpu_estimator.py:602] Stop output thread controller
I0811 23:14:37.920874 139972642502080 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:14:37.920983 139971736614656 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:14:37.921052 139971736614656 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:14:37.921185 139972642502080 error_handling.py:96] outfeed marked as finished
I0811 23:14:37.921274 139972642502080 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:15:07.036041 139972642502080 evaluation.py:275] Finished evaluation at 2019-08-11-23:15:07
I0811 23:15:07.036386 139972642502080 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8274, global_step = 30, loss = 0.6095065
I0811 23:15:11.340086 139972642502080 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:15:12.122766 139972642502080 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.6095065, 'global_step': 30, 'accuracy': 0.8274}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565565124650784...
Removing gs://yangyou-mnist/log/#1565565112269999...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565565116823059...
Removing gs://yangyou-mnist/log/checkpoint#1565565192118519...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565565112.v3-8-tpu#1565565195360270...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565565188942974...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565565129080084...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565565123784858...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565565189778186...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565565194366477...
Removing gs://yangyou-mnist/log/eval/#1565565308681959...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565565308.v3-8-tpu#1565565311764704...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:15:15.996577 139650103301568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:15:15.997364 139650103301568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:15:16.000080 139650103301568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:15:16.000914 139650103301568 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:15:16.001477 139650103301568 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:15:16.001741 139650103301568 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:15:16.423243 139650103301568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:15:16.429646 139650103301568 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:15:16.433188 139650103301568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:15:16.531708 139650103301568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:15:16.532010 139650103301568 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:15:16.646158 139650103301568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:15:16.691780 139650103301568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:15:16.692070 139650103301568 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:15:16.888624 139650103301568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f02acf630d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f02af141190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:15:16.889014 139650103301568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:15:17.216728 139650103301568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:15:17.219875: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:15:17.232690 139650103301568 tpu_system_metadata.py:148] Found TPU system:
I0811 23:15:17.232978 139650103301568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:15:17.233513 139650103301568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:15:17.233571 139650103301568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:15:17.233674 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:15:17.234034 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:15:17.234091 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:15:17.234143 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:15:17.234193 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:15:17.234240 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:15:17.234286 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:15:17.234335 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:15:17.234383 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:15:17.234431 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:15:17.234477 139650103301568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:15:17.240389 139650103301568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:15:17.252507 139650103301568 estimator.py:1145] Calling model_fn.
W0811 23:15:17.253104 139650103301568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:15:17.528642 139650103301568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:15:17.955482 139650103301568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:15:18.015332 139650103301568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:15:18.021107 139650103301568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:15:18.208656 139650103301568 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:15:18.222588 139650103301568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:15:18.234503 139650103301568 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:15:18.234837 139650103301568 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:15:18.663746 139650103301568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:15:18.679913 139650103301568 estimator.py:1147] Done calling model_fn.
I0811 23:15:22.163935 139650103301568 tpu_estimator.py:499] TPU job name worker
I0811 23:15:22.274907 139650103301568 monitored_session.py:240] Graph was finalized.
I0811 23:15:22.837764 139650103301568 session_manager.py:500] Running local_init_op.
I0811 23:15:22.867795 139650103301568 session_manager.py:502] Done running local_init_op.
I0811 23:15:25.335814 139650103301568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:15:37.765254 139650103301568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:15:37.881737 139650103301568 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:15:37.882294 139650103301568 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:15:37.882691: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:15:37.887751 139650103301568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:15:37.889919 139650103301568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:15:37.894666 139650103301568 tpu_estimator.py:557] Init TPU system
I0811 23:16:20.623759 139650103301568 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:16:20.624686 139649334875904 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:16:20.625356 139648848361216 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:16:20.682626 139650103301568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:16:20.684473 139650103301568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:16:20.689119 139648839968512 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:16:20.930473 139648839968512 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 23:16:25.410253 139648848361216 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:16:30.179939 139650103301568 basic_session_run_hooks.py:262] loss = 1.1593026, step = 30
I0811 23:16:30.182411 139650103301568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:16:43.077316 139650103301568 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:16:43.077765 139650103301568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:16:43.078032 139649334875904 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:16:43.078197 139649334875904 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:16:43.078353 139650103301568 error_handling.py:96] infeed marked as finished
I0811 23:16:43.078461 139650103301568 tpu_estimator.py:602] Stop output thread controller
I0811 23:16:43.078516 139650103301568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:16:43.078633 139648848361216 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:16:43.078732 139648848361216 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:16:43.078850 139650103301568 error_handling.py:96] outfeed marked as finished
I0811 23:16:43.078938 139650103301568 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:16:51.072112 139650103301568 estimator.py:368] Loss for final step: 1.1593026.
I0811 23:16:51.073034 139650103301568 error_handling.py:96] training_loop marked as finished
I0811 23:16:51.766423 139650103301568 estimator.py:1145] Calling model_fn.
E0811 23:16:52.496140 139650103301568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:16:52.687545 139650103301568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:16:52.715102 139650103301568 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:16:52.736169 139650103301568 estimator.py:1147] Done calling model_fn.
I0811 23:16:52.754209 139650103301568 evaluation.py:255] Starting evaluation at 2019-08-11T23:16:52Z
I0811 23:16:52.754457 139650103301568 tpu_estimator.py:499] TPU job name worker
I0811 23:16:52.828478 139650103301568 monitored_session.py:240] Graph was finalized.
W0811 23:16:52.829178 139650103301568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:16:52.995909 139650103301568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:16:55.456424 139650103301568 session_manager.py:500] Running local_init_op.
I0811 23:16:55.486007 139650103301568 session_manager.py:502] Done running local_init_op.
I0811 23:16:55.536730 139650103301568 tpu_estimator.py:557] Init TPU system
I0811 23:18:04.599978 139650103301568 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 23:18:04.601124 139649339598592 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:18:04.601839 139649331205888 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:18:04.680778 139650103301568 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:18:04.708059 139650103301568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:18:04.708451 139650103301568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:18:04.741400 139648848361216 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:18:04.849389 139648848361216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:18:05.469161 139649331205888 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:18:05.744328 139650103301568 evaluation.py:167] Evaluation [10/10]
I0811 23:18:05.744673 139650103301568 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:18:05.744744 139650103301568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:18:05.745009 139649339598592 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:18:05.745155 139649339598592 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:18:05.745413 139650103301568 error_handling.py:96] infeed marked as finished
I0811 23:18:05.745521 139650103301568 tpu_estimator.py:602] Stop output thread controller
I0811 23:18:05.745569 139650103301568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:18:05.745779 139649331205888 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:18:05.745877 139649331205888 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:18:05.746036 139650103301568 error_handling.py:96] outfeed marked as finished
I0811 23:18:05.746134 139650103301568 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:18:34.934670 139650103301568 evaluation.py:275] Finished evaluation at 2019-08-11-23:18:34
I0811 23:18:34.935014 139650103301568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8151, global_step = 30, loss = 1.0852101
I0811 23:18:41.362716 139650103301568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:18:42.194761 139650103301568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.0852101, 'global_step': 30, 'accuracy': 0.8151}

Removing gs://yangyou-mnist/log/#1565565320335957...
Removing gs://yangyou-mnist/log/checkpoint#1565565399602242...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565565332810563...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565565337263898...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565565396651263...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565565324793208...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565565331779635...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565565397449322...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565565320.v3-8-tpu#1565565402774551...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565565401731928...
Removing gs://yangyou-mnist/log/eval/#1565565516648546...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565565516.v3-8-tpu#1565565521867550...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:18:46.073688 139787064903104 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:18:46.074470 139787064903104 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:18:46.077078 139787064903104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:18:46.077965 139787064903104 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:18:46.078583 139787064903104 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:18:46.078711 139787064903104 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:18:46.500802 139787064903104 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:18:46.507232 139787064903104 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:18:46.510777 139787064903104 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:18:46.559690 139787064903104 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:18:46.559988 139787064903104 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:18:46.701821 139787064903104 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:18:46.749849 139787064903104 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:18:46.750128 139787064903104 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:18:46.970964 139787064903104 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f229080f4d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2292a04190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:18:46.971348 139787064903104 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:18:47.294565 139787064903104 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:18:47.297624: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:18:47.309730 139787064903104 tpu_system_metadata.py:148] Found TPU system:
I0811 23:18:47.310033 139787064903104 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:18:47.310532 139787064903104 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:18:47.310591 139787064903104 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:18:47.310646 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:18:47.310946 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:18:47.311003 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:18:47.311054 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:18:47.311104 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:18:47.311152 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:18:47.311199 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:18:47.311245 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:18:47.311295 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:18:47.311342 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:18:47.311391 139787064903104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:18:47.317362 139787064903104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:18:47.329519 139787064903104 estimator.py:1145] Calling model_fn.
W0811 23:18:47.330157 139787064903104 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:18:47.588582 139787064903104 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:18:48.019716 139787064903104 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:18:48.083005 139787064903104 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:18:48.089082 139787064903104 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:18:48.280010 139787064903104 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:18:48.294574 139787064903104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:18:48.307025 139787064903104 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:18:48.307341 139787064903104 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:18:48.734874 139787064903104 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:18:48.750219 139787064903104 estimator.py:1147] Done calling model_fn.
I0811 23:18:52.214320 139787064903104 tpu_estimator.py:499] TPU job name worker
I0811 23:18:52.327080 139787064903104 monitored_session.py:240] Graph was finalized.
I0811 23:18:52.893121 139787064903104 session_manager.py:500] Running local_init_op.
I0811 23:18:52.932866 139787064903104 session_manager.py:502] Done running local_init_op.
I0811 23:18:55.510199 139787064903104 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:19:08.162554 139787064903104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:19:08.270374 139787064903104 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:19:08.270827 139787064903104 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:19:08.271229: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:19:08.276300 139787064903104 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:19:08.278563 139787064903104 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:19:08.283535 139787064903104 tpu_estimator.py:557] Init TPU system
I0811 23:19:48.671308 139787064903104 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0811 23:19:48.672413 139786305644288 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:19:48.673640 139786297251584 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:19:48.721525 139787064903104 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:19:48.722448 139787064903104 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:19:48.733417 139785817552640 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:19:48.844100 139785817552640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:19:53.158777 139786297251584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:19:57.735486 139787064903104 basic_session_run_hooks.py:262] loss = 0.42585474, step = 30
I0811 23:19:57.737934 139787064903104 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:20:10.950937 139787064903104 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:20:10.951224 139787064903104 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:20:10.951442 139786305644288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:20:10.951545 139786305644288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:20:10.951702 139787064903104 error_handling.py:96] infeed marked as finished
I0811 23:20:10.951798 139787064903104 tpu_estimator.py:602] Stop output thread controller
I0811 23:20:10.951845 139787064903104 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:20:10.951956 139786297251584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:20:10.952028 139786297251584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:20:10.952135 139787064903104 error_handling.py:96] outfeed marked as finished
I0811 23:20:10.952222 139787064903104 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:20:18.955640 139787064903104 estimator.py:368] Loss for final step: 0.42585474.
I0811 23:20:18.956442 139787064903104 error_handling.py:96] training_loop marked as finished
I0811 23:20:19.764703 139787064903104 estimator.py:1145] Calling model_fn.
E0811 23:20:20.461366 139787064903104 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:20:20.654289 139787064903104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:20:20.682070 139787064903104 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:20:20.702739 139787064903104 estimator.py:1147] Done calling model_fn.
I0811 23:20:20.719681 139787064903104 evaluation.py:255] Starting evaluation at 2019-08-11T23:20:20Z
I0811 23:20:20.719926 139787064903104 tpu_estimator.py:499] TPU job name worker
I0811 23:20:20.794503 139787064903104 monitored_session.py:240] Graph was finalized.
W0811 23:20:20.795238 139787064903104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:20:20.987564 139787064903104 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:20:23.627327 139787064903104 session_manager.py:500] Running local_init_op.
I0811 23:20:23.655869 139787064903104 session_manager.py:502] Done running local_init_op.
I0811 23:20:23.708535 139787064903104 tpu_estimator.py:557] Init TPU system
I0811 23:21:33.173086 139787064903104 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 23:21:33.174508 139786301712128 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:21:33.175273 139785817552640 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:21:33.240900 139787064903104 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:21:33.268837 139787064903104 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:21:33.269205 139787064903104 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:21:33.343959 139785809159936 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:21:33.455959 139785809159936 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:21:34.020220 139785817552640 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:21:34.368580 139787064903104 evaluation.py:167] Evaluation [10/10]
I0811 23:21:34.368935 139787064903104 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:21:34.369007 139787064903104 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:21:34.369281 139786301712128 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:21:34.369580 139786301712128 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:21:34.369863 139787064903104 error_handling.py:96] infeed marked as finished
I0811 23:21:34.370085 139787064903104 tpu_estimator.py:602] Stop output thread controller
I0811 23:21:34.370238 139787064903104 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:21:34.370428 139785817552640 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:21:34.370661 139785817552640 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:21:34.370826 139787064903104 error_handling.py:96] outfeed marked as finished
I0811 23:21:34.370951 139787064903104 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:22:03.541661 139787064903104 evaluation.py:275] Finished evaluation at 2019-08-11-23:22:03
I0811 23:22:03.542030 139787064903104 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9009, global_step = 30, loss = 0.41045633
I0811 23:22:08.047318 139787064903104 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:22:08.894447 139787064903104 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.41045633, 'global_step': 30, 'accuracy': 0.9009}

Removing gs://yangyou-mnist/log/#1565565530210722...
Removing gs://yangyou-mnist/log/checkpoint#1565565607499742...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565565530.v3-8-tpu#1565565610626494...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565565534958408...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565565543288656...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565565604271051...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565565547667368...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565565542125692...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565565605212087...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565565609749240...
Removing gs://yangyou-mnist/log/eval/#1565565725244103...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565565725.v3-8-tpu#1565565728568145...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:22:12.712481 139999328196032 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:22:12.713313 139999328196032 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:22:12.716008 139999328196032 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:22:12.716826 139999328196032 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:22:12.717412 139999328196032 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:22:12.717545 139999328196032 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:22:13.134079 139999328196032 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:22:13.140733 139999328196032 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:22:13.144650 139999328196032 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:22:13.194186 139999328196032 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:22:13.194477 139999328196032 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:22:13.285048 139999328196032 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:22:13.377126 139999328196032 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:22:13.377399 139999328196032 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:22:13.458970 139999328196032 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f53fc633150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f53fe811190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:22:13.459330 139999328196032 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:22:13.785550 139999328196032 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:22:13.788529: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:22:13.801183 139999328196032 tpu_system_metadata.py:148] Found TPU system:
I0811 23:22:13.801407 139999328196032 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:22:13.801983 139999328196032 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:22:13.802047 139999328196032 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:22:13.802103 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:22:13.802392 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:22:13.802448 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:22:13.802519 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:22:13.802568 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:22:13.802618 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:22:13.802665 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:22:13.802712 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:22:13.802759 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:22:13.802805 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:22:13.802854 139999328196032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:22:13.808698 139999328196032 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:22:13.820626 139999328196032 estimator.py:1145] Calling model_fn.
W0811 23:22:13.821213 139999328196032 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:22:14.092489 139999328196032 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:22:14.509258 139999328196032 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:22:14.569750 139999328196032 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:22:14.575556 139999328196032 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:22:14.752856 139999328196032 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:22:14.766426 139999328196032 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:22:14.778045 139999328196032 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:22:14.778353 139999328196032 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:22:15.194247 139999328196032 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:22:15.209657 139999328196032 estimator.py:1147] Done calling model_fn.
I0811 23:22:18.677004 139999328196032 tpu_estimator.py:499] TPU job name worker
I0811 23:22:18.790651 139999328196032 monitored_session.py:240] Graph was finalized.
I0811 23:22:19.360399 139999328196032 session_manager.py:500] Running local_init_op.
I0811 23:22:19.399691 139999328196032 session_manager.py:502] Done running local_init_op.
I0811 23:22:21.988348 139999328196032 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:22:35.009016 139999328196032 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:22:35.116219 139999328196032 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:22:35.116693 139999328196032 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:22:35.117169: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:22:35.121505 139999328196032 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:22:35.123764 139999328196032 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:22:35.127461 139999328196032 tpu_estimator.py:557] Init TPU system
I0811 23:23:16.663249 139999328196032 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0811 23:23:16.664283 139998636046080 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:23:16.664828 139998149998336 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:23:16.709789 139999328196032 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:23:16.710689 139999328196032 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:23:16.723505 139998141605632 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:23:16.874571 139998141605632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:23:21.342346 139998149998336 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:23:25.873861 139999328196032 basic_session_run_hooks.py:262] loss = 0.2783528, step = 30
I0811 23:23:25.875943 139999328196032 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:23:39.591943 139999328196032 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:23:39.592228 139999328196032 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:23:39.592567 139998636046080 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:23:39.592899 139998636046080 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:23:39.593105 139999328196032 error_handling.py:96] infeed marked as finished
I0811 23:23:39.593329 139999328196032 tpu_estimator.py:602] Stop output thread controller
I0811 23:23:39.593384 139999328196032 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:23:39.593628 139998149998336 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:23:39.593851 139998149998336 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:23:39.594053 139999328196032 error_handling.py:96] outfeed marked as finished
I0811 23:23:39.594234 139999328196032 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:23:46.990370 139999328196032 estimator.py:368] Loss for final step: 0.2783528.
I0811 23:23:46.991146 139999328196032 error_handling.py:96] training_loop marked as finished
I0811 23:23:48.217092 139999328196032 estimator.py:1145] Calling model_fn.
E0811 23:23:48.916418 139999328196032 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:23:49.110227 139999328196032 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:23:49.138629 139999328196032 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:23:49.161972 139999328196032 estimator.py:1147] Done calling model_fn.
I0811 23:23:49.179034 139999328196032 evaluation.py:255] Starting evaluation at 2019-08-11T23:23:49Z
I0811 23:23:49.179287 139999328196032 tpu_estimator.py:499] TPU job name worker
I0811 23:23:49.254344 139999328196032 monitored_session.py:240] Graph was finalized.
W0811 23:23:49.255085 139999328196032 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:23:49.450911 139999328196032 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:23:52.158334 139999328196032 session_manager.py:500] Running local_init_op.
I0811 23:23:52.183789 139999328196032 session_manager.py:502] Done running local_init_op.
I0811 23:23:52.232642 139999328196032 tpu_estimator.py:557] Init TPU system
I0811 23:25:00.661868 139999328196032 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:25:00.662883 139998149998336 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:25:00.664002 139998141605632 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:25:00.736579 139999328196032 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:25:00.760281 139999328196032 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:25:00.760643 139999328196032 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:25:00.792396 139998133212928 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:25:00.894303 139998133212928 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:25:01.507468 139998141605632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:25:02.003722 139999328196032 evaluation.py:167] Evaluation [10/10]
I0811 23:25:02.004056 139999328196032 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:25:02.004127 139999328196032 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:25:02.004404 139998149998336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:25:02.004682 139998149998336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:25:02.004940 139999328196032 error_handling.py:96] infeed marked as finished
I0811 23:25:02.005131 139999328196032 tpu_estimator.py:602] Stop output thread controller
I0811 23:25:02.005193 139999328196032 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:25:02.005386 139998141605632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:25:02.005533 139998141605632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:25:02.006026 139999328196032 error_handling.py:96] outfeed marked as finished
I0811 23:25:02.006201 139999328196032 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:25:30.990386 139999328196032 evaluation.py:275] Finished evaluation at 2019-08-11-23:25:30
I0811 23:25:30.990735 139999328196032 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9278, global_step = 30, loss = 0.2872033
I0811 23:25:35.342410 139999328196032 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:25:36.208308 139999328196032 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.2872033, 'global_step': 30, 'accuracy': 0.9278}

Removing gs://yangyou-mnist/log/#1565565736680669...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565565749133093...
Removing gs://yangyou-mnist/log/checkpoint#1565565816069006...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565565741448894...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565565753772170...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565565736.v3-8-tpu#1565565819267276...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565565812925221...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565565748249199...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565565813845013...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565565818243775...
Removing gs://yangyou-mnist/log/eval/#1565565932691096...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565565932.v3-8-tpu#1565565935882473...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:25:40.101636 140029595575744 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:25:40.102478 140029595575744 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:25:40.105103 140029595575744 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:25:40.105977 140029595575744 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:25:40.106568 140029595575744 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:25:40.106694 140029595575744 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:25:40.529366 140029595575744 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:25:40.536528 140029595575744 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:25:40.540038 140029595575744 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:25:40.587109 140029595575744 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:25:40.587403 140029595575744 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:25:40.671907 140029595575744 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:25:40.765367 140029595575744 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:25:40.765676 140029595575744 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:25:41.032818 140029595575744 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5b08755350>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5b0a94a190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:25:41.033181 140029595575744 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:25:41.370057 140029595575744 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:25:41.373140: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:25:41.385832 140029595575744 tpu_system_metadata.py:148] Found TPU system:
I0811 23:25:41.386081 140029595575744 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:25:41.386601 140029595575744 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:25:41.386660 140029595575744 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:25:41.386713 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:25:41.387054 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:25:41.387115 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:25:41.387170 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:25:41.387217 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:25:41.387265 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:25:41.387312 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:25:41.387367 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:25:41.387413 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:25:41.387461 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:25:41.387511 140029595575744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:25:41.393690 140029595575744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:25:41.406390 140029595575744 estimator.py:1145] Calling model_fn.
W0811 23:25:41.407058 140029595575744 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:25:41.679642 140029595575744 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:25:42.223874 140029595575744 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:25:42.290781 140029595575744 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:25:42.297200 140029595575744 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:25:42.488574 140029595575744 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:25:42.502228 140029595575744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:25:42.515472 140029595575744 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:25:42.515798 140029595575744 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:25:42.948803 140029595575744 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:25:42.964181 140029595575744 estimator.py:1147] Done calling model_fn.
I0811 23:25:46.478146 140029595575744 tpu_estimator.py:499] TPU job name worker
I0811 23:25:46.592832 140029595575744 monitored_session.py:240] Graph was finalized.
I0811 23:25:47.187845 140029595575744 session_manager.py:500] Running local_init_op.
I0811 23:25:47.221097 140029595575744 session_manager.py:502] Done running local_init_op.
I0811 23:25:49.765216 140029595575744 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:26:02.181312 140029595575744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:26:02.305769 140029595575744 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:26:02.306241 140029595575744 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:26:02.306612: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:26:02.311094 140029595575744 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:26:02.313170 140029595575744 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:26:02.317621 140029595575744 tpu_estimator.py:557] Init TPU system
I0811 23:26:44.683968 140029595575744 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:26:44.685043 140028836292352 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:26:44.685983 140028827899648 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:26:44.731749 140029595575744 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:26:44.732603 140029595575744 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:26:44.745820 140028348987136 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:26:44.871830 140028348987136 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 23:26:49.130970 140028827899648 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:26:53.545985 140029595575744 basic_session_run_hooks.py:262] loss = 0.25574094, step = 30
I0811 23:26:53.548572 140029595575744 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:27:07.150449 140029595575744 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:27:07.150749 140029595575744 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:27:07.150974 140028836292352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:27:07.151077 140028836292352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:27:07.151218 140029595575744 error_handling.py:96] infeed marked as finished
I0811 23:27:07.151314 140029595575744 tpu_estimator.py:602] Stop output thread controller
I0811 23:27:07.151374 140029595575744 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:27:07.151487 140028827899648 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:27:07.151559 140028827899648 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:27:07.151679 140029595575744 error_handling.py:96] outfeed marked as finished
I0811 23:27:07.151761 140029595575744 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:27:15.006594 140029595575744 estimator.py:368] Loss for final step: 0.25574094.
I0811 23:27:15.007492 140029595575744 error_handling.py:96] training_loop marked as finished
I0811 23:27:15.699167 140029595575744 estimator.py:1145] Calling model_fn.
E0811 23:27:16.394581 140029595575744 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:27:16.587285 140029595575744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:27:16.614428 140029595575744 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:27:16.635997 140029595575744 estimator.py:1147] Done calling model_fn.
I0811 23:27:16.653525 140029595575744 evaluation.py:255] Starting evaluation at 2019-08-11T23:27:16Z
I0811 23:27:16.653800 140029595575744 tpu_estimator.py:499] TPU job name worker
I0811 23:27:16.730571 140029595575744 monitored_session.py:240] Graph was finalized.
W0811 23:27:16.731344 140029595575744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:27:16.919238 140029595575744 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:27:19.558655 140029595575744 session_manager.py:500] Running local_init_op.
I0811 23:27:19.582444 140029595575744 session_manager.py:502] Done running local_init_op.
I0811 23:27:19.634541 140029595575744 tpu_estimator.py:557] Init TPU system
I0811 23:28:28.623003 140029595575744 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:28:28.623924 140028832360192 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:28:28.624567 140028348987136 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:28:28.697300 140029595575744 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:28:28.723273 140029595575744 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:28:28.723634 140029595575744 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:28:28.751514 140028340594432 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:28:28.861535 140028340594432 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 23:28:29.471478 140028348987136 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:28:29.945286 140029595575744 evaluation.py:167] Evaluation [10/10]
I0811 23:28:29.945667 140029595575744 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:28:29.945764 140029595575744 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:28:29.945960 140028832360192 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:28:29.946050 140028832360192 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:28:29.946197 140029595575744 error_handling.py:96] infeed marked as finished
I0811 23:28:29.946289 140029595575744 tpu_estimator.py:602] Stop output thread controller
I0811 23:28:29.946337 140029595575744 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:28:29.946451 140028348987136 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:28:29.946521 140028348987136 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:28:29.946630 140029595575744 error_handling.py:96] outfeed marked as finished
I0811 23:28:29.946713 140029595575744 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:28:58.947082 140029595575744 evaluation.py:275] Finished evaluation at 2019-08-11-23:28:58
I0811 23:28:58.947467 140029595575744 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9381, global_step = 30, loss = 0.23697218
I0811 23:29:03.374435 140029595575744 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:29:04.195796 140029595575744 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.23697218, 'global_step': 30, 'accuracy': 0.9381}

Removing gs://yangyou-mnist/log/graph.pbtxt#1565565949218227...
Removing gs://yangyou-mnist/log/checkpoint#1565566023533721...
Removing gs://yangyou-mnist/log/#1565565944438878...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565565957026576...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565565944.v3-8-tpu#1565566026826688...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565565956197370...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565566020436569...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565566021346981...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565565961665498...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565566025885883...
Removing gs://yangyou-mnist/log/eval/#1565566140636974...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565566140.v3-8-tpu#1565566143852571...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:29:08.123332 140490096522688 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:29:08.124094 140490096522688 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:29:08.126799 140490096522688 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:29:08.127600 140490096522688 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:29:08.128154 140490096522688 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:29:08.128278 140490096522688 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:29:08.557280 140490096522688 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:29:08.563210 140490096522688 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:29:08.566644 140490096522688 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:29:08.655244 140490096522688 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:29:08.655540 140490096522688 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:29:08.755019 140490096522688 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:29:08.791948 140490096522688 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:29:08.792234 140490096522688 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:29:08.903537 140490096522688 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc640759190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc642937190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:29:08.903887 140490096522688 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:29:09.263705 140490096522688 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:29:09.266873: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:29:09.284427 140490096522688 tpu_system_metadata.py:148] Found TPU system:
I0811 23:29:09.284672 140490096522688 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:29:09.285186 140490096522688 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:29:09.285244 140490096522688 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:29:09.285296 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:29:09.285636 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:29:09.285706 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:29:09.285758 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:29:09.285806 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:29:09.285856 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:29:09.285903 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:29:09.285949 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:29:09.285995 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:29:09.286041 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:29:09.286089 140490096522688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:29:09.292053 140490096522688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:29:09.304498 140490096522688 estimator.py:1145] Calling model_fn.
W0811 23:29:09.305102 140490096522688 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:29:09.572999 140490096522688 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:29:09.988722 140490096522688 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:29:10.048573 140490096522688 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:29:10.054626 140490096522688 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:29:10.232558 140490096522688 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:29:10.246639 140490096522688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:29:10.258202 140490096522688 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:29:10.258514 140490096522688 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:29:10.682405 140490096522688 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:29:10.697658 140490096522688 estimator.py:1147] Done calling model_fn.
I0811 23:29:14.041903 140490096522688 tpu_estimator.py:499] TPU job name worker
I0811 23:29:14.156419 140490096522688 monitored_session.py:240] Graph was finalized.
I0811 23:29:14.740813 140490096522688 session_manager.py:500] Running local_init_op.
I0811 23:29:14.780503 140490096522688 session_manager.py:502] Done running local_init_op.
I0811 23:29:17.267415 140490096522688 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:29:29.637672 140490096522688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:29:29.770770 140490096522688 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:29:29.771262 140490096522688 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:29:29.771652: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:29:29.776786 140490096522688 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:29:29.779401 140490096522688 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:29:29.782979 140490096522688 tpu_estimator.py:557] Init TPU system
I0811 23:30:12.667787 140490096522688 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:30:12.668884 140489404372736 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:30:12.669632 140489395980032 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:30:12.715760 140490096522688 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:30:12.716583 140490096522688 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:30:12.727916 140488917120768 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:30:12.960953 140488917120768 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:30:17.164490 140489395980032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:30:21.702138 140490096522688 basic_session_run_hooks.py:262] loss = 0.21931697, step = 30
I0811 23:30:21.705250 140490096522688 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:30:35.257181 140490096522688 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:30:35.257481 140490096522688 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:30:35.257827 140489404372736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:30:35.258131 140489404372736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:30:35.258322 140490096522688 error_handling.py:96] infeed marked as finished
I0811 23:30:35.258503 140490096522688 tpu_estimator.py:602] Stop output thread controller
I0811 23:30:35.258558 140490096522688 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:30:35.258708 140489395980032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:30:35.258847 140489395980032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:30:35.259067 140490096522688 error_handling.py:96] outfeed marked as finished
I0811 23:30:35.259285 140490096522688 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:30:43.094082 140490096522688 estimator.py:368] Loss for final step: 0.21931697.
I0811 23:30:43.094933 140490096522688 error_handling.py:96] training_loop marked as finished
I0811 23:30:43.906028 140490096522688 estimator.py:1145] Calling model_fn.
E0811 23:30:44.590583 140490096522688 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:30:44.781919 140490096522688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:30:44.809166 140490096522688 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:30:44.830041 140490096522688 estimator.py:1147] Done calling model_fn.
I0811 23:30:44.846496 140490096522688 evaluation.py:255] Starting evaluation at 2019-08-11T23:30:44Z
I0811 23:30:44.846729 140490096522688 tpu_estimator.py:499] TPU job name worker
I0811 23:30:44.920572 140490096522688 monitored_session.py:240] Graph was finalized.
W0811 23:30:44.921278 140490096522688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:30:45.110773 140490096522688 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:30:47.855593 140490096522688 session_manager.py:500] Running local_init_op.
I0811 23:30:47.879762 140490096522688 session_manager.py:502] Done running local_init_op.
I0811 23:30:47.927124 140490096522688 tpu_estimator.py:557] Init TPU system
I0811 23:31:56.625308 140490096522688 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:31:56.626465 140489400440576 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:31:56.627223 140488917120768 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:31:56.708240 140490096522688 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:31:56.736330 140490096522688 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:31:56.736696 140490096522688 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:31:56.810594 140488908728064 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:31:57.071959 140488908728064 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:31:57.483186 140488917120768 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:31:57.923042 140490096522688 evaluation.py:167] Evaluation [10/10]
I0811 23:31:57.923446 140490096522688 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:31:57.923531 140490096522688 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:31:57.923787 140489400440576 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:31:57.924102 140489400440576 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:31:57.924300 140490096522688 error_handling.py:96] infeed marked as finished
I0811 23:31:57.924544 140490096522688 tpu_estimator.py:602] Stop output thread controller
I0811 23:31:57.924598 140490096522688 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:31:57.924796 140488917120768 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:31:57.924979 140488917120768 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:31:57.925189 140490096522688 error_handling.py:96] outfeed marked as finished
I0811 23:31:57.925373 140490096522688 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:32:27.143385 140490096522688 evaluation.py:275] Finished evaluation at 2019-08-11-23:32:27
I0811 23:32:27.143726 140490096522688 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9439, global_step = 30, loss = 0.21113499
I0811 23:32:31.535162 140490096522688 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:32:32.376307 140490096522688 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.21113499, 'global_step': 30, 'accuracy': 0.9439}

Removing gs://yangyou-mnist/log/#1565566152182655...
Removing gs://yangyou-mnist/log/checkpoint#1565566231686704...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565566156713561...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565566169127514...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565566152.v3-8-tpu#1565566234923969...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565566228486103...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565566164674690...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565566229443232...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565566163767898...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565566234022774...
Removing gs://yangyou-mnist/log/eval/#1565566348885414...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565566349.v3-8-tpu#1565566352056587...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:32:36.207024 140516463969728 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:32:36.207842 140516463969728 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:32:36.210742 140516463969728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:32:36.211615 140516463969728 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:32:36.212243 140516463969728 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:32:36.212403 140516463969728 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:32:36.635634 140516463969728 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:32:36.642256 140516463969728 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:32:36.645896 140516463969728 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:32:36.693795 140516463969728 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:32:36.694077 140516463969728 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:32:36.788378 140516463969728 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:32:36.887480 140516463969728 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:32:36.887767 140516463969728 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:32:37.093481 140516463969728 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcc6414e210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcc6632c190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:32:37.093911 140516463969728 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:32:37.427515 140516463969728 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:32:37.430739: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:32:37.444020 140516463969728 tpu_system_metadata.py:148] Found TPU system:
I0811 23:32:37.444262 140516463969728 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:32:37.444783 140516463969728 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:32:37.444842 140516463969728 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:32:37.444911 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:32:37.445247 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:32:37.445307 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:32:37.445358 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:32:37.445409 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:32:37.445458 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:32:37.445507 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:32:37.445554 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:32:37.445646 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:32:37.445704 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:32:37.445754 140516463969728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:32:37.451757 140516463969728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:32:37.464364 140516463969728 estimator.py:1145] Calling model_fn.
W0811 23:32:37.464984 140516463969728 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:32:37.731704 140516463969728 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:32:38.262470 140516463969728 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:32:38.323692 140516463969728 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:32:38.329510 140516463969728 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:32:38.512012 140516463969728 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:32:38.525851 140516463969728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:32:38.537823 140516463969728 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:32:38.538161 140516463969728 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:32:38.956542 140516463969728 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:32:38.972100 140516463969728 estimator.py:1147] Done calling model_fn.
I0811 23:32:42.382977 140516463969728 tpu_estimator.py:499] TPU job name worker
I0811 23:32:42.498936 140516463969728 monitored_session.py:240] Graph was finalized.
I0811 23:32:43.101726 140516463969728 session_manager.py:500] Running local_init_op.
I0811 23:32:43.137892 140516463969728 session_manager.py:502] Done running local_init_op.
I0811 23:32:45.699275 140516463969728 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:32:57.861306 140516463969728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:32:57.982307 140516463969728 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:32:57.982777 140516463969728 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:32:57.983159: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:32:57.987936 140516463969728 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:32:57.990015 140516463969728 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:32:57.993807 140516463969728 tpu_estimator.py:557] Init TPU system
I0811 23:33:40.664416 140516463969728 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:33:40.665571 140515771819776 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:33:40.666297 140515290904320 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:33:40.713382 140516463969728 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:33:40.715775 140516463969728 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:33:40.723516 140515282511616 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:33:40.943238 140515282511616 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 23:33:45.307667 140515290904320 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:33:49.989074 140516463969728 basic_session_run_hooks.py:262] loss = 0.18931647, step = 30
I0811 23:33:49.991425 140516463969728 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:34:03.185699 140516463969728 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:34:03.186018 140516463969728 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:34:03.186207 140515771819776 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:34:03.186297 140515771819776 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:34:03.186434 140516463969728 error_handling.py:96] infeed marked as finished
I0811 23:34:03.186537 140516463969728 tpu_estimator.py:602] Stop output thread controller
I0811 23:34:03.186588 140516463969728 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:34:03.186701 140515290904320 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:34:03.186791 140515290904320 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:34:03.186907 140516463969728 error_handling.py:96] outfeed marked as finished
I0811 23:34:03.186999 140516463969728 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:34:11.080332 140516463969728 estimator.py:368] Loss for final step: 0.18931647.
I0811 23:34:11.081269 140516463969728 error_handling.py:96] training_loop marked as finished
I0811 23:34:11.884829 140516463969728 estimator.py:1145] Calling model_fn.
E0811 23:34:12.583733 140516463969728 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:34:12.785228 140516463969728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:34:12.814450 140516463969728 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:34:12.836848 140516463969728 estimator.py:1147] Done calling model_fn.
I0811 23:34:12.854901 140516463969728 evaluation.py:255] Starting evaluation at 2019-08-11T23:34:12Z
I0811 23:34:12.855146 140516463969728 tpu_estimator.py:499] TPU job name worker
I0811 23:34:12.928957 140516463969728 monitored_session.py:240] Graph was finalized.
W0811 23:34:12.929754 140516463969728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:34:13.115463 140516463969728 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:34:15.663631 140516463969728 session_manager.py:500] Running local_init_op.
I0811 23:34:15.707814 140516463969728 session_manager.py:502] Done running local_init_op.
I0811 23:34:15.759290 140516463969728 tpu_estimator.py:557] Init TPU system
I0811 23:35:24.588727 140516463969728 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:35:24.589567 140515290904320 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:35:24.590492 140515282511616 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:35:24.657643 140516463969728 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:35:24.703135 140516463969728 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:35:24.703509 140516463969728 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:35:24.714483 140515274118912 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:35:24.819116 140515274118912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:35:25.470144 140515282511616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:35:25.804478 140516463969728 evaluation.py:167] Evaluation [10/10]
I0811 23:35:25.804842 140516463969728 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:35:25.804925 140516463969728 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:35:25.805157 140515290904320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:35:25.805458 140515290904320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:35:25.805752 140516463969728 error_handling.py:96] infeed marked as finished
I0811 23:35:25.805969 140516463969728 tpu_estimator.py:602] Stop output thread controller
I0811 23:35:25.806035 140516463969728 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:35:25.806276 140515282511616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:35:25.806452 140515282511616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:35:25.806643 140516463969728 error_handling.py:96] outfeed marked as finished
I0811 23:35:25.806818 140516463969728 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:35:54.920921 140516463969728 evaluation.py:275] Finished evaluation at 2019-08-11-23:35:54
I0811 23:35:54.921294 140516463969728 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9471, global_step = 30, loss = 0.19103533
I0811 23:35:59.208667 140516463969728 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:36:00.068222 140516463969728 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.19103533, 'global_step': 30, 'accuracy': 0.9471}

Removing gs://yangyou-mnist/log/#1565566360439228...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565566372814083...
Removing gs://yangyou-mnist/log/checkpoint#1565566439759233...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565566377302702...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565566360.v3-8-tpu#1565566442859507...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565566365150122...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565566371946469...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565566436737315...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565566437632609...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565566441895590...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565566556601308...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565566556.v3-8-tpu#1565566559743848...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:36:03.836694 140262910076352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:36:03.837488 140262910076352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:36:03.840195 140262910076352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:36:03.841017 140262910076352 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:36:03.841638 140262910076352 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:36:03.841774 140262910076352 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:36:04.238575 140262910076352 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:36:04.246392 140262910076352 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:36:04.250848 140262910076352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:36:04.341217 140262910076352 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:36:04.341492 140262910076352 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:36:04.508891 140262910076352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:36:04.600445 140262910076352 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:36:04.600730 140262910076352 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:36:04.728785 140262910076352 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f915b178150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f915d356190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:36:04.729140 140262910076352 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:36:05.075866 140262910076352 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:36:05.079063: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:36:05.092504 140262910076352 tpu_system_metadata.py:148] Found TPU system:
I0811 23:36:05.092768 140262910076352 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:36:05.093286 140262910076352 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:36:05.093343 140262910076352 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:36:05.093396 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:36:05.093777 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:36:05.093841 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:36:05.093908 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:36:05.093957 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:36:05.094005 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:36:05.094052 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:36:05.094098 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:36:05.094142 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:36:05.094192 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:36:05.094239 140262910076352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:36:05.100653 140262910076352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:36:05.113688 140262910076352 estimator.py:1145] Calling model_fn.
W0811 23:36:05.114336 140262910076352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:36:05.392221 140262910076352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:36:05.824433 140262910076352 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:36:05.886193 140262910076352 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:36:05.892330 140262910076352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:36:06.073367 140262910076352 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:36:06.087491 140262910076352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:36:06.099642 140262910076352 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:36:06.099973 140262910076352 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:36:06.544842 140262910076352 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:36:06.560928 140262910076352 estimator.py:1147] Done calling model_fn.
I0811 23:36:10.098701 140262910076352 tpu_estimator.py:499] TPU job name worker
I0811 23:36:10.212179 140262910076352 monitored_session.py:240] Graph was finalized.
I0811 23:36:10.787655 140262910076352 session_manager.py:500] Running local_init_op.
I0811 23:36:10.818195 140262910076352 session_manager.py:502] Done running local_init_op.
I0811 23:36:13.358330 140262910076352 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:36:25.848180 140262910076352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:36:25.968647 140262910076352 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:36:25.969096 140262910076352 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:36:25.969527: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:36:25.973908 140262910076352 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:36:25.975981 140262910076352 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:36:25.980345 140262910076352 tpu_estimator.py:557] Init TPU system
I0811 23:37:08.671983 140262910076352 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:37:08.673038 140261879441152 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:37:08.673794 140261871048448 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:37:08.724056 140262910076352 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:37:08.724946 140262910076352 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:37:08.773410 140261862655744 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:37:08.971457 140261862655744 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:37:13.265506 140261871048448 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:37:17.785135 140262910076352 basic_session_run_hooks.py:262] loss = 0.11330742, step = 30
I0811 23:37:17.787753 140262910076352 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:37:31.192228 140262910076352 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:37:31.192513 140262910076352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:37:31.192877 140261879441152 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:37:31.193175 140261879441152 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:37:31.193505 140262910076352 error_handling.py:96] infeed marked as finished
I0811 23:37:31.193811 140262910076352 tpu_estimator.py:602] Stop output thread controller
I0811 23:37:31.193886 140262910076352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:37:31.194113 140261871048448 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:37:31.194293 140261871048448 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:37:31.194483 140262910076352 error_handling.py:96] outfeed marked as finished
I0811 23:37:31.194649 140262910076352 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:37:39.105366 140262910076352 estimator.py:368] Loss for final step: 0.11330742.
I0811 23:37:39.106379 140262910076352 error_handling.py:96] training_loop marked as finished
I0811 23:37:39.888422 140262910076352 estimator.py:1145] Calling model_fn.
E0811 23:37:40.566231 140262910076352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:37:40.758140 140262910076352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:37:40.785783 140262910076352 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:37:40.806457 140262910076352 estimator.py:1147] Done calling model_fn.
I0811 23:37:40.823163 140262910076352 evaluation.py:255] Starting evaluation at 2019-08-11T23:37:40Z
I0811 23:37:40.823396 140262910076352 tpu_estimator.py:499] TPU job name worker
I0811 23:37:40.896703 140262910076352 monitored_session.py:240] Graph was finalized.
W0811 23:37:40.897427 140262910076352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:37:41.130758 140262910076352 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:37:43.686747 140262910076352 session_manager.py:500] Running local_init_op.
I0811 23:37:43.714055 140262910076352 session_manager.py:502] Done running local_init_op.
I0811 23:37:43.767972 140262910076352 tpu_estimator.py:557] Init TPU system
I0811 23:38:52.602433 140262910076352 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:38:52.603338 140261878130432 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:38:52.604078 140261869737728 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:38:52.669956 140262910076352 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:38:52.700757 140262910076352 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:38:52.701147 140262910076352 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:38:52.722738 140261861345024 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:38:52.829262 140261861345024 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:38:53.464818 140261869737728 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:38:53.822403 140262910076352 evaluation.py:167] Evaluation [10/10]
I0811 23:38:53.822751 140262910076352 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:38:53.822823 140262910076352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:38:53.822993 140261878130432 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:38:53.823091 140261878130432 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:38:53.823224 140262910076352 error_handling.py:96] infeed marked as finished
I0811 23:38:53.823324 140262910076352 tpu_estimator.py:602] Stop output thread controller
I0811 23:38:53.823374 140262910076352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:38:53.823483 140261869737728 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:38:53.823587 140261869737728 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:38:53.823765 140262910076352 error_handling.py:96] outfeed marked as finished
I0811 23:38:53.823857 140262910076352 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:39:22.926704 140262910076352 evaluation.py:275] Finished evaluation at 2019-08-11-23:39:22
I0811 23:39:22.927042 140262910076352 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9697, global_step = 30, loss = 0.11110959
I0811 23:39:27.373917 140262910076352 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:39:28.173206 140262910076352 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.11110959, 'global_step': 30, 'accuracy': 0.9697}

Removing gs://yangyou-mnist/log/#1565566568222090...
Removing gs://yangyou-mnist/log/checkpoint#1565566647681589...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565566568.v3-8-tpu#1565566650844641...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565566580559397...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565566572807479...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565566579736826...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565566585331919...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565566644682728...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565566645613185...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565566649901800...
Removing gs://yangyou-mnist/log/eval/#1565566764710314...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565566764.v3-8-tpu#1565566767851319...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:39:31.899898 140666765297088 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:39:31.900650 140666765297088 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:39:31.903162 140666765297088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:39:31.903942 140666765297088 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:39:31.904504 140666765297088 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:39:31.904628 140666765297088 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:39:32.305658 140666765297088 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:39:32.312314 140666765297088 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:39:32.315987 140666765297088 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:39:32.409620 140666765297088 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:39:32.409914 140666765297088 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:39:32.518023 140666765297088 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:39:32.562345 140666765297088 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:39:32.562634 140666765297088 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:39:32.667097 140666765297088 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fef62bd2250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fef64db0190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:39:32.667468 140666765297088 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:39:32.992976 140666765297088 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:39:32.995880: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:39:33.007508 140666765297088 tpu_system_metadata.py:148] Found TPU system:
I0811 23:39:33.007745 140666765297088 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:39:33.008232 140666765297088 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:39:33.008295 140666765297088 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:39:33.008347 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:39:33.008671 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:39:33.008728 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:39:33.008780 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:39:33.008843 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:39:33.008893 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:39:33.008939 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:39:33.008985 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:39:33.009087 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:39:33.009135 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:39:33.009183 140666765297088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:39:33.015090 140666765297088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:39:33.027793 140666765297088 estimator.py:1145] Calling model_fn.
W0811 23:39:33.028423 140666765297088 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:39:33.293193 140666765297088 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:39:33.998171 140666765297088 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:39:34.058600 140666765297088 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:39:34.064523 140666765297088 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:39:34.240139 140666765297088 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:39:34.253460 140666765297088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:39:34.265331 140666765297088 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:39:34.265690 140666765297088 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:39:34.687311 140666765297088 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:39:34.702586 140666765297088 estimator.py:1147] Done calling model_fn.
I0811 23:39:38.123498 140666765297088 tpu_estimator.py:499] TPU job name worker
I0811 23:39:38.248140 140666765297088 monitored_session.py:240] Graph was finalized.
I0811 23:39:38.810834 140666765297088 session_manager.py:500] Running local_init_op.
I0811 23:39:38.842439 140666765297088 session_manager.py:502] Done running local_init_op.
I0811 23:39:41.300594 140666765297088 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:39:53.740919 140666765297088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:39:53.859841 140666765297088 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:39:53.860375 140666765297088 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:39:53.860755: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:39:53.865276 140666765297088 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:39:53.867336 140666765297088 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:39:53.871836 140666765297088 tpu_estimator.py:557] Init TPU system
I0811 23:40:36.679570 140666765297088 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:40:36.680464 140665866409728 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:40:36.681015 140665858017024 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:40:36.724518 140666765297088 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:40:36.725409 140666765297088 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:40:36.736557 140665849624320 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:40:36.839494 140665849624320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:40:41.186466 140665858017024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:40:45.800476 140666765297088 basic_session_run_hooks.py:262] loss = 0.096150264, step = 30
I0811 23:40:45.803097 140666765297088 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:40:58.746097 140666765297088 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:40:58.746408 140666765297088 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:40:58.746706 140665866409728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:40:58.747033 140665866409728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:40:58.747292 140666765297088 error_handling.py:96] infeed marked as finished
I0811 23:40:58.747540 140666765297088 tpu_estimator.py:602] Stop output thread controller
I0811 23:40:58.747598 140666765297088 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:40:58.747802 140665858017024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:40:58.747997 140665858017024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:40:58.748307 140666765297088 error_handling.py:96] outfeed marked as finished
I0811 23:40:58.748491 140666765297088 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:41:06.973864 140666765297088 estimator.py:368] Loss for final step: 0.096150264.
I0811 23:41:06.974684 140666765297088 error_handling.py:96] training_loop marked as finished
I0811 23:41:07.757452 140666765297088 estimator.py:1145] Calling model_fn.
E0811 23:41:08.461927 140666765297088 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:41:08.653979 140666765297088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:41:08.681384 140666765297088 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:41:08.702675 140666765297088 estimator.py:1147] Done calling model_fn.
I0811 23:41:08.719420 140666765297088 evaluation.py:255] Starting evaluation at 2019-08-11T23:41:08Z
I0811 23:41:08.719652 140666765297088 tpu_estimator.py:499] TPU job name worker
I0811 23:41:08.795013 140666765297088 monitored_session.py:240] Graph was finalized.
W0811 23:41:08.795720 140666765297088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:41:08.982925 140666765297088 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:41:11.612668 140666765297088 session_manager.py:500] Running local_init_op.
I0811 23:41:11.635787 140666765297088 session_manager.py:502] Done running local_init_op.
I0811 23:41:11.699887 140666765297088 tpu_estimator.py:557] Init TPU system
I0811 23:42:20.632883 140666765297088 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:42:20.634124 140665866409728 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:42:20.634927 140665858017024 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:42:20.720204 140666765297088 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:42:20.749356 140666765297088 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:42:20.749753 140666765297088 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:42:20.773771 140665849624320 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:42:20.883327 140665849624320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:42:21.495136 140665858017024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:42:21.814982 140666765297088 evaluation.py:167] Evaluation [10/10]
I0811 23:42:21.815324 140666765297088 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:42:21.815397 140666765297088 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:42:21.815635 140665866409728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:42:21.815908 140665866409728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:42:21.816090 140666765297088 error_handling.py:96] infeed marked as finished
I0811 23:42:21.816251 140666765297088 tpu_estimator.py:602] Stop output thread controller
I0811 23:42:21.816306 140666765297088 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:42:21.816471 140665858017024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:42:21.816607 140665858017024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:42:21.816744 140666765297088 error_handling.py:96] outfeed marked as finished
I0811 23:42:21.816869 140666765297088 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:42:50.969444 140666765297088 evaluation.py:275] Finished evaluation at 2019-08-11-23:42:50
I0811 23:42:50.969824 140666765297088 estimator.py:2039] Saving dict for global step 30: accuracy = 0.976, global_step = 30, loss = 0.07973706
I0811 23:42:55.176692 140666765297088 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:42:55.963692 140666765297088 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07973706, 'global_step': 30, 'accuracy': 0.976}

Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565566793241152...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565566788820485...
Removing gs://yangyou-mnist/log/#1565566776287647...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565566852315170...
Removing gs://yangyou-mnist/log/checkpoint#1565566855366549...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565566780767445...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565566776.v3-8-tpu#1565566858420785...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565566787953968...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565566853188045...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565566857476125...
Removing gs://yangyou-mnist/log/eval/#1565566972643793...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565566972.v3-8-tpu#1565566975612761...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:42:59.734852 140480384394688 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:42:59.735635 140480384394688 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:42:59.738234 140480384394688 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:42:59.739088 140480384394688 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:42:59.739661 140480384394688 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:42:59.739795 140480384394688 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:43:00.154922 140480384394688 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:43:00.161617 140480384394688 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:43:00.165262 140480384394688 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:43:00.211597 140480384394688 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:43:00.211889 140480384394688 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:43:00.358530 140480384394688 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:43:00.400077 140480384394688 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:43:00.400388 140480384394688 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:43:00.504565 140480384394688 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc3fd924090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc3ffb02190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:43:00.504945 140480384394688 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:43:00.918732 140480384394688 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:43:00.921576: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:43:00.935302 140480384394688 tpu_system_metadata.py:148] Found TPU system:
I0811 23:43:00.935547 140480384394688 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:43:00.936096 140480384394688 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:43:00.936178 140480384394688 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:43:00.936239 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:43:00.936660 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:43:00.936719 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:43:00.936774 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:43:00.936830 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:43:00.936883 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:43:00.936948 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:43:00.936997 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:43:00.937045 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:43:00.937093 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:43:00.937141 140480384394688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:43:00.943070 140480384394688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:43:00.955161 140480384394688 estimator.py:1145] Calling model_fn.
W0811 23:43:00.955748 140480384394688 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:43:01.233057 140480384394688 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:43:01.721864 140480384394688 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:43:01.783020 140480384394688 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:43:01.788744 140480384394688 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:43:01.964529 140480384394688 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:43:01.977708 140480384394688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:43:01.989128 140480384394688 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:43:01.989425 140480384394688 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:43:02.421773 140480384394688 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:43:02.437280 140480384394688 estimator.py:1147] Done calling model_fn.
I0811 23:43:05.760977 140480384394688 tpu_estimator.py:499] TPU job name worker
I0811 23:43:05.875349 140480384394688 monitored_session.py:240] Graph was finalized.
I0811 23:43:06.442348 140480384394688 session_manager.py:500] Running local_init_op.
I0811 23:43:06.483369 140480384394688 session_manager.py:502] Done running local_init_op.
I0811 23:43:08.947022 140480384394688 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:43:21.462214 140480384394688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:43:21.578058 140480384394688 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:43:21.578556 140480384394688 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:43:21.578979: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:43:21.583770 140480384394688 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:43:21.585880 140480384394688 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:43:21.589399 140480384394688 tpu_estimator.py:557] Init TPU system
I0811 23:44:04.684165 140480384394688 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0811 23:44:04.685336 140479490672384 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:44:04.686361 140479482279680 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:44:04.733351 140480384394688 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:44:04.734853 140480384394688 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:44:04.744465 140479473886976 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:44:04.829525 140479473886976 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:44:09.230281 140479482279680 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:44:13.778942 140480384394688 basic_session_run_hooks.py:262] loss = 0.09924202, step = 30
I0811 23:44:13.780787 140480384394688 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:44:27.352250 140480384394688 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:44:27.352552 140480384394688 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:44:27.352881 140479490672384 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:44:27.353176 140479490672384 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:44:27.353380 140480384394688 error_handling.py:96] infeed marked as finished
I0811 23:44:27.353647 140480384394688 tpu_estimator.py:602] Stop output thread controller
I0811 23:44:27.353717 140480384394688 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:44:27.353908 140479482279680 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:44:27.354098 140479482279680 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:44:27.354326 140480384394688 error_handling.py:96] outfeed marked as finished
I0811 23:44:27.354475 140480384394688 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:44:34.963835 140480384394688 estimator.py:368] Loss for final step: 0.09924202.
I0811 23:44:34.964607 140480384394688 error_handling.py:96] training_loop marked as finished
I0811 23:44:35.670861 140480384394688 estimator.py:1145] Calling model_fn.
E0811 23:44:36.408802 140480384394688 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:44:36.608011 140480384394688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:44:36.636059 140480384394688 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:44:36.658229 140480384394688 estimator.py:1147] Done calling model_fn.
I0811 23:44:36.675831 140480384394688 evaluation.py:255] Starting evaluation at 2019-08-11T23:44:36Z
I0811 23:44:36.676079 140480384394688 tpu_estimator.py:499] TPU job name worker
I0811 23:44:36.752537 140480384394688 monitored_session.py:240] Graph was finalized.
W0811 23:44:36.753321 140480384394688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:44:36.984322 140480384394688 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:44:39.450499 140480384394688 session_manager.py:500] Running local_init_op.
I0811 23:44:39.478869 140480384394688 session_manager.py:502] Done running local_init_op.
I0811 23:44:39.527409 140480384394688 tpu_estimator.py:557] Init TPU system
I0811 23:45:48.641201 140480384394688 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 23:45:48.642317 140479486740224 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:45:48.643235 140479478347520 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:45:48.748470 140480384394688 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:45:48.776437 140480384394688 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:45:48.776810 140480384394688 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:45:48.803894 140479465232128 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:45:49.034528 140479465232128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:45:49.518322 140479478347520 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:45:50.030839 140480384394688 evaluation.py:167] Evaluation [10/10]
I0811 23:45:50.031181 140480384394688 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:45:50.031254 140480384394688 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:45:50.031512 140479486740224 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:45:50.031807 140479486740224 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:45:50.031991 140480384394688 error_handling.py:96] infeed marked as finished
I0811 23:45:50.032170 140480384394688 tpu_estimator.py:602] Stop output thread controller
I0811 23:45:50.032223 140480384394688 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:45:50.032372 140479478347520 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:45:50.032526 140479478347520 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:45:50.032792 140480384394688 error_handling.py:96] outfeed marked as finished
I0811 23:45:50.032923 140480384394688 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:46:19.128391 140480384394688 evaluation.py:275] Finished evaluation at 2019-08-11-23:46:19
I0811 23:46:19.128741 140480384394688 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9777, global_step = 30, loss = 0.08375322
I0811 23:46:23.514468 140480384394688 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:46:24.406053 140480384394688 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08375322, 'global_step': 30, 'accuracy': 0.9777}

Removing gs://yangyou-mnist/log/#1565566983870323...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565566996316061...
Removing gs://yangyou-mnist/log/checkpoint#1565567063790203...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565567000934677...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565566984.v3-8-tpu#1565567067028461...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565567060687108...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565567061588881...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565566988400500...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565566995460480...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565567066031888...
Removing gs://yangyou-mnist/log/eval/#1565567180836733...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565567181.v3-8-tpu#1565567184046082...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:46:28.112664 140401891132864 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:46:28.113442 140401891132864 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:46:28.116121 140401891132864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:46:28.116934 140401891132864 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:46:28.117492 140401891132864 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:46:28.117645 140401891132864 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:46:28.542372 140401891132864 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:46:28.549982 140401891132864 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:46:28.553971 140401891132864 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:46:28.601990 140401891132864 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:46:28.602313 140401891132864 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:46:28.823719 140401891132864 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:46:28.912348 140401891132864 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:46:28.912625 140401891132864 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:46:28.995294 140401891132864 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb1b7022050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb1b9200190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:46:28.995657 140401891132864 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:46:29.322073 140401891132864 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:46:29.324938: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:46:29.337430 140401891132864 tpu_system_metadata.py:148] Found TPU system:
I0811 23:46:29.337726 140401891132864 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:46:29.338299 140401891132864 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:46:29.338357 140401891132864 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:46:29.338412 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:46:29.338690 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:46:29.338747 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:46:29.338809 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:46:29.338857 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:46:29.338906 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:46:29.338953 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:46:29.339031 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:46:29.339081 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:46:29.339127 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:46:29.339174 140401891132864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:46:29.345135 140401891132864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:46:29.357089 140401891132864 estimator.py:1145] Calling model_fn.
W0811 23:46:29.357708 140401891132864 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:46:29.628104 140401891132864 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:46:31.131992 140401891132864 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:46:31.192323 140401891132864 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:46:31.198369 140401891132864 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:46:31.372292 140401891132864 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:46:31.385828 140401891132864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:46:31.397746 140401891132864 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:46:31.398065 140401891132864 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:46:31.800112 140401891132864 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:46:31.815373 140401891132864 estimator.py:1147] Done calling model_fn.
I0811 23:46:35.225600 140401891132864 tpu_estimator.py:499] TPU job name worker
I0811 23:46:35.338062 140401891132864 monitored_session.py:240] Graph was finalized.
I0811 23:46:36.595503 140401891132864 session_manager.py:500] Running local_init_op.
I0811 23:46:36.627790 140401891132864 session_manager.py:502] Done running local_init_op.
I0811 23:46:40.838975 140401891132864 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:46:53.356949 140401891132864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:46:53.462601 140401891132864 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:46:53.463093 140401891132864 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:46:53.463488: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:46:53.469234 140401891132864 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:46:53.471406 140401891132864 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:46:53.475375 140401891132864 tpu_estimator.py:557] Init TPU system
I0811 23:47:32.698225 140401891132864 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0811 23:47:32.699201 140400861898496 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:47:32.699717 140400853505792 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:47:32.749939 140401891132864 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:47:32.755846 140401891132864 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:47:32.762551 140400845113088 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:47:32.982414 140400845113088 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0811 23:47:37.474349 140400853505792 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:47:42.103877 140401891132864 basic_session_run_hooks.py:262] loss = 0.103513725, step = 30
I0811 23:47:42.106818 140401891132864 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:47:55.333070 140401891132864 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:47:55.333380 140401891132864 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:47:55.333781 140400861898496 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:47:55.334187 140400861898496 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:47:55.334415 140401891132864 error_handling.py:96] infeed marked as finished
I0811 23:47:55.334647 140401891132864 tpu_estimator.py:602] Stop output thread controller
I0811 23:47:55.334757 140401891132864 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:47:55.334968 140400853505792 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:47:55.335216 140400853505792 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:47:55.335448 140401891132864 error_handling.py:96] outfeed marked as finished
I0811 23:47:55.335627 140401891132864 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:48:03.123404 140401891132864 estimator.py:368] Loss for final step: 0.103513725.
I0811 23:48:03.124188 140401891132864 error_handling.py:96] training_loop marked as finished
I0811 23:48:03.933161 140401891132864 estimator.py:1145] Calling model_fn.
E0811 23:48:04.633208 140401891132864 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:48:04.829237 140401891132864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:48:04.856898 140401891132864 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:48:04.878921 140401891132864 estimator.py:1147] Done calling model_fn.
I0811 23:48:04.896565 140401891132864 evaluation.py:255] Starting evaluation at 2019-08-11T23:48:04Z
I0811 23:48:04.896799 140401891132864 tpu_estimator.py:499] TPU job name worker
I0811 23:48:04.971668 140401891132864 monitored_session.py:240] Graph was finalized.
W0811 23:48:04.972451 140401891132864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:48:05.158541 140401891132864 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:48:07.767807 140401891132864 session_manager.py:500] Running local_init_op.
I0811 23:48:07.796842 140401891132864 session_manager.py:502] Done running local_init_op.
I0811 23:48:07.847443 140401891132864 tpu_estimator.py:557] Init TPU system
I0811 23:49:16.642832 140401891132864 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:49:16.643742 140400859014912 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:49:16.644515 140400850622208 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:49:16.718210 140401891132864 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:49:16.746268 140401891132864 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:49:16.746623 140401891132864 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:49:16.775332 140400842229504 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:49:17.001086 140400842229504 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:49:17.502470 140400850622208 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:49:17.832098 140401891132864 evaluation.py:167] Evaluation [10/10]
I0811 23:49:17.832441 140401891132864 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:49:17.832521 140401891132864 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:49:17.832783 140400859014912 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:49:17.833074 140400859014912 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:49:17.833251 140401891132864 error_handling.py:96] infeed marked as finished
I0811 23:49:17.833405 140401891132864 tpu_estimator.py:602] Stop output thread controller
I0811 23:49:17.833465 140401891132864 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:49:17.833822 140400850622208 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:49:17.833998 140400850622208 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:49:17.834181 140401891132864 error_handling.py:96] outfeed marked as finished
I0811 23:49:17.834311 140401891132864 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:49:47.099153 140401891132864 evaluation.py:275] Finished evaluation at 2019-08-11-23:49:47
I0811 23:49:47.099569 140401891132864 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9738, global_step = 30, loss = 0.09300649
I0811 23:49:51.481966 140401891132864 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:49:52.290700 140401891132864 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09300649, 'global_step': 30, 'accuracy': 0.9738}

Removing gs://yangyou-mnist/log/checkpoint#1565567271859488...
Removing gs://yangyou-mnist/log/#1565567193268620...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565567208318025...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565567269685020...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565567212861718...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565567268776123...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565567193.v3-8-tpu#1565567275007518...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565567198612766...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565567207486789...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565567274002763...
Removing gs://yangyou-mnist/log/eval/#1565567388758342...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565567388.v3-8-tpu#1565567391962428...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:49:56.074729 140353530004928 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:49:56.075510 140353530004928 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:49:56.078129 140353530004928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:49:56.078929 140353530004928 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:49:56.079514 140353530004928 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:49:56.079642 140353530004928 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:49:56.504400 140353530004928 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:49:56.511519 140353530004928 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:49:56.515326 140353530004928 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:49:56.609286 140353530004928 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:49:56.609606 140353530004928 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:49:56.902374 140353530004928 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:49:56.951004 140353530004928 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:49:56.951294 140353530004928 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:49:57.065397 140353530004928 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa674747550>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa67693c190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:49:57.065808 140353530004928 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:49:57.394644 140353530004928 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:49:57.397755: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:49:57.409579 140353530004928 tpu_system_metadata.py:148] Found TPU system:
I0811 23:49:57.409866 140353530004928 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:49:57.410386 140353530004928 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:49:57.410444 140353530004928 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:49:57.410501 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:49:57.410789 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:49:57.410845 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:49:57.410895 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:49:57.410943 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:49:57.411000 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:49:57.411047 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:49:57.411094 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:49:57.411142 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:49:57.411216 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:49:57.411267 140353530004928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:49:57.417212 140353530004928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:49:57.429558 140353530004928 estimator.py:1145] Calling model_fn.
W0811 23:49:57.430202 140353530004928 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:49:57.713288 140353530004928 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:49:58.135541 140353530004928 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:49:58.196350 140353530004928 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:49:58.202358 140353530004928 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:49:58.385380 140353530004928 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:49:58.399499 140353530004928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:49:58.411540 140353530004928 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:49:58.411844 140353530004928 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:49:58.839175 140353530004928 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:49:58.854593 140353530004928 estimator.py:1147] Done calling model_fn.
I0811 23:50:02.246488 140353530004928 tpu_estimator.py:499] TPU job name worker
I0811 23:50:02.359848 140353530004928 monitored_session.py:240] Graph was finalized.
I0811 23:50:02.954818 140353530004928 session_manager.py:500] Running local_init_op.
I0811 23:50:02.996889 140353530004928 session_manager.py:502] Done running local_init_op.
I0811 23:50:05.510891 140353530004928 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:50:17.883225 140353530004928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:50:18.001032 140353530004928 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:50:18.001497 140353530004928 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:50:18.001959: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:50:18.006695 140353530004928 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:50:18.008718 140353530004928 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:50:18.012371 140353530004928 tpu_estimator.py:557] Init TPU system
I0811 23:51:00.673717 140353530004928 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:51:00.675112 140352837854976 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:51:00.675915 140352829462272 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:51:00.723258 140353530004928 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:51:00.724180 140353530004928 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:51:00.734868 140352350582528 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:51:00.875714 140352350582528 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:51:05.288934 140352829462272 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:51:09.870388 140353530004928 basic_session_run_hooks.py:262] loss = 0.21585476, step = 30
I0811 23:51:09.873080 140353530004928 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:51:23.836561 140353530004928 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:51:23.836842 140353530004928 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:51:23.837162 140352837854976 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:51:23.837469 140352837854976 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:51:23.837706 140353530004928 error_handling.py:96] infeed marked as finished
I0811 23:51:23.837907 140353530004928 tpu_estimator.py:602] Stop output thread controller
I0811 23:51:23.837980 140353530004928 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:51:23.838243 140352829462272 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:51:23.838433 140352829462272 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:51:23.838618 140353530004928 error_handling.py:96] outfeed marked as finished
I0811 23:51:23.838785 140353530004928 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:51:31.013071 140353530004928 estimator.py:368] Loss for final step: 0.21585476.
I0811 23:51:31.013899 140353530004928 error_handling.py:96] training_loop marked as finished
I0811 23:51:31.839576 140353530004928 estimator.py:1145] Calling model_fn.
E0811 23:51:32.561506 140353530004928 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:51:32.753073 140353530004928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:51:32.780597 140353530004928 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:51:32.801810 140353530004928 estimator.py:1147] Done calling model_fn.
I0811 23:51:32.818629 140353530004928 evaluation.py:255] Starting evaluation at 2019-08-11T23:51:32Z
I0811 23:51:32.818861 140353530004928 tpu_estimator.py:499] TPU job name worker
I0811 23:51:32.892927 140353530004928 monitored_session.py:240] Graph was finalized.
W0811 23:51:32.893688 140353530004928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:51:33.079291 140353530004928 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:51:36.018218 140353530004928 session_manager.py:500] Running local_init_op.
I0811 23:51:36.041405 140353530004928 session_manager.py:502] Done running local_init_op.
I0811 23:51:36.087233 140353530004928 tpu_estimator.py:557] Init TPU system
I0811 23:52:44.576150 140353530004928 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:52:44.577056 140352833922816 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:52:44.577755 140352350582528 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:52:44.644803 140353530004928 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:52:44.667972 140353530004928 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:52:44.668330 140353530004928 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:52:44.740782 140352342189824 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:52:44.842253 140352342189824 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:52:45.420576 140352350582528 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:52:45.738627 140353530004928 evaluation.py:167] Evaluation [10/10]
I0811 23:52:45.739020 140353530004928 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:52:45.739094 140353530004928 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:52:45.739324 140352833922816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:52:45.739573 140352833922816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:52:45.739845 140353530004928 error_handling.py:96] infeed marked as finished
I0811 23:52:45.740046 140353530004928 tpu_estimator.py:602] Stop output thread controller
I0811 23:52:45.740108 140353530004928 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:52:45.740261 140352350582528 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:52:45.740396 140352350582528 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:52:45.740577 140353530004928 error_handling.py:96] outfeed marked as finished
I0811 23:52:45.740705 140353530004928 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:53:14.924046 140353530004928 evaluation.py:275] Finished evaluation at 2019-08-11-23:53:14
I0811 23:53:14.924366 140353530004928 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9505, global_step = 30, loss = 0.1667773
I0811 23:53:19.260725 140353530004928 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:53:20.067943 140353530004928 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.1667773, 'global_step': 30, 'accuracy': 0.9505}

Removing gs://yangyou-mnist/log/#1565567400334228...
Removing gs://yangyou-mnist/log/checkpoint#1565567480290872...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565567400.v3-8-tpu#1565567483506700...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565567404960953...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565567412131056...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565567413043304...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565567417382508...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565567477090144...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565567478057626...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565567482586591...
Removing gs://yangyou-mnist/log/eval/#1565567596705774...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565567596.v3-8-tpu#1565567599739832...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:53:23.798441 140003876140480 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:53:23.799300 140003876140480 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:53:23.802217 140003876140480 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:53:23.803098 140003876140480 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:53:23.803740 140003876140480 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:53:23.803881 140003876140480 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:53:24.225977 140003876140480 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:53:24.232750 140003876140480 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:53:24.237070 140003876140480 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:53:24.286346 140003876140480 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:53:24.286644 140003876140480 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:53:24.393717 140003876140480 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:53:24.439977 140003876140480 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:53:24.440280 140003876140480 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:53:24.520970 140003876140480 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f550b775150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f550d953190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:53:24.521358 140003876140480 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:53:24.856622 140003876140480 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:53:24.859510: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:53:24.871253 140003876140480 tpu_system_metadata.py:148] Found TPU system:
I0811 23:53:24.871479 140003876140480 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:53:24.871989 140003876140480 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:53:24.872045 140003876140480 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:53:24.872100 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:53:24.872390 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:53:24.872447 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:53:24.872498 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:53:24.872546 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:53:24.872594 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:53:24.872643 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:53:24.872690 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:53:24.872736 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:53:24.872783 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:53:24.872831 140003876140480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:53:24.878899 140003876140480 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:53:24.891597 140003876140480 estimator.py:1145] Calling model_fn.
W0811 23:53:24.892214 140003876140480 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:53:25.167826 140003876140480 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:53:25.702577 140003876140480 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:53:25.764775 140003876140480 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:53:25.770771 140003876140480 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:53:25.949795 140003876140480 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:53:25.963776 140003876140480 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:53:25.975722 140003876140480 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:53:25.976028 140003876140480 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:53:26.403361 140003876140480 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:53:26.418873 140003876140480 estimator.py:1147] Done calling model_fn.
I0811 23:53:29.790847 140003876140480 tpu_estimator.py:499] TPU job name worker
I0811 23:53:29.903768 140003876140480 monitored_session.py:240] Graph was finalized.
I0811 23:53:30.469762 140003876140480 session_manager.py:500] Running local_init_op.
I0811 23:53:30.501138 140003876140480 session_manager.py:502] Done running local_init_op.
I0811 23:53:32.939133 140003876140480 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:53:45.576077 140003876140480 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:53:45.682260 140003876140480 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:53:45.682712 140003876140480 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:53:45.683171: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:53:45.687617 140003876140480 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:53:45.689719 140003876140480 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:53:45.693758 140003876140480 tpu_estimator.py:557] Init TPU system
I0811 23:54:28.660435 140003876140480 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:54:28.661607 140002839226112 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:54:28.662452 140002830833408 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:54:28.707777 140003876140480 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:54:28.708718 140003876140480 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:54:28.719736 140002822440704 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:54:28.869827 140002822440704 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:54:33.230576 140002830833408 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:54:37.702987 140003876140480 basic_session_run_hooks.py:262] loss = 2.3021882, step = 30
I0811 23:54:37.704992 140003876140480 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:54:51.400751 140003876140480 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:54:51.401031 140003876140480 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:54:51.401333 140002839226112 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:54:51.401906 140002839226112 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:54:51.402127 140003876140480 error_handling.py:96] infeed marked as finished
I0811 23:54:51.402343 140003876140480 tpu_estimator.py:602] Stop output thread controller
I0811 23:54:51.402411 140003876140480 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:54:51.402606 140002830833408 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:54:51.402790 140002830833408 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:54:51.403002 140003876140480 error_handling.py:96] outfeed marked as finished
I0811 23:54:51.403187 140003876140480 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:54:59.005028 140003876140480 estimator.py:368] Loss for final step: 2.3021882.
I0811 23:54:59.005831 140003876140480 error_handling.py:96] training_loop marked as finished
I0811 23:54:59.793754 140003876140480 estimator.py:1145] Calling model_fn.
E0811 23:55:00.507327 140003876140480 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:55:00.696981 140003876140480 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:55:00.724809 140003876140480 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:55:00.746591 140003876140480 estimator.py:1147] Done calling model_fn.
I0811 23:55:00.763972 140003876140480 evaluation.py:255] Starting evaluation at 2019-08-11T23:55:00Z
I0811 23:55:00.764214 140003876140480 tpu_estimator.py:499] TPU job name worker
I0811 23:55:00.837774 140003876140480 monitored_session.py:240] Graph was finalized.
W0811 23:55:00.838473 140003876140480 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:55:01.027451 140003876140480 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:55:04.266477 140003876140480 session_manager.py:500] Running local_init_op.
I0811 23:55:04.295739 140003876140480 session_manager.py:502] Done running local_init_op.
I0811 23:55:04.351910 140003876140480 tpu_estimator.py:557] Init TPU system
I0811 23:56:12.658605 140003876140480 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0811 23:56:12.659631 140002839226112 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:56:12.660345 140002830833408 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:56:12.728466 140003876140480 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:56:12.751795 140003876140480 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:56:12.752136 140003876140480 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:56:12.783155 140002822440704 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:56:12.993818 140002822440704 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:56:13.517398 140002830833408 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:56:13.818634 140003876140480 evaluation.py:167] Evaluation [10/10]
I0811 23:56:13.818964 140003876140480 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:56:13.819035 140003876140480 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:56:13.819258 140002839226112 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:56:13.819533 140002839226112 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:56:13.819715 140003876140480 error_handling.py:96] infeed marked as finished
I0811 23:56:13.819871 140003876140480 tpu_estimator.py:602] Stop output thread controller
I0811 23:56:13.819942 140003876140480 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:56:13.820128 140002830833408 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:56:13.820341 140002830833408 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:56:13.820539 140003876140480 error_handling.py:96] outfeed marked as finished
I0811 23:56:13.820712 140003876140480 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:56:43.092339 140003876140480 evaluation.py:275] Finished evaluation at 2019-08-11-23:56:43
I0811 23:56:43.092675 140003876140480 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2990215
I0811 23:56:47.642366 140003876140480 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0811 23:56:48.461241 140003876140480 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2990215, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/checkpoint#1565567687945276...
Removing gs://yangyou-mnist/log/#1565567607881364...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565567608.v3-8-tpu#1565567691073814...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565567620518638...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565567612389187...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565567625057913...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565567619530192...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565567684767554...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565567685685567...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565567690160695...
Removing gs://yangyou-mnist/log/eval/#1565567804913368...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565567805.v3-8-tpu#1565567808137167...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0811 23:56:52.175358 139661118125504 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0811 23:56:52.176218 139661118125504 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0811 23:56:52.178919 139661118125504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0811 23:56:52.179728 139661118125504 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0811 23:56:52.180326 139661118125504 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0811 23:56:52.180464 139661118125504 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0811 23:56:52.581469 139661118125504 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0811 23:56:52.588371 139661118125504 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0811 23:56:52.592065 139661118125504 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:56:52.681185 139661118125504 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:56:52.681488 139661118125504 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:56:52.772867 139661118125504 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0811 23:56:52.860378 139661118125504 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0811 23:56:52.860668 139661118125504 transport.py:157] Attempting refresh to obtain initial access_token
I0811 23:56:52.976442 139661118125504 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f053d7f1190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f053f9cf190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0811 23:56:52.976824 139661118125504 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0811 23:56:53.309194 139661118125504 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-11 23:56:53.312508: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:56:53.325349 139661118125504 tpu_system_metadata.py:148] Found TPU system:
I0811 23:56:53.325663 139661118125504 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0811 23:56:53.326167 139661118125504 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0811 23:56:53.326231 139661118125504 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0811 23:56:53.326286 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0811 23:56:53.326564 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0811 23:56:53.326618 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0811 23:56:53.326669 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0811 23:56:53.326719 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0811 23:56:53.326765 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0811 23:56:53.326812 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0811 23:56:53.326857 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0811 23:56:53.326904 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0811 23:56:53.326950 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0811 23:56:53.326997 139661118125504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0811 23:56:53.332746 139661118125504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0811 23:56:53.344731 139661118125504 estimator.py:1145] Calling model_fn.
W0811 23:56:53.345324 139661118125504 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0811 23:56:53.622771 139661118125504 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0811 23:56:54.135140 139661118125504 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0811 23:56:54.196183 139661118125504 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0811 23:56:54.202090 139661118125504 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:56:54.382400 139661118125504 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0811 23:56:54.400687 139661118125504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0811 23:56:54.412781 139661118125504 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0811 23:56:54.413105 139661118125504 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0811 23:56:54.831857 139661118125504 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0811 23:56:54.846967 139661118125504 estimator.py:1147] Done calling model_fn.
I0811 23:56:58.397260 139661118125504 tpu_estimator.py:499] TPU job name worker
I0811 23:56:58.507474 139661118125504 monitored_session.py:240] Graph was finalized.
I0811 23:56:59.097070 139661118125504 session_manager.py:500] Running local_init_op.
I0811 23:56:59.137360 139661118125504 session_manager.py:502] Done running local_init_op.
I0811 23:57:01.648577 139661118125504 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0811 23:57:14.067028 139661118125504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0811 23:57:14.183839 139661118125504 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:57:14.184389 139661118125504 session_support.py:332] Installing graceful shutdown hook.
2019-08-11 23:57:14.184788: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0811 23:57:14.189769 139661118125504 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0811 23:57:14.191823 139661118125504 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0811 23:57:14.196403 139661118125504 tpu_estimator.py:557] Init TPU system
I0811 23:57:56.687154 139661118125504 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0811 23:57:56.688154 139660224612096 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:57:56.688695 139660216219392 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:57:56.733448 139661118125504 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0811 23:57:56.734456 139661118125504 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0811 23:57:56.744513 139660207826688 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:57:56.879064 139660207826688 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:58:01.473397 139660216219392 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:58:06.119293 139661118125504 basic_session_run_hooks.py:262] loss = 2.3030934, step = 30
I0811 23:58:06.121562 139661118125504 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0811 23:58:19.723303 139661118125504 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:58:19.723587 139661118125504 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:58:19.723963 139660224612096 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:58:19.724258 139660224612096 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:58:19.724493 139661118125504 error_handling.py:96] infeed marked as finished
I0811 23:58:19.724718 139661118125504 tpu_estimator.py:602] Stop output thread controller
I0811 23:58:19.724797 139661118125504 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:58:19.725025 139660216219392 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:58:19.725203 139660216219392 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:58:19.725366 139661118125504 error_handling.py:96] outfeed marked as finished
I0811 23:58:19.725498 139661118125504 tpu_estimator.py:606] Shutdown TPU system.
I0811 23:58:27.017724 139661118125504 estimator.py:368] Loss for final step: 2.3030934.
I0811 23:58:27.018538 139661118125504 error_handling.py:96] training_loop marked as finished
I0811 23:58:27.722536 139661118125504 estimator.py:1145] Calling model_fn.
E0811 23:58:28.559366 139661118125504 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0811 23:58:28.747986 139661118125504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0811 23:58:28.775254 139661118125504 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0811 23:58:28.797030 139661118125504 estimator.py:1147] Done calling model_fn.
I0811 23:58:28.814655 139661118125504 evaluation.py:255] Starting evaluation at 2019-08-11T23:58:28Z
I0811 23:58:28.814908 139661118125504 tpu_estimator.py:499] TPU job name worker
I0811 23:58:28.889034 139661118125504 monitored_session.py:240] Graph was finalized.
W0811 23:58:28.889785 139661118125504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0811 23:58:29.081065 139661118125504 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0811 23:58:31.515089 139661118125504 session_manager.py:500] Running local_init_op.
I0811 23:58:31.543972 139661118125504 session_manager.py:502] Done running local_init_op.
I0811 23:58:31.592765 139661118125504 tpu_estimator.py:557] Init TPU system
I0811 23:59:41.423614 139661118125504 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0811 23:59:41.424793 139660220679936 tpu_estimator.py:514] Starting infeed thread controller.
I0811 23:59:41.425664 139660212287232 tpu_estimator.py:533] Starting outfeed thread controller.
I0811 23:59:41.500808 139661118125504 util.py:98] Initialized dataset iterators in 0 seconds
I0811 23:59:41.528405 139661118125504 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0811 23:59:41.528811 139661118125504 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0811 23:59:41.602732 139660199171840 transport.py:157] Attempting refresh to obtain initial access_token
W0811 23:59:41.719991 139660199171840 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0811 23:59:42.288897 139660212287232 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0811 23:59:42.693337 139661118125504 evaluation.py:167] Evaluation [10/10]
I0811 23:59:42.693723 139661118125504 tpu_estimator.py:598] Stop infeed thread controller
I0811 23:59:42.693800 139661118125504 tpu_estimator.py:430] Shutting down InfeedController thread.
I0811 23:59:42.694112 139660220679936 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0811 23:59:42.694395 139660220679936 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0811 23:59:42.694648 139661118125504 error_handling.py:96] infeed marked as finished
I0811 23:59:42.694855 139661118125504 tpu_estimator.py:602] Stop output thread controller
I0811 23:59:42.694917 139661118125504 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0811 23:59:42.695080 139660212287232 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0811 23:59:42.695228 139660212287232 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0811 23:59:42.695414 139661118125504 error_handling.py:96] outfeed marked as finished
I0811 23:59:42.695594 139661118125504 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:00:11.813188 139661118125504 evaluation.py:275] Finished evaluation at 2019-08-12-00:00:11
I0812 00:00:11.813550 139661118125504 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2990956
I0812 00:00:16.078730 139661118125504 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:00:16.891544 139661118125504 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2990956, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/graph.pbtxt#1565567821096832...
Removing gs://yangyou-mnist/log/checkpoint#1565567896348124...
Removing gs://yangyou-mnist/log/#1565567816336519...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565567893173616...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565567829083067...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565567833540370...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565567828224676...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565567816.v3-8-tpu#1565567899381728...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565567894134466...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565567898454590...
Removing gs://yangyou-mnist/log/eval/#1565568013451175...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565568013.v3-8-tpu#1565568016554701...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:00:20.712701 140105040221632 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:00:20.713485 140105040221632 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:00:20.716078 140105040221632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:00:20.716878 140105040221632 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:00:20.717463 140105040221632 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:00:20.717767 140105040221632 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:00:21.105706 140105040221632 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:00:21.113471 140105040221632 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:00:21.117721 140105040221632 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:00:21.214530 140105040221632 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:00:21.214838 140105040221632 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:00:21.494649 140105040221632 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:00:21.548820 140105040221632 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:00:21.549118 140105040221632 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:00:21.663492 140105040221632 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f6c9950b0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f6c9b6e9190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:00:21.663887 140105040221632 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:00:22.007396 140105040221632 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:00:22.010511: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:00:22.023475 140105040221632 tpu_system_metadata.py:148] Found TPU system:
I0812 00:00:22.023715 140105040221632 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:00:22.024199 140105040221632 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:00:22.024256 140105040221632 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:00:22.024315 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:00:22.024602 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:00:22.024661 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:00:22.024712 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:00:22.024765 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:00:22.024816 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:00:22.024863 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:00:22.024910 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:00:22.024957 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:00:22.025003 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:00:22.025052 140105040221632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:00:22.031068 140105040221632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:00:22.043754 140105040221632 estimator.py:1145] Calling model_fn.
W0812 00:00:22.044390 140105040221632 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:00:22.314920 140105040221632 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:00:22.728089 140105040221632 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:00:22.792795 140105040221632 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:00:22.798548 140105040221632 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:00:22.973803 140105040221632 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:00:22.987171 140105040221632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:00:22.998996 140105040221632 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:00:22.999316 140105040221632 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:00:23.419740 140105040221632 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:00:23.435247 140105040221632 estimator.py:1147] Done calling model_fn.
I0812 00:00:26.672868 140105040221632 tpu_estimator.py:499] TPU job name worker
I0812 00:00:26.789949 140105040221632 monitored_session.py:240] Graph was finalized.
I0812 00:00:27.361263 140105040221632 session_manager.py:500] Running local_init_op.
I0812 00:00:27.401670 140105040221632 session_manager.py:502] Done running local_init_op.
I0812 00:00:30.081281 140105040221632 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:00:42.598144 140105040221632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:00:42.737566 140105040221632 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:00:42.738096 140105040221632 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:00:42.738488: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:00:42.743526 140105040221632 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:00:42.745680 140105040221632 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:00:42.750092 140105040221632 tpu_estimator.py:557] Init TPU system
I0812 00:01:24.684377 140105040221632 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 00:01:24.685498 140104280815360 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:01:24.686422 140104272422656 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:01:24.738362 140105040221632 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:01:24.739806 140105040221632 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:01:24.750570 140104264029952 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:01:24.866331 140104264029952 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:01:29.359421 140104272422656 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:01:33.860225 140105040221632 basic_session_run_hooks.py:262] loss = 2.300783, step = 30
I0812 00:01:33.862723 140105040221632 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:01:47.415589 140105040221632 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:01:47.415900 140105040221632 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:01:47.417409 140104280815360 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:01:47.417790 140104280815360 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:01:47.418001 140105040221632 error_handling.py:96] infeed marked as finished
I0812 00:01:47.418212 140105040221632 tpu_estimator.py:602] Stop output thread controller
I0812 00:01:47.418272 140105040221632 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:01:47.418437 140104272422656 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:01:47.418648 140104272422656 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:01:47.418812 140105040221632 error_handling.py:96] outfeed marked as finished
I0812 00:01:47.418951 140105040221632 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:01:54.999552 140105040221632 estimator.py:368] Loss for final step: 2.300783.
I0812 00:01:55.000343 140105040221632 error_handling.py:96] training_loop marked as finished
I0812 00:01:55.724649 140105040221632 estimator.py:1145] Calling model_fn.
E0812 00:01:56.437099 140105040221632 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:01:56.640160 140105040221632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:01:56.668050 140105040221632 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:01:56.690684 140105040221632 estimator.py:1147] Done calling model_fn.
I0812 00:01:56.709127 140105040221632 evaluation.py:255] Starting evaluation at 2019-08-12T00:01:56Z
I0812 00:01:56.709398 140105040221632 tpu_estimator.py:499] TPU job name worker
I0812 00:01:56.787305 140105040221632 monitored_session.py:240] Graph was finalized.
W0812 00:01:56.788106 140105040221632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:01:56.982291 140105040221632 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:01:59.311108 140105040221632 session_manager.py:500] Running local_init_op.
I0812 00:01:59.335824 140105040221632 session_manager.py:502] Done running local_init_op.
I0812 00:01:59.382261 140105040221632 tpu_estimator.py:557] Init TPU system
I0812 00:03:08.667923 140105040221632 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 00:03:08.669020 140104276883200 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:03:08.669779 140104268490496 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:03:08.736257 140105040221632 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:03:08.760978 140105040221632 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:03:08.761336 140105040221632 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:03:08.787986 140103779350272 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:03:08.898737 140103779350272 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:03:09.514029 140104268490496 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:03:09.949327 140105040221632 evaluation.py:167] Evaluation [10/10]
I0812 00:03:09.949701 140105040221632 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:03:09.949790 140105040221632 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:03:09.950067 140104276883200 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:03:09.950357 140104276883200 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:03:09.950581 140105040221632 error_handling.py:96] infeed marked as finished
I0812 00:03:09.950802 140105040221632 tpu_estimator.py:602] Stop output thread controller
I0812 00:03:09.950865 140105040221632 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:03:09.951029 140104268490496 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:03:09.951174 140104268490496 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:03:09.951359 140105040221632 error_handling.py:96] outfeed marked as finished
I0812 00:03:09.951536 140105040221632 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:03:38.995085 140105040221632 evaluation.py:275] Finished evaluation at 2019-08-12-00:03:38
I0812 00:03:38.995433 140105040221632 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3003442
I0812 00:03:43.636745 140105040221632 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:03:44.454230 140105040221632 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3003442, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565568037439144...
Removing gs://yangyou-mnist/log/#1565568024899047...
Removing gs://yangyou-mnist/log/checkpoint#1565568103724002...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565568025.v3-8-tpu#1565568107012917...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565568042085068...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565568029530388...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565568100461125...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565568036535910...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565568101351270...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565568106004843...
Removing gs://yangyou-mnist/log/eval/#1565568220813900...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565568221.v3-8-tpu#1565568224123498...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:03:48.403918 140262168421824 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:03:48.404735 140262168421824 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:03:48.407490 140262168421824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:03:48.408355 140262168421824 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:03:48.408965 140262168421824 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:03:48.409100 140262168421824 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:03:48.850523 140262168421824 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:03:48.858795 140262168421824 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:03:48.863087 140262168421824 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:03:48.913706 140262168421824 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:03:48.914010 140262168421824 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:03:49.063316 140262168421824 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:03:49.110236 140262168421824 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:03:49.110553 140262168421824 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:03:49.242630 140262168421824 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f912ee2c090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f913100a190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:03:49.243053 140262168421824 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:03:49.580081 140262168421824 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:03:49.583382: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:03:49.596631 140262168421824 tpu_system_metadata.py:148] Found TPU system:
I0812 00:03:49.596880 140262168421824 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:03:49.597397 140262168421824 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:03:49.597454 140262168421824 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:03:49.597506 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:03:49.597898 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:03:49.597956 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:03:49.598006 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:03:49.598057 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:03:49.598104 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:03:49.598150 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:03:49.598196 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:03:49.598242 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:03:49.598287 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:03:49.598334 140262168421824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:03:49.604667 140262168421824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:03:49.617440 140262168421824 estimator.py:1145] Calling model_fn.
W0812 00:03:49.618144 140262168421824 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:03:49.892046 140262168421824 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:03:50.303298 140262168421824 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:03:50.365988 140262168421824 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:03:50.372145 140262168421824 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:03:50.555944 140262168421824 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:03:50.570019 140262168421824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:03:50.582894 140262168421824 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:03:50.583237 140262168421824 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:03:51.028903 140262168421824 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:03:51.046574 140262168421824 estimator.py:1147] Done calling model_fn.
I0812 00:03:54.776957 140262168421824 tpu_estimator.py:499] TPU job name worker
I0812 00:03:54.888679 140262168421824 monitored_session.py:240] Graph was finalized.
I0812 00:03:55.482711 140262168421824 session_manager.py:500] Running local_init_op.
I0812 00:03:55.514688 140262168421824 session_manager.py:502] Done running local_init_op.
I0812 00:03:58.223902 140262168421824 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:04:10.794883 140262168421824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:04:10.906512 140262168421824 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:04:10.906985 140262168421824 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:04:10.907380: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:04:10.912182 140262168421824 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:04:10.914343 140262168421824 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:04:10.917860 140262168421824 tpu_estimator.py:557] Init TPU system
I0812 00:04:52.665646 140262168421824 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 00:04:52.666709 140261267068672 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:04:52.667598 140261258675968 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:04:52.714585 140262168421824 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:04:52.715692 140262168421824 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:04:52.727303 140261250283264 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:04:52.966737 140261250283264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:04:57.111983 140261258675968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:05:01.605844 140262168421824 basic_session_run_hooks.py:262] loss = 2.3022285, step = 30
I0812 00:05:01.608108 140262168421824 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:05:15.046113 140262168421824 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:05:15.046423 140262168421824 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:05:15.046770 140261267068672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:05:15.047154 140261267068672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:05:15.047395 140262168421824 error_handling.py:96] infeed marked as finished
I0812 00:05:15.047624 140262168421824 tpu_estimator.py:602] Stop output thread controller
I0812 00:05:15.047693 140262168421824 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:05:15.048021 140261258675968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:05:15.048217 140261258675968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:05:15.048419 140262168421824 error_handling.py:96] outfeed marked as finished
I0812 00:05:15.048616 140262168421824 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:05:23.077384 140262168421824 estimator.py:368] Loss for final step: 2.3022285.
I0812 00:05:23.078259 140262168421824 error_handling.py:96] training_loop marked as finished
I0812 00:05:23.901927 140262168421824 estimator.py:1145] Calling model_fn.
E0812 00:05:24.603214 140262168421824 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:05:24.802618 140262168421824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:05:24.831059 140262168421824 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:05:24.851967 140262168421824 estimator.py:1147] Done calling model_fn.
I0812 00:05:24.868905 140262168421824 evaluation.py:255] Starting evaluation at 2019-08-12T00:05:24Z
I0812 00:05:24.869139 140262168421824 tpu_estimator.py:499] TPU job name worker
I0812 00:05:24.945534 140262168421824 monitored_session.py:240] Graph was finalized.
W0812 00:05:24.946291 140262168421824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:05:25.150748 140262168421824 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:05:27.752079 140262168421824 session_manager.py:500] Running local_init_op.
I0812 00:05:27.776415 140262168421824 session_manager.py:502] Done running local_init_op.
I0812 00:05:27.825063 140262168421824 tpu_estimator.py:557] Init TPU system
I0812 00:06:36.600831 140262168421824 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:06:36.601809 140261267068672 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:06:36.602607 140261258675968 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:06:36.673327 140262168421824 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:06:36.701426 140262168421824 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:06:36.701854 140262168421824 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:06:36.733771 140261250283264 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:06:36.856112 140261250283264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:06:37.482943 140261258675968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:06:37.833199 140262168421824 evaluation.py:167] Evaluation [10/10]
I0812 00:06:37.833568 140262168421824 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:06:37.833688 140262168421824 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:06:37.833992 140261267068672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:06:37.834287 140261267068672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:06:37.834568 140262168421824 error_handling.py:96] infeed marked as finished
I0812 00:06:37.834840 140262168421824 tpu_estimator.py:602] Stop output thread controller
I0812 00:06:37.834907 140262168421824 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:06:37.835114 140261258675968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:06:37.835314 140261258675968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:06:37.835531 140262168421824 error_handling.py:96] outfeed marked as finished
I0812 00:06:37.835764 140262168421824 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:07:06.951334 140262168421824 evaluation.py:275] Finished evaluation at 2019-08-12-00:07:06
I0812 00:07:06.951677 140262168421824 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2980773
I0812 00:07:11.585134 140262168421824 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:07:12.428570 140262168421824 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2980773, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/checkpoint#1565568311557411...
Removing gs://yangyou-mnist/log/#1565568232560871...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565568245741411...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565568250289145...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565568232.v3-8-tpu#1565568314707279...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565568237571655...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565568308465937...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565568244879006...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565568309387546...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565568313809823...
Removing gs://yangyou-mnist/log/eval/#1565568428647087...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565568428.v3-8-tpu#1565568432102671...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:07:16.256046 139822213207488 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:07:16.256813 139822213207488 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:07:16.259404 139822213207488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:07:16.260221 139822213207488 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:07:16.260806 139822213207488 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:07:16.260931 139822213207488 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:07:16.677886 139822213207488 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:07:16.685038 139822213207488 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:07:16.688713 139822213207488 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:07:16.780036 139822213207488 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:07:16.780318 139822213207488 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:07:16.906898 139822213207488 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:07:16.959645 139822213207488 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:07:16.959980 139822213207488 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:07:17.104809 139822213207488 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2abf82f0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2ac1a0d150>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:07:17.105185 139822213207488 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:07:17.470657 139822213207488 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:07:17.473844: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:07:17.486222 139822213207488 tpu_system_metadata.py:148] Found TPU system:
I0812 00:07:17.486449 139822213207488 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:07:17.486963 139822213207488 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:07:17.487025 139822213207488 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:07:17.487083 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:07:17.487376 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:07:17.487433 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:07:17.487490 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:07:17.487588 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:07:17.487638 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:07:17.487684 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:07:17.487732 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:07:17.487778 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:07:17.487826 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:07:17.487874 139822213207488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:07:17.493995 139822213207488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:07:17.506352 139822213207488 estimator.py:1145] Calling model_fn.
W0812 00:07:17.506964 139822213207488 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:07:17.821926 139822213207488 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:07:18.288567 139822213207488 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:07:18.350183 139822213207488 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:07:18.356142 139822213207488 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:07:18.539235 139822213207488 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:07:18.552880 139822213207488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:07:18.564868 139822213207488 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:07:18.565184 139822213207488 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:07:18.984038 139822213207488 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:07:18.999325 139822213207488 estimator.py:1147] Done calling model_fn.
I0812 00:07:22.811131 139822213207488 tpu_estimator.py:499] TPU job name worker
I0812 00:07:22.924798 139822213207488 monitored_session.py:240] Graph was finalized.
I0812 00:07:23.548190 139822213207488 session_manager.py:500] Running local_init_op.
I0812 00:07:23.579874 139822213207488 session_manager.py:502] Done running local_init_op.
I0812 00:07:26.306240 139822213207488 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:07:38.728276 139822213207488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:07:38.835520 139822213207488 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:07:38.836045 139822213207488 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:07:38.836486: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:07:38.841572 139822213207488 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:07:38.843915 139822213207488 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:07:38.848129 139822213207488 tpu_estimator.py:557] Init TPU system
I0812 00:08:20.704070 139822213207488 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 00:08:20.705176 139821183923968 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:08:20.706065 139821175531264 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:08:20.751370 139822213207488 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:08:20.752245 139822213207488 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:08:20.762844 139821167138560 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:08:20.984549 139821167138560 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:08:25.174474 139821175531264 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:08:29.929791 139822213207488 basic_session_run_hooks.py:262] loss = 2.3109565, step = 30
I0812 00:08:29.932523 139822213207488 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:08:42.388641 139822213207488 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:08:42.388917 139822213207488 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:08:42.389231 139821183923968 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:08:42.389547 139821183923968 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:08:42.389796 139822213207488 error_handling.py:96] infeed marked as finished
I0812 00:08:42.390016 139822213207488 tpu_estimator.py:602] Stop output thread controller
I0812 00:08:42.390077 139822213207488 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:08:42.390264 139821175531264 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:08:42.390440 139821175531264 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:08:42.390599 139822213207488 error_handling.py:96] outfeed marked as finished
I0812 00:08:42.390736 139822213207488 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:08:51.120910 139822213207488 estimator.py:368] Loss for final step: 2.3109565.
I0812 00:08:51.121809 139822213207488 error_handling.py:96] training_loop marked as finished
I0812 00:08:51.820744 139822213207488 estimator.py:1145] Calling model_fn.
E0812 00:08:52.565937 139822213207488 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:08:52.754141 139822213207488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:08:52.780844 139822213207488 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:08:52.801440 139822213207488 estimator.py:1147] Done calling model_fn.
I0812 00:08:52.818530 139822213207488 evaluation.py:255] Starting evaluation at 2019-08-12T00:08:52Z
I0812 00:08:52.818762 139822213207488 tpu_estimator.py:499] TPU job name worker
I0812 00:08:52.894392 139822213207488 monitored_session.py:240] Graph was finalized.
W0812 00:08:52.895174 139822213207488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:08:53.080883 139822213207488 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:08:55.629522 139822213207488 session_manager.py:500] Running local_init_op.
I0812 00:08:55.653947 139822213207488 session_manager.py:502] Done running local_init_op.
I0812 00:08:55.716423 139822213207488 tpu_estimator.py:557] Init TPU system
I0812 00:10:04.665949 139822213207488 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:10:04.666927 139821181302528 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:10:04.667383 139821172909824 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:10:04.735919 139822213207488 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:10:04.763091 139822213207488 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:10:04.763508 139822213207488 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:10:04.795039 139821164517120 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:10:04.874892 139821164517120 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:10:05.512214 139821172909824 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:10:05.976743 139822213207488 evaluation.py:167] Evaluation [10/10]
I0812 00:10:05.977138 139822213207488 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:10:05.977216 139822213207488 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:10:05.977387 139821181302528 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:10:05.977487 139821181302528 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:10:05.977682 139822213207488 error_handling.py:96] infeed marked as finished
I0812 00:10:05.977792 139822213207488 tpu_estimator.py:602] Stop output thread controller
I0812 00:10:05.977849 139822213207488 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:10:05.977962 139821172909824 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:10:05.978046 139821172909824 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:10:05.978169 139822213207488 error_handling.py:96] outfeed marked as finished
I0812 00:10:05.978252 139822213207488 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:10:34.969492 139822213207488 evaluation.py:275] Finished evaluation at 2019-08-12-00:10:34
I0812 00:10:34.969923 139822213207488 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0974, global_step = 30, loss = 2.307226
I0812 00:10:39.490772 139822213207488 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:10:40.351612 139822213207488 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.307226, 'global_step': 30, 'accuracy': 0.0974}

Removing gs://yangyou-mnist/log/#1565568440741946...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565568445676319...
Removing gs://yangyou-mnist/log/checkpoint#1565568519130623...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565568453751334...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565568452697736...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565568440.v3-8-tpu#1565568522068972...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565568517033567...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565568458278843...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565568516150210...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565568521209435...
Removing gs://yangyou-mnist/log/eval/#1565568636694277...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565568636.v3-8-tpu#1565568639984648...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:10:44.274470 140229005452736 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:10:44.275274 140229005452736 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:10:44.277959 140229005452736 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:10:44.278822 140229005452736 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:10:44.279434 140229005452736 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:10:44.279575 140229005452736 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:10:44.702678 140229005452736 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:10:44.708997 140229005452736 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:10:44.712590 140229005452736 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:10:44.758521 140229005452736 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:10:44.758810 140229005452736 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:10:44.881886 140229005452736 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:10:44.927689 140229005452736 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:10:44.927979 140229005452736 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:10:45.099581 140229005452736 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8976380050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f897855e190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:10:45.099952 140229005452736 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:10:45.428893 140229005452736 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:10:45.432258: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:10:45.445626 140229005452736 tpu_system_metadata.py:148] Found TPU system:
I0812 00:10:45.445902 140229005452736 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:10:45.446428 140229005452736 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:10:45.446485 140229005452736 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:10:45.446544 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:10:45.446830 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:10:45.446888 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:10:45.446939 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:10:45.446990 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:10:45.447038 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:10:45.447086 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:10:45.447132 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:10:45.447177 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:10:45.447232 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:10:45.447283 140229005452736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:10:45.453782 140229005452736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:10:45.466917 140229005452736 estimator.py:1145] Calling model_fn.
W0812 00:10:45.467551 140229005452736 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:10:45.737313 140229005452736 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:10:46.182934 140229005452736 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:10:46.246716 140229005452736 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:10:46.252677 140229005452736 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:10:46.444720 140229005452736 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:10:46.459163 140229005452736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:10:46.471357 140229005452736 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:10:46.471663 140229005452736 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:10:46.913263 140229005452736 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:10:46.929199 140229005452736 estimator.py:1147] Done calling model_fn.
I0812 00:10:50.377618 140229005452736 tpu_estimator.py:499] TPU job name worker
I0812 00:10:50.501672 140229005452736 monitored_session.py:240] Graph was finalized.
I0812 00:10:51.057507 140229005452736 session_manager.py:500] Running local_init_op.
I0812 00:10:51.086684 140229005452736 session_manager.py:502] Done running local_init_op.
I0812 00:10:53.700726 140229005452736 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:11:05.777441 140229005452736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:11:05.895106 140229005452736 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:11:05.895633 140229005452736 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:11:05.896060: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:11:05.901050 140229005452736 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:11:05.903228 140229005452736 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:11:05.908134 140229005452736 tpu_estimator.py:557] Init TPU system
I0812 00:11:48.629628 140229005452736 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 00:11:48.630800 140228111881984 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:11:48.631684 140228103489280 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:11:48.681679 140229005452736 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:11:48.682581 140229005452736 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:11:48.693126 140228095096576 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:11:48.913789 140228095096576 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:11:53.167675 140228103489280 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:11:57.625765 140229005452736 basic_session_run_hooks.py:262] loss = 1.154242, step = 30
I0812 00:11:57.628166 140229005452736 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:12:11.584522 140229005452736 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:12:11.584841 140229005452736 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:12:11.586258 140228111881984 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:12:11.586535 140228111881984 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:12:11.586743 140229005452736 error_handling.py:96] infeed marked as finished
I0812 00:12:11.586971 140229005452736 tpu_estimator.py:602] Stop output thread controller
I0812 00:12:11.587032 140229005452736 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:12:11.587188 140228103489280 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:12:11.587377 140228103489280 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:12:11.587553 140229005452736 error_handling.py:96] outfeed marked as finished
I0812 00:12:11.587747 140229005452736 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:12:19.051661 140229005452736 estimator.py:368] Loss for final step: 1.154242.
I0812 00:12:19.052563 140229005452736 error_handling.py:96] training_loop marked as finished
I0812 00:12:19.856956 140229005452736 estimator.py:1145] Calling model_fn.
E0812 00:12:20.544884 140229005452736 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:12:20.736468 140229005452736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:12:20.763803 140229005452736 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:12:20.784756 140229005452736 estimator.py:1147] Done calling model_fn.
I0812 00:12:20.801131 140229005452736 evaluation.py:255] Starting evaluation at 2019-08-12T00:12:20Z
I0812 00:12:20.801363 140229005452736 tpu_estimator.py:499] TPU job name worker
I0812 00:12:20.875387 140229005452736 monitored_session.py:240] Graph was finalized.
W0812 00:12:20.876125 140229005452736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:12:21.081470 140229005452736 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:12:23.736871 140229005452736 session_manager.py:500] Running local_init_op.
I0812 00:12:23.760616 140229005452736 session_manager.py:502] Done running local_init_op.
I0812 00:12:23.812814 140229005452736 tpu_estimator.py:557] Init TPU system
I0812 00:13:32.574568 140229005452736 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:13:32.575609 140228107949824 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:13:32.576309 140228099557120 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:13:32.646466 140229005452736 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:13:32.676750 140229005452736 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:13:32.677145 140229005452736 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:13:32.701395 140228086441728 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:13:32.931929 140228086441728 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:13:33.461780 140228099557120 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:13:33.819847 140229005452736 evaluation.py:167] Evaluation [10/10]
I0812 00:13:33.820231 140229005452736 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:13:33.820311 140229005452736 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:13:33.820539 140228107949824 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:13:33.820806 140228107949824 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:13:33.821024 140229005452736 error_handling.py:96] infeed marked as finished
I0812 00:13:33.821172 140229005452736 tpu_estimator.py:602] Stop output thread controller
I0812 00:13:33.821230 140229005452736 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:13:33.821383 140228099557120 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:13:33.821517 140228099557120 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:13:33.821724 140229005452736 error_handling.py:96] outfeed marked as finished
I0812 00:13:33.821850 140229005452736 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:14:03.029066 140229005452736 evaluation.py:275] Finished evaluation at 2019-08-12-00:14:03
I0812 00:14:03.029443 140229005452736 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8201, global_step = 30, loss = 1.0722855
I0812 00:14:07.345648 140229005452736 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:14:08.110191 140229005452736 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.0722855, 'global_step': 30, 'accuracy': 0.8201}

Removing gs://yangyou-mnist/log/#1565568648465217...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565568660817327...
Removing gs://yangyou-mnist/log/checkpoint#1565568728017885...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565568665255286...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565568648.v3-8-tpu#1565568731260998...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565568724792292...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565568659900563...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565568653152976...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565568725666268...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565568730339162...
Removing gs://yangyou-mnist/log/eval/#1565568844661988...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565568844.v3-8-tpu#1565568847787684...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:14:11.945749 140702715246016 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:14:11.946557 140702715246016 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:14:11.949110 140702715246016 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:14:11.950217 140702715246016 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:14:11.950864 140702715246016 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:14:11.950999 140702715246016 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:14:12.366367 140702715246016 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:14:12.373671 140702715246016 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:14:12.377909 140702715246016 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:14:12.430115 140702715246016 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:14:12.430408 140702715246016 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:14:12.568305 140702715246016 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:14:12.614737 140702715246016 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:14:12.615163 140702715246016 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:14:12.838480 140702715246016 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff7c185d0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff7c3a3b190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:14:12.838829 140702715246016 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:14:13.167793 140702715246016 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:14:13.170898: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:14:13.191278 140702715246016 tpu_system_metadata.py:148] Found TPU system:
I0812 00:14:13.191540 140702715246016 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:14:13.192051 140702715246016 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:14:13.192111 140702715246016 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:14:13.192164 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:14:13.192446 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:14:13.192506 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:14:13.192557 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:14:13.192605 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:14:13.192652 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:14:13.192703 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:14:13.192749 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:14:13.192795 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:14:13.192842 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:14:13.192888 140702715246016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:14:13.198934 140702715246016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:14:13.211500 140702715246016 estimator.py:1145] Calling model_fn.
W0812 00:14:13.213923 140702715246016 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:14:13.528470 140702715246016 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:14:13.945534 140702715246016 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:14:14.005532 140702715246016 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:14:14.011194 140702715246016 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:14:14.186269 140702715246016 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:14:14.199696 140702715246016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:14:14.211361 140702715246016 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:14:14.211672 140702715246016 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:14:14.631305 140702715246016 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:14:14.646838 140702715246016 estimator.py:1147] Done calling model_fn.
I0812 00:14:18.053348 140702715246016 tpu_estimator.py:499] TPU job name worker
I0812 00:14:18.167005 140702715246016 monitored_session.py:240] Graph was finalized.
I0812 00:14:18.746957 140702715246016 session_manager.py:500] Running local_init_op.
I0812 00:14:18.778245 140702715246016 session_manager.py:502] Done running local_init_op.
I0812 00:14:21.516468 140702715246016 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:14:34.108872 140702715246016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:14:34.218122 140702715246016 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:14:34.218660 140702715246016 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:14:34.219080: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:14:34.224679 140702715246016 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:14:34.226785 140702715246016 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:14:34.230082 140702715246016 tpu_estimator.py:557] Init TPU system
I0812 00:15:16.703913 140702715246016 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 00:15:16.704838 140701813159680 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:15:16.705380 140701804766976 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:15:16.750713 140702715246016 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:15:16.751988 140702715246016 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:15:16.762162 140701796374272 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:15:16.889136 140701796374272 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:15:21.313354 140701804766976 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:15:25.921802 140702715246016 basic_session_run_hooks.py:262] loss = 0.4743434, step = 30
I0812 00:15:25.926295 140702715246016 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:15:39.553687 140702715246016 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:15:39.554003 140702715246016 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:15:39.554302 140701813159680 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:15:39.554617 140701813159680 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:15:39.554837 140702715246016 error_handling.py:96] infeed marked as finished
I0812 00:15:39.555052 140702715246016 tpu_estimator.py:602] Stop output thread controller
I0812 00:15:39.555108 140702715246016 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:15:39.555310 140701804766976 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:15:39.555490 140701804766976 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:15:39.555648 140702715246016 error_handling.py:96] outfeed marked as finished
I0812 00:15:39.555767 140702715246016 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:15:47.028698 140702715246016 estimator.py:368] Loss for final step: 0.4743434.
I0812 00:15:47.029542 140702715246016 error_handling.py:96] training_loop marked as finished
I0812 00:15:47.838059 140702715246016 estimator.py:1145] Calling model_fn.
E0812 00:15:48.526273 140702715246016 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:15:48.715030 140702715246016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:15:48.741972 140702715246016 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:15:48.763333 140702715246016 estimator.py:1147] Done calling model_fn.
I0812 00:15:48.779746 140702715246016 evaluation.py:255] Starting evaluation at 2019-08-12T00:15:48Z
I0812 00:15:48.779973 140702715246016 tpu_estimator.py:499] TPU job name worker
I0812 00:15:48.853344 140702715246016 monitored_session.py:240] Graph was finalized.
W0812 00:15:48.854101 140702715246016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:15:49.048230 140702715246016 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:15:51.741923 140702715246016 session_manager.py:500] Running local_init_op.
I0812 00:15:51.771155 140702715246016 session_manager.py:502] Done running local_init_op.
I0812 00:15:51.825896 140702715246016 tpu_estimator.py:557] Init TPU system
I0812 00:17:00.628345 140702715246016 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:17:00.629293 140701817620224 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:17:00.630089 140701809227520 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:17:00.705838 140702715246016 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:17:00.738193 140702715246016 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:17:00.738552 140702715246016 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:17:00.805469 140701800834816 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:17:00.915980 140701800834816 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:17:01.537390 140701809227520 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:17:01.808559 140702715246016 evaluation.py:167] Evaluation [10/10]
I0812 00:17:01.808901 140702715246016 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:17:01.808979 140702715246016 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:17:01.809236 140701817620224 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:17:01.809537 140701817620224 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:17:01.809777 140702715246016 error_handling.py:96] infeed marked as finished
I0812 00:17:01.809946 140702715246016 tpu_estimator.py:602] Stop output thread controller
I0812 00:17:01.810004 140702715246016 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:17:01.810152 140701809227520 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:17:01.810287 140701809227520 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:17:01.810462 140702715246016 error_handling.py:96] outfeed marked as finished
I0812 00:17:01.810623 140702715246016 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:17:31.014213 140702715246016 evaluation.py:275] Finished evaluation at 2019-08-12-00:17:31
I0812 00:17:31.014573 140702715246016 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8862, global_step = 30, loss = 0.4571146
I0812 00:17:35.390768 140702715246016 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:17:36.156179 140702715246016 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.4571146, 'global_step': 30, 'accuracy': 0.8862}

Removing gs://yangyou-mnist/log/#1565568856131047...
Removing gs://yangyou-mnist/log/checkpoint#1565568935895545...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565568856.v3-8-tpu#1565568939228643...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565568860960718...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565568868971739...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565568873608931...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565568933738926...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565568868079034...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565568932798296...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565568938280729...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565569052728333...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565569052.v3-8-tpu#1565569055832955...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:17:40.010417 140352911566272 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:17:40.011202 140352911566272 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:17:40.013782 140352911566272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:17:40.014561 140352911566272 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:17:40.015192 140352911566272 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:17:40.015322 140352911566272 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:17:40.408844 140352911566272 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:17:40.415708 140352911566272 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:17:40.419400 140352911566272 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:17:40.467665 140352911566272 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:17:40.467967 140352911566272 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:17:40.581968 140352911566272 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:17:40.677279 140352911566272 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:17:40.677567 140352911566272 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:17:40.800028 140352911566272 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa64f994210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa651b72190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:17:40.800388 140352911566272 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:17:41.129122 140352911566272 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:17:41.132165: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:17:41.143770 140352911566272 tpu_system_metadata.py:148] Found TPU system:
I0812 00:17:41.144009 140352911566272 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:17:41.144535 140352911566272 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:17:41.144593 140352911566272 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:17:41.144714 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:17:41.145040 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:17:41.145097 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:17:41.145157 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:17:41.145210 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:17:41.145257 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:17:41.145304 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:17:41.145351 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:17:41.145399 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:17:41.145445 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:17:41.145493 140352911566272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:17:41.151570 140352911566272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:17:41.163866 140352911566272 estimator.py:1145] Calling model_fn.
W0812 00:17:41.164516 140352911566272 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:17:41.443380 140352911566272 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:17:41.869131 140352911566272 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:17:41.930198 140352911566272 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:17:41.935988 140352911566272 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:17:42.112059 140352911566272 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:17:42.125438 140352911566272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:17:42.137208 140352911566272 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:17:42.137514 140352911566272 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:17:42.563179 140352911566272 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:17:42.578649 140352911566272 estimator.py:1147] Done calling model_fn.
I0812 00:17:46.197339 140352911566272 tpu_estimator.py:499] TPU job name worker
I0812 00:17:46.309329 140352911566272 monitored_session.py:240] Graph was finalized.
I0812 00:17:46.882570 140352911566272 session_manager.py:500] Running local_init_op.
I0812 00:17:46.919282 140352911566272 session_manager.py:502] Done running local_init_op.
I0812 00:17:49.497844 140352911566272 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:18:02.126475 140352911566272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:18:02.247297 140352911566272 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:18:02.247806 140352911566272 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:18:02.248214: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:18:02.253196 140352911566272 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:18:02.255378 140352911566272 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:18:02.259021 140352911566272 tpu_estimator.py:557] Init TPU system
I0812 00:18:44.670031 140352911566272 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 00:18:44.670937 140351880820480 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:18:44.671397 140351872427776 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:18:44.721093 140352911566272 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:18:44.722059 140352911566272 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:18:44.775549 140351864035072 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:18:44.856492 140351864035072 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 00:18:49.227555 140351872427776 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:18:53.763504 140352911566272 basic_session_run_hooks.py:262] loss = 0.29266047, step = 30
I0812 00:18:53.765762 140352911566272 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:19:07.567929 140352911566272 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:19:07.568272 140352911566272 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:19:07.569780 140351880820480 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:19:07.569919 140351880820480 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:19:07.570100 140352911566272 error_handling.py:96] infeed marked as finished
I0812 00:19:07.570204 140352911566272 tpu_estimator.py:602] Stop output thread controller
I0812 00:19:07.570288 140352911566272 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:19:07.570411 140351872427776 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:19:07.570487 140351872427776 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:19:07.570653 140352911566272 error_handling.py:96] outfeed marked as finished
I0812 00:19:07.570743 140352911566272 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:19:15.000037 140352911566272 estimator.py:368] Loss for final step: 0.29266047.
I0812 00:19:15.000870 140352911566272 error_handling.py:96] training_loop marked as finished
I0812 00:19:15.815275 140352911566272 estimator.py:1145] Calling model_fn.
E0812 00:19:16.594013 140352911566272 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:19:16.787162 140352911566272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:19:16.814687 140352911566272 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:19:16.842252 140352911566272 estimator.py:1147] Done calling model_fn.
I0812 00:19:16.859592 140352911566272 evaluation.py:255] Starting evaluation at 2019-08-12T00:19:16Z
I0812 00:19:16.859849 140352911566272 tpu_estimator.py:499] TPU job name worker
I0812 00:19:16.934928 140352911566272 monitored_session.py:240] Graph was finalized.
W0812 00:19:16.935708 140352911566272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:19:17.132935 140352911566272 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:19:19.598006 140352911566272 session_manager.py:500] Running local_init_op.
I0812 00:19:19.622186 140352911566272 session_manager.py:502] Done running local_init_op.
I0812 00:19:19.679627 140352911566272 tpu_estimator.py:557] Init TPU system
I0812 00:20:28.610789 140352911566272 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:20:28.611726 140351879509760 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:20:28.612145 140351871117056 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:20:28.678540 140352911566272 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:20:28.706547 140352911566272 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:20:28.706912 140352911566272 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:20:28.734313 140351862724352 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:20:28.815587 140351862724352 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:20:29.491261 140351871117056 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:20:29.792530 140352911566272 evaluation.py:167] Evaluation [10/10]
I0812 00:20:29.792862 140352911566272 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:20:29.792932 140352911566272 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:20:29.793113 140351879509760 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:20:29.793401 140351879509760 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:20:29.793838 140352911566272 error_handling.py:96] infeed marked as finished
I0812 00:20:29.793967 140352911566272 tpu_estimator.py:602] Stop output thread controller
I0812 00:20:29.794101 140352911566272 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:20:29.794291 140351871117056 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:20:29.794375 140351871117056 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:20:29.794492 140352911566272 error_handling.py:96] outfeed marked as finished
I0812 00:20:29.794589 140352911566272 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:20:58.912843 140352911566272 evaluation.py:275] Finished evaluation at 2019-08-12-00:20:58
I0812 00:20:58.913187 140352911566272 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9266, global_step = 30, loss = 0.29217687
I0812 00:21:03.377006 140352911566272 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:21:04.194370 140352911566272 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.29217687, 'global_step': 30, 'accuracy': 0.9266}

Removing gs://yangyou-mnist/log/checkpoint#1565569143819493...
Removing gs://yangyou-mnist/log/#1565569064151497...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565569064.v3-8-tpu#1565569147236486...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565569077239819...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565569081630050...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565569140604232...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565569068897423...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565569076115980...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565569141514072...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565569146198877...
Removing gs://yangyou-mnist/log/eval/#1565569260520617...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565569260.v3-8-tpu#1565569263872891...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:21:07.903894 140280045864384 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:21:07.904680 140280045864384 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:21:07.907236 140280045864384 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:21:07.908027 140280045864384 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:21:07.908608 140280045864384 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:21:07.908734 140280045864384 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:21:08.297307 140280045864384 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:21:08.305289 140280045864384 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:21:08.309534 140280045864384 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:21:08.358388 140280045864384 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:21:08.358683 140280045864384 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:21:08.482393 140280045864384 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:21:08.531693 140280045864384 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:21:08.531972 140280045864384 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:21:08.603724 140280045864384 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f955876e190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f955a94c190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:21:08.604094 140280045864384 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:21:08.929061 140280045864384 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:21:08.932075: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:21:08.944614 140280045864384 tpu_system_metadata.py:148] Found TPU system:
I0812 00:21:08.944849 140280045864384 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:21:08.945460 140280045864384 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:21:08.945519 140280045864384 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:21:08.945628 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:21:08.945998 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:21:08.946099 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:21:08.946155 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:21:08.946204 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:21:08.946254 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:21:08.946300 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:21:08.946346 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:21:08.946393 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:21:08.946440 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:21:08.946489 140280045864384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:21:08.952442 140280045864384 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:21:08.964560 140280045864384 estimator.py:1145] Calling model_fn.
W0812 00:21:08.965133 140280045864384 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:21:09.243534 140280045864384 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:21:09.670151 140280045864384 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:21:09.732898 140280045864384 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:21:09.738948 140280045864384 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:21:09.915174 140280045864384 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:21:09.928499 140280045864384 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:21:09.940184 140280045864384 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:21:09.940505 140280045864384 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:21:10.361062 140280045864384 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:21:10.376746 140280045864384 estimator.py:1147] Done calling model_fn.
I0812 00:21:13.970937 140280045864384 tpu_estimator.py:499] TPU job name worker
I0812 00:21:14.084502 140280045864384 monitored_session.py:240] Graph was finalized.
I0812 00:21:14.649032 140280045864384 session_manager.py:500] Running local_init_op.
I0812 00:21:14.682744 140280045864384 session_manager.py:502] Done running local_init_op.
I0812 00:21:17.140319 140280045864384 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:21:29.648000 140280045864384 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:21:29.784270 140280045864384 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:21:29.784910 140280045864384 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:21:29.785424: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:21:29.790314 140280045864384 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:21:29.792448 140280045864384 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:21:29.796302 140280045864384 tpu_estimator.py:557] Init TPU system
I0812 00:22:12.564709 140280045864384 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 00:22:12.565846 140279286572800 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:22:12.566787 140279278180096 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:22:12.612922 140280045864384 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:22:12.613823 140280045864384 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:22:12.624933 140278799267584 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:22:12.728100 140278799267584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:22:17.009438 140279278180096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:22:21.610939 140280045864384 basic_session_run_hooks.py:262] loss = 0.25186744, step = 30
I0812 00:22:21.613096 140280045864384 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:22:37.023714 140280045864384 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:22:37.023999 140280045864384 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:22:37.024334 140279286572800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:22:37.024617 140279286572800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:22:37.024877 140280045864384 error_handling.py:96] infeed marked as finished
I0812 00:22:37.025074 140280045864384 tpu_estimator.py:602] Stop output thread controller
I0812 00:22:37.025130 140280045864384 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:22:37.025366 140279278180096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:22:37.025544 140279278180096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:22:37.025774 140280045864384 error_handling.py:96] outfeed marked as finished
I0812 00:22:37.025940 140280045864384 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:22:42.864995 140280045864384 estimator.py:368] Loss for final step: 0.25186744.
I0812 00:22:42.866074 140280045864384 error_handling.py:96] training_loop marked as finished
I0812 00:22:43.577982 140280045864384 estimator.py:1145] Calling model_fn.
E0812 00:22:44.262515 140280045864384 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:22:44.457132 140280045864384 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:22:44.485085 140280045864384 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:22:44.506608 140280045864384 estimator.py:1147] Done calling model_fn.
I0812 00:22:44.523772 140280045864384 evaluation.py:255] Starting evaluation at 2019-08-12T00:22:44Z
I0812 00:22:44.524015 140280045864384 tpu_estimator.py:499] TPU job name worker
I0812 00:22:44.598247 140280045864384 monitored_session.py:240] Graph was finalized.
W0812 00:22:44.598949 140280045864384 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:22:44.796169 140280045864384 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:22:47.324718 140280045864384 session_manager.py:500] Running local_init_op.
I0812 00:22:47.348676 140280045864384 session_manager.py:502] Done running local_init_op.
I0812 00:22:47.402930 140280045864384 tpu_estimator.py:557] Init TPU system
I0812 00:23:56.531986 140280045864384 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 00:23:56.533109 140279282640640 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:23:56.533863 140278799267584 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:23:56.600825 140280045864384 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:23:56.624893 140280045864384 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:23:56.625302 140280045864384 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:23:56.648993 140278790874880 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:23:56.786885 140278790874880 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:23:57.371546 140278799267584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:23:57.874092 140280045864384 evaluation.py:167] Evaluation [10/10]
I0812 00:23:57.874440 140280045864384 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:23:57.874527 140280045864384 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:23:57.874757 140279282640640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:23:57.875030 140279282640640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:23:57.875206 140280045864384 error_handling.py:96] infeed marked as finished
I0812 00:23:57.875359 140280045864384 tpu_estimator.py:602] Stop output thread controller
I0812 00:23:57.875411 140280045864384 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:23:57.875622 140278799267584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:23:57.875824 140278799267584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:23:57.876043 140280045864384 error_handling.py:96] outfeed marked as finished
I0812 00:23:57.876265 140280045864384 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:24:26.874655 140280045864384 evaluation.py:275] Finished evaluation at 2019-08-12-00:24:26
I0812 00:24:26.874982 140280045864384 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9356, global_step = 30, loss = 0.24317017
I0812 00:24:31.190099 140280045864384 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:24:31.956219 140280045864384 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.24317017, 'global_step': 30, 'accuracy': 0.9356}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565569284617886...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565569272.v3-8-tpu#1565569356650239...
Removing gs://yangyou-mnist/log/#1565569271930376...
Removing gs://yangyou-mnist/log/checkpoint#1565569353422753...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565569289143450...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565569276600854...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565569351175148...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565569350250544...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565569283724831...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565569355723083...
Removing gs://yangyou-mnist/log/eval/#1565569468532906...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565569468.v3-8-tpu#1565569471636682...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:24:35.716228 140408309331392 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:24:35.717019 140408309331392 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:24:35.719660 140408309331392 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:24:35.720463 140408309331392 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:24:35.721040 140408309331392 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:24:35.721172 140408309331392 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:24:36.136101 140408309331392 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:24:36.143254 140408309331392 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:24:36.153325 140408309331392 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:24:36.248055 140408309331392 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:24:36.248333 140408309331392 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:24:36.400046 140408309331392 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:24:36.444297 140408309331392 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:24:36.444591 140408309331392 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:24:36.536178 140408309331392 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb3359011d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb337adf190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:24:36.536523 140408309331392 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:24:36.868896 140408309331392 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:24:36.871821: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:24:36.883955 140408309331392 tpu_system_metadata.py:148] Found TPU system:
I0812 00:24:36.884262 140408309331392 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:24:36.884792 140408309331392 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:24:36.884850 140408309331392 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:24:36.884907 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:24:36.885210 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:24:36.885267 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:24:36.885318 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:24:36.885381 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:24:36.885430 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:24:36.885477 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:24:36.885524 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:24:36.885572 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:24:36.885672 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:24:36.885724 140408309331392 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:24:36.891571 140408309331392 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:24:36.903448 140408309331392 estimator.py:1145] Calling model_fn.
W0812 00:24:36.904004 140408309331392 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:24:37.177484 140408309331392 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:24:37.602809 140408309331392 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:24:37.664072 140408309331392 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:24:37.669737 140408309331392 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:24:37.842729 140408309331392 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:24:37.855882 140408309331392 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:24:37.867873 140408309331392 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:24:37.868192 140408309331392 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:24:38.286133 140408309331392 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:24:38.301233 140408309331392 estimator.py:1147] Done calling model_fn.
I0812 00:24:41.597839 140408309331392 tpu_estimator.py:499] TPU job name worker
I0812 00:24:41.709309 140408309331392 monitored_session.py:240] Graph was finalized.
I0812 00:24:42.294137 140408309331392 session_manager.py:500] Running local_init_op.
I0812 00:24:42.325869 140408309331392 session_manager.py:502] Done running local_init_op.
I0812 00:24:44.881784 140408309331392 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:24:57.303828 140408309331392 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:24:57.424014 140408309331392 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:24:57.424477 140408309331392 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:24:57.424883: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:24:57.429433 140408309331392 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:24:57.431590 140408309331392 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:24:57.435447 140408309331392 tpu_estimator.py:557] Init TPU system
I0812 00:25:40.566010 140408309331392 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 00:25:40.567148 140407415752448 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:25:40.567804 140407407359744 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:25:40.612564 140408309331392 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:25:40.613416 140408309331392 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:25:40.664602 140407398967040 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:25:40.775722 140407398967040 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:25:45.086083 140407407359744 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:25:49.724648 140408309331392 basic_session_run_hooks.py:262] loss = 0.22163293, step = 30
I0812 00:25:49.727351 140408309331392 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:26:03.499181 140408309331392 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:26:03.499483 140408309331392 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:26:03.499716 140407415752448 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:26:03.499820 140407415752448 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:26:03.499965 140408309331392 error_handling.py:96] infeed marked as finished
I0812 00:26:03.500066 140408309331392 tpu_estimator.py:602] Stop output thread controller
I0812 00:26:03.500116 140408309331392 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:26:03.500231 140407407359744 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:26:03.500308 140407407359744 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:26:03.500417 140408309331392 error_handling.py:96] outfeed marked as finished
I0812 00:26:03.500499 140408309331392 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:26:10.913054 140408309331392 estimator.py:368] Loss for final step: 0.22163293.
I0812 00:26:10.913942 140408309331392 error_handling.py:96] training_loop marked as finished
I0812 00:26:11.688729 140408309331392 estimator.py:1145] Calling model_fn.
E0812 00:26:12.405424 140408309331392 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:26:12.598440 140408309331392 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:26:12.625889 140408309331392 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:26:12.646842 140408309331392 estimator.py:1147] Done calling model_fn.
I0812 00:26:12.663682 140408309331392 evaluation.py:255] Starting evaluation at 2019-08-12T00:26:12Z
I0812 00:26:12.663916 140408309331392 tpu_estimator.py:499] TPU job name worker
I0812 00:26:12.738312 140408309331392 monitored_session.py:240] Graph was finalized.
W0812 00:26:12.739033 140408309331392 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:26:12.976741 140408309331392 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:26:15.678894 140408309331392 session_manager.py:500] Running local_init_op.
I0812 00:26:15.711854 140408309331392 session_manager.py:502] Done running local_init_op.
I0812 00:26:15.760205 140408309331392 tpu_estimator.py:557] Init TPU system
I0812 00:27:24.594434 140408309331392 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:27:24.595468 140407411820288 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:27:24.596080 140407403427584 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:27:24.661339 140408309331392 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:27:24.688718 140408309331392 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:27:24.689073 140408309331392 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:27:24.716238 140407390312192 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:27:24.823909 140407390312192 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:27:25.447971 140407403427584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:27:25.757780 140408309331392 evaluation.py:167] Evaluation [10/10]
I0812 00:27:25.758121 140408309331392 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:27:25.758189 140408309331392 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:27:25.758496 140407411820288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:27:25.758785 140407411820288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:27:25.758985 140408309331392 error_handling.py:96] infeed marked as finished
I0812 00:27:25.759171 140408309331392 tpu_estimator.py:602] Stop output thread controller
I0812 00:27:25.759268 140408309331392 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:27:25.759433 140407403427584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:27:25.759566 140407403427584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:27:25.759697 140408309331392 error_handling.py:96] outfeed marked as finished
I0812 00:27:25.759828 140408309331392 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:27:54.907140 140408309331392 evaluation.py:275] Finished evaluation at 2019-08-12-00:27:54
I0812 00:27:54.907540 140408309331392 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9419, global_step = 30, loss = 0.22432026
I0812 00:27:59.459728 140408309331392 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:28:00.378765 140408309331392 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.22432026, 'global_step': 30, 'accuracy': 0.9419}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565569492220366...
Removing gs://yangyou-mnist/log/#1565569479799369...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565569479.v3-8-tpu#1565569563177582...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565569557416550...
Removing gs://yangyou-mnist/log/checkpoint#1565569559740209...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565569556487356...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565569496803952...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565569484341039...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565569491312426...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565569562108095...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565569676.v3-8-tpu#1565569680052053...
Removing gs://yangyou-mnist/log/eval/#1565569676656416...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:28:04.230798 140297562219968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:28:04.231586 140297562219968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:28:04.234453 140297562219968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:28:04.235306 140297562219968 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:28:04.235924 140297562219968 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:28:04.236054 140297562219968 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:28:04.651946 140297562219968 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:28:04.657934 140297562219968 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:28:04.661403 140297562219968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:28:04.758326 140297562219968 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:28:04.758606 140297562219968 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:28:04.902185 140297562219968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:28:04.947674 140297562219968 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:28:04.947949 140297562219968 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:28:05.262985 140297562219968 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f996c854110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f996ea32190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:28:05.263353 140297562219968 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:28:05.614479 140297562219968 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:28:05.617481: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:28:05.630460 140297562219968 tpu_system_metadata.py:148] Found TPU system:
I0812 00:28:05.630708 140297562219968 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:28:05.631206 140297562219968 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:28:05.631270 140297562219968 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:28:05.631325 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:28:05.631620 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:28:05.631680 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:28:05.631730 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:28:05.631778 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:28:05.631839 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:28:05.631895 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:28:05.631942 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:28:05.631989 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:28:05.632035 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:28:05.632082 140297562219968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:28:05.637989 140297562219968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:28:05.650113 140297562219968 estimator.py:1145] Calling model_fn.
W0812 00:28:05.650686 140297562219968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:28:05.924164 140297562219968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:28:06.332914 140297562219968 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:28:06.399301 140297562219968 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:28:06.405560 140297562219968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:28:06.583937 140297562219968 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:28:06.597280 140297562219968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:28:06.609328 140297562219968 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:28:06.609694 140297562219968 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:28:07.024749 140297562219968 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:28:07.040501 140297562219968 estimator.py:1147] Done calling model_fn.
I0812 00:28:10.471421 140297562219968 tpu_estimator.py:499] TPU job name worker
I0812 00:28:10.584392 140297562219968 monitored_session.py:240] Graph was finalized.
I0812 00:28:11.141705 140297562219968 session_manager.py:500] Running local_init_op.
I0812 00:28:11.173508 140297562219968 session_manager.py:502] Done running local_init_op.
I0812 00:28:13.671505 140297562219968 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:28:26.131186 140297562219968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:28:26.238406 140297562219968 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:28:26.238871 140297562219968 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:28:26.239281: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:28:26.244466 140297562219968 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:28:26.246860 140297562219968 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:28:26.250813 140297562219968 tpu_estimator.py:557] Init TPU system
I0812 00:29:08.666534 140297562219968 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 00:29:08.667601 140296802772736 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:29:08.668615 140296794380032 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:29:08.717442 140297562219968 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:29:08.718328 140297562219968 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:29:08.770684 140296314681088 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:29:08.930161 140296314681088 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:29:13.148051 140296794380032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:29:17.644042 140297562219968 basic_session_run_hooks.py:262] loss = 0.2044119, step = 30
I0812 00:29:17.646799 140297562219968 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:29:32.797533 140297562219968 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:29:32.797883 140297562219968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:29:32.798194 140296802772736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:29:32.798566 140296802772736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:29:32.798816 140297562219968 error_handling.py:96] infeed marked as finished
I0812 00:29:32.799026 140297562219968 tpu_estimator.py:602] Stop output thread controller
I0812 00:29:32.799081 140297562219968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:29:32.799241 140296794380032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:29:32.799398 140296794380032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:29:32.799578 140297562219968 error_handling.py:96] outfeed marked as finished
I0812 00:29:32.799706 140297562219968 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:29:39.065736 140297562219968 estimator.py:368] Loss for final step: 0.2044119.
I0812 00:29:39.066529 140297562219968 error_handling.py:96] training_loop marked as finished
I0812 00:29:39.771833 140297562219968 estimator.py:1145] Calling model_fn.
E0812 00:29:40.471841 140297562219968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:29:40.661883 140297562219968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:29:40.689160 140297562219968 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:29:40.710120 140297562219968 estimator.py:1147] Done calling model_fn.
I0812 00:29:40.726680 140297562219968 evaluation.py:255] Starting evaluation at 2019-08-12T00:29:40Z
I0812 00:29:40.726916 140297562219968 tpu_estimator.py:499] TPU job name worker
I0812 00:29:40.802306 140297562219968 monitored_session.py:240] Graph was finalized.
W0812 00:29:40.803086 140297562219968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:29:41.002120 140297562219968 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:29:43.543967 140297562219968 session_manager.py:500] Running local_init_op.
I0812 00:29:43.575001 140297562219968 session_manager.py:502] Done running local_init_op.
I0812 00:29:43.630672 140297562219968 tpu_estimator.py:557] Init TPU system
I0812 00:30:52.591747 140297562219968 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:30:52.592729 140296798840576 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:30:52.593640 140296314681088 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:30:52.659055 140297562219968 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:30:52.687999 140297562219968 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:30:52.688378 140297562219968 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:30:52.760051 140296306288384 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:30:53.064692 140296306288384 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:30:53.465023 140296314681088 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:30:53.757652 140297562219968 evaluation.py:167] Evaluation [10/10]
I0812 00:30:53.757987 140297562219968 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:30:53.758158 140297562219968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:30:53.758430 140296798840576 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:30:53.758722 140296798840576 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:30:53.758897 140297562219968 error_handling.py:96] infeed marked as finished
I0812 00:30:53.759114 140297562219968 tpu_estimator.py:602] Stop output thread controller
I0812 00:30:53.759185 140297562219968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:30:53.759380 140296314681088 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:30:53.759556 140296314681088 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:30:53.759720 140297562219968 error_handling.py:96] outfeed marked as finished
I0812 00:30:53.759854 140297562219968 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:31:23.167251 140297562219968 evaluation.py:275] Finished evaluation at 2019-08-12-00:31:23
I0812 00:31:23.167643 140297562219968 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9477, global_step = 30, loss = 0.18817416
I0812 00:31:27.590828 140297562219968 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:31:28.697722 140297562219968 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.18817416, 'global_step': 30, 'accuracy': 0.9477}

Removing gs://yangyou-mnist/log/#1565569688557572...
Removing gs://yangyou-mnist/log/checkpoint#1565569769252660...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565569688.v3-8-tpu#1565569772480839...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565569701136599...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565569705633021...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565569766094301...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565569693127627...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565569766941929...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565569700184189...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565569771486798...
Removing gs://yangyou-mnist/log/eval/#1565569884811848...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565569884.v3-8-tpu#1565569888364072...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:31:32.548903 139820404676032 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:31:32.549844 139820404676032 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:31:32.552412 139820404676032 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:31:32.553208 139820404676032 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:31:32.553854 139820404676032 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:31:32.553992 139820404676032 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:31:32.956954 139820404676032 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:31:32.963551 139820404676032 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:31:32.967427 139820404676032 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:31:33.015572 139820404676032 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:31:33.015896 139820404676032 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:31:33.172877 139820404676032 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:31:33.226140 139820404676032 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:31:33.226433 139820404676032 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:31:33.424169 139820404676032 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2a53b6f150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2a55d4d190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:31:33.424520 139820404676032 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:31:33.750561 139820404676032 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:31:33.753703: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:31:33.770540 139820404676032 tpu_system_metadata.py:148] Found TPU system:
I0812 00:31:33.770795 139820404676032 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:31:33.771378 139820404676032 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:31:33.771444 139820404676032 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:31:33.771497 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:31:33.771795 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:31:33.771852 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:31:33.771914 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:31:33.771961 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:31:33.772010 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:31:33.772062 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:31:33.772123 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:31:33.772171 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:31:33.772217 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:31:33.772274 139820404676032 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:31:33.778481 139820404676032 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:31:33.790838 139820404676032 estimator.py:1145] Calling model_fn.
W0812 00:31:33.791445 139820404676032 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:31:34.542798 139820404676032 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:31:34.948488 139820404676032 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:31:35.007762 139820404676032 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:31:35.013339 139820404676032 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:31:35.188990 139820404676032 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:31:35.202706 139820404676032 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:31:35.218072 139820404676032 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:31:35.218385 139820404676032 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:31:35.635943 139820404676032 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:31:35.651263 139820404676032 estimator.py:1147] Done calling model_fn.
I0812 00:31:39.075625 139820404676032 tpu_estimator.py:499] TPU job name worker
I0812 00:31:39.190337 139820404676032 monitored_session.py:240] Graph was finalized.
I0812 00:31:39.779443 139820404676032 session_manager.py:500] Running local_init_op.
I0812 00:31:39.818747 139820404676032 session_manager.py:502] Done running local_init_op.
I0812 00:31:42.286113 139820404676032 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:31:54.672194 139820404676032 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:31:54.788009 139820404676032 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:31:54.788439 139820404676032 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:31:54.788841: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:31:54.794199 139820404676032 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:31:54.796262 139820404676032 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:31:54.800026 139820404676032 tpu_estimator.py:557] Init TPU system
I0812 00:32:36.666668 139820404676032 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 00:32:36.667546 139819371984640 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:32:36.668381 139819363591936 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:32:36.712452 139820404676032 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:32:36.713314 139820404676032 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:32:36.724385 139819355199232 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:32:36.837002 139819355199232 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:32:41.245137 139819363591936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:32:46.033150 139820404676032 basic_session_run_hooks.py:262] loss = 0.12097128, step = 30
I0812 00:32:46.036083 139820404676032 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:33:00.069565 139820404676032 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:33:00.069967 139820404676032 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:33:00.071506 139819371984640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:33:00.071669 139819371984640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:33:00.071924 139820404676032 error_handling.py:96] infeed marked as finished
I0812 00:33:00.072036 139820404676032 tpu_estimator.py:602] Stop output thread controller
I0812 00:33:00.072093 139820404676032 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:33:00.072201 139819363591936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:33:00.072293 139819363591936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:33:00.072412 139820404676032 error_handling.py:96] outfeed marked as finished
I0812 00:33:00.072488 139820404676032 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:33:06.975117 139820404676032 estimator.py:368] Loss for final step: 0.12097128.
I0812 00:33:06.975929 139820404676032 error_handling.py:96] training_loop marked as finished
I0812 00:33:07.859754 139820404676032 estimator.py:1145] Calling model_fn.
E0812 00:33:08.559166 139820404676032 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:33:08.748760 139820404676032 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:33:08.775592 139820404676032 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:33:08.796695 139820404676032 estimator.py:1147] Done calling model_fn.
I0812 00:33:08.813462 139820404676032 evaluation.py:255] Starting evaluation at 2019-08-12T00:33:08Z
I0812 00:33:08.813738 139820404676032 tpu_estimator.py:499] TPU job name worker
I0812 00:33:08.888865 139820404676032 monitored_session.py:240] Graph was finalized.
W0812 00:33:08.889693 139820404676032 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:33:09.087125 139820404676032 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:33:11.640611 139820404676032 session_manager.py:500] Running local_init_op.
I0812 00:33:11.663261 139820404676032 session_manager.py:502] Done running local_init_op.
I0812 00:33:11.709136 139820404676032 tpu_estimator.py:557] Init TPU system
I0812 00:34:20.635113 139820404676032 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:34:20.636082 139819371984640 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:34:20.636476 139819363591936 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:34:20.709398 139820404676032 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:34:20.733448 139820404676032 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:34:20.733867 139820404676032 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:34:20.765700 139819355199232 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:34:20.920613 139819355199232 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:34:21.522907 139819363591936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:34:21.817497 139820404676032 evaluation.py:167] Evaluation [10/10]
I0812 00:34:21.817893 139820404676032 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:34:21.817969 139820404676032 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:34:21.818207 139819371984640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:34:21.818319 139819371984640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:34:21.818456 139820404676032 error_handling.py:96] infeed marked as finished
I0812 00:34:21.818558 139820404676032 tpu_estimator.py:602] Stop output thread controller
I0812 00:34:21.818608 139820404676032 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:34:21.818720 139819363591936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:34:21.818789 139819363591936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:34:21.818902 139820404676032 error_handling.py:96] outfeed marked as finished
I0812 00:34:21.818983 139820404676032 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:34:50.992660 139820404676032 evaluation.py:275] Finished evaluation at 2019-08-12-00:34:50
I0812 00:34:50.992995 139820404676032 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9679, global_step = 30, loss = 0.11483078
I0812 00:34:55.882585 139820404676032 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:34:56.799371 139820404676032 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.11483078, 'global_step': 30, 'accuracy': 0.9679}

Removing gs://yangyou-mnist/log/#1565569897203491...
Removing gs://yangyou-mnist/log/checkpoint#1565569976123033...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565569897.v3-8-tpu#1565569979748262...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565569901741388...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565569909678638...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565569914170913...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565569972899107...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565569908844899...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565569973824107...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565569978474116...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565570093231904...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565570093.v3-8-tpu#1565570096480063...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:35:00.613256 140270595564992 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:35:00.614150 140270595564992 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:35:00.616729 140270595564992 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:35:00.617552 140270595564992 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:35:00.618159 140270595564992 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:35:00.618285 140270595564992 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:35:01.027491 140270595564992 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:35:01.034193 140270595564992 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:35:01.037864 140270595564992 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:35:01.087937 140270595564992 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:35:01.088222 140270595564992 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:35:01.190773 140270595564992 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:35:01.282917 140270595564992 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:35:01.283204 140270595564992 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:35:01.384358 140270595564992 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f93252ec090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f93274ca190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:35:01.384717 140270595564992 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:35:01.719295 140270595564992 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:35:01.722189: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:35:01.737174 140270595564992 tpu_system_metadata.py:148] Found TPU system:
I0812 00:35:01.737430 140270595564992 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:35:01.738063 140270595564992 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:35:01.738126 140270595564992 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:35:01.738269 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:35:01.738596 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:35:01.738656 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:35:01.738713 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:35:01.738761 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:35:01.738810 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:35:01.738857 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:35:01.738903 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:35:01.738976 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:35:01.739025 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:35:01.739073 140270595564992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:35:01.745021 140270595564992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:35:01.757682 140270595564992 estimator.py:1145] Calling model_fn.
W0812 00:35:01.758306 140270595564992 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:35:02.025665 140270595564992 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:35:02.545027 140270595564992 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:35:02.606920 140270595564992 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:35:02.612962 140270595564992 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:35:02.792542 140270595564992 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:35:02.806601 140270595564992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:35:02.818481 140270595564992 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:35:02.818790 140270595564992 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:35:03.247843 140270595564992 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:35:03.263974 140270595564992 estimator.py:1147] Done calling model_fn.
I0812 00:35:06.765860 140270595564992 tpu_estimator.py:499] TPU job name worker
I0812 00:35:06.881371 140270595564992 monitored_session.py:240] Graph was finalized.
I0812 00:35:07.447665 140270595564992 session_manager.py:500] Running local_init_op.
I0812 00:35:07.478286 140270595564992 session_manager.py:502] Done running local_init_op.
I0812 00:35:10.444199 140270595564992 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:35:24.318478 140270595564992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:35:24.434201 140270595564992 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:35:24.434675 140270595564992 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:35:24.435140: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:35:24.439420 140270595564992 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:35:24.441504 140270595564992 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:35:24.445899 140270595564992 tpu_estimator.py:557] Init TPU system
I0812 00:36:04.655632 140270595564992 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0812 00:36:04.656708 140269827892992 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:36:04.658091 140269819500288 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:36:04.706572 140270595564992 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:36:04.707436 140270595564992 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:36:04.763040 140269336917760 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:36:04.868328 140269336917760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:36:09.256360 140269819500288 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:36:13.807182 140270595564992 basic_session_run_hooks.py:262] loss = 0.116219625, step = 30
I0812 00:36:13.809425 140270595564992 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:36:30.088287 140270595564992 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:36:30.088571 140270595564992 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:36:30.088947 140269827892992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:36:30.089296 140269827892992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:36:30.089494 140270595564992 error_handling.py:96] infeed marked as finished
I0812 00:36:30.089736 140270595564992 tpu_estimator.py:602] Stop output thread controller
I0812 00:36:30.089833 140270595564992 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:36:30.090025 140269819500288 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:36:30.090181 140269819500288 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:36:30.090328 140270595564992 error_handling.py:96] outfeed marked as finished
I0812 00:36:30.090456 140270595564992 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:36:35.002372 140270595564992 estimator.py:368] Loss for final step: 0.116219625.
I0812 00:36:35.003264 140270595564992 error_handling.py:96] training_loop marked as finished
I0812 00:36:36.076211 140270595564992 estimator.py:1145] Calling model_fn.
E0812 00:36:36.780812 140270595564992 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:36:36.973853 140270595564992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:36:37.001846 140270595564992 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:36:37.022304 140270595564992 estimator.py:1147] Done calling model_fn.
I0812 00:36:37.039655 140270595564992 evaluation.py:255] Starting evaluation at 2019-08-12T00:36:37Z
I0812 00:36:37.039901 140270595564992 tpu_estimator.py:499] TPU job name worker
I0812 00:36:37.115603 140270595564992 monitored_session.py:240] Graph was finalized.
W0812 00:36:37.116343 140270595564992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:36:37.320913 140270595564992 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:36:39.918900 140270595564992 session_manager.py:500] Running local_init_op.
I0812 00:36:39.943124 140270595564992 session_manager.py:502] Done running local_init_op.
I0812 00:36:39.999041 140270595564992 tpu_estimator.py:557] Init TPU system
I0812 00:37:48.685556 140270595564992 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:37:48.686712 140269827892992 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:37:48.687443 140269819500288 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:37:48.757184 140270595564992 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:37:48.782144 140270595564992 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:37:48.782514 140270595564992 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:37:48.811332 140269336917760 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:37:49.007246 140269336917760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:37:49.563360 140269819500288 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:37:49.873569 140270595564992 evaluation.py:167] Evaluation [10/10]
I0812 00:37:49.873982 140270595564992 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:37:49.874066 140270595564992 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:37:49.874298 140269827892992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:37:49.874572 140269827892992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:37:49.874754 140270595564992 error_handling.py:96] infeed marked as finished
I0812 00:37:49.874942 140270595564992 tpu_estimator.py:602] Stop output thread controller
I0812 00:37:49.875001 140270595564992 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:37:49.875193 140269819500288 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:37:49.875397 140269819500288 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:37:49.875562 140270595564992 error_handling.py:96] outfeed marked as finished
I0812 00:37:49.875685 140270595564992 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:38:19.101928 140270595564992 evaluation.py:275] Finished evaluation at 2019-08-12-00:38:19
I0812 00:38:19.102260 140270595564992 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9713, global_step = 30, loss = 0.10234994
I0812 00:38:23.531721 140270595564992 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:38:24.413347 140270595564992 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10234994, 'global_step': 30, 'accuracy': 0.9713}

Removing gs://yangyou-mnist/log/#1565570104834186...
Removing gs://yangyou-mnist/log/checkpoint#1565570186544243...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565570118084356...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565570105.v3-8-tpu#1565570189756157...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565570123818358...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565570117150721...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565570109898358...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565570183413410...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565570184281440...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565570188832680...
Removing gs://yangyou-mnist/log/eval/#1565570300774123...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565570300.v3-8-tpu#1565570304087727...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:38:28.287379 140170613765568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:38:28.288182 140170613765568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:38:28.290790 140170613765568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:38:28.291574 140170613765568 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:38:28.292139 140170613765568 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:38:28.292260 140170613765568 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:38:28.711237 140170613765568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:38:28.717109 140170613765568 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:38:28.720563 140170613765568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:38:28.771255 140170613765568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:38:28.771543 140170613765568 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:38:29.038291 140170613765568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:38:29.082535 140170613765568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:38:29.082823 140170613765568 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:38:29.195702 140170613765568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f7bddcd9050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f7bdfeb7190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:38:29.196083 140170613765568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:38:29.544715 140170613765568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:38:29.547618: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:38:29.560101 140170613765568 tpu_system_metadata.py:148] Found TPU system:
I0812 00:38:29.560348 140170613765568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:38:29.560863 140170613765568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:38:29.560923 140170613765568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:38:29.560987 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:38:29.561276 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:38:29.561336 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:38:29.561388 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:38:29.561435 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:38:29.561510 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:38:29.561561 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:38:29.561661 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:38:29.561714 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:38:29.561762 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:38:29.561826 140170613765568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:38:29.567907 140170613765568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:38:29.580323 140170613765568 estimator.py:1145] Calling model_fn.
W0812 00:38:29.580924 140170613765568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:38:29.847696 140170613765568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:38:30.355031 140170613765568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:38:30.421541 140170613765568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:38:30.427510 140170613765568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:38:30.608769 140170613765568 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:38:30.622466 140170613765568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:38:30.634375 140170613765568 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:38:30.634746 140170613765568 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:38:31.052617 140170613765568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:38:31.068007 140170613765568 estimator.py:1147] Done calling model_fn.
I0812 00:38:34.362407 140170613765568 tpu_estimator.py:499] TPU job name worker
I0812 00:38:34.477155 140170613765568 monitored_session.py:240] Graph was finalized.
I0812 00:38:35.059906 140170613765568 session_manager.py:500] Running local_init_op.
I0812 00:38:35.092180 140170613765568 session_manager.py:502] Done running local_init_op.
I0812 00:38:37.610416 140170613765568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:38:49.506762 140170613765568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:38:49.614164 140170613765568 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:38:49.614697 140170613765568 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:38:49.615098: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:38:49.619538 140170613765568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:38:49.621704 140170613765568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:38:49.626564 140170613765568 tpu_estimator.py:557] Init TPU system
I0812 00:39:32.648441 140170613765568 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 00:39:32.649513 140169720088320 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:39:32.650243 140169711695616 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:39:32.696496 140170613765568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:39:32.697433 140170613765568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:39:32.748888 140169703302912 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:39:32.855350 140169703302912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 00:39:37.252384 140169711695616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:39:41.854470 140170613765568 basic_session_run_hooks.py:262] loss = 0.099621244, step = 30
I0812 00:39:41.856817 140170613765568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:39:54.946407 140170613765568 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:39:54.946728 140170613765568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:39:54.947047 140169720088320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:39:54.947374 140169720088320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:39:54.947604 140170613765568 error_handling.py:96] infeed marked as finished
I0812 00:39:54.947786 140170613765568 tpu_estimator.py:602] Stop output thread controller
I0812 00:39:54.947839 140170613765568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:39:54.948023 140169711695616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:39:54.948208 140169711695616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:39:54.948378 140170613765568 error_handling.py:96] outfeed marked as finished
I0812 00:39:54.948498 140170613765568 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:40:02.993331 140170613765568 estimator.py:368] Loss for final step: 0.099621244.
I0812 00:40:02.994200 140170613765568 error_handling.py:96] training_loop marked as finished
I0812 00:40:03.810190 140170613765568 estimator.py:1145] Calling model_fn.
E0812 00:40:04.494842 140170613765568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:40:04.687401 140170613765568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:40:04.714935 140170613765568 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:40:04.735862 140170613765568 estimator.py:1147] Done calling model_fn.
I0812 00:40:04.753443 140170613765568 evaluation.py:255] Starting evaluation at 2019-08-12T00:40:04Z
I0812 00:40:04.753746 140170613765568 tpu_estimator.py:499] TPU job name worker
I0812 00:40:04.828664 140170613765568 monitored_session.py:240] Graph was finalized.
W0812 00:40:04.829418 140170613765568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:40:05.021472 140170613765568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:40:07.498035 140170613765568 session_manager.py:500] Running local_init_op.
I0812 00:40:07.527549 140170613765568 session_manager.py:502] Done running local_init_op.
I0812 00:40:07.579086 140170613765568 tpu_estimator.py:557] Init TPU system
I0812 00:41:16.575468 140170613765568 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:41:16.576442 140169716156160 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:41:16.577004 140169707763456 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:41:16.642386 140170613765568 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:41:16.668703 140170613765568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:41:16.669035 140170613765568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:41:16.702980 140169694648064 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:41:16.824297 140169694648064 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:41:17.430692 140169707763456 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:41:17.780832 140170613765568 evaluation.py:167] Evaluation [10/10]
I0812 00:41:17.781168 140170613765568 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:41:17.781235 140170613765568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:41:17.781485 140169716156160 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:41:17.781786 140169716156160 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:41:17.782007 140170613765568 error_handling.py:96] infeed marked as finished
I0812 00:41:17.782174 140170613765568 tpu_estimator.py:602] Stop output thread controller
I0812 00:41:17.782237 140170613765568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:41:17.782427 140169707763456 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:41:17.782573 140169707763456 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:41:17.782731 140170613765568 error_handling.py:96] outfeed marked as finished
I0812 00:41:17.782857 140170613765568 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:41:46.922985 140170613765568 evaluation.py:275] Finished evaluation at 2019-08-12-00:41:46
I0812 00:41:46.923377 140170613765568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9763, global_step = 30, loss = 0.07754213
I0812 00:41:51.294327 140170613765568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:41:52.096646 140170613765568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07754213, 'global_step': 30, 'accuracy': 0.9763}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565570324840849...
Removing gs://yangyou-mnist/log/checkpoint#1565570391380830...
Removing gs://yangyou-mnist/log/#1565570312560601...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565570312.v3-8-tpu#1565570394609243...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565570317069813...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565570323936233...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565570329013027...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565570388237576...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565570389197424...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565570393654356...
Removing gs://yangyou-mnist/log/eval/#1565570508640721...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565570508.v3-8-tpu#1565570511775985...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:41:55.956252 140606501778880 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:41:55.957052 140606501778880 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:41:55.959918 140606501778880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:41:55.960726 140606501778880 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:41:55.961324 140606501778880 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:41:55.961448 140606501778880 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:41:56.363233 140606501778880 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:41:56.369733 140606501778880 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:41:56.373312 140606501778880 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:41:56.468204 140606501778880 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:41:56.468492 140606501778880 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:41:56.738689 140606501778880 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:41:56.782812 140606501778880 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:41:56.783103 140606501778880 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:41:57.042656 140606501778880 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe15ac0d210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe15cdeb190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:41:57.043026 140606501778880 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:41:57.383980 140606501778880 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:41:57.387091: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:41:57.399200 140606501778880 tpu_system_metadata.py:148] Found TPU system:
I0812 00:41:57.399491 140606501778880 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:41:57.400037 140606501778880 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:41:57.400099 140606501778880 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:41:57.400152 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:41:57.400522 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:41:57.400580 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:41:57.400631 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:41:57.400681 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:41:57.400728 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:41:57.400775 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:41:57.400823 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:41:57.400868 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:41:57.400914 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:41:57.400965 140606501778880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:41:57.407164 140606501778880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:41:57.419555 140606501778880 estimator.py:1145] Calling model_fn.
W0812 00:41:57.420154 140606501778880 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:41:57.691967 140606501778880 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:41:58.209995 140606501778880 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:41:58.270405 140606501778880 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:41:58.275968 140606501778880 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:41:58.449048 140606501778880 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:41:58.462308 140606501778880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:41:58.473802 140606501778880 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:41:58.474129 140606501778880 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:41:58.886493 140606501778880 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:41:58.901674 140606501778880 estimator.py:1147] Done calling model_fn.
I0812 00:42:02.423548 140606501778880 tpu_estimator.py:499] TPU job name worker
I0812 00:42:02.539197 140606501778880 monitored_session.py:240] Graph was finalized.
I0812 00:42:03.109977 140606501778880 session_manager.py:500] Running local_init_op.
I0812 00:42:03.141148 140606501778880 session_manager.py:502] Done running local_init_op.
I0812 00:42:05.836293 140606501778880 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:42:18.404783 140606501778880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:42:18.520636 140606501778880 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:42:18.521137 140606501778880 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:42:18.521549: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:42:18.526618 140606501778880 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:42:18.528768 140606501778880 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:42:18.532444 140606501778880 tpu_estimator.py:557] Init TPU system
I0812 00:43:00.729507 140606501778880 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 00:43:00.730334 140605602649856 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:43:00.730818 140605594257152 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:43:00.775207 140606501778880 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:43:00.777229 140606501778880 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:43:00.786871 140605585864448 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:43:00.995956 140605585864448 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:43:05.182799 140605594257152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:43:09.643821 140606501778880 basic_session_run_hooks.py:262] loss = 0.09898193, step = 30
I0812 00:43:09.646095 140606501778880 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:43:23.342797 140606501778880 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:43:23.343112 140606501778880 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:43:23.343446 140605602649856 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:43:23.343770 140605602649856 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:43:23.344043 140606501778880 error_handling.py:96] infeed marked as finished
I0812 00:43:23.344270 140606501778880 tpu_estimator.py:602] Stop output thread controller
I0812 00:43:23.344327 140606501778880 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:43:23.344501 140605594257152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:43:23.344665 140605594257152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:43:23.344805 140606501778880 error_handling.py:96] outfeed marked as finished
I0812 00:43:23.344923 140606501778880 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:43:31.112436 140606501778880 estimator.py:368] Loss for final step: 0.09898193.
I0812 00:43:31.113255 140606501778880 error_handling.py:96] training_loop marked as finished
I0812 00:43:31.908457 140606501778880 estimator.py:1145] Calling model_fn.
E0812 00:43:32.593254 140606501778880 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:43:32.786410 140606501778880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:43:32.813766 140606501778880 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:43:32.834988 140606501778880 estimator.py:1147] Done calling model_fn.
I0812 00:43:32.852545 140606501778880 evaluation.py:255] Starting evaluation at 2019-08-12T00:43:32Z
I0812 00:43:32.852788 140606501778880 tpu_estimator.py:499] TPU job name worker
I0812 00:43:32.928807 140606501778880 monitored_session.py:240] Graph was finalized.
W0812 00:43:32.929619 140606501778880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:43:33.124501 140606501778880 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:43:35.737458 140606501778880 session_manager.py:500] Running local_init_op.
I0812 00:43:35.767250 140606501778880 session_manager.py:502] Done running local_init_op.
I0812 00:43:35.818512 140606501778880 tpu_estimator.py:557] Init TPU system
I0812 00:44:44.684755 140606501778880 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:44:44.685576 140605602649856 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:44:44.686136 140605594257152 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:44:44.755171 140606501778880 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:44:44.778891 140606501778880 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:44:44.779211 140606501778880 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:44:44.810978 140605585864448 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:44:44.920262 140605585864448 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:44:45.530073 140605594257152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:44:46.037966 140606501778880 evaluation.py:167] Evaluation [10/10]
I0812 00:44:46.038299 140606501778880 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:44:46.038384 140606501778880 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:44:46.038567 140605602649856 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:44:46.038657 140605602649856 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:44:46.038789 140606501778880 error_handling.py:96] infeed marked as finished
I0812 00:44:46.038872 140606501778880 tpu_estimator.py:602] Stop output thread controller
I0812 00:44:46.038925 140606501778880 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:44:46.039035 140605594257152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:44:46.039118 140605594257152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:44:46.039239 140606501778880 error_handling.py:96] outfeed marked as finished
I0812 00:44:46.039319 140606501778880 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:45:15.017187 140606501778880 evaluation.py:275] Finished evaluation at 2019-08-12-00:45:15
I0812 00:45:15.017535 140606501778880 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9711, global_step = 30, loss = 0.08416255
I0812 00:45:19.398912 140606501778880 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:45:20.276983 140606501778880 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08416255, 'global_step': 30, 'accuracy': 0.9711}

Removing gs://yangyou-mnist/log/#1565570520506597...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565570533366192...
Removing gs://yangyou-mnist/log/checkpoint#1565570599647285...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565570537883813...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565570597295016...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565570520.v3-8-tpu#1565570602995873...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565570525290593...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565570596385180...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565570532400773...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565570602095895...
Removing gs://yangyou-mnist/log/eval/#1565570716697477...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565570716.v3-8-tpu#1565570719952344...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:45:24.077199 140649459738048 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:45:24.078212 140649459738048 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:45:24.081223 140649459738048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:45:24.082109 140649459738048 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:45:24.082704 140649459738048 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:45:24.082830 140649459738048 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:45:24.506650 140649459738048 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:45:24.513905 140649459738048 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:45:24.517946 140649459738048 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:45:24.566138 140649459738048 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:45:24.566426 140649459738048 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:45:24.788269 140649459738048 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:45:24.834157 140649459738048 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:45:24.834429 140649459738048 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:45:24.988218 140649459738048 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7feb5b3dd290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7feb5d5d2190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:45:24.988594 140649459738048 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:45:25.363821 140649459738048 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:45:25.366881: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:45:25.380393 140649459738048 tpu_system_metadata.py:148] Found TPU system:
I0812 00:45:25.380642 140649459738048 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:45:25.381139 140649459738048 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:45:25.381201 140649459738048 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:45:25.381254 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:45:25.381539 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:45:25.381650 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:45:25.381716 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:45:25.381767 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:45:25.381814 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:45:25.381863 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:45:25.381910 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:45:25.381956 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:45:25.382004 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:45:25.382060 140649459738048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:45:25.388056 140649459738048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:45:25.401180 140649459738048 estimator.py:1145] Calling model_fn.
W0812 00:45:25.401842 140649459738048 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:45:25.677289 140649459738048 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:45:26.108730 140649459738048 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:45:26.170113 140649459738048 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:45:26.176004 140649459738048 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:45:26.358350 140649459738048 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:45:26.372113 140649459738048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:45:26.388474 140649459738048 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:45:26.388791 140649459738048 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:45:26.807023 140649459738048 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:45:26.822750 140649459738048 estimator.py:1147] Done calling model_fn.
I0812 00:45:30.381903 140649459738048 tpu_estimator.py:499] TPU job name worker
I0812 00:45:30.502007 140649459738048 monitored_session.py:240] Graph was finalized.
I0812 00:45:31.078257 140649459738048 session_manager.py:500] Running local_init_op.
I0812 00:45:31.110080 140649459738048 session_manager.py:502] Done running local_init_op.
I0812 00:45:34.225038 140649459738048 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:45:46.831926 140649459738048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:45:46.948940 140649459738048 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:45:46.949538 140649459738048 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:45:46.950119: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:45:46.954730 140649459738048 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:45:46.956950 140649459738048 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:45:46.961333 140649459738048 tpu_estimator.py:557] Init TPU system
I0812 00:46:28.674662 140649459738048 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 00:46:28.675771 140648426497792 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:46:28.676605 140648418105088 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:46:28.725143 140649459738048 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:46:28.727237 140649459738048 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:46:28.737216 140648409712384 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:46:28.845681 140648409712384 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 00:46:33.507858 140648418105088 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:46:38.145302 140649459738048 basic_session_run_hooks.py:262] loss = 0.09920947, step = 30
I0812 00:46:38.147914 140649459738048 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:46:50.798090 140649459738048 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:46:50.798392 140649459738048 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:46:50.798734 140648426497792 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:46:50.799021 140648426497792 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:46:50.799235 140649459738048 error_handling.py:96] infeed marked as finished
I0812 00:46:50.799429 140649459738048 tpu_estimator.py:602] Stop output thread controller
I0812 00:46:50.799489 140649459738048 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:46:50.799689 140648418105088 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:46:50.799830 140648418105088 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:46:50.799974 140649459738048 error_handling.py:96] outfeed marked as finished
I0812 00:46:50.800091 140649459738048 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:46:58.983215 140649459738048 estimator.py:368] Loss for final step: 0.09920947.
I0812 00:46:58.984036 140649459738048 error_handling.py:96] training_loop marked as finished
I0812 00:46:59.856904 140649459738048 estimator.py:1145] Calling model_fn.
E0812 00:47:00.589890 140649459738048 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:47:00.781866 140649459738048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:47:00.809223 140649459738048 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:47:00.830090 140649459738048 estimator.py:1147] Done calling model_fn.
I0812 00:47:00.846332 140649459738048 evaluation.py:255] Starting evaluation at 2019-08-12T00:47:00Z
I0812 00:47:00.846554 140649459738048 tpu_estimator.py:499] TPU job name worker
I0812 00:47:00.920207 140649459738048 monitored_session.py:240] Graph was finalized.
W0812 00:47:00.920938 140649459738048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:47:01.101831 140649459738048 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:47:03.836493 140649459738048 session_manager.py:500] Running local_init_op.
I0812 00:47:03.860682 140649459738048 session_manager.py:502] Done running local_init_op.
I0812 00:47:03.907711 140649459738048 tpu_estimator.py:557] Init TPU system
I0812 00:48:12.529001 140649459738048 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:48:12.530029 140648426497792 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:48:12.530872 140648418105088 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:48:12.598258 140649459738048 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:48:12.625395 140649459738048 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:48:12.625781 140649459738048 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:48:12.652543 140648409712384 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:48:12.751137 140648409712384 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:48:13.403059 140648418105088 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:48:13.778574 140649459738048 evaluation.py:167] Evaluation [10/10]
I0812 00:48:13.778930 140649459738048 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:48:13.779000 140649459738048 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:48:13.779258 140648426497792 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:48:13.779529 140648426497792 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:48:13.779736 140649459738048 error_handling.py:96] infeed marked as finished
I0812 00:48:13.779932 140649459738048 tpu_estimator.py:602] Stop output thread controller
I0812 00:48:13.779994 140649459738048 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:48:13.780150 140648418105088 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:48:13.780303 140648418105088 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:48:13.780462 140649459738048 error_handling.py:96] outfeed marked as finished
I0812 00:48:13.780638 140649459738048 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:48:42.847846 140649459738048 evaluation.py:275] Finished evaluation at 2019-08-12-00:48:42
I0812 00:48:42.848182 140649459738048 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9746, global_step = 30, loss = 0.08917869
I0812 00:48:47.540280 140649459738048 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:48:48.375943 140649459738048 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08917869, 'global_step': 30, 'accuracy': 0.9746}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565570741984669...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565570746333002...
Removing gs://yangyou-mnist/log/#1565570728429179...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565570804609374...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565570733632039...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565570805417746...
Removing gs://yangyou-mnist/log/checkpoint#1565570807592504...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565570728.v3-8-tpu#1565570810502941...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565570741130166...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565570809629615...
Removing gs://yangyou-mnist/log/eval/#1565570924608787...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565570924.v3-8-tpu#1565570928056709...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:48:52.219393 139692439672256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:48:52.220158 139692439672256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:48:52.223355 139692439672256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:48:52.224158 139692439672256 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:48:52.224731 139692439672256 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:48:52.224864 139692439672256 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:48:52.635257 139692439672256 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:48:52.641119 139692439672256 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:48:52.644800 139692439672256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:48:52.691844 139692439672256 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:48:52.692116 139692439672256 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:48:52.807037 139692439672256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:48:52.853029 139692439672256 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:48:52.853348 139692439672256 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:48:53.097187 139692439672256 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0c8867f250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0c8a85d190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:48:53.097690 139692439672256 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:48:53.421394 139692439672256 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:48:53.424445: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:48:53.436794 139692439672256 tpu_system_metadata.py:148] Found TPU system:
I0812 00:48:53.437033 139692439672256 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:48:53.437553 139692439672256 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:48:53.437673 139692439672256 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:48:53.437732 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:48:53.438056 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:48:53.438113 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:48:53.438164 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:48:53.438213 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:48:53.438273 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:48:53.438322 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:48:53.438369 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:48:53.438416 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:48:53.438461 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:48:53.438508 139692439672256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:48:53.444597 139692439672256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:48:53.456736 139692439672256 estimator.py:1145] Calling model_fn.
W0812 00:48:53.457329 139692439672256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:48:53.741749 139692439672256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:48:54.264440 139692439672256 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:48:54.326122 139692439672256 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:48:54.331742 139692439672256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:48:54.514560 139692439672256 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:48:54.528182 139692439672256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:48:54.539998 139692439672256 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:48:54.540317 139692439672256 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:48:54.954030 139692439672256 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:48:54.969481 139692439672256 estimator.py:1147] Done calling model_fn.
I0812 00:48:58.361438 139692439672256 tpu_estimator.py:499] TPU job name worker
I0812 00:48:58.475601 139692439672256 monitored_session.py:240] Graph was finalized.
I0812 00:48:59.057321 139692439672256 session_manager.py:500] Running local_init_op.
I0812 00:48:59.088439 139692439672256 session_manager.py:502] Done running local_init_op.
I0812 00:49:01.803586 139692439672256 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:49:17.206705 139692439672256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:49:17.324842 139692439672256 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:49:17.325318 139692439672256 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:49:17.325763: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:49:17.330487 139692439672256 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:49:17.332549 139692439672256 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:49:17.336071 139692439672256 tpu_estimator.py:557] Init TPU system
I0812 00:49:56.672482 139692439672256 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0812 00:49:56.673468 139691747522304 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:49:56.674004 139691261163264 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:49:56.725344 139692439672256 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:49:56.727996 139692439672256 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:49:56.738784 139691252770560 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:49:56.893337 139691252770560 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:50:01.392710 139691261163264 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:50:06.081202 139692439672256 basic_session_run_hooks.py:262] loss = 0.33073694, step = 30
I0812 00:50:06.083599 139692439672256 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:50:19.492166 139692439672256 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:50:19.492451 139692439672256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:50:19.492713 139691747522304 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:50:19.492891 139691747522304 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:50:19.493045 139692439672256 error_handling.py:96] infeed marked as finished
I0812 00:50:19.493171 139692439672256 tpu_estimator.py:602] Stop output thread controller
I0812 00:50:19.493223 139692439672256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:50:19.493339 139691261163264 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:50:19.493412 139691261163264 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:50:19.493521 139692439672256 error_handling.py:96] outfeed marked as finished
I0812 00:50:19.493654 139692439672256 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:50:27.034146 139692439672256 estimator.py:368] Loss for final step: 0.33073694.
I0812 00:50:27.034940 139692439672256 error_handling.py:96] training_loop marked as finished
I0812 00:50:27.867065 139692439672256 estimator.py:1145] Calling model_fn.
E0812 00:50:28.588409 139692439672256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:50:28.778970 139692439672256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:50:28.806068 139692439672256 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:50:28.826666 139692439672256 estimator.py:1147] Done calling model_fn.
I0812 00:50:28.843892 139692439672256 evaluation.py:255] Starting evaluation at 2019-08-12T00:50:28Z
I0812 00:50:28.844130 139692439672256 tpu_estimator.py:499] TPU job name worker
I0812 00:50:28.919135 139692439672256 monitored_session.py:240] Graph was finalized.
W0812 00:50:28.919852 139692439672256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:50:29.118417 139692439672256 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:50:31.544320 139692439672256 session_manager.py:500] Running local_init_op.
I0812 00:50:31.568423 139692439672256 session_manager.py:502] Done running local_init_op.
I0812 00:50:31.624226 139692439672256 tpu_estimator.py:557] Init TPU system
I0812 00:51:40.671041 139692439672256 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 00:51:40.672292 139691261163264 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:51:40.673068 139691252770560 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:51:40.741144 139692439672256 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:51:40.769110 139692439672256 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:51:40.769458 139692439672256 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:51:40.796782 139691244377856 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:51:40.952596 139691244377856 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:51:41.544173 139691252770560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:51:41.905533 139692439672256 evaluation.py:167] Evaluation [10/10]
I0812 00:51:41.905922 139692439672256 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:51:41.906006 139692439672256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:51:41.906265 139691261163264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:51:41.906528 139691261163264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:51:41.906734 139692439672256 error_handling.py:96] infeed marked as finished
I0812 00:51:41.906902 139692439672256 tpu_estimator.py:602] Stop output thread controller
I0812 00:51:41.906956 139692439672256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:51:41.907143 139691252770560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:51:41.907293 139691252770560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:51:41.907443 139692439672256 error_handling.py:96] outfeed marked as finished
I0812 00:51:41.907565 139692439672256 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:52:11.052690 139692439672256 evaluation.py:275] Finished evaluation at 2019-08-12-00:52:11
I0812 00:52:11.053052 139692439672256 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9168, global_step = 30, loss = 0.28116202
I0812 00:52:15.570815 139692439672256 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:52:16.408808 139692439672256 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.28116202, 'global_step': 30, 'accuracy': 0.9168}

Removing gs://yangyou-mnist/log/#1565570936467375...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565570949171929...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565570956704665...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565570936.v3-8-tpu#1565571019175167...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565571013937588...
Removing gs://yangyou-mnist/log/checkpoint#1565571016109701...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565571013040822...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565570948222758...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565570941247329...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565571018294122...
Removing gs://yangyou-mnist/log/eval/#1565571132713215...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565571132.v3-8-tpu#1565571136084744...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:52:20.263647 140623740171712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:52:20.264403 140623740171712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:52:20.267122 140623740171712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:52:20.267954 140623740171712 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:52:20.268527 140623740171712 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:52:20.268668 140623740171712 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:52:20.683223 140623740171712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:52:20.689611 140623740171712 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:52:20.693320 140623740171712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:52:20.744678 140623740171712 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:52:20.744972 140623740171712 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:52:20.834503 140623740171712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:52:20.880743 140623740171712 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:52:20.881021 140623740171712 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:52:21.126317 140623740171712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe55e3dd0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe5605bb190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:52:21.126713 140623740171712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:52:21.456007 140623740171712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:52:21.459212: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:52:21.472717 140623740171712 tpu_system_metadata.py:148] Found TPU system:
I0812 00:52:21.472960 140623740171712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:52:21.473505 140623740171712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:52:21.473570 140623740171712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:52:21.473683 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:52:21.474061 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:52:21.474131 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:52:21.474184 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:52:21.474232 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:52:21.474281 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:52:21.474328 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:52:21.474380 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:52:21.474427 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:52:21.474473 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:52:21.474522 140623740171712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:52:21.480561 140623740171712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:52:21.492952 140623740171712 estimator.py:1145] Calling model_fn.
W0812 00:52:21.493556 140623740171712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:52:21.771982 140623740171712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:52:22.210937 140623740171712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:52:22.271711 140623740171712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:52:22.277477 140623740171712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:52:22.458515 140623740171712 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:52:22.472112 140623740171712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:52:22.484096 140623740171712 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:52:22.484400 140623740171712 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:52:22.900387 140623740171712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:52:22.915781 140623740171712 estimator.py:1147] Done calling model_fn.
I0812 00:52:27.123733 140623740171712 tpu_estimator.py:499] TPU job name worker
I0812 00:52:27.241416 140623740171712 monitored_session.py:240] Graph was finalized.
I0812 00:52:27.837946 140623740171712 session_manager.py:500] Running local_init_op.
I0812 00:52:27.869016 140623740171712 session_manager.py:502] Done running local_init_op.
I0812 00:52:30.440527 140623740171712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:52:42.734718 140623740171712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:52:42.841559 140623740171712 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:52:42.842067 140623740171712 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:52:42.842462: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:52:42.847642 140623740171712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:52:42.849692 140623740171712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:52:42.853075 140623740171712 tpu_estimator.py:557] Init TPU system
I0812 00:53:24.655282 140623740171712 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 00:53:24.656174 140622846482176 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:53:24.656650 140622838089472 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:53:24.701777 140623740171712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:53:24.703341 140623740171712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:53:24.713522 140622829696768 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:53:24.827430 140622829696768 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:53:29.241719 140622838089472 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:53:33.886327 140623740171712 basic_session_run_hooks.py:262] loss = 2.3034835, step = 30
I0812 00:53:33.888590 140623740171712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:53:47.739984 140623740171712 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:53:47.740314 140623740171712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:53:47.741805 140622846482176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:53:47.742175 140622846482176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:53:47.742394 140623740171712 error_handling.py:96] infeed marked as finished
I0812 00:53:47.742614 140623740171712 tpu_estimator.py:602] Stop output thread controller
I0812 00:53:47.742675 140623740171712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:53:47.742863 140622838089472 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:53:47.743055 140622838089472 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:53:47.743324 140623740171712 error_handling.py:96] outfeed marked as finished
I0812 00:53:47.743495 140623740171712 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:53:54.964409 140623740171712 estimator.py:368] Loss for final step: 2.3034835.
I0812 00:53:54.965219 140623740171712 error_handling.py:96] training_loop marked as finished
I0812 00:53:55.761404 140623740171712 estimator.py:1145] Calling model_fn.
E0812 00:53:56.465513 140623740171712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:53:56.656459 140623740171712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:53:56.683576 140623740171712 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:53:56.704950 140623740171712 estimator.py:1147] Done calling model_fn.
I0812 00:53:56.722953 140623740171712 evaluation.py:255] Starting evaluation at 2019-08-12T00:53:56Z
I0812 00:53:56.723193 140623740171712 tpu_estimator.py:499] TPU job name worker
I0812 00:53:56.798715 140623740171712 monitored_session.py:240] Graph was finalized.
W0812 00:53:56.799503 140623740171712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:53:56.988743 140623740171712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:53:59.553744 140623740171712 session_manager.py:500] Running local_init_op.
I0812 00:53:59.578506 140623740171712 session_manager.py:502] Done running local_init_op.
I0812 00:53:59.625729 140623740171712 tpu_estimator.py:557] Init TPU system
I0812 00:55:08.565630 140623740171712 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:55:08.566510 140622842550016 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:55:08.566888 140622834157312 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:55:08.632364 140623740171712 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:55:08.655837 140623740171712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:55:08.656189 140623740171712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:55:08.686764 140622821041920 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:55:08.804506 140622821041920 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:55:09.410590 140622834157312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:55:09.795911 140623740171712 evaluation.py:167] Evaluation [10/10]
I0812 00:55:09.796288 140623740171712 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:55:09.796364 140623740171712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:55:09.796613 140622842550016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:55:09.796917 140622842550016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:55:09.797163 140623740171712 error_handling.py:96] infeed marked as finished
I0812 00:55:09.797348 140623740171712 tpu_estimator.py:602] Stop output thread controller
I0812 00:55:09.797405 140623740171712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:55:09.797559 140622834157312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:55:09.797760 140622834157312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:55:09.797911 140623740171712 error_handling.py:96] outfeed marked as finished
I0812 00:55:09.798032 140623740171712 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:55:38.899405 140623740171712 evaluation.py:275] Finished evaluation at 2019-08-12-00:55:38
I0812 00:55:38.899761 140623740171712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3014557
I0812 00:55:43.382091 140623740171712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:55:44.224965 140623740171712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3014557, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565571144455841...
Removing gs://yangyou-mnist/log/checkpoint#1565571224101142...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565571157822236...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565571144.v3-8-tpu#1565571227408406...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565571162238381...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565571220970322...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565571156988384...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565571221829485...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565571149890224...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565571226441409...
Removing gs://yangyou-mnist/log/eval/#1565571340603930...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565571340.v3-8-tpu#1565571343907235...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:55:48.020045 140200115008960 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:55:48.020838 140200115008960 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:55:48.023509 140200115008960 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:55:48.024352 140200115008960 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:55:48.024938 140200115008960 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:55:48.025074 140200115008960 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:55:48.452997 140200115008960 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:55:48.460114 140200115008960 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:55:48.464171 140200115008960 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:55:48.511301 140200115008960 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:55:48.511615 140200115008960 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:55:48.599558 140200115008960 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:55:48.647907 140200115008960 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:55:48.648205 140200115008960 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:55:48.771420 140200115008960 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f82bc36d0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f82be54b190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:55:48.771820 140200115008960 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:55:49.095279 140200115008960 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:55:49.098343: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:55:49.112149 140200115008960 tpu_system_metadata.py:148] Found TPU system:
I0812 00:55:49.112385 140200115008960 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:55:49.112941 140200115008960 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:55:49.113012 140200115008960 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:55:49.113070 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:55:49.113363 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:55:49.113426 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:55:49.113478 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:55:49.113527 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:55:49.113574 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:55:49.113688 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:55:49.113744 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:55:49.113791 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:55:49.113871 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:55:49.113924 140200115008960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:55:49.119914 140200115008960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:55:49.132285 140200115008960 estimator.py:1145] Calling model_fn.
W0812 00:55:49.132884 140200115008960 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:55:49.417574 140200115008960 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:55:50.027467 140200115008960 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:55:50.089699 140200115008960 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:55:50.095727 140200115008960 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:55:50.279874 140200115008960 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:55:50.293682 140200115008960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:55:50.305615 140200115008960 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:55:50.305931 140200115008960 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:55:50.730967 140200115008960 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:55:50.746618 140200115008960 estimator.py:1147] Done calling model_fn.
I0812 00:55:54.027791 140200115008960 tpu_estimator.py:499] TPU job name worker
I0812 00:55:54.143402 140200115008960 monitored_session.py:240] Graph was finalized.
I0812 00:55:54.713023 140200115008960 session_manager.py:500] Running local_init_op.
I0812 00:55:54.744613 140200115008960 session_manager.py:502] Done running local_init_op.
I0812 00:55:57.266598 140200115008960 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:56:09.440663 140200115008960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:56:09.555810 140200115008960 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:56:09.556305 140200115008960 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:56:09.556718: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:56:09.561250 140200115008960 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:56:09.563374 140200115008960 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:56:09.566896 140200115008960 tpu_estimator.py:557] Init TPU system
I0812 00:56:52.671088 140200115008960 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 00:56:52.672257 140198939719424 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:56:52.673132 140198931326720 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:56:52.717730 140200115008960 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 00:56:52.718652 140200115008960 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 00:56:52.729532 140198922934016 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:56:52.880847 140198922934016 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:56:57.007631 140198931326720 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:57:01.551126 140200115008960 basic_session_run_hooks.py:262] loss = 2.1425245, step = 30
I0812 00:57:01.554008 140200115008960 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 00:57:15.507642 140200115008960 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:57:15.507942 140200115008960 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:57:15.508246 140198939719424 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:57:15.508547 140198939719424 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:57:15.508876 140200115008960 error_handling.py:96] infeed marked as finished
I0812 00:57:15.509118 140200115008960 tpu_estimator.py:602] Stop output thread controller
I0812 00:57:15.509233 140200115008960 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:57:15.509438 140198931326720 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:57:15.509690 140198931326720 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:57:15.509867 140200115008960 error_handling.py:96] outfeed marked as finished
I0812 00:57:15.510025 140200115008960 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:57:23.016525 140200115008960 estimator.py:368] Loss for final step: 2.1425245.
I0812 00:57:23.017326 140200115008960 error_handling.py:96] training_loop marked as finished
I0812 00:57:23.858980 140200115008960 estimator.py:1145] Calling model_fn.
E0812 00:57:24.558840 140200115008960 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:57:24.752715 140200115008960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 00:57:24.779918 140200115008960 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 00:57:24.800976 140200115008960 estimator.py:1147] Done calling model_fn.
I0812 00:57:24.819313 140200115008960 evaluation.py:255] Starting evaluation at 2019-08-12T00:57:24Z
I0812 00:57:24.819555 140200115008960 tpu_estimator.py:499] TPU job name worker
I0812 00:57:24.894388 140200115008960 monitored_session.py:240] Graph was finalized.
W0812 00:57:24.895118 140200115008960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 00:57:25.087793 140200115008960 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 00:57:27.894722 140200115008960 session_manager.py:500] Running local_init_op.
I0812 00:57:27.918350 140200115008960 session_manager.py:502] Done running local_init_op.
I0812 00:57:27.974277 140200115008960 tpu_estimator.py:557] Init TPU system
I0812 00:58:36.593913 140200115008960 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 00:58:36.594938 140198939719424 tpu_estimator.py:514] Starting infeed thread controller.
I0812 00:58:36.596004 140198931326720 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 00:58:36.666383 140200115008960 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:58:36.693512 140200115008960 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 00:58:36.693933 140200115008960 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 00:58:36.768266 140198922934016 transport.py:157] Attempting refresh to obtain initial access_token
W0812 00:58:36.869714 140198922934016 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 00:58:37.447323 140198931326720 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 00:58:37.909287 140200115008960 evaluation.py:167] Evaluation [10/10]
I0812 00:58:37.909853 140200115008960 tpu_estimator.py:598] Stop infeed thread controller
I0812 00:58:37.909960 140200115008960 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 00:58:37.910309 140198939719424 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 00:58:37.910609 140198939719424 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 00:58:37.910800 140200115008960 error_handling.py:96] infeed marked as finished
I0812 00:58:37.910953 140200115008960 tpu_estimator.py:602] Stop output thread controller
I0812 00:58:37.911045 140200115008960 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 00:58:37.911196 140198931326720 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 00:58:37.911397 140198931326720 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 00:58:37.911590 140200115008960 error_handling.py:96] outfeed marked as finished
I0812 00:58:37.911756 140200115008960 tpu_estimator.py:606] Shutdown TPU system.
I0812 00:59:06.962028 140200115008960 evaluation.py:275] Finished evaluation at 2019-08-12-00:59:06
I0812 00:59:06.962435 140200115008960 estimator.py:2039] Saving dict for global step 30: accuracy = 0.2703, global_step = 30, loss = 2.1178613
I0812 00:59:11.378611 140200115008960 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 00:59:12.161767 140200115008960 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.1178613, 'global_step': 30, 'accuracy': 0.2703}

Removing gs://yangyou-mnist/log/#1565571352245274...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565571364585548...
Removing gs://yangyou-mnist/log/checkpoint#1565571431987353...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565571356722637...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565571368947663...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565571352.v3-8-tpu#1565571435187389...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565571428748546...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565571429685769...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565571363705617...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565571434184175...
Removing gs://yangyou-mnist/log/eval/#1565571548705828...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565571548.v3-8-tpu#1565571551837266...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 00:59:15.953440 140681708455360 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 00:59:15.954233 140681708455360 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 00:59:15.956715 140681708455360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 00:59:15.957475 140681708455360 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 00:59:15.958096 140681708455360 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 00:59:15.958221 140681708455360 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 00:59:16.354589 140681708455360 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 00:59:16.361690 140681708455360 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 00:59:16.365469 140681708455360 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:59:16.412225 140681708455360 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:59:16.412523 140681708455360 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:59:16.513509 140681708455360 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 00:59:16.557447 140681708455360 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 00:59:16.557785 140681708455360 transport.py:157] Attempting refresh to obtain initial access_token
I0812 00:59:16.671389 140681708455360 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff2dd6ba250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff2df898190>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 00:59:16.671749 140681708455360 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 00:59:16.998424 140681708455360 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 00:59:17.001305: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:59:17.014152 140681708455360 tpu_system_metadata.py:148] Found TPU system:
I0812 00:59:17.014406 140681708455360 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 00:59:17.014980 140681708455360 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 00:59:17.015041 140681708455360 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 00:59:17.015094 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 00:59:17.015398 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 00:59:17.015465 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 00:59:17.015516 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 00:59:17.015564 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 00:59:17.015613 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 00:59:17.015659 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 00:59:17.015705 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 00:59:17.015750 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 00:59:17.015796 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 00:59:17.015844 140681708455360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 00:59:17.021913 140681708455360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 00:59:17.034374 140681708455360 estimator.py:1145] Calling model_fn.
W0812 00:59:17.034998 140681708455360 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 00:59:17.304985 140681708455360 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 00:59:17.813071 140681708455360 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 00:59:17.873671 140681708455360 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 00:59:17.879607 140681708455360 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 00:59:18.061263 140681708455360 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 00:59:18.075004 140681708455360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 00:59:18.087104 140681708455360 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 00:59:18.087424 140681708455360 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 00:59:18.523951 140681708455360 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 00:59:18.539367 140681708455360 estimator.py:1147] Done calling model_fn.
I0812 00:59:21.944474 140681708455360 tpu_estimator.py:499] TPU job name worker
I0812 00:59:22.058429 140681708455360 monitored_session.py:240] Graph was finalized.
I0812 00:59:22.610833 140681708455360 session_manager.py:500] Running local_init_op.
I0812 00:59:22.642291 140681708455360 session_manager.py:502] Done running local_init_op.
I0812 00:59:25.169051 140681708455360 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 00:59:37.271218 140681708455360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 00:59:37.381762 140681708455360 util.py:98] Initialized dataset iterators in 0 seconds
I0812 00:59:37.382251 140681708455360 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 00:59:37.382680: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 00:59:37.388602 140681708455360 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 00:59:37.390959 140681708455360 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 00:59:37.394788 140681708455360 tpu_estimator.py:557] Init TPU system
I0812 01:00:20.635061 140681708455360 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 01:00:20.636081 140680949118720 tpu_estimator.py:514] Starting infeed thread controller.
I0812 01:00:20.636959 140680940726016 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 01:00:20.690542 140681708455360 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 01:00:20.693336 140680932333312 transport.py:157] Attempting refresh to obtain initial access_token
I0812 01:00:20.694117 140681708455360 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0812 01:00:20.928451 140680932333312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 01:00:25.136789 140680940726016 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 01:00:29.596158 140681708455360 basic_session_run_hooks.py:262] loss = 2.3033617, step = 30
I0812 01:00:29.598709 140681708455360 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 01:00:42.988146 140681708455360 tpu_estimator.py:598] Stop infeed thread controller
I0812 01:00:42.988425 140681708455360 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 01:00:42.988743 140680949118720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 01:00:42.989027 140680949118720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 01:00:42.989258 140681708455360 error_handling.py:96] infeed marked as finished
I0812 01:00:42.989449 140681708455360 tpu_estimator.py:602] Stop output thread controller
I0812 01:00:42.989507 140681708455360 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 01:00:42.989702 140680940726016 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 01:00:42.990061 140680940726016 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 01:00:42.990247 140681708455360 error_handling.py:96] outfeed marked as finished
I0812 01:00:42.990463 140681708455360 tpu_estimator.py:606] Shutdown TPU system.
I0812 01:00:51.065181 140681708455360 estimator.py:368] Loss for final step: 2.3033617.
I0812 01:00:51.066039 140681708455360 error_handling.py:96] training_loop marked as finished
I0812 01:00:51.853529 140681708455360 estimator.py:1145] Calling model_fn.
E0812 01:00:52.535042 140681708455360 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 01:00:52.730421 140681708455360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 01:00:52.758697 140681708455360 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 01:00:52.780627 140681708455360 estimator.py:1147] Done calling model_fn.
I0812 01:00:52.798063 140681708455360 evaluation.py:255] Starting evaluation at 2019-08-12T01:00:52Z
I0812 01:00:52.798321 140681708455360 tpu_estimator.py:499] TPU job name worker
I0812 01:00:52.873948 140681708455360 monitored_session.py:240] Graph was finalized.
W0812 01:00:52.874677 140681708455360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 01:00:53.065227 140681708455360 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 01:00:55.675915 140681708455360 session_manager.py:500] Running local_init_op.
I0812 01:00:55.700692 140681708455360 session_manager.py:502] Done running local_init_op.
I0812 01:00:55.759583 140681708455360 tpu_estimator.py:557] Init TPU system
I0812 01:02:04.594341 140681708455360 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 01:02:04.595221 140680945448704 tpu_estimator.py:514] Starting infeed thread controller.
I0812 01:02:04.596055 140680937056000 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 01:02:04.663944 140681708455360 util.py:98] Initialized dataset iterators in 0 seconds
I0812 01:02:04.695887 140681708455360 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 01:02:04.696294 140681708455360 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 01:02:04.766824 140680445818624 transport.py:157] Attempting refresh to obtain initial access_token
W0812 01:02:04.888796 140680445818624 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 01:02:05.474769 140680937056000 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 01:02:05.758398 140681708455360 evaluation.py:167] Evaluation [10/10]
I0812 01:02:05.758754 140681708455360 tpu_estimator.py:598] Stop infeed thread controller
I0812 01:02:05.758825 140681708455360 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 01:02:05.759124 140680945448704 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 01:02:05.759408 140680945448704 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 01:02:05.759812 140681708455360 error_handling.py:96] infeed marked as finished
I0812 01:02:05.760005 140681708455360 tpu_estimator.py:602] Stop output thread controller
I0812 01:02:05.760066 140681708455360 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 01:02:05.760231 140680937056000 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 01:02:05.760411 140680937056000 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 01:02:05.760617 140681708455360 error_handling.py:96] outfeed marked as finished
I0812 01:02:05.760783 140681708455360 tpu_estimator.py:606] Shutdown TPU system.
I0812 01:02:34.978223 140681708455360 evaluation.py:275] Finished evaluation at 2019-08-12-01:02:34
I0812 01:02:34.978600 140681708455360 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 2.3042867
I0812 01:02:39.631732 140681708455360 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 01:02:40.416001 140681708455360 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3042867, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/#1565571560003378...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565571572074224...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565571560.v3-8-tpu#1565571642633282...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565571636351728...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565571576722935...
Removing gs://yangyou-mnist/log/checkpoint#1565571639408496...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565571564631474...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565571571222125...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565571637218814...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565571641740166...
Removing gs://yangyou-mnist/log/eval/#1565571756818827...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565571757.v3-8-tpu#1565571760094237...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 01:02:44.172133 140647184504256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 01:02:44.172935 140647184504256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 01:02:44.175662 140647184504256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 01:02:44.176484 140647184504256 deprecation_wrapper.py:119] From mnist_tpu.py:396: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 01:02:44.177072 140647184504256 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 01:02:44.177201 140647184504256 deprecation_wrapper.py:119] From mnist_tpu.py:338: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 01:02:44.577666 140647184504256 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 01:02:44.584091 140647184504256 deprecation_wrapper.py:119] From mnist_tpu.py:357: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 01:02:44.587572 140647184504256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 01:02:44.638130 140647184504256 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 01:02:44.638446 140647184504256 transport.py:157] Attempting refresh to obtain initial access_token
I0812 01:02:44.824695 140647184504256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 01:02:44.871432 140647184504256 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 01:02:44.871731 140647184504256 transport.py:157] Attempting refresh to obtain initial access_token
I0812 01:02:44.973565 140647184504256 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fead3a1f0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fead5bfd150>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 01:02:44.973989 140647184504256 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 01:02:45.331168 140647184504256 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 01:02:45.334118: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 01:02:45.347928 140647184504256 tpu_system_metadata.py:148] Found TPU system:
I0812 01:02:45.348166 140647184504256 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 01:02:45.348669 140647184504256 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 01:02:45.348745 140647184504256 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 01:02:45.348798 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 2595861049155086756)
I0812 01:02:45.349172 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 8880340934783471729)
I0812 01:02:45.349230 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7255266493862251561)
I0812 01:02:45.349281 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 8574914532065595404)
I0812 01:02:45.349328 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 563851270547388479)
I0812 01:02:45.349379 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4083811370884240537)
I0812 01:02:45.349426 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15871884949842149465)
I0812 01:02:45.349472 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 7616249832350468437)
I0812 01:02:45.349519 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 2256569285371664229)
I0812 01:02:45.349565 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 4065674425706782656)
I0812 01:02:45.349668 140647184504256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 16216119565208531567)
W0812 01:02:45.355959 140647184504256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 01:02:45.368630 140647184504256 estimator.py:1145] Calling model_fn.
W0812 01:02:45.369278 140647184504256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 01:02:45.647036 140647184504256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 01:02:46.117094 140647184504256 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 01:02:46.178224 140647184504256 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 01:02:46.184065 140647184504256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 01:02:46.363166 140647184504256 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 01:02:46.381654 140647184504256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 01:02:46.393676 140647184504256 deprecation_wrapper.py:119] From mnist_tpu.py:289: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

W0812 01:02:46.393990 140647184504256 deprecation_wrapper.py:119] From mnist_tpu.py:301: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

I0812 01:02:46.818548 140647184504256 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 01:02:46.833993 140647184504256 estimator.py:1147] Done calling model_fn.
I0812 01:02:50.397906 140647184504256 tpu_estimator.py:499] TPU job name worker
I0812 01:02:50.508620 140647184504256 monitored_session.py:240] Graph was finalized.
I0812 01:02:51.123429 140647184504256 session_manager.py:500] Running local_init_op.
I0812 01:02:51.156646 140647184504256 session_manager.py:502] Done running local_init_op.
I0812 01:02:53.769115 140647184504256 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 01:03:05.702590 140647184504256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 01:03:05.822326 140647184504256 util.py:98] Initialized dataset iterators in 0 seconds
I0812 01:03:05.822793 140647184504256 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 01:03:05.823200: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 01:03:05.828313 140647184504256 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 01:03:05.830492 140647184504256 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 01:03:05.834184 140647184504256 tpu_estimator.py:557] Init TPU system
I0812 01:03:48.660631 140647184504256 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 01:03:48.661868 140646153189120 tpu_estimator.py:514] Starting infeed thread controller.
I0812 01:03:48.662306 140646144796416 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 01:03:48.709134 140647184504256 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 01:03:48.710148 140647184504256 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 01:03:48.721326 140646136403712 transport.py:157] Attempting refresh to obtain initial access_token
W0812 01:03:48.825393 140646136403712 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 01:03:53.158767 140646144796416 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 01:03:57.759891 140647184504256 basic_session_run_hooks.py:262] loss = 2.3087542, step = 30
I0812 01:03:57.762516 140647184504256 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 01:04:11.296623 140647184504256 tpu_estimator.py:598] Stop infeed thread controller
I0812 01:04:11.296920 140647184504256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 01:04:11.297125 140646153189120 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 01:04:11.297225 140646153189120 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 01:04:11.297353 140647184504256 error_handling.py:96] infeed marked as finished
I0812 01:04:11.297482 140647184504256 tpu_estimator.py:602] Stop output thread controller
I0812 01:04:11.297532 140647184504256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 01:04:11.297702 140646144796416 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 01:04:11.297781 140646144796416 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 01:04:11.297898 140647184504256 error_handling.py:96] outfeed marked as finished
I0812 01:04:11.297981 140647184504256 tpu_estimator.py:606] Shutdown TPU system.
I0812 01:04:18.962519 140647184504256 estimator.py:368] Loss for final step: 2.3087542.
I0812 01:04:18.963395 140647184504256 error_handling.py:96] training_loop marked as finished
I0812 01:04:19.855139 140647184504256 estimator.py:1145] Calling model_fn.
E0812 01:04:20.696804 140647184504256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 01:04:20.890763 140647184504256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:3154: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0812 01:04:20.918498 140647184504256 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 01:04:20.939954 140647184504256 estimator.py:1147] Done calling model_fn.
I0812 01:04:20.957925 140647184504256 evaluation.py:255] Starting evaluation at 2019-08-12T01:04:20Z
I0812 01:04:20.958173 140647184504256 tpu_estimator.py:499] TPU job name worker
I0812 01:04:21.037986 140647184504256 monitored_session.py:240] Graph was finalized.
W0812 01:04:21.038789 140647184504256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 01:04:21.233058 140647184504256 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 01:04:23.878010 140647184504256 session_manager.py:500] Running local_init_op.
I0812 01:04:23.903493 140647184504256 session_manager.py:502] Done running local_init_op.
I0812 01:04:23.956584 140647184504256 tpu_estimator.py:557] Init TPU system
I0812 01:05:32.571706 140647184504256 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 01:05:32.572630 140646152402688 tpu_estimator.py:514] Starting infeed thread controller.
I0812 01:05:32.573148 140646144009984 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 01:05:32.641261 140647184504256 util.py:98] Initialized dataset iterators in 0 seconds
I0812 01:05:32.673381 140647184504256 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 01:05:32.673839 140647184504256 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 01:05:32.698582 140646135617280 transport.py:157] Attempting refresh to obtain initial access_token
W0812 01:05:32.803877 140646135617280 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 01:05:33.468162 140646144009984 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 01:05:33.791451 140647184504256 evaluation.py:167] Evaluation [10/10]
I0812 01:05:33.791796 140647184504256 tpu_estimator.py:598] Stop infeed thread controller
I0812 01:05:33.791882 140647184504256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 01:05:33.792062 140646152402688 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 01:05:33.792152 140646152402688 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 01:05:33.792292 140647184504256 error_handling.py:96] infeed marked as finished
I0812 01:05:33.792404 140647184504256 tpu_estimator.py:602] Stop output thread controller
I0812 01:05:33.792453 140647184504256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 01:05:33.792563 140646144009984 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 01:05:33.792634 140646144009984 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 01:05:33.792747 140647184504256 error_handling.py:96] outfeed marked as finished
I0812 01:05:33.792830 140647184504256 tpu_estimator.py:606] Shutdown TPU system.
