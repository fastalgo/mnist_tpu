CommandException: 1 files/objects could not be removed.
WARNING: Logging before flag parsing goes to stderr.
W0812 15:53:18.599567 139938586301888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 15:53:18.600347 139938586301888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 15:53:18.603133 139938586301888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 15:53:18.603965 139938586301888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 15:53:18.604551 139938586301888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 15:53:18.604685 139938586301888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 15:53:19.027466 139938586301888 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 15:53:19.039670 139938586301888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 15:53:19.044701 139938586301888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 15:53:19.092648 139938586301888 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 15:53:19.092962 139938586301888 transport.py:157] Attempting refresh to obtain initial access_token
I0812 15:53:19.236963 139938586301888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 15:53:19.290537 139938586301888 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 15:53:19.290880 139938586301888 transport.py:157] Attempting refresh to obtain initial access_token
I0812 15:53:19.406932 139938586301888 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f45d7e38110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f45da015210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 15:53:19.407325 139938586301888 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 15:53:19.754071 139938586301888 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 15:53:19.757216: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 15:53:19.769715 139938586301888 tpu_system_metadata.py:148] Found TPU system:
I0812 15:53:19.769979 139938586301888 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 15:53:19.770579 139938586301888 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 15:53:19.770669 139938586301888 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 15:53:19.770728 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 15:53:19.771050 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 15:53:19.771120 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 15:53:19.771172 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 15:53:19.771219 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 15:53:19.771266 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 15:53:19.771313 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 15:53:19.771361 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 15:53:19.771406 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 15:53:19.771452 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 15:53:19.771501 139938586301888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 15:53:19.778001 139938586301888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 15:53:19.790844 139938586301888 estimator.py:1145] Calling model_fn.
W0812 15:53:19.791521 139938586301888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 15:53:20.066816 139938586301888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 15:53:20.795274 139938586301888 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 15:53:20.862616 139938586301888 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 15:53:20.869076 139938586301888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 15:53:21.097573 139938586301888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 15:53:21.113878 139938586301888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 15:53:21.129240 139938586301888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 15:53:21.139636 139938586301888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 15:53:21.145708 139938586301888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 15:53:21.572931 139938586301888 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 15:53:21.588876 139938586301888 estimator.py:1147] Done calling model_fn.
I0812 15:53:25.155009 139938586301888 tpu_estimator.py:499] TPU job name worker
I0812 15:53:25.288155 139938586301888 monitored_session.py:240] Graph was finalized.
I0812 15:53:25.847384 139938586301888 session_manager.py:500] Running local_init_op.
I0812 15:53:25.879076 139938586301888 session_manager.py:502] Done running local_init_op.
I0812 15:53:29.141412 139938586301888 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 15:53:42.341145 139938586301888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 15:53:42.438894 139938586301888 util.py:98] Initialized dataset iterators in 0 seconds
I0812 15:53:42.439403 139938586301888 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 15:53:42.439801: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 15:53:42.444020 139938586301888 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 15:53:42.446288 139938586301888 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 15:53:42.449965 139938586301888 tpu_estimator.py:557] Init TPU system
I0812 15:53:44.946001 139938586301888 tpu_estimator.py:566] Initialized TPU in 2 seconds
I0812 15:53:44.946809 139937542301440 tpu_estimator.py:514] Starting infeed thread controller.
I0812 15:53:44.947371 139937533908736 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 15:53:44.993769 139938586301888 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 15:53:44.994728 139938586301888 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 15:53:45.007245 139937525516032 transport.py:157] Attempting refresh to obtain initial access_token
W0812 15:53:45.134315 139937525516032 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 15:53:50.349991 139937533908736 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 15:53:54.545865 139938586301888 basic_session_run_hooks.py:262] loss = 1.0599589, step = 30
I0812 15:53:54.547986 139938586301888 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 15:54:08.473397 139938586301888 tpu_estimator.py:598] Stop infeed thread controller
I0812 15:54:08.473741 139938586301888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 15:54:08.475152 139937542301440 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 15:54:08.475542 139937542301440 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 15:54:08.475776 139938586301888 error_handling.py:96] infeed marked as finished
I0812 15:54:08.476033 139938586301888 tpu_estimator.py:602] Stop output thread controller
I0812 15:54:08.476140 139938586301888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 15:54:08.476363 139937533908736 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 15:54:08.476572 139937533908736 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 15:54:08.476747 139938586301888 error_handling.py:96] outfeed marked as finished
I0812 15:54:08.476897 139938586301888 tpu_estimator.py:606] Shutdown TPU system.
I0812 15:54:15.252768 139938586301888 estimator.py:368] Loss for final step: 1.0599589.
I0812 15:54:15.253739 139938586301888 error_handling.py:96] training_loop marked as finished
I0812 15:54:16.087934 139938586301888 estimator.py:1145] Calling model_fn.
E0812 15:54:17.020924 139938586301888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 15:54:17.250732 139938586301888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 15:54:17.276725 139938586301888 estimator.py:1147] Done calling model_fn.
I0812 15:54:17.296607 139938586301888 evaluation.py:255] Starting evaluation at 2019-08-12T15:54:17Z
I0812 15:54:17.296865 139938586301888 tpu_estimator.py:499] TPU job name worker
I0812 15:54:17.385023 139938586301888 monitored_session.py:240] Graph was finalized.
W0812 15:54:17.385766 139938586301888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 15:54:17.577466 139938586301888 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 15:54:20.195446 139938586301888 session_manager.py:500] Running local_init_op.
I0812 15:54:20.222836 139938586301888 session_manager.py:502] Done running local_init_op.
I0812 15:54:20.273595 139938586301888 tpu_estimator.py:557] Init TPU system
I0812 15:54:28.473583 139938586301888 tpu_estimator.py:566] Initialized TPU in 8 seconds
I0812 15:54:28.474647 139937542301440 tpu_estimator.py:514] Starting infeed thread controller.
I0812 15:54:28.475471 139937533908736 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 15:54:28.543051 139938586301888 util.py:98] Initialized dataset iterators in 0 seconds
I0812 15:54:28.569144 139938586301888 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 15:54:28.569514 139938586301888 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 15:54:28.649293 139937525516032 transport.py:157] Attempting refresh to obtain initial access_token
W0812 15:54:28.891875 139937525516032 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 15:54:29.970258 139937533908736 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 15:54:30.523184 139938586301888 evaluation.py:167] Evaluation [10/10]
I0812 15:54:30.523567 139938586301888 tpu_estimator.py:598] Stop infeed thread controller
I0812 15:54:30.523646 139938586301888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 15:54:30.523952 139937542301440 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 15:54:30.524233 139937542301440 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 15:54:30.524504 139938586301888 error_handling.py:96] infeed marked as finished
I0812 15:54:30.524671 139938586301888 tpu_estimator.py:602] Stop output thread controller
I0812 15:54:30.524728 139938586301888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 15:54:30.525077 139937533908736 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 15:54:30.525273 139937533908736 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 15:54:30.525463 139938586301888 error_handling.py:96] outfeed marked as finished
I0812 15:54:30.525595 139938586301888 tpu_estimator.py:606] Shutdown TPU system.
I0812 15:54:58.988600 139938586301888 evaluation.py:275] Finished evaluation at 2019-08-12-15:54:58
I0812 15:54:58.988955 139938586301888 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8148, global_step = 30, loss = 0.9562195
I0812 15:55:03.663686 139938586301888 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 15:55:04.482391 139938586301888 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.9562195, 'global_step': 30, 'accuracy': 0.8148}

Removing gs://yangyou-mnist/log/#1565625203260105...
Removing gs://yangyou-mnist/log/checkpoint#1565625244719678...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565625203.v3-8-tpu#1565625248149462...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565625208163333...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565625242261543...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565625221890830...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565625216203122...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565625217196229...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565625241352411...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565625247041112...
Removing gs://yangyou-mnist/log/eval/#1565625300817018...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565625301.v3-8-tpu#1565625304153597...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 15:55:08.388875 139698335929792 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 15:55:08.389681 139698335929792 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 15:55:08.392515 139698335929792 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 15:55:08.393332 139698335929792 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 15:55:08.393923 139698335929792 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 15:55:08.394061 139698335929792 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 15:55:08.810831 139698335929792 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 15:55:08.821619 139698335929792 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 15:55:08.826833 139698335929792 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 15:55:08.882380 139698335929792 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 15:55:08.882673 139698335929792 transport.py:157] Attempting refresh to obtain initial access_token
I0812 15:55:09.011244 139698335929792 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 15:55:09.104569 139698335929792 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 15:55:09.104887 139698335929792 transport.py:157] Attempting refresh to obtain initial access_token
I0812 15:55:09.347358 139698335929792 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0de7d9c250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0de9f79210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 15:55:09.347727 139698335929792 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 15:55:09.668731 139698335929792 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 15:55:09.672137: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 15:55:09.685556 139698335929792 tpu_system_metadata.py:148] Found TPU system:
I0812 15:55:09.685807 139698335929792 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 15:55:09.686424 139698335929792 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 15:55:09.686487 139698335929792 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 15:55:09.686542 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 15:55:09.686844 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 15:55:09.686904 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 15:55:09.686955 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 15:55:09.687015 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 15:55:09.687063 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 15:55:09.687110 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 15:55:09.687159 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 15:55:09.687206 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 15:55:09.687252 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 15:55:09.687300 139698335929792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 15:55:09.693681 139698335929792 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 15:55:09.706417 139698335929792 estimator.py:1145] Calling model_fn.
W0812 15:55:09.707051 139698335929792 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 15:55:09.980489 139698335929792 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 15:55:10.403620 139698335929792 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 15:55:10.465461 139698335929792 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 15:55:10.471627 139698335929792 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 15:55:10.652506 139698335929792 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 15:55:10.666194 139698335929792 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 15:55:10.681250 139698335929792 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 15:55:10.691351 139698335929792 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 15:55:10.697182 139698335929792 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 15:55:11.119616 139698335929792 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 15:55:11.134855 139698335929792 estimator.py:1147] Done calling model_fn.
I0812 15:55:14.563138 139698335929792 tpu_estimator.py:499] TPU job name worker
I0812 15:55:14.678512 139698335929792 monitored_session.py:240] Graph was finalized.
I0812 15:55:15.298646 139698335929792 session_manager.py:500] Running local_init_op.
I0812 15:55:15.337220 139698335929792 session_manager.py:502] Done running local_init_op.
I0812 15:55:17.948839 139698335929792 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 15:55:30.632917 139698335929792 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 15:55:30.758807 139698335929792 util.py:98] Initialized dataset iterators in 0 seconds
I0812 15:55:30.759391 139698335929792 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 15:55:30.759804: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 15:55:30.764636 139698335929792 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 15:55:30.767052 139698335929792 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 15:55:30.771497 139698335929792 tpu_estimator.py:557] Init TPU system
I0812 15:55:41.040736 139698335929792 tpu_estimator.py:566] Initialized TPU in 10 seconds
I0812 15:55:41.041903 139697300961024 tpu_estimator.py:514] Starting infeed thread controller.
I0812 15:55:41.042795 139697292568320 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 15:55:41.086071 139698335929792 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 15:55:41.087071 139698335929792 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 15:55:41.104908 139697284175616 transport.py:157] Attempting refresh to obtain initial access_token
W0812 15:55:41.235667 139697284175616 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 15:55:45.473047 139697292568320 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 15:55:49.888392 139698335929792 basic_session_run_hooks.py:262] loss = 0.44937855, step = 30
I0812 15:55:49.890719 139698335929792 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 15:56:04.115446 139698335929792 tpu_estimator.py:598] Stop infeed thread controller
I0812 15:56:04.115766 139698335929792 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 15:56:04.117563 139697300961024 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 15:56:04.117860 139697300961024 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 15:56:04.118237 139698335929792 error_handling.py:96] infeed marked as finished
I0812 15:56:04.118530 139698335929792 tpu_estimator.py:602] Stop output thread controller
I0812 15:56:04.118592 139698335929792 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 15:56:04.118824 139697292568320 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 15:56:04.119110 139697292568320 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 15:56:04.119473 139698335929792 error_handling.py:96] outfeed marked as finished
I0812 15:56:04.119651 139698335929792 tpu_estimator.py:606] Shutdown TPU system.
I0812 15:56:11.362868 139698335929792 estimator.py:368] Loss for final step: 0.44937855.
I0812 15:56:11.363717 139698335929792 error_handling.py:96] training_loop marked as finished
I0812 15:56:12.181108 139698335929792 estimator.py:1145] Calling model_fn.
E0812 15:56:12.888333 139698335929792 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 15:56:13.136202 139698335929792 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 15:56:13.164570 139698335929792 estimator.py:1147] Done calling model_fn.
I0812 15:56:13.182840 139698335929792 evaluation.py:255] Starting evaluation at 2019-08-12T15:56:13Z
I0812 15:56:13.183089 139698335929792 tpu_estimator.py:499] TPU job name worker
I0812 15:56:13.262887 139698335929792 monitored_session.py:240] Graph was finalized.
W0812 15:56:13.263684 139698335929792 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 15:56:13.450994 139698335929792 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 15:56:16.073662 139698335929792 session_manager.py:500] Running local_init_op.
I0812 15:56:16.101629 139698335929792 session_manager.py:502] Done running local_init_op.
I0812 15:56:16.150876 139698335929792 tpu_estimator.py:557] Init TPU system
I0812 15:56:27.683139 139698335929792 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 15:56:27.683953 139697300961024 tpu_estimator.py:514] Starting infeed thread controller.
I0812 15:56:27.684361 139697292568320 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 15:56:27.755321 139698335929792 util.py:98] Initialized dataset iterators in 0 seconds
I0812 15:56:27.784346 139698335929792 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 15:56:27.784698 139698335929792 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 15:56:27.860110 139697284175616 transport.py:157] Attempting refresh to obtain initial access_token
W0812 15:56:27.982594 139697284175616 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 15:56:28.461308 139697292568320 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 15:56:28.789678 139698335929792 evaluation.py:167] Evaluation [10/10]
I0812 15:56:28.790092 139698335929792 tpu_estimator.py:598] Stop infeed thread controller
I0812 15:56:28.790218 139698335929792 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 15:56:28.790396 139697300961024 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 15:56:28.790493 139697300961024 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 15:56:28.790625 139698335929792 error_handling.py:96] infeed marked as finished
I0812 15:56:28.790709 139698335929792 tpu_estimator.py:602] Stop output thread controller
I0812 15:56:28.790762 139698335929792 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 15:56:28.790870 139697292568320 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 15:56:28.790944 139697292568320 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 15:56:28.791055 139698335929792 error_handling.py:96] outfeed marked as finished
I0812 15:56:28.791134 139698335929792 tpu_estimator.py:606] Shutdown TPU system.
I0812 15:56:58.050466 139698335929792 evaluation.py:275] Finished evaluation at 2019-08-12-15:56:58
I0812 15:56:58.050833 139698335929792 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8932, global_step = 30, loss = 0.43428984
I0812 15:57:03.236624 139698335929792 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 15:57:04.062365 139698335929792 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.43428984, 'global_step': 30, 'accuracy': 0.8932}

Removing gs://yangyou-mnist/log/checkpoint#1565625360415797...
Removing gs://yangyou-mnist/log/#1565625312644130...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565625312.v3-8-tpu#1565625363772748...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565625324503382...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565625317387438...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565625357082657...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565625358088810...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565625330117136...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565625325478909...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565625362773292...
Removing gs://yangyou-mnist/log/eval/#1565625419759960...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565625419.v3-8-tpu#1565625423715026...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 15:57:07.998713 140434720990656 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 15:57:07.999527 140434720990656 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 15:57:08.002351 140434720990656 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 15:57:08.003212 140434720990656 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 15:57:08.003818 140434720990656 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 15:57:08.003951 140434720990656 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 15:57:08.434447 140434720990656 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 15:57:08.446371 140434720990656 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 15:57:08.451577 140434720990656 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 15:57:08.503724 140434720990656 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 15:57:08.504053 140434720990656 transport.py:157] Attempting refresh to obtain initial access_token
I0812 15:57:08.598128 140434720990656 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 15:57:08.688584 140434720990656 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 15:57:08.688883 140434720990656 transport.py:157] Attempting refresh to obtain initial access_token
I0812 15:57:08.913918 140434720990656 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb95bd21050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb95defe210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 15:57:08.914352 140434720990656 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 15:57:09.304316 140434720990656 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 15:57:09.307302: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 15:57:09.319787 140434720990656 tpu_system_metadata.py:148] Found TPU system:
I0812 15:57:09.320036 140434720990656 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 15:57:09.320559 140434720990656 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 15:57:09.320620 140434720990656 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 15:57:09.320674 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 15:57:09.321064 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 15:57:09.321124 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 15:57:09.321173 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 15:57:09.321232 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 15:57:09.321279 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 15:57:09.321326 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 15:57:09.321372 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 15:57:09.321418 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 15:57:09.321463 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 15:57:09.321516 140434720990656 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 15:57:09.327850 140434720990656 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 15:57:09.340828 140434720990656 estimator.py:1145] Calling model_fn.
W0812 15:57:09.341470 140434720990656 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 15:57:09.605474 140434720990656 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 15:57:10.016978 140434720990656 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 15:57:10.079942 140434720990656 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 15:57:10.086060 140434720990656 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 15:57:10.272453 140434720990656 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 15:57:10.286680 140434720990656 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 15:57:10.302403 140434720990656 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 15:57:10.312822 140434720990656 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 15:57:10.319225 140434720990656 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 15:57:10.752028 140434720990656 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 15:57:10.768531 140434720990656 estimator.py:1147] Done calling model_fn.
I0812 15:57:14.122509 140434720990656 tpu_estimator.py:499] TPU job name worker
I0812 15:57:14.242969 140434720990656 monitored_session.py:240] Graph was finalized.
I0812 15:57:14.853018 140434720990656 session_manager.py:500] Running local_init_op.
I0812 15:57:14.882734 140434720990656 session_manager.py:502] Done running local_init_op.
I0812 15:57:17.625659 140434720990656 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 15:57:30.191601 140434720990656 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 15:57:30.296077 140434720990656 util.py:98] Initialized dataset iterators in 0 seconds
I0812 15:57:30.296555 140434720990656 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 15:57:30.296975: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 15:57:30.301834 140434720990656 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 15:57:30.304200 140434720990656 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 15:57:30.309231 140434720990656 tpu_estimator.py:557] Init TPU system
I0812 15:57:41.820970 140434720990656 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 15:57:41.821818 140433686525696 tpu_estimator.py:514] Starting infeed thread controller.
I0812 15:57:41.822473 140433678132992 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 15:57:41.868335 140434720990656 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 15:57:41.869229 140434720990656 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 15:57:41.926665 140433669740288 transport.py:157] Attempting refresh to obtain initial access_token
W0812 15:57:42.033607 140433669740288 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 15:57:46.206108 140433678132992 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 15:57:50.691116 140434720990656 basic_session_run_hooks.py:262] loss = 0.26682338, step = 30
I0812 15:57:50.693811 140434720990656 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 15:58:04.550535 140434720990656 tpu_estimator.py:598] Stop infeed thread controller
I0812 15:58:04.550843 140434720990656 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 15:58:04.552376 140433686525696 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 15:58:04.552624 140433686525696 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 15:58:04.552786 140434720990656 error_handling.py:96] infeed marked as finished
I0812 15:58:04.552911 140434720990656 tpu_estimator.py:602] Stop output thread controller
I0812 15:58:04.553002 140434720990656 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 15:58:04.553160 140433678132992 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 15:58:04.553255 140433678132992 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 15:58:04.553389 140434720990656 error_handling.py:96] outfeed marked as finished
I0812 15:58:04.553489 140434720990656 tpu_estimator.py:606] Shutdown TPU system.
I0812 15:58:12.149163 140434720990656 estimator.py:368] Loss for final step: 0.26682338.
I0812 15:58:12.149996 140434720990656 error_handling.py:96] training_loop marked as finished
I0812 15:58:12.975924 140434720990656 estimator.py:1145] Calling model_fn.
E0812 15:58:13.789871 140434720990656 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 15:58:14.036730 140434720990656 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 15:58:14.062592 140434720990656 estimator.py:1147] Done calling model_fn.
I0812 15:58:14.079777 140434720990656 evaluation.py:255] Starting evaluation at 2019-08-12T15:58:14Z
I0812 15:58:14.080023 140434720990656 tpu_estimator.py:499] TPU job name worker
I0812 15:58:14.159038 140434720990656 monitored_session.py:240] Graph was finalized.
W0812 15:58:14.159805 140434720990656 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 15:58:14.343864 140434720990656 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 15:58:16.778935 140434720990656 session_manager.py:500] Running local_init_op.
I0812 15:58:16.802629 140434720990656 session_manager.py:502] Done running local_init_op.
I0812 15:58:16.854959 140434720990656 tpu_estimator.py:557] Init TPU system
I0812 15:58:28.093224 140434720990656 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 15:58:28.094048 140433678132992 tpu_estimator.py:514] Starting infeed thread controller.
I0812 15:58:28.094470 140433669740288 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 15:58:28.160721 140434720990656 util.py:98] Initialized dataset iterators in 0 seconds
I0812 15:58:28.189433 140434720990656 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 15:58:28.189783 140434720990656 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 15:58:28.222609 140433661347584 transport.py:157] Attempting refresh to obtain initial access_token
W0812 15:58:28.447747 140433661347584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 15:58:28.876689 140433669740288 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 15:58:29.171840 140434720990656 evaluation.py:167] Evaluation [10/10]
I0812 15:58:29.172260 140434720990656 tpu_estimator.py:598] Stop infeed thread controller
I0812 15:58:29.172346 140434720990656 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 15:58:29.172596 140433678132992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 15:58:29.172734 140433678132992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 15:58:29.172885 140434720990656 error_handling.py:96] infeed marked as finished
I0812 15:58:29.173000 140434720990656 tpu_estimator.py:602] Stop output thread controller
I0812 15:58:29.173058 140434720990656 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 15:58:29.173185 140433669740288 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 15:58:29.173265 140433669740288 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 15:58:29.173388 140434720990656 error_handling.py:96] outfeed marked as finished
I0812 15:58:29.173476 140434720990656 tpu_estimator.py:606] Shutdown TPU system.
I0812 15:58:58.541909 140434720990656 evaluation.py:275] Finished evaluation at 2019-08-12-15:58:58
I0812 15:58:58.542293 140434720990656 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9305, global_step = 30, loss = 0.27549976
I0812 15:59:02.956135 140434720990656 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 15:59:03.825061 140434720990656 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.27549976, 'global_step': 30, 'accuracy': 0.9305}

Removing gs://yangyou-mnist/log/checkpoint#1565625480727684...
Removing gs://yangyou-mnist/log/#1565625432327139...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565625432.v3-8-tpu#1565625484205482...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565625436998973...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565625444340568...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565625445187290...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565625449673257...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565625477451764...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565625478321211...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565625483219372...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565625540.v3-8-tpu#1565625543477694...
Removing gs://yangyou-mnist/log/eval/#1565625540295182...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 15:59:07.647578 140248933332416 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 15:59:07.648397 140248933332416 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 15:59:07.651096 140248933332416 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 15:59:07.651976 140248933332416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 15:59:07.652611 140248933332416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 15:59:07.652745 140248933332416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 15:59:08.083463 140248933332416 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 15:59:08.092602 140248933332416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 15:59:08.097131 140248933332416 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 15:59:08.139775 140248933332416 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 15:59:08.140084 140248933332416 transport.py:157] Attempting refresh to obtain initial access_token
I0812 15:59:08.256690 140248933332416 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 15:59:08.305541 140248933332416 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 15:59:08.305846 140248933332416 transport.py:157] Attempting refresh to obtain initial access_token
I0812 15:59:08.406682 140248933332416 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8e1a01f3d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8e1c213210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 15:59:08.407049 140248933332416 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 15:59:08.740598 140248933332416 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 15:59:08.744006: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 15:59:08.757463 140248933332416 tpu_system_metadata.py:148] Found TPU system:
I0812 15:59:08.757709 140248933332416 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 15:59:08.758338 140248933332416 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 15:59:08.758416 140248933332416 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 15:59:08.758475 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 15:59:08.758780 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 15:59:08.758838 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 15:59:08.758889 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 15:59:08.758936 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 15:59:08.758984 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 15:59:08.759030 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 15:59:08.759074 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 15:59:08.759166 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 15:59:08.759217 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 15:59:08.759264 140248933332416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 15:59:08.765561 140248933332416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 15:59:08.778038 140248933332416 estimator.py:1145] Calling model_fn.
W0812 15:59:08.778676 140248933332416 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 15:59:09.045382 140248933332416 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 15:59:09.572249 140248933332416 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 15:59:09.634213 140248933332416 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 15:59:09.640229 140248933332416 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 15:59:09.822262 140248933332416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 15:59:09.836016 140248933332416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 15:59:09.851689 140248933332416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 15:59:09.862201 140248933332416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 15:59:09.868510 140248933332416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 15:59:10.307442 140248933332416 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 15:59:10.322693 140248933332416 estimator.py:1147] Done calling model_fn.
I0812 15:59:13.833899 140248933332416 tpu_estimator.py:499] TPU job name worker
I0812 15:59:13.950443 140248933332416 monitored_session.py:240] Graph was finalized.
I0812 15:59:14.513660 140248933332416 session_manager.py:500] Running local_init_op.
I0812 15:59:14.543224 140248933332416 session_manager.py:502] Done running local_init_op.
I0812 15:59:17.186281 140248933332416 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 15:59:29.613575 140248933332416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 15:59:29.718835 140248933332416 util.py:98] Initialized dataset iterators in 0 seconds
I0812 15:59:29.719319 140248933332416 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 15:59:29.719710: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 15:59:29.724711 140248933332416 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 15:59:29.727317 140248933332416 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 15:59:29.731664 140248933332416 tpu_estimator.py:557] Init TPU system
I0812 15:59:41.918837 140248933332416 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0812 15:59:41.919888 140248031151872 tpu_estimator.py:514] Starting infeed thread controller.
I0812 15:59:41.920567 140248022759168 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 15:59:41.965079 140248933332416 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 15:59:41.966006 140248933332416 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 15:59:41.979967 140248014366464 transport.py:157] Attempting refresh to obtain initial access_token
W0812 15:59:42.292939 140248014366464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 15:59:46.452955 140248022759168 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 15:59:50.728147 140248933332416 basic_session_run_hooks.py:262] loss = 0.22890292, step = 30
I0812 15:59:50.730331 140248933332416 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:00:04.548553 140248933332416 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:00:04.548908 140248933332416 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:00:04.549283 140248031151872 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:00:04.549614 140248031151872 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:00:04.549840 140248933332416 error_handling.py:96] infeed marked as finished
I0812 16:00:04.550071 140248933332416 tpu_estimator.py:602] Stop output thread controller
I0812 16:00:04.550132 140248933332416 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:00:04.550456 140248022759168 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:00:04.550662 140248022759168 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:00:04.551013 140248933332416 error_handling.py:96] outfeed marked as finished
I0812 16:00:04.551212 140248933332416 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:00:12.419949 140248933332416 estimator.py:368] Loss for final step: 0.22890292.
I0812 16:00:12.420876 140248933332416 error_handling.py:96] training_loop marked as finished
I0812 16:00:13.253514 140248933332416 estimator.py:1145] Calling model_fn.
E0812 16:00:13.941155 140248933332416 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:00:14.171747 140248933332416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:00:14.195650 140248933332416 estimator.py:1147] Done calling model_fn.
I0812 16:00:14.213300 140248933332416 evaluation.py:255] Starting evaluation at 2019-08-12T16:00:14Z
I0812 16:00:14.213546 140248933332416 tpu_estimator.py:499] TPU job name worker
I0812 16:00:14.292540 140248933332416 monitored_session.py:240] Graph was finalized.
W0812 16:00:14.293729 140248933332416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:00:14.473263 140248933332416 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:00:16.939721 140248933332416 session_manager.py:500] Running local_init_op.
I0812 16:00:16.968192 140248933332416 session_manager.py:502] Done running local_init_op.
I0812 16:00:17.013993 140248933332416 tpu_estimator.py:557] Init TPU system
I0812 16:00:28.655395 140248933332416 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:00:28.656368 140248022759168 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:00:28.657140 140248014366464 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:00:28.726115 140248933332416 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:00:28.755264 140248933332416 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:00:28.755682 140248933332416 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:00:28.842274 140248005711616 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:00:29.072906 140248005711616 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:00:29.425014 140248014366464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:00:29.895137 140248933332416 evaluation.py:167] Evaluation [10/10]
I0812 16:00:29.895524 140248933332416 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:00:29.896856 140248933332416 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:00:29.897313 140248022759168 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:00:29.897604 140248022759168 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:00:29.897840 140248933332416 error_handling.py:96] infeed marked as finished
I0812 16:00:29.898051 140248933332416 tpu_estimator.py:602] Stop output thread controller
I0812 16:00:29.898109 140248933332416 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:00:29.898292 140248014366464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:00:29.898462 140248014366464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:00:29.898621 140248933332416 error_handling.py:96] outfeed marked as finished
I0812 16:00:29.898740 140248933332416 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:00:59.157509 140248933332416 evaluation.py:275] Finished evaluation at 2019-08-12-16:00:59
I0812 16:00:59.157875 140248933332416 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9388, global_step = 30, loss = 0.24217872
I0812 16:01:03.857918 140248933332416 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:01:04.626580 140248933332416 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.24217872, 'global_step': 30, 'accuracy': 0.9388}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565625564606355...
Removing gs://yangyou-mnist/log/checkpoint#1565625600964357...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565625569134649...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565625597758026...
Removing gs://yangyou-mnist/log/#1565625551903552...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565625552.v3-8-tpu#1565625604198511...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565625556580789...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565625563592764...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565625598642483...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565625603274275...
Removing gs://yangyou-mnist/log/eval/#1565625660785322...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565625660.v3-8-tpu#1565625664318008...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:01:08.568660 139877590418880 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:01:08.569466 139877590418880 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:01:08.572591 139877590418880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:01:08.573498 139877590418880 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:01:08.574218 139877590418880 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:01:08.574384 139877590418880 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:01:08.994779 139877590418880 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:01:09.002480 139877590418880 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:01:09.006992 139877590418880 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:01:09.103951 139877590418880 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:01:09.104264 139877590418880 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:01:09.196760 139877590418880 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:01:09.243834 139877590418880 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:01:09.244131 139877590418880 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:01:09.345213 139877590418880 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f37a44031d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f37a65e0210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:01:09.345583 139877590418880 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:01:09.676753 139877590418880 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:01:09.680113: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:01:09.692806 139877590418880 tpu_system_metadata.py:148] Found TPU system:
I0812 16:01:09.693094 139877590418880 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:01:09.693640 139877590418880 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:01:09.693706 139877590418880 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:01:09.693773 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:01:09.694269 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:01:09.694339 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:01:09.694396 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:01:09.694456 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:01:09.694510 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:01:09.694565 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:01:09.694617 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:01:09.694670 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:01:09.694722 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:01:09.694777 139877590418880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:01:09.701289 139877590418880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:01:09.715219 139877590418880 estimator.py:1145] Calling model_fn.
W0812 16:01:09.715857 139877590418880 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:01:09.981398 139877590418880 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:01:10.419981 139877590418880 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:01:10.482908 139877590418880 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:01:10.488924 139877590418880 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:01:10.672542 139877590418880 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:01:10.687611 139877590418880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:01:10.703834 139877590418880 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:01:10.714237 139877590418880 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:01:10.720626 139877590418880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:01:11.162545 139877590418880 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:01:11.179270 139877590418880 estimator.py:1147] Done calling model_fn.
I0812 16:01:14.788762 139877590418880 tpu_estimator.py:499] TPU job name worker
I0812 16:01:14.909852 139877590418880 monitored_session.py:240] Graph was finalized.
I0812 16:01:15.501307 139877590418880 session_manager.py:500] Running local_init_op.
I0812 16:01:15.540574 139877590418880 session_manager.py:502] Done running local_init_op.
I0812 16:01:18.314666 139877590418880 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:01:30.896775 139877590418880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:01:31.012290 139877590418880 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:01:31.012752 139877590418880 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:01:31.013175: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:01:31.018259 139877590418880 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:01:31.020848 139877590418880 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:01:31.025132 139877590418880 tpu_estimator.py:557] Init TPU system
I0812 16:01:42.434022 139877590418880 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:01:42.435017 139876898006784 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:01:42.435504 139876414519040 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:01:42.482650 139877590418880 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:01:42.485368 139877590418880 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:01:42.490690 139876406126336 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:01:42.618817 139876406126336 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:01:46.900733 139876414519040 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:01:51.187661 139877590418880 basic_session_run_hooks.py:262] loss = 0.21871251, step = 30
I0812 16:01:51.190244 139877590418880 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:02:04.960464 139877590418880 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:02:04.960769 139877590418880 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:02:04.960995 139876898006784 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:02:04.961121 139876898006784 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:02:04.961293 139877590418880 error_handling.py:96] infeed marked as finished
I0812 16:02:04.961417 139877590418880 tpu_estimator.py:602] Stop output thread controller
I0812 16:02:04.961508 139877590418880 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:02:04.961671 139876414519040 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:02:04.961813 139876414519040 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:02:04.961945 139877590418880 error_handling.py:96] outfeed marked as finished
I0812 16:02:04.962038 139877590418880 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:02:12.747544 139877590418880 estimator.py:368] Loss for final step: 0.21871251.
I0812 16:02:12.748500 139877590418880 error_handling.py:96] training_loop marked as finished
I0812 16:02:13.601690 139877590418880 estimator.py:1145] Calling model_fn.
E0812 16:02:14.327027 139877590418880 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:02:14.561456 139877590418880 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:02:14.586931 139877590418880 estimator.py:1147] Done calling model_fn.
I0812 16:02:14.604778 139877590418880 evaluation.py:255] Starting evaluation at 2019-08-12T16:02:14Z
I0812 16:02:14.605015 139877590418880 tpu_estimator.py:499] TPU job name worker
I0812 16:02:14.685434 139877590418880 monitored_session.py:240] Graph was finalized.
W0812 16:02:14.686216 139877590418880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:02:14.877131 139877590418880 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:02:17.475172 139877590418880 session_manager.py:500] Running local_init_op.
I0812 16:02:17.503905 139877590418880 session_manager.py:502] Done running local_init_op.
I0812 16:02:17.554127 139877590418880 tpu_estimator.py:557] Init TPU system
I0812 16:02:29.088251 139877590418880 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:02:29.089189 139876414519040 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:02:29.090166 139876406126336 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:02:29.154511 139877590418880 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:02:29.183536 139877590418880 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:02:29.183907 139877590418880 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:02:29.266113 139876397733632 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:02:29.379545 139876397733632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:02:29.862246 139876406126336 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:02:30.395726 139877590418880 evaluation.py:167] Evaluation [10/10]
I0812 16:02:30.396303 139877590418880 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:02:30.396414 139877590418880 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:02:30.396589 139876414519040 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:02:30.396716 139876414519040 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:02:30.396873 139877590418880 error_handling.py:96] infeed marked as finished
I0812 16:02:30.396970 139877590418880 tpu_estimator.py:602] Stop output thread controller
I0812 16:02:30.397022 139877590418880 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:02:30.397140 139876406126336 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:02:30.397239 139876406126336 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:02:30.397365 139877590418880 error_handling.py:96] outfeed marked as finished
I0812 16:02:30.397449 139877590418880 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:02:59.476248 139877590418880 evaluation.py:275] Finished evaluation at 2019-08-12-16:02:59
I0812 16:02:59.476608 139877590418880 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9431, global_step = 30, loss = 0.21004891
I0812 16:03:03.941236 139877590418880 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:03:04.854513 139877590418880 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.21004891, 'global_step': 30, 'accuracy': 0.9431}

Removing gs://yangyou-mnist/log/checkpoint#1565625721336247...
Removing gs://yangyou-mnist/log/#1565625672824640...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565625685882988...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565625690359974...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565625718246163...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565625719174549...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565625677706741...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565625673.v3-8-tpu#1565625724657031...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565625684952094...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565625723660459...
Removing gs://yangyou-mnist/log/eval/#1565625781219988...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565625781.v3-8-tpu#1565625784457185...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:03:08.698803 139814071883200 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:03:08.699609 139814071883200 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:03:08.702301 139814071883200 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:03:08.703180 139814071883200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:03:08.703815 139814071883200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:03:08.703952 139814071883200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:03:09.131561 139814071883200 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:03:09.139755 139814071883200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:03:09.144495 139814071883200 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:03:09.188410 139814071883200 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:03:09.188728 139814071883200 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:03:09.415783 139814071883200 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:03:09.466497 139814071883200 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:03:09.466799 139814071883200 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:03:09.555200 139814071883200 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f28da3ed3d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f28dc5e1210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:03:09.555577 139814071883200 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:03:09.884733 139814071883200 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:03:09.887931: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:03:09.900166 139814071883200 tpu_system_metadata.py:148] Found TPU system:
I0812 16:03:09.900424 139814071883200 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:03:09.900938 139814071883200 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:03:09.901000 139814071883200 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:03:09.901052 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:03:09.901334 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:03:09.901403 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:03:09.901456 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:03:09.901514 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:03:09.901561 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:03:09.901607 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:03:09.901654 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:03:09.901700 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:03:09.901746 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:03:09.901794 139814071883200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:03:09.908466 139814071883200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:03:09.921729 139814071883200 estimator.py:1145] Calling model_fn.
W0812 16:03:09.922393 139814071883200 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:03:10.189451 139814071883200 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:03:10.607770 139814071883200 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:03:10.671346 139814071883200 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:03:10.677478 139814071883200 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:03:10.862339 139814071883200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:03:10.876843 139814071883200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:03:10.891918 139814071883200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:03:10.902025 139814071883200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:03:10.908037 139814071883200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:03:11.326281 139814071883200 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:03:11.341968 139814071883200 estimator.py:1147] Done calling model_fn.
I0812 16:03:14.889444 139814071883200 tpu_estimator.py:499] TPU job name worker
I0812 16:03:15.008959 139814071883200 monitored_session.py:240] Graph was finalized.
I0812 16:03:15.580467 139814071883200 session_manager.py:500] Running local_init_op.
I0812 16:03:15.610888 139814071883200 session_manager.py:502] Done running local_init_op.
I0812 16:03:18.304100 139814071883200 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:03:30.847685 139814071883200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:03:30.953129 139814071883200 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:03:30.953589 139814071883200 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:03:30.954010: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:03:30.958920 139814071883200 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:03:30.961405 139814071883200 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:03:30.965451 139814071883200 tpu_estimator.py:557] Init TPU system
I0812 16:03:42.751288 139814071883200 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:03:42.752376 139813178038016 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:03:42.753205 139813169645312 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:03:42.802042 139814071883200 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:03:42.803026 139814071883200 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:03:42.864830 139813161252608 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:03:43.097264 139813161252608 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:03:47.094332 139813169645312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:03:51.409105 139814071883200 basic_session_run_hooks.py:262] loss = 0.17827077, step = 30
I0812 16:03:51.411375 139814071883200 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:04:05.169718 139814071883200 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:04:05.170032 139814071883200 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:04:05.171714 139813178038016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:04:05.172106 139813178038016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:04:05.172544 139814071883200 error_handling.py:96] infeed marked as finished
I0812 16:04:05.172815 139814071883200 tpu_estimator.py:602] Stop output thread controller
I0812 16:04:05.172884 139814071883200 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:04:05.173082 139813169645312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:04:05.173297 139813169645312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:04:05.173504 139814071883200 error_handling.py:96] outfeed marked as finished
I0812 16:04:05.173731 139814071883200 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:04:13.229773 139814071883200 estimator.py:368] Loss for final step: 0.17827077.
I0812 16:04:13.230796 139814071883200 error_handling.py:96] training_loop marked as finished
I0812 16:04:14.052287 139814071883200 estimator.py:1145] Calling model_fn.
E0812 16:04:14.741456 139814071883200 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:04:14.984941 139814071883200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:04:15.009459 139814071883200 estimator.py:1147] Done calling model_fn.
I0812 16:04:15.027488 139814071883200 evaluation.py:255] Starting evaluation at 2019-08-12T16:04:15Z
I0812 16:04:15.027725 139814071883200 tpu_estimator.py:499] TPU job name worker
I0812 16:04:15.105794 139814071883200 monitored_session.py:240] Graph was finalized.
W0812 16:04:15.106544 139814071883200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:04:15.288265 139814071883200 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:04:17.662911 139814071883200 session_manager.py:500] Running local_init_op.
I0812 16:04:17.687068 139814071883200 session_manager.py:502] Done running local_init_op.
I0812 16:04:17.739145 139814071883200 tpu_estimator.py:557] Init TPU system
I0812 16:04:29.405500 139814071883200 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:04:29.406652 139813165975296 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:04:29.408233 139813152597760 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:04:29.472151 139814071883200 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:04:29.500365 139814071883200 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:04:29.500756 139814071883200 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:04:29.522849 139813144205056 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:04:29.614702 139813144205056 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:04:30.191975 139813152597760 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:04:30.508886 139814071883200 evaluation.py:167] Evaluation [10/10]
I0812 16:04:30.509285 139814071883200 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:04:30.509361 139814071883200 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:04:30.509632 139813165975296 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:04:30.510003 139813165975296 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:04:30.510315 139814071883200 error_handling.py:96] infeed marked as finished
I0812 16:04:30.510500 139814071883200 tpu_estimator.py:602] Stop output thread controller
I0812 16:04:30.510581 139814071883200 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:04:30.510755 139813152597760 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:04:30.510988 139813152597760 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:04:30.511189 139814071883200 error_handling.py:96] outfeed marked as finished
I0812 16:04:30.511387 139814071883200 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:04:59.711119 139814071883200 evaluation.py:275] Finished evaluation at 2019-08-12-16:04:59
I0812 16:04:59.711473 139814071883200 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9508, global_step = 30, loss = 0.19114158
I0812 16:05:04.122591 139814071883200 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:05:05.037286 139814071883200 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.19114158, 'global_step': 30, 'accuracy': 0.9508}

Removing gs://yangyou-mnist/log/#1565625792971044...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565625805617073...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565625810347202...
Removing gs://yangyou-mnist/log/checkpoint#1565625841580194...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565625839239561...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565625797707824...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565625793.v3-8-tpu#1565625844861351...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565625838318663...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565625804725522...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565625843916018...
Removing gs://yangyou-mnist/log/eval/#1565625901387611...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565625901.v3-8-tpu#1565625904669680...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:05:09.001763 140198279632320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:05:09.002677 140198279632320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:05:09.005323 140198279632320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:05:09.006323 140198279632320 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:05:09.006932 140198279632320 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:05:09.007074 140198279632320 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:05:09.434525 140198279632320 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:05:09.443870 140198279632320 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:05:09.448474 140198279632320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:05:09.496901 140198279632320 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:05:09.497190 140198279632320 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:05:09.615134 140198279632320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:05:09.710239 140198279632320 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:05:09.710547 140198279632320 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:05:09.823546 140198279632320 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f824ed14190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8250ef1210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:05:09.823901 140198279632320 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:05:10.147939 140198279632320 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:05:10.151168: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:05:10.163382 140198279632320 tpu_system_metadata.py:148] Found TPU system:
I0812 16:05:10.163655 140198279632320 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:05:10.164243 140198279632320 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:05:10.164311 140198279632320 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:05:10.164370 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:05:10.164707 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:05:10.164771 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:05:10.164827 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:05:10.164894 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:05:10.164947 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:05:10.164999 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:05:10.165055 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:05:10.165106 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:05:10.165157 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:05:10.165210 140198279632320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:05:10.171873 140198279632320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:05:10.185408 140198279632320 estimator.py:1145] Calling model_fn.
W0812 16:05:10.186067 140198279632320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:05:10.458911 140198279632320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:05:10.879751 140198279632320 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:05:10.941483 140198279632320 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:05:10.947530 140198279632320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:05:11.135651 140198279632320 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:05:11.149302 140198279632320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:05:11.164614 140198279632320 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:05:11.174803 140198279632320 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:05:11.180860 140198279632320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:05:11.600271 140198279632320 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:05:11.616007 140198279632320 estimator.py:1147] Done calling model_fn.
I0812 16:05:14.894632 140198279632320 tpu_estimator.py:499] TPU job name worker
I0812 16:05:15.006017 140198279632320 monitored_session.py:240] Graph was finalized.
I0812 16:05:15.579349 140198279632320 session_manager.py:500] Running local_init_op.
I0812 16:05:15.609188 140198279632320 session_manager.py:502] Done running local_init_op.
I0812 16:05:18.219584 140198279632320 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:05:30.573127 140198279632320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:05:30.682718 140198279632320 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:05:30.683279 140198279632320 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:05:30.683741: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:05:30.688369 140198279632320 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:05:30.690814 140198279632320 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:05:30.695308 140198279632320 tpu_estimator.py:557] Init TPU system
I0812 16:05:42.960258 140198279632320 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0812 16:05:42.961121 140197371037440 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:05:42.961633 140197362644736 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:05:43.007344 140198279632320 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:05:43.008264 140198279632320 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:05:43.071273 140197354252032 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:05:43.186286 140197354252032 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:05:47.473834 140197362644736 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:05:51.761879 140198279632320 basic_session_run_hooks.py:262] loss = 0.12754251, step = 30
I0812 16:05:51.764506 140198279632320 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:06:05.413662 140198279632320 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:06:05.413979 140198279632320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:06:05.414243 140197371037440 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:06:05.414361 140197371037440 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:06:05.414501 140198279632320 error_handling.py:96] infeed marked as finished
I0812 16:06:05.414597 140198279632320 tpu_estimator.py:602] Stop output thread controller
I0812 16:06:05.414644 140198279632320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:06:05.414757 140197362644736 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:06:05.414830 140197362644736 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:06:05.414956 140198279632320 error_handling.py:96] outfeed marked as finished
I0812 16:06:05.415038 140198279632320 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:06:13.309963 140198279632320 estimator.py:368] Loss for final step: 0.12754251.
I0812 16:06:13.310836 140198279632320 error_handling.py:96] training_loop marked as finished
I0812 16:06:14.098572 140198279632320 estimator.py:1145] Calling model_fn.
E0812 16:06:14.880342 140198279632320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:06:15.119976 140198279632320 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:06:15.144809 140198279632320 estimator.py:1147] Done calling model_fn.
I0812 16:06:15.161977 140198279632320 evaluation.py:255] Starting evaluation at 2019-08-12T16:06:15Z
I0812 16:06:15.162275 140198279632320 tpu_estimator.py:499] TPU job name worker
I0812 16:06:15.241372 140198279632320 monitored_session.py:240] Graph was finalized.
W0812 16:06:15.242122 140198279632320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:06:15.431838 140198279632320 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:06:18.212074 140198279632320 session_manager.py:500] Running local_init_op.
I0812 16:06:18.236109 140198279632320 session_manager.py:502] Done running local_init_op.
I0812 16:06:18.286397 140198279632320 tpu_estimator.py:557] Init TPU system
I0812 16:06:30.014311 140198279632320 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:06:30.015309 140197396215552 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:06:30.015887 140197371037440 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:06:30.085828 140198279632320 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:06:30.114298 140198279632320 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:06:30.114664 140198279632320 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:06:30.151024 140197362644736 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:06:30.280602 140197362644736 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:06:30.826617 140197371037440 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:06:31.178621 140198279632320 evaluation.py:167] Evaluation [10/10]
I0812 16:06:31.178983 140198279632320 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:06:31.179066 140198279632320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:06:31.179325 140197396215552 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:06:31.179450 140197396215552 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:06:31.179625 140198279632320 error_handling.py:96] infeed marked as finished
I0812 16:06:31.179728 140198279632320 tpu_estimator.py:602] Stop output thread controller
I0812 16:06:31.179778 140198279632320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:06:31.179919 140197371037440 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:06:31.179997 140197371037440 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:06:31.180155 140198279632320 error_handling.py:96] outfeed marked as finished
I0812 16:06:31.180244 140198279632320 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:07:00.351555 140198279632320 evaluation.py:275] Finished evaluation at 2019-08-12-16:07:00
I0812 16:07:00.351922 140198279632320 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9678, global_step = 30, loss = 0.12598345
I0812 16:07:05.906567 140198279632320 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:07:06.692306 140198279632320 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12598345, 'global_step': 30, 'accuracy': 0.9678}

Removing gs://yangyou-mnist/log/#1565625913063534...
Removing gs://yangyou-mnist/log/checkpoint#1565625961629063...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565625925692871...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565625930045135...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565625958515883...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565625913.v3-8-tpu#1565625965065901...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565625959381338...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565625917623373...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565625924772461...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565625964156548...
Removing gs://yangyou-mnist/log/eval/#1565626022278436...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565626022.v3-8-tpu#1565626026403994...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:07:10.480180 139895961793984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:07:10.480978 139895961793984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:07:10.483692 139895961793984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:07:10.484539 139895961793984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:07:10.485172 139895961793984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:07:10.485304 139895961793984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:07:10.901318 139895961793984 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:07:10.909466 139895961793984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:07:10.914377 139895961793984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:07:10.959739 139895961793984 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:07:10.960051 139895961793984 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:07:11.188407 139895961793984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:07:11.234312 139895961793984 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:07:11.234615 139895961793984 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:07:11.489557 139895961793984 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3beb452250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3bed62f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:07:11.489916 139895961793984 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:07:11.799302 139895961793984 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:07:11.802426: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:07:11.816133 139895961793984 tpu_system_metadata.py:148] Found TPU system:
I0812 16:07:11.816391 139895961793984 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:07:11.816997 139895961793984 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:07:11.817070 139895961793984 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:07:11.817131 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:07:11.817451 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:07:11.817513 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:07:11.817580 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:07:11.817636 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:07:11.817709 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:07:11.817764 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:07:11.817816 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:07:11.817868 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:07:11.817920 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:07:11.817974 139895961793984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:07:11.825777 139895961793984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:07:11.841253 139895961793984 estimator.py:1145] Calling model_fn.
W0812 16:07:11.841914 139895961793984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:07:12.284707 139895961793984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:07:12.809684 139895961793984 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:07:12.873264 139895961793984 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:07:12.879334 139895961793984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:07:13.063064 139895961793984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:07:13.077096 139895961793984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:07:13.092463 139895961793984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:07:13.102803 139895961793984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:07:13.108861 139895961793984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:07:13.538258 139895961793984 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:07:13.554048 139895961793984 estimator.py:1147] Done calling model_fn.
I0812 16:07:17.062302 139895961793984 tpu_estimator.py:499] TPU job name worker
I0812 16:07:17.185009 139895961793984 monitored_session.py:240] Graph was finalized.
I0812 16:07:17.832307 139895961793984 session_manager.py:500] Running local_init_op.
I0812 16:07:17.871366 139895961793984 session_manager.py:502] Done running local_init_op.
I0812 16:07:20.342694 139895961793984 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:07:32.894680 139895961793984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:07:33.013820 139895961793984 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:07:33.014355 139895961793984 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:07:33.014934: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:07:33.019674 139895961793984 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:07:33.021928 139895961793984 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:07:33.025691 139895961793984 tpu_estimator.py:557] Init TPU system
I0812 16:07:44.148443 139895961793984 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:07:44.149368 139894928172800 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:07:44.149892 139894919780096 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:07:44.196213 139895961793984 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:07:44.197091 139895961793984 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:07:44.275917 139894911387392 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:07:44.493927 139894911387392 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:07:48.873473 139894919780096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:07:53.242979 139895961793984 basic_session_run_hooks.py:262] loss = 0.09564981, step = 30
I0812 16:07:53.245296 139895961793984 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:08:07.036535 139895961793984 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:08:07.036840 139895961793984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:08:07.037189 139894928172800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:08:07.037537 139894928172800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:08:07.037784 139895961793984 error_handling.py:96] infeed marked as finished
I0812 16:08:07.038018 139895961793984 tpu_estimator.py:602] Stop output thread controller
I0812 16:08:07.038074 139895961793984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:08:07.038398 139894919780096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:08:07.038577 139894919780096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:08:07.038731 139895961793984 error_handling.py:96] outfeed marked as finished
I0812 16:08:07.038868 139895961793984 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:08:14.615052 139895961793984 estimator.py:368] Loss for final step: 0.09564981.
I0812 16:08:14.615968 139895961793984 error_handling.py:96] training_loop marked as finished
I0812 16:08:15.387586 139895961793984 estimator.py:1145] Calling model_fn.
E0812 16:08:16.124806 139895961793984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:08:16.354619 139895961793984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:08:16.379028 139895961793984 estimator.py:1147] Done calling model_fn.
I0812 16:08:16.398363 139895961793984 evaluation.py:255] Starting evaluation at 2019-08-12T16:08:16Z
I0812 16:08:16.398633 139895961793984 tpu_estimator.py:499] TPU job name worker
I0812 16:08:16.488171 139895961793984 monitored_session.py:240] Graph was finalized.
W0812 16:08:16.489027 139895961793984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:08:16.667454 139895961793984 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:08:19.183406 139895961793984 session_manager.py:500] Running local_init_op.
I0812 16:08:19.206526 139895961793984 session_manager.py:502] Done running local_init_op.
I0812 16:08:19.253057 139895961793984 tpu_estimator.py:557] Init TPU system
I0812 16:08:30.939526 139895961793984 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:08:30.940480 139894928172800 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:08:30.941049 139894919780096 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:08:31.004405 139895961793984 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:08:31.028038 139895961793984 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:08:31.028399 139895961793984 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:08:31.117238 139894911387392 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:08:31.355957 139894911387392 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:08:31.761553 139894919780096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:08:32.180427 139895961793984 evaluation.py:167] Evaluation [10/10]
I0812 16:08:32.180804 139895961793984 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:08:32.180886 139895961793984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:08:32.181184 139894928172800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:08:32.181478 139894928172800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:08:32.181730 139895961793984 error_handling.py:96] infeed marked as finished
I0812 16:08:32.181961 139895961793984 tpu_estimator.py:602] Stop output thread controller
I0812 16:08:32.182029 139895961793984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:08:32.182220 139894919780096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:08:32.182306 139894919780096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:08:32.182568 139895961793984 error_handling.py:96] outfeed marked as finished
I0812 16:08:32.182773 139895961793984 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:09:01.448590 139895961793984 evaluation.py:275] Finished evaluation at 2019-08-12-16:09:01
I0812 16:09:01.448959 139895961793984 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9757, global_step = 30, loss = 0.09459408
I0812 16:09:05.959348 139895961793984 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:09:07.094754 139895961793984 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09459408, 'global_step': 30, 'accuracy': 0.9757}

Removing gs://yangyou-mnist/log/#1565626035196701...
Removing gs://yangyou-mnist/log/checkpoint#1565626083439621...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565626035.v3-8-tpu#1565626086670955...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565626047872714...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565626047081135...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565626039855574...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565626052448882...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565626080372943...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565626081281756...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565626085638397...
Removing gs://yangyou-mnist/log/eval/#1565626143144911...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565626143.v3-8-tpu#1565626146780800...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:09:10.964931 140510509757888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:09:10.965770 140510509757888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:09:10.968416 140510509757888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:09:10.969264 140510509757888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:09:10.969861 140510509757888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:09:10.970000 140510509757888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:09:11.387451 140510509757888 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:09:11.395879 140510509757888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:09:11.400156 140510509757888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:09:11.451077 140510509757888 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:09:11.451395 140510509757888 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:09:11.602361 140510509757888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:09:11.649379 140510509757888 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:09:11.649672 140510509757888 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:09:11.748949 140510509757888 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcb012ee050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcb034cb210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:09:11.749330 140510509757888 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:09:12.093594 140510509757888 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:09:12.096510: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:09:12.109409 140510509757888 tpu_system_metadata.py:148] Found TPU system:
I0812 16:09:12.109663 140510509757888 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:09:12.110191 140510509757888 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:09:12.110266 140510509757888 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:09:12.110321 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:09:12.110656 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:09:12.110713 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:09:12.110764 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:09:12.110810 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:09:12.110857 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:09:12.110917 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:09:12.110964 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:09:12.111008 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:09:12.111053 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:09:12.111104 140510509757888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:09:12.117240 140510509757888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:09:12.129638 140510509757888 estimator.py:1145] Calling model_fn.
W0812 16:09:12.130301 140510509757888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:09:12.412328 140510509757888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:09:12.848234 140510509757888 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:09:12.908488 140510509757888 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:09:12.914661 140510509757888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:09:13.095181 140510509757888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:09:13.109019 140510509757888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:09:13.124059 140510509757888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:09:13.134251 140510509757888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:09:13.140228 140510509757888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:09:13.566278 140510509757888 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:09:13.581965 140510509757888 estimator.py:1147] Done calling model_fn.
I0812 16:09:17.080113 140510509757888 tpu_estimator.py:499] TPU job name worker
I0812 16:09:17.198209 140510509757888 monitored_session.py:240] Graph was finalized.
I0812 16:09:17.789570 140510509757888 session_manager.py:500] Running local_init_op.
I0812 16:09:17.829076 140510509757888 session_manager.py:502] Done running local_init_op.
I0812 16:09:20.574403 140510509757888 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:09:33.329852 140510509757888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:09:33.436139 140510509757888 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:09:33.436563 140510509757888 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:09:33.437035: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:09:33.441855 140510509757888 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:09:33.444226 140510509757888 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:09:33.447907 140510509757888 tpu_estimator.py:557] Init TPU system
I0812 16:09:44.958384 140510509757888 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:09:44.959291 140509750212352 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:09:44.959702 140509741819648 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:09:45.004967 140510509757888 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:09:45.005834 140510509757888 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:09:45.062911 140509733426944 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:09:45.179481 140509733426944 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:09:49.377934 140509741819648 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:09:53.662266 140510509757888 basic_session_run_hooks.py:262] loss = 0.093236245, step = 30
I0812 16:09:53.666460 140510509757888 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:10:07.471632 140510509757888 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:10:07.471942 140510509757888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:10:07.472196 140509750212352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:10:07.472342 140509750212352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:10:07.472492 140510509757888 error_handling.py:96] infeed marked as finished
I0812 16:10:07.472595 140510509757888 tpu_estimator.py:602] Stop output thread controller
I0812 16:10:07.472650 140510509757888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:10:07.472774 140509741819648 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:10:07.472852 140509741819648 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:10:07.472974 140510509757888 error_handling.py:96] outfeed marked as finished
I0812 16:10:07.473067 140510509757888 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:10:15.305743 140510509757888 estimator.py:368] Loss for final step: 0.093236245.
I0812 16:10:15.306595 140510509757888 error_handling.py:96] training_loop marked as finished
I0812 16:10:16.064766 140510509757888 estimator.py:1145] Calling model_fn.
E0812 16:10:16.873656 140510509757888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:10:17.100784 140510509757888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:10:17.125777 140510509757888 estimator.py:1147] Done calling model_fn.
I0812 16:10:17.142568 140510509757888 evaluation.py:255] Starting evaluation at 2019-08-12T16:10:17Z
I0812 16:10:17.142827 140510509757888 tpu_estimator.py:499] TPU job name worker
I0812 16:10:17.223301 140510509757888 monitored_session.py:240] Graph was finalized.
W0812 16:10:17.224078 140510509757888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:10:17.387473 140510509757888 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:10:19.926104 140510509757888 session_manager.py:500] Running local_init_op.
I0812 16:10:19.948954 140510509757888 session_manager.py:502] Done running local_init_op.
I0812 16:10:20.003118 140510509757888 tpu_estimator.py:557] Init TPU system
I0812 16:10:31.537878 140510509757888 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:10:31.538875 140509738149632 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:10:31.539702 140509251106560 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:10:31.607634 140510509757888 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:10:31.633671 140510509757888 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:10:31.634043 140510509757888 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:10:31.669384 140509242713856 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:10:31.821413 140509242713856 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:10:32.352538 140509251106560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:10:32.652280 140510509757888 evaluation.py:167] Evaluation [10/10]
I0812 16:10:32.652623 140510509757888 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:10:32.652693 140510509757888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:10:32.653057 140509738149632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:10:32.653404 140509738149632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:10:32.653630 140510509757888 error_handling.py:96] infeed marked as finished
I0812 16:10:32.653918 140510509757888 tpu_estimator.py:602] Stop output thread controller
I0812 16:10:32.653995 140510509757888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:10:32.654211 140509251106560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:10:32.654426 140509251106560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:10:32.654587 140510509757888 error_handling.py:96] outfeed marked as finished
I0812 16:10:32.654728 140510509757888 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:11:01.898044 140510509757888 evaluation.py:275] Finished evaluation at 2019-08-12-16:11:01
I0812 16:11:01.898438 140510509757888 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9722, global_step = 30, loss = 0.09656347
I0812 16:11:06.282488 140510509757888 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:11:07.019752 140510509757888 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09656347, 'global_step': 30, 'accuracy': 0.9722}

Removing gs://yangyou-mnist/log/#1565626155092565...
Removing gs://yangyou-mnist/log/checkpoint#1565626203876576...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565626168301812...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565626200974613...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565626155.v3-8-tpu#1565626207152353...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565626172849990...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565626159944670...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565626201782185...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565626167394689...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565626206120923...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565626263552477...
/ [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565626263.v3-8-tpu#1565626266725130...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:11:10.799316 139722305328576 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:11:10.800117 139722305328576 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:11:10.802783 139722305328576 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:11:10.803612 139722305328576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:11:10.804203 139722305328576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:11:10.804328 139722305328576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:11:11.224180 139722305328576 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:11:11.232862 139722305328576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:11:11.237082 139722305328576 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:11:11.284795 139722305328576 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:11:11.285085 139722305328576 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:11:11.500694 139722305328576 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:11:11.595973 139722305328576 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:11:11.596256 139722305328576 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:11:11.822895 139722305328576 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f137c89c050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f137ea79210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:11:11.823247 139722305328576 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:11:12.186999 139722305328576 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:11:12.190189: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:11:12.204230 139722305328576 tpu_system_metadata.py:148] Found TPU system:
I0812 16:11:12.204474 139722305328576 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:11:12.204973 139722305328576 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:11:12.205033 139722305328576 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:11:12.205084 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:11:12.205517 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:11:12.205574 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:11:12.205626 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:11:12.205673 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:11:12.205724 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:11:12.205771 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:11:12.205818 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:11:12.205879 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:11:12.205936 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:11:12.205986 139722305328576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:11:12.212286 139722305328576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:11:12.225352 139722305328576 estimator.py:1145] Calling model_fn.
W0812 16:11:12.225999 139722305328576 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:11:12.498775 139722305328576 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:11:12.908128 139722305328576 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:11:12.971537 139722305328576 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:11:12.977720 139722305328576 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:11:13.166270 139722305328576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:11:13.183640 139722305328576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:11:13.199573 139722305328576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:11:13.210172 139722305328576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:11:13.216578 139722305328576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:11:13.649779 139722305328576 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:11:13.666866 139722305328576 estimator.py:1147] Done calling model_fn.
I0812 16:11:17.738182 139722305328576 tpu_estimator.py:499] TPU job name worker
I0812 16:11:17.853034 139722305328576 monitored_session.py:240] Graph was finalized.
I0812 16:11:18.424663 139722305328576 session_manager.py:500] Running local_init_op.
I0812 16:11:18.465028 139722305328576 session_manager.py:502] Done running local_init_op.
I0812 16:11:21.020816 139722305328576 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:11:33.454727 139722305328576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:11:33.586042 139722305328576 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:11:33.586529 139722305328576 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:11:33.586937: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:11:33.591320 139722305328576 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:11:33.593779 139722305328576 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:11:33.597949 139722305328576 tpu_estimator.py:557] Init TPU system
I0812 16:11:45.491579 139722305328576 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:11:45.492600 139721545590528 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:11:45.493201 139721537197824 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:11:45.539987 139722305328576 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:11:45.540827 139722305328576 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:11:45.553363 139721460152064 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:11:45.665404 139721460152064 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:11:49.924393 139721537197824 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:11:54.268291 139722305328576 basic_session_run_hooks.py:262] loss = 0.10553397, step = 30
I0812 16:11:54.270843 139722305328576 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:12:07.780520 139722305328576 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:12:07.780802 139722305328576 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:12:07.781025 139721545590528 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:12:07.781133 139721545590528 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:12:07.781271 139722305328576 error_handling.py:96] infeed marked as finished
I0812 16:12:07.781366 139722305328576 tpu_estimator.py:602] Stop output thread controller
I0812 16:12:07.781421 139722305328576 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:12:07.781537 139721537197824 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:12:07.781608 139721537197824 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:12:07.781716 139722305328576 error_handling.py:96] outfeed marked as finished
I0812 16:12:07.781794 139722305328576 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:12:15.799138 139722305328576 estimator.py:368] Loss for final step: 0.10553397.
I0812 16:12:15.799913 139722305328576 error_handling.py:96] training_loop marked as finished
I0812 16:12:16.563406 139722305328576 estimator.py:1145] Calling model_fn.
E0812 16:12:17.286395 139722305328576 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:12:17.514264 139722305328576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:12:17.538705 139722305328576 estimator.py:1147] Done calling model_fn.
I0812 16:12:17.555830 139722305328576 evaluation.py:255] Starting evaluation at 2019-08-12T16:12:17Z
I0812 16:12:17.556061 139722305328576 tpu_estimator.py:499] TPU job name worker
I0812 16:12:17.635324 139722305328576 monitored_session.py:240] Graph was finalized.
W0812 16:12:17.636080 139722305328576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:12:17.810225 139722305328576 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:12:20.426877 139722305328576 session_manager.py:500] Running local_init_op.
I0812 16:12:20.454916 139722305328576 session_manager.py:502] Done running local_init_op.
I0812 16:12:20.509560 139722305328576 tpu_estimator.py:557] Init TPU system
I0812 16:12:32.286429 139722305328576 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:12:32.287316 139721545590528 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:12:32.287936 139721537197824 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:12:32.352485 139722305328576 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:12:32.380557 139722305328576 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:12:32.380944 139722305328576 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:12:32.409300 139721460152064 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:12:32.678800 139721460152064 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:12:33.087974 139721537197824 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:12:33.398299 139722305328576 evaluation.py:167] Evaluation [10/10]
I0812 16:12:33.398644 139722305328576 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:12:33.398725 139722305328576 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:12:33.398889 139721545590528 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:12:33.398977 139721545590528 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:12:33.399111 139722305328576 error_handling.py:96] infeed marked as finished
I0812 16:12:33.399198 139722305328576 tpu_estimator.py:602] Stop output thread controller
I0812 16:12:33.399244 139722305328576 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:12:33.399347 139721537197824 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:12:33.399416 139721537197824 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:12:33.399530 139722305328576 error_handling.py:96] outfeed marked as finished
I0812 16:12:33.399610 139722305328576 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:13:02.753935 139722305328576 evaluation.py:275] Finished evaluation at 2019-08-12-16:13:02
I0812 16:13:02.754311 139722305328576 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9752, global_step = 30, loss = 0.08756171
I0812 16:13:07.143529 139722305328576 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:13:07.936422 139722305328576 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08756171, 'global_step': 30, 'accuracy': 0.9752}

Removing gs://yangyou-mnist/log/#1565626275897132...
Removing gs://yangyou-mnist/log/checkpoint#1565626324162619...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565626292886350...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565626288506709...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565626321166141...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565626276.v3-8-tpu#1565626327470410...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565626287650599...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565626280484162...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565626322051627...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565626326497666...
Removing gs://yangyou-mnist/log/eval/#1565626384517547...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565626384.v3-8-tpu#1565626387629017...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:13:11.888763 140458443851200 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:13:11.889580 140458443851200 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:13:11.892224 140458443851200 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:13:11.893049 140458443851200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:13:11.893640 140458443851200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:13:11.893763 140458443851200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:13:12.316294 140458443851200 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:13:12.325196 140458443851200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:13:12.329948 140458443851200 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:13:12.375686 140458443851200 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:13:12.376019 140458443851200 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:13:12.639678 140458443851200 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:13:12.724040 140458443851200 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:13:12.724340 140458443851200 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:13:12.881613 140458443851200 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fbee1cec450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fbee3ee0210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:13:12.881978 140458443851200 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:13:13.205457 140458443851200 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:13:13.208537: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:13:13.221106 140458443851200 tpu_system_metadata.py:148] Found TPU system:
I0812 16:13:13.221354 140458443851200 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:13:13.221865 140458443851200 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:13:13.221923 140458443851200 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:13:13.221976 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:13:13.222429 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:13:13.222498 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:13:13.222552 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:13:13.222600 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:13:13.222651 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:13:13.222698 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:13:13.222744 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:13:13.222790 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:13:13.222851 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:13:13.222899 140458443851200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:13:13.229146 140458443851200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:13:13.241915 140458443851200 estimator.py:1145] Calling model_fn.
W0812 16:13:13.242599 140458443851200 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:13:13.508929 140458443851200 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:13:14.014272 140458443851200 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:13:14.076045 140458443851200 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:13:14.082030 140458443851200 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:13:14.265321 140458443851200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:13:14.279165 140458443851200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:13:14.294367 140458443851200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:13:14.304568 140458443851200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:13:14.310656 140458443851200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:13:14.739272 140458443851200 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:13:14.755259 140458443851200 estimator.py:1147] Done calling model_fn.
I0812 16:13:18.281261 140458443851200 tpu_estimator.py:499] TPU job name worker
I0812 16:13:18.396828 140458443851200 monitored_session.py:240] Graph was finalized.
I0812 16:13:18.966469 140458443851200 session_manager.py:500] Running local_init_op.
I0812 16:13:18.998655 140458443851200 session_manager.py:502] Done running local_init_op.
I0812 16:13:21.534248 140458443851200 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:13:33.476645 140458443851200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:13:33.597398 140458443851200 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:13:33.597881 140458443851200 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:13:33.598413: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:13:33.603195 140458443851200 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:13:33.605658 140458443851200 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:13:33.609658 140458443851200 tpu_estimator.py:557] Init TPU system
I0812 16:13:45.752146 140458443851200 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0812 16:13:45.753251 140457550006016 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:13:45.754131 140457541613312 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:13:45.800506 140458443851200 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:13:45.801383 140458443851200 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:13:45.812361 140457533220608 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:13:46.083625 140457533220608 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:13:50.103589 140457541613312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:13:54.588783 140458443851200 basic_session_run_hooks.py:262] loss = 0.22684486, step = 30
I0812 16:13:54.590591 140458443851200 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:14:07.676274 140458443851200 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:14:07.676640 140458443851200 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:14:07.676901 140457550006016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:14:07.677004 140457550006016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:14:07.677144 140458443851200 error_handling.py:96] infeed marked as finished
I0812 16:14:07.677242 140458443851200 tpu_estimator.py:602] Stop output thread controller
I0812 16:14:07.677301 140458443851200 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:14:07.677413 140457541613312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:14:07.677485 140457541613312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:14:07.677593 140458443851200 error_handling.py:96] outfeed marked as finished
I0812 16:14:07.677673 140458443851200 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:14:16.216849 140458443851200 estimator.py:368] Loss for final step: 0.22684486.
I0812 16:14:16.217789 140458443851200 error_handling.py:96] training_loop marked as finished
I0812 16:14:17.039874 140458443851200 estimator.py:1145] Calling model_fn.
E0812 16:14:17.754908 140458443851200 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:14:17.988415 140458443851200 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:14:18.015027 140458443851200 estimator.py:1147] Done calling model_fn.
I0812 16:14:18.034238 140458443851200 evaluation.py:255] Starting evaluation at 2019-08-12T16:14:18Z
I0812 16:14:18.034513 140458443851200 tpu_estimator.py:499] TPU job name worker
I0812 16:14:18.121495 140458443851200 monitored_session.py:240] Graph was finalized.
W0812 16:14:18.122306 140458443851200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:14:18.301789 140458443851200 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:14:20.903557 140458443851200 session_manager.py:500] Running local_init_op.
I0812 16:14:20.932339 140458443851200 session_manager.py:502] Done running local_init_op.
I0812 16:14:20.986021 140458443851200 tpu_estimator.py:557] Init TPU system
I0812 16:14:32.765960 140458443851200 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:14:32.766882 140457537943296 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:14:32.767355 140457524565760 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:14:32.836627 140458443851200 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:14:32.866214 140458443851200 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:14:32.866708 140458443851200 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:14:32.894758 140457174628096 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:14:33.120908 140457174628096 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:14:33.562134 140457524565760 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:14:34.039241 140458443851200 evaluation.py:167] Evaluation [10/10]
I0812 16:14:34.039585 140458443851200 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:14:34.039657 140458443851200 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:14:34.039908 140457537943296 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:14:34.040031 140457537943296 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:14:34.040169 140458443851200 error_handling.py:96] infeed marked as finished
I0812 16:14:34.040271 140458443851200 tpu_estimator.py:602] Stop output thread controller
I0812 16:14:34.040321 140458443851200 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:14:34.040435 140457524565760 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:14:34.040504 140457524565760 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:14:34.040615 140458443851200 error_handling.py:96] outfeed marked as finished
I0812 16:14:34.040699 140458443851200 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:15:03.204747 140458443851200 evaluation.py:275] Finished evaluation at 2019-08-12-16:15:03
I0812 16:15:03.205137 140458443851200 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9452, global_step = 30, loss = 0.21164532
I0812 16:15:07.458544 140458443851200 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:15:08.323565 140458443851200 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.21164532, 'global_step': 30, 'accuracy': 0.9452}

Removing gs://yangyou-mnist/log/#1565626396287380...
Removing gs://yangyou-mnist/log/checkpoint#1565626444313471...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565626412914183...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565626396.v3-8-tpu#1565626447371368...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565626408686995...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565626441149811...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565626400981443...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565626442076693...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565626407851509...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565626446459487...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565626504942971...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565626505.v3-8-tpu#1565626507957491...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:15:12.282874 140490783897024 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:15:12.283651 140490783897024 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:15:12.286597 140490783897024 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:15:12.287436 140490783897024 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:15:12.288019 140490783897024 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:15:12.288145 140490783897024 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:15:12.720238 140490783897024 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:15:12.726494 140490783897024 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:15:12.730355 140490783897024 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:15:12.782706 140490783897024 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:15:12.783004 140490783897024 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:15:12.922401 140490783897024 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:15:12.968475 140490783897024 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:15:12.968758 140490783897024 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:15:13.058339 140490783897024 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc6696e2250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc66b8bf210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:15:13.058701 140490783897024 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:15:13.427794 140490783897024 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:15:13.431037: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:15:13.443763 140490783897024 tpu_system_metadata.py:148] Found TPU system:
I0812 16:15:13.444134 140490783897024 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:15:13.444660 140490783897024 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:15:13.444720 140490783897024 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:15:13.444773 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:15:13.445075 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:15:13.445132 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:15:13.445183 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:15:13.445233 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:15:13.445280 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:15:13.445327 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:15:13.445374 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:15:13.445420 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:15:13.445466 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:15:13.445538 140490783897024 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:15:13.452003 140490783897024 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:15:13.465240 140490783897024 estimator.py:1145] Calling model_fn.
W0812 16:15:13.465869 140490783897024 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:15:13.733644 140490783897024 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:15:14.161293 140490783897024 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:15:14.224266 140490783897024 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:15:14.230376 140490783897024 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:15:14.414633 140490783897024 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:15:14.428423 140490783897024 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:15:14.443824 140490783897024 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:15:14.453906 140490783897024 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:15:14.460285 140490783897024 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:15:14.879519 140490783897024 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:15:14.895406 140490783897024 estimator.py:1147] Done calling model_fn.
I0812 16:15:18.440092 140490783897024 tpu_estimator.py:499] TPU job name worker
I0812 16:15:18.556348 140490783897024 monitored_session.py:240] Graph was finalized.
I0812 16:15:19.110522 140490783897024 session_manager.py:500] Running local_init_op.
I0812 16:15:19.147680 140490783897024 session_manager.py:502] Done running local_init_op.
I0812 16:15:21.626055 140490783897024 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:15:33.557846 140490783897024 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:15:33.679678 140490783897024 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:15:33.680150 140490783897024 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:15:33.680580: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:15:33.685322 140490783897024 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:15:33.687680 140490783897024 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:15:33.695914 140490783897024 tpu_estimator.py:557] Init TPU system
I0812 16:15:45.896214 140490783897024 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0812 16:15:45.897102 140490024138496 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:15:45.897563 140490015745792 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:15:45.950076 140490783897024 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:15:45.952752 140490783897024 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:15:45.958566 140490007353088 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:15:46.062649 140490007353088 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:15:50.395529 140490015745792 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:15:54.856764 140490783897024 basic_session_run_hooks.py:262] loss = 0.3545543, step = 30
I0812 16:15:54.858848 140490783897024 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:16:08.415611 140490783897024 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:16:08.415949 140490783897024 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:16:08.416312 140490024138496 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:16:08.416636 140490024138496 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:16:08.417016 140490783897024 error_handling.py:96] infeed marked as finished
I0812 16:16:08.417278 140490783897024 tpu_estimator.py:602] Stop output thread controller
I0812 16:16:08.417346 140490783897024 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:16:08.417531 140490015745792 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:16:08.417726 140490015745792 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:16:08.417960 140490783897024 error_handling.py:96] outfeed marked as finished
I0812 16:16:08.418128 140490783897024 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:16:16.198321 140490783897024 estimator.py:368] Loss for final step: 0.3545543.
I0812 16:16:16.199276 140490783897024 error_handling.py:96] training_loop marked as finished
I0812 16:16:16.973478 140490783897024 estimator.py:1145] Calling model_fn.
E0812 16:16:17.797513 140490783897024 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:16:18.017761 140490783897024 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:16:18.040463 140490783897024 estimator.py:1147] Done calling model_fn.
I0812 16:16:18.056643 140490783897024 evaluation.py:255] Starting evaluation at 2019-08-12T16:16:18Z
I0812 16:16:18.056914 140490783897024 tpu_estimator.py:499] TPU job name worker
I0812 16:16:18.134860 140490783897024 monitored_session.py:240] Graph was finalized.
W0812 16:16:18.135644 140490783897024 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:16:18.315062 140490783897024 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:16:20.838779 140490783897024 session_manager.py:500] Running local_init_op.
I0812 16:16:20.868021 140490783897024 session_manager.py:502] Done running local_init_op.
I0812 16:16:20.919209 140490783897024 tpu_estimator.py:557] Init TPU system
I0812 16:16:32.865952 140490783897024 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:16:32.867027 140490012075776 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:16:32.867844 140489521100544 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:16:32.931720 140490783897024 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:16:32.959508 140490783897024 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:16:32.959950 140490783897024 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:16:33.034501 140489512707840 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:16:33.141299 140489512707840 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:16:33.652664 140489521100544 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:16:34.108745 140490783897024 evaluation.py:167] Evaluation [10/10]
I0812 16:16:34.109191 140490783897024 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:16:34.109278 140490783897024 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:16:34.109571 140490012075776 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:16:34.109941 140490012075776 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:16:34.110274 140490783897024 error_handling.py:96] infeed marked as finished
I0812 16:16:34.110490 140490783897024 tpu_estimator.py:602] Stop output thread controller
I0812 16:16:34.110574 140490783897024 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:16:34.110824 140489521100544 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:16:34.111028 140489521100544 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:16:34.111229 140490783897024 error_handling.py:96] outfeed marked as finished
I0812 16:16:34.111386 140490783897024 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:17:03.241208 140490783897024 evaluation.py:275] Finished evaluation at 2019-08-12-16:17:03
I0812 16:17:03.241540 140490783897024 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9134, global_step = 30, loss = 0.3220788
I0812 16:17:07.618916 140490783897024 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:17:08.418616 140490783897024 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.3220788, 'global_step': 30, 'accuracy': 0.9134}

Removing gs://yangyou-mnist/log/#1565626516426094...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565626528587207...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565626561805474...
Removing gs://yangyou-mnist/log/checkpoint#1565626565045954...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565626533014889...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565626521044724...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565626516.v3-8-tpu#1565626568107164...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565626527697197...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565626562733758...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565626567161896...
Removing gs://yangyou-mnist/log/eval/#1565626624948682...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565626625.v3-8-tpu#1565626628106675...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:17:12.311152 140223886403008 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:17:12.311954 140223886403008 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:17:12.314698 140223886403008 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:17:12.315517 140223886403008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:17:12.316406 140223886403008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:17:12.316585 140223886403008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:17:12.746027 140223886403008 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:17:12.753520 140223886403008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:17:12.764013 140223886403008 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:17:12.816477 140223886403008 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:17:12.816783 140223886403008 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:17:13.104727 140223886403008 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:17:13.151545 140223886403008 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:17:13.151858 140223886403008 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:17:13.227555 140223886403008 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8845199250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8847376210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:17:13.227984 140223886403008 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:17:13.556607 140223886403008 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:17:13.559527: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:17:13.572607 140223886403008 tpu_system_metadata.py:148] Found TPU system:
I0812 16:17:13.572860 140223886403008 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:17:13.573551 140223886403008 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:17:13.573621 140223886403008 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:17:13.573681 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:17:13.574003 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:17:13.574068 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:17:13.574187 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:17:13.574275 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:17:13.574331 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:17:13.574390 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:17:13.574445 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:17:13.574505 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:17:13.574558 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:17:13.574610 140223886403008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:17:13.581677 140223886403008 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:17:13.596137 140223886403008 estimator.py:1145] Calling model_fn.
W0812 16:17:13.596836 140223886403008 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:17:13.920149 140223886403008 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:17:14.342811 140223886403008 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:17:14.406270 140223886403008 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:17:14.412569 140223886403008 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:17:14.599455 140223886403008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:17:14.613751 140223886403008 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:17:14.629707 140223886403008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:17:14.640312 140223886403008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:17:14.646573 140223886403008 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:17:15.075584 140223886403008 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:17:15.091486 140223886403008 estimator.py:1147] Done calling model_fn.
I0812 16:17:18.469909 140223886403008 tpu_estimator.py:499] TPU job name worker
I0812 16:17:18.591278 140223886403008 monitored_session.py:240] Graph was finalized.
I0812 16:17:19.212994 140223886403008 session_manager.py:500] Running local_init_op.
I0812 16:17:19.252799 140223886403008 session_manager.py:502] Done running local_init_op.
I0812 16:17:21.757864 140223886403008 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:17:33.790627 140223886403008 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:17:33.915548 140223886403008 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:17:33.916013 140223886403008 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:17:33.916412: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:17:33.921124 140223886403008 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:17:33.923433 140223886403008 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:17:33.927248 140223886403008 tpu_estimator.py:557] Init TPU system
I0812 16:17:45.888566 140223886403008 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:17:45.889456 140223118288640 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:17:45.889988 140223109895936 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:17:45.933917 140223886403008 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:17:45.935275 140223886403008 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:17:45.944518 140222629148416 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:17:46.035094 140222629148416 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:17:50.259432 140223109895936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:17:54.805671 140223886403008 basic_session_run_hooks.py:262] loss = 2.3076384, step = 30
I0812 16:17:54.808470 140223886403008 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:18:08.058748 140223886403008 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:18:08.059077 140223886403008 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:18:08.059350 140223118288640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:18:08.059463 140223118288640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:18:08.059618 140223886403008 error_handling.py:96] infeed marked as finished
I0812 16:18:08.059725 140223886403008 tpu_estimator.py:602] Stop output thread controller
I0812 16:18:08.059776 140223886403008 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:18:08.059890 140223109895936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:18:08.059967 140223109895936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:18:08.060092 140223886403008 error_handling.py:96] outfeed marked as finished
I0812 16:18:08.060197 140223886403008 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:18:16.156243 140223886403008 estimator.py:368] Loss for final step: 2.3076384.
I0812 16:18:16.157079 140223886403008 error_handling.py:96] training_loop marked as finished
I0812 16:18:17.013005 140223886403008 estimator.py:1145] Calling model_fn.
E0812 16:18:17.691401 140223886403008 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:18:17.914437 140223886403008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:18:17.937937 140223886403008 estimator.py:1147] Done calling model_fn.
I0812 16:18:17.955066 140223886403008 evaluation.py:255] Starting evaluation at 2019-08-12T16:18:17Z
I0812 16:18:17.955319 140223886403008 tpu_estimator.py:499] TPU job name worker
I0812 16:18:18.033838 140223886403008 monitored_session.py:240] Graph was finalized.
W0812 16:18:18.034579 140223886403008 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:18:18.237646 140223886403008 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:18:20.970519 140223886403008 session_manager.py:500] Running local_init_op.
I0812 16:18:20.999159 140223886403008 session_manager.py:502] Done running local_init_op.
I0812 16:18:21.052494 140223886403008 tpu_estimator.py:557] Init TPU system
I0812 16:18:33.275468 140223886403008 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0812 16:18:33.276423 140223109895936 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:18:33.277369 140222629148416 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:18:33.341813 140223886403008 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:18:33.365614 140223886403008 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:18:33.365966 140223886403008 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:18:33.401501 140222620755712 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:18:33.681813 140222620755712 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:18:34.110805 140222629148416 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:18:34.429945 140223886403008 evaluation.py:167] Evaluation [10/10]
I0812 16:18:34.430336 140223886403008 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:18:34.430432 140223886403008 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:18:34.430687 140223109895936 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:18:34.430964 140223109895936 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:18:34.431224 140223886403008 error_handling.py:96] infeed marked as finished
I0812 16:18:34.431410 140223886403008 tpu_estimator.py:602] Stop output thread controller
I0812 16:18:34.431467 140223886403008 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:18:34.431629 140222629148416 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:18:34.431777 140222629148416 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:18:34.431952 140223886403008 error_handling.py:96] outfeed marked as finished
I0812 16:18:34.432117 140223886403008 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:19:03.779047 140223886403008 evaluation.py:275] Finished evaluation at 2019-08-12-16:19:03
I0812 16:19:03.779412 140223886403008 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3014293
I0812 16:19:08.162615 140223886403008 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:19:08.931365 140223886403008 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3014293, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/graph.pbtxt#1565626641138198...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565626647860468...
Removing gs://yangyou-mnist/log/#1565626636644629...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565626648721852...
Removing gs://yangyou-mnist/log/checkpoint#1565626684512379...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565626653152806...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565626636.v3-8-tpu#1565626687746885...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565626681354013...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565626682201697...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565626686791574...
Removing gs://yangyou-mnist/log/eval/#1565626745548331...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565626745.v3-8-tpu#1565626748619907...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:19:12.844038 140522544309696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:19:12.844829 140522544309696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:19:12.847433 140522544309696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:19:12.848262 140522544309696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:19:12.848849 140522544309696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:19:12.848982 140522544309696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:19:13.270860 140522544309696 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:19:13.279323 140522544309696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:19:13.283636 140522544309696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:19:13.377480 140522544309696 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:19:13.377784 140522544309696 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:19:13.526622 140522544309696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:19:13.569096 140522544309696 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:19:13.569375 140522544309696 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:19:13.673608 140522544309696 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcdce7e2450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcdd09d6210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:19:13.674002 140522544309696 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:19:14.004585 140522544309696 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:19:14.007801: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:19:14.020221 140522544309696 tpu_system_metadata.py:148] Found TPU system:
I0812 16:19:14.020469 140522544309696 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:19:14.020946 140522544309696 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:19:14.021085 140522544309696 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:19:14.021142 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:19:14.021470 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:19:14.021528 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:19:14.021579 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:19:14.021626 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:19:14.021673 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:19:14.021719 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:19:14.021766 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:19:14.021812 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:19:14.021858 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:19:14.021904 140522544309696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:19:14.028016 140522544309696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:19:14.040764 140522544309696 estimator.py:1145] Calling model_fn.
W0812 16:19:14.041388 140522544309696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:19:14.317085 140522544309696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:19:14.739003 140522544309696 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:19:14.801140 140522544309696 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:19:14.807096 140522544309696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:19:14.990267 140522544309696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:19:15.004393 140522544309696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:19:15.020378 140522544309696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:19:15.030720 140522544309696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:19:15.037101 140522544309696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:19:15.462443 140522544309696 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:19:15.477719 140522544309696 estimator.py:1147] Done calling model_fn.
I0812 16:19:18.684290 140522544309696 tpu_estimator.py:499] TPU job name worker
I0812 16:19:18.800760 140522544309696 monitored_session.py:240] Graph was finalized.
I0812 16:19:19.408113 140522544309696 session_manager.py:500] Running local_init_op.
I0812 16:19:19.449879 140522544309696 session_manager.py:502] Done running local_init_op.
I0812 16:19:21.957581 140522544309696 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:19:34.035171 140522544309696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:19:34.140042 140522544309696 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:19:34.140464 140522544309696 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:19:34.140909: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:19:34.145823 140522544309696 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:19:34.148205 140522544309696 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:19:34.152880 140522544309696 tpu_estimator.py:557] Init TPU system
I0812 16:19:46.343003 140522544309696 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0812 16:19:46.343830 140521641068288 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:19:46.344294 140521632675584 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:19:46.390815 140522544309696 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:19:46.391661 140522544309696 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:19:46.403636 140521624282880 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:19:46.581650 140521624282880 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:19:50.840558 140521632675584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:19:55.322937 140522544309696 basic_session_run_hooks.py:262] loss = 2.302966, step = 30
I0812 16:19:55.325268 140522544309696 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:20:08.837483 140522544309696 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:20:08.837768 140522544309696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:20:08.838010 140521641068288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:20:08.838128 140521641068288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:20:08.838336 140522544309696 error_handling.py:96] infeed marked as finished
I0812 16:20:08.838448 140522544309696 tpu_estimator.py:602] Stop output thread controller
I0812 16:20:08.838505 140522544309696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:20:08.838643 140521632675584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:20:08.838726 140521632675584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:20:08.838850 140522544309696 error_handling.py:96] outfeed marked as finished
I0812 16:20:08.838932 140522544309696 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:20:16.709654 140522544309696 estimator.py:368] Loss for final step: 2.302966.
I0812 16:20:16.710545 140522544309696 error_handling.py:96] training_loop marked as finished
I0812 16:20:17.557792 140522544309696 estimator.py:1145] Calling model_fn.
E0812 16:20:18.373792 140522544309696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:20:18.601001 140522544309696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:20:18.624965 140522544309696 estimator.py:1147] Done calling model_fn.
I0812 16:20:18.643596 140522544309696 evaluation.py:255] Starting evaluation at 2019-08-12T16:20:18Z
I0812 16:20:18.643862 140522544309696 tpu_estimator.py:499] TPU job name worker
I0812 16:20:18.731906 140522544309696 monitored_session.py:240] Graph was finalized.
W0812 16:20:18.732737 140522544309696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:20:18.917589 140522544309696 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:20:21.647886 140522544309696 session_manager.py:500] Running local_init_op.
I0812 16:20:21.673943 140522544309696 session_manager.py:502] Done running local_init_op.
I0812 16:20:21.725824 140522544309696 tpu_estimator.py:557] Init TPU system
I0812 16:20:33.710982 140522544309696 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:20:33.711844 140521638184704 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:20:33.712332 140521629792000 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:20:33.797456 140522544309696 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:20:33.821326 140522544309696 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:20:33.821751 140522544309696 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:20:33.853071 140521621399296 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:20:34.084774 140521621399296 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:20:34.575263 140521629792000 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:20:34.932168 140522544309696 evaluation.py:167] Evaluation [10/10]
I0812 16:20:34.932496 140522544309696 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:20:34.932564 140522544309696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:20:34.932816 140521638184704 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:20:34.932950 140521638184704 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:20:34.933099 140522544309696 error_handling.py:96] infeed marked as finished
I0812 16:20:34.933295 140522544309696 tpu_estimator.py:602] Stop output thread controller
I0812 16:20:34.933346 140522544309696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:20:34.933473 140521629792000 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:20:34.933546 140521629792000 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:20:34.933671 140522544309696 error_handling.py:96] outfeed marked as finished
I0812 16:20:34.933747 140522544309696 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:21:04.181665 140522544309696 evaluation.py:275] Finished evaluation at 2019-08-12-16:21:04
I0812 16:21:04.182024 140522544309696 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 2.2988887
I0812 16:21:08.485471 140522544309696 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:21:09.358531 140522544309696 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2988887, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/#1565626756949467...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565626769227514...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565626773498993...
Removing gs://yangyou-mnist/log/checkpoint#1565626805349304...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565626802064255...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565626757.v3-8-tpu#1565626808470448...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565626761419697...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565626802966110...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565626768369681...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565626807524474...
Removing gs://yangyou-mnist/log/eval/#1565626865875125...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565626866.v3-8-tpu#1565626869006652...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:21:13.183502 139739043468736 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:21:13.184314 139739043468736 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:21:13.186996 139739043468736 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:21:13.187813 139739043468736 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:21:13.188402 139739043468736 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:21:13.188534 139739043468736 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:21:13.600959 139739043468736 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:21:13.609150 139739043468736 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:21:13.613589 139739043468736 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:21:13.663156 139739043468736 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:21:13.663441 139739043468736 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:21:13.762600 139739043468736 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:21:13.809854 139739043468736 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:21:13.810127 139739043468736 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:21:14.080073 139739043468736 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1762358090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1764535210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:21:14.080459 139739043468736 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:21:14.420314 139739043468736 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:21:14.423492: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:21:14.436675 139739043468736 tpu_system_metadata.py:148] Found TPU system:
I0812 16:21:14.436933 139739043468736 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:21:14.437413 139739043468736 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:21:14.437483 139739043468736 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:21:14.437537 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:21:14.437838 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:21:14.437895 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:21:14.437947 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:21:14.437997 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:21:14.438044 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:21:14.438090 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:21:14.438136 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:21:14.438235 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:21:14.438282 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:21:14.438330 139739043468736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:21:14.444350 139739043468736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:21:14.457187 139739043468736 estimator.py:1145] Calling model_fn.
W0812 16:21:14.457849 139739043468736 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:21:14.748043 139739043468736 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:21:15.165338 139739043468736 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:21:15.228183 139739043468736 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:21:15.234632 139739043468736 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:21:15.419945 139739043468736 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:21:15.434221 139739043468736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:21:15.449846 139739043468736 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:21:15.460397 139739043468736 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:21:15.466655 139739043468736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:21:15.891122 139739043468736 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:21:15.906969 139739043468736 estimator.py:1147] Done calling model_fn.
I0812 16:21:19.270848 139739043468736 tpu_estimator.py:499] TPU job name worker
I0812 16:21:19.388271 139739043468736 monitored_session.py:240] Graph was finalized.
I0812 16:21:19.993798 139739043468736 session_manager.py:500] Running local_init_op.
I0812 16:21:20.033869 139739043468736 session_manager.py:502] Done running local_init_op.
I0812 16:21:22.595244 139739043468736 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:21:34.875798 139739043468736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:21:34.993690 139739043468736 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:21:34.994330 139739043468736 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:21:34.994793: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:21:34.999572 139739043468736 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:21:35.002085 139739043468736 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:21:35.007252 139739043468736 tpu_estimator.py:557] Init TPU system
I0812 16:21:46.717926 139739043468736 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:21:46.719005 139738149541632 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:21:46.719847 139738141148928 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:21:46.767685 139739043468736 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:21:46.768651 139739043468736 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:21:46.820749 139738132756224 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:21:47.051492 139738132756224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:21:51.111893 139738141148928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:21:55.647907 139739043468736 basic_session_run_hooks.py:262] loss = 2.3064003, step = 30
I0812 16:21:55.650276 139739043468736 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:22:09.167727 139739043468736 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:22:09.168045 139739043468736 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:22:09.168442 139738149541632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:22:09.168746 139738149541632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:22:09.169089 139739043468736 error_handling.py:96] infeed marked as finished
I0812 16:22:09.169321 139739043468736 tpu_estimator.py:602] Stop output thread controller
I0812 16:22:09.169390 139739043468736 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:22:09.169621 139738141148928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:22:09.169825 139738141148928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:22:09.170018 139739043468736 error_handling.py:96] outfeed marked as finished
I0812 16:22:09.170212 139739043468736 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:22:17.183604 139739043468736 estimator.py:368] Loss for final step: 2.3064003.
I0812 16:22:17.184406 139739043468736 error_handling.py:96] training_loop marked as finished
I0812 16:22:17.900849 139739043468736 estimator.py:1145] Calling model_fn.
E0812 16:22:18.596400 139739043468736 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:22:18.832740 139739043468736 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:22:18.856374 139739043468736 estimator.py:1147] Done calling model_fn.
I0812 16:22:18.872853 139739043468736 evaluation.py:255] Starting evaluation at 2019-08-12T16:22:18Z
I0812 16:22:18.873099 139739043468736 tpu_estimator.py:499] TPU job name worker
I0812 16:22:18.950548 139739043468736 monitored_session.py:240] Graph was finalized.
W0812 16:22:18.951293 139739043468736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:22:19.138926 139739043468736 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:22:21.671686 139739043468736 session_manager.py:500] Running local_init_op.
I0812 16:22:21.698868 139739043468736 session_manager.py:502] Done running local_init_op.
I0812 16:22:21.755424 139739043468736 tpu_estimator.py:557] Init TPU system
I0812 16:22:33.587507 139739043468736 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:22:33.588372 139738145871616 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:22:33.588787 139738137478912 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:22:33.653578 139739043468736 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:22:33.677040 139739043468736 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:22:33.677386 139739043468736 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:22:33.707988 139738124101376 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:22:33.825790 139738124101376 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:22:34.438982 139738137478912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:22:34.912892 139739043468736 evaluation.py:167] Evaluation [10/10]
I0812 16:22:34.913280 139739043468736 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:22:34.913362 139739043468736 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:22:34.913544 139738145871616 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:22:34.913639 139738145871616 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:22:34.913790 139739043468736 error_handling.py:96] infeed marked as finished
I0812 16:22:34.913881 139739043468736 tpu_estimator.py:602] Stop output thread controller
I0812 16:22:34.913928 139739043468736 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:22:34.914035 139738137478912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:22:34.914108 139738137478912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:22:34.914273 139739043468736 error_handling.py:96] outfeed marked as finished
I0812 16:22:34.914359 139739043468736 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:23:03.920689 139739043468736 evaluation.py:275] Finished evaluation at 2019-08-12-16:23:03
I0812 16:23:03.921139 139739043468736 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3027759
I0812 16:23:08.536566 139739043468736 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:23:09.313209 139739043468736 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3027759, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565626877351233...
Removing gs://yangyou-mnist/log/checkpoint#1565626925521571...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565626877.v3-8-tpu#1565626928843219...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565626894394521...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565626922400524...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565626923273088...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565626882052990...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565626889902040...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565626889043348...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565626927847047...
Removing gs://yangyou-mnist/log/eval/#1565626985634544...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565626985.v3-8-tpu#1565626988991968...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:23:13.094755 139962202273216 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:23:13.095781 139962202273216 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:23:13.098565 139962202273216 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:23:13.099452 139962202273216 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:23:13.100049 139962202273216 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:23:13.100171 139962202273216 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:23:13.517710 139962202273216 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:23:13.525352 139962202273216 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:23:13.529488 139962202273216 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:23:13.578907 139962202273216 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:23:13.579267 139962202273216 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:23:13.712763 139962202273216 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:23:13.809648 139962202273216 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:23:13.809931 139962202273216 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:23:13.892972 139962202273216 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4b5782a290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4b59a071d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:23:13.893369 139962202273216 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:23:14.216428 139962202273216 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:23:14.219433: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:23:15.154295 139962202273216 tpu_system_metadata.py:148] Found TPU system:
I0812 16:23:15.154592 139962202273216 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:23:15.158272 139962202273216 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:23:15.158493 139962202273216 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:23:15.158559 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:23:15.159043 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:23:15.159106 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:23:15.159158 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:23:15.159209 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:23:15.159257 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:23:15.159305 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:23:15.159353 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:23:15.159399 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:23:15.159444 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:23:15.159502 139962202273216 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:23:15.166090 139962202273216 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:23:15.179754 139962202273216 estimator.py:1145] Calling model_fn.
W0812 16:23:15.180391 139962202273216 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:23:15.446125 139962202273216 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:23:15.971507 139962202273216 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:23:16.034130 139962202273216 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:23:16.040203 139962202273216 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:23:16.229823 139962202273216 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:23:16.243506 139962202273216 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:23:16.265405 139962202273216 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:23:16.275757 139962202273216 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:23:16.281867 139962202273216 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:23:16.705076 139962202273216 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:23:16.720613 139962202273216 estimator.py:1147] Done calling model_fn.
I0812 16:23:20.193598 139962202273216 tpu_estimator.py:499] TPU job name worker
I0812 16:23:20.316054 139962202273216 monitored_session.py:240] Graph was finalized.
I0812 16:23:20.924336 139962202273216 session_manager.py:500] Running local_init_op.
I0812 16:23:20.955616 139962202273216 session_manager.py:502] Done running local_init_op.
I0812 16:23:23.525331 139962202273216 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:23:36.797334 139962202273216 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:23:36.919966 139962202273216 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:23:36.920466 139962202273216 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:23:36.920863: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:23:36.926542 139962202273216 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:23:36.928857 139962202273216 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:23:36.932832 139962202273216 tpu_estimator.py:557] Init TPU system
I0812 16:23:48.161556 139962202273216 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:23:48.162467 139961173014272 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:23:48.162920 139961164621568 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:23:48.207226 139962202273216 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:23:48.208074 139962202273216 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:23:48.219510 139961156228864 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:23:48.337512 139961156228864 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:23:52.559473 139961164621568 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:23:56.926743 139962202273216 basic_session_run_hooks.py:262] loss = 2.3056278, step = 30
I0812 16:23:56.929125 139962202273216 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:24:10.325895 139962202273216 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:24:10.326257 139962202273216 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:24:10.326561 139961173014272 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:24:10.326942 139961173014272 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:24:10.327178 139962202273216 error_handling.py:96] infeed marked as finished
I0812 16:24:10.327410 139962202273216 tpu_estimator.py:602] Stop output thread controller
I0812 16:24:10.327471 139962202273216 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:24:10.327620 139961164621568 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:24:10.327771 139961164621568 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:24:10.327997 139962202273216 error_handling.py:96] outfeed marked as finished
I0812 16:24:10.328142 139962202273216 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:24:18.461882 139962202273216 estimator.py:368] Loss for final step: 2.3056278.
I0812 16:24:18.462708 139962202273216 error_handling.py:96] training_loop marked as finished
I0812 16:24:19.255345 139962202273216 estimator.py:1145] Calling model_fn.
E0812 16:24:19.991869 139962202273216 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:24:20.224673 139962202273216 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:24:20.249428 139962202273216 estimator.py:1147] Done calling model_fn.
I0812 16:24:20.268857 139962202273216 evaluation.py:255] Starting evaluation at 2019-08-12T16:24:20Z
I0812 16:24:20.269118 139962202273216 tpu_estimator.py:499] TPU job name worker
I0812 16:24:20.360380 139962202273216 monitored_session.py:240] Graph was finalized.
W0812 16:24:20.361107 139962202273216 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:24:20.541974 139962202273216 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:24:23.023098 139962202273216 session_manager.py:500] Running local_init_op.
I0812 16:24:23.047301 139962202273216 session_manager.py:502] Done running local_init_op.
I0812 16:24:23.092741 139962202273216 tpu_estimator.py:557] Init TPU system
I0812 16:24:34.662395 139962202273216 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:24:34.663440 139961170130688 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:24:34.664455 139961161737984 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:24:34.730303 139962202273216 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:24:34.767684 139962202273216 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:24:34.768203 139962202273216 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:24:34.832712 139961153345280 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:24:34.935484 139961153345280 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:24:35.491962 139961161737984 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:24:35.862667 139962202273216 evaluation.py:167] Evaluation [10/10]
I0812 16:24:35.862993 139962202273216 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:24:35.863146 139962202273216 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:24:35.863385 139961170130688 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:24:35.863662 139961170130688 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:24:35.863852 139962202273216 error_handling.py:96] infeed marked as finished
I0812 16:24:35.864068 139962202273216 tpu_estimator.py:602] Stop output thread controller
I0812 16:24:35.864141 139962202273216 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:24:35.864295 139961161737984 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:24:35.864454 139961161737984 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:24:35.864650 139962202273216 error_handling.py:96] outfeed marked as finished
I0812 16:24:35.864842 139962202273216 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:25:05.029340 139962202273216 evaluation.py:275] Finished evaluation at 2019-08-12-16:25:05
I0812 16:25:05.029695 139962202273216 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.3022065
I0812 16:25:09.403485 139962202273216 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:25:10.198726 139962202273216 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3022065, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565626998210788...
Removing gs://yangyou-mnist/log/checkpoint#1565627046853741...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565627011899496...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565627002966515...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565627016294990...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565626998.v3-8-tpu#1565627050014966...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565627011038807...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565627043797800...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565627044760755...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565627049018416...
Removing gs://yangyou-mnist/log/eval/#1565627106723619...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565627106.v3-8-tpu#1565627109894033...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:25:14.028834 139935325550016 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:25:14.029613 139935325550016 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:25:14.032238 139935325550016 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:25:14.033081 139935325550016 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:25:14.033684 139935325550016 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:25:14.033826 139935325550016 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:25:14.457861 139935325550016 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:25:14.464688 139935325550016 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:25:14.468864 139935325550016 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:25:14.514899 139935325550016 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:25:14.515212 139935325550016 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:25:14.919229 139935325550016 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:25:15.013945 139935325550016 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:25:15.014272 139935325550016 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:25:15.136210 139935325550016 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f45158860d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4517a63210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:25:15.136600 139935325550016 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:25:15.458811 139935325550016 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:25:15.461939: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:25:15.476825 139935325550016 tpu_system_metadata.py:148] Found TPU system:
I0812 16:25:15.477160 139935325550016 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:25:15.477652 139935325550016 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:25:15.477710 139935325550016 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:25:15.477763 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:25:15.478051 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:25:15.478111 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:25:15.478214 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:25:15.478270 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:25:15.478317 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:25:15.478364 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:25:15.478410 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:25:15.478456 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:25:15.478507 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:25:15.478555 139935325550016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:25:15.484698 139935325550016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:25:15.497714 139935325550016 estimator.py:1145] Calling model_fn.
W0812 16:25:15.498429 139935325550016 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:25:15.779390 139935325550016 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:25:16.373646 139935325550016 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:25:16.435504 139935325550016 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:25:16.441562 139935325550016 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:25:16.625077 139935325550016 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:25:16.638706 139935325550016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:25:16.654002 139935325550016 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:25:16.664252 139935325550016 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:25:16.670290 139935325550016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:25:17.092525 139935325550016 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:25:17.108066 139935325550016 estimator.py:1147] Done calling model_fn.
I0812 16:25:20.493942 139935325550016 tpu_estimator.py:499] TPU job name worker
I0812 16:25:20.609998 139935325550016 monitored_session.py:240] Graph was finalized.
I0812 16:25:21.168870 139935325550016 session_manager.py:500] Running local_init_op.
I0812 16:25:21.206970 139935325550016 session_manager.py:502] Done running local_init_op.
I0812 16:25:23.853250 139935325550016 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:25:36.055341 139935325550016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:25:36.169539 139935325550016 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:25:36.170002 139935325550016 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:25:36.170523: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:25:36.174815 139935325550016 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:25:36.177108 139935325550016 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:25:36.181565 139935325550016 tpu_estimator.py:557] Init TPU system
I0812 16:25:48.367969 139935325550016 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0812 16:25:48.369050 139934431692544 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:25:48.369590 139934423299840 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:25:48.412350 139935325550016 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:25:48.413306 139935325550016 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:25:48.424164 139934414907136 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:25:48.533756 139934414907136 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:25:52.812120 139934423299840 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:25:57.147964 139935325550016 basic_session_run_hooks.py:262] loss = 1.0114219, step = 30
I0812 16:25:57.150337 139935325550016 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:26:10.519988 139935325550016 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:26:10.520296 139935325550016 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:26:10.520508 139934431692544 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:26:10.520625 139934431692544 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:26:10.520765 139935325550016 error_handling.py:96] infeed marked as finished
I0812 16:26:10.520859 139935325550016 tpu_estimator.py:602] Stop output thread controller
I0812 16:26:10.520910 139935325550016 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:26:10.521025 139934423299840 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:26:10.521097 139934423299840 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:26:10.521205 139935325550016 error_handling.py:96] outfeed marked as finished
I0812 16:26:10.521286 139935325550016 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:26:18.663975 139935325550016 estimator.py:368] Loss for final step: 1.0114219.
I0812 16:26:18.664844 139935325550016 error_handling.py:96] training_loop marked as finished
I0812 16:26:19.379260 139935325550016 estimator.py:1145] Calling model_fn.
E0812 16:26:20.072659 139935325550016 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:26:20.302890 139935325550016 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:26:20.328144 139935325550016 estimator.py:1147] Done calling model_fn.
I0812 16:26:20.344870 139935325550016 evaluation.py:255] Starting evaluation at 2019-08-12T16:26:20Z
I0812 16:26:20.345122 139935325550016 tpu_estimator.py:499] TPU job name worker
I0812 16:26:20.422352 139935325550016 monitored_session.py:240] Graph was finalized.
W0812 16:26:20.423080 139935325550016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:26:20.609929 139935325550016 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:26:23.264972 139935325550016 session_manager.py:500] Running local_init_op.
I0812 16:26:23.293400 139935325550016 session_manager.py:502] Done running local_init_op.
I0812 16:26:23.342585 139935325550016 tpu_estimator.py:557] Init TPU system
I0812 16:26:35.118599 139935325550016 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:26:35.119435 139934428022528 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:26:35.120563 139934419629824 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:26:35.183976 139935325550016 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:26:35.206816 139935325550016 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:26:35.207168 139935325550016 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:26:35.239406 139934406252288 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:26:35.355185 139934406252288 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:26:35.931160 139934419629824 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:26:36.257262 139935325550016 evaluation.py:167] Evaluation [10/10]
I0812 16:26:36.257635 139935325550016 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:26:36.257725 139935325550016 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:26:36.257915 139934428022528 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:26:36.258016 139934428022528 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:26:36.258189 139935325550016 error_handling.py:96] infeed marked as finished
I0812 16:26:36.258297 139935325550016 tpu_estimator.py:602] Stop output thread controller
I0812 16:26:36.258352 139935325550016 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:26:36.258485 139934419629824 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:26:36.258563 139934419629824 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:26:36.258687 139935325550016 error_handling.py:96] outfeed marked as finished
I0812 16:26:36.258771 139935325550016 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:27:05.450637 139935325550016 evaluation.py:275] Finished evaluation at 2019-08-12-16:27:05
I0812 16:27:05.450956 139935325550016 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8311, global_step = 30, loss = 0.9266227
I0812 16:27:09.907951 139935325550016 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:27:10.741101 139935325550016 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.9266227, 'global_step': 30, 'accuracy': 0.8311}

Removing gs://yangyou-mnist/log/#1565627118575454...
Removing gs://yangyou-mnist/log/checkpoint#1565627166990192...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565627118.v3-8-tpu#1565627170170041...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565627123313562...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565627130147727...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565627130995193...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565627164833535...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565627135576043...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565627163875154...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565627169263857...
Removing gs://yangyou-mnist/log/eval/#1565627227081888...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565627227.v3-8-tpu#1565627230421838...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:27:14.695990 139674731357632 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:27:14.696970 139674731357632 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:27:14.699888 139674731357632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:27:14.700757 139674731357632 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:27:14.701359 139674731357632 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:27:14.701527 139674731357632 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:27:15.137659 139674731357632 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:27:15.147603 139674731357632 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:27:15.152431 139674731357632 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:27:15.248765 139674731357632 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:27:15.249083 139674731357632 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:27:15.347707 139674731357632 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:27:15.394534 139674731357632 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:27:15.394831 139674731357632 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:27:15.520169 139674731357632 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0868e89190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f086b066210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:27:15.520553 139674731357632 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:27:15.851747 139674731357632 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:27:15.856900: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:27:15.871905 139674731357632 tpu_system_metadata.py:148] Found TPU system:
I0812 16:27:15.872189 139674731357632 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:27:15.872749 139674731357632 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:27:15.872817 139674731357632 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:27:15.872912 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:27:15.873380 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:27:15.873446 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:27:15.873507 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:27:15.873562 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:27:15.873619 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:27:15.873672 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:27:15.873723 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:27:15.873775 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:27:15.873827 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:27:15.873882 139674731357632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:27:15.880891 139674731357632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:27:15.894859 139674731357632 estimator.py:1145] Calling model_fn.
W0812 16:27:15.895524 139674731357632 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:27:16.156347 139674731357632 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:27:16.679810 139674731357632 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:27:16.743452 139674731357632 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:27:16.749352 139674731357632 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:27:16.932168 139674731357632 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:27:16.946088 139674731357632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:27:16.961819 139674731357632 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:27:16.972116 139674731357632 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:27:16.978302 139674731357632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:27:17.411777 139674731357632 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:27:17.428314 139674731357632 estimator.py:1147] Done calling model_fn.
I0812 16:27:20.776936 139674731357632 tpu_estimator.py:499] TPU job name worker
I0812 16:27:20.896589 139674731357632 monitored_session.py:240] Graph was finalized.
I0812 16:27:21.468597 139674731357632 session_manager.py:500] Running local_init_op.
I0812 16:27:21.507828 139674731357632 session_manager.py:502] Done running local_init_op.
I0812 16:27:24.306503 139674731357632 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:27:36.520775 139674731357632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:27:36.634457 139674731357632 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:27:36.634922 139674731357632 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:27:36.635392: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:27:36.640408 139674731357632 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:27:36.643099 139674731357632 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:27:36.647392 139674731357632 tpu_estimator.py:557] Init TPU system
I0812 16:27:48.559097 139674731357632 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:27:48.559936 139673971697408 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:27:48.560451 139673963304704 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:27:48.602850 139674731357632 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:27:48.603715 139674731357632 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:27:48.620558 139673477314304 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:27:48.769988 139673477314304 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:27:52.937983 139673963304704 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:27:57.395029 139674731357632 basic_session_run_hooks.py:262] loss = 0.49645233, step = 30
I0812 16:27:57.397353 139674731357632 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:28:10.459042 139674731357632 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:28:10.459321 139674731357632 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:28:10.459644 139673971697408 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:28:10.460024 139673971697408 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:28:10.460254 139674731357632 error_handling.py:96] infeed marked as finished
I0812 16:28:10.460470 139674731357632 tpu_estimator.py:602] Stop output thread controller
I0812 16:28:10.460550 139674731357632 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:28:10.460736 139673963304704 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:28:10.460902 139673963304704 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:28:10.461136 139674731357632 error_handling.py:96] outfeed marked as finished
I0812 16:28:10.461272 139674731357632 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:28:18.899223 139674731357632 estimator.py:368] Loss for final step: 0.49645233.
I0812 16:28:18.899993 139674731357632 error_handling.py:96] training_loop marked as finished
I0812 16:28:19.692605 139674731357632 estimator.py:1145] Calling model_fn.
E0812 16:28:20.407746 139674731357632 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:28:20.629873 139674731357632 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:28:20.654225 139674731357632 estimator.py:1147] Done calling model_fn.
I0812 16:28:20.673748 139674731357632 evaluation.py:255] Starting evaluation at 2019-08-12T16:28:20Z
I0812 16:28:20.674000 139674731357632 tpu_estimator.py:499] TPU job name worker
I0812 16:28:20.760991 139674731357632 monitored_session.py:240] Graph was finalized.
W0812 16:28:20.761753 139674731357632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:28:20.944483 139674731357632 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:28:23.565987 139674731357632 session_manager.py:500] Running local_init_op.
I0812 16:28:23.594316 139674731357632 session_manager.py:502] Done running local_init_op.
I0812 16:28:23.643529 139674731357632 tpu_estimator.py:557] Init TPU system
I0812 16:28:35.662457 139674731357632 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0812 16:28:35.663485 139673968027392 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:28:35.664258 139673477314304 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:28:35.733448 139674731357632 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:28:35.760544 139674731357632 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:28:35.760996 139674731357632 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:28:35.837630 139673468921600 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:28:35.940820 139673468921600 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:28:36.475166 139673477314304 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:28:36.769174 139674731357632 evaluation.py:167] Evaluation [10/10]
I0812 16:28:36.769606 139674731357632 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:28:36.769699 139674731357632 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:28:36.769942 139673968027392 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:28:36.770272 139673968027392 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:28:36.770483 139674731357632 error_handling.py:96] infeed marked as finished
I0812 16:28:36.770667 139674731357632 tpu_estimator.py:602] Stop output thread controller
I0812 16:28:36.770731 139674731357632 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:28:36.770940 139673477314304 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:28:36.771217 139673477314304 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:28:36.771445 139674731357632 error_handling.py:96] outfeed marked as finished
I0812 16:28:36.771630 139674731357632 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:29:06.015038 139674731357632 evaluation.py:275] Finished evaluation at 2019-08-12-16:29:06
I0812 16:29:06.015413 139674731357632 estimator.py:2039] Saving dict for global step 30: accuracy = 0.883, global_step = 30, loss = 0.46936426
I0812 16:29:10.238440 139674731357632 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:29:11.022655 139674731357632 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.46936426, 'global_step': 30, 'accuracy': 0.883}

Removing gs://yangyou-mnist/log/#1565627238921943...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565627250578848...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565627255996452...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565627283989159...
Removing gs://yangyou-mnist/log/checkpoint#1565627286973577...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565627284794563...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565627239.v3-8-tpu#1565627290158766...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565627243761534...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565627251447040...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565627289268405...
Removing gs://yangyou-mnist/log/eval/#1565627347683547...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565627347.v3-8-tpu#1565627350712224...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:29:14.831012 140392746800576 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:29:14.831825 140392746800576 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:29:14.834526 140392746800576 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:29:14.835370 140392746800576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:29:14.835973 140392746800576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:29:14.836108 140392746800576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:29:15.245181 140392746800576 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:29:15.252511 140392746800576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:29:15.256880 140392746800576 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:29:15.307338 140392746800576 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:29:15.307640 140392746800576 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:29:15.417315 140392746800576 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:29:15.465863 140392746800576 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:29:15.466223 140392746800576 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:29:15.822370 140392746800576 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7faf95f6c050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7faf98149210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:29:15.822743 140392746800576 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:29:16.152865 140392746800576 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:29:16.155715: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:29:16.168816 140392746800576 tpu_system_metadata.py:148] Found TPU system:
I0812 16:29:16.169084 140392746800576 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:29:16.169605 140392746800576 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:29:16.169663 140392746800576 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:29:16.169717 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:29:16.170002 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:29:16.170061 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:29:16.170115 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:29:16.170213 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:29:16.170269 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:29:16.170316 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:29:16.170363 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:29:16.170411 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:29:16.170456 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:29:16.170514 140392746800576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:29:16.176472 140392746800576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:29:16.189162 140392746800576 estimator.py:1145] Calling model_fn.
W0812 16:29:16.189776 140392746800576 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:29:16.472677 140392746800576 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:29:16.885904 140392746800576 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:29:16.948364 140392746800576 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:29:16.954413 140392746800576 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:29:17.136547 140392746800576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:29:17.150482 140392746800576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:29:17.165709 140392746800576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:29:17.175916 140392746800576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:29:17.181924 140392746800576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:29:17.600719 140392746800576 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:29:17.616457 140392746800576 estimator.py:1147] Done calling model_fn.
I0812 16:29:20.822320 140392746800576 tpu_estimator.py:499] TPU job name worker
I0812 16:29:20.940037 140392746800576 monitored_session.py:240] Graph was finalized.
I0812 16:29:21.510927 140392746800576 session_manager.py:500] Running local_init_op.
I0812 16:29:21.542382 140392746800576 session_manager.py:502] Done running local_init_op.
I0812 16:29:24.199817 140392746800576 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:29:35.969027 140392746800576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:29:36.075681 140392746800576 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:29:36.076215 140392746800576 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:29:36.076606: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:29:36.081619 140392746800576 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:29:36.084017 140392746800576 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:29:36.087958 140392746800576 tpu_estimator.py:557] Init TPU system
I0812 16:29:48.696727 140392746800576 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0812 16:29:48.697720 140391853053696 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:29:48.698218 140391844660992 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:29:48.741408 140392746800576 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:29:48.742331 140392746800576 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:29:48.754504 140391836268288 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:29:48.953140 140391836268288 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:29:53.221242 140391844660992 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:29:57.664978 140392746800576 basic_session_run_hooks.py:262] loss = 0.30687723, step = 30
I0812 16:29:57.667382 140392746800576 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:30:11.269313 140392746800576 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:30:11.269670 140392746800576 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:30:11.271089 140391853053696 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:30:11.271280 140391853053696 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:30:11.271445 140392746800576 error_handling.py:96] infeed marked as finished
I0812 16:30:11.271554 140392746800576 tpu_estimator.py:602] Stop output thread controller
I0812 16:30:11.271630 140392746800576 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:30:11.271769 140391844660992 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:30:11.271852 140391844660992 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:30:11.271962 140392746800576 error_handling.py:96] outfeed marked as finished
I0812 16:30:11.272056 140392746800576 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:30:19.060802 140392746800576 estimator.py:368] Loss for final step: 0.30687723.
I0812 16:30:19.061631 140392746800576 error_handling.py:96] training_loop marked as finished
I0812 16:30:19.872737 140392746800576 estimator.py:1145] Calling model_fn.
E0812 16:30:20.560379 140392746800576 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:30:20.788965 140392746800576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:30:20.811898 140392746800576 estimator.py:1147] Done calling model_fn.
I0812 16:30:20.830400 140392746800576 evaluation.py:255] Starting evaluation at 2019-08-12T16:30:20Z
I0812 16:30:20.830657 140392746800576 tpu_estimator.py:499] TPU job name worker
I0812 16:30:20.916423 140392746800576 monitored_session.py:240] Graph was finalized.
W0812 16:30:20.917186 140392746800576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:30:21.097093 140392746800576 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:30:23.824935 140392746800576 session_manager.py:500] Running local_init_op.
I0812 16:30:23.848028 140392746800576 session_manager.py:502] Done running local_init_op.
I0812 16:30:23.900429 140392746800576 tpu_estimator.py:557] Init TPU system
I0812 16:30:35.964256 140392746800576 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0812 16:30:35.965212 140391840990976 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:30:35.965791 140391827613440 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:30:36.031635 140392746800576 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:30:36.055444 140392746800576 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:30:36.056046 140392746800576 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:30:36.132075 140391819220736 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:30:36.336844 140391819220736 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:30:36.824820 140391827613440 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:30:37.114295 140392746800576 evaluation.py:167] Evaluation [10/10]
I0812 16:30:37.114619 140392746800576 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:30:37.114726 140392746800576 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:30:37.114945 140391840990976 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:30:37.115051 140391840990976 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:30:37.115200 140392746800576 error_handling.py:96] infeed marked as finished
I0812 16:30:37.115303 140392746800576 tpu_estimator.py:602] Stop output thread controller
I0812 16:30:37.115353 140392746800576 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:30:37.115463 140391827613440 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:30:37.115535 140391827613440 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:30:37.115649 140392746800576 error_handling.py:96] outfeed marked as finished
I0812 16:30:37.115725 140392746800576 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:31:06.435085 140392746800576 evaluation.py:275] Finished evaluation at 2019-08-12-16:31:06
I0812 16:31:06.435509 140392746800576 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9201, global_step = 30, loss = 0.32166868
I0812 16:31:10.922599 140392746800576 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:31:11.714032 140392746800576 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.32166868, 'global_step': 30, 'accuracy': 0.9201}

Removing gs://yangyou-mnist/log/#1565627359053412...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565627359.v3-8-tpu#1565627410926737...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565627371251185...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565627363620299...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565627375484400...
Removing gs://yangyou-mnist/log/checkpoint#1565627407491149...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565627404376825...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565627370381286...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565627405204193...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565627409955744...
Removing gs://yangyou-mnist/log/eval/#1565627468242718...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565627468.v3-8-tpu#1565627471406561...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:31:15.566730 140563190601152 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:31:15.567552 140563190601152 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:31:15.570271 140563190601152 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:31:15.571183 140563190601152 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:31:15.571798 140563190601152 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:31:15.571934 140563190601152 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:31:15.990026 140563190601152 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:31:15.996393 140563190601152 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:31:16.000200 140563190601152 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:31:16.095098 140563190601152 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:31:16.095396 140563190601152 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:31:16.297292 140563190601152 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:31:16.336800 140563190601152 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:31:16.337085 140563190601152 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:31:16.544576 140563190601152 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd74534c250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd747529210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:31:16.544928 140563190601152 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:31:17.403115 140563190601152 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:31:17.406028: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:31:17.418518 140563190601152 tpu_system_metadata.py:148] Found TPU system:
I0812 16:31:17.418778 140563190601152 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:31:17.419271 140563190601152 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:31:17.419338 140563190601152 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:31:17.419392 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:31:17.419682 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:31:17.419739 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:31:17.419800 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:31:17.419847 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:31:17.419894 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:31:17.419941 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:31:17.419996 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:31:17.420043 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:31:17.420089 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:31:17.420139 140563190601152 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:31:17.426126 140563190601152 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:31:17.438998 140563190601152 estimator.py:1145] Calling model_fn.
W0812 16:31:17.439618 140563190601152 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:31:17.715372 140563190601152 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:31:18.140124 140563190601152 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:31:18.203532 140563190601152 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:31:18.209444 140563190601152 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:31:18.391494 140563190601152 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:31:18.405842 140563190601152 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:31:18.421189 140563190601152 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:31:18.431289 140563190601152 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:31:18.437407 140563190601152 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:31:18.871326 140563190601152 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:31:18.887403 140563190601152 estimator.py:1147] Done calling model_fn.
I0812 16:31:22.330081 140563190601152 tpu_estimator.py:499] TPU job name worker
I0812 16:31:22.446597 140563190601152 monitored_session.py:240] Graph was finalized.
I0812 16:31:23.014091 140563190601152 session_manager.py:500] Running local_init_op.
I0812 16:31:23.045742 140563190601152 session_manager.py:502] Done running local_init_op.
I0812 16:31:25.688457 140563190601152 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:31:37.818674 140563190601152 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:31:37.936647 140563190601152 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:31:37.937181 140563190601152 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:31:37.937603: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:31:37.942383 140563190601152 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:31:37.944998 140563190601152 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:31:37.949306 140563190601152 tpu_estimator.py:557] Init TPU system
I0812 16:31:49.731012 140563190601152 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:31:49.732033 140562430932736 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:31:49.732887 140562422540032 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:31:49.778553 140563190601152 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:31:49.779561 140563190601152 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:31:49.790432 140562414147328 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:31:49.955473 140562414147328 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:31:54.198780 140562422540032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:31:58.702719 140563190601152 basic_session_run_hooks.py:262] loss = 0.25390694, step = 30
I0812 16:31:58.705030 140563190601152 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:32:11.870399 140563190601152 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:32:11.870701 140563190601152 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:32:11.871052 140562430932736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:32:11.871351 140562430932736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:32:11.871591 140563190601152 error_handling.py:96] infeed marked as finished
I0812 16:32:11.871774 140563190601152 tpu_estimator.py:602] Stop output thread controller
I0812 16:32:11.871828 140563190601152 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:32:11.871984 140562422540032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:32:11.872138 140562422540032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:32:11.872292 140563190601152 error_handling.py:96] outfeed marked as finished
I0812 16:32:11.872438 140563190601152 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:32:20.085027 140563190601152 estimator.py:368] Loss for final step: 0.25390694.
I0812 16:32:20.085977 140563190601152 error_handling.py:96] training_loop marked as finished
I0812 16:32:20.911993 140563190601152 estimator.py:1145] Calling model_fn.
E0812 16:32:21.650093 140563190601152 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:32:21.875087 140563190601152 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:32:21.897162 140563190601152 estimator.py:1147] Done calling model_fn.
I0812 16:32:21.915242 140563190601152 evaluation.py:255] Starting evaluation at 2019-08-12T16:32:21Z
I0812 16:32:21.915496 140563190601152 tpu_estimator.py:499] TPU job name worker
I0812 16:32:22.000313 140563190601152 monitored_session.py:240] Graph was finalized.
W0812 16:32:22.001157 140563190601152 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:32:22.199631 140563190601152 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:32:24.732462 140563190601152 session_manager.py:500] Running local_init_op.
I0812 16:32:24.756458 140563190601152 session_manager.py:502] Done running local_init_op.
I0812 16:32:24.811371 140563190601152 tpu_estimator.py:557] Init TPU system
I0812 16:32:36.414546 140563190601152 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0812 16:32:36.415538 140562418870016 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:32:36.416142 140561931564800 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:32:36.481472 140563190601152 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:32:36.506673 140563190601152 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:32:36.507026 140563190601152 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:32:36.583019 140561923172096 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:32:36.858763 140561923172096 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:32:37.214272 140561931564800 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:32:37.643052 140563190601152 evaluation.py:167] Evaluation [10/10]
I0812 16:32:37.643460 140563190601152 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:32:37.643554 140563190601152 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:32:37.643853 140562418870016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:32:37.644197 140562418870016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:32:37.644537 140563190601152 error_handling.py:96] infeed marked as finished
I0812 16:32:37.644720 140563190601152 tpu_estimator.py:602] Stop output thread controller
I0812 16:32:37.644778 140563190601152 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:32:37.645078 140561931564800 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:32:37.645303 140561931564800 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:32:37.645510 140563190601152 error_handling.py:96] outfeed marked as finished
I0812 16:32:37.645683 140563190601152 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:33:06.934334 140563190601152 evaluation.py:275] Finished evaluation at 2019-08-12-16:33:06
I0812 16:33:06.934716 140563190601152 estimator.py:2039] Saving dict for global step 30: accuracy = 0.936, global_step = 30, loss = 0.2606607
I0812 16:33:11.341108 140563190601152 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:33:12.111800 140563190601152 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.2606607, 'global_step': 30, 'accuracy': 0.936}

Removing gs://yangyou-mnist/log/#1565627480542240...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565627492832564...
Removing gs://yangyou-mnist/log/checkpoint#1565627528427027...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565627485113079...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565627480.v3-8-tpu#1565627531556307...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565627497320065...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565627525311453...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565627491949708...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565627526232433...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565627530544647...
Removing gs://yangyou-mnist/log/eval/#1565627588700850...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565627588.v3-8-tpu#1565627591802366...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:33:16.041804 139941782730176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:33:16.042690 139941782730176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:33:16.045360 139941782730176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:33:16.046493 139941782730176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:33:16.047209 139941782730176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:33:16.047378 139941782730176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:33:16.482933 139941782730176 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:33:16.490287 139941782730176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:33:16.494982 139941782730176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:33:16.545512 139941782730176 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:33:16.545824 139941782730176 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:33:16.655827 139941782730176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:33:16.702377 139941782730176 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:33:16.702693 139941782730176 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:33:16.958229 139941782730176 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4696692190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f469886f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:33:16.958610 139941782730176 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:33:17.290937 139941782730176 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:33:17.293818: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:33:17.305531 139941782730176 tpu_system_metadata.py:148] Found TPU system:
I0812 16:33:17.305798 139941782730176 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:33:17.306360 139941782730176 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:33:17.306421 139941782730176 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:33:17.306474 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:33:17.306777 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:33:17.306833 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:33:17.306881 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:33:17.306930 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:33:17.306977 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:33:17.307034 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:33:17.307081 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:33:17.307127 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:33:17.307173 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:33:17.307220 139941782730176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:33:17.313304 139941782730176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:33:17.325711 139941782730176 estimator.py:1145] Calling model_fn.
W0812 16:33:17.326390 139941782730176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:33:17.600605 139941782730176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:33:18.019785 139941782730176 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:33:18.083575 139941782730176 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:33:18.089687 139941782730176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:33:18.278968 139941782730176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:33:18.293432 139941782730176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:33:18.309231 139941782730176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:33:18.319691 139941782730176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:33:18.326189 139941782730176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:33:18.754877 139941782730176 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:33:18.770688 139941782730176 estimator.py:1147] Done calling model_fn.
I0812 16:33:22.035330 139941782730176 tpu_estimator.py:499] TPU job name worker
I0812 16:33:22.156128 139941782730176 monitored_session.py:240] Graph was finalized.
I0812 16:33:22.724354 139941782730176 session_manager.py:500] Running local_init_op.
I0812 16:33:22.755568 139941782730176 session_manager.py:502] Done running local_init_op.
I0812 16:33:25.448523 139941782730176 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:33:37.765121 139941782730176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:33:37.881325 139941782730176 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:33:37.881793 139941782730176 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:33:37.882246: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:33:37.887068 139941782730176 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:33:37.889390 139941782730176 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:33:37.893512 139941782730176 tpu_estimator.py:557] Init TPU system
I0812 16:34:16.020437 139941782730176 tpu_estimator.py:566] Initialized TPU in 38 seconds
I0812 16:34:16.021393 139940888827648 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:34:16.021907 139940880434944 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:34:16.064635 139941782730176 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:34:16.065478 139941782730176 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:34:16.078336 139940872042240 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:34:16.180948 139940872042240 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:34:20.644346 139940880434944 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:34:25.231254 139941782730176 basic_session_run_hooks.py:262] loss = 0.21646525, step = 30
I0812 16:34:25.234014 139941782730176 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:34:38.740938 139941782730176 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:34:38.741256 139941782730176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:34:38.741609 139940888827648 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:34:38.741934 139940888827648 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:34:38.742425 139941782730176 error_handling.py:96] infeed marked as finished
I0812 16:34:38.742681 139941782730176 tpu_estimator.py:602] Stop output thread controller
I0812 16:34:38.742816 139941782730176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:34:38.743036 139940880434944 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:34:38.743294 139940880434944 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:34:38.743510 139941782730176 error_handling.py:96] outfeed marked as finished
I0812 16:34:38.743707 139941782730176 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:34:46.292952 139941782730176 estimator.py:368] Loss for final step: 0.21646525.
I0812 16:34:46.293863 139941782730176 error_handling.py:96] training_loop marked as finished
I0812 16:34:47.112361 139941782730176 estimator.py:1145] Calling model_fn.
E0812 16:34:47.821887 139941782730176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:34:48.044203 139941782730176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:34:48.067190 139941782730176 estimator.py:1147] Done calling model_fn.
I0812 16:34:48.083631 139941782730176 evaluation.py:255] Starting evaluation at 2019-08-12T16:34:48Z
I0812 16:34:48.083867 139941782730176 tpu_estimator.py:499] TPU job name worker
I0812 16:34:48.160073 139941782730176 monitored_session.py:240] Graph was finalized.
W0812 16:34:48.160798 139941782730176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:34:48.344404 139941782730176 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:34:51.059912 139941782730176 session_manager.py:500] Running local_init_op.
I0812 16:34:51.083069 139941782730176 session_manager.py:502] Done running local_init_op.
I0812 16:34:51.136420 139941782730176 tpu_estimator.py:557] Init TPU system
I0812 16:36:00.042841 139941782730176 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 16:36:00.044097 139940885157632 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:36:00.044809 139940876764928 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:36:00.108105 139941782730176 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:36:00.130760 139941782730176 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:36:00.131196 139941782730176 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:36:00.167829 139940863387392 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:36:00.407783 139940863387392 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:36:00.826416 139940876764928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:36:01.290285 139941782730176 evaluation.py:167] Evaluation [10/10]
I0812 16:36:01.290657 139941782730176 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:36:01.290745 139941782730176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:36:01.291095 139940885157632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:36:01.291372 139940885157632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:36:01.291640 139941782730176 error_handling.py:96] infeed marked as finished
I0812 16:36:01.291831 139941782730176 tpu_estimator.py:602] Stop output thread controller
I0812 16:36:01.292222 139941782730176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:36:01.292457 139940876764928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:36:01.292634 139940876764928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:36:01.292802 139941782730176 error_handling.py:96] outfeed marked as finished
I0812 16:36:01.292944 139941782730176 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:36:30.503561 139941782730176 evaluation.py:275] Finished evaluation at 2019-08-12-16:36:30
I0812 16:36:30.503901 139941782730176 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9444, global_step = 30, loss = 0.21410413
I0812 16:36:34.952888 139941782730176 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:36:35.871675 139941782730176 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.21410413, 'global_step': 30, 'accuracy': 0.9444}

Removing gs://yangyou-mnist/log/#1565627600239811...
Removing gs://yangyou-mnist/log/checkpoint#1565627675152652...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565627600.v3-8-tpu#1565627678436104...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565627612892662...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565627604914660...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565627617286177...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565627611971933...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565627672044451...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565627672985312...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565627677446912...
Removing gs://yangyou-mnist/log/eval/#1565627792154889...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565627792.v3-8-tpu#1565627795551252...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:36:39.745560 140552622908864 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:36:39.746391 140552622908864 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:36:39.748986 140552622908864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:36:39.749792 140552622908864 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:36:39.750602 140552622908864 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:36:39.750745 140552622908864 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:36:40.172219 140552622908864 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:36:40.181603 140552622908864 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:36:40.186609 140552622908864 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:36:40.234857 140552622908864 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:36:40.235146 140552622908864 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:36:40.506669 140552622908864 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:36:40.552145 140552622908864 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:36:40.552437 140552622908864 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:36:40.668901 140552622908864 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd4cf529290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd4d1706210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:36:40.669279 140552622908864 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:36:40.995352 140552622908864 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:36:40.998330: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:36:41.010958 140552622908864 tpu_system_metadata.py:148] Found TPU system:
I0812 16:36:41.011189 140552622908864 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:36:41.011677 140552622908864 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:36:41.011761 140552622908864 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:36:41.011821 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:36:41.012131 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:36:41.012212 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:36:41.012267 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:36:41.012316 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:36:41.012363 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:36:41.012411 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:36:41.012456 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:36:41.012502 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:36:41.012547 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:36:41.012595 140552622908864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:36:41.018732 140552622908864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:36:41.031267 140552622908864 estimator.py:1145] Calling model_fn.
W0812 16:36:41.031872 140552622908864 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:36:41.305536 140552622908864 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:36:41.724673 140552622908864 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:36:41.786731 140552622908864 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:36:41.792612 140552622908864 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:36:41.975368 140552622908864 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:36:41.989336 140552622908864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:36:42.004770 140552622908864 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:36:42.015024 140552622908864 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:36:42.021162 140552622908864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:36:42.461093 140552622908864 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:36:42.477916 140552622908864 estimator.py:1147] Done calling model_fn.
I0812 16:36:46.029829 140552622908864 tpu_estimator.py:499] TPU job name worker
I0812 16:36:46.141988 140552622908864 monitored_session.py:240] Graph was finalized.
I0812 16:36:46.731547 140552622908864 session_manager.py:500] Running local_init_op.
I0812 16:36:46.768476 140552622908864 session_manager.py:502] Done running local_init_op.
I0812 16:36:49.260673 140552622908864 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:37:02.021785 140552622908864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:37:02.141230 140552622908864 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:37:02.141688 140552622908864 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:37:02.142093: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:37:02.148060 140552622908864 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:37:02.150757 140552622908864 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:37:02.155443 140552622908864 tpu_estimator.py:557] Init TPU system
I0812 16:37:44.046956 140552622908864 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 16:37:44.048306 140551588407040 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:37:44.049236 140551580014336 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:37:44.093473 140552622908864 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:37:44.094491 140552622908864 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:37:44.108867 140551571621632 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:37:44.271420 140551571621632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 16:37:48.452876 140551580014336 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:37:52.758639 140552622908864 basic_session_run_hooks.py:262] loss = 0.2462399, step = 30
I0812 16:37:52.761285 140552622908864 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:38:06.148595 140552622908864 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:38:06.148953 140552622908864 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:38:06.150582 140551588407040 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:38:06.150959 140551588407040 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:38:06.151190 140552622908864 error_handling.py:96] infeed marked as finished
I0812 16:38:06.151429 140552622908864 tpu_estimator.py:602] Stop output thread controller
I0812 16:38:06.151525 140552622908864 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:38:06.151715 140551580014336 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:38:06.151891 140551580014336 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:38:06.152085 140552622908864 error_handling.py:96] outfeed marked as finished
I0812 16:38:06.152256 140552622908864 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:38:14.402826 140552622908864 estimator.py:368] Loss for final step: 0.2462399.
I0812 16:38:14.403719 140552622908864 error_handling.py:96] training_loop marked as finished
I0812 16:38:15.219160 140552622908864 estimator.py:1145] Calling model_fn.
E0812 16:38:15.923969 140552622908864 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:38:16.155546 140552622908864 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:38:16.179656 140552622908864 estimator.py:1147] Done calling model_fn.
I0812 16:38:16.196365 140552622908864 evaluation.py:255] Starting evaluation at 2019-08-12T16:38:16Z
I0812 16:38:16.196598 140552622908864 tpu_estimator.py:499] TPU job name worker
I0812 16:38:16.276645 140552622908864 monitored_session.py:240] Graph was finalized.
W0812 16:38:16.277396 140552622908864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:38:16.459628 140552622908864 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:38:18.959119 140552622908864 session_manager.py:500] Running local_init_op.
I0812 16:38:18.986007 140552622908864 session_manager.py:502] Done running local_init_op.
I0812 16:38:19.034939 140552622908864 tpu_estimator.py:557] Init TPU system
I0812 16:39:28.058950 140552622908864 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 16:39:28.060029 140551580014336 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:39:28.060470 140551571621632 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:39:28.124417 140552622908864 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:39:28.148835 140552622908864 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:39:28.149220 140552622908864 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:39:28.225909 140551563228928 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:39:28.333812 140551563228928 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:39:28.878428 140551571621632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:39:29.190473 140552622908864 evaluation.py:167] Evaluation [10/10]
I0812 16:39:29.190934 140552622908864 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:39:29.191025 140552622908864 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:39:29.191237 140551580014336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:39:29.191344 140551580014336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:39:29.191504 140552622908864 error_handling.py:96] infeed marked as finished
I0812 16:39:29.191600 140552622908864 tpu_estimator.py:602] Stop output thread controller
I0812 16:39:29.191653 140552622908864 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:39:29.191785 140551571621632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:39:29.191863 140551571621632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:39:29.192014 140552622908864 error_handling.py:96] outfeed marked as finished
I0812 16:39:29.192101 140552622908864 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:39:58.425853 140552622908864 evaluation.py:275] Finished evaluation at 2019-08-12-16:39:58
I0812 16:39:58.426321 140552622908864 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9375, global_step = 30, loss = 0.22265863
I0812 16:40:02.736284 140552622908864 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:40:03.583465 140552622908864 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.22265863, 'global_step': 30, 'accuracy': 0.9375}

Removing gs://yangyou-mnist/log/checkpoint#1565627882462106...
Removing gs://yangyou-mnist/log/#1565627803959935...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565627816783944...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565627821539266...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565627879447978...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565627804.v3-8-tpu#1565627885845038...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565627815852470...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565627808731964...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565627880287380...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565627884953414...
Removing gs://yangyou-mnist/log/eval/#1565628000099141...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565628000.v3-8-tpu#1565628003242246...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:40:07.543525 140382073636288 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:40:07.544382 140382073636288 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:40:07.547282 140382073636288 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:40:07.548170 140382073636288 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:40:07.548835 140382073636288 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:40:07.548981 140382073636288 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:40:07.996732 140382073636288 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:40:08.005799 140382073636288 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:40:08.011229 140382073636288 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:40:08.061084 140382073636288 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:40:08.061391 140382073636288 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:40:08.167934 140382073636288 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:40:08.212053 140382073636288 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:40:08.212358 140382073636288 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:40:08.317147 140382073636288 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fad19cb3050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fad1be90210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:40:08.317521 140382073636288 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:40:08.638637 140382073636288 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:40:08.641620: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:40:08.653842 140382073636288 tpu_system_metadata.py:148] Found TPU system:
I0812 16:40:08.654128 140382073636288 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:40:08.654781 140382073636288 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:40:08.654856 140382073636288 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:40:08.654918 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:40:08.655257 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:40:08.655330 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:40:08.655392 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:40:08.655462 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:40:08.655519 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:40:08.655575 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:40:08.655627 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:40:08.655680 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:40:08.655735 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:40:08.655791 140382073636288 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:40:08.662574 140382073636288 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:40:08.676934 140382073636288 estimator.py:1145] Calling model_fn.
W0812 16:40:08.677627 140382073636288 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:40:08.952625 140382073636288 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:40:09.475348 140382073636288 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:40:09.539416 140382073636288 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:40:09.545749 140382073636288 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:40:09.729671 140382073636288 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:40:09.743937 140382073636288 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:40:09.759938 140382073636288 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:40:09.770467 140382073636288 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:40:09.776726 140382073636288 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:40:10.211458 140382073636288 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:40:10.227863 140382073636288 estimator.py:1147] Done calling model_fn.
I0812 16:40:13.570219 140382073636288 tpu_estimator.py:499] TPU job name worker
I0812 16:40:13.686486 140382073636288 monitored_session.py:240] Graph was finalized.
I0812 16:40:14.254364 140382073636288 session_manager.py:500] Running local_init_op.
I0812 16:40:14.293697 140382073636288 session_manager.py:502] Done running local_init_op.
I0812 16:40:16.799196 140382073636288 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:40:28.879755 140382073636288 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:40:29.001317 140382073636288 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:40:29.001805 140382073636288 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:40:29.002349: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:40:29.007337 140382073636288 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:40:29.009625 140382073636288 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:40:29.014025 140382073636288 tpu_estimator.py:557] Init TPU system
I0812 16:41:12.040829 140382073636288 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 16:41:12.042192 140381171463936 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:41:12.042999 140381163071232 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:41:12.088586 140382073636288 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:41:12.092710 140382073636288 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:41:12.097762 140381154678528 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:41:12.203423 140381154678528 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:41:16.664127 140381163071232 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:41:21.201751 140382073636288 basic_session_run_hooks.py:262] loss = 0.17086552, step = 30
I0812 16:41:21.204288 140382073636288 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:41:37.587416 140382073636288 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:41:37.587703 140382073636288 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:41:37.588016 140381171463936 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:41:37.588315 140381171463936 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:41:37.588526 140382073636288 error_handling.py:96] infeed marked as finished
I0812 16:41:37.588712 140382073636288 tpu_estimator.py:602] Stop output thread controller
I0812 16:41:37.588787 140382073636288 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:41:37.588998 140381163071232 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:41:37.589162 140381163071232 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:41:37.589330 140382073636288 error_handling.py:96] outfeed marked as finished
I0812 16:41:37.589461 140382073636288 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:41:42.327110 140382073636288 estimator.py:368] Loss for final step: 0.17086552.
I0812 16:41:42.328063 140382073636288 error_handling.py:96] training_loop marked as finished
I0812 16:41:43.018341 140382073636288 estimator.py:1145] Calling model_fn.
E0812 16:41:43.707551 140382073636288 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:41:43.933672 140382073636288 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:41:43.957567 140382073636288 estimator.py:1147] Done calling model_fn.
I0812 16:41:43.976380 140382073636288 evaluation.py:255] Starting evaluation at 2019-08-12T16:41:43Z
I0812 16:41:43.976639 140382073636288 tpu_estimator.py:499] TPU job name worker
I0812 16:41:44.062984 140382073636288 monitored_session.py:240] Graph was finalized.
W0812 16:41:44.063740 140382073636288 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:41:44.250700 140382073636288 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:41:46.836503 140382073636288 session_manager.py:500] Running local_init_op.
I0812 16:41:46.865452 140382073636288 session_manager.py:502] Done running local_init_op.
I0812 16:41:46.912401 140382073636288 tpu_estimator.py:557] Init TPU system
I0812 16:42:56.019712 140382073636288 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 16:42:56.020715 140381171463936 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:42:56.021240 140381163071232 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:42:56.085963 140382073636288 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:42:56.113301 140382073636288 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:42:56.113756 140382073636288 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:42:56.147660 140381154678528 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:42:56.305923 140381154678528 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:42:56.853049 140381163071232 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:42:57.170010 140382073636288 evaluation.py:167] Evaluation [10/10]
I0812 16:42:57.170424 140382073636288 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:42:57.170514 140382073636288 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:42:57.170821 140381171463936 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:42:57.171099 140381171463936 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:42:57.171350 140382073636288 error_handling.py:96] infeed marked as finished
I0812 16:42:57.171557 140382073636288 tpu_estimator.py:602] Stop output thread controller
I0812 16:42:57.171628 140382073636288 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:42:57.171869 140381163071232 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:42:57.172135 140381163071232 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:42:57.172379 140382073636288 error_handling.py:96] outfeed marked as finished
I0812 16:42:57.172565 140382073636288 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:43:26.391360 140382073636288 evaluation.py:275] Finished evaluation at 2019-08-12-16:43:26
I0812 16:43:26.391798 140382073636288 estimator.py:2039] Saving dict for global step 30: accuracy = 0.954, global_step = 30, loss = 0.15600745
I0812 16:43:30.729406 140382073636288 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:43:31.491905 140382073636288 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.15600745, 'global_step': 30, 'accuracy': 0.954}

Removing gs://yangyou-mnist/log/#1565628011762355...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565628011.v3-8-tpu#1565628097284444...
Removing gs://yangyou-mnist/log/checkpoint#1565628094078197...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565628016273158...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565628022981743...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565628023810905...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565628090039304...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565628028359405...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565628091022083...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565628096290668...
Removing gs://yangyou-mnist/log/eval/#1565628208049837...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565628208.v3-8-tpu#1565628211186636...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:43:35.500793 140236217804224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:43:35.501600 140236217804224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:43:35.504288 140236217804224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:43:35.505110 140236217804224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:43:35.505701 140236217804224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:43:35.505831 140236217804224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:43:35.919604 140236217804224 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:43:35.926188 140236217804224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:43:35.929949 140236217804224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:43:35.978471 140236217804224 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:43:35.978779 140236217804224 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:43:36.148464 140236217804224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:43:36.273935 140236217804224 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:43:36.274288 140236217804224 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:43:36.442487 140236217804224 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8b241bd1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8b2639a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:43:36.442882 140236217804224 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:43:36.770524 140236217804224 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:43:36.773652: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:43:36.786102 140236217804224 tpu_system_metadata.py:148] Found TPU system:
I0812 16:43:36.786420 140236217804224 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:43:36.786967 140236217804224 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:43:36.787039 140236217804224 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:43:36.787100 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:43:36.787416 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:43:36.787478 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:43:36.787543 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:43:36.787599 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:43:36.787666 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:43:36.787719 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:43:36.787770 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:43:36.787822 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:43:36.787873 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:43:36.787926 140236217804224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:43:36.794630 140236217804224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:43:36.808413 140236217804224 estimator.py:1145] Calling model_fn.
W0812 16:43:36.809072 140236217804224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:43:37.066543 140236217804224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:43:37.472001 140236217804224 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:43:37.533958 140236217804224 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:43:37.539928 140236217804224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:43:37.718563 140236217804224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:43:37.732064 140236217804224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:43:37.746982 140236217804224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:43:37.757168 140236217804224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:43:37.763034 140236217804224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:43:38.183701 140236217804224 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:43:38.199209 140236217804224 estimator.py:1147] Done calling model_fn.
I0812 16:43:41.532592 140236217804224 tpu_estimator.py:499] TPU job name worker
I0812 16:43:41.644133 140236217804224 monitored_session.py:240] Graph was finalized.
I0812 16:43:42.187275 140236217804224 session_manager.py:500] Running local_init_op.
I0812 16:43:42.218604 140236217804224 session_manager.py:502] Done running local_init_op.
I0812 16:43:44.650465 140236217804224 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:43:56.815628 140236217804224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:43:56.921715 140236217804224 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:43:56.922306 140236217804224 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:43:56.922712: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:43:56.928180 140236217804224 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:43:56.930550 140236217804224 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:43:56.934225 140236217804224 tpu_estimator.py:557] Init TPU system
I0812 16:44:40.062648 140236217804224 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 16:44:40.063779 140235044288256 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:44:40.064635 140235035895552 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:44:40.113789 140236217804224 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:44:40.115252 140236217804224 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:44:40.121364 140235027502848 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:44:40.241487 140235027502848 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:44:44.563652 140235035895552 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:44:49.033826 140236217804224 basic_session_run_hooks.py:262] loss = 0.117893994, step = 30
I0812 16:44:49.036493 140236217804224 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:45:02.564011 140236217804224 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:45:02.564361 140236217804224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:45:02.565949 140235044288256 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:45:02.566334 140235044288256 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:45:02.566562 140236217804224 error_handling.py:96] infeed marked as finished
I0812 16:45:02.566867 140236217804224 tpu_estimator.py:602] Stop output thread controller
I0812 16:45:02.566947 140236217804224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:45:02.567137 140235035895552 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:45:02.567321 140235035895552 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:45:02.567528 140236217804224 error_handling.py:96] outfeed marked as finished
I0812 16:45:02.567750 140236217804224 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:45:10.370392 140236217804224 estimator.py:368] Loss for final step: 0.117893994.
I0812 16:45:10.371289 140236217804224 error_handling.py:96] training_loop marked as finished
I0812 16:45:11.159957 140236217804224 estimator.py:1145] Calling model_fn.
E0812 16:45:11.853513 140236217804224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:45:12.080914 140236217804224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:45:12.104665 140236217804224 estimator.py:1147] Done calling model_fn.
I0812 16:45:12.122210 140236217804224 evaluation.py:255] Starting evaluation at 2019-08-12T16:45:12Z
I0812 16:45:12.122466 140236217804224 tpu_estimator.py:499] TPU job name worker
I0812 16:45:12.202377 140236217804224 monitored_session.py:240] Graph was finalized.
W0812 16:45:12.203150 140236217804224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:45:12.378890 140236217804224 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:45:14.838426 140236217804224 session_manager.py:500] Running local_init_op.
I0812 16:45:14.871614 140236217804224 session_manager.py:502] Done running local_init_op.
I0812 16:45:14.920273 140236217804224 tpu_estimator.py:557] Init TPU system
I0812 16:46:24.051589 140236217804224 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 16:46:24.052445 140235035895552 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:46:24.053246 140235027502848 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:46:24.115972 140236217804224 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:46:24.139172 140236217804224 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:46:24.139496 140236217804224 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:46:24.168174 140235019110144 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:46:24.273267 140235019110144 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:46:24.849878 140235027502848 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:46:25.287067 140236217804224 evaluation.py:167] Evaluation [10/10]
I0812 16:46:25.287406 140236217804224 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:46:25.287476 140236217804224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:46:25.287753 140235035895552 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:46:25.287877 140235035895552 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:46:25.288038 140236217804224 error_handling.py:96] infeed marked as finished
I0812 16:46:25.288225 140236217804224 tpu_estimator.py:602] Stop output thread controller
I0812 16:46:25.288286 140236217804224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:46:25.288409 140235027502848 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:46:25.288482 140235027502848 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:46:25.288598 140236217804224 error_handling.py:96] outfeed marked as finished
I0812 16:46:25.288680 140236217804224 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:46:54.340316 140236217804224 evaluation.py:275] Finished evaluation at 2019-08-12-16:46:54
I0812 16:46:54.340704 140236217804224 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9685, global_step = 30, loss = 0.09972701
I0812 16:46:58.731940 140236217804224 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:46:59.520740 140236217804224 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09972701, 'global_step': 30, 'accuracy': 0.9685}

Removing gs://yangyou-mnist/log/#1565628219634976...
Removing gs://yangyou-mnist/log/checkpoint#1565628298782798...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565628219.v3-8-tpu#1565628302219708...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565628224117626...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565628230990289...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565628231896345...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565628236325324...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565628295762991...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565628296641926...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565628300985435...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565628416049593...
/ [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565628416.v3-8-tpu#1565628419215941...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:47:03.477606 140243533366720 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:47:03.478573 140243533366720 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:47:03.481230 140243533366720 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:47:03.482131 140243533366720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:47:03.482806 140243533366720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:47:03.482949 140243533366720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:47:03.899425 140243533366720 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:47:03.906228 140243533366720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:47:03.909884 140243533366720 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:47:03.952934 140243533366720 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:47:03.953217 140243533366720 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:47:04.086046 140243533366720 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:47:04.176738 140243533366720 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:47:04.177052 140243533366720 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:47:04.299442 140243533366720 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8cd8267050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8cda444210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:47:04.299793 140243533366720 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:47:04.626844 140243533366720 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:47:04.629863: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:47:04.642225 140243533366720 tpu_system_metadata.py:148] Found TPU system:
I0812 16:47:04.642472 140243533366720 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:47:04.642987 140243533366720 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:47:04.643129 140243533366720 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:47:04.643193 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:47:04.643532 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:47:04.643594 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:47:04.643645 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:47:04.643692 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:47:04.643740 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:47:04.643802 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:47:04.643851 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:47:04.643898 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:47:04.643944 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:47:04.643991 140243533366720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:47:04.650320 140243533366720 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:47:04.663269 140243533366720 estimator.py:1145] Calling model_fn.
W0812 16:47:04.663969 140243533366720 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:47:04.944833 140243533366720 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:47:05.354482 140243533366720 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:47:05.415970 140243533366720 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:47:05.421976 140243533366720 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:47:05.602724 140243533366720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:47:05.616509 140243533366720 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:47:05.632339 140243533366720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:47:05.642503 140243533366720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:47:05.648637 140243533366720 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:47:06.083295 140243533366720 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:47:06.099616 140243533366720 estimator.py:1147] Done calling model_fn.
I0812 16:47:09.497319 140243533366720 tpu_estimator.py:499] TPU job name worker
I0812 16:47:09.611663 140243533366720 monitored_session.py:240] Graph was finalized.
I0812 16:47:10.157094 140243533366720 session_manager.py:500] Running local_init_op.
I0812 16:47:10.186177 140243533366720 session_manager.py:502] Done running local_init_op.
I0812 16:47:12.708874 140243533366720 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:47:24.992681 140243533366720 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:47:25.112648 140243533366720 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:47:25.113095 140243533366720 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:47:25.113478: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:47:25.120501 140243533366720 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:47:25.123146 140243533366720 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:47:25.127397 140243533366720 tpu_estimator.py:557] Init TPU system
I0812 16:48:08.070621 140243533366720 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 16:48:08.071887 140242761807616 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:48:08.072918 140242753414912 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:48:08.120604 140243533366720 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:48:08.121545 140243533366720 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:48:08.172064 140242745022208 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:48:08.402796 140242745022208 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:48:12.476835 140242753414912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:48:17.023365 140243533366720 basic_session_run_hooks.py:262] loss = 0.10398656, step = 30
I0812 16:48:17.026237 140243533366720 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:48:30.207268 140243533366720 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:48:30.207571 140243533366720 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:48:30.207931 140242761807616 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:48:30.208309 140242761807616 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:48:30.208539 140243533366720 error_handling.py:96] infeed marked as finished
I0812 16:48:30.208725 140243533366720 tpu_estimator.py:602] Stop output thread controller
I0812 16:48:30.208786 140243533366720 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:48:30.209120 140242753414912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:48:30.209316 140242753414912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:48:30.210314 140243533366720 error_handling.py:96] outfeed marked as finished
I0812 16:48:30.210539 140243533366720 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:48:38.528644 140243533366720 estimator.py:368] Loss for final step: 0.10398656.
I0812 16:48:38.529426 140243533366720 error_handling.py:96] training_loop marked as finished
I0812 16:48:39.312652 140243533366720 estimator.py:1145] Calling model_fn.
E0812 16:48:39.994431 140243533366720 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:48:40.217650 140243533366720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:48:40.241506 140243533366720 estimator.py:1147] Done calling model_fn.
I0812 16:48:40.258820 140243533366720 evaluation.py:255] Starting evaluation at 2019-08-12T16:48:40Z
I0812 16:48:40.259080 140243533366720 tpu_estimator.py:499] TPU job name worker
I0812 16:48:40.337835 140243533366720 monitored_session.py:240] Graph was finalized.
W0812 16:48:40.338620 140243533366720 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:48:40.527376 140243533366720 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:48:43.081753 140243533366720 session_manager.py:500] Running local_init_op.
I0812 16:48:43.104971 140243533366720 session_manager.py:502] Done running local_init_op.
I0812 16:48:43.149976 140243533366720 tpu_estimator.py:557] Init TPU system
I0812 16:49:52.013343 140243533366720 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 16:49:52.014489 140242753414912 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:49:52.015119 140242745022208 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:49:52.081453 140243533366720 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:49:52.108935 140243533366720 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:49:52.109317 140243533366720 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:49:52.139471 140242736629504 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:49:52.421400 140242736629504 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:49:52.854680 140242745022208 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:49:53.185272 140243533366720 evaluation.py:167] Evaluation [10/10]
I0812 16:49:53.185594 140243533366720 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:49:53.185681 140243533366720 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:49:53.185894 140242753414912 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:49:53.186233 140242753414912 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:49:53.186415 140243533366720 error_handling.py:96] infeed marked as finished
I0812 16:49:53.186583 140243533366720 tpu_estimator.py:602] Stop output thread controller
I0812 16:49:53.186652 140243533366720 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:49:53.186801 140242745022208 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:49:53.187004 140242745022208 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:49:53.187160 140243533366720 error_handling.py:96] outfeed marked as finished
I0812 16:49:53.187287 140243533366720 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:50:22.505990 140243533366720 evaluation.py:275] Finished evaluation at 2019-08-12-16:50:22
I0812 16:50:22.506366 140243533366720 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9748, global_step = 30, loss = 0.08368679
I0812 16:50:26.795151 140243533366720 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:50:27.557801 140243533366720 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08368679, 'global_step': 30, 'accuracy': 0.9748}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565628440028648...
Removing gs://yangyou-mnist/log/#1565628427567459...
Removing gs://yangyou-mnist/log/checkpoint#1565628506821657...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565628444516350...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565628427.v3-8-tpu#1565628509900874...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565628503721497...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565628432137840...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565628504646946...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565628439129919...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565628508984794...
Removing gs://yangyou-mnist/log/eval/#1565628624170626...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565628624.v3-8-tpu#1565628627242576...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:50:31.330491 139657671001536 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:50:31.331276 139657671001536 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:50:31.333797 139657671001536 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:50:31.334614 139657671001536 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:50:31.335169 139657671001536 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:50:31.335304 139657671001536 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:50:31.738817 139657671001536 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:50:31.745893 139657671001536 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:50:31.750041 139657671001536 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:50:31.795906 139657671001536 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:50:31.796199 139657671001536 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:50:31.902045 139657671001536 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:50:31.950819 139657671001536 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:50:31.951098 139657671001536 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:50:32.111150 139657671001536 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f04700832d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0472260210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:50:32.111490 139657671001536 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:50:32.435050 139657671001536 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:50:32.437838: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:50:32.451224 139657671001536 tpu_system_metadata.py:148] Found TPU system:
I0812 16:50:32.451472 139657671001536 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:50:32.451970 139657671001536 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:50:32.452039 139657671001536 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:50:32.452101 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:50:32.452389 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:50:32.452445 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:50:32.452497 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:50:32.452547 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:50:32.452594 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:50:32.452640 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:50:32.452686 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:50:32.452745 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:50:32.452792 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:50:32.452841 139657671001536 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:50:32.458936 139657671001536 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:50:32.471729 139657671001536 estimator.py:1145] Calling model_fn.
W0812 16:50:32.472349 139657671001536 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:50:32.741477 139657671001536 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:50:33.166774 139657671001536 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:50:33.231076 139657671001536 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:50:33.237296 139657671001536 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:50:33.429850 139657671001536 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:50:33.444196 139657671001536 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:50:33.459461 139657671001536 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:50:33.469687 139657671001536 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:50:33.475805 139657671001536 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:50:33.896702 139657671001536 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:50:33.912925 139657671001536 estimator.py:1147] Done calling model_fn.
I0812 16:50:37.113645 139657671001536 tpu_estimator.py:499] TPU job name worker
I0812 16:50:37.224931 139657671001536 monitored_session.py:240] Graph was finalized.
I0812 16:50:37.784840 139657671001536 session_manager.py:500] Running local_init_op.
I0812 16:50:37.823690 139657671001536 session_manager.py:502] Done running local_init_op.
I0812 16:50:40.445631 139657671001536 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:50:52.781970 139657671001536 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:50:52.897991 139657671001536 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:50:52.898431 139657671001536 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:50:52.898812: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:50:52.903508 139657671001536 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:50:52.905586 139657671001536 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:50:52.909153 139657671001536 tpu_estimator.py:557] Init TPU system
I0812 16:51:36.054178 139657671001536 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 16:51:36.055094 139656978589440 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:51:36.055593 139656498771712 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:51:36.101963 139657671001536 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:51:36.103674 139657671001536 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:51:36.113769 139656490379008 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:51:36.309153 139656490379008 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:51:40.669419 139656498771712 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:51:44.963267 139657671001536 basic_session_run_hooks.py:262] loss = 0.10604121, step = 30
I0812 16:51:44.965337 139657671001536 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:51:57.853965 139657671001536 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:51:57.854343 139657671001536 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:51:57.854650 139656978589440 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:51:57.854969 139656978589440 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:51:57.855319 139657671001536 error_handling.py:96] infeed marked as finished
I0812 16:51:57.855556 139657671001536 tpu_estimator.py:602] Stop output thread controller
I0812 16:51:57.855624 139657671001536 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:51:57.855829 139656498771712 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:51:57.856026 139656498771712 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:51:57.856214 139657671001536 error_handling.py:96] outfeed marked as finished
I0812 16:51:57.856398 139657671001536 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:52:06.440634 139657671001536 estimator.py:368] Loss for final step: 0.10604121.
I0812 16:52:06.441464 139657671001536 error_handling.py:96] training_loop marked as finished
I0812 16:52:07.223061 139657671001536 estimator.py:1145] Calling model_fn.
E0812 16:52:07.908042 139657671001536 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:52:08.135312 139657671001536 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:52:08.158533 139657671001536 estimator.py:1147] Done calling model_fn.
I0812 16:52:08.176291 139657671001536 evaluation.py:255] Starting evaluation at 2019-08-12T16:52:08Z
I0812 16:52:08.176534 139657671001536 tpu_estimator.py:499] TPU job name worker
I0812 16:52:08.261176 139657671001536 monitored_session.py:240] Graph was finalized.
W0812 16:52:08.261905 139657671001536 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:52:08.445791 139657671001536 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:52:12.689459 139657671001536 session_manager.py:500] Running local_init_op.
I0812 16:52:12.717331 139657671001536 session_manager.py:502] Done running local_init_op.
I0812 16:52:12.766762 139657671001536 tpu_estimator.py:557] Init TPU system
I0812 16:53:20.071496 139657671001536 tpu_estimator.py:566] Initialized TPU in 67 seconds
I0812 16:53:20.072525 139656490379008 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:53:20.073117 139656481986304 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:53:20.138381 139657671001536 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:53:20.164664 139657671001536 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:53:20.165026 139657671001536 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:53:20.248359 139656473593600 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:53:20.491527 139656473593600 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:53:20.903394 139656481986304 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:53:21.160881 139657671001536 evaluation.py:167] Evaluation [10/10]
I0812 16:53:21.161217 139657671001536 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:53:21.161309 139657671001536 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:53:21.161545 139656490379008 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:53:21.161653 139656490379008 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:53:21.161837 139657671001536 error_handling.py:96] infeed marked as finished
I0812 16:53:21.161942 139657671001536 tpu_estimator.py:602] Stop output thread controller
I0812 16:53:21.161990 139657671001536 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:53:21.162175 139656481986304 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:53:21.162292 139656481986304 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:53:21.162441 139657671001536 error_handling.py:96] outfeed marked as finished
I0812 16:53:21.162533 139657671001536 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:53:50.581656 139657671001536 evaluation.py:275] Finished evaluation at 2019-08-12-16:53:50
I0812 16:53:50.581990 139657671001536 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9741, global_step = 30, loss = 0.08707903
I0812 16:53:54.829818 139657671001536 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:53:55.602633 139657671001536 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08707903, 'global_step': 30, 'accuracy': 0.9741}

Removing gs://yangyou-mnist/log/#1565628635388410...
Removing gs://yangyou-mnist/log/checkpoint#1565628714449354...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565628635.v3-8-tpu#1565628717521576...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565628639905379...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565628646975009...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565628647803147...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565628652306314...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565628711403534...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565628712268139...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565628716565144...
Removing gs://yangyou-mnist/log/eval/#1565628832266475...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565628832.v3-8-tpu#1565628835296991...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:53:59.458828 139662980675008 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:53:59.459856 139662980675008 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:53:59.462939 139662980675008 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:53:59.463783 139662980675008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:53:59.464361 139662980675008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:53:59.464502 139662980675008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:53:59.868659 139662980675008 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:53:59.874957 139662980675008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:53:59.878752 139662980675008 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:54:00.014560 139662980675008 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:54:00.014832 139662980675008 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:54:00.118333 139662980675008 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:54:00.166626 139662980675008 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:54:00.166896 139662980675008 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:54:00.321949 139662980675008 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f05ac836190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f05aea13210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:54:00.322320 139662980675008 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:54:00.660329 139662980675008 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:54:00.663303: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:54:00.680103 139662980675008 tpu_system_metadata.py:148] Found TPU system:
I0812 16:54:00.680340 139662980675008 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:54:00.680819 139662980675008 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:54:00.680881 139662980675008 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:54:00.680932 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:54:00.681329 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:54:00.681387 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:54:00.681438 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:54:00.681487 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:54:00.681536 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:54:00.681591 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:54:00.681638 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:54:00.681685 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:54:00.681746 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:54:00.681796 139662980675008 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:54:00.687625 139662980675008 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:54:00.699897 139662980675008 estimator.py:1145] Calling model_fn.
W0812 16:54:00.700517 139662980675008 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:54:00.973817 139662980675008 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:54:01.495959 139662980675008 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:54:01.556770 139662980675008 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:54:01.562695 139662980675008 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:54:01.740226 139662980675008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:54:01.753850 139662980675008 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:54:01.769074 139662980675008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:54:01.779136 139662980675008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:54:01.785094 139662980675008 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:54:02.203185 139662980675008 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:54:02.218978 139662980675008 estimator.py:1147] Done calling model_fn.
I0812 16:54:06.040215 139662980675008 tpu_estimator.py:499] TPU job name worker
I0812 16:54:06.165777 139662980675008 monitored_session.py:240] Graph was finalized.
I0812 16:54:06.707318 139662980675008 session_manager.py:500] Running local_init_op.
I0812 16:54:06.739645 139662980675008 session_manager.py:502] Done running local_init_op.
I0812 16:54:09.162420 139662980675008 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:54:24.315968 139662980675008 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:54:24.432580 139662980675008 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:54:24.433052 139662980675008 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:54:24.433484: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:54:24.438422 139662980675008 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:54:24.440931 139662980675008 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:54:24.444791 139662980675008 tpu_estimator.py:557] Init TPU system
I0812 16:55:04.067898 139662980675008 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0812 16:55:04.068841 139662221092608 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:55:04.069333 139662212699904 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:55:04.111355 139662980675008 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:55:04.112333 139662980675008 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:55:04.169015 139661733263104 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:55:04.375066 139661733263104 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:55:08.594656 139662212699904 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:55:13.164882 139662980675008 basic_session_run_hooks.py:262] loss = 0.12416028, step = 30
I0812 16:55:13.170243 139662980675008 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:55:27.162992 139662980675008 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:55:27.163335 139662980675008 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:55:27.164943 139662221092608 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:55:27.165258 139662221092608 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:55:27.165545 139662980675008 error_handling.py:96] infeed marked as finished
I0812 16:55:27.165796 139662980675008 tpu_estimator.py:602] Stop output thread controller
I0812 16:55:27.165858 139662980675008 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:55:27.166033 139662212699904 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:55:27.166265 139662212699904 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:55:27.166444 139662980675008 error_handling.py:96] outfeed marked as finished
I0812 16:55:27.166615 139662980675008 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:55:34.492286 139662980675008 estimator.py:368] Loss for final step: 0.12416028.
I0812 16:55:34.493146 139662980675008 error_handling.py:96] training_loop marked as finished
I0812 16:55:35.285439 139662980675008 estimator.py:1145] Calling model_fn.
E0812 16:55:36.024091 139662980675008 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:55:36.250039 139662980675008 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:55:36.273545 139662980675008 estimator.py:1147] Done calling model_fn.
I0812 16:55:36.290807 139662980675008 evaluation.py:255] Starting evaluation at 2019-08-12T16:55:36Z
I0812 16:55:36.291093 139662980675008 tpu_estimator.py:499] TPU job name worker
I0812 16:55:36.371156 139662980675008 monitored_session.py:240] Graph was finalized.
W0812 16:55:36.371928 139662980675008 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:55:36.552982 139662980675008 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:55:39.235317 139662980675008 session_manager.py:500] Running local_init_op.
I0812 16:55:39.258500 139662980675008 session_manager.py:502] Done running local_init_op.
I0812 16:55:39.310010 139662980675008 tpu_estimator.py:557] Init TPU system
I0812 16:56:48.034025 139662980675008 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 16:56:48.034887 139661733263104 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:56:48.035322 139661724870400 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:56:48.099287 139662980675008 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:56:48.125483 139662980675008 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 16:56:48.125849 139662980675008 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 16:56:48.200344 139661716477696 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:56:48.322407 139661716477696 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:56:48.833034 139661724870400 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:56:49.139693 139662980675008 evaluation.py:167] Evaluation [10/10]
I0812 16:56:49.140031 139662980675008 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:56:49.140100 139662980675008 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:56:49.140341 139661733263104 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:56:49.140446 139661733263104 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:56:49.140579 139662980675008 error_handling.py:96] infeed marked as finished
I0812 16:56:49.140667 139662980675008 tpu_estimator.py:602] Stop output thread controller
I0812 16:56:49.140732 139662980675008 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:56:49.140841 139661724870400 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:56:49.140912 139661724870400 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:56:49.141035 139662980675008 error_handling.py:96] outfeed marked as finished
I0812 16:56:49.141109 139662980675008 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:57:18.417294 139662980675008 evaluation.py:275] Finished evaluation at 2019-08-12-16:57:18
I0812 16:57:18.417653 139662980675008 estimator.py:2039] Saving dict for global step 30: accuracy = 0.967, global_step = 30, loss = 0.13175768
I0812 16:57:22.727269 139662980675008 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 16:57:23.533335 139662980675008 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.13175768, 'global_step': 30, 'accuracy': 0.967}

Removing gs://yangyou-mnist/log/checkpoint#1565628923436544...
Removing gs://yangyou-mnist/log/#1565628844153493...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565628848630523...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565628844.v3-8-tpu#1565628926768282...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565628859180370...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565628858223595...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565628863780520...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565628920221326...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565628921115922...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565628925771131...
Removing gs://yangyou-mnist/log/eval/#1565629040070232...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565629040.v3-8-tpu#1565629043188432...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 16:57:27.387928 139857078683072 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 16:57:27.388756 139857078683072 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 16:57:27.391808 139857078683072 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 16:57:27.392702 139857078683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 16:57:27.393379 139857078683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 16:57:27.393523 139857078683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 16:57:27.811619 139857078683072 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 16:57:27.819875 139857078683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 16:57:27.824071 139857078683072 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:57:27.870759 139857078683072 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:57:27.871042 139857078683072 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:57:28.012218 139857078683072 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 16:57:28.049406 139857078683072 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 16:57:28.049695 139857078683072 transport.py:157] Attempting refresh to obtain initial access_token
I0812 16:57:28.137326 139857078683072 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f32dda7f190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f32dfc5c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 16:57:28.137681 139857078683072 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 16:57:28.473227 139857078683072 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 16:57:28.476142: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:57:28.488085 139857078683072 tpu_system_metadata.py:148] Found TPU system:
I0812 16:57:28.488332 139857078683072 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 16:57:28.488821 139857078683072 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 16:57:28.488879 139857078683072 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 16:57:28.488931 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 16:57:28.489347 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 16:57:28.489406 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 16:57:28.489456 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 16:57:28.489511 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 16:57:28.489568 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 16:57:28.489615 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 16:57:28.489662 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 16:57:28.489708 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 16:57:28.489754 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 16:57:28.489818 139857078683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 16:57:28.496016 139857078683072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 16:57:28.508668 139857078683072 estimator.py:1145] Calling model_fn.
W0812 16:57:28.509296 139857078683072 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 16:57:28.775765 139857078683072 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 16:57:29.190546 139857078683072 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 16:57:29.258341 139857078683072 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 16:57:29.264455 139857078683072 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:57:29.444653 139857078683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 16:57:29.458471 139857078683072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 16:57:29.473711 139857078683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 16:57:29.483800 139857078683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 16:57:29.489713 139857078683072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 16:57:29.911004 139857078683072 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 16:57:29.926757 139857078683072 estimator.py:1147] Done calling model_fn.
I0812 16:57:33.351447 139857078683072 tpu_estimator.py:499] TPU job name worker
I0812 16:57:33.468919 139857078683072 monitored_session.py:240] Graph was finalized.
I0812 16:57:34.024292 139857078683072 session_manager.py:500] Running local_init_op.
I0812 16:57:34.053703 139857078683072 session_manager.py:502] Done running local_init_op.
I0812 16:57:36.577080 139857078683072 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 16:57:48.867816 139857078683072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 16:57:48.983525 139857078683072 util.py:98] Initialized dataset iterators in 0 seconds
I0812 16:57:48.983942 139857078683072 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 16:57:48.984302: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 16:57:48.989234 139857078683072 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 16:57:48.991545 139857078683072 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 16:57:48.995393 139857078683072 tpu_estimator.py:557] Init TPU system
I0812 16:58:32.057128 139857078683072 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 16:58:32.058398 139856176461568 tpu_estimator.py:514] Starting infeed thread controller.
I0812 16:58:32.059397 139856168068864 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 16:58:32.103518 139857078683072 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 16:58:32.104487 139857078683072 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 16:58:32.121705 139856159676160 transport.py:157] Attempting refresh to obtain initial access_token
W0812 16:58:32.215972 139856159676160 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 16:58:36.479104 139856168068864 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 16:58:40.990314 139857078683072 basic_session_run_hooks.py:262] loss = 0.26538846, step = 30
I0812 16:58:40.992196 139857078683072 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 16:58:54.212452 139857078683072 tpu_estimator.py:598] Stop infeed thread controller
I0812 16:58:54.212745 139857078683072 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 16:58:54.212985 139856176461568 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 16:58:54.213099 139856176461568 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 16:58:54.213316 139857078683072 error_handling.py:96] infeed marked as finished
I0812 16:58:54.213516 139857078683072 tpu_estimator.py:602] Stop output thread controller
I0812 16:58:54.213624 139857078683072 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 16:58:54.213814 139856168068864 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 16:58:54.213918 139856168068864 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 16:58:54.214068 139857078683072 error_handling.py:96] outfeed marked as finished
I0812 16:58:54.214324 139857078683072 tpu_estimator.py:606] Shutdown TPU system.
I0812 16:59:02.345226 139857078683072 estimator.py:368] Loss for final step: 0.26538846.
I0812 16:59:02.346220 139857078683072 error_handling.py:96] training_loop marked as finished
I0812 16:59:03.044059 139857078683072 estimator.py:1145] Calling model_fn.
E0812 16:59:03.777882 139857078683072 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 16:59:04.008016 139857078683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 16:59:04.031598 139857078683072 estimator.py:1147] Done calling model_fn.
I0812 16:59:04.051182 139857078683072 evaluation.py:255] Starting evaluation at 2019-08-12T16:59:04Z
I0812 16:59:04.051440 139857078683072 tpu_estimator.py:499] TPU job name worker
I0812 16:59:04.131282 139857078683072 monitored_session.py:240] Graph was finalized.
W0812 16:59:04.132005 139857078683072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 16:59:04.313886 139857078683072 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 16:59:06.842950 139857078683072 session_manager.py:500] Running local_init_op.
I0812 16:59:06.871779 139857078683072 session_manager.py:502] Done running local_init_op.
I0812 16:59:06.922265 139857078683072 tpu_estimator.py:557] Init TPU system
I0812 17:00:16.021497 139857078683072 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 17:00:16.022589 139856176461568 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:00:16.023397 139856168068864 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:00:16.087739 139857078683072 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:00:16.116978 139857078683072 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:00:16.117427 139857078683072 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:00:16.148262 139856159676160 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:00:16.260422 139856159676160 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:00:16.855973 139856168068864 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:00:17.166074 139857078683072 evaluation.py:167] Evaluation [10/10]
I0812 17:00:17.166452 139857078683072 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:00:17.166538 139857078683072 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:00:17.166933 139856176461568 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:00:17.167208 139856176461568 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:00:17.167438 139857078683072 error_handling.py:96] infeed marked as finished
I0812 17:00:17.167638 139857078683072 tpu_estimator.py:602] Stop output thread controller
I0812 17:00:17.167695 139857078683072 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:00:17.167968 139856168068864 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:00:17.168138 139856168068864 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:00:17.168366 139857078683072 error_handling.py:96] outfeed marked as finished
I0812 17:00:17.168534 139857078683072 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:00:46.332566 139857078683072 evaluation.py:275] Finished evaluation at 2019-08-12-17:00:46
I0812 17:00:46.332987 139857078683072 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9382, global_step = 30, loss = 0.20210214
I0812 17:00:50.775890 139857078683072 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:00:51.575829 139857078683072 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.20210214, 'global_step': 30, 'accuracy': 0.9382}

Removing gs://yangyou-mnist/log/#1565629051409229...
Removing gs://yangyou-mnist/log/checkpoint#1565629130790394...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565629051.v3-8-tpu#1565629133908218...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565629056002733...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565629064077576...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565629068393216...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565629063165672...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565629127786485...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565629128657626...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565629132965506...
Removing gs://yangyou-mnist/log/eval/#1565629247965387...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565629248.v3-8-tpu#1565629251266776...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:00:55.369452 140000106493376 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:00:55.370275 140000106493376 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:00:55.372852 140000106493376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:00:55.373661 140000106493376 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:00:55.374325 140000106493376 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:00:55.374460 140000106493376 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:00:55.777892 140000106493376 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:00:55.784529 140000106493376 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:00:55.788256 140000106493376 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:00:55.881589 140000106493376 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:00:55.881865 140000106493376 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:00:56.167654 140000106493376 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:00:56.254009 140000106493376 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:00:56.254359 140000106493376 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:00:56.402900 140000106493376 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f542ac72210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f542ce4f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:00:56.403281 140000106493376 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:00:56.725683 140000106493376 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:00:56.728805: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:00:56.740438 140000106493376 tpu_system_metadata.py:148] Found TPU system:
I0812 17:00:56.740791 140000106493376 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:00:56.741324 140000106493376 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:00:56.741383 140000106493376 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:00:56.741434 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:00:56.741725 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:00:56.741780 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:00:56.741832 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:00:56.741879 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:00:56.741925 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:00:56.741972 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:00:56.742022 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:00:56.742069 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:00:56.742114 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:00:56.742201 140000106493376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:00:56.748127 140000106493376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:00:56.761054 140000106493376 estimator.py:1145] Calling model_fn.
W0812 17:00:56.761667 140000106493376 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:00:57.025333 140000106493376 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:00:57.526027 140000106493376 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:00:57.587363 140000106493376 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:00:57.593151 140000106493376 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:00:57.770653 140000106493376 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:00:57.784172 140000106493376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:00:57.799129 140000106493376 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:00:57.809123 140000106493376 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:00:57.815093 140000106493376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:00:58.226181 140000106493376 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:00:58.241552 140000106493376 estimator.py:1147] Done calling model_fn.
I0812 17:01:01.634057 140000106493376 tpu_estimator.py:499] TPU job name worker
I0812 17:01:01.747117 140000106493376 monitored_session.py:240] Graph was finalized.
I0812 17:01:02.320595 140000106493376 session_manager.py:500] Running local_init_op.
I0812 17:01:02.360436 140000106493376 session_manager.py:502] Done running local_init_op.
I0812 17:01:04.743789 140000106493376 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:01:16.910435 140000106493376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:01:17.038069 140000106493376 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:01:17.038619 140000106493376 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:01:17.039036: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:01:17.044639 140000106493376 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:01:17.047066 140000106493376 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:01:17.051024 140000106493376 tpu_estimator.py:557] Init TPU system
I0812 17:02:00.064834 140000106493376 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 17:02:00.065767 139999206954752 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:02:00.066251 139999198562048 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:02:00.110654 140000106493376 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:02:00.111552 140000106493376 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:02:00.123183 139999190169344 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:02:00.325304 139999190169344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:02:04.592756 139999198562048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:02:09.162681 140000106493376 basic_session_run_hooks.py:262] loss = 2.3021214, step = 30
I0812 17:02:09.165200 140000106493376 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:02:23.003009 140000106493376 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:02:23.003297 140000106493376 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:02:23.003622 139999206954752 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:02:23.004043 139999206954752 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:02:23.004370 140000106493376 error_handling.py:96] infeed marked as finished
I0812 17:02:23.004631 140000106493376 tpu_estimator.py:602] Stop output thread controller
I0812 17:02:23.004703 140000106493376 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:02:23.004924 139999198562048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:02:23.005105 139999198562048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:02:23.005270 140000106493376 error_handling.py:96] outfeed marked as finished
I0812 17:02:23.005405 140000106493376 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:02:30.459328 140000106493376 estimator.py:368] Loss for final step: 2.3021214.
I0812 17:02:30.460174 140000106493376 error_handling.py:96] training_loop marked as finished
I0812 17:02:31.231301 140000106493376 estimator.py:1145] Calling model_fn.
E0812 17:02:32.063077 140000106493376 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:02:32.281080 140000106493376 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:02:32.303944 140000106493376 estimator.py:1147] Done calling model_fn.
I0812 17:02:32.320060 140000106493376 evaluation.py:255] Starting evaluation at 2019-08-12T17:02:32Z
I0812 17:02:32.320310 140000106493376 tpu_estimator.py:499] TPU job name worker
I0812 17:02:32.398166 140000106493376 monitored_session.py:240] Graph was finalized.
W0812 17:02:32.398873 140000106493376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:02:32.559900 140000106493376 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:02:35.196137 140000106493376 session_manager.py:500] Running local_init_op.
I0812 17:02:35.219191 140000106493376 session_manager.py:502] Done running local_init_op.
I0812 17:02:35.269813 140000106493376 tpu_estimator.py:557] Init TPU system
I0812 17:03:44.065433 140000106493376 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:03:44.066687 139999198562048 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:03:44.067255 139999190169344 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:03:44.132251 140000106493376 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:03:44.157248 140000106493376 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:03:44.157622 140000106493376 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:03:44.190713 139999181776640 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:03:44.314585 139999181776640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:03:44.857934 139999190169344 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:03:45.228039 140000106493376 evaluation.py:167] Evaluation [10/10]
I0812 17:03:45.228413 140000106493376 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:03:45.228491 140000106493376 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:03:45.228758 139999198562048 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:03:45.228866 139999198562048 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:03:45.229033 140000106493376 error_handling.py:96] infeed marked as finished
I0812 17:03:45.229146 140000106493376 tpu_estimator.py:602] Stop output thread controller
I0812 17:03:45.229197 140000106493376 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:03:45.229342 139999190169344 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:03:45.229422 139999190169344 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:03:45.229579 140000106493376 error_handling.py:96] outfeed marked as finished
I0812 17:03:45.229681 140000106493376 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:04:14.408196 140000106493376 evaluation.py:275] Finished evaluation at 2019-08-12-17:04:14
I0812 17:04:14.408536 140000106493376 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.300469
I0812 17:04:18.906265 140000106493376 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:04:19.742681 140000106493376 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.300469, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565629259758847...
Removing gs://yangyou-mnist/log/checkpoint#1565629339512236...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565629272074742...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565629259.v3-8-tpu#1565629342710542...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565629336613183...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565629264215123...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565629271204350...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565629276422772...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565629337407126...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565629341850592...
Removing gs://yangyou-mnist/log/eval/#1565629456072464...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565629456.v3-8-tpu#1565629459433587...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:04:23.602870 140529590281664 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:04:23.603668 140529590281664 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:04:23.606475 140529590281664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:04:23.607322 140529590281664 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:04:23.607928 140529590281664 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:04:23.608062 140529590281664 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:04:24.028538 140529590281664 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:04:24.035882 140529590281664 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:04:24.040523 140529590281664 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:04:24.089133 140529590281664 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:04:24.089446 140529590281664 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:04:24.247221 140529590281664 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:04:24.295212 140529590281664 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:04:24.295490 140529590281664 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:04:24.455631 140529590281664 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcf72789250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcf74966210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:04:24.456005 140529590281664 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:04:24.790509 140529590281664 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:04:24.793432: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:04:24.806627 140529590281664 tpu_system_metadata.py:148] Found TPU system:
I0812 17:04:24.806898 140529590281664 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:04:24.807449 140529590281664 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:04:24.807529 140529590281664 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:04:24.807591 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:04:24.807923 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:04:24.807996 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:04:24.808052 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:04:24.808125 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:04:24.808181 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:04:24.808238 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:04:24.808291 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:04:24.808343 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:04:24.808394 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:04:24.808454 140529590281664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:04:24.815231 140529590281664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:04:24.829183 140529590281664 estimator.py:1145] Calling model_fn.
W0812 17:04:24.829863 140529590281664 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:04:25.108561 140529590281664 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:04:25.783348 140529590281664 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:04:25.846028 140529590281664 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:04:25.852132 140529590281664 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:04:26.036947 140529590281664 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:04:26.050870 140529590281664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:04:26.066776 140529590281664 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:04:26.077155 140529590281664 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:04:26.083292 140529590281664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:04:26.507703 140529590281664 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:04:26.524399 140529590281664 estimator.py:1147] Done calling model_fn.
I0812 17:04:29.762294 140529590281664 tpu_estimator.py:499] TPU job name worker
I0812 17:04:29.880259 140529590281664 monitored_session.py:240] Graph was finalized.
I0812 17:04:30.453272 140529590281664 session_manager.py:500] Running local_init_op.
I0812 17:04:30.483563 140529590281664 session_manager.py:502] Done running local_init_op.
I0812 17:04:32.998564 140529590281664 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:04:45.352639 140529590281664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:04:45.459105 140529590281664 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:04:45.459577 140529590281664 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:04:45.459968: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:04:45.464879 140529590281664 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:04:45.467303 140529590281664 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:04:45.471601 140529590281664 tpu_estimator.py:557] Init TPU system
I0812 17:05:28.062383 140529590281664 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 17:05:28.063688 140528687499008 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:05:28.064789 140528679106304 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:05:28.110485 140529590281664 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:05:28.111403 140529590281664 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:05:28.174952 140528670713600 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:05:28.393557 140528670713600 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 17:05:32.436121 140528679106304 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:05:36.782368 140529590281664 basic_session_run_hooks.py:262] loss = 0.55194527, step = 30
I0812 17:05:36.784914 140529590281664 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:05:50.719329 140529590281664 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:05:50.719620 140529590281664 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:05:50.719852 140528687499008 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:05:50.719954 140528687499008 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:05:50.720091 140529590281664 error_handling.py:96] infeed marked as finished
I0812 17:05:50.720192 140529590281664 tpu_estimator.py:602] Stop output thread controller
I0812 17:05:50.720246 140529590281664 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:05:50.720360 140528679106304 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:05:50.720432 140528679106304 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:05:50.720546 140529590281664 error_handling.py:96] outfeed marked as finished
I0812 17:05:50.720626 140529590281664 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:05:58.523395 140529590281664 estimator.py:368] Loss for final step: 0.55194527.
I0812 17:05:58.524260 140529590281664 error_handling.py:96] training_loop marked as finished
I0812 17:05:59.317800 140529590281664 estimator.py:1145] Calling model_fn.
E0812 17:06:00.018433 140529590281664 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:06:00.246026 140529590281664 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:06:00.269093 140529590281664 estimator.py:1147] Done calling model_fn.
I0812 17:06:00.286366 140529590281664 evaluation.py:255] Starting evaluation at 2019-08-12T17:06:00Z
I0812 17:06:00.286602 140529590281664 tpu_estimator.py:499] TPU job name worker
I0812 17:06:00.364391 140529590281664 monitored_session.py:240] Graph was finalized.
W0812 17:06:00.365134 140529590281664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:06:00.555490 140529590281664 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:06:03.144107 140529590281664 session_manager.py:500] Running local_init_op.
I0812 17:06:03.167327 140529590281664 session_manager.py:502] Done running local_init_op.
I0812 17:06:03.218261 140529590281664 tpu_estimator.py:557] Init TPU system
I0812 17:07:12.026001 140529590281664 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:07:12.026916 140528692483840 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:07:12.027456 140528684091136 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:07:12.092051 140529590281664 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:07:12.117975 140529590281664 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:07:12.118347 140529590281664 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:07:12.147635 140528675698432 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:07:12.237530 140528675698432 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:07:12.812618 140528684091136 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:07:13.301433 140529590281664 evaluation.py:167] Evaluation [10/10]
I0812 17:07:13.301765 140529590281664 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:07:13.301846 140529590281664 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:07:13.302031 140528692483840 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:07:13.302128 140528692483840 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:07:13.302298 140529590281664 error_handling.py:96] infeed marked as finished
I0812 17:07:13.302390 140529590281664 tpu_estimator.py:602] Stop output thread controller
I0812 17:07:13.302438 140529590281664 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:07:13.302546 140528684091136 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:07:13.302619 140528684091136 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:07:13.302737 140529590281664 error_handling.py:96] outfeed marked as finished
I0812 17:07:13.302813 140529590281664 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:07:42.331844 140529590281664 evaluation.py:275] Finished evaluation at 2019-08-12-17:07:42
I0812 17:07:42.332261 140529590281664 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8755, global_step = 30, loss = 0.4674545
I0812 17:07:46.694932 140529590281664 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:07:47.463386 140529590281664 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.4674545, 'global_step': 30, 'accuracy': 0.8755}

Removing gs://yangyou-mnist/log/#1565629467981338...
Removing gs://yangyou-mnist/log/checkpoint#1565629547306099...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565629468.v3-8-tpu#1565629550403522...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565629480403477...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565629472460928...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565629479367032...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565629484832192...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565629544232225...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565629545063098...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565629549529591...
Removing gs://yangyou-mnist/log/eval/#1565629664045084...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565629664.v3-8-tpu#1565629667153205...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:07:51.255184 140337993840064 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:07:51.256005 140337993840064 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:07:51.259066 140337993840064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:07:51.259908 140337993840064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:07:51.260510 140337993840064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:07:51.260641 140337993840064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:07:51.675745 140337993840064 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:07:51.683077 140337993840064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:07:51.687015 140337993840064 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:07:51.779998 140337993840064 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:07:51.780297 140337993840064 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:07:52.010791 140337993840064 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:07:52.057723 140337993840064 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:07:52.058015 140337993840064 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:07:52.242897 140337993840064 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa2d66ee290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa2d88cb210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:07:52.243295 140337993840064 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:07:52.581407 140337993840064 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:07:52.584405: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:07:52.595724 140337993840064 tpu_system_metadata.py:148] Found TPU system:
I0812 17:07:52.595971 140337993840064 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:07:52.596457 140337993840064 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:07:52.596518 140337993840064 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:07:52.596570 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:07:52.596873 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:07:52.596930 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:07:52.596987 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:07:52.597037 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:07:52.597084 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:07:52.597130 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:07:52.597177 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:07:52.597223 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:07:52.597268 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:07:52.597316 140337993840064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:07:52.603363 140337993840064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:07:52.615921 140337993840064 estimator.py:1145] Calling model_fn.
W0812 17:07:52.616566 140337993840064 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:07:52.906399 140337993840064 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:07:53.312602 140337993840064 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:07:53.384018 140337993840064 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:07:53.389894 140337993840064 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:07:53.564558 140337993840064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:07:53.577845 140337993840064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:07:53.592586 140337993840064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:07:53.602492 140337993840064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:07:53.608377 140337993840064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:07:54.020068 140337993840064 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:07:54.035346 140337993840064 estimator.py:1147] Done calling model_fn.
I0812 17:07:57.228864 140337993840064 tpu_estimator.py:499] TPU job name worker
I0812 17:07:57.349092 140337993840064 monitored_session.py:240] Graph was finalized.
I0812 17:07:57.920869 140337993840064 session_manager.py:500] Running local_init_op.
I0812 17:07:57.951822 140337993840064 session_manager.py:502] Done running local_init_op.
I0812 17:08:00.578062 140337993840064 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:08:12.680098 140337993840064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:08:12.804987 140337993840064 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:08:12.805423 140337993840064 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:08:12.805801: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:08:12.811175 140337993840064 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:08:12.813397 140337993840064 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:08:12.817215 140337993840064 tpu_estimator.py:557] Init TPU system
I0812 17:08:56.062561 140337993840064 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 17:08:56.063674 140337100084992 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:08:56.064862 140337091692288 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:08:56.109146 140337993840064 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:08:56.110019 140337993840064 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:08:56.170100 140337083299584 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:08:56.403531 140337083299584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:09:00.768413 140337091692288 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:09:05.200695 140337993840064 basic_session_run_hooks.py:262] loss = 2.3068235, step = 30
I0812 17:09:05.203232 140337993840064 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:09:18.884166 140337993840064 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:09:18.884505 140337993840064 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:09:18.884756 140337100084992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:09:18.884867 140337100084992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:09:18.885019 140337993840064 error_handling.py:96] infeed marked as finished
I0812 17:09:18.885138 140337993840064 tpu_estimator.py:602] Stop output thread controller
I0812 17:09:18.885193 140337993840064 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:09:18.885318 140337091692288 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:09:18.885401 140337091692288 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:09:18.885528 140337993840064 error_handling.py:96] outfeed marked as finished
I0812 17:09:18.885624 140337993840064 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:09:26.532919 140337993840064 estimator.py:368] Loss for final step: 2.3068235.
I0812 17:09:26.533925 140337993840064 error_handling.py:96] training_loop marked as finished
I0812 17:09:27.370230 140337993840064 estimator.py:1145] Calling model_fn.
E0812 17:09:28.077347 140337993840064 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:09:28.305994 140337993840064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:09:28.333633 140337993840064 estimator.py:1147] Done calling model_fn.
I0812 17:09:28.350397 140337993840064 evaluation.py:255] Starting evaluation at 2019-08-12T17:09:28Z
I0812 17:09:28.350646 140337993840064 tpu_estimator.py:499] TPU job name worker
I0812 17:09:28.427309 140337993840064 monitored_session.py:240] Graph was finalized.
W0812 17:09:28.428107 140337993840064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:09:28.615303 140337993840064 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:09:31.373178 140337993840064 session_manager.py:500] Running local_init_op.
I0812 17:09:31.396241 140337993840064 session_manager.py:502] Done running local_init_op.
I0812 17:09:31.442365 140337993840064 tpu_estimator.py:557] Init TPU system
I0812 17:10:40.060606 140337993840064 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:10:40.061544 140337088022272 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:10:40.062105 140337074644736 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:10:40.125453 140337993840064 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:10:40.148380 140337993840064 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:10:40.148746 140337993840064 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:10:40.184324 140337066252032 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:10:40.483369 140337066252032 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:10:40.841531 140337074644736 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:10:41.316279 140337993840064 evaluation.py:167] Evaluation [10/10]
I0812 17:10:41.316633 140337993840064 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:10:41.316724 140337993840064 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:10:41.316909 140337088022272 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:10:41.317006 140337088022272 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:10:41.317130 140337993840064 error_handling.py:96] infeed marked as finished
I0812 17:10:41.317225 140337993840064 tpu_estimator.py:602] Stop output thread controller
I0812 17:10:41.317272 140337993840064 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:10:41.317383 140337074644736 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:10:41.317454 140337074644736 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:10:41.317564 140337993840064 error_handling.py:96] outfeed marked as finished
I0812 17:10:41.317643 140337993840064 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:11:10.577724 140337993840064 evaluation.py:275] Finished evaluation at 2019-08-12-17:11:10
I0812 17:11:10.578099 140337993840064 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 2.302384
I0812 17:11:14.970283 140337993840064 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:11:15.718974 140337993840064 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.302384, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/#1565629675490466...
Removing gs://yangyou-mnist/log/checkpoint#1565629755457047...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565629692197681...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565629752163743...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565629687752036...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565629675.v3-8-tpu#1565629758574159...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565629680028565...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565629753088154...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565629686892724...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565629757612011...
Removing gs://yangyou-mnist/log/eval/#1565629872270982...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565629872.v3-8-tpu#1565629875412618...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:11:19.632929 139983341471168 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:11:19.633687 139983341471168 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:11:19.636383 139983341471168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:11:19.637223 139983341471168 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:11:19.637845 139983341471168 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:11:19.637986 139983341471168 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:11:20.052447 139983341471168 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:11:20.059176 139983341471168 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:11:20.062999 139983341471168 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:11:20.118870 139983341471168 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:11:20.119141 139983341471168 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:11:20.199862 139983341471168 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:11:20.248800 139983341471168 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:11:20.249077 139983341471168 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:11:20.363018 139983341471168 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f50438130d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f50459f01d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:11:20.363382 139983341471168 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:11:20.698215 139983341471168 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:11:20.700957: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:11:20.712610 139983341471168 tpu_system_metadata.py:148] Found TPU system:
I0812 17:11:20.712851 139983341471168 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:11:20.713320 139983341471168 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:11:20.713377 139983341471168 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:11:20.713428 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:11:20.713721 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:11:20.713776 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:11:20.713826 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:11:20.713874 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:11:20.713921 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:11:20.713977 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:11:20.714056 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:11:20.714107 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:11:20.714206 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:11:20.714263 139983341471168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:11:20.720150 139983341471168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:11:20.732682 139983341471168 estimator.py:1145] Calling model_fn.
W0812 17:11:20.733279 139983341471168 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:11:21.001327 139983341471168 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:11:21.467849 139983341471168 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:11:21.529541 139983341471168 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:11:21.535576 139983341471168 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:11:21.717268 139983341471168 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:11:21.730999 139983341471168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:11:21.746649 139983341471168 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:11:21.757124 139983341471168 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:11:21.763276 139983341471168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:11:22.188769 139983341471168 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:11:22.205132 139983341471168 estimator.py:1147] Done calling model_fn.
I0812 17:11:25.545747 139983341471168 tpu_estimator.py:499] TPU job name worker
I0812 17:11:25.660520 139983341471168 monitored_session.py:240] Graph was finalized.
I0812 17:11:26.244618 139983341471168 session_manager.py:500] Running local_init_op.
I0812 17:11:26.281002 139983341471168 session_manager.py:502] Done running local_init_op.
I0812 17:11:28.801498 139983341471168 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:11:40.932862 139983341471168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:11:41.051677 139983341471168 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:11:41.052114 139983341471168 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:11:41.052565: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:11:41.057048 139983341471168 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:11:41.059314 139983341471168 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:11:41.063952 139983341471168 tpu_estimator.py:557] Init TPU system
I0812 17:12:24.056041 139983341471168 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 17:12:24.057198 139982303913728 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:12:24.058074 139982295521024 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:12:24.101731 139983341471168 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:12:24.102581 139983341471168 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:12:24.158659 139982287128320 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:12:24.383100 139982287128320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:12:28.482990 139982295521024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:12:33.134756 139983341471168 basic_session_run_hooks.py:262] loss = 2.3123555, step = 30
I0812 17:12:33.137578 139983341471168 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:12:46.327071 139983341471168 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:12:46.327366 139983341471168 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:12:46.327670 139982303913728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:12:46.327969 139982303913728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:12:46.328262 139983341471168 error_handling.py:96] infeed marked as finished
I0812 17:12:46.328495 139983341471168 tpu_estimator.py:602] Stop output thread controller
I0812 17:12:46.328577 139983341471168 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:12:46.328756 139982295521024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:12:46.328942 139982295521024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:12:46.329185 139983341471168 error_handling.py:96] outfeed marked as finished
I0812 17:12:46.329365 139983341471168 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:12:54.514580 139983341471168 estimator.py:368] Loss for final step: 2.3123555.
I0812 17:12:54.515474 139983341471168 error_handling.py:96] training_loop marked as finished
I0812 17:12:55.245908 139983341471168 estimator.py:1145] Calling model_fn.
E0812 17:12:56.019423 139983341471168 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:12:56.254908 139983341471168 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:12:56.278364 139983341471168 estimator.py:1147] Done calling model_fn.
I0812 17:12:56.294323 139983341471168 evaluation.py:255] Starting evaluation at 2019-08-12T17:12:56Z
I0812 17:12:56.294569 139983341471168 tpu_estimator.py:499] TPU job name worker
I0812 17:12:56.371617 139983341471168 monitored_session.py:240] Graph was finalized.
W0812 17:12:56.372307 139983341471168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:12:56.560193 139983341471168 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:12:59.500915 139983341471168 session_manager.py:500] Running local_init_op.
I0812 17:12:59.523710 139983341471168 session_manager.py:502] Done running local_init_op.
I0812 17:12:59.576242 139983341471168 tpu_estimator.py:557] Init TPU system
I0812 17:14:08.075592 139983341471168 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:14:08.076759 139982301030144 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:14:08.077249 139982292637440 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:14:08.143348 139983341471168 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:14:08.170921 139983341471168 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:14:08.171300 139983341471168 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:14:08.244872 139982284244736 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:14:08.479716 139982284244736 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:14:08.916819 139982292637440 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:14:09.225478 139983341471168 evaluation.py:167] Evaluation [10/10]
I0812 17:14:09.225805 139983341471168 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:14:09.225876 139983341471168 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:14:09.226201 139982301030144 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:14:09.226509 139982301030144 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:14:09.226787 139983341471168 error_handling.py:96] infeed marked as finished
I0812 17:14:09.227118 139983341471168 tpu_estimator.py:602] Stop output thread controller
I0812 17:14:09.227197 139983341471168 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:14:09.227425 139982292637440 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:14:09.227602 139982292637440 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:14:09.227808 139983341471168 error_handling.py:96] outfeed marked as finished
I0812 17:14:09.228054 139983341471168 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:14:38.572896 139983341471168 evaluation.py:275] Finished evaluation at 2019-08-12-17:14:38
I0812 17:14:38.573261 139983341471168 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1032, global_step = 30, loss = 2.3004951
I0812 17:14:43.025394 139983341471168 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:14:43.863187 139983341471168 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3004951, 'global_step': 30, 'accuracy': 0.1032}

Removing gs://yangyou-mnist/log/#1565629883674551...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565629896038066...
Removing gs://yangyou-mnist/log/checkpoint#1565629962994565...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565629883.v3-8-tpu#1565629965979481...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565629900440463...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565629888259221...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565629960876259...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565629895218010...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565629960022865...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565629965088519...
Removing gs://yangyou-mnist/log/eval/#1565630080390112...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565630080.v3-8-tpu#1565630083553553...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:14:47.697355 140166826902976 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:14:47.698270 140166826902976 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:14:47.700922 140166826902976 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:14:47.701905 140166826902976 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:14:47.702596 140166826902976 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:14:47.702738 140166826902976 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:14:48.122275 140166826902976 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:14:48.128885 140166826902976 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:14:48.132618 140166826902976 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:14:48.177105 140166826902976 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:14:48.177361 140166826902976 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:14:48.387625 140166826902976 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:14:48.433332 140166826902976 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:14:48.433619 140166826902976 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:14:48.631846 140166826902976 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f7afc154610>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f7afe348210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:14:48.632211 140166826902976 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:14:48.965837 140166826902976 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:14:48.968770: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:14:48.982913 140166826902976 tpu_system_metadata.py:148] Found TPU system:
I0812 17:14:48.983180 140166826902976 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:14:48.983673 140166826902976 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:14:48.983730 140166826902976 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:14:48.983783 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:14:48.984069 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:14:48.984127 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:14:48.984179 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:14:48.984226 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:14:48.984275 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:14:48.984322 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:14:48.984368 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:14:48.984414 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:14:48.984462 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:14:48.984522 140166826902976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:14:48.990293 140166826902976 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:14:49.002424 140166826902976 estimator.py:1145] Calling model_fn.
W0812 17:14:49.003025 140166826902976 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:14:49.267008 140166826902976 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:14:49.687690 140166826902976 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:14:49.748945 140166826902976 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:14:49.754939 140166826902976 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:14:49.935379 140166826902976 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:14:49.949338 140166826902976 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:14:49.964689 140166826902976 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:14:49.974967 140166826902976 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:14:49.981023 140166826902976 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:14:50.412060 140166826902976 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:14:50.428132 140166826902976 estimator.py:1147] Done calling model_fn.
I0812 17:14:53.964338 140166826902976 tpu_estimator.py:499] TPU job name worker
I0812 17:14:54.088314 140166826902976 monitored_session.py:240] Graph was finalized.
I0812 17:14:54.704166 140166826902976 session_manager.py:500] Running local_init_op.
I0812 17:14:54.737492 140166826902976 session_manager.py:502] Done running local_init_op.
I0812 17:14:57.310431 140166826902976 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:15:09.539551 140166826902976 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:15:09.656996 140166826902976 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:15:09.657496 140166826902976 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:15:09.657892: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:15:09.662678 140166826902976 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:15:09.665441 140166826902976 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:15:09.670017 140166826902976 tpu_estimator.py:557] Init TPU system
I0812 17:15:52.040663 140166826902976 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 17:15:52.041500 140166134490880 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:15:52.042273 140165653722880 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:15:52.087146 140166826902976 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:15:52.088124 140166826902976 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:15:52.098982 140165645330176 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:15:52.425477 140165645330176 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:15:56.594192 140165653722880 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:16:01.043708 140166826902976 basic_session_run_hooks.py:262] loss = 1.1098155, step = 30
I0812 17:16:01.045990 140166826902976 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:16:14.402365 140166826902976 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:16:14.402687 140166826902976 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:16:14.403103 140166134490880 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:16:14.403423 140166134490880 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:16:14.403724 140166826902976 error_handling.py:96] infeed marked as finished
I0812 17:16:14.403954 140166826902976 tpu_estimator.py:602] Stop output thread controller
I0812 17:16:14.404015 140166826902976 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:16:14.404195 140165653722880 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:16:14.404380 140165653722880 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:16:14.404544 140166826902976 error_handling.py:96] outfeed marked as finished
I0812 17:16:14.404681 140166826902976 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:16:22.561664 140166826902976 estimator.py:368] Loss for final step: 1.1098155.
I0812 17:16:22.562622 140166826902976 error_handling.py:96] training_loop marked as finished
I0812 17:16:23.373051 140166826902976 estimator.py:1145] Calling model_fn.
E0812 17:16:24.279349 140166826902976 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:16:24.510515 140166826902976 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:16:24.533521 140166826902976 estimator.py:1147] Done calling model_fn.
I0812 17:16:24.552690 140166826902976 evaluation.py:255] Starting evaluation at 2019-08-12T17:16:24Z
I0812 17:16:24.552932 140166826902976 tpu_estimator.py:499] TPU job name worker
I0812 17:16:24.641191 140166826902976 monitored_session.py:240] Graph was finalized.
W0812 17:16:24.641937 140166826902976 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:16:24.829988 140166826902976 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:16:27.425975 140166826902976 session_manager.py:500] Running local_init_op.
I0812 17:16:27.450006 140166826902976 session_manager.py:502] Done running local_init_op.
I0812 17:16:27.505767 140166826902976 tpu_estimator.py:557] Init TPU system
I0812 17:17:36.039479 140166826902976 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:17:36.040545 140165645330176 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:17:36.040983 140165636937472 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:17:36.112046 140166826902976 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:17:36.136404 140166826902976 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:17:36.136837 140166826902976 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:17:36.169099 140165628544768 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:17:36.549458 140165628544768 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:17:36.845458 140165636937472 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:17:37.283602 140166826902976 evaluation.py:167] Evaluation [10/10]
I0812 17:17:37.283958 140166826902976 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:17:37.284027 140166826902976 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:17:37.284200 140165645330176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:17:37.284293 140165645330176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:17:37.284439 140166826902976 error_handling.py:96] infeed marked as finished
I0812 17:17:37.284529 140166826902976 tpu_estimator.py:602] Stop output thread controller
I0812 17:17:37.284578 140166826902976 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:17:37.284696 140165636937472 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:17:37.284766 140165636937472 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:17:37.284961 140166826902976 error_handling.py:96] outfeed marked as finished
I0812 17:17:37.285058 140166826902976 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:18:06.642215 140166826902976 evaluation.py:275] Finished evaluation at 2019-08-12-17:18:06
I0812 17:18:06.642565 140166826902976 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8305, global_step = 30, loss = 1.0304096
I0812 17:18:11.088157 140166826902976 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:18:11.889035 140166826902976 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.0304096, 'global_step': 30, 'accuracy': 0.8305}

Removing gs://yangyou-mnist/log/#1565630091979746...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565630104593424...
Removing gs://yangyou-mnist/log/checkpoint#1565630171022204...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565630109058121...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565630103729323...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565630092.v3-8-tpu#1565630174091353...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565630168768751...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565630167803343...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565630096746836...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565630173191157...
Removing gs://yangyou-mnist/log/eval/#1565630288352763...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565630288.v3-8-tpu#1565630291525032...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:18:15.866183 140621080077760 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:18:15.867008 140621080077760 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:18:15.869596 140621080077760 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:18:15.870456 140621080077760 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:18:15.871038 140621080077760 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:18:15.871165 140621080077760 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:18:16.293395 140621080077760 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:18:16.300452 140621080077760 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:18:16.304424 140621080077760 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:18:16.355911 140621080077760 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:18:16.356194 140621080077760 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:18:16.574609 140621080077760 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:18:16.665797 140621080077760 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:18:16.666080 140621080077760 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:18:16.949352 140621080077760 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe4bfb01190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe4c1cde210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:18:16.949770 140621080077760 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:18:17.281924 140621080077760 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:18:17.284779: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:18:17.296785 140621080077760 tpu_system_metadata.py:148] Found TPU system:
I0812 17:18:17.297024 140621080077760 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:18:17.297501 140621080077760 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:18:17.297559 140621080077760 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:18:17.297610 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:18:17.297888 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:18:17.297949 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:18:17.298001 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:18:17.298048 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:18:17.298094 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:18:17.298180 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:18:17.298250 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:18:17.298297 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:18:17.298345 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:18:17.298393 140621080077760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:18:17.304116 140621080077760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:18:17.316042 140621080077760 estimator.py:1145] Calling model_fn.
W0812 17:18:17.316625 140621080077760 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:18:17.625658 140621080077760 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:18:18.026989 140621080077760 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:18:18.089282 140621080077760 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:18:18.095381 140621080077760 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:18:18.276387 140621080077760 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:18:18.289912 140621080077760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:18:18.304311 140621080077760 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:18:18.314374 140621080077760 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:18:18.320337 140621080077760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:18:18.729634 140621080077760 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:18:18.745090 140621080077760 estimator.py:1147] Done calling model_fn.
I0812 17:18:22.091355 140621080077760 tpu_estimator.py:499] TPU job name worker
I0812 17:18:22.205944 140621080077760 monitored_session.py:240] Graph was finalized.
I0812 17:18:22.781461 140621080077760 session_manager.py:500] Running local_init_op.
I0812 17:18:22.812355 140621080077760 session_manager.py:502] Done running local_init_op.
I0812 17:18:25.366344 140621080077760 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:18:37.604120 140621080077760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:18:37.725608 140621080077760 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:18:37.726181 140621080077760 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:18:37.726588: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:18:37.731549 140621080077760 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:18:37.733881 140621080077760 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:18:37.737931 140621080077760 tpu_estimator.py:557] Init TPU system
I0812 17:19:20.066760 140621080077760 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 17:19:20.067786 140620047841024 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:19:20.068442 140620039448320 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:19:20.114603 140621080077760 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:19:20.115603 140621080077760 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:19:20.129297 140620031055616 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:19:20.382610 140620031055616 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:19:24.552469 140620039448320 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:19:29.105730 140621080077760 basic_session_run_hooks.py:262] loss = 0.5280575, step = 30
I0812 17:19:29.108237 140621080077760 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:19:42.478305 140621080077760 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:19:42.478605 140621080077760 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:19:42.478912 140620047841024 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:19:42.479207 140620047841024 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:19:42.479404 140621080077760 error_handling.py:96] infeed marked as finished
I0812 17:19:42.479640 140621080077760 tpu_estimator.py:602] Stop output thread controller
I0812 17:19:42.479701 140621080077760 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:19:42.479901 140620039448320 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:19:42.480098 140620039448320 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:19:42.480261 140621080077760 error_handling.py:96] outfeed marked as finished
I0812 17:19:42.480395 140621080077760 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:19:50.515718 140621080077760 estimator.py:368] Loss for final step: 0.5280575.
I0812 17:19:50.516531 140621080077760 error_handling.py:96] training_loop marked as finished
I0812 17:19:51.249656 140621080077760 estimator.py:1145] Calling model_fn.
E0812 17:19:51.970767 140621080077760 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:19:52.198704 140621080077760 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:19:52.222943 140621080077760 estimator.py:1147] Done calling model_fn.
I0812 17:19:52.240148 140621080077760 evaluation.py:255] Starting evaluation at 2019-08-12T17:19:52Z
I0812 17:19:52.240385 140621080077760 tpu_estimator.py:499] TPU job name worker
I0812 17:19:52.318548 140621080077760 monitored_session.py:240] Graph was finalized.
W0812 17:19:52.319256 140621080077760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:19:52.509264 140621080077760 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:19:55.077331 140621080077760 session_manager.py:500] Running local_init_op.
I0812 17:19:55.101933 140621080077760 session_manager.py:502] Done running local_init_op.
I0812 17:19:55.147349 140621080077760 tpu_estimator.py:557] Init TPU system
I0812 17:21:03.992090 140621080077760 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:21:03.993275 140620039448320 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:21:03.994700 140620031055616 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:21:04.058888 140621080077760 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:21:04.087297 140621080077760 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:21:04.087672 140621080077760 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:21:04.123497 140620022662912 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:21:04.397917 140620022662912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:21:04.844279 140620031055616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:21:05.177508 140621080077760 evaluation.py:167] Evaluation [10/10]
I0812 17:21:05.177884 140621080077760 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:21:05.177964 140621080077760 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:21:05.178307 140620039448320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:21:05.178586 140620039448320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:21:05.178811 140621080077760 error_handling.py:96] infeed marked as finished
I0812 17:21:05.179003 140621080077760 tpu_estimator.py:602] Stop output thread controller
I0812 17:21:05.179071 140621080077760 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:21:05.179231 140620031055616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:21:05.179402 140620031055616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:21:05.179609 140621080077760 error_handling.py:96] outfeed marked as finished
I0812 17:21:05.179778 140621080077760 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:21:34.491503 140621080077760 evaluation.py:275] Finished evaluation at 2019-08-12-17:21:34
I0812 17:21:34.491887 140621080077760 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8797, global_step = 30, loss = 0.48591787
I0812 17:21:38.919789 140621080077760 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:21:39.880141 140621080077760 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.48591787, 'global_step': 30, 'accuracy': 0.8797}

Removing gs://yangyou-mnist/log/#1565630300186180...
Removing gs://yangyou-mnist/log/checkpoint#1565630378845946...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565630300.v3-8-tpu#1565630382174697...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565630312866533...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565630317123350...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565630376629639...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565630311908533...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565630375805557...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565630304835619...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565630381168563...
Removing gs://yangyou-mnist/log/eval/#1565630496232998...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565630496.v3-8-tpu#1565630499545491...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:21:43.753623 140071482291648 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:21:43.754621 140071482291648 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:21:43.757246 140071482291648 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:21:43.758053 140071482291648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:21:43.758697 140071482291648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:21:43.758868 140071482291648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:21:44.160063 140071482291648 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:21:44.166337 140071482291648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:21:44.169915 140071482291648 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:21:44.221079 140071482291648 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:21:44.221349 140071482291648 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:21:44.457778 140071482291648 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:21:44.506110 140071482291648 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:21:44.506434 140071482291648 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:21:44.735014 140071482291648 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f64c91b6250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f64cb393210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:21:44.735378 140071482291648 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:21:45.052443 140071482291648 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:21:45.055597: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:21:45.079190 140071482291648 tpu_system_metadata.py:148] Found TPU system:
I0812 17:21:45.079467 140071482291648 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:21:45.080121 140071482291648 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:21:45.080193 140071482291648 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:21:45.080255 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:21:45.080576 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:21:45.080635 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:21:45.080686 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:21:45.080734 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:21:45.080780 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:21:45.080827 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:21:45.080873 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:21:45.080919 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:21:45.080972 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:21:45.081027 140071482291648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:21:45.087088 140071482291648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:21:45.099256 140071482291648 estimator.py:1145] Calling model_fn.
W0812 17:21:45.099838 140071482291648 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:21:45.377912 140071482291648 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:21:45.783330 140071482291648 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:21:45.844851 140071482291648 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:21:45.850800 140071482291648 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:21:46.029381 140071482291648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:21:46.042823 140071482291648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:21:46.057723 140071482291648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:21:46.067651 140071482291648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:21:46.073539 140071482291648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:21:46.487171 140071482291648 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:21:46.503249 140071482291648 estimator.py:1147] Done calling model_fn.
I0812 17:21:49.823369 140071482291648 tpu_estimator.py:499] TPU job name worker
I0812 17:21:49.937357 140071482291648 monitored_session.py:240] Graph was finalized.
I0812 17:21:50.497970 140071482291648 session_manager.py:500] Running local_init_op.
I0812 17:21:50.536758 140071482291648 session_manager.py:502] Done running local_init_op.
I0812 17:21:53.045633 140071482291648 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:22:05.274313 140071482291648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:22:05.382298 140071482291648 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:22:05.382756 140071482291648 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:22:05.383153: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:22:05.388315 140071482291648 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:22:05.390830 140071482291648 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:22:05.395428 140071482291648 tpu_estimator.py:557] Init TPU system
I0812 17:22:48.073852 140071482291648 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 17:22:48.074811 140070714320640 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:22:48.075273 140070705927936 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:22:48.126538 140071482291648 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:22:48.127970 140071482291648 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:22:48.137562 140070224918272 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:22:48.254815 140070224918272 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:22:52.575745 140070705927936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:22:57.091250 140071482291648 basic_session_run_hooks.py:262] loss = 0.29225743, step = 30
I0812 17:22:57.093245 140071482291648 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:23:09.832329 140071482291648 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:23:09.832649 140071482291648 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:23:09.833040 140070714320640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:23:09.833386 140070714320640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:23:09.833632 140071482291648 error_handling.py:96] infeed marked as finished
I0812 17:23:09.833888 140071482291648 tpu_estimator.py:602] Stop output thread controller
I0812 17:23:09.833947 140071482291648 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:23:09.834129 140070705927936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:23:09.834372 140070705927936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:23:09.834575 140071482291648 error_handling.py:96] outfeed marked as finished
I0812 17:23:09.834764 140071482291648 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:23:18.384718 140071482291648 estimator.py:368] Loss for final step: 0.29225743.
I0812 17:23:18.385680 140071482291648 error_handling.py:96] training_loop marked as finished
I0812 17:23:19.209358 140071482291648 estimator.py:1145] Calling model_fn.
E0812 17:23:19.932548 140071482291648 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:23:20.162385 140071482291648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:23:20.209011 140071482291648 estimator.py:1147] Done calling model_fn.
I0812 17:23:20.226627 140071482291648 evaluation.py:255] Starting evaluation at 2019-08-12T17:23:20Z
I0812 17:23:20.226878 140071482291648 tpu_estimator.py:499] TPU job name worker
I0812 17:23:20.305825 140071482291648 monitored_session.py:240] Graph was finalized.
W0812 17:23:20.306586 140071482291648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:23:20.493796 140071482291648 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:23:23.124636 140071482291648 session_manager.py:500] Running local_init_op.
I0812 17:23:23.147496 140071482291648 session_manager.py:502] Done running local_init_op.
I0812 17:23:23.198966 140071482291648 tpu_estimator.py:557] Init TPU system
I0812 17:24:32.000741 140071482291648 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:24:32.001854 140070714320640 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:24:32.002913 140070705927936 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:24:32.067312 140071482291648 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:24:32.094681 140071482291648 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:24:32.095042 140071482291648 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:24:32.129559 140070224918272 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:24:32.415978 140070224918272 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:24:32.839508 140070705927936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:24:33.177191 140071482291648 evaluation.py:167] Evaluation [10/10]
I0812 17:24:33.177558 140071482291648 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:24:33.177655 140071482291648 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:24:33.178069 140070714320640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:24:33.178391 140070714320640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:24:33.178613 140071482291648 error_handling.py:96] infeed marked as finished
I0812 17:24:33.178869 140071482291648 tpu_estimator.py:602] Stop output thread controller
I0812 17:24:33.178936 140071482291648 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:24:33.179217 140070705927936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:24:33.179383 140070705927936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:24:33.179677 140071482291648 error_handling.py:96] outfeed marked as finished
I0812 17:24:33.179919 140071482291648 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:25:02.509300 140071482291648 evaluation.py:275] Finished evaluation at 2019-08-12-17:25:02
I0812 17:25:02.509660 140071482291648 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9306, global_step = 30, loss = 0.28722322
I0812 17:25:07.167160 140071482291648 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:25:08.009160 140071482291648 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.28722322, 'global_step': 30, 'accuracy': 0.9306}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565630520284365...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565630524760899...
Removing gs://yangyou-mnist/log/#1565630508000178...
Removing gs://yangyou-mnist/log/checkpoint#1565630586509520...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565630508.v3-8-tpu#1565630589529386...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565630512516311...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565630583469913...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565630584334804...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565630519356880...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565630588641689...
Removing gs://yangyou-mnist/log/eval/#1565630704207394...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565630704.v3-8-tpu#1565630707705273...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:25:11.857184 140337746949568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:25:11.858000 140337746949568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:25:11.860703 140337746949568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:25:11.861562 140337746949568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:25:11.862212 140337746949568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:25:11.862365 140337746949568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:25:12.298051 140337746949568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:25:12.305316 140337746949568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:25:12.309086 140337746949568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:25:12.361390 140337746949568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:25:12.361697 140337746949568 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:25:12.456613 140337746949568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:25:12.496038 140337746949568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:25:12.496345 140337746949568 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:25:12.799420 140337746949568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa2c7b7a1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa2c9d57210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:25:12.799817 140337746949568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:25:13.135870 140337746949568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:25:13.139512: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:25:13.151628 140337746949568 tpu_system_metadata.py:148] Found TPU system:
I0812 17:25:13.151983 140337746949568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:25:13.152631 140337746949568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:25:13.152709 140337746949568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:25:13.152779 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:25:13.153153 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:25:13.153227 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:25:13.153292 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:25:13.153364 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:25:13.153428 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:25:13.153485 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:25:13.153538 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:25:13.153592 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:25:13.153644 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:25:13.153697 140337746949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:25:13.160700 140337746949568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:25:13.175077 140337746949568 estimator.py:1145] Calling model_fn.
W0812 17:25:13.175761 140337746949568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:25:13.451244 140337746949568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:25:13.887797 140337746949568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:25:13.948900 140337746949568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:25:13.954744 140337746949568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:25:14.132950 140337746949568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:25:14.147095 140337746949568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:25:14.162681 140337746949568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:25:14.172928 140337746949568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:25:14.179001 140337746949568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:25:14.609564 140337746949568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:25:14.627865 140337746949568 estimator.py:1147] Done calling model_fn.
I0812 17:25:17.952693 140337746949568 tpu_estimator.py:499] TPU job name worker
I0812 17:25:18.073538 140337746949568 monitored_session.py:240] Graph was finalized.
I0812 17:25:18.670658 140337746949568 session_manager.py:500] Running local_init_op.
I0812 17:25:18.709183 140337746949568 session_manager.py:502] Done running local_init_op.
I0812 17:25:21.266427 140337746949568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:25:34.135665 140337746949568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:25:34.250067 140337746949568 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:25:34.250555 140337746949568 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:25:34.250967: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:25:34.256499 140337746949568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:25:34.259067 140337746949568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:25:34.263130 140337746949568 tpu_estimator.py:557] Init TPU system
I0812 17:26:16.044317 140337746949568 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 17:26:16.045293 140336982652672 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:26:16.045875 140336974259968 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:26:16.089693 140337746949568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:26:16.090642 140337746949568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:26:16.103789 140336965867264 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:26:16.228195 140336965867264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:26:20.630728 140336974259968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:26:25.026851 140337746949568 basic_session_run_hooks.py:262] loss = 0.23966904, step = 30
I0812 17:26:25.029205 140337746949568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:26:38.376888 140337746949568 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:26:38.377187 140337746949568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:26:38.377419 140336982652672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:26:38.377531 140336982652672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:26:38.377681 140337746949568 error_handling.py:96] infeed marked as finished
I0812 17:26:38.377785 140337746949568 tpu_estimator.py:602] Stop output thread controller
I0812 17:26:38.377850 140337746949568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:26:38.377969 140336974259968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:26:38.378043 140336974259968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:26:38.378201 140337746949568 error_handling.py:96] outfeed marked as finished
I0812 17:26:38.378288 140337746949568 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:26:46.363377 140337746949568 estimator.py:368] Loss for final step: 0.23966904.
I0812 17:26:46.364269 140337746949568 error_handling.py:96] training_loop marked as finished
I0812 17:26:47.208156 140337746949568 estimator.py:1145] Calling model_fn.
E0812 17:26:47.896205 140337746949568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:26:48.120383 140337746949568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:26:48.143661 140337746949568 estimator.py:1147] Done calling model_fn.
I0812 17:26:48.162010 140337746949568 evaluation.py:255] Starting evaluation at 2019-08-12T17:26:48Z
I0812 17:26:48.162295 140337746949568 tpu_estimator.py:499] TPU job name worker
I0812 17:26:48.249912 140337746949568 monitored_session.py:240] Graph was finalized.
W0812 17:26:48.250725 140337746949568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:26:48.428227 140337746949568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:26:51.186712 140337746949568 session_manager.py:500] Running local_init_op.
I0812 17:26:51.211019 140337746949568 session_manager.py:502] Done running local_init_op.
I0812 17:26:51.257764 140337746949568 tpu_estimator.py:557] Init TPU system
I0812 17:28:00.068701 140337746949568 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:28:00.069927 140336982652672 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:28:00.070481 140336974259968 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:28:00.137949 140337746949568 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:28:00.161317 140337746949568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:28:00.161725 140337746949568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:28:00.237143 140336965867264 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:28:00.486350 140336965867264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:28:00.906445 140336974259968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:28:01.139369 140337746949568 evaluation.py:167] Evaluation [10/10]
I0812 17:28:01.139727 140337746949568 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:28:01.139795 140337746949568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:28:01.140163 140336982652672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:28:01.140445 140336982652672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:28:01.140710 140337746949568 error_handling.py:96] infeed marked as finished
I0812 17:28:01.140971 140337746949568 tpu_estimator.py:602] Stop output thread controller
I0812 17:28:01.141035 140337746949568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:28:01.141237 140336974259968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:28:01.141419 140336974259968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:28:01.141635 140337746949568 error_handling.py:96] outfeed marked as finished
I0812 17:28:01.141817 140337746949568 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:28:30.581734 140337746949568 evaluation.py:275] Finished evaluation at 2019-08-12-17:28:30
I0812 17:28:30.582068 140337746949568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9369, global_step = 30, loss = 0.24527633
I0812 17:28:34.960334 140337746949568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:28:35.705423 140337746949568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.24527633, 'global_step': 30, 'accuracy': 0.9369}

Removing gs://yangyou-mnist/log/#1565630716188084...
Removing gs://yangyou-mnist/log/checkpoint#1565630794769938...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565630716.v3-8-tpu#1565630798058923...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565630733552769...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565630729082227...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565630728240206...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565630720684392...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565630791592527...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565630792502178...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565630797078091...
Removing gs://yangyou-mnist/log/eval/#1565630912252264...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565630912.v3-8-tpu#1565630915410827...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:28:39.474014 140542592558528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:28:39.474872 140542592558528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:28:39.477519 140542592558528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:28:39.478493 140542592558528 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:28:39.479114 140542592558528 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:28:39.479245 140542592558528 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:28:39.892841 140542592558528 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:28:39.899760 140542592558528 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:28:39.903961 140542592558528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:28:39.948091 140542592558528 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:28:39.948369 140542592558528 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:28:40.073589 140542592558528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:28:40.122653 140542592558528 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:28:40.122931 140542592558528 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:28:40.248950 140542592558528 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd279779210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd27b956210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:28:40.249299 140542592558528 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:28:40.590744 140542592558528 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:28:40.593761: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:28:40.606997 140542592558528 tpu_system_metadata.py:148] Found TPU system:
I0812 17:28:40.607274 140542592558528 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:28:40.607803 140542592558528 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:28:40.607867 140542592558528 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:28:40.607933 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:28:40.608267 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:28:40.608333 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:28:40.608390 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:28:40.608447 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:28:40.608503 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:28:40.608659 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:28:40.608716 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:28:40.608772 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:28:40.608824 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:28:40.608882 140542592558528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:28:40.615658 140542592558528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:28:40.629616 140542592558528 estimator.py:1145] Calling model_fn.
W0812 17:28:40.630358 140542592558528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:28:40.934393 140542592558528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:28:41.432833 140542592558528 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:28:41.495311 140542592558528 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:28:41.501226 140542592558528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:28:41.680769 140542592558528 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:28:41.694468 140542592558528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:28:41.709598 140542592558528 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:28:41.719758 140542592558528 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:28:41.725825 140542592558528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:28:42.142388 140542592558528 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:28:42.158205 140542592558528 estimator.py:1147] Done calling model_fn.
I0812 17:28:45.384362 140542592558528 tpu_estimator.py:499] TPU job name worker
I0812 17:28:45.501964 140542592558528 monitored_session.py:240] Graph was finalized.
I0812 17:28:46.049233 140542592558528 session_manager.py:500] Running local_init_op.
I0812 17:28:46.079253 140542592558528 session_manager.py:502] Done running local_init_op.
I0812 17:28:48.830593 140542592558528 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:29:03.240096 140542592558528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:29:03.346848 140542592558528 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:29:03.347315 140542592558528 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:29:03.347706: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:29:03.351972 140542592558528 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:29:03.354402 140542592558528 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:29:03.357939 140542592558528 tpu_estimator.py:557] Init TPU system
I0812 17:29:44.038281 140542592558528 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0812 17:29:44.039341 140541698754304 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:29:44.039910 140541690361600 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:29:44.084057 140542592558528 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:29:44.085367 140542592558528 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:29:44.135257 140541681968896 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:29:44.292980 140541681968896 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:29:48.612204 140541690361600 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:29:53.154412 140542592558528 basic_session_run_hooks.py:262] loss = 0.23466532, step = 30
I0812 17:29:53.156986 140542592558528 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:30:06.686033 140542592558528 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:30:06.686445 140542592558528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:30:06.686675 140541698754304 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:30:06.686794 140541698754304 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:30:06.686942 140542592558528 error_handling.py:96] infeed marked as finished
I0812 17:30:06.687041 140542592558528 tpu_estimator.py:602] Stop output thread controller
I0812 17:30:06.687092 140542592558528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:30:06.687226 140541690361600 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:30:06.687299 140541690361600 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:30:06.687422 140542592558528 error_handling.py:96] outfeed marked as finished
I0812 17:30:06.687505 140542592558528 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:30:14.426007 140542592558528 estimator.py:368] Loss for final step: 0.23466532.
I0812 17:30:14.426918 140542592558528 error_handling.py:96] training_loop marked as finished
I0812 17:30:15.274445 140542592558528 estimator.py:1145] Calling model_fn.
E0812 17:30:16.056191 140542592558528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:30:16.287092 140542592558528 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:30:16.310301 140542592558528 estimator.py:1147] Done calling model_fn.
I0812 17:30:16.327348 140542592558528 evaluation.py:255] Starting evaluation at 2019-08-12T17:30:16Z
I0812 17:30:16.327593 140542592558528 tpu_estimator.py:499] TPU job name worker
I0812 17:30:16.405586 140542592558528 monitored_session.py:240] Graph was finalized.
W0812 17:30:16.406403 140542592558528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:30:16.683727 140542592558528 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:30:19.599467 140542592558528 session_manager.py:500] Running local_init_op.
I0812 17:30:19.628328 140542592558528 session_manager.py:502] Done running local_init_op.
I0812 17:30:19.678577 140542592558528 tpu_estimator.py:557] Init TPU system
I0812 17:31:28.077214 140542592558528 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:31:28.078344 140541686691584 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:31:28.079173 140541673314048 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:31:28.148133 140542592558528 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:31:28.173120 140542592558528 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:31:28.173541 140542592558528 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:31:28.254045 140541329143552 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:31:28.381730 140541329143552 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:31:28.919893 140541673314048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:31:29.232289 140542592558528 evaluation.py:167] Evaluation [10/10]
I0812 17:31:29.232682 140542592558528 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:31:29.232773 140542592558528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:31:29.232954 140541686691584 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:31:29.233046 140541686691584 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:31:29.233186 140542592558528 error_handling.py:96] infeed marked as finished
I0812 17:31:29.233275 140542592558528 tpu_estimator.py:602] Stop output thread controller
I0812 17:31:29.233325 140542592558528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:31:29.233453 140541673314048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:31:29.233526 140541673314048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:31:29.233649 140542592558528 error_handling.py:96] outfeed marked as finished
I0812 17:31:29.233728 140542592558528 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:31:58.458228 140542592558528 evaluation.py:275] Finished evaluation at 2019-08-12-17:31:58
I0812 17:31:58.458625 140542592558528 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9417, global_step = 30, loss = 0.21310511
I0812 17:32:03.143280 140542592558528 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:32:03.998969 140542592558528 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.21310511, 'global_step': 30, 'accuracy': 0.9417}

Removing gs://yangyou-mnist/log/#1565630923638057...
Removing gs://yangyou-mnist/log/checkpoint#1565631003278054...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565630928339671...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565630923.v3-8-tpu#1565631006392484...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565630937386473...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565630938271248...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565631000217156...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565631001057133...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565630942760154...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565631005407418...
Removing gs://yangyou-mnist/log/eval/#1565631120449390...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565631120.v3-8-tpu#1565631123660871...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:32:07.899172 140088145536448 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:32:07.899966 140088145536448 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:32:07.902767 140088145536448 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:32:07.903625 140088145536448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:32:07.904270 140088145536448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:32:07.904407 140088145536448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:32:08.326211 140088145536448 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:32:08.334656 140088145536448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:32:08.339108 140088145536448 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:32:08.390388 140088145536448 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:32:08.390697 140088145536448 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:32:08.506416 140088145536448 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:32:08.600004 140088145536448 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:32:08.600302 140088145536448 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:32:08.735332 140088145536448 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f68aa505190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f68ac6e2210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:32:08.735682 140088145536448 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:32:09.058054 140088145536448 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:32:09.061345: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:32:09.073635 140088145536448 tpu_system_metadata.py:148] Found TPU system:
I0812 17:32:09.073887 140088145536448 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:32:09.074496 140088145536448 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:32:09.074565 140088145536448 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:32:09.074625 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:32:09.074953 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:32:09.075040 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:32:09.075098 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:32:09.075151 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:32:09.075203 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:32:09.075257 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:32:09.075309 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:32:09.075378 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:32:09.075431 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:32:09.075485 140088145536448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:32:09.082103 140088145536448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:32:09.096090 140088145536448 estimator.py:1145] Calling model_fn.
W0812 17:32:09.096808 140088145536448 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:32:09.364234 140088145536448 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:32:09.883352 140088145536448 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:32:09.943911 140088145536448 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:32:09.949893 140088145536448 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:32:10.132499 140088145536448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:32:10.145917 140088145536448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:32:10.160826 140088145536448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:32:10.170813 140088145536448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:32:10.176801 140088145536448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:32:10.600845 140088145536448 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:32:10.616197 140088145536448 estimator.py:1147] Done calling model_fn.
I0812 17:32:14.079088 140088145536448 tpu_estimator.py:499] TPU job name worker
I0812 17:32:14.194431 140088145536448 monitored_session.py:240] Graph was finalized.
I0812 17:32:14.795361 140088145536448 session_manager.py:500] Running local_init_op.
I0812 17:32:14.825752 140088145536448 session_manager.py:502] Done running local_init_op.
I0812 17:32:17.439153 140088145536448 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:32:29.992660 140088145536448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:32:30.097121 140088145536448 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:32:30.097605 140088145536448 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:32:30.097993: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:32:30.103001 140088145536448 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:32:30.105360 140088145536448 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:32:30.109006 140088145536448 tpu_estimator.py:557] Init TPU system
I0812 17:33:12.056137 140088145536448 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 17:33:12.057167 140087251687168 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:33:12.057681 140087243294464 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:33:12.100557 140088145536448 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:33:12.101573 140088145536448 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:33:12.119401 140087234901760 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:33:12.238995 140087234901760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 17:33:16.561373 140087243294464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:33:20.842685 140088145536448 basic_session_run_hooks.py:262] loss = 0.24038719, step = 30
I0812 17:33:20.845081 140088145536448 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:33:34.454437 140088145536448 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:33:34.454770 140088145536448 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:33:34.456273 140087251687168 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:33:34.456509 140087251687168 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:33:34.456676 140088145536448 error_handling.py:96] infeed marked as finished
I0812 17:33:34.456872 140088145536448 tpu_estimator.py:602] Stop output thread controller
I0812 17:33:34.457005 140088145536448 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:33:34.457139 140087243294464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:33:34.457218 140087243294464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:33:34.457334 140088145536448 error_handling.py:96] outfeed marked as finished
I0812 17:33:34.457415 140088145536448 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:33:42.344893 140088145536448 estimator.py:368] Loss for final step: 0.24038719.
I0812 17:33:42.345711 140088145536448 error_handling.py:96] training_loop marked as finished
I0812 17:33:43.140736 140088145536448 estimator.py:1145] Calling model_fn.
E0812 17:33:43.832573 140088145536448 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:33:44.057590 140088145536448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:33:44.081080 140088145536448 estimator.py:1147] Done calling model_fn.
I0812 17:33:44.098371 140088145536448 evaluation.py:255] Starting evaluation at 2019-08-12T17:33:44Z
I0812 17:33:44.098618 140088145536448 tpu_estimator.py:499] TPU job name worker
I0812 17:33:44.182533 140088145536448 monitored_session.py:240] Graph was finalized.
W0812 17:33:44.183341 140088145536448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:33:44.379544 140088145536448 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:33:46.946644 140088145536448 session_manager.py:500] Running local_init_op.
I0812 17:33:46.970365 140088145536448 session_manager.py:502] Done running local_init_op.
I0812 17:33:47.015136 140088145536448 tpu_estimator.py:557] Init TPU system
I0812 17:34:56.065644 140088145536448 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 17:34:56.066859 140087239624448 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:34:56.067728 140087226246912 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:34:56.130759 140088145536448 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:34:56.160752 140088145536448 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:34:56.161200 140088145536448 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:34:56.193202 140087217854208 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:34:56.312889 140087217854208 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:34:56.916435 140087226246912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:34:57.155141 140088145536448 evaluation.py:167] Evaluation [10/10]
I0812 17:34:57.155515 140088145536448 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:34:57.155596 140088145536448 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:34:57.155890 140087239624448 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:34:57.156163 140087239624448 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:34:57.156423 140088145536448 error_handling.py:96] infeed marked as finished
I0812 17:34:57.156610 140088145536448 tpu_estimator.py:602] Stop output thread controller
I0812 17:34:57.156673 140088145536448 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:34:57.156951 140087226246912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:34:57.157140 140087226246912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:34:57.157433 140088145536448 error_handling.py:96] outfeed marked as finished
I0812 17:34:57.157581 140088145536448 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:35:26.412014 140088145536448 evaluation.py:275] Finished evaluation at 2019-08-12-17:35:26
I0812 17:35:26.412370 140088145536448 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9382, global_step = 30, loss = 0.2276233
I0812 17:35:30.724443 140088145536448 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:35:31.670507 140088145536448 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.2276233, 'global_step': 30, 'accuracy': 0.9382}

Removing gs://yangyou-mnist/log/#1565631132166891...
Removing gs://yangyou-mnist/log/checkpoint#1565631210873176...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565631136899573...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565631132.v3-8-tpu#1565631214143619...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565631144832254...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565631208509049...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565631149509920...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565631143879904...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565631207689941...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565631213151362...
Removing gs://yangyou-mnist/log/eval/#1565631328112191...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565631328.v3-8-tpu#1565631331340267...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:35:35.527410 140333457425856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:35:35.528244 140333457425856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:35:35.530890 140333457425856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:35:35.531785 140333457425856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:35:35.532413 140333457425856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:35:35.532538 140333457425856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:35:35.950629 140333457425856 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:35:35.957926 140333457425856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:35:35.962100 140333457425856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:35:36.016519 140333457425856 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:35:36.016871 140333457425856 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:35:36.123317 140333457425856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:35:36.170557 140333457425856 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:35:36.170855 140333457425856 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:35:36.409389 140333457425856 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa1c8094610>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa1ca288210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:35:36.409729 140333457425856 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:35:36.732217 140333457425856 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:35:36.735354: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:35:36.748831 140333457425856 tpu_system_metadata.py:148] Found TPU system:
I0812 17:35:36.749085 140333457425856 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:35:36.749604 140333457425856 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:35:36.749674 140333457425856 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:35:36.749735 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:35:36.750072 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:35:36.750138 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:35:36.750278 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:35:36.750341 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:35:36.750396 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:35:36.750452 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:35:36.750507 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:35:36.750565 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:35:36.750617 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:35:36.750673 140333457425856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:35:36.757663 140333457425856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:35:36.771414 140333457425856 estimator.py:1145] Calling model_fn.
W0812 17:35:36.772078 140333457425856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:35:37.035212 140333457425856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:35:37.539067 140333457425856 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:35:37.602242 140333457425856 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:35:37.608313 140333457425856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:35:37.791342 140333457425856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:35:37.805272 140333457425856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:35:37.820967 140333457425856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:35:37.831233 140333457425856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:35:37.837330 140333457425856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:35:38.275965 140333457425856 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:35:38.292052 140333457425856 estimator.py:1147] Done calling model_fn.
I0812 17:35:41.611306 140333457425856 tpu_estimator.py:499] TPU job name worker
I0812 17:35:41.728585 140333457425856 monitored_session.py:240] Graph was finalized.
I0812 17:35:42.312495 140333457425856 session_manager.py:500] Running local_init_op.
I0812 17:35:42.343429 140333457425856 session_manager.py:502] Done running local_init_op.
I0812 17:35:44.890769 140333457425856 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:35:56.623999 140333457425856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:35:56.729564 140333457425856 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:35:56.730117 140333457425856 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:35:56.730516: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:35:56.735908 140333457425856 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:35:56.738208 140333457425856 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:35:56.742975 140333457425856 tpu_estimator.py:557] Init TPU system
I0812 17:36:39.974189 140333457425856 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 17:36:39.975104 140332765013760 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:36:39.975573 140332285032192 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:36:40.018490 140333457425856 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:36:40.019360 140333457425856 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:36:40.033258 140332276639488 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:36:40.155059 140332276639488 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:36:44.346832 140332285032192 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:36:48.751337 140333457425856 basic_session_run_hooks.py:262] loss = 0.17352019, step = 30
I0812 17:36:48.753990 140333457425856 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:37:02.984224 140333457425856 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:37:02.984558 140333457425856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:37:02.986043 140332765013760 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:37:02.986325 140332765013760 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:37:02.986594 140333457425856 error_handling.py:96] infeed marked as finished
I0812 17:37:02.986695 140333457425856 tpu_estimator.py:602] Stop output thread controller
I0812 17:37:02.986748 140333457425856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:37:02.986872 140332285032192 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:37:02.986963 140332285032192 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:37:02.987082 140333457425856 error_handling.py:96] outfeed marked as finished
I0812 17:37:02.987168 140333457425856 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:37:10.288697 140333457425856 estimator.py:368] Loss for final step: 0.17352019.
I0812 17:37:10.289493 140333457425856 error_handling.py:96] training_loop marked as finished
I0812 17:37:11.194768 140333457425856 estimator.py:1145] Calling model_fn.
E0812 17:37:11.887878 140333457425856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:37:12.114967 140333457425856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:37:12.137797 140333457425856 estimator.py:1147] Done calling model_fn.
I0812 17:37:12.156606 140333457425856 evaluation.py:255] Starting evaluation at 2019-08-12T17:37:12Z
I0812 17:37:12.156886 140333457425856 tpu_estimator.py:499] TPU job name worker
I0812 17:37:12.248472 140333457425856 monitored_session.py:240] Graph was finalized.
W0812 17:37:12.249211 140333457425856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:37:12.436525 140333457425856 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:37:15.081716 140333457425856 session_manager.py:500] Running local_init_op.
I0812 17:37:15.110465 140333457425856 session_manager.py:502] Done running local_init_op.
I0812 17:37:15.163203 140333457425856 tpu_estimator.py:557] Init TPU system
I0812 17:38:24.020390 140333457425856 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:38:24.021552 140332285032192 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:38:24.022351 140332276639488 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:38:24.084431 140333457425856 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:38:24.110280 140333457425856 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:38:24.110790 140333457425856 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:38:24.145016 140332268246784 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:38:24.287597 140332268246784 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:38:24.826524 140332276639488 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:38:25.254512 140333457425856 evaluation.py:167] Evaluation [10/10]
I0812 17:38:25.254864 140333457425856 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:38:25.254945 140333457425856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:38:25.255230 140332285032192 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:38:25.255568 140332285032192 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:38:25.255785 140333457425856 error_handling.py:96] infeed marked as finished
I0812 17:38:25.255970 140333457425856 tpu_estimator.py:602] Stop output thread controller
I0812 17:38:25.256025 140333457425856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:38:25.256221 140332276639488 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:38:25.256411 140332276639488 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:38:25.256596 140333457425856 error_handling.py:96] outfeed marked as finished
I0812 17:38:25.256774 140333457425856 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:38:54.386084 140333457425856 evaluation.py:275] Finished evaluation at 2019-08-12-17:38:54
I0812 17:38:54.386502 140333457425856 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9575, global_step = 30, loss = 0.15721811
I0812 17:38:58.874006 140333457425856 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:38:59.678256 140333457425856 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.15721811, 'global_step': 30, 'accuracy': 0.9575}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565631351808891...
Removing gs://yangyou-mnist/log/#1565631339802478...
Removing gs://yangyou-mnist/log/checkpoint#1565631419267787...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565631356141039...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565631416092262...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565631416958457...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565631344346903...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565631350929537...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565631340.v3-8-tpu#1565631422674710...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565631421658025...
Removing gs://yangyou-mnist/log/eval/#1565631536322920...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565631536.v3-8-tpu#1565631539370539...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:39:03.433098 140248280860096 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:39:03.433852 140248280860096 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:39:03.436460 140248280860096 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:39:03.437289 140248280860096 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:39:03.437839 140248280860096 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:39:03.437964 140248280860096 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:39:03.844152 140248280860096 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:39:03.850756 140248280860096 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:39:03.854724 140248280860096 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:39:03.898962 140248280860096 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:39:03.899245 140248280860096 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:39:04.014880 140248280860096 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:39:04.097868 140248280860096 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:39:04.098171 140248280860096 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:39:04.266515 140248280860096 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8df31f7290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8df53d4210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:39:04.266901 140248280860096 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:39:04.599836 140248280860096 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:39:04.602879: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:39:04.614744 140248280860096 tpu_system_metadata.py:148] Found TPU system:
I0812 17:39:04.614996 140248280860096 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:39:04.615515 140248280860096 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:39:04.615678 140248280860096 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:39:04.615742 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:39:04.616107 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:39:04.616172 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:39:04.616228 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:39:04.616287 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:39:04.616358 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:39:04.616413 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:39:04.616465 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:39:04.616516 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:39:04.616580 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:39:04.616633 140248280860096 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:39:04.623191 140248280860096 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:39:04.637294 140248280860096 estimator.py:1145] Calling model_fn.
W0812 17:39:04.637980 140248280860096 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:39:04.912117 140248280860096 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:39:05.601476 140248280860096 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:39:05.669877 140248280860096 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:39:05.675940 140248280860096 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:39:05.860441 140248280860096 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:39:05.874746 140248280860096 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:39:05.890249 140248280860096 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:39:05.900582 140248280860096 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:39:05.906723 140248280860096 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:39:06.344422 140248280860096 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:39:06.360394 140248280860096 estimator.py:1147] Done calling model_fn.
I0812 17:39:09.829077 140248280860096 tpu_estimator.py:499] TPU job name worker
I0812 17:39:09.946316 140248280860096 monitored_session.py:240] Graph was finalized.
I0812 17:39:10.528865 140248280860096 session_manager.py:500] Running local_init_op.
I0812 17:39:10.560642 140248280860096 session_manager.py:502] Done running local_init_op.
I0812 17:39:13.212939 140248280860096 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:39:25.546586 140248280860096 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:39:25.653265 140248280860096 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:39:25.653738 140248280860096 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:39:25.654178: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:39:25.659215 140248280860096 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:39:25.661575 140248280860096 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:39:25.665935 140248280860096 tpu_estimator.py:557] Init TPU system
I0812 17:40:08.083852 140248280860096 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 17:40:08.084866 140247249708800 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:40:08.085433 140247241316096 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:40:08.130660 140248280860096 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:40:08.131542 140248280860096 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:40:08.145720 140247232923392 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:40:08.301209 140247232923392 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 17:40:12.997103 140247241316096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:40:17.529624 140248280860096 basic_session_run_hooks.py:262] loss = 0.13303041, step = 30
I0812 17:40:17.532390 140248280860096 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:40:30.718692 140248280860096 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:40:30.719016 140248280860096 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:40:30.719388 140247249708800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:40:30.719703 140247249708800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:40:30.719970 140248280860096 error_handling.py:96] infeed marked as finished
I0812 17:40:30.720175 140248280860096 tpu_estimator.py:602] Stop output thread controller
I0812 17:40:30.720227 140248280860096 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:40:30.720422 140247241316096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:40:30.720628 140247241316096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:40:30.720793 140248280860096 error_handling.py:96] outfeed marked as finished
I0812 17:40:30.720977 140248280860096 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:40:38.436877 140248280860096 estimator.py:368] Loss for final step: 0.13303041.
I0812 17:40:38.437680 140248280860096 error_handling.py:96] training_loop marked as finished
I0812 17:40:39.230911 140248280860096 estimator.py:1145] Calling model_fn.
E0812 17:40:39.935089 140248280860096 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:40:40.161976 140248280860096 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:40:40.186186 140248280860096 estimator.py:1147] Done calling model_fn.
I0812 17:40:40.205198 140248280860096 evaluation.py:255] Starting evaluation at 2019-08-12T17:40:40Z
I0812 17:40:40.205475 140248280860096 tpu_estimator.py:499] TPU job name worker
I0812 17:40:40.294524 140248280860096 monitored_session.py:240] Graph was finalized.
W0812 17:40:40.295340 140248280860096 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:40:40.490905 140248280860096 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:40:43.201881 140248280860096 session_manager.py:500] Running local_init_op.
I0812 17:40:43.225703 140248280860096 session_manager.py:502] Done running local_init_op.
I0812 17:40:43.270735 140248280860096 tpu_estimator.py:557] Init TPU system
I0812 17:41:52.030229 140248280860096 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:41:52.031297 140247240529664 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:41:52.032143 140247232136960 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:41:52.098541 140248280860096 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:41:52.126780 140248280860096 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:41:52.127126 140248280860096 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:41:52.160907 140247223744256 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:41:52.504673 140247223744256 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:41:52.884998 140247232136960 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:41:53.194988 140248280860096 evaluation.py:167] Evaluation [10/10]
I0812 17:41:53.195348 140248280860096 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:41:53.195442 140248280860096 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:41:53.195707 140247240529664 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:41:53.195985 140247240529664 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:41:53.196177 140248280860096 error_handling.py:96] infeed marked as finished
I0812 17:41:53.196341 140248280860096 tpu_estimator.py:602] Stop output thread controller
I0812 17:41:53.196404 140248280860096 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:41:53.196559 140247232136960 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:41:53.196701 140247232136960 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:41:53.196890 140248280860096 error_handling.py:96] outfeed marked as finished
I0812 17:41:53.197021 140248280860096 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:42:22.586507 140248280860096 evaluation.py:275] Finished evaluation at 2019-08-12-17:42:22
I0812 17:42:22.586929 140248280860096 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9676, global_step = 30, loss = 0.10625918
I0812 17:42:26.889200 140248280860096 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:42:27.661355 140248280860096 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10625918, 'global_step': 30, 'accuracy': 0.9676}

Removing gs://yangyou-mnist/log/checkpoint#1565631627178272...
Removing gs://yangyou-mnist/log/#1565631547951125...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565631548.v3-8-tpu#1565631630408774...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565631560689369...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565631552678259...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565631624038542...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565631565061161...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565631624922847...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565631559794341...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565631629422963...
Removing gs://yangyou-mnist/log/eval/#1565631744292525...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565631744.v3-8-tpu#1565631747349453...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:42:31.515711 140166773507520 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:42:31.516535 140166773507520 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:42:31.519279 140166773507520 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:42:31.520143 140166773507520 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:42:31.520745 140166773507520 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:42:31.520870 140166773507520 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:42:31.950079 140166773507520 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:42:31.957727 140166773507520 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:42:31.962299 140166773507520 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:42:32.012034 140166773507520 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:42:32.012351 140166773507520 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:42:32.255804 140166773507520 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:42:32.302719 140166773507520 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:42:32.302993 140166773507520 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:42:32.411830 140166773507520 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f7af8e7f290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f7afb05c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:42:32.412276 140166773507520 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:42:32.740518 140166773507520 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:42:32.743605: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:42:32.757322 140166773507520 tpu_system_metadata.py:148] Found TPU system:
I0812 17:42:32.757555 140166773507520 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:42:32.758074 140166773507520 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:42:32.758133 140166773507520 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:42:32.758239 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:42:32.758570 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:42:32.758627 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:42:32.758682 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:42:32.758729 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:42:32.758775 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:42:32.758836 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:42:32.758882 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:42:32.758929 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:42:32.758974 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:42:32.759020 140166773507520 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:42:32.765216 140166773507520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:42:32.777478 140166773507520 estimator.py:1145] Calling model_fn.
W0812 17:42:32.778093 140166773507520 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:42:33.038409 140166773507520 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:42:33.558065 140166773507520 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:42:33.618345 140166773507520 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:42:33.624175 140166773507520 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:42:33.799964 140166773507520 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:42:33.813674 140166773507520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:42:33.828789 140166773507520 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:42:33.838871 140166773507520 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:42:33.844690 140166773507520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:42:34.267906 140166773507520 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:42:34.283196 140166773507520 estimator.py:1147] Done calling model_fn.
I0812 17:42:37.551789 140166773507520 tpu_estimator.py:499] TPU job name worker
I0812 17:42:37.665671 140166773507520 monitored_session.py:240] Graph was finalized.
I0812 17:42:38.214891 140166773507520 session_manager.py:500] Running local_init_op.
I0812 17:42:38.244925 140166773507520 session_manager.py:502] Done running local_init_op.
I0812 17:42:40.932410 140166773507520 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:42:53.394375 140166773507520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:42:53.502123 140166773507520 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:42:53.502671 140166773507520 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:42:53.503097: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:42:53.508308 140166773507520 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:42:53.510700 140166773507520 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:42:53.515213 140166773507520 tpu_estimator.py:557] Init TPU system
I0812 17:43:36.063304 140166773507520 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 17:43:36.064333 140166013888256 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:43:36.064939 140166005495552 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:43:36.109030 140166773507520 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:43:36.109975 140166773507520 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:43:36.122982 140165519505152 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:43:36.286612 140165519505152 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 17:43:40.559731 140166005495552 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:43:44.931755 140166773507520 basic_session_run_hooks.py:262] loss = 0.10506242, step = 30
I0812 17:43:44.934047 140166773507520 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:43:58.409486 140166773507520 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:43:58.409790 140166773507520 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:43:58.410126 140166013888256 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:43:58.410537 140166013888256 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:43:58.410738 140166773507520 error_handling.py:96] infeed marked as finished
I0812 17:43:58.411010 140166773507520 tpu_estimator.py:602] Stop output thread controller
I0812 17:43:58.411073 140166773507520 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:43:58.411319 140166005495552 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:43:58.411525 140166005495552 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:43:58.411700 140166773507520 error_handling.py:96] outfeed marked as finished
I0812 17:43:58.411830 140166773507520 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:44:06.405801 140166773507520 estimator.py:368] Loss for final step: 0.10506242.
I0812 17:44:06.406708 140166773507520 error_handling.py:96] training_loop marked as finished
I0812 17:44:07.116236 140166773507520 estimator.py:1145] Calling model_fn.
E0812 17:44:07.811359 140166773507520 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:44:08.043235 140166773507520 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:44:08.067085 140166773507520 estimator.py:1147] Done calling model_fn.
I0812 17:44:08.085793 140166773507520 evaluation.py:255] Starting evaluation at 2019-08-12T17:44:08Z
I0812 17:44:08.086066 140166773507520 tpu_estimator.py:499] TPU job name worker
I0812 17:44:08.172955 140166773507520 monitored_session.py:240] Graph was finalized.
W0812 17:44:08.173738 140166773507520 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:44:08.365056 140166773507520 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:44:10.918224 140166773507520 session_manager.py:500] Running local_init_op.
I0812 17:44:10.941541 140166773507520 session_manager.py:502] Done running local_init_op.
I0812 17:44:10.987870 140166773507520 tpu_estimator.py:557] Init TPU system
I0812 17:45:20.021219 140166773507520 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 17:45:20.022082 140166010218240 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:45:20.023731 140165519505152 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:45:20.094729 140166773507520 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:45:20.122498 140166773507520 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:45:20.122869 140166773507520 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:45:20.160073 140165511112448 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:45:20.393404 140165511112448 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:45:20.850863 140165519505152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:45:21.336363 140166773507520 evaluation.py:167] Evaluation [10/10]
I0812 17:45:21.336720 140166773507520 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:45:21.336877 140166773507520 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:45:21.337110 140166010218240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:45:21.337209 140166010218240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:45:21.337383 140166773507520 error_handling.py:96] infeed marked as finished
I0812 17:45:21.337482 140166773507520 tpu_estimator.py:602] Stop output thread controller
I0812 17:45:21.337532 140166773507520 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:45:21.337675 140165519505152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:45:21.337753 140165519505152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:45:21.337893 140166773507520 error_handling.py:96] outfeed marked as finished
I0812 17:45:21.337985 140166773507520 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:45:50.485935 140166773507520 evaluation.py:275] Finished evaluation at 2019-08-12-17:45:50
I0812 17:45:50.486323 140166773507520 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9715, global_step = 30, loss = 0.105044916
I0812 17:45:54.831321 140166773507520 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:45:55.629754 140166773507520 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.105044916, 'global_step': 30, 'accuracy': 0.9715}

Removing gs://yangyou-mnist/log/#1565631755757510...
Removing gs://yangyou-mnist/log/checkpoint#1565631834965961...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565631768520770...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565631772914517...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565631767620025...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565631755.v3-8-tpu#1565631838093892...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565631831685109...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565631832942868...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565631760401410...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565631837134344...
Removing gs://yangyou-mnist/log/eval/#1565631952156472...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565631952.v3-8-tpu#1565631955309049...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:45:59.385524 139769692841408 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:45:59.386451 139769692841408 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:45:59.389101 139769692841408 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:45:59.389936 139769692841408 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:45:59.390578 139769692841408 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:45:59.390710 139769692841408 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:45:59.802683 139769692841408 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:45:59.810293 139769692841408 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:45:59.814594 139769692841408 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:45:59.862663 139769692841408 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:45:59.862999 139769692841408 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:45:59.973516 139769692841408 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:46:00.021578 139769692841408 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:46:00.021958 139769692841408 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:46:00.271042 139769692841408 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1e850dd190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1e872ba210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:46:00.271404 139769692841408 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:46:00.594897 139769692841408 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:46:00.597693: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:46:00.609505 139769692841408 tpu_system_metadata.py:148] Found TPU system:
I0812 17:46:00.609814 139769692841408 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:46:00.610430 139769692841408 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:46:00.610491 139769692841408 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:46:00.610544 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:46:00.610863 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:46:00.610919 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:46:00.610971 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:46:00.611020 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:46:00.611069 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:46:00.611118 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:46:00.611180 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:46:00.611227 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:46:00.611274 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:46:00.611324 139769692841408 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:46:00.617371 139769692841408 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:46:00.629863 139769692841408 estimator.py:1145] Calling model_fn.
W0812 17:46:00.630525 139769692841408 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:46:00.903016 139769692841408 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:46:01.394453 139769692841408 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:46:01.455888 139769692841408 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:46:01.462132 139769692841408 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:46:01.640921 139769692841408 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:46:01.654769 139769692841408 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:46:01.669817 139769692841408 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:46:01.679938 139769692841408 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:46:01.685836 139769692841408 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:46:02.117502 139769692841408 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:46:02.133002 139769692841408 estimator.py:1147] Done calling model_fn.
I0812 17:46:05.379987 139769692841408 tpu_estimator.py:499] TPU job name worker
I0812 17:46:05.495142 139769692841408 monitored_session.py:240] Graph was finalized.
I0812 17:46:06.106530 139769692841408 session_manager.py:500] Running local_init_op.
I0812 17:46:06.138173 139769692841408 session_manager.py:502] Done running local_init_op.
I0812 17:46:08.734846 139769692841408 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:46:20.526010 139769692841408 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:46:20.632416 139769692841408 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:46:20.632977 139769692841408 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:46:20.633414: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:46:20.638058 139769692841408 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:46:20.640428 139769692841408 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:46:20.644308 139769692841408 tpu_estimator.py:557] Init TPU system
I0812 17:47:04.044925 139769692841408 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 17:47:04.046097 139768933103360 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:47:04.046859 139768924710656 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:47:04.090856 139769692841408 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:47:04.091959 139769692841408 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:47:04.104219 139768916317952 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:47:04.243321 139768916317952 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:47:08.622071 139768924710656 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:47:13.117305 139769692841408 basic_session_run_hooks.py:262] loss = 0.100608565, step = 30
I0812 17:47:13.120408 139769692841408 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:47:25.774990 139769692841408 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:47:25.775300 139769692841408 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:47:25.775641 139768933103360 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:47:25.775942 139768933103360 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:47:25.776148 139769692841408 error_handling.py:96] infeed marked as finished
I0812 17:47:25.776334 139769692841408 tpu_estimator.py:602] Stop output thread controller
I0812 17:47:25.776397 139769692841408 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:47:25.776595 139768924710656 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:47:25.776796 139768924710656 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:47:25.777010 139769692841408 error_handling.py:96] outfeed marked as finished
I0812 17:47:25.777147 139769692841408 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:47:34.376343 139769692841408 estimator.py:368] Loss for final step: 0.100608565.
I0812 17:47:34.377298 139769692841408 error_handling.py:96] training_loop marked as finished
I0812 17:47:35.096735 139769692841408 estimator.py:1145] Calling model_fn.
E0812 17:47:35.798810 139769692841408 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:47:36.027029 139769692841408 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:47:36.050405 139769692841408 estimator.py:1147] Done calling model_fn.
I0812 17:47:36.069483 139769692841408 evaluation.py:255] Starting evaluation at 2019-08-12T17:47:36Z
I0812 17:47:36.069745 139769692841408 tpu_estimator.py:499] TPU job name worker
I0812 17:47:36.158767 139769692841408 monitored_session.py:240] Graph was finalized.
W0812 17:47:36.159589 139769692841408 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:47:36.342605 139769692841408 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:47:38.843293 139769692841408 session_manager.py:500] Running local_init_op.
I0812 17:47:38.871984 139769692841408 session_manager.py:502] Done running local_init_op.
I0812 17:47:38.919157 139769692841408 tpu_estimator.py:557] Init TPU system
I0812 17:48:48.037410 139769692841408 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 17:48:48.038391 139768921040640 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:48:48.039290 139768436356864 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:48:48.103437 139769692841408 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:48:48.126811 139769692841408 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:48:48.127233 139769692841408 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:48:48.159455 139768427964160 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:48:48.356246 139768427964160 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:48:48.851636 139768436356864 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:48:49.327745 139769692841408 evaluation.py:167] Evaluation [10/10]
I0812 17:48:49.328082 139769692841408 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:48:49.328171 139769692841408 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:48:49.328378 139768921040640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:48:49.328478 139768921040640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:48:49.328624 139769692841408 error_handling.py:96] infeed marked as finished
I0812 17:48:49.328725 139769692841408 tpu_estimator.py:602] Stop output thread controller
I0812 17:48:49.328783 139769692841408 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:48:49.328902 139768436356864 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:48:49.328979 139768436356864 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:48:49.329097 139769692841408 error_handling.py:96] outfeed marked as finished
I0812 17:48:49.329291 139769692841408 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:49:18.451400 139769692841408 evaluation.py:275] Finished evaluation at 2019-08-12-17:49:18
I0812 17:49:18.451792 139769692841408 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9709, global_step = 30, loss = 0.10215384
I0812 17:49:22.793104 139769692841408 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:49:23.611412 139769692841408 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10215384, 'global_step': 30, 'accuracy': 0.9709}

Removing gs://yangyou-mnist/log/#1565631963590990...
Removing gs://yangyou-mnist/log/checkpoint#1565632042412701...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565631975695405...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565631980037810...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565631963.v3-8-tpu#1565632045471794...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565632040162313...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565631968163708...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565632039368377...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565631974812657...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565632044510672...
Removing gs://yangyou-mnist/log/eval/#1565632160128819...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565632160.v3-8-tpu#1565632163302159...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:49:27.444351 139924141786560 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:49:27.445157 139924141786560 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:49:27.447843 139924141786560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:49:27.448697 139924141786560 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:49:27.449291 139924141786560 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:49:27.449424 139924141786560 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:49:27.873162 139924141786560 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:49:27.881264 139924141786560 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:49:27.885571 139924141786560 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:49:27.933188 139924141786560 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:49:27.933460 139924141786560 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:49:28.132283 139924141786560 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:49:28.180008 139924141786560 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:49:28.180296 139924141786560 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:49:28.285646 139924141786560 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f427aec4450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f427d0b8210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:49:28.285990 139924141786560 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:49:28.606864 139924141786560 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:49:28.609910: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:49:28.622328 139924141786560 tpu_system_metadata.py:148] Found TPU system:
I0812 17:49:28.622596 139924141786560 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:49:28.624279 139924141786560 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:49:28.624401 139924141786560 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:49:28.624464 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:49:28.624969 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:49:28.625046 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:49:28.625108 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:49:28.625163 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:49:28.625216 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:49:28.625271 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:49:28.625324 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:49:28.625385 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:49:28.625443 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:49:28.625504 139924141786560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:49:28.632214 139924141786560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:49:28.646298 139924141786560 estimator.py:1145] Calling model_fn.
W0812 17:49:28.646970 139924141786560 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:49:28.917733 139924141786560 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:49:29.519758 139924141786560 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:49:29.583306 139924141786560 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:49:29.589324 139924141786560 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:49:29.771796 139924141786560 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:49:29.785697 139924141786560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:49:29.801295 139924141786560 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:49:29.811641 139924141786560 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:49:29.817876 139924141786560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:49:30.242913 139924141786560 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:49:30.258797 139924141786560 estimator.py:1147] Done calling model_fn.
I0812 17:49:33.517292 139924141786560 tpu_estimator.py:499] TPU job name worker
I0812 17:49:33.632105 139924141786560 monitored_session.py:240] Graph was finalized.
I0812 17:49:34.217109 139924141786560 session_manager.py:500] Running local_init_op.
I0812 17:49:34.248446 139924141786560 session_manager.py:502] Done running local_init_op.
I0812 17:49:36.815908 139924141786560 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:49:48.914288 139924141786560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:49:49.034189 139924141786560 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:49:49.034638 139924141786560 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:49:49.035131: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:49:49.040179 139924141786560 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:49:49.042783 139924141786560 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:49:49.046888 139924141786560 tpu_estimator.py:557] Init TPU system
I0812 17:50:32.067202 139924141786560 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 17:50:32.068182 139923113633536 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:50:32.068727 139923105240832 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:50:32.114913 139924141786560 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:50:32.115750 139924141786560 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:50:32.176356 139923096848128 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:50:32.311036 139923096848128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:50:36.694473 139923105240832 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:50:41.084505 139924141786560 basic_session_run_hooks.py:262] loss = 0.08802239, step = 30
I0812 17:50:41.087472 139924141786560 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:50:54.348912 139924141786560 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:50:54.349196 139924141786560 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:50:54.349419 139923113633536 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:50:54.349541 139923113633536 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:50:54.349689 139924141786560 error_handling.py:96] infeed marked as finished
I0812 17:50:54.349790 139924141786560 tpu_estimator.py:602] Stop output thread controller
I0812 17:50:54.349837 139924141786560 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:50:54.349950 139923105240832 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:50:54.350022 139923105240832 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:50:54.350188 139924141786560 error_handling.py:96] outfeed marked as finished
I0812 17:50:54.350285 139924141786560 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:51:02.443012 139924141786560 estimator.py:368] Loss for final step: 0.08802239.
I0812 17:51:02.443788 139924141786560 error_handling.py:96] training_loop marked as finished
I0812 17:51:03.184006 139924141786560 estimator.py:1145] Calling model_fn.
E0812 17:51:03.919389 139924141786560 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:51:04.168646 139924141786560 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:51:04.193171 139924141786560 estimator.py:1147] Done calling model_fn.
I0812 17:51:04.211720 139924141786560 evaluation.py:255] Starting evaluation at 2019-08-12T17:51:04Z
I0812 17:51:04.211958 139924141786560 tpu_estimator.py:499] TPU job name worker
I0812 17:51:04.295536 139924141786560 monitored_session.py:240] Graph was finalized.
W0812 17:51:04.296300 139924141786560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:51:04.497852 139924141786560 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:51:06.925673 139924141786560 session_manager.py:500] Running local_init_op.
I0812 17:51:06.949882 139924141786560 session_manager.py:502] Done running local_init_op.
I0812 17:51:06.994179 139924141786560 tpu_estimator.py:557] Init TPU system
I0812 17:52:15.993468 139924141786560 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:52:15.994658 139923101570816 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:52:15.995178 139923088193280 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:52:16.060726 139924141786560 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:52:16.088267 139924141786560 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:52:16.088635 139924141786560 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:52:16.124862 139923079800576 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:52:16.235097 139923079800576 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:52:16.839534 139923088193280 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:52:17.158546 139924141786560 evaluation.py:167] Evaluation [10/10]
I0812 17:52:17.158875 139924141786560 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:52:17.158952 139924141786560 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:52:17.159152 139923101570816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:52:17.159270 139923101570816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:52:17.159504 139924141786560 error_handling.py:96] infeed marked as finished
I0812 17:52:17.159673 139924141786560 tpu_estimator.py:602] Stop output thread controller
I0812 17:52:17.159754 139924141786560 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:52:17.159914 139923088193280 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:52:17.160003 139923088193280 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:52:17.160136 139924141786560 error_handling.py:96] outfeed marked as finished
I0812 17:52:17.160234 139924141786560 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:52:46.328691 139924141786560 evaluation.py:275] Finished evaluation at 2019-08-12-17:52:46
I0812 17:52:46.329029 139924141786560 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9776, global_step = 30, loss = 0.07517529
I0812 17:52:50.857465 139924141786560 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:52:51.659013 139924141786560 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07517529, 'global_step': 30, 'accuracy': 0.9776}

Removing gs://yangyou-mnist/log/#1565632171734319...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565632171.v3-8-tpu#1565632254047631...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565632176280551...
Removing gs://yangyou-mnist/log/checkpoint#1565632251029655...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565632183991078...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565632183101336...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565632188413446...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565632247925618...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565632248811512...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565632253160100...
Removing gs://yangyou-mnist/log/eval/#1565632368005348...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565632368.v3-8-tpu#1565632371348798...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:52:55.437485 140245683475904 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:52:55.438283 140245683475904 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:52:55.440860 140245683475904 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:52:55.441680 140245683475904 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:52:55.442646 140245683475904 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:52:55.443059 140245683475904 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:52:55.873334 140245683475904 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:52:55.880103 140245683475904 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:52:55.884161 140245683475904 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:52:55.980494 140245683475904 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:52:55.980770 140245683475904 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:52:56.129621 140245683475904 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:52:56.174520 140245683475904 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:52:56.174813 140245683475904 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:52:56.328557 140245683475904 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8d584e8150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8d5a6c5210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:52:56.328917 140245683475904 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:52:56.655448 140245683475904 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:52:56.658686: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:52:56.674659 140245683475904 tpu_system_metadata.py:148] Found TPU system:
I0812 17:52:56.674915 140245683475904 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:52:56.675448 140245683475904 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:52:56.675518 140245683475904 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:52:56.675585 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:52:56.675903 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:52:56.675966 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:52:56.676031 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:52:56.676088 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:52:56.676141 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:52:56.676194 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:52:56.676246 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:52:56.676297 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:52:56.676351 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:52:56.676424 140245683475904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:52:56.683370 140245683475904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:52:56.697504 140245683475904 estimator.py:1145] Calling model_fn.
W0812 17:52:56.698240 140245683475904 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:52:56.971596 140245683475904 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:52:57.577960 140245683475904 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:52:57.639507 140245683475904 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:52:57.645349 140245683475904 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:52:57.825040 140245683475904 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:52:57.838826 140245683475904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:52:57.854121 140245683475904 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:52:57.864337 140245683475904 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:52:57.870399 140245683475904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:52:58.305488 140245683475904 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:52:58.321566 140245683475904 estimator.py:1147] Done calling model_fn.
I0812 17:53:01.543528 140245683475904 tpu_estimator.py:499] TPU job name worker
I0812 17:53:01.663050 140245683475904 monitored_session.py:240] Graph was finalized.
I0812 17:53:02.223150 140245683475904 session_manager.py:500] Running local_init_op.
I0812 17:53:02.262933 140245683475904 session_manager.py:502] Done running local_init_op.
I0812 17:53:04.899477 140245683475904 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:53:17.693731 140245683475904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:53:17.814419 140245683475904 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:53:17.814872 140245683475904 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:53:17.815383: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:53:17.820174 140245683475904 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:53:17.822632 140245683475904 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:53:17.827214 140245683475904 tpu_estimator.py:557] Init TPU system
I0812 17:54:00.056037 140245683475904 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 17:54:00.057194 140244506638080 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:54:00.058072 140244498245376 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:54:00.107836 140245683475904 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:54:00.109467 140245683475904 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:54:00.121207 140244489852672 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:54:00.291851 140244489852672 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:54:04.551418 140244498245376 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:54:08.870623 140245683475904 basic_session_run_hooks.py:262] loss = 2.301907, step = 30
I0812 17:54:08.872998 140245683475904 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:54:22.402910 140245683475904 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:54:22.403194 140245683475904 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:54:22.403503 140244506638080 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:54:22.403776 140244506638080 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:54:22.403974 140245683475904 error_handling.py:96] infeed marked as finished
I0812 17:54:22.404141 140245683475904 tpu_estimator.py:602] Stop output thread controller
I0812 17:54:22.404194 140245683475904 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:54:22.404413 140244498245376 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:54:22.404608 140244498245376 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:54:22.404870 140245683475904 error_handling.py:96] outfeed marked as finished
I0812 17:54:22.405042 140245683475904 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:54:30.427445 140245683475904 estimator.py:368] Loss for final step: 2.301907.
I0812 17:54:30.428406 140245683475904 error_handling.py:96] training_loop marked as finished
I0812 17:54:31.345581 140245683475904 estimator.py:1145] Calling model_fn.
E0812 17:54:32.082057 140245683475904 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:54:32.305562 140245683475904 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:54:32.332617 140245683475904 estimator.py:1147] Done calling model_fn.
I0812 17:54:32.349025 140245683475904 evaluation.py:255] Starting evaluation at 2019-08-12T17:54:32Z
I0812 17:54:32.349265 140245683475904 tpu_estimator.py:499] TPU job name worker
I0812 17:54:32.427654 140245683475904 monitored_session.py:240] Graph was finalized.
W0812 17:54:32.428381 140245683475904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:54:32.617810 140245683475904 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:54:35.172657 140245683475904 session_manager.py:500] Running local_init_op.
I0812 17:54:35.195390 140245683475904 session_manager.py:502] Done running local_init_op.
I0812 17:54:35.246296 140245683475904 tpu_estimator.py:557] Init TPU system
I0812 17:55:43.992691 140245683475904 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:55:43.993827 140244506638080 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:55:43.994822 140244498245376 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:55:44.058959 140245683475904 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:55:44.085093 140245683475904 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:55:44.085484 140245683475904 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:55:44.119968 140244489852672 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:55:44.346739 140244489852672 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:55:44.845304 140244498245376 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:55:45.120238 140245683475904 evaluation.py:167] Evaluation [10/10]
I0812 17:55:45.120569 140245683475904 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:55:45.120645 140245683475904 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:55:45.124697 140244506638080 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:55:45.125035 140244506638080 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:55:45.131921 140245683475904 error_handling.py:96] infeed marked as finished
I0812 17:55:45.132225 140245683475904 tpu_estimator.py:602] Stop output thread controller
I0812 17:55:45.132297 140245683475904 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:55:45.132453 140244498245376 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:55:45.132529 140244498245376 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:55:45.133124 140245683475904 error_handling.py:96] outfeed marked as finished
I0812 17:55:45.133207 140245683475904 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:56:14.441342 140245683475904 evaluation.py:275] Finished evaluation at 2019-08-12-17:56:14
I0812 17:56:14.441679 140245683475904 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2990003
I0812 17:56:19.044981 140245683475904 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:56:19.836940 140245683475904 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2990003, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565632392958999...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565632397213055...
Removing gs://yangyou-mnist/log/checkpoint#1565632458991067...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565632455763922...
Removing gs://yangyou-mnist/log/#1565632379793467...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565632379.v3-8-tpu#1565632462091695...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565632384369436...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565632456700337...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565632392091591...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565632461136849...
Removing gs://yangyou-mnist/log/eval/#1565632576220911...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565632576.v3-8-tpu#1565632579530254...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:56:23.746356 140446856574400 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:56:23.747113 140446856574400 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:56:23.749665 140446856574400 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:56:23.750633 140446856574400 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:56:23.751224 140446856574400 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:56:23.751353 140446856574400 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:56:24.161427 140446856574400 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:56:24.168335 140446856574400 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:56:24.171955 140446856574400 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:56:24.221299 140446856574400 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:56:24.221581 140446856574400 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:56:24.386420 140446856574400 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:56:24.433666 140446856574400 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:56:24.433959 140446856574400 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:56:24.557061 140446856574400 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fbc2f2861d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fbc31463210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:56:24.557425 140446856574400 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:56:24.878241 140446856574400 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:56:24.881139: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:56:24.898195 140446856574400 tpu_system_metadata.py:148] Found TPU system:
I0812 17:56:24.898435 140446856574400 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:56:24.898931 140446856574400 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:56:24.898988 140446856574400 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:56:24.899041 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:56:24.899316 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:56:24.899373 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:56:24.899424 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:56:24.899471 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:56:24.899518 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:56:24.899574 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:56:24.899621 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:56:24.899667 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:56:24.899713 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:56:24.899760 140446856574400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:56:24.905783 140446856574400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:56:24.918308 140446856574400 estimator.py:1145] Calling model_fn.
W0812 17:56:24.918940 140446856574400 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:56:25.206048 140446856574400 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:56:25.645055 140446856574400 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:56:25.705698 140446856574400 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:56:25.711906 140446856574400 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:56:25.887074 140446856574400 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:56:25.900263 140446856574400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:56:25.914799 140446856574400 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:56:25.924873 140446856574400 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:56:25.930701 140446856574400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:56:26.343425 140446856574400 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:56:26.359122 140446856574400 estimator.py:1147] Done calling model_fn.
I0812 17:56:29.675751 140446856574400 tpu_estimator.py:499] TPU job name worker
I0812 17:56:29.787103 140446856574400 monitored_session.py:240] Graph was finalized.
I0812 17:56:30.343503 140446856574400 session_manager.py:500] Running local_init_op.
I0812 17:56:30.373820 140446856574400 session_manager.py:502] Done running local_init_op.
I0812 17:56:32.873366 140446856574400 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 17:56:44.727830 140446856574400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 17:56:44.846715 140446856574400 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:56:44.847177 140446856574400 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 17:56:44.847565: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:56:44.853060 140446856574400 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 17:56:44.855454 140446856574400 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 17:56:44.859540 140446856574400 tpu_estimator.py:557] Init TPU system
I0812 17:57:28.066289 140446856574400 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 17:57:28.067290 140445816444672 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:57:28.067791 140445808051968 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:57:28.114577 140446856574400 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 17:57:28.115493 140446856574400 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 17:57:28.135592 140445799659264 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:57:28.361583 140445799659264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 17:57:32.550448 140445808051968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:57:36.897888 140446856574400 basic_session_run_hooks.py:262] loss = 2.302438, step = 30
I0812 17:57:36.900464 140446856574400 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 17:57:49.668605 140446856574400 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:57:49.668917 140446856574400 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:57:49.669171 140445816444672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:57:49.669321 140445816444672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:57:49.669498 140446856574400 error_handling.py:96] infeed marked as finished
I0812 17:57:49.669609 140446856574400 tpu_estimator.py:602] Stop output thread controller
I0812 17:57:49.669682 140446856574400 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:57:49.669811 140445808051968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:57:49.669893 140445808051968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:57:49.670015 140446856574400 error_handling.py:96] outfeed marked as finished
I0812 17:57:49.670109 140446856574400 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:57:58.485115 140446856574400 estimator.py:368] Loss for final step: 2.302438.
I0812 17:57:58.485876 140446856574400 error_handling.py:96] training_loop marked as finished
I0812 17:57:59.277762 140446856574400 estimator.py:1145] Calling model_fn.
E0812 17:58:00.054373 140446856574400 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:58:00.277159 140446856574400 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 17:58:00.300211 140446856574400 estimator.py:1147] Done calling model_fn.
I0812 17:58:00.316658 140446856574400 evaluation.py:255] Starting evaluation at 2019-08-12T17:58:00Z
I0812 17:58:00.316919 140446856574400 tpu_estimator.py:499] TPU job name worker
I0812 17:58:00.393364 140446856574400 monitored_session.py:240] Graph was finalized.
W0812 17:58:00.394126 140446856574400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 17:58:00.561496 140446856574400 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 17:58:03.397919 140446856574400 session_manager.py:500] Running local_init_op.
I0812 17:58:03.420682 140446856574400 session_manager.py:502] Done running local_init_op.
I0812 17:58:03.472910 140446856574400 tpu_estimator.py:557] Init TPU system
I0812 17:59:11.990174 140446856574400 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 17:59:11.991178 140445816444672 tpu_estimator.py:514] Starting infeed thread controller.
I0812 17:59:11.991646 140445808051968 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 17:59:12.057708 140446856574400 util.py:98] Initialized dataset iterators in 0 seconds
I0812 17:59:12.085705 140446856574400 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 17:59:12.086194 140446856574400 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 17:59:12.109911 140445799659264 transport.py:157] Attempting refresh to obtain initial access_token
W0812 17:59:12.202810 140445799659264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 17:59:12.795154 140445808051968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 17:59:13.315005 140446856574400 evaluation.py:167] Evaluation [10/10]
I0812 17:59:13.315440 140446856574400 tpu_estimator.py:598] Stop infeed thread controller
I0812 17:59:13.315526 140446856574400 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 17:59:13.315777 140445816444672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 17:59:13.316180 140445816444672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 17:59:13.316382 140446856574400 error_handling.py:96] infeed marked as finished
I0812 17:59:13.316581 140446856574400 tpu_estimator.py:602] Stop output thread controller
I0812 17:59:13.316637 140446856574400 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 17:59:13.316926 140445808051968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 17:59:13.317121 140445808051968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 17:59:13.317320 140446856574400 error_handling.py:96] outfeed marked as finished
I0812 17:59:13.317472 140446856574400 tpu_estimator.py:606] Shutdown TPU system.
I0812 17:59:42.296183 140446856574400 evaluation.py:275] Finished evaluation at 2019-08-12-17:59:42
I0812 17:59:42.296556 140446856574400 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 2.3024304
I0812 17:59:46.789081 140446856574400 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 17:59:47.534878 140446856574400 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3024304, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/#1565632587933508...
Removing gs://yangyou-mnist/log/checkpoint#1565632666343006...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565632588.v3-8-tpu#1565632669355625...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565632599959042...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565632592327503...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565632599073575...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565632604238707...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565632663441154...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565632664227149...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565632668456384...
Removing gs://yangyou-mnist/log/eval/#1565632784132477...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565632784.v3-8-tpu#1565632787229182...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 17:59:51.290745 140548852147648 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 17:59:51.291656 140548852147648 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 17:59:51.294424 140548852147648 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 17:59:51.295234 140548852147648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 17:59:51.295829 140548852147648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 17:59:51.295950 140548852147648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 17:59:51.709642 140548852147648 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 17:59:51.716901 140548852147648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 17:59:51.720845 140548852147648 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:59:51.766866 140548852147648 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:59:51.767158 140548852147648 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:59:51.906606 140548852147648 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 17:59:51.947266 140548852147648 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 17:59:51.947552 140548852147648 transport.py:157] Attempting refresh to obtain initial access_token
I0812 17:59:52.077683 140548852147648 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd3ee9151d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd3f0af2210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 17:59:52.078073 140548852147648 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 17:59:52.398133 140548852147648 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 17:59:52.401309: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 17:59:52.414084 140548852147648 tpu_system_metadata.py:148] Found TPU system:
I0812 17:59:52.414390 140548852147648 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 17:59:52.415096 140548852147648 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 17:59:52.415179 140548852147648 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 17:59:52.415240 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 17:59:52.415589 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 17:59:52.415652 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 17:59:52.415710 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 17:59:52.415767 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 17:59:52.415831 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 17:59:52.415884 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 17:59:52.415936 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 17:59:52.415999 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 17:59:52.416052 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 17:59:52.416105 140548852147648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 17:59:52.422725 140548852147648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 17:59:52.437024 140548852147648 estimator.py:1145] Calling model_fn.
W0812 17:59:52.437640 140548852147648 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 17:59:52.702908 140548852147648 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 17:59:53.126436 140548852147648 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 17:59:53.187972 140548852147648 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 17:59:53.193768 140548852147648 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 17:59:53.374994 140548852147648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 17:59:53.388673 140548852147648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 17:59:53.403796 140548852147648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 17:59:53.413929 140548852147648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 17:59:53.419878 140548852147648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 17:59:53.836764 140548852147648 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 17:59:53.854355 140548852147648 estimator.py:1147] Done calling model_fn.
I0812 17:59:57.062055 140548852147648 tpu_estimator.py:499] TPU job name worker
I0812 17:59:57.174612 140548852147648 monitored_session.py:240] Graph was finalized.
I0812 17:59:57.744316 140548852147648 session_manager.py:500] Running local_init_op.
I0812 17:59:57.777127 140548852147648 session_manager.py:502] Done running local_init_op.
I0812 18:00:00.331461 140548852147648 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:00:12.236537 140548852147648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:00:12.343226 140548852147648 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:00:12.343691 140548852147648 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:00:12.344114: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:00:12.349644 140548852147648 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:00:12.352061 140548852147648 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:00:12.356971 140548852147648 tpu_estimator.py:557] Init TPU system
I0812 18:00:56.022316 140548852147648 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 18:00:56.023385 140547947742976 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:00:56.024528 140547939350272 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:00:56.071769 140548852147648 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:00:56.072753 140548852147648 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:00:56.086621 140547930957568 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:00:56.295183 140547930957568 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 18:01:00.557512 140547939350272 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:01:05.054686 140548852147648 basic_session_run_hooks.py:262] loss = 2.3029754, step = 30
I0812 18:01:05.057177 140548852147648 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:01:18.684446 140548852147648 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:01:18.684739 140548852147648 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:01:18.684957 140547947742976 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:01:18.685065 140547947742976 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:01:18.685208 140548852147648 error_handling.py:96] infeed marked as finished
I0812 18:01:18.685306 140548852147648 tpu_estimator.py:602] Stop output thread controller
I0812 18:01:18.685353 140548852147648 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:01:18.685462 140547939350272 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:01:18.685537 140547939350272 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:01:18.685651 140548852147648 error_handling.py:96] outfeed marked as finished
I0812 18:01:18.685731 140548852147648 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:01:26.429028 140548852147648 estimator.py:368] Loss for final step: 2.3029754.
I0812 18:01:26.429953 140548852147648 error_handling.py:96] training_loop marked as finished
I0812 18:01:27.216941 140548852147648 estimator.py:1145] Calling model_fn.
E0812 18:01:27.920010 140548852147648 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:01:28.145714 140548852147648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:01:28.169181 140548852147648 estimator.py:1147] Done calling model_fn.
I0812 18:01:28.185821 140548852147648 evaluation.py:255] Starting evaluation at 2019-08-12T18:01:28Z
I0812 18:01:28.186077 140548852147648 tpu_estimator.py:499] TPU job name worker
I0812 18:01:28.262283 140548852147648 monitored_session.py:240] Graph was finalized.
W0812 18:01:28.263052 140548852147648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:01:28.454091 140548852147648 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:01:31.068749 140548852147648 session_manager.py:500] Running local_init_op.
I0812 18:01:31.093812 140548852147648 session_manager.py:502] Done running local_init_op.
I0812 18:01:31.148456 140548852147648 tpu_estimator.py:557] Init TPU system
I0812 18:02:39.976721 140548852147648 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:02:39.977751 140547947742976 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:02:39.978477 140547939350272 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:02:40.075711 140548852147648 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:02:40.101308 140548852147648 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:02:40.101656 140548852147648 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:02:40.133379 140547930957568 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:02:40.336776 140547930957568 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:02:40.818356 140547939350272 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:02:41.393065 140548852147648 evaluation.py:167] Evaluation [10/10]
I0812 18:02:41.393418 140548852147648 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:02:41.393493 140548852147648 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:02:41.393769 140547947742976 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:02:41.394043 140547947742976 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:02:41.394341 140548852147648 error_handling.py:96] infeed marked as finished
I0812 18:02:41.394520 140548852147648 tpu_estimator.py:602] Stop output thread controller
I0812 18:02:41.394577 140548852147648 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:02:41.394771 140547939350272 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:02:41.394926 140547939350272 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:02:41.395073 140548852147648 error_handling.py:96] outfeed marked as finished
I0812 18:02:41.395198 140548852147648 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:03:10.429920 140548852147648 evaluation.py:275] Finished evaluation at 2019-08-12-18:03:10
I0812 18:03:10.430301 140548852147648 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1032, global_step = 30, loss = 2.3006015
I0812 18:03:14.849339 140548852147648 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:03:15.897711 140548852147648 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3006015, 'global_step': 30, 'accuracy': 0.1032}

Removing gs://yangyou-mnist/log/#1565632795300287...
Removing gs://yangyou-mnist/log/checkpoint#1565632875152063...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565632795.v3-8-tpu#1565632878380844...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565632799756576...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565632806413967...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565632807269555...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565632872004002...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565632811755056...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565632872916793...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565632877446620...
Removing gs://yangyou-mnist/log/eval/#1565632992130666...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565632992.v3-8-tpu#1565632995328688...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:03:19.697541 140219879859648 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:03:19.698446 140219879859648 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:03:19.701076 140219879859648 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:03:19.701899 140219879859648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:03:19.702543 140219879859648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:03:19.702692 140219879859648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:03:20.121176 140219879859648 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:03:20.127590 140219879859648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:03:20.131186 140219879859648 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:03:20.176856 140219879859648 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:03:20.177145 140219879859648 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:03:20.404136 140219879859648 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:03:20.451973 140219879859648 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:03:20.452276 140219879859648 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:03:20.578419 140219879859648 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f87564a9210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8758686210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:03:20.578811 140219879859648 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:03:20.902046 140219879859648 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:03:20.905106: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:03:20.918812 140219879859648 tpu_system_metadata.py:148] Found TPU system:
I0812 18:03:20.919060 140219879859648 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:03:20.919540 140219879859648 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:03:20.919599 140219879859648 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:03:20.919651 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:03:20.919940 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:03:20.920010 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:03:20.920062 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:03:20.920109 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:03:20.920160 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:03:20.920207 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:03:20.920257 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:03:20.920304 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:03:20.920351 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:03:20.920398 140219879859648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:03:20.926603 140219879859648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:03:20.939668 140219879859648 estimator.py:1145] Calling model_fn.
W0812 18:03:20.940316 140219879859648 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:03:21.221153 140219879859648 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:03:21.656410 140219879859648 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:03:21.719012 140219879859648 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:03:21.724900 140219879859648 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:03:21.909440 140219879859648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:03:21.923439 140219879859648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:03:21.938623 140219879859648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:03:21.948748 140219879859648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:03:21.954880 140219879859648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:03:22.378350 140219879859648 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:03:22.394119 140219879859648 estimator.py:1147] Done calling model_fn.
I0812 18:03:25.753535 140219879859648 tpu_estimator.py:499] TPU job name worker
I0812 18:03:25.870719 140219879859648 monitored_session.py:240] Graph was finalized.
I0812 18:03:26.438575 140219879859648 session_manager.py:500] Running local_init_op.
I0812 18:03:26.479206 140219879859648 session_manager.py:502] Done running local_init_op.
I0812 18:03:28.981831 140219879859648 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:03:41.084680 140219879859648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:03:41.192497 140219879859648 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:03:41.192934 140219879859648 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:03:41.193394: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:03:41.198863 140219879859648 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:03:41.201209 140219879859648 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:03:41.204811 140219879859648 tpu_estimator.py:557] Init TPU system
I0812 18:04:24.018335 140219879859648 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:04:24.019321 140218985862912 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:04:24.019824 140218977470208 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:04:24.065012 140219879859648 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:04:24.065833 140219879859648 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:04:24.077305 140218969077504 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:04:24.300961 140218969077504 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:04:28.649396 140218977470208 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:04:33.107059 140219879859648 basic_session_run_hooks.py:262] loss = 2.303466, step = 30
I0812 18:04:33.109966 140219879859648 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:04:46.070744 140219879859648 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:04:46.071062 140219879859648 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:04:46.071369 140218985862912 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:04:46.071698 140218985862912 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:04:46.071974 140219879859648 error_handling.py:96] infeed marked as finished
I0812 18:04:46.072211 140219879859648 tpu_estimator.py:602] Stop output thread controller
I0812 18:04:46.072290 140219879859648 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:04:46.072470 140218977470208 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:04:46.072648 140218977470208 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:04:46.072850 140219879859648 error_handling.py:96] outfeed marked as finished
I0812 18:04:46.073084 140219879859648 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:04:54.441648 140219879859648 estimator.py:368] Loss for final step: 2.303466.
I0812 18:04:54.442569 140219879859648 error_handling.py:96] training_loop marked as finished
I0812 18:04:55.303769 140219879859648 estimator.py:1145] Calling model_fn.
E0812 18:04:56.054837 140219879859648 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:04:56.277728 140219879859648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:04:56.300128 140219879859648 estimator.py:1147] Done calling model_fn.
I0812 18:04:56.316149 140219879859648 evaluation.py:255] Starting evaluation at 2019-08-12T18:04:56Z
I0812 18:04:56.316378 140219879859648 tpu_estimator.py:499] TPU job name worker
I0812 18:04:56.394737 140219879859648 monitored_session.py:240] Graph was finalized.
W0812 18:04:56.395461 140219879859648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:04:56.575726 140219879859648 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:04:59.222877 140219879859648 session_manager.py:500] Running local_init_op.
I0812 18:04:59.250861 140219879859648 session_manager.py:502] Done running local_init_op.
I0812 18:04:59.302699 140219879859648 tpu_estimator.py:557] Init TPU system
I0812 18:06:08.079071 140219879859648 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:06:08.080169 140218973800192 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:06:08.080780 140218960422656 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:06:08.147284 140219879859648 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:06:08.176256 140219879859648 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:06:08.176629 140219879859648 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:06:08.209270 140218952029952 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:06:08.471093 140218952029952 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:06:08.917463 140218960422656 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:06:09.381373 140219879859648 evaluation.py:167] Evaluation [10/10]
I0812 18:06:09.381728 140219879859648 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:06:09.381808 140219879859648 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:06:09.382045 140218973800192 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:06:09.382308 140218973800192 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:06:09.382551 140219879859648 error_handling.py:96] infeed marked as finished
I0812 18:06:09.382673 140219879859648 tpu_estimator.py:602] Stop output thread controller
I0812 18:06:09.382733 140219879859648 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:06:09.382893 140218960422656 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:06:09.382978 140218960422656 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:06:09.383147 140219879859648 error_handling.py:96] outfeed marked as finished
I0812 18:06:09.383244 140219879859648 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:06:38.552731 140219879859648 evaluation.py:275] Finished evaluation at 2019-08-12-18:06:38
I0812 18:06:38.553092 140219879859648 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.30035
I0812 18:06:42.661784 140219879859648 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:06:43.466751 140219879859648 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.30035, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565633003862618...
Removing gs://yangyou-mnist/log/checkpoint#1565633082688330...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565633016251727...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565633020599525...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565633004.v3-8-tpu#1565633085768140...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565633079775727...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565633080623663...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565633015331302...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565633008455985...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565633084879086...
Removing gs://yangyou-mnist/log/eval/#1565633200214799...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565633200.v3-8-tpu#1565633203148900...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:06:47.257066 140302374098368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:06:47.257888 140302374098368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:06:47.260521 140302374098368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:06:47.261342 140302374098368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:06:47.261904 140302374098368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:06:47.262032 140302374098368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:06:47.685857 140302374098368 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:06:47.693191 140302374098368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:06:47.697309 140302374098368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:06:47.792876 140302374098368 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:06:47.793180 140302374098368 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:06:47.993580 140302374098368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:06:48.031379 140302374098368 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:06:48.031678 140302374098368 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:06:48.361323 140302374098368 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f9a8b54c050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f9a8d7291d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:06:48.361701 140302374098368 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:06:48.686422 140302374098368 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:06:48.689371: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:06:48.701277 140302374098368 tpu_system_metadata.py:148] Found TPU system:
I0812 18:06:48.701559 140302374098368 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:06:48.702053 140302374098368 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:06:48.702111 140302374098368 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:06:48.702224 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:06:48.702579 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:06:48.702637 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:06:48.702689 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:06:48.702738 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:06:48.702791 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:06:48.702838 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:06:48.702893 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:06:48.702940 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:06:48.702992 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:06:48.703042 140302374098368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:06:48.708992 140302374098368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:06:48.720983 140302374098368 estimator.py:1145] Calling model_fn.
W0812 18:06:48.721558 140302374098368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:06:48.998125 140302374098368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:06:49.583372 140302374098368 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:06:49.643564 140302374098368 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:06:49.649363 140302374098368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:06:49.824126 140302374098368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:06:49.837678 140302374098368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:06:49.852907 140302374098368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:06:49.863081 140302374098368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:06:49.868964 140302374098368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:06:50.294795 140302374098368 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:06:50.310904 140302374098368 estimator.py:1147] Done calling model_fn.
I0812 18:06:53.497975 140302374098368 tpu_estimator.py:499] TPU job name worker
I0812 18:06:53.615772 140302374098368 monitored_session.py:240] Graph was finalized.
I0812 18:06:54.186697 140302374098368 session_manager.py:500] Running local_init_op.
I0812 18:06:54.227766 140302374098368 session_manager.py:502] Done running local_init_op.
I0812 18:06:56.792588 140302374098368 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:07:09.190087 140302374098368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:07:09.307080 140302374098368 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:07:09.307620 140302374098368 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:07:09.308074: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:07:09.314232 140302374098368 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:07:09.316812 140302374098368 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:07:09.320813 140302374098368 tpu_estimator.py:557] Init TPU system
I0812 18:07:52.069259 140302374098368 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:07:52.070182 140301339453184 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:07:52.070698 140301331060480 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:07:52.115012 140302374098368 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:07:52.115936 140302374098368 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:07:52.127207 140301322667776 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:07:52.467931 140301322667776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 18:07:56.607562 140301331060480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:08:01.056183 140302374098368 basic_session_run_hooks.py:262] loss = 2.286095, step = 30
I0812 18:08:01.058824 140302374098368 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:08:14.160406 140302374098368 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:08:14.160715 140302374098368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:08:14.160940 140301339453184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:08:14.161066 140301339453184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:08:14.161221 140302374098368 error_handling.py:96] infeed marked as finished
I0812 18:08:14.161328 140302374098368 tpu_estimator.py:602] Stop output thread controller
I0812 18:08:14.161384 140302374098368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:08:14.161514 140301331060480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:08:14.161598 140301331060480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:08:14.161726 140302374098368 error_handling.py:96] outfeed marked as finished
I0812 18:08:14.161818 140302374098368 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:08:22.607017 140302374098368 estimator.py:368] Loss for final step: 2.286095.
I0812 18:08:22.607899 140302374098368 error_handling.py:96] training_loop marked as finished
I0812 18:08:23.313143 140302374098368 estimator.py:1145] Calling model_fn.
E0812 18:08:24.036324 140302374098368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:08:24.268248 140302374098368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:08:24.291735 140302374098368 estimator.py:1147] Done calling model_fn.
I0812 18:08:24.308094 140302374098368 evaluation.py:255] Starting evaluation at 2019-08-12T18:08:24Z
I0812 18:08:24.308330 140302374098368 tpu_estimator.py:499] TPU job name worker
I0812 18:08:24.385237 140302374098368 monitored_session.py:240] Graph was finalized.
W0812 18:08:24.385972 140302374098368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:08:24.628559 140302374098368 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:08:27.075265 140302374098368 session_manager.py:500] Running local_init_op.
I0812 18:08:27.103888 140302374098368 session_manager.py:502] Done running local_init_op.
I0812 18:08:27.150914 140302374098368 tpu_estimator.py:557] Init TPU system
I0812 18:09:36.064516 140302374098368 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:09:36.065737 140301339453184 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:09:36.066653 140301331060480 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:09:36.131999 140302374098368 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:09:36.160518 140302374098368 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:09:36.160902 140302374098368 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:09:36.190278 140301322667776 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:09:36.303966 140301322667776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:09:36.894996 140301331060480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:09:37.189905 140302374098368 evaluation.py:167] Evaluation [10/10]
I0812 18:09:37.190346 140302374098368 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:09:37.190431 140302374098368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:09:37.190681 140301339453184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:09:37.190973 140301339453184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:09:37.191190 140302374098368 error_handling.py:96] infeed marked as finished
I0812 18:09:37.191402 140302374098368 tpu_estimator.py:602] Stop output thread controller
I0812 18:09:37.191464 140302374098368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:09:37.191658 140301331060480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:09:37.191828 140301331060480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:09:37.192065 140302374098368 error_handling.py:96] outfeed marked as finished
I0812 18:09:37.192202 140302374098368 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:10:06.397378 140302374098368 evaluation.py:275] Finished evaluation at 2019-08-12-18:10:06
I0812 18:10:06.397723 140302374098368 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1249, global_step = 30, loss = 2.2903917
I0812 18:10:10.583859 140302374098368 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:10:11.381165 140302374098368 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2903917, 'global_step': 30, 'accuracy': 0.1249}

Removing gs://yangyou-mnist/log/#1565633211779987...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565633211.v3-8-tpu#1565633293855741...
Removing gs://yangyou-mnist/log/checkpoint#1565633290762793...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565633228705830...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565633216251722...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565633287694972...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565633288554622...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565633224344773...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565633223492219...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565633292964079...
Removing gs://yangyou-mnist/log/eval/#1565633408056090...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565633408.v3-8-tpu#1565633411060578...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:10:15.290965 140490511242688 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:10:15.291766 140490511242688 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:10:15.294418 140490511242688 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:10:15.295273 140490511242688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:10:15.295872 140490511242688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:10:15.296004 140490511242688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:10:15.712940 140490511242688 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:10:15.720467 140490511242688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:10:15.724406 140490511242688 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:10:15.770780 140490511242688 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:10:15.771114 140490511242688 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:10:15.912636 140490511242688 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:10:15.962748 140490511242688 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:10:15.963052 140490511242688 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:10:16.160763 140490511242688 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc6592dc290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc65b4b9210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:10:16.161144 140490511242688 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:10:16.494116 140490511242688 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:10:16.497352: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:10:16.509326 140490511242688 tpu_system_metadata.py:148] Found TPU system:
I0812 18:10:16.509587 140490511242688 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:10:16.510133 140490511242688 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:10:16.510256 140490511242688 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:10:16.510318 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:10:16.510756 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:10:16.510818 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:10:16.510870 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:10:16.510922 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:10:16.510982 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:10:16.511060 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:10:16.511214 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:10:16.511266 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:10:16.511313 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:10:16.511368 140490511242688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:10:16.517646 140490511242688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:10:16.530986 140490511242688 estimator.py:1145] Calling model_fn.
W0812 18:10:16.531641 140490511242688 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:10:16.877671 140490511242688 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:10:17.313760 140490511242688 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:10:17.377427 140490511242688 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:10:17.383652 140490511242688 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:10:17.574248 140490511242688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:10:17.588371 140490511242688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:10:17.604032 140490511242688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:10:17.614614 140490511242688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:10:17.621294 140490511242688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:10:18.051661 140490511242688 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:10:18.068003 140490511242688 estimator.py:1147] Done calling model_fn.
I0812 18:10:21.400686 140490511242688 tpu_estimator.py:499] TPU job name worker
I0812 18:10:21.520600 140490511242688 monitored_session.py:240] Graph was finalized.
I0812 18:10:22.112750 140490511242688 session_manager.py:500] Running local_init_op.
I0812 18:10:22.142414 140490511242688 session_manager.py:502] Done running local_init_op.
I0812 18:10:24.685796 140490511242688 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:10:36.473702 140490511242688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:10:36.581461 140490511242688 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:10:36.581907 140490511242688 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:10:36.582343: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:10:36.586719 140490511242688 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:10:36.589013 140490511242688 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:10:36.593502 140490511242688 tpu_estimator.py:557] Init TPU system
I0812 18:11:20.083388 140490511242688 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 18:11:20.084462 140489743116032 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:11:20.085112 140489734723328 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:11:20.131216 140490511242688 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:11:20.132186 140490511242688 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:11:20.143760 140489252665088 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:11:20.536938 140489252665088 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 18:11:24.447021 140489734723328 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:11:29.079034 140490511242688 basic_session_run_hooks.py:262] loss = 1.2784092, step = 30
I0812 18:11:29.081558 140490511242688 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:11:42.146321 140490511242688 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:11:42.146608 140490511242688 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:11:42.146927 140489743116032 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:11:42.147241 140489743116032 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:11:42.147495 140490511242688 error_handling.py:96] infeed marked as finished
I0812 18:11:42.147747 140490511242688 tpu_estimator.py:602] Stop output thread controller
I0812 18:11:42.147814 140490511242688 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:11:42.148005 140489734723328 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:11:42.148192 140489734723328 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:11:42.148394 140490511242688 error_handling.py:96] outfeed marked as finished
I0812 18:11:42.148552 140490511242688 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:11:50.671233 140490511242688 estimator.py:368] Loss for final step: 1.2784092.
I0812 18:11:50.672094 140490511242688 error_handling.py:96] training_loop marked as finished
I0812 18:11:51.400124 140490511242688 estimator.py:1145] Calling model_fn.
E0812 18:11:52.098753 140490511242688 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:11:52.333920 140490511242688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:11:52.358553 140490511242688 estimator.py:1147] Done calling model_fn.
I0812 18:11:52.375490 140490511242688 evaluation.py:255] Starting evaluation at 2019-08-12T18:11:52Z
I0812 18:11:52.375730 140490511242688 tpu_estimator.py:499] TPU job name worker
I0812 18:11:52.453216 140490511242688 monitored_session.py:240] Graph was finalized.
W0812 18:11:52.454021 140490511242688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:11:52.640918 140490511242688 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:11:55.107172 140490511242688 session_manager.py:500] Running local_init_op.
I0812 18:11:55.130485 140490511242688 session_manager.py:502] Done running local_init_op.
I0812 18:11:55.184551 140490511242688 tpu_estimator.py:557] Init TPU system
I0812 18:13:04.005773 140490511242688 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:13:04.006666 140489743116032 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:13:04.007055 140489734723328 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:13:04.070225 140490511242688 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:13:04.097599 140490511242688 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:13:04.098077 140490511242688 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:13:04.216042 140489252665088 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:13:04.622788 140489252665088 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:13:04.844983 140489734723328 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:13:05.213712 140490511242688 evaluation.py:167] Evaluation [10/10]
I0812 18:13:05.214181 140490511242688 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:13:05.214270 140490511242688 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:13:05.214498 140489743116032 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:13:05.214612 140489743116032 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:13:05.214760 140490511242688 error_handling.py:96] infeed marked as finished
I0812 18:13:05.214898 140490511242688 tpu_estimator.py:602] Stop output thread controller
I0812 18:13:05.214953 140490511242688 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:13:05.215085 140489734723328 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:13:05.215167 140489734723328 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:13:05.215296 140490511242688 error_handling.py:96] outfeed marked as finished
I0812 18:13:05.215387 140490511242688 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:13:34.720938 140490511242688 evaluation.py:275] Finished evaluation at 2019-08-12-18:13:34
I0812 18:13:34.721311 140490511242688 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8159, global_step = 30, loss = 1.2073069
I0812 18:13:39.009900 140490511242688 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:13:39.760503 140490511242688 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.2073069, 'global_step': 30, 'accuracy': 0.8159}

Removing gs://yangyou-mnist/log/#1565633419492373...
Removing gs://yangyou-mnist/log/checkpoint#1565633498697746...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565633419.v3-8-tpu#1565633501733620...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565633424120082...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565633430868926...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565633435997229...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565633495676481...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565633431746226...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565633496502790...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565633500831128...
Removing gs://yangyou-mnist/log/eval/#1565633616365774...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565633616.v3-8-tpu#1565633619451989...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:13:43.600243 139916022683072 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:13:43.601010 139916022683072 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:13:43.603816 139916022683072 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:13:43.604610 139916022683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:13:43.605170 139916022683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:13:43.605294 139916022683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:13:44.015599 139916022683072 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:13:44.023103 139916022683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:13:44.026978 139916022683072 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:13:44.073831 139916022683072 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:13:44.074119 139916022683072 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:13:44.195453 139916022683072 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:13:44.241739 139916022683072 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:13:44.242032 139916022683072 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:13:44.579574 139916022683072 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4096fe0290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f40991bd210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:13:44.579946 139916022683072 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:13:44.909674 139916022683072 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:13:44.912799: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:13:44.924840 139916022683072 tpu_system_metadata.py:148] Found TPU system:
I0812 18:13:44.925097 139916022683072 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:13:44.925581 139916022683072 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:13:44.925637 139916022683072 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:13:44.925704 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:13:44.925992 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:13:44.926048 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:13:44.926100 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:13:44.926182 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:13:44.926248 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:13:44.926295 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:13:44.926345 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:13:44.926392 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:13:44.926436 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:13:44.926491 139916022683072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:13:44.932337 139916022683072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:13:44.944622 139916022683072 estimator.py:1145] Calling model_fn.
W0812 18:13:44.945224 139916022683072 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:13:45.243587 139916022683072 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:13:45.640788 139916022683072 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:13:45.702934 139916022683072 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:13:45.708918 139916022683072 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:13:45.888698 139916022683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:13:45.902761 139916022683072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:13:45.917912 139916022683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:13:45.927855 139916022683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:13:45.933692 139916022683072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:13:46.366606 139916022683072 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:13:46.381989 139916022683072 estimator.py:1147] Done calling model_fn.
I0812 18:13:49.651870 139916022683072 tpu_estimator.py:499] TPU job name worker
I0812 18:13:49.766442 139916022683072 monitored_session.py:240] Graph was finalized.
I0812 18:13:51.169802 139916022683072 session_manager.py:500] Running local_init_op.
I0812 18:13:51.209022 139916022683072 session_manager.py:502] Done running local_init_op.
I0812 18:13:53.651815 139916022683072 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:14:05.470527 139916022683072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:14:05.581015 139916022683072 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:14:05.581464 139916022683072 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:14:05.581863: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:14:05.587004 139916022683072 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:14:05.589389 139916022683072 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:14:05.593570 139916022683072 tpu_estimator.py:557] Init TPU system
I0812 18:14:48.071804 139916022683072 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:14:48.072813 139914993723136 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:14:48.073276 139914985330432 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:14:48.117008 139916022683072 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:14:48.117914 139916022683072 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:14:48.177248 139914976937728 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:14:48.463435 139914976937728 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:14:52.440315 139914985330432 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:14:56.913113 139916022683072 basic_session_run_hooks.py:262] loss = 0.5437237, step = 30
I0812 18:14:56.915499 139916022683072 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:15:10.237044 139916022683072 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:15:10.237322 139916022683072 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:15:10.237550 139914993723136 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:15:10.237658 139914993723136 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:15:10.237787 139916022683072 error_handling.py:96] infeed marked as finished
I0812 18:15:10.237905 139916022683072 tpu_estimator.py:602] Stop output thread controller
I0812 18:15:10.237957 139916022683072 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:15:10.238075 139914985330432 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:15:10.238204 139914985330432 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:15:10.238496 139916022683072 error_handling.py:96] outfeed marked as finished
I0812 18:15:10.238599 139916022683072 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:15:18.570981 139916022683072 estimator.py:368] Loss for final step: 0.5437237.
I0812 18:15:18.571933 139916022683072 error_handling.py:96] training_loop marked as finished
I0812 18:15:19.260691 139916022683072 estimator.py:1145] Calling model_fn.
E0812 18:15:19.947586 139916022683072 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:15:20.184714 139916022683072 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:15:20.208314 139916022683072 estimator.py:1147] Done calling model_fn.
I0812 18:15:20.224853 139916022683072 evaluation.py:255] Starting evaluation at 2019-08-12T18:15:20Z
I0812 18:15:20.225107 139916022683072 tpu_estimator.py:499] TPU job name worker
I0812 18:15:20.304775 139916022683072 monitored_session.py:240] Graph was finalized.
W0812 18:15:20.305535 139916022683072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:15:20.495522 139916022683072 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:15:23.108407 139916022683072 session_manager.py:500] Running local_init_op.
I0812 18:15:23.131232 139916022683072 session_manager.py:502] Done running local_init_op.
I0812 18:15:23.182301 139916022683072 tpu_estimator.py:557] Init TPU system
I0812 18:16:32.020951 139916022683072 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:16:32.022129 139914982184704 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:16:32.022763 139914973792000 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:16:32.088948 139916022683072 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:16:32.116162 139916022683072 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:16:32.116503 139916022683072 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:16:32.151268 139914965399296 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:16:32.272320 139914965399296 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:16:32.850205 139914973792000 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:16:33.148533 139916022683072 evaluation.py:167] Evaluation [10/10]
I0812 18:16:33.148893 139916022683072 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:16:33.148983 139916022683072 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:16:33.149326 139914982184704 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:16:33.149451 139914982184704 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:16:33.149638 139916022683072 error_handling.py:96] infeed marked as finished
I0812 18:16:33.149765 139916022683072 tpu_estimator.py:602] Stop output thread controller
I0812 18:16:33.149812 139916022683072 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:16:33.149971 139914973792000 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:16:33.150053 139914973792000 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:16:33.150226 139916022683072 error_handling.py:96] outfeed marked as finished
I0812 18:16:33.150326 139916022683072 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:17:02.364515 139916022683072 evaluation.py:275] Finished evaluation at 2019-08-12-18:17:02
I0812 18:17:02.364880 139916022683072 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8743, global_step = 30, loss = 0.4862947
I0812 18:17:06.733733 139916022683072 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:17:07.547797 139916022683072 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.4862947, 'global_step': 30, 'accuracy': 0.8743}

Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565633644981042...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565633640500019...
Removing gs://yangyou-mnist/log/#1565633627953630...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565633703354296...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565633628.v3-8-tpu#1565633709928626...
Removing gs://yangyou-mnist/log/checkpoint#1565633706975503...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565633639617181...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565633704525877...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565633633123234...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565633709028634...
Removing gs://yangyou-mnist/log/eval/#1565633824077502...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565633824.v3-8-tpu#1565633827240232...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:17:11.392189 139643835823552 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:17:11.392961 139643835823552 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:17:11.395703 139643835823552 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:17:11.396533 139643835823552 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:17:11.397150 139643835823552 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:17:11.397281 139643835823552 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:17:11.813585 139643835823552 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:17:11.820908 139643835823552 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:17:11.825099 139643835823552 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:17:11.871645 139643835823552 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:17:11.871922 139643835823552 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:17:12.068636 139643835823552 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:17:12.165532 139643835823552 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:17:12.165869 139643835823552 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:17:12.327599 139643835823552 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0137642190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f013981f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:17:12.328176 139643835823552 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:17:12.653460 139643835823552 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:17:12.656743: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:17:12.669754 139643835823552 tpu_system_metadata.py:148] Found TPU system:
I0812 18:17:12.670001 139643835823552 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:17:12.670727 139643835823552 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:17:12.670792 139643835823552 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:17:12.670845 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:17:12.671150 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:17:12.671209 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:17:12.671261 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:17:12.671309 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:17:12.671356 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:17:12.671403 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:17:12.671448 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:17:12.671494 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:17:12.671540 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:17:12.671587 139643835823552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:17:12.677865 139643835823552 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:17:12.690617 139643835823552 estimator.py:1145] Calling model_fn.
W0812 18:17:12.691253 139643835823552 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:17:12.967062 139643835823552 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:17:13.473261 139643835823552 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:17:13.537019 139643835823552 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:17:13.543112 139643835823552 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:17:13.727353 139643835823552 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:17:13.741808 139643835823552 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:17:13.757817 139643835823552 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:17:13.768563 139643835823552 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:17:13.774893 139643835823552 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:17:14.217479 139643835823552 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:17:14.233203 139643835823552 estimator.py:1147] Done calling model_fn.
I0812 18:17:17.620002 139643835823552 tpu_estimator.py:499] TPU job name worker
I0812 18:17:17.735089 139643835823552 monitored_session.py:240] Graph was finalized.
I0812 18:17:18.309775 139643835823552 session_manager.py:500] Running local_init_op.
I0812 18:17:18.341048 139643835823552 session_manager.py:502] Done running local_init_op.
I0812 18:17:20.774502 139643835823552 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:17:32.927772 139643835823552 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:17:33.046119 139643835823552 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:17:33.046619 139643835823552 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:17:33.047046: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:17:33.051656 139643835823552 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:17:33.054128 139643835823552 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:17:33.059179 139643835823552 tpu_estimator.py:557] Init TPU system
I0812 18:18:16.039319 139643835823552 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:18:16.040178 139642791778048 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:18:16.040674 139642783385344 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:18:16.084232 139643835823552 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:18:16.085108 139643835823552 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:18:16.096060 139642774992640 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:18:16.216900 139642774992640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:18:20.639168 139642783385344 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:18:25.089415 139643835823552 basic_session_run_hooks.py:262] loss = 0.30412132, step = 30
I0812 18:18:25.092130 139643835823552 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:18:39.320159 139643835823552 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:18:39.320481 139643835823552 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:18:39.320827 139642791778048 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:18:39.321224 139642791778048 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:18:39.321461 139643835823552 error_handling.py:96] infeed marked as finished
I0812 18:18:39.321683 139643835823552 tpu_estimator.py:602] Stop output thread controller
I0812 18:18:39.321739 139643835823552 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:18:39.321917 139642783385344 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:18:39.322190 139642783385344 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:18:39.322407 139643835823552 error_handling.py:96] outfeed marked as finished
I0812 18:18:39.322592 139643835823552 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:18:46.349009 139643835823552 estimator.py:368] Loss for final step: 0.30412132.
I0812 18:18:46.350011 139643835823552 error_handling.py:96] training_loop marked as finished
I0812 18:18:47.138020 139643835823552 estimator.py:1145] Calling model_fn.
E0812 18:18:47.824286 139643835823552 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:18:48.050498 139643835823552 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:18:48.074934 139643835823552 estimator.py:1147] Done calling model_fn.
I0812 18:18:48.091268 139643835823552 evaluation.py:255] Starting evaluation at 2019-08-12T18:18:48Z
I0812 18:18:48.091497 139643835823552 tpu_estimator.py:499] TPU job name worker
I0812 18:18:48.169123 139643835823552 monitored_session.py:240] Graph was finalized.
W0812 18:18:48.169820 139643835823552 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:18:48.358709 139643835823552 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:18:51.041091 139643835823552 session_manager.py:500] Running local_init_op.
I0812 18:18:51.069082 139643835823552 session_manager.py:502] Done running local_init_op.
I0812 18:18:51.115442 139643835823552 tpu_estimator.py:557] Init TPU system
I0812 18:20:00.027173 139643835823552 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:20:00.028481 139642791778048 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:20:00.029270 139642783385344 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:20:00.094007 139643835823552 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:20:00.117435 139643835823552 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:20:00.117810 139643835823552 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:20:00.194935 139642774992640 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:20:00.395427 139642774992640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:20:00.849208 139642783385344 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:20:01.279297 139643835823552 evaluation.py:167] Evaluation [10/10]
I0812 18:20:01.279643 139643835823552 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:20:01.279710 139643835823552 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:20:01.279896 139642791778048 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:20:01.279989 139642791778048 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:20:01.280128 139643835823552 error_handling.py:96] infeed marked as finished
I0812 18:20:01.280220 139643835823552 tpu_estimator.py:602] Stop output thread controller
I0812 18:20:01.280277 139643835823552 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:20:01.280384 139642783385344 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:20:01.280457 139642783385344 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:20:01.280570 139643835823552 error_handling.py:96] outfeed marked as finished
I0812 18:20:01.280647 139643835823552 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:20:30.479476 139643835823552 evaluation.py:275] Finished evaluation at 2019-08-12-18:20:30
I0812 18:20:30.479898 139643835823552 estimator.py:2039] Saving dict for global step 30: accuracy = 0.925, global_step = 30, loss = 0.31023422
I0812 18:20:34.771864 139643835823552 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:20:35.550028 139643835823552 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.31023422, 'global_step': 30, 'accuracy': 0.925}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565633848076258...
Removing gs://yangyou-mnist/log/#1565633835692689...
Removing gs://yangyou-mnist/log/checkpoint#1565633915925381...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565633835.v3-8-tpu#1565633919011618...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565633912025616...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565633840236028...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565633852449655...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565633847213787...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565633912858334...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565633918127782...
Removing gs://yangyou-mnist/log/eval/#1565634032182993...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565634032.v3-8-tpu#1565634035242213...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:20:39.389049 139903253312960 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:20:39.389853 139903253312960 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:20:39.392493 139903253312960 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:20:39.393354 139903253312960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:20:39.393938 139903253312960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:20:39.394058 139903253312960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:20:39.803961 139903253312960 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:20:39.812302 139903253312960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:20:39.816570 139903253312960 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:20:39.865617 139903253312960 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:20:39.865911 139903253312960 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:20:40.364927 139903253312960 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:20:40.457526 139903253312960 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:20:40.457835 139903253312960 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:20:40.654294 139903253312960 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3d9de0e190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3d9ffeb210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:20:40.654762 139903253312960 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:20:40.981113 139903253312960 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:20:40.984065: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:20:40.996221 139903253312960 tpu_system_metadata.py:148] Found TPU system:
I0812 18:20:40.996588 139903253312960 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:20:40.997179 139903253312960 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:20:40.997241 139903253312960 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:20:40.997294 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:20:40.997586 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:20:40.997647 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:20:40.997697 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:20:40.997745 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:20:40.997792 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:20:40.997838 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:20:40.997886 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:20:40.997932 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:20:40.997980 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:20:40.998025 139903253312960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:20:41.003968 139903253312960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:20:41.016225 139903253312960 estimator.py:1145] Calling model_fn.
W0812 18:20:41.016872 139903253312960 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:20:41.286358 139903253312960 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:20:42.293128 139903253312960 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:20:42.354645 139903253312960 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:20:42.360390 139903253312960 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:20:42.537319 139903253312960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:20:42.551084 139903253312960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:20:42.566112 139903253312960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:20:42.576514 139903253312960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:20:42.582521 139903253312960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:20:42.999728 139903253312960 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:20:43.015602 139903253312960 estimator.py:1147] Done calling model_fn.
I0812 18:20:46.354621 139903253312960 tpu_estimator.py:499] TPU job name worker
I0812 18:20:46.471877 139903253312960 monitored_session.py:240] Graph was finalized.
I0812 18:20:47.043720 139903253312960 session_manager.py:500] Running local_init_op.
I0812 18:20:47.074596 139903253312960 session_manager.py:502] Done running local_init_op.
I0812 18:20:49.493205 139903253312960 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:21:01.626693 139903253312960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:21:01.736298 139903253312960 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:21:01.736850 139903253312960 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:21:01.737251: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:21:01.742367 139903253312960 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:21:01.744820 139903253312960 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:21:01.749644 139903253312960 tpu_estimator.py:557] Init TPU system
I0812 18:21:44.046895 139903253312960 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:21:44.047866 139902359422720 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:21:44.048403 139902351030016 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:21:44.091623 139903253312960 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:21:44.092561 139903253312960 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:21:44.106328 139902342637312 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:21:44.219126 139902342637312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:21:48.574824 139902351030016 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:21:53.119265 139903253312960 basic_session_run_hooks.py:262] loss = 0.2832515, step = 30
I0812 18:21:53.121503 139903253312960 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:22:06.538873 139903253312960 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:22:06.539155 139903253312960 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:22:06.539374 139902359422720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:22:06.539495 139902359422720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:22:06.539638 139903253312960 error_handling.py:96] infeed marked as finished
I0812 18:22:06.539746 139903253312960 tpu_estimator.py:602] Stop output thread controller
I0812 18:22:06.539793 139903253312960 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:22:06.539908 139902351030016 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:22:06.539983 139902351030016 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:22:06.540100 139903253312960 error_handling.py:96] outfeed marked as finished
I0812 18:22:06.540174 139903253312960 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:22:14.352977 139903253312960 estimator.py:368] Loss for final step: 0.2832515.
I0812 18:22:14.353807 139903253312960 error_handling.py:96] training_loop marked as finished
I0812 18:22:15.167231 139903253312960 estimator.py:1145] Calling model_fn.
E0812 18:22:15.857314 139903253312960 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:22:16.087945 139903253312960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:22:16.111337 139903253312960 estimator.py:1147] Done calling model_fn.
I0812 18:22:16.128838 139903253312960 evaluation.py:255] Starting evaluation at 2019-08-12T18:22:16Z
I0812 18:22:16.129090 139903253312960 tpu_estimator.py:499] TPU job name worker
I0812 18:22:16.210305 139903253312960 monitored_session.py:240] Graph was finalized.
W0812 18:22:16.211105 139903253312960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:22:16.401846 139903253312960 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:22:19.087950 139903253312960 session_manager.py:500] Running local_init_op.
I0812 18:22:19.111905 139903253312960 session_manager.py:502] Done running local_init_op.
I0812 18:22:19.163424 139903253312960 tpu_estimator.py:557] Init TPU system
I0812 18:23:28.011313 139903253312960 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:23:28.012455 139902355752704 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:23:28.012923 139902347360000 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:23:28.078600 139903253312960 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:23:28.105272 139903253312960 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:23:28.105639 139903253312960 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:23:28.180352 139902333982464 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:23:28.408322 139902333982464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:23:28.874430 139902347360000 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:23:29.153085 139903253312960 evaluation.py:167] Evaluation [10/10]
I0812 18:23:29.153492 139903253312960 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:23:29.153583 139903253312960 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:23:29.153860 139902355752704 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:23:29.154223 139902355752704 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:23:29.154449 139903253312960 error_handling.py:96] infeed marked as finished
I0812 18:23:29.154633 139903253312960 tpu_estimator.py:602] Stop output thread controller
I0812 18:23:29.154685 139903253312960 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:23:29.154875 139902347360000 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:23:29.155073 139902347360000 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:23:29.155250 139903253312960 error_handling.py:96] outfeed marked as finished
I0812 18:23:29.155374 139903253312960 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:23:58.504245 139903253312960 evaluation.py:275] Finished evaluation at 2019-08-12-18:23:58
I0812 18:23:58.504580 139903253312960 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9333, global_step = 30, loss = 0.26562408
I0812 18:24:02.799937 139903253312960 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:24:03.744963 139903253312960 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.26562408, 'global_step': 30, 'accuracy': 0.9333}

Removing gs://yangyou-mnist/log/#1565634044530801...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565634044.v3-8-tpu#1565634126235440...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565634048964835...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565634061150962...
Removing gs://yangyou-mnist/log/checkpoint#1565634123045611...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565634119829663...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565634055922130...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565634120784702...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565634056843011...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565634125345293...
Removing gs://yangyou-mnist/log/eval/#1565634240227656...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565634240.v3-8-tpu#1565634243438521...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:24:07.697237 140508930110912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:24:07.698050 140508930110912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:24:07.700793 140508930110912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:24:07.701626 140508930110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:24:07.702261 140508930110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:24:07.702402 140508930110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:24:08.128638 140508930110912 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:24:08.136006 140508930110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:24:08.140284 140508930110912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:24:08.190424 140508930110912 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:24:08.190722 140508930110912 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:24:08.426558 140508930110912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:24:08.521742 140508930110912 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:24:08.522022 140508930110912 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:24:08.670340 140508930110912 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcaa3076090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcaa5253210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:24:08.670705 140508930110912 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:24:08.989237 140508930110912 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:24:08.992363: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:24:09.005146 140508930110912 tpu_system_metadata.py:148] Found TPU system:
I0812 18:24:09.005387 140508930110912 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:24:09.005877 140508930110912 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:24:09.006023 140508930110912 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:24:09.006092 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:24:09.006515 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:24:09.006576 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:24:09.006627 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:24:09.006676 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:24:09.006726 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:24:09.006772 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:24:09.006819 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:24:09.006865 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:24:09.006911 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:24:09.006969 140508930110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:24:09.013010 140508930110912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:24:09.025825 140508930110912 estimator.py:1145] Calling model_fn.
W0812 18:24:09.026510 140508930110912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:24:09.298553 140508930110912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:24:09.897943 140508930110912 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:24:09.959465 140508930110912 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:24:09.965354 140508930110912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:24:10.151585 140508930110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:24:10.165492 140508930110912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:24:10.180640 140508930110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:24:10.190823 140508930110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:24:10.196958 140508930110912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:24:10.620250 140508930110912 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:24:10.636070 140508930110912 estimator.py:1147] Done calling model_fn.
I0812 18:24:14.089215 140508930110912 tpu_estimator.py:499] TPU job name worker
I0812 18:24:14.204659 140508930110912 monitored_session.py:240] Graph was finalized.
I0812 18:24:14.765211 140508930110912 session_manager.py:500] Running local_init_op.
I0812 18:24:14.810854 140508930110912 session_manager.py:502] Done running local_init_op.
I0812 18:24:17.369913 140508930110912 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:24:29.581091 140508930110912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:24:29.710789 140508930110912 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:24:29.711225 140508930110912 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:24:29.711636: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:24:29.716968 140508930110912 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:24:29.719403 140508930110912 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:24:29.724792 140508930110912 tpu_estimator.py:557] Init TPU system
I0812 18:25:12.054785 140508930110912 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:25:12.055991 140507892143872 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:25:12.056879 140507883751168 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:25:12.101653 140508930110912 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:25:12.102684 140508930110912 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:25:12.115185 140507875358464 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:25:12.334270 140507875358464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:25:16.889650 140507883751168 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:25:21.398469 140508930110912 basic_session_run_hooks.py:262] loss = 0.23120287, step = 30
I0812 18:25:21.400706 140508930110912 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:25:34.640862 140508930110912 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:25:34.641181 140508930110912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:25:34.641505 140507892143872 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:25:34.641786 140507892143872 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:25:34.641994 140508930110912 error_handling.py:96] infeed marked as finished
I0812 18:25:34.642225 140508930110912 tpu_estimator.py:602] Stop output thread controller
I0812 18:25:34.642288 140508930110912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:25:34.642465 140507883751168 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:25:34.642647 140507883751168 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:25:34.642831 140508930110912 error_handling.py:96] outfeed marked as finished
I0812 18:25:34.642975 140508930110912 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:25:42.458673 140508930110912 estimator.py:368] Loss for final step: 0.23120287.
I0812 18:25:42.459467 140508930110912 error_handling.py:96] training_loop marked as finished
I0812 18:25:43.152782 140508930110912 estimator.py:1145] Calling model_fn.
E0812 18:25:43.846517 140508930110912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:25:44.073803 140508930110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:25:44.097382 140508930110912 estimator.py:1147] Done calling model_fn.
I0812 18:25:44.113502 140508930110912 evaluation.py:255] Starting evaluation at 2019-08-12T18:25:44Z
I0812 18:25:44.113744 140508930110912 tpu_estimator.py:499] TPU job name worker
I0812 18:25:44.190938 140508930110912 monitored_session.py:240] Graph was finalized.
W0812 18:25:44.191721 140508930110912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:25:44.382666 140508930110912 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:25:47.051908 140508930110912 session_manager.py:500] Running local_init_op.
I0812 18:25:47.074944 140508930110912 session_manager.py:502] Done running local_init_op.
I0812 18:25:47.121413 140508930110912 tpu_estimator.py:557] Init TPU system
I0812 18:26:56.023643 140508930110912 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:26:56.024636 140507898177280 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:26:56.025177 140507889784576 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:26:56.089828 140508930110912 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:26:56.115396 140508930110912 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:26:56.115776 140508930110912 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:26:56.151668 140507881391872 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:26:56.257150 140507881391872 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:26:56.842355 140507889784576 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:26:57.286708 140508930110912 evaluation.py:167] Evaluation [10/10]
I0812 18:26:57.287036 140508930110912 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:26:57.287106 140508930110912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:26:57.287347 140507898177280 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:26:57.287456 140507898177280 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:26:57.287638 140508930110912 error_handling.py:96] infeed marked as finished
I0812 18:26:57.287765 140508930110912 tpu_estimator.py:602] Stop output thread controller
I0812 18:26:57.287812 140508930110912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:26:57.287959 140507889784576 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:26:57.288047 140507889784576 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:26:57.288220 140508930110912 error_handling.py:96] outfeed marked as finished
I0812 18:26:57.288310 140508930110912 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:27:26.353456 140508930110912 evaluation.py:275] Finished evaluation at 2019-08-12-18:27:26
I0812 18:27:26.353852 140508930110912 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9418, global_step = 30, loss = 0.23413679
I0812 18:27:30.803529 140508930110912 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:27:31.549329 140508930110912 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.23413679, 'global_step': 30, 'accuracy': 0.9418}

Removing gs://yangyou-mnist/log/#1565634252115981...
Removing gs://yangyou-mnist/log/checkpoint#1565634331054166...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565634252.v3-8-tpu#1565634334335501...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565634264535145...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565634256834155...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565634269100026...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565634263577913...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565634327988526...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565634328909982...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565634333269463...
Removing gs://yangyou-mnist/log/eval/#1565634448040725...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565634448.v3-8-tpu#1565634451238234...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:27:35.379780 139915805386176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:27:35.380575 139915805386176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:27:35.383378 139915805386176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:27:35.384182 139915805386176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:27:35.384759 139915805386176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:27:35.384902 139915805386176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:27:35.794770 139915805386176 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:27:35.803034 139915805386176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:27:35.807039 139915805386176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:27:35.904944 139915805386176 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:27:35.905257 139915805386176 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:27:36.021819 139915805386176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:27:36.068334 139915805386176 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:27:36.068625 139915805386176 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:27:36.164882 139915805386176 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f408a0a5290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f408c282210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:27:36.165247 139915805386176 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:27:36.491375 139915805386176 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:27:36.494468: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:27:36.507580 139915805386176 tpu_system_metadata.py:148] Found TPU system:
I0812 18:27:36.507817 139915805386176 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:27:36.508359 139915805386176 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:27:36.508418 139915805386176 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:27:36.508481 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:27:36.508784 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:27:36.508840 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:27:36.508889 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:27:36.508936 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:27:36.508997 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:27:36.509051 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:27:36.509097 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:27:36.509141 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:27:36.509186 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:27:36.509234 139915805386176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:27:36.515294 139915805386176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:27:36.527983 139915805386176 estimator.py:1145] Calling model_fn.
W0812 18:27:36.528601 139915805386176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:27:36.797848 139915805386176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:27:37.209909 139915805386176 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:27:37.271488 139915805386176 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:27:37.277695 139915805386176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:27:37.455688 139915805386176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:27:37.469233 139915805386176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:27:37.484385 139915805386176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:27:37.494421 139915805386176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:27:37.500539 139915805386176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:27:37.928982 139915805386176 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:27:37.944396 139915805386176 estimator.py:1147] Done calling model_fn.
I0812 18:27:41.363806 139915805386176 tpu_estimator.py:499] TPU job name worker
I0812 18:27:41.481190 139915805386176 monitored_session.py:240] Graph was finalized.
I0812 18:27:42.069220 139915805386176 session_manager.py:500] Running local_init_op.
I0812 18:27:42.107831 139915805386176 session_manager.py:502] Done running local_init_op.
I0812 18:27:44.566399 139915805386176 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:27:56.985397 139915805386176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:27:57.090708 139915805386176 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:27:57.091207 139915805386176 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:27:57.091623: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:27:57.095767 139915805386176 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:27:57.097996 139915805386176 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:27:57.102229 139915805386176 tpu_estimator.py:557] Init TPU system
I0812 18:28:40.066483 139915805386176 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:28:40.067394 139914911405824 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:28:40.067830 139914903013120 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:28:40.113718 139915805386176 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:28:40.115196 139915805386176 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:28:40.125108 139914894620416 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:28:40.229532 139914894620416 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 18:28:44.618721 139914903013120 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:28:49.207576 139915805386176 basic_session_run_hooks.py:262] loss = 0.24748059, step = 30
I0812 18:28:49.209765 139915805386176 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:29:02.295625 139915805386176 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:29:02.295922 139915805386176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:29:02.296163 139914911405824 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:29:02.296267 139914911405824 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:29:02.296418 139915805386176 error_handling.py:96] infeed marked as finished
I0812 18:29:02.296515 139915805386176 tpu_estimator.py:602] Stop output thread controller
I0812 18:29:02.296565 139915805386176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:29:02.296689 139914903013120 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:29:02.296761 139914903013120 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:29:02.296874 139915805386176 error_handling.py:96] outfeed marked as finished
I0812 18:29:02.296962 139915805386176 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:29:10.363468 139915805386176 estimator.py:368] Loss for final step: 0.24748059.
I0812 18:29:10.364239 139915805386176 error_handling.py:96] training_loop marked as finished
I0812 18:29:11.173398 139915805386176 estimator.py:1145] Calling model_fn.
E0812 18:29:11.904267 139915805386176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:29:12.144267 139915805386176 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:29:12.172327 139915805386176 estimator.py:1147] Done calling model_fn.
I0812 18:29:12.189392 139915805386176 evaluation.py:255] Starting evaluation at 2019-08-12T18:29:12Z
I0812 18:29:12.189641 139915805386176 tpu_estimator.py:499] TPU job name worker
I0812 18:29:12.268141 139915805386176 monitored_session.py:240] Graph was finalized.
W0812 18:29:12.268836 139915805386176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:29:12.455827 139915805386176 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:29:15.167891 139915805386176 session_manager.py:500] Running local_init_op.
I0812 18:29:15.191797 139915805386176 session_manager.py:502] Done running local_init_op.
I0812 18:29:15.248796 139915805386176 tpu_estimator.py:557] Init TPU system
I0812 18:30:24.037699 139915805386176 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:30:24.038810 139914899343104 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:30:24.039581 139914885965568 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:30:24.104183 139915805386176 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:30:24.128566 139915805386176 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:30:24.128941 139915805386176 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:30:24.155306 139914877572864 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:30:24.280026 139914877572864 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:30:24.907953 139914885965568 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:30:25.252343 139915805386176 evaluation.py:167] Evaluation [10/10]
I0812 18:30:25.252713 139915805386176 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:30:25.252811 139915805386176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:30:25.253094 139914899343104 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:30:25.253375 139914899343104 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:30:25.253570 139915805386176 error_handling.py:96] infeed marked as finished
I0812 18:30:25.253762 139915805386176 tpu_estimator.py:602] Stop output thread controller
I0812 18:30:25.253822 139915805386176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:30:25.254035 139914885965568 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:30:25.254308 139914885965568 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:30:25.254481 139915805386176 error_handling.py:96] outfeed marked as finished
I0812 18:30:25.254626 139915805386176 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:30:54.377116 139915805386176 evaluation.py:275] Finished evaluation at 2019-08-12-18:30:54
I0812 18:30:54.377451 139915805386176 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9412, global_step = 30, loss = 0.22707173
I0812 18:30:58.861852 139915805386176 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:30:59.811259 139915805386176 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.22707173, 'global_step': 30, 'accuracy': 0.9412}

Removing gs://yangyou-mnist/log/#1565634459471616...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565634459.v3-8-tpu#1565634541992740...
Removing gs://yangyou-mnist/log/checkpoint#1565634538907364...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565634463999864...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565634476496633...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565634471954249...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565634471016676...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565634535915236...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565634536754703...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565634541026177...
Removing gs://yangyou-mnist/log/eval/#1565634656110458...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565634656.v3-8-tpu#1565634659495545...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:31:03.646840 140649542694336 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:31:03.647670 140649542694336 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:31:03.650751 140649542694336 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:31:03.651591 140649542694336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:31:03.652190 140649542694336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:31:03.652333 140649542694336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:31:04.073864 140649542694336 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:31:04.081615 140649542694336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:31:04.085689 140649542694336 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:31:04.132484 140649542694336 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:31:04.132782 140649542694336 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:31:04.342469 140649542694336 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:31:04.387089 140649542694336 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:31:04.387372 140649542694336 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:31:04.610929 140649542694336 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7feb60312190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7feb624ef210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:31:04.611285 140649542694336 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:31:04.958137 140649542694336 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:31:04.961183: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:31:04.974411 140649542694336 tpu_system_metadata.py:148] Found TPU system:
I0812 18:31:04.974678 140649542694336 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:31:04.975260 140649542694336 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:31:04.975328 140649542694336 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:31:04.975387 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:31:04.975718 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:31:04.975780 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:31:04.975866 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:31:04.975929 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:31:04.975995 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:31:04.976053 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:31:04.976109 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:31:04.976162 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:31:04.976214 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:31:04.976270 140649542694336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:31:04.983222 140649542694336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:31:04.997561 140649542694336 estimator.py:1145] Calling model_fn.
W0812 18:31:04.998296 140649542694336 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:31:05.284672 140649542694336 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:31:05.723520 140649542694336 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:31:05.785437 140649542694336 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:31:05.791243 140649542694336 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:31:05.969348 140649542694336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:31:05.983175 140649542694336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:31:05.998408 140649542694336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:31:06.008374 140649542694336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:31:06.014332 140649542694336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:31:06.443496 140649542694336 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:31:06.459466 140649542694336 estimator.py:1147] Done calling model_fn.
I0812 18:31:09.677696 140649542694336 tpu_estimator.py:499] TPU job name worker
I0812 18:31:09.801280 140649542694336 monitored_session.py:240] Graph was finalized.
I0812 18:31:10.365123 140649542694336 session_manager.py:500] Running local_init_op.
I0812 18:31:10.405689 140649542694336 session_manager.py:502] Done running local_init_op.
I0812 18:31:13.035176 140649542694336 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:31:24.904937 140649542694336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:31:25.020286 140649542694336 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:31:25.020802 140649542694336 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:31:25.021197: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:31:25.025738 140649542694336 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:31:25.028235 140649542694336 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:31:25.032339 140649542694336 tpu_estimator.py:557] Init TPU system
I0812 18:32:08.067511 140649542694336 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 18:32:08.068470 140648367781632 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:32:08.069009 140648359388928 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:32:08.115683 140649542694336 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:32:08.116571 140649542694336 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:32:08.138607 140648350996224 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:32:08.403630 140648350996224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:32:12.872419 140648359388928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:32:17.465289 140649542694336 basic_session_run_hooks.py:262] loss = 0.20076948, step = 30
I0812 18:32:17.467926 140649542694336 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:32:30.555880 140649542694336 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:32:30.556180 140649542694336 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:32:30.556406 140648367781632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:32:30.556526 140648367781632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:32:30.556663 140649542694336 error_handling.py:96] infeed marked as finished
I0812 18:32:30.556777 140649542694336 tpu_estimator.py:602] Stop output thread controller
I0812 18:32:30.556828 140649542694336 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:32:30.556952 140648359388928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:32:30.557033 140648359388928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:32:30.557147 140649542694336 error_handling.py:96] outfeed marked as finished
I0812 18:32:30.557240 140649542694336 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:32:38.544569 140649542694336 estimator.py:368] Loss for final step: 0.20076948.
I0812 18:32:38.545392 140649542694336 error_handling.py:96] training_loop marked as finished
I0812 18:32:39.384495 140649542694336 estimator.py:1145] Calling model_fn.
E0812 18:32:40.163271 140649542694336 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:32:40.386173 140649542694336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:32:40.408601 140649542694336 estimator.py:1147] Done calling model_fn.
I0812 18:32:40.426023 140649542694336 evaluation.py:255] Starting evaluation at 2019-08-12T18:32:40Z
I0812 18:32:40.426311 140649542694336 tpu_estimator.py:499] TPU job name worker
I0812 18:32:40.510737 140649542694336 monitored_session.py:240] Graph was finalized.
W0812 18:32:40.511467 140649542694336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:32:40.694709 140649542694336 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:32:43.302405 140649542694336 session_manager.py:500] Running local_init_op.
I0812 18:32:43.331141 140649542694336 session_manager.py:502] Done running local_init_op.
I0812 18:32:43.377430 140649542694336 tpu_estimator.py:557] Init TPU system
I0812 18:33:52.088709 140649542694336 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:33:52.089637 140648367781632 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:33:52.090112 140648359388928 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:33:52.159339 140649542694336 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:33:52.183389 140649542694336 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:33:52.183752 140649542694336 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:33:52.255553 140648350996224 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:33:52.469650 140648350996224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:33:52.915049 140648359388928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:33:53.314903 140649542694336 evaluation.py:167] Evaluation [10/10]
I0812 18:33:53.315251 140649542694336 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:33:53.315320 140649542694336 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:33:53.315495 140648367781632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:33:53.315603 140648367781632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:33:53.315740 140649542694336 error_handling.py:96] infeed marked as finished
I0812 18:33:53.315829 140649542694336 tpu_estimator.py:602] Stop output thread controller
I0812 18:33:53.315876 140649542694336 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:33:53.315987 140648359388928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:33:53.316062 140648359388928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:33:53.316210 140649542694336 error_handling.py:96] outfeed marked as finished
I0812 18:33:53.316325 140649542694336 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:34:22.564171 140649542694336 evaluation.py:275] Finished evaluation at 2019-08-12-18:34:22
I0812 18:34:22.564534 140649542694336 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9527, global_step = 30, loss = 0.18447743
I0812 18:34:26.914716 140649542694336 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:34:27.710525 140649542694336 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.18447743, 'global_step': 30, 'accuracy': 0.9527}

Removing gs://yangyou-mnist/log/#1565634667950792...
Removing gs://yangyou-mnist/log/checkpoint#1565634747149346...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565634668.v3-8-tpu#1565634750222934...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565634679132456...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565634672498923...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565634684416813...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565634680084500...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565634744205371...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565634744992426...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565634749321189...
Removing gs://yangyou-mnist/log/eval/#1565634864255607...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565634864.v3-8-tpu#1565634867401111...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:34:31.669800 140629472593344 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:34:31.670643 140629472593344 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:34:31.673245 140629472593344 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:34:31.674057 140629472593344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:34:31.674804 140629472593344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:34:31.674942 140629472593344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:34:32.086827 140629472593344 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:34:32.093967 140629472593344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:34:32.097974 140629472593344 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:34:32.140908 140629472593344 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:34:32.141204 140629472593344 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:34:32.309226 140629472593344 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:34:32.408144 140629472593344 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:34:32.408413 140629472593344 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:34:32.525475 140629472593344 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe6b3ebb190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe6b6098210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:34:32.525849 140629472593344 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:34:32.854382 140629472593344 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:34:32.857290: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:34:32.869144 140629472593344 tpu_system_metadata.py:148] Found TPU system:
I0812 18:34:32.869389 140629472593344 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:34:32.869859 140629472593344 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:34:32.869916 140629472593344 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:34:32.869972 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:34:32.870336 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:34:32.870394 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:34:32.870454 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:34:32.870517 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:34:32.870565 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:34:32.870611 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:34:32.870665 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:34:32.870716 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:34:32.870765 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:34:32.870814 140629472593344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:34:32.876985 140629472593344 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:34:32.889470 140629472593344 estimator.py:1145] Calling model_fn.
W0812 18:34:32.890072 140629472593344 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:34:33.157356 140629472593344 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:34:33.617997 140629472593344 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:34:33.680296 140629472593344 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:34:33.686229 140629472593344 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:34:33.870760 140629472593344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:34:33.884671 140629472593344 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:34:33.900016 140629472593344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:34:33.910041 140629472593344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:34:33.916047 140629472593344 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:34:34.335829 140629472593344 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:34:34.351624 140629472593344 estimator.py:1147] Done calling model_fn.
I0812 18:34:37.777702 140629472593344 tpu_estimator.py:499] TPU job name worker
I0812 18:34:37.894438 140629472593344 monitored_session.py:240] Graph was finalized.
I0812 18:34:38.470860 140629472593344 session_manager.py:500] Running local_init_op.
I0812 18:34:38.502350 140629472593344 session_manager.py:502] Done running local_init_op.
I0812 18:34:40.933423 140629472593344 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:34:52.932585 140629472593344 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:34:53.057229 140629472593344 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:34:53.057671 140629472593344 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:34:53.058073: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:34:53.063754 140629472593344 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:34:53.066186 140629472593344 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:34:53.070307 140629472593344 tpu_estimator.py:557] Init TPU system
I0812 18:35:35.966411 140629472593344 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:35:35.967376 140628436449024 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:35:35.967840 140628428056320 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:35:36.037961 140629472593344 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:35:36.038856 140629472593344 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:35:36.059665 140628419663616 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:35:36.352653 140628419663616 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:35:40.416719 140628428056320 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:35:45.000791 140629472593344 basic_session_run_hooks.py:262] loss = 0.18790141, step = 30
I0812 18:35:45.003638 140629472593344 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:35:58.597538 140629472593344 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:35:58.597902 140629472593344 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:35:58.599406 140628436449024 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:35:58.599721 140628436449024 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:35:58.600007 140629472593344 error_handling.py:96] infeed marked as finished
I0812 18:35:58.600249 140629472593344 tpu_estimator.py:602] Stop output thread controller
I0812 18:35:58.600308 140629472593344 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:35:58.600476 140628428056320 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:35:58.600663 140628428056320 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:35:58.600867 140629472593344 error_handling.py:96] outfeed marked as finished
I0812 18:35:58.601061 140629472593344 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:36:06.488619 140629472593344 estimator.py:368] Loss for final step: 0.18790141.
I0812 18:36:06.489572 140629472593344 error_handling.py:96] training_loop marked as finished
I0812 18:36:07.210622 140629472593344 estimator.py:1145] Calling model_fn.
E0812 18:36:07.936470 140629472593344 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:36:08.170239 140629472593344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:36:08.193769 140629472593344 estimator.py:1147] Done calling model_fn.
I0812 18:36:08.210573 140629472593344 evaluation.py:255] Starting evaluation at 2019-08-12T18:36:08Z
I0812 18:36:08.210803 140629472593344 tpu_estimator.py:499] TPU job name worker
I0812 18:36:08.288734 140629472593344 monitored_session.py:240] Graph was finalized.
W0812 18:36:08.289457 140629472593344 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:36:08.494923 140629472593344 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:36:11.005400 140629472593344 session_manager.py:500] Running local_init_op.
I0812 18:36:11.034293 140629472593344 session_manager.py:502] Done running local_init_op.
I0812 18:36:11.083081 140629472593344 tpu_estimator.py:557] Init TPU system
I0812 18:37:20.043134 140629472593344 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:37:20.044194 140628428056320 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:37:20.044828 140628419663616 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:37:20.114168 140629472593344 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:37:20.141788 140629472593344 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:37:20.142172 140629472593344 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:37:20.172274 140628411270912 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:37:20.286912 140628411270912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:37:20.862998 140628419663616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:37:21.408185 140629472593344 evaluation.py:167] Evaluation [10/10]
I0812 18:37:21.408549 140629472593344 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:37:21.408620 140629472593344 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:37:21.408902 140628428056320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:37:21.409010 140628428056320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:37:21.409187 140629472593344 error_handling.py:96] infeed marked as finished
I0812 18:37:21.409291 140629472593344 tpu_estimator.py:602] Stop output thread controller
I0812 18:37:21.409343 140629472593344 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:37:21.409487 140628419663616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:37:21.409569 140628419663616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:37:21.409713 140629472593344 error_handling.py:96] outfeed marked as finished
I0812 18:37:21.409800 140629472593344 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:37:50.360385 140629472593344 evaluation.py:275] Finished evaluation at 2019-08-12-18:37:50
I0812 18:37:50.360722 140629472593344 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9573, global_step = 30, loss = 0.15802017
I0812 18:37:54.547944 140629472593344 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:37:55.337893 140629472593344 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.15802017, 'global_step': 30, 'accuracy': 0.9573}

Removing gs://yangyou-mnist/log/#1565634875898432...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565634888030807...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565634876.v3-8-tpu#1565634958279392...
Removing gs://yangyou-mnist/log/checkpoint#1565634954791454...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565634952633279...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565634892452053...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565634880373965...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565634951649310...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565634887188875...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565634957383270...
Removing gs://yangyou-mnist/log/eval/#1565635072014218...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565635072.v3-8-tpu#1565635075028441...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:37:59.126135 139752058897856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:37:59.127088 139752058897856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:37:59.129642 139752058897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:37:59.130536 139752058897856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:37:59.131143 139752058897856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:37:59.131272 139752058897856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:37:59.549094 139752058897856 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:37:59.556229 139752058897856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:37:59.560265 139752058897856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:37:59.615801 139752058897856 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:37:59.616100 139752058897856 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:37:59.727601 139752058897856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:37:59.773021 139752058897856 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:37:59.773319 139752058897856 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:37:59.971543 139752058897856 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1a69fd3050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1a6c1b0210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:37:59.971908 139752058897856 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:38:00.297833 139752058897856 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:38:00.300678: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:38:00.313091 139752058897856 tpu_system_metadata.py:148] Found TPU system:
I0812 18:38:00.313453 139752058897856 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:38:00.314074 139752058897856 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:38:00.314182 139752058897856 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:38:00.314253 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:38:00.314609 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:38:00.314677 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:38:00.314734 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:38:00.314790 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:38:00.314861 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:38:00.314913 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:38:00.314965 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:38:00.315017 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:38:00.315069 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:38:00.315130 139752058897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:38:00.322024 139752058897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:38:00.336519 139752058897856 estimator.py:1145] Calling model_fn.
W0812 18:38:00.337228 139752058897856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:38:00.610090 139752058897856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:38:01.028526 139752058897856 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:38:01.093493 139752058897856 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:38:01.107291 139752058897856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:38:01.300235 139752058897856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:38:01.314342 139752058897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:38:01.330576 139752058897856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:38:01.341274 139752058897856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:38:01.347465 139752058897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:38:01.787570 139752058897856 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:38:01.805473 139752058897856 estimator.py:1147] Done calling model_fn.
I0812 18:38:05.142978 139752058897856 tpu_estimator.py:499] TPU job name worker
I0812 18:38:05.265907 139752058897856 monitored_session.py:240] Graph was finalized.
I0812 18:38:05.831403 139752058897856 session_manager.py:500] Running local_init_op.
I0812 18:38:05.863878 139752058897856 session_manager.py:502] Done running local_init_op.
I0812 18:38:08.515909 139752058897856 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:38:20.696269 139752058897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:38:20.827980 139752058897856 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:38:20.828495 139752058897856 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:38:20.828884: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:38:20.833278 139752058897856 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:38:20.835608 139752058897856 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:38:20.840699 139752058897856 tpu_estimator.py:557] Init TPU system
I0812 18:39:04.019284 139752058897856 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 18:39:04.020239 139751164991232 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:39:04.020736 139751156598528 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:39:04.065092 139752058897856 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:39:04.066454 139752058897856 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:39:04.077195 139751148205824 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:39:04.185026 139751148205824 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 18:39:08.709748 139751156598528 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:39:13.183964 139752058897856 basic_session_run_hooks.py:262] loss = 0.18190545, step = 30
I0812 18:39:13.186429 139752058897856 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:39:27.213320 139752058897856 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:39:27.213613 139752058897856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:39:27.213982 139751164991232 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:39:27.214360 139751164991232 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:39:27.214597 139752058897856 error_handling.py:96] infeed marked as finished
I0812 18:39:27.214839 139752058897856 tpu_estimator.py:602] Stop output thread controller
I0812 18:39:27.214895 139752058897856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:39:27.215070 139751156598528 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:39:27.215243 139751156598528 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:39:27.215485 139752058897856 error_handling.py:96] outfeed marked as finished
I0812 18:39:27.215706 139752058897856 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:39:34.320914 139752058897856 estimator.py:368] Loss for final step: 0.18190545.
I0812 18:39:34.321784 139752058897856 error_handling.py:96] training_loop marked as finished
I0812 18:39:35.271514 139752058897856 estimator.py:1145] Calling model_fn.
E0812 18:39:35.967295 139752058897856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:39:36.188894 139752058897856 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:39:36.211920 139752058897856 estimator.py:1147] Done calling model_fn.
I0812 18:39:36.228593 139752058897856 evaluation.py:255] Starting evaluation at 2019-08-12T18:39:36Z
I0812 18:39:36.228825 139752058897856 tpu_estimator.py:499] TPU job name worker
I0812 18:39:36.305394 139752058897856 monitored_session.py:240] Graph was finalized.
W0812 18:39:36.306137 139752058897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:39:36.495660 139752058897856 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:39:39.099241 139752058897856 session_manager.py:500] Running local_init_op.
I0812 18:39:39.128756 139752058897856 session_manager.py:502] Done running local_init_op.
I0812 18:39:39.177572 139752058897856 tpu_estimator.py:557] Init TPU system
I0812 18:40:48.061363 139752058897856 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:40:48.062377 139751152928512 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:40:48.063224 139751139550976 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:40:48.126579 139752058897856 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:40:48.149756 139752058897856 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:40:48.150074 139752058897856 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:40:48.233599 139751131158272 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:40:48.472906 139751131158272 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:40:48.907752 139751139550976 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:40:49.337393 139752058897856 evaluation.py:167] Evaluation [10/10]
I0812 18:40:49.337739 139752058897856 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:40:49.337816 139752058897856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:40:49.338016 139751152928512 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:40:49.338130 139751152928512 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:40:49.338304 139752058897856 error_handling.py:96] infeed marked as finished
I0812 18:40:49.338398 139752058897856 tpu_estimator.py:602] Stop output thread controller
I0812 18:40:49.338448 139752058897856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:40:49.338567 139751139550976 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:40:49.338641 139751139550976 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:40:49.338762 139752058897856 error_handling.py:96] outfeed marked as finished
I0812 18:40:49.338848 139752058897856 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:41:18.570175 139752058897856 evaluation.py:275] Finished evaluation at 2019-08-12-18:41:18
I0812 18:41:18.570519 139752058897856 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9603, global_step = 30, loss = 0.12916066
I0812 18:41:23.969248 139752058897856 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:41:24.766763 139752058897856 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12916066, 'global_step': 30, 'accuracy': 0.9603}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565635095847204...
Removing gs://yangyou-mnist/log/#1565635083310514...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565635100210450...
Removing gs://yangyou-mnist/log/checkpoint#1565635163672775...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565635160463619...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565635083.v3-8-tpu#1565635166907583...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565635087969469...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565635161376599...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565635094938301...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565635165852202...
Removing gs://yangyou-mnist/log/eval/#1565635280695352...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565635280.v3-8-tpu#1565635284463300...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:41:28.594958 140306660468160 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:41:28.595758 140306660468160 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:41:28.598501 140306660468160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:41:28.599339 140306660468160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:41:28.599922 140306660468160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:41:28.600061 140306660468160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:41:29.018557 140306660468160 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:41:29.025693 140306660468160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:41:29.029705 140306660468160 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:41:29.079360 140306660468160 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:41:29.079668 140306660468160 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:41:29.274316 140306660468160 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:41:29.318890 140306660468160 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:41:29.319190 140306660468160 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:41:29.638763 140306660468160 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f9b8ad19090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f9b8cef6210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:41:29.639161 140306660468160 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:41:29.972198 140306660468160 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:41:29.975198: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:41:29.987190 140306660468160 tpu_system_metadata.py:148] Found TPU system:
I0812 18:41:29.987427 140306660468160 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:41:29.987926 140306660468160 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:41:29.987992 140306660468160 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:41:29.988044 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:41:29.988337 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:41:29.988394 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:41:29.988451 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:41:29.988503 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:41:29.988550 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:41:29.988596 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:41:29.988662 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:41:29.988711 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:41:29.988765 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:41:29.988817 140306660468160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:41:29.994966 140306660468160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:41:30.007730 140306660468160 estimator.py:1145] Calling model_fn.
W0812 18:41:30.008353 140306660468160 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:41:30.283688 140306660468160 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:41:30.715037 140306660468160 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:41:30.789639 140306660468160 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:41:30.795726 140306660468160 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:41:30.981081 140306660468160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:41:30.995021 140306660468160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:41:31.010520 140306660468160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:41:31.020766 140306660468160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:41:31.026855 140306660468160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:41:31.450512 140306660468160 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:41:31.466644 140306660468160 estimator.py:1147] Done calling model_fn.
I0812 18:41:35.019610 140306660468160 tpu_estimator.py:499] TPU job name worker
I0812 18:41:35.133907 140306660468160 monitored_session.py:240] Graph was finalized.
I0812 18:41:35.729125 140306660468160 session_manager.py:500] Running local_init_op.
I0812 18:41:35.768588 140306660468160 session_manager.py:502] Done running local_init_op.
I0812 18:41:38.383548 140306660468160 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:41:50.577316 140306660468160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:41:50.685235 140306660468160 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:41:50.685698 140306660468160 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:41:50.686109: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:41:50.690884 140306660468160 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:41:50.693324 140306660468160 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:41:50.697350 140306660468160 tpu_estimator.py:557] Init TPU system
I0812 18:42:32.057970 140306660468160 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 18:42:32.058995 140305760245504 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:42:32.059592 140305751852800 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:42:32.105570 140306660468160 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:42:32.106513 140306660468160 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:42:32.120923 140305743460096 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:42:32.484800 140305743460096 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:42:36.584820 140305751852800 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:42:40.987262 140306660468160 basic_session_run_hooks.py:262] loss = 0.12713091, step = 30
I0812 18:42:40.989711 140306660468160 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:42:54.561868 140306660468160 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:42:54.562251 140306660468160 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:42:54.562519 140305760245504 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:42:54.562668 140305760245504 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:42:54.562820 140306660468160 error_handling.py:96] infeed marked as finished
I0812 18:42:54.562925 140306660468160 tpu_estimator.py:602] Stop output thread controller
I0812 18:42:54.562974 140306660468160 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:42:54.563081 140305751852800 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:42:54.563158 140305751852800 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:42:54.563271 140306660468160 error_handling.py:96] outfeed marked as finished
I0812 18:42:54.563353 140306660468160 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:43:02.605125 140306660468160 estimator.py:368] Loss for final step: 0.12713091.
I0812 18:43:02.605958 140306660468160 error_handling.py:96] training_loop marked as finished
I0812 18:43:03.442496 140306660468160 estimator.py:1145] Calling model_fn.
E0812 18:43:04.138621 140306660468160 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:43:04.370524 140306660468160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:43:04.394021 140306660468160 estimator.py:1147] Done calling model_fn.
I0812 18:43:04.410917 140306660468160 evaluation.py:255] Starting evaluation at 2019-08-12T18:43:04Z
I0812 18:43:04.411163 140306660468160 tpu_estimator.py:499] TPU job name worker
I0812 18:43:04.488876 140306660468160 monitored_session.py:240] Graph was finalized.
W0812 18:43:04.489603 140306660468160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:43:04.684001 140306660468160 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:43:08.037142 140306660468160 session_manager.py:500] Running local_init_op.
I0812 18:43:08.061393 140306660468160 session_manager.py:502] Done running local_init_op.
I0812 18:43:08.108870 140306660468160 tpu_estimator.py:557] Init TPU system
I0812 18:44:15.986654 140306660468160 tpu_estimator.py:566] Initialized TPU in 67 seconds
I0812 18:44:15.987734 140305751852800 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:44:15.988738 140305743460096 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:44:16.056605 140306660468160 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:44:16.082300 140306660468160 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:44:16.082670 140306660468160 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:44:16.171458 140305735067392 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:44:16.452367 140305735067392 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:44:16.793596 140305743460096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:44:17.278384 140306660468160 evaluation.py:167] Evaluation [10/10]
I0812 18:44:17.278740 140306660468160 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:44:17.278816 140306660468160 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:44:17.279158 140305751852800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:44:17.279449 140305751852800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:44:17.279761 140306660468160 error_handling.py:96] infeed marked as finished
I0812 18:44:17.280071 140306660468160 tpu_estimator.py:602] Stop output thread controller
I0812 18:44:17.280142 140306660468160 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:44:17.280369 140305743460096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:44:17.280543 140305743460096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:44:17.280813 140306660468160 error_handling.py:96] outfeed marked as finished
I0812 18:44:17.280973 140306660468160 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:44:46.544462 140306660468160 evaluation.py:275] Finished evaluation at 2019-08-12-18:44:46
I0812 18:44:46.544821 140306660468160 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9663, global_step = 30, loss = 0.11108867
I0812 18:44:50.664973 140306660468160 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:44:51.506391 140306660468160 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.11108867, 'global_step': 30, 'accuracy': 0.9663}

Removing gs://yangyou-mnist/log/checkpoint#1565635370907262...
Removing gs://yangyou-mnist/log/#1565635293146312...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565635305783575...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565635293.v3-8-tpu#1565635374241643...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565635297833448...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565635310096190...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565635304928119...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565635367850236...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565635368776387...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565635373318889...
Removing gs://yangyou-mnist/log/eval/#1565635488152568...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565635488.v3-8-tpu#1565635491199490...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:44:55.437896 139860623168960 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:44:55.438760 139860623168960 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:44:55.441368 139860623168960 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:44:55.442363 139860623168960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:44:55.442987 139860623168960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:44:55.443114 139860623168960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:44:55.862500 139860623168960 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:44:55.871263 139860623168960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:44:55.875984 139860623168960 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:44:55.970506 139860623168960 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:44:55.970820 139860623168960 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:44:56.100284 139860623168960 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:44:56.154414 139860623168960 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:44:56.154726 139860623168960 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:44:56.329981 139860623168960 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f33b0ec8190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f33b30a5210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:44:56.330467 139860623168960 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:44:56.656954 139860623168960 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:44:56.659980: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:44:56.672746 139860623168960 tpu_system_metadata.py:148] Found TPU system:
I0812 18:44:56.673072 139860623168960 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:44:56.673573 139860623168960 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:44:56.673630 139860623168960 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:44:56.673685 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:44:56.673985 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:44:56.674043 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:44:56.674096 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:44:56.674185 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:44:56.674252 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:44:56.674300 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:44:56.674346 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:44:56.674407 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:44:56.674465 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:44:56.674515 139860623168960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:44:56.680533 139860623168960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:44:56.692964 139860623168960 estimator.py:1145] Calling model_fn.
W0812 18:44:56.693567 139860623168960 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:44:56.959454 139860623168960 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:44:57.383064 139860623168960 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:44:57.445003 139860623168960 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:44:57.451760 139860623168960 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:44:57.632447 139860623168960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:44:57.646563 139860623168960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:44:57.662014 139860623168960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:44:57.672310 139860623168960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:44:57.678503 139860623168960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:44:58.101785 139860623168960 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:44:58.117217 139860623168960 estimator.py:1147] Done calling model_fn.
I0812 18:45:01.367564 139860623168960 tpu_estimator.py:499] TPU job name worker
I0812 18:45:01.485788 139860623168960 monitored_session.py:240] Graph was finalized.
I0812 18:45:02.067147 139860623168960 session_manager.py:500] Running local_init_op.
I0812 18:45:02.106060 139860623168960 session_manager.py:502] Done running local_init_op.
I0812 18:45:04.727737 139860623168960 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:45:17.359750 139860623168960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:45:17.469393 139860623168960 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:45:17.469959 139860623168960 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:45:17.470436: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:45:17.475449 139860623168960 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:45:17.477857 139860623168960 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:45:17.482690 139860623168960 tpu_estimator.py:557] Init TPU system
I0812 18:46:00.037919 139860623168960 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:46:00.038940 139859863512832 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:46:00.039418 139859855120128 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:46:00.083916 139860623168960 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:46:00.084858 139860623168960 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:46:00.096410 139859368867584 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:46:00.283524 139859368867584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:46:04.509490 139859855120128 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:46:08.932327 139860623168960 basic_session_run_hooks.py:262] loss = 0.14544237, step = 30
I0812 18:46:08.934375 139860623168960 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:46:22.141037 139860623168960 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:46:22.141330 139860623168960 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:46:22.141557 139859863512832 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:46:22.141664 139859863512832 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:46:22.141807 139860623168960 error_handling.py:96] infeed marked as finished
I0812 18:46:22.141916 139860623168960 tpu_estimator.py:602] Stop output thread controller
I0812 18:46:22.141967 139860623168960 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:46:22.142081 139859855120128 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:46:22.142206 139859855120128 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:46:22.142335 139860623168960 error_handling.py:96] outfeed marked as finished
I0812 18:46:22.142424 139860623168960 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:46:30.392963 139860623168960 estimator.py:368] Loss for final step: 0.14544237.
I0812 18:46:30.393877 139860623168960 error_handling.py:96] training_loop marked as finished
I0812 18:46:31.234420 139860623168960 estimator.py:1145] Calling model_fn.
E0812 18:46:32.050966 139860623168960 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:46:32.288840 139860623168960 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:46:32.313325 139860623168960 estimator.py:1147] Done calling model_fn.
I0812 18:46:32.332588 139860623168960 evaluation.py:255] Starting evaluation at 2019-08-12T18:46:32Z
I0812 18:46:32.332844 139860623168960 tpu_estimator.py:499] TPU job name worker
I0812 18:46:32.420648 139860623168960 monitored_session.py:240] Graph was finalized.
W0812 18:46:32.421457 139860623168960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:46:32.609800 139860623168960 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:46:35.458906 139860623168960 session_manager.py:500] Running local_init_op.
I0812 18:46:35.482652 139860623168960 session_manager.py:502] Done running local_init_op.
I0812 18:46:35.541719 139860623168960 tpu_estimator.py:557] Init TPU system
I0812 18:47:44.018098 139860623168960 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:47:44.019540 139859859842816 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:47:44.020195 139859368867584 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:47:44.087280 139860623168960 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:47:44.111674 139860623168960 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:47:44.112111 139860623168960 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:47:44.148818 139859360474880 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:47:44.271143 139859360474880 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:47:44.898854 139859368867584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:47:45.215091 139860623168960 evaluation.py:167] Evaluation [10/10]
I0812 18:47:45.215476 139860623168960 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:47:45.215584 139860623168960 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:47:45.215841 139859859842816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:47:45.215998 139859859842816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:47:45.216209 139860623168960 error_handling.py:96] infeed marked as finished
I0812 18:47:45.216321 139860623168960 tpu_estimator.py:602] Stop output thread controller
I0812 18:47:45.216382 139860623168960 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:47:45.216550 139859368867584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:47:45.216644 139859368867584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:47:45.216866 139860623168960 error_handling.py:96] outfeed marked as finished
I0812 18:47:45.216969 139860623168960 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:48:14.354059 139860623168960 evaluation.py:275] Finished evaluation at 2019-08-12-18:48:14
I0812 18:48:14.354557 139860623168960 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9653, global_step = 30, loss = 0.13255568
I0812 18:48:18.654803 139860623168960 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:48:19.453700 139860623168960 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.13255568, 'global_step': 30, 'accuracy': 0.9653}

Removing gs://yangyou-mnist/log/#1565635499613936...
Removing gs://yangyou-mnist/log/checkpoint#1565635578756783...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565635504171228...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565635499.v3-8-tpu#1565635581834233...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565635512105555...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565635516873302...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565635575461592...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565635510996106...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565635576395872...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565635580906206...
Removing gs://yangyou-mnist/log/eval/#1565635696026021...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565635696.v3-8-tpu#1565635699141939...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:48:23.606718 139736715130304 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:48:23.607526 139736715130304 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:48:23.610272 139736715130304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:48:23.611156 139736715130304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:48:23.611759 139736715130304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:48:23.611891 139736715130304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:48:24.044064 139736715130304 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:48:24.052310 139736715130304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:48:24.057080 139736715130304 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:48:24.108211 139736715130304 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:48:24.108490 139736715130304 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:48:24.247915 139736715130304 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:48:24.292982 139736715130304 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:48:24.293309 139736715130304 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:48:24.575567 139736715130304 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f16d76de190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f16d98bb210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:48:24.576029 139736715130304 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:48:24.902829 139736715130304 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:48:24.905821: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:48:24.918215 139736715130304 tpu_system_metadata.py:148] Found TPU system:
I0812 18:48:24.918479 139736715130304 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:48:24.919014 139736715130304 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:48:24.919168 139736715130304 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:48:24.919254 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:48:24.919658 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:48:24.919723 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:48:24.919799 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:48:24.919856 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:48:24.919909 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:48:24.919964 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:48:24.920016 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:48:24.920068 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:48:24.920150 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:48:24.920206 139736715130304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:48:24.926964 139736715130304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:48:24.941297 139736715130304 estimator.py:1145] Calling model_fn.
W0812 18:48:24.941940 139736715130304 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:48:25.239132 139736715130304 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:48:25.788613 139736715130304 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:48:25.851443 139736715130304 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:48:25.857398 139736715130304 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:48:26.041429 139736715130304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:48:26.055824 139736715130304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:48:26.071438 139736715130304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:48:26.081835 139736715130304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:48:26.088135 139736715130304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:48:26.514007 139736715130304 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:48:26.532169 139736715130304 estimator.py:1147] Done calling model_fn.
I0812 18:48:29.904875 139736715130304 tpu_estimator.py:499] TPU job name worker
I0812 18:48:30.029675 139736715130304 monitored_session.py:240] Graph was finalized.
I0812 18:48:30.652507 139736715130304 session_manager.py:500] Running local_init_op.
I0812 18:48:30.684434 139736715130304 session_manager.py:502] Done running local_init_op.
I0812 18:48:33.280356 139736715130304 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:48:45.260945 139736715130304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:48:45.383219 139736715130304 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:48:45.383698 139736715130304 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:48:45.384147: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:48:45.388428 139736715130304 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:48:45.390793 139736715130304 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:48:45.394535 139736715130304 tpu_estimator.py:557] Init TPU system
I0812 18:49:28.069246 139736715130304 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:49:28.070416 139735686969088 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:49:28.070950 139735678576384 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:49:28.117518 139736715130304 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:49:28.118405 139736715130304 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:49:28.148186 139735670183680 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:49:28.380831 139735670183680 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 18:49:32.620408 139735678576384 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:49:37.174958 139736715130304 basic_session_run_hooks.py:262] loss = 0.08076357, step = 30
I0812 18:49:37.177155 139736715130304 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:49:50.455920 139736715130304 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:49:50.456206 139736715130304 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:49:50.456429 139735686969088 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:49:50.456532 139735686969088 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:49:50.456707 139736715130304 error_handling.py:96] infeed marked as finished
I0812 18:49:50.456855 139736715130304 tpu_estimator.py:602] Stop output thread controller
I0812 18:49:50.456912 139736715130304 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:49:50.457195 139735678576384 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:49:50.457330 139735678576384 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:49:50.457540 139736715130304 error_handling.py:96] outfeed marked as finished
I0812 18:49:50.457710 139736715130304 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:49:58.517690 139736715130304 estimator.py:368] Loss for final step: 0.08076357.
I0812 18:49:58.518659 139736715130304 error_handling.py:96] training_loop marked as finished
I0812 18:49:59.235023 139736715130304 estimator.py:1145] Calling model_fn.
E0812 18:49:59.917705 139736715130304 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:50:00.139988 139736715130304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:50:00.171530 139736715130304 estimator.py:1147] Done calling model_fn.
I0812 18:50:00.189058 139736715130304 evaluation.py:255] Starting evaluation at 2019-08-12T18:50:00Z
I0812 18:50:00.189342 139736715130304 tpu_estimator.py:499] TPU job name worker
I0812 18:50:00.269187 139736715130304 monitored_session.py:240] Graph was finalized.
W0812 18:50:00.269977 139736715130304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:50:00.464756 139736715130304 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:50:02.985018 139736715130304 session_manager.py:500] Running local_init_op.
I0812 18:50:03.009692 139736715130304 session_manager.py:502] Done running local_init_op.
I0812 18:50:03.055418 139736715130304 tpu_estimator.py:557] Init TPU system
I0812 18:51:12.007762 139736715130304 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:51:12.008905 139735674906368 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:51:12.009584 139735661528832 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:51:12.074672 139736715130304 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:51:12.098820 139736715130304 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:51:12.099179 139736715130304 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:51:12.132570 139735653136128 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:51:12.359446 139735653136128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:51:12.840594 139735661528832 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:51:13.192781 139736715130304 evaluation.py:167] Evaluation [10/10]
I0812 18:51:13.193116 139736715130304 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:51:13.193186 139736715130304 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:51:13.193361 139735674906368 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:51:13.193464 139735674906368 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:51:13.193591 139736715130304 error_handling.py:96] infeed marked as finished
I0812 18:51:13.193686 139736715130304 tpu_estimator.py:602] Stop output thread controller
I0812 18:51:13.193736 139736715130304 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:51:13.193844 139735661528832 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:51:13.194005 139735661528832 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:51:13.194130 139736715130304 error_handling.py:96] outfeed marked as finished
I0812 18:51:13.194245 139736715130304 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:51:42.454709 139736715130304 evaluation.py:275] Finished evaluation at 2019-08-12-18:51:42
I0812 18:51:42.455132 139736715130304 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9776, global_step = 30, loss = 0.07440722
I0812 18:51:46.695405 139736715130304 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:51:47.493371 139736715130304 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07440722, 'global_step': 30, 'accuracy': 0.9776}

Removing gs://yangyou-mnist/log/#1565635708014819...
Removing gs://yangyou-mnist/log/checkpoint#1565635786946285...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565635708.v3-8-tpu#1565635790098274...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565635720421828...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565635724786522...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565635783888343...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565635784709832...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565635712725510...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565635719561051...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565635789070181...
Removing gs://yangyou-mnist/log/eval/#1565635904163319...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565635904.v3-8-tpu#1565635907165076...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:51:51.334541 140681025529280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:51:51.335334 140681025529280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:51:51.337949 140681025529280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:51:51.338825 140681025529280 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:51:51.339561 140681025529280 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:51:51.339709 140681025529280 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:51:51.751722 140681025529280 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:51:51.760015 140681025529280 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:51:51.764568 140681025529280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:51:51.850347 140681025529280 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:51:51.850630 140681025529280 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:51:52.018831 140681025529280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:51:52.065803 140681025529280 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:51:52.066107 140681025529280 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:51:52.204010 140681025529280 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff2b4b71290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff2b6d4e210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:51:52.204391 140681025529280 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:51:52.540158 140681025529280 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:51:52.543114: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:51:52.556044 140681025529280 tpu_system_metadata.py:148] Found TPU system:
I0812 18:51:52.556286 140681025529280 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:51:52.556899 140681025529280 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:51:52.556962 140681025529280 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:51:52.557045 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:51:52.557370 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:51:52.557427 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:51:52.557487 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:51:52.557537 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:51:52.557584 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:51:52.557630 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:51:52.557676 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:51:52.557720 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:51:52.557766 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:51:52.557828 140681025529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:51:52.563749 140681025529280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:51:52.576127 140681025529280 estimator.py:1145] Calling model_fn.
W0812 18:51:52.576730 140681025529280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:51:52.836800 140681025529280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:51:53.479396 140681025529280 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:51:53.539570 140681025529280 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:51:53.545296 140681025529280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:51:53.719902 140681025529280 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:51:53.733092 140681025529280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:51:53.747710 140681025529280 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:51:53.757546 140681025529280 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:51:53.763434 140681025529280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:51:54.170249 140681025529280 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:51:54.185517 140681025529280 estimator.py:1147] Done calling model_fn.
I0812 18:51:57.456099 140681025529280 tpu_estimator.py:499] TPU job name worker
I0812 18:51:57.566684 140681025529280 monitored_session.py:240] Graph was finalized.
I0812 18:51:58.152793 140681025529280 session_manager.py:500] Running local_init_op.
I0812 18:51:58.183291 140681025529280 session_manager.py:502] Done running local_init_op.
I0812 18:52:00.623226 140681025529280 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:52:12.618035 140681025529280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:52:12.723800 140681025529280 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:52:12.724266 140681025529280 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:52:12.724658: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:52:12.729926 140681025529280 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:52:12.732297 140681025529280 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:52:12.736186 140681025529280 tpu_estimator.py:557] Init TPU system
I0812 18:52:56.046885 140681025529280 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 18:52:56.047944 140680265967360 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:52:56.048463 140680257574656 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:52:56.093943 140681025529280 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:52:56.094928 140681025529280 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:52:56.108345 140679774729984 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:52:56.313637 140679774729984 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 18:53:00.523341 140680257574656 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:53:05.141166 140681025529280 basic_session_run_hooks.py:262] loss = 2.302025, step = 30
I0812 18:53:05.143601 140681025529280 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:53:18.311712 140681025529280 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:53:18.312048 140681025529280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:53:18.312369 140680265967360 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:53:18.312676 140680265967360 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:53:18.312993 140681025529280 error_handling.py:96] infeed marked as finished
I0812 18:53:18.313261 140681025529280 tpu_estimator.py:602] Stop output thread controller
I0812 18:53:18.313345 140681025529280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:53:18.313606 140680257574656 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:53:18.313828 140680257574656 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:53:18.314047 140681025529280 error_handling.py:96] outfeed marked as finished
I0812 18:53:18.314243 140681025529280 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:53:26.445065 140681025529280 estimator.py:368] Loss for final step: 2.302025.
I0812 18:53:26.445919 140681025529280 error_handling.py:96] training_loop marked as finished
I0812 18:53:27.188364 140681025529280 estimator.py:1145] Calling model_fn.
E0812 18:53:27.893573 140681025529280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:53:28.124917 140681025529280 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:53:28.149465 140681025529280 estimator.py:1147] Done calling model_fn.
I0812 18:53:28.168142 140681025529280 evaluation.py:255] Starting evaluation at 2019-08-12T18:53:28Z
I0812 18:53:28.168385 140681025529280 tpu_estimator.py:499] TPU job name worker
I0812 18:53:28.250925 140681025529280 monitored_session.py:240] Graph was finalized.
W0812 18:53:28.251857 140681025529280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:53:28.444802 140681025529280 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:53:30.849183 140681025529280 session_manager.py:500] Running local_init_op.
I0812 18:53:30.874093 140681025529280 session_manager.py:502] Done running local_init_op.
I0812 18:53:30.921575 140681025529280 tpu_estimator.py:557] Init TPU system
I0812 18:54:39.995564 140681025529280 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 18:54:39.996380 140680262297344 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:54:39.996815 140679774729984 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:54:40.064285 140681025529280 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:54:40.091789 140681025529280 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:54:40.092134 140681025529280 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:54:40.165363 140679766337280 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:54:40.482759 140679766337280 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:54:40.839710 140679774729984 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:54:41.178704 140681025529280 evaluation.py:167] Evaluation [10/10]
I0812 18:54:41.179039 140681025529280 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:54:41.179110 140681025529280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:54:41.179362 140680262297344 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:54:41.179452 140680262297344 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:54:41.179584 140681025529280 error_handling.py:96] infeed marked as finished
I0812 18:54:41.179682 140681025529280 tpu_estimator.py:602] Stop output thread controller
I0812 18:54:41.179730 140681025529280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:54:41.179841 140679774729984 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:54:41.179913 140679774729984 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:54:41.180023 140681025529280 error_handling.py:96] outfeed marked as finished
I0812 18:54:41.180100 140681025529280 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:55:10.580439 140681025529280 evaluation.py:275] Finished evaluation at 2019-08-12-18:55:10
I0812 18:55:10.580811 140681025529280 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2991517
I0812 18:55:14.756025 140681025529280 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:55:15.618947 140681025529280 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2991517, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565635915669310...
Removing gs://yangyou-mnist/log/checkpoint#1565635994976018...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565635915.v3-8-tpu#1565635998002006...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565635927976066...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565635932125651...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565635992023318...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565635927128660...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565635992867875...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565635920069439...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565635997027221...
Removing gs://yangyou-mnist/log/eval/#1565636112215178...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565636112.v3-8-tpu#1565636115304824...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:55:19.475356 140406861161920 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:55:19.476126 140406861161920 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:55:19.478751 140406861161920 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:55:19.479559 140406861161920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:55:19.480143 140406861161920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:55:19.480268 140406861161920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:55:19.891623 140406861161920 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:55:19.898946 140406861161920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:55:19.903094 140406861161920 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:55:19.952899 140406861161920 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:55:19.953176 140406861161920 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:55:20.195689 140406861161920 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:55:20.248373 140406861161920 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:55:20.248656 140406861161920 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:55:20.443402 140406861161920 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb2df3ed290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb2e15ca210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:55:20.443847 140406861161920 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:55:20.774447 140406861161920 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:55:20.777342: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:55:20.790426 140406861161920 tpu_system_metadata.py:148] Found TPU system:
I0812 18:55:20.790746 140406861161920 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:55:20.791276 140406861161920 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:55:20.791336 140406861161920 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:55:20.791394 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:55:20.791695 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:55:20.791758 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:55:20.791817 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:55:20.791867 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:55:20.791917 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:55:20.791966 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:55:20.792013 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:55:20.792062 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:55:20.792108 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:55:20.792155 140406861161920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:55:20.798423 140406861161920 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:55:20.811479 140406861161920 estimator.py:1145] Calling model_fn.
W0812 18:55:20.812115 140406861161920 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:55:21.158065 140406861161920 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:55:21.747047 140406861161920 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:55:21.808581 140406861161920 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:55:21.814857 140406861161920 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:55:21.992748 140406861161920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:55:22.006304 140406861161920 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:55:22.021373 140406861161920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:55:22.031451 140406861161920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:55:22.037512 140406861161920 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:55:22.450640 140406861161920 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:55:22.466017 140406861161920 estimator.py:1147] Done calling model_fn.
I0812 18:55:25.729094 140406861161920 tpu_estimator.py:499] TPU job name worker
I0812 18:55:25.843113 140406861161920 monitored_session.py:240] Graph was finalized.
I0812 18:55:26.419581 140406861161920 session_manager.py:500] Running local_init_op.
I0812 18:55:26.453373 140406861161920 session_manager.py:502] Done running local_init_op.
I0812 18:55:28.996695 140406861161920 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:55:41.107791 140406861161920 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:55:41.232711 140406861161920 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:55:41.233287 140406861161920 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:55:41.233698: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:55:41.238523 140406861161920 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:55:41.240854 140406861161920 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:55:41.245110 140406861161920 tpu_estimator.py:557] Init TPU system
I0812 18:56:24.062553 140406861161920 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:56:24.063421 140405827954432 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:56:24.063896 140405819561728 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:56:24.110627 140406861161920 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:56:24.111543 140406861161920 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:56:24.126677 140405811169024 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:56:24.234944 140405811169024 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:56:28.609093 140405819561728 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:56:33.174582 140406861161920 basic_session_run_hooks.py:262] loss = 2.3020303, step = 30
I0812 18:56:33.177213 140406861161920 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 18:56:46.399025 140406861161920 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:56:46.399326 140406861161920 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:56:46.399621 140405827954432 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:56:46.399924 140405827954432 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:56:46.400191 140406861161920 error_handling.py:96] infeed marked as finished
I0812 18:56:46.400427 140406861161920 tpu_estimator.py:602] Stop output thread controller
I0812 18:56:46.400521 140406861161920 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:56:46.400693 140405819561728 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:56:46.400862 140405819561728 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:56:46.401037 140406861161920 error_handling.py:96] outfeed marked as finished
I0812 18:56:46.401329 140406861161920 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:56:54.372565 140406861161920 estimator.py:368] Loss for final step: 2.3020303.
I0812 18:56:54.373456 140406861161920 error_handling.py:96] training_loop marked as finished
I0812 18:56:55.060657 140406861161920 estimator.py:1145] Calling model_fn.
E0812 18:56:55.874671 140406861161920 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:56:56.095906 140406861161920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 18:56:56.121021 140406861161920 estimator.py:1147] Done calling model_fn.
I0812 18:56:56.139969 140406861161920 evaluation.py:255] Starting evaluation at 2019-08-12T18:56:56Z
I0812 18:56:56.140244 140406861161920 tpu_estimator.py:499] TPU job name worker
I0812 18:56:56.227833 140406861161920 monitored_session.py:240] Graph was finalized.
W0812 18:56:56.228624 140406861161920 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 18:56:56.423377 140406861161920 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 18:56:58.947382 140406861161920 session_manager.py:500] Running local_init_op.
I0812 18:56:58.971798 140406861161920 session_manager.py:502] Done running local_init_op.
I0812 18:56:59.016401 140406861161920 tpu_estimator.py:557] Init TPU system
I0812 18:58:08.015345 140406861161920 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 18:58:08.016283 140405819561728 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:58:08.016925 140405811169024 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:58:08.082046 140406861161920 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:58:08.108968 140406861161920 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 18:58:08.109318 140406861161920 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 18:58:08.183903 140405802776320 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:58:08.293406 140405802776320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:58:08.893742 140405811169024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 18:58:09.218555 140406861161920 evaluation.py:167] Evaluation [10/10]
I0812 18:58:09.218909 140406861161920 tpu_estimator.py:598] Stop infeed thread controller
I0812 18:58:09.218987 140406861161920 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 18:58:09.219240 140405819561728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 18:58:09.219352 140405819561728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 18:58:09.219528 140406861161920 error_handling.py:96] infeed marked as finished
I0812 18:58:09.219628 140406861161920 tpu_estimator.py:602] Stop output thread controller
I0812 18:58:09.219681 140406861161920 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 18:58:09.219827 140405811169024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 18:58:09.219907 140405811169024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 18:58:09.220051 140406861161920 error_handling.py:96] outfeed marked as finished
I0812 18:58:09.220149 140406861161920 tpu_estimator.py:606] Shutdown TPU system.
I0812 18:58:38.389236 140406861161920 evaluation.py:275] Finished evaluation at 2019-08-12-18:58:38
I0812 18:58:38.389589 140406861161920 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2996151
I0812 18:58:42.795443 140406861161920 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 18:58:43.668281 140406861161920 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2996151, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565636123929209...
Removing gs://yangyou-mnist/log/checkpoint#1565636202990143...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565636124.v3-8-tpu#1565636206096218...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565636136152493...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565636128427527...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565636140624894...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565636199940154...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565636200818912...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565636135324351...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565636205114389...
Removing gs://yangyou-mnist/log/eval/#1565636320116775...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565636320.v3-8-tpu#1565636323323423...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 18:58:47.564238 140575753512384 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 18:58:47.565026 140575753512384 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 18:58:47.567689 140575753512384 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 18:58:47.568531 140575753512384 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 18:58:47.569122 140575753512384 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 18:58:47.569247 140575753512384 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 18:58:47.978729 140575753512384 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 18:58:47.986119 140575753512384 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 18:58:47.990902 140575753512384 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:58:48.086568 140575753512384 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:58:48.086873 140575753512384 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:58:48.196842 140575753512384 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 18:58:48.242526 140575753512384 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 18:58:48.242830 140575753512384 transport.py:157] Attempting refresh to obtain initial access_token
I0812 18:58:48.362098 140575753512384 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fda32039090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fda34216210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 18:58:48.362560 140575753512384 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 18:58:48.678118 140575753512384 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 18:58:48.681255: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:58:48.693979 140575753512384 tpu_system_metadata.py:148] Found TPU system:
I0812 18:58:48.694292 140575753512384 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 18:58:48.694972 140575753512384 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 18:58:48.695045 140575753512384 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 18:58:48.695106 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 18:58:48.695449 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 18:58:48.695513 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 18:58:48.695579 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 18:58:48.695633 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 18:58:48.695688 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 18:58:48.695749 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 18:58:48.695811 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 18:58:48.695863 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 18:58:48.695918 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 18:58:48.695971 140575753512384 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 18:58:48.702558 140575753512384 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 18:58:48.716309 140575753512384 estimator.py:1145] Calling model_fn.
W0812 18:58:48.716984 140575753512384 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 18:58:49.029124 140575753512384 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 18:58:49.495517 140575753512384 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 18:58:49.557952 140575753512384 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 18:58:49.563942 140575753512384 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 18:58:49.743267 140575753512384 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 18:58:49.756951 140575753512384 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 18:58:49.772464 140575753512384 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 18:58:49.782752 140575753512384 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 18:58:49.788743 140575753512384 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 18:58:50.205636 140575753512384 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 18:58:50.221576 140575753512384 estimator.py:1147] Done calling model_fn.
I0812 18:58:53.464468 140575753512384 tpu_estimator.py:499] TPU job name worker
I0812 18:58:53.586360 140575753512384 monitored_session.py:240] Graph was finalized.
I0812 18:58:54.151577 140575753512384 session_manager.py:500] Running local_init_op.
I0812 18:58:54.191653 140575753512384 session_manager.py:502] Done running local_init_op.
I0812 18:58:56.670577 140575753512384 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 18:59:09.085839 140575753512384 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 18:59:09.208266 140575753512384 util.py:98] Initialized dataset iterators in 0 seconds
I0812 18:59:09.208724 140575753512384 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 18:59:09.209107: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 18:59:09.213579 140575753512384 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 18:59:09.216152 140575753512384 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 18:59:09.220510 140575753512384 tpu_estimator.py:557] Init TPU system
I0812 18:59:52.064305 140575753512384 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 18:59:52.065836 140574851319552 tpu_estimator.py:514] Starting infeed thread controller.
I0812 18:59:52.066343 140574842926848 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 18:59:52.111289 140575753512384 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 18:59:52.112198 140575753512384 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 18:59:52.172080 140574834534144 transport.py:157] Attempting refresh to obtain initial access_token
W0812 18:59:52.256958 140574834534144 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 18:59:56.575052 140574842926848 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:00:01.179853 140575753512384 basic_session_run_hooks.py:262] loss = 2.3028014, step = 30
I0812 19:00:01.182495 140575753512384 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:00:15.240984 140575753512384 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:00:15.241301 140575753512384 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:00:15.242711 140574851319552 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:00:15.242984 140574851319552 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:00:15.243323 140575753512384 error_handling.py:96] infeed marked as finished
I0812 19:00:15.243453 140575753512384 tpu_estimator.py:602] Stop output thread controller
I0812 19:00:15.243519 140575753512384 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:00:15.243635 140574842926848 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:00:15.243724 140574842926848 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:00:15.243835 140575753512384 error_handling.py:96] outfeed marked as finished
I0812 19:00:15.243915 140575753512384 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:00:22.389312 140575753512384 estimator.py:368] Loss for final step: 2.3028014.
I0812 19:00:22.390074 140575753512384 error_handling.py:96] training_loop marked as finished
I0812 19:00:23.192898 140575753512384 estimator.py:1145] Calling model_fn.
E0812 19:00:23.885777 140575753512384 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:00:24.110548 140575753512384 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:00:24.133865 140575753512384 estimator.py:1147] Done calling model_fn.
I0812 19:00:24.150317 140575753512384 evaluation.py:255] Starting evaluation at 2019-08-12T19:00:24Z
I0812 19:00:24.150572 140575753512384 tpu_estimator.py:499] TPU job name worker
I0812 19:00:24.228390 140575753512384 monitored_session.py:240] Graph was finalized.
W0812 19:00:24.229197 140575753512384 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:00:24.419203 140575753512384 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:00:26.933506 140575753512384 session_manager.py:500] Running local_init_op.
I0812 19:00:26.961581 140575753512384 session_manager.py:502] Done running local_init_op.
I0812 19:00:27.009824 140575753512384 tpu_estimator.py:557] Init TPU system
I0812 19:01:36.007736 140575753512384 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 19:01:36.008780 140574851319552 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:01:36.009417 140574842926848 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:01:36.073388 140575753512384 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:01:36.097162 140575753512384 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:01:36.097516 140575753512384 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:01:36.132591 140574834534144 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:01:36.221579 140574834534144 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:01:36.869508 140574842926848 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:01:37.167128 140575753512384 evaluation.py:167] Evaluation [10/10]
I0812 19:01:37.167484 140575753512384 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:01:37.167555 140575753512384 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:01:37.167790 140574851319552 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:01:37.167927 140574851319552 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:01:37.168075 140575753512384 error_handling.py:96] infeed marked as finished
I0812 19:01:37.168278 140575753512384 tpu_estimator.py:602] Stop output thread controller
I0812 19:01:37.168334 140575753512384 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:01:37.168453 140574842926848 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:01:37.168525 140574842926848 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:01:37.168641 140575753512384 error_handling.py:96] outfeed marked as finished
I0812 19:01:37.168720 140575753512384 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:02:06.318634 140575753512384 evaluation.py:275] Finished evaluation at 2019-08-12-19:02:06
I0812 19:02:06.319025 140575753512384 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2996094
I0812 19:02:10.555943 140575753512384 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:02:11.558698 140575753512384 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2996094, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565636331734082...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565636344127365...
Removing gs://yangyou-mnist/log/checkpoint#1565636411397975...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565636331.v3-8-tpu#1565636414887427...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565636348600483...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565636343190056...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565636336141750...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565636408269413...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565636409169938...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565636413944357...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565636528054695...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565636528.v3-8-tpu#1565636531184161...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:02:15.465718 139925930612160 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:02:15.466692 139925930612160 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:02:15.469558 139925930612160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:02:15.470509 139925930612160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:02:15.471168 139925930612160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:02:15.471311 139925930612160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:02:15.899162 139925930612160 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:02:15.907191 139925930612160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:02:15.911575 139925930612160 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:02:15.962914 139925930612160 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:02:15.963219 139925930612160 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:02:16.081295 139925930612160 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:02:16.129622 139925930612160 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:02:16.129919 139925930612160 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:02:16.208612 139925930612160 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f42e58d0090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f42e7aad1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:02:16.208988 139925930612160 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:02:16.562550 139925930612160 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:02:16.566331: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:02:16.580012 139925930612160 tpu_system_metadata.py:148] Found TPU system:
I0812 19:02:16.580293 139925930612160 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:02:16.580847 139925930612160 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:02:16.580913 139925930612160 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:02:16.580972 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:02:16.581425 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:02:16.581491 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:02:16.581549 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:02:16.581608 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:02:16.581662 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:02:16.581716 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:02:16.581768 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:02:16.581820 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:02:16.581873 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:02:16.581928 139925930612160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:02:16.588690 139925930612160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:02:16.602401 139925930612160 estimator.py:1145] Calling model_fn.
W0812 19:02:16.603085 139925930612160 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:02:16.870059 139925930612160 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:02:17.298649 139925930612160 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:02:17.359813 139925930612160 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:02:17.365953 139925930612160 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:02:17.546371 139925930612160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:02:17.559828 139925930612160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:02:17.574812 139925930612160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:02:17.584834 139925930612160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:02:17.590800 139925930612160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:02:18.010691 139925930612160 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:02:18.027985 139925930612160 estimator.py:1147] Done calling model_fn.
I0812 19:02:21.421403 139925930612160 tpu_estimator.py:499] TPU job name worker
I0812 19:02:21.538538 139925930612160 monitored_session.py:240] Graph was finalized.
I0812 19:02:22.139708 139925930612160 session_manager.py:500] Running local_init_op.
I0812 19:02:22.170442 139925930612160 session_manager.py:502] Done running local_init_op.
I0812 19:02:24.845782 139925930612160 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:02:37.493220 139925930612160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:02:37.609318 139925930612160 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:02:37.609780 139925930612160 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:02:37.610235: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:02:37.614506 139925930612160 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:02:37.616858 139925930612160 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:02:37.621455 139925930612160 tpu_estimator.py:557] Init TPU system
I0812 19:03:20.067939 139925930612160 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:03:20.068877 139925162538752 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:03:20.069497 139925154146048 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:03:20.115665 139925930612160 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:03:20.117001 139925930612160 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:03:20.126004 139925145753344 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:03:20.262130 139925145753344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:03:24.439075 139925154146048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:03:28.911900 139925930612160 basic_session_run_hooks.py:262] loss = 2.3024085, step = 30
I0812 19:03:28.913949 139925930612160 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:03:41.821135 139925930612160 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:03:41.821402 139925930612160 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:03:41.821616 139925162538752 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:03:41.821721 139925162538752 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:03:41.821855 139925930612160 error_handling.py:96] infeed marked as finished
I0812 19:03:41.821952 139925930612160 tpu_estimator.py:602] Stop output thread controller
I0812 19:03:41.822004 139925930612160 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:03:41.822112 139925154146048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:03:41.822232 139925154146048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:03:41.822350 139925930612160 error_handling.py:96] outfeed marked as finished
I0812 19:03:41.822438 139925930612160 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:03:50.389467 139925930612160 estimator.py:368] Loss for final step: 2.3024085.
I0812 19:03:50.390357 139925930612160 error_handling.py:96] training_loop marked as finished
I0812 19:03:51.136807 139925930612160 estimator.py:1145] Calling model_fn.
E0812 19:03:51.823220 139925930612160 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:03:52.046024 139925930612160 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:03:52.070728 139925930612160 estimator.py:1147] Done calling model_fn.
I0812 19:03:52.087899 139925930612160 evaluation.py:255] Starting evaluation at 2019-08-12T19:03:52Z
I0812 19:03:52.088135 139925930612160 tpu_estimator.py:499] TPU job name worker
I0812 19:03:52.172136 139925930612160 monitored_session.py:240] Graph was finalized.
W0812 19:03:52.172904 139925930612160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:03:52.367392 139925930612160 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:03:54.892812 139925930612160 session_manager.py:500] Running local_init_op.
I0812 19:03:54.921731 139925930612160 session_manager.py:502] Done running local_init_op.
I0812 19:03:54.968225 139925930612160 tpu_estimator.py:557] Init TPU system
I0812 19:05:04.001754 139925930612160 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 19:05:04.002844 139925162538752 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:05:04.003640 139925154146048 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:05:04.071434 139925930612160 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:05:04.098320 139925930612160 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:05:04.098715 139925930612160 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:05:04.171752 139925145753344 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:05:04.482017 139925145753344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:05:04.884967 139925154146048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:05:05.192826 139925930612160 evaluation.py:167] Evaluation [10/10]
I0812 19:05:05.193255 139925930612160 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:05:05.193347 139925930612160 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:05:05.193640 139925162538752 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:05:05.193998 139925162538752 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:05:05.194242 139925930612160 error_handling.py:96] infeed marked as finished
I0812 19:05:05.194453 139925930612160 tpu_estimator.py:602] Stop output thread controller
I0812 19:05:05.194519 139925930612160 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:05:05.194734 139925154146048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:05:05.195002 139925154146048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:05:05.195216 139925930612160 error_handling.py:96] outfeed marked as finished
I0812 19:05:05.195380 139925930612160 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:05:34.574999 139925930612160 evaluation.py:275] Finished evaluation at 2019-08-12-19:05:34
I0812 19:05:34.575375 139925930612160 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.299902
I0812 19:05:39.033458 139925930612160 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:05:39.817486 139925930612160 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.299902, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565636557003753...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565636552010429...
Removing gs://yangyou-mnist/log/#1565636539610086...
Removing gs://yangyou-mnist/log/checkpoint#1565636618457844...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565636616255714...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565636615356254...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565636544273239...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565636539.v3-8-tpu#1565636621513214...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565636551149859...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565636620590993...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565636736351247...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565636736.v3-8-tpu#1565636739508100...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:05:43.625361 140387531265472 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:05:43.626379 140387531265472 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:05:43.629034 140387531265472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:05:43.629854 140387531265472 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:05:43.630470 140387531265472 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:05:43.630604 140387531265472 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:05:44.044706 140387531265472 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:05:44.053946 140387531265472 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:05:44.058612 140387531265472 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:05:44.159430 140387531265472 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:05:44.159770 140387531265472 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:05:44.283723 140387531265472 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:05:44.381727 140387531265472 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:05:44.382046 140387531265472 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:05:44.508508 140387531265472 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fae5f180190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fae6135d210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:05:44.508889 140387531265472 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:05:44.832922 140387531265472 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:05:44.836441: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:05:44.849493 140387531265472 tpu_system_metadata.py:148] Found TPU system:
I0812 19:05:44.849752 140387531265472 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:05:44.850450 140387531265472 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:05:44.850513 140387531265472 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:05:44.850569 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:05:44.850903 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:05:44.850963 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:05:44.851013 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:05:44.851062 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:05:44.851109 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:05:44.851156 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:05:44.851202 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:05:44.851248 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:05:44.851294 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:05:44.851344 140387531265472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:05:44.857563 140387531265472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:05:44.870245 140387531265472 estimator.py:1145] Calling model_fn.
W0812 19:05:44.870877 140387531265472 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:05:45.150237 140387531265472 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:05:45.690648 140387531265472 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:05:45.753210 140387531265472 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:05:45.759439 140387531265472 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:05:45.941664 140387531265472 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:05:45.955708 140387531265472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:05:45.971014 140387531265472 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:05:45.981144 140387531265472 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:05:45.987097 140387531265472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:05:46.424640 140387531265472 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:05:46.440916 140387531265472 estimator.py:1147] Done calling model_fn.
I0812 19:05:49.842896 140387531265472 tpu_estimator.py:499] TPU job name worker
I0812 19:05:49.961313 140387531265472 monitored_session.py:240] Graph was finalized.
I0812 19:05:50.531455 140387531265472 session_manager.py:500] Running local_init_op.
I0812 19:05:50.564415 140387531265472 session_manager.py:502] Done running local_init_op.
I0812 19:05:53.184396 140387531265472 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:06:05.257539 140387531265472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:06:05.377170 140387531265472 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:06:05.377600 140387531265472 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:06:05.377970: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:06:05.383291 140387531265472 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:06:05.385634 140387531265472 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:06:05.390312 140387531265472 tpu_estimator.py:557] Init TPU system
I0812 19:06:48.064366 140387531265472 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:06:48.065522 140386500601600 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:06:48.066420 140386492208896 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:06:48.112232 140387531265472 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:06:48.113023 140387531265472 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:06:48.132462 140386483816192 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:06:48.364409 140386483816192 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:06:52.612884 140386492208896 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:06:57.041594 140387531265472 basic_session_run_hooks.py:262] loss = 1.0424572, step = 30
I0812 19:06:57.043728 140387531265472 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:07:10.639206 140387531265472 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:07:10.639492 140387531265472 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:07:10.639889 140386500601600 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:07:10.640197 140386500601600 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:07:10.640422 140387531265472 error_handling.py:96] infeed marked as finished
I0812 19:07:10.640633 140387531265472 tpu_estimator.py:602] Stop output thread controller
I0812 19:07:10.640727 140387531265472 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:07:10.640929 140386492208896 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:07:10.641088 140386492208896 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:07:10.641242 140387531265472 error_handling.py:96] outfeed marked as finished
I0812 19:07:10.641379 140387531265472 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:07:18.502454 140387531265472 estimator.py:368] Loss for final step: 1.0424572.
I0812 19:07:18.503365 140387531265472 error_handling.py:96] training_loop marked as finished
I0812 19:07:19.200359 140387531265472 estimator.py:1145] Calling model_fn.
E0812 19:07:19.880234 140387531265472 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:07:20.107924 140387531265472 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:07:20.131047 140387531265472 estimator.py:1147] Done calling model_fn.
I0812 19:07:20.147325 140387531265472 evaluation.py:255] Starting evaluation at 2019-08-12T19:07:20Z
I0812 19:07:20.147561 140387531265472 tpu_estimator.py:499] TPU job name worker
I0812 19:07:20.224406 140387531265472 monitored_session.py:240] Graph was finalized.
W0812 19:07:20.225151 140387531265472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:07:20.414311 140387531265472 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:07:22.999351 140387531265472 session_manager.py:500] Running local_init_op.
I0812 19:07:23.027515 140387531265472 session_manager.py:502] Done running local_init_op.
I0812 19:07:23.073641 140387531265472 tpu_estimator.py:557] Init TPU system
I0812 19:08:32.061192 140387531265472 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 19:08:32.062262 140386490898176 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:08:32.062836 140386482505472 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:08:32.126293 140387531265472 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:08:32.155822 140387531265472 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:08:32.156188 140387531265472 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:08:32.191348 140386474112768 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:08:32.296863 140386474112768 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:08:32.873462 140386482505472 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:08:33.380435 140387531265472 evaluation.py:167] Evaluation [10/10]
I0812 19:08:33.380786 140387531265472 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:08:33.380855 140387531265472 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:08:33.381221 140386490898176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:08:33.381331 140386490898176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:08:33.381517 140387531265472 error_handling.py:96] infeed marked as finished
I0812 19:08:33.381620 140387531265472 tpu_estimator.py:602] Stop output thread controller
I0812 19:08:33.381670 140387531265472 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:08:33.381814 140386482505472 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:08:33.381899 140386482505472 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:08:33.382050 140387531265472 error_handling.py:96] outfeed marked as finished
I0812 19:08:33.382174 140387531265472 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:09:02.376727 140387531265472 evaluation.py:275] Finished evaluation at 2019-08-12-19:09:02
I0812 19:09:02.377079 140387531265472 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8296, global_step = 30, loss = 0.94947356
I0812 19:09:06.600296 140387531265472 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:09:07.586052 140387531265472 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.94947356, 'global_step': 30, 'accuracy': 0.8296}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565636760255248...
Removing gs://yangyou-mnist/log/#1565636747960702...
Removing gs://yangyou-mnist/log/checkpoint#1565636827040949...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565636748.v3-8-tpu#1565636830314801...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565636764768070...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565636752646370...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565636759383731...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565636823946904...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565636824745923...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565636829350012...
Removing gs://yangyou-mnist/log/eval/#1565636944003018...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565636944.v3-8-tpu#1565636947279772...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:09:11.497473 140702083663296 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:09:11.498316 140702083663296 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:09:11.500929 140702083663296 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:09:11.501746 140702083663296 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:09:11.502446 140702083663296 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:09:11.502583 140702083663296 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:09:11.932073 140702083663296 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:09:11.940116 140702083663296 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:09:11.944782 140702083663296 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:09:11.995522 140702083663296 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:09:11.995815 140702083663296 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:09:12.143382 140702083663296 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:09:12.192229 140702083663296 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:09:12.192548 140702083663296 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:09:12.312669 140702083663296 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff79be0b050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff79dfe8210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:09:12.313085 140702083663296 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:09:12.643762 140702083663296 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:09:12.646877: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:09:12.664083 140702083663296 tpu_system_metadata.py:148] Found TPU system:
I0812 19:09:12.664335 140702083663296 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:09:12.664865 140702083663296 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:09:12.664932 140702083663296 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:09:12.665086 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:09:12.665443 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:09:12.665520 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:09:12.665577 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:09:12.665632 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:09:12.665685 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:09:12.665738 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:09:12.665791 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:09:12.665843 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:09:12.665894 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:09:12.665946 140702083663296 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:09:12.672673 140702083663296 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:09:12.686465 140702083663296 estimator.py:1145] Calling model_fn.
W0812 19:09:12.687140 140702083663296 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:09:12.980254 140702083663296 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:09:13.392131 140702083663296 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:09:13.452491 140702083663296 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:09:13.458311 140702083663296 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:09:13.633091 140702083663296 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:09:13.646544 140702083663296 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:09:13.661237 140702083663296 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:09:13.671410 140702083663296 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:09:13.677267 140702083663296 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:09:14.091649 140702083663296 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:09:14.107436 140702083663296 estimator.py:1147] Done calling model_fn.
I0812 19:09:17.487548 140702083663296 tpu_estimator.py:499] TPU job name worker
I0812 19:09:17.603663 140702083663296 monitored_session.py:240] Graph was finalized.
I0812 19:09:18.173352 140702083663296 session_manager.py:500] Running local_init_op.
I0812 19:09:18.204526 140702083663296 session_manager.py:502] Done running local_init_op.
I0812 19:09:20.897962 140702083663296 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:09:32.654176 140702083663296 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:09:32.802066 140702083663296 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:09:32.802587 140702083663296 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:09:32.802986: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:09:32.807879 140702083663296 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:09:32.810194 140702083663296 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:09:32.814400 140702083663296 tpu_estimator.py:557] Init TPU system
I0812 19:10:15.962198 140702083663296 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 19:10:15.963360 140701048239872 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:10:15.964236 140701039847168 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:10:16.010445 140702083663296 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:10:16.011338 140702083663296 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:10:16.056535 140701031454464 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:10:16.175653 140701031454464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:10:20.321446 140701039847168 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:10:24.593592 140702083663296 basic_session_run_hooks.py:262] loss = 0.5249178, step = 30
I0812 19:10:24.596252 140702083663296 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:10:38.072563 140702083663296 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:10:38.072854 140702083663296 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:10:38.073214 140701048239872 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:10:38.073347 140701048239872 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:10:38.073508 140702083663296 error_handling.py:96] infeed marked as finished
I0812 19:10:38.073616 140702083663296 tpu_estimator.py:602] Stop output thread controller
I0812 19:10:38.073674 140702083663296 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:10:38.073805 140701039847168 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:10:38.073892 140701039847168 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:10:38.074028 140702083663296 error_handling.py:96] outfeed marked as finished
I0812 19:10:38.074120 140702083663296 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:10:46.315853 140702083663296 estimator.py:368] Loss for final step: 0.5249178.
I0812 19:10:46.316689 140702083663296 error_handling.py:96] training_loop marked as finished
I0812 19:10:47.086186 140702083663296 estimator.py:1145] Calling model_fn.
E0812 19:10:47.780889 140702083663296 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:10:48.010200 140702083663296 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:10:48.033916 140702083663296 estimator.py:1147] Done calling model_fn.
I0812 19:10:48.052803 140702083663296 evaluation.py:255] Starting evaluation at 2019-08-12T19:10:48Z
I0812 19:10:48.053056 140702083663296 tpu_estimator.py:499] TPU job name worker
I0812 19:10:48.140577 140702083663296 monitored_session.py:240] Graph was finalized.
W0812 19:10:48.141371 140702083663296 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:10:48.328675 140702083663296 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:10:50.821808 140702083663296 session_manager.py:500] Running local_init_op.
I0812 19:10:50.850610 140702083663296 session_manager.py:502] Done running local_init_op.
I0812 19:10:50.897721 140702083663296 tpu_estimator.py:557] Init TPU system
I0812 19:11:59.977298 140702083663296 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 19:11:59.978339 140701048239872 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:11:59.978735 140701039847168 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:12:00.042644 140702083663296 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:12:00.067987 140702083663296 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:12:00.068382 140702083663296 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:12:00.101643 140701031454464 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:12:00.214991 140701031454464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:12:00.819334 140701039847168 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:12:01.233599 140702083663296 evaluation.py:167] Evaluation [10/10]
I0812 19:12:01.234030 140702083663296 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:12:01.234132 140702083663296 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:12:01.234380 140701048239872 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:12:01.234481 140701048239872 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:12:01.234639 140702083663296 error_handling.py:96] infeed marked as finished
I0812 19:12:01.234744 140702083663296 tpu_estimator.py:602] Stop output thread controller
I0812 19:12:01.234798 140702083663296 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:12:01.234930 140701039847168 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:12:01.235008 140701039847168 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:12:01.235141 140702083663296 error_handling.py:96] outfeed marked as finished
I0812 19:12:01.235235 140702083663296 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:12:30.307853 140702083663296 evaluation.py:275] Finished evaluation at 2019-08-12-19:12:30
I0812 19:12:30.308192 140702083663296 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8739, global_step = 30, loss = 0.49814972
I0812 19:12:34.639635 140702083663296 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:12:35.463519 140702083663296 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.49814972, 'global_step': 30, 'accuracy': 0.8739}

Removing gs://yangyou-mnist/log/#1565636955654676...
Removing gs://yangyou-mnist/log/checkpoint#1565637034523130...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565636967891574...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565637031325403...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565637032231355...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565636972161969...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565636955.v3-8-tpu#1565637037761688...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565636960336458...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565636966951907...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565637036838327...
Removing gs://yangyou-mnist/log/eval/#1565637152049368...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565637152.v3-8-tpu#1565637155142051...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:12:39.361865 139708178150848 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:12:39.362767 139708178150848 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:12:39.365396 139708178150848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:12:39.366367 139708178150848 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:12:39.366998 139708178150848 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:12:39.367130 139708178150848 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:12:39.769839 139708178150848 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:12:39.777662 139708178150848 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:12:39.782444 139708178150848 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:12:39.874778 139708178150848 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:12:39.875093 139708178150848 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:12:40.124831 139708178150848 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:12:40.174653 139708178150848 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:12:40.174959 139708178150848 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:12:40.391391 139708178150848 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f10327e2210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f10349bf210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:12:40.391771 139708178150848 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:12:40.719170 139708178150848 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:12:40.722187: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:12:40.734112 139708178150848 tpu_system_metadata.py:148] Found TPU system:
I0812 19:12:40.734373 139708178150848 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:12:40.734869 139708178150848 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:12:40.734925 139708178150848 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:12:40.735059 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:12:40.735392 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:12:40.735447 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:12:40.735502 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:12:40.735551 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:12:40.735598 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:12:40.735645 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:12:40.735691 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:12:40.735737 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:12:40.735781 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:12:40.735836 139708178150848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:12:40.741633 139708178150848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:12:40.753998 139708178150848 estimator.py:1145] Calling model_fn.
W0812 19:12:40.754652 139708178150848 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:12:41.022299 139708178150848 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:12:41.582137 139708178150848 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:12:41.644638 139708178150848 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:12:41.651005 139708178150848 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:12:41.829277 139708178150848 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:12:41.842767 139708178150848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:12:41.857701 139708178150848 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:12:41.867639 139708178150848 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:12:41.873553 139708178150848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:12:42.298794 139708178150848 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:12:42.314471 139708178150848 estimator.py:1147] Done calling model_fn.
I0812 19:12:45.550313 139708178150848 tpu_estimator.py:499] TPU job name worker
I0812 19:12:45.664818 139708178150848 monitored_session.py:240] Graph was finalized.
I0812 19:12:46.277163 139708178150848 session_manager.py:500] Running local_init_op.
I0812 19:12:46.317370 139708178150848 session_manager.py:502] Done running local_init_op.
I0812 19:12:48.707875 139708178150848 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:13:00.994657 139708178150848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:13:01.104671 139708178150848 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:13:01.105211 139708178150848 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:13:01.105618: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:13:01.110069 139708178150848 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:13:01.112799 139708178150848 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:13:01.117537 139708178150848 tpu_estimator.py:557] Init TPU system
I0812 19:13:44.030790 139708178150848 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:13:44.031856 139707283396352 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:13:44.032371 139707275003648 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:13:44.078042 139708178150848 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:13:44.079544 139708178150848 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:13:44.090075 139707266610944 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:13:44.188723 139707266610944 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:13:48.564496 139707275003648 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:13:53.010586 139708178150848 basic_session_run_hooks.py:262] loss = 0.3493648, step = 30
I0812 19:13:53.012842 139708178150848 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:14:06.452040 139708178150848 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:14:06.452388 139708178150848 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:14:06.452693 139707283396352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:14:06.453012 139707283396352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:14:06.453358 139708178150848 error_handling.py:96] infeed marked as finished
I0812 19:14:06.453596 139708178150848 tpu_estimator.py:602] Stop output thread controller
I0812 19:14:06.453655 139708178150848 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:14:06.453775 139707275003648 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:14:06.453839 139707275003648 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:14:06.454024 139708178150848 error_handling.py:96] outfeed marked as finished
I0812 19:14:06.454090 139708178150848 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:14:14.324718 139708178150848 estimator.py:368] Loss for final step: 0.3493648.
I0812 19:14:14.325753 139708178150848 error_handling.py:96] training_loop marked as finished
I0812 19:14:15.099028 139708178150848 estimator.py:1145] Calling model_fn.
E0812 19:14:15.785625 139708178150848 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:14:16.007242 139708178150848 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:14:16.030369 139708178150848 estimator.py:1147] Done calling model_fn.
I0812 19:14:16.046796 139708178150848 evaluation.py:255] Starting evaluation at 2019-08-12T19:14:16Z
I0812 19:14:16.047029 139708178150848 tpu_estimator.py:499] TPU job name worker
I0812 19:14:16.123245 139708178150848 monitored_session.py:240] Graph was finalized.
W0812 19:14:16.123946 139708178150848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:14:16.308641 139708178150848 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:14:18.893189 139708178150848 session_manager.py:500] Running local_init_op.
I0812 19:14:18.916989 139708178150848 session_manager.py:502] Done running local_init_op.
I0812 19:14:18.969433 139708178150848 tpu_estimator.py:557] Init TPU system
I0812 19:15:28.015111 139708178150848 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 19:15:28.016138 139707271857920 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:15:28.016520 139707263465216 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:15:28.079869 139708178150848 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:15:28.103209 139708178150848 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:15:28.103564 139708178150848 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:15:28.176716 139707255072512 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:15:28.276813 139707255072512 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:15:28.871551 139707263465216 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:15:29.185609 139708178150848 evaluation.py:167] Evaluation [10/10]
I0812 19:15:29.185975 139708178150848 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:15:29.186052 139708178150848 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:15:29.186379 139707271857920 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:15:29.186484 139707271857920 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:15:29.186628 139708178150848 error_handling.py:96] infeed marked as finished
I0812 19:15:29.186741 139708178150848 tpu_estimator.py:602] Stop output thread controller
I0812 19:15:29.186795 139708178150848 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:15:29.186916 139707263465216 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:15:29.186995 139707263465216 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:15:29.187124 139708178150848 error_handling.py:96] outfeed marked as finished
I0812 19:15:29.187211 139708178150848 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:15:58.373441 139708178150848 evaluation.py:275] Finished evaluation at 2019-08-12-19:15:58
I0812 19:15:58.373759 139708178150848 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9182, global_step = 30, loss = 0.35499638
I0812 19:16:02.645692 139708178150848 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:16:03.495433 139708178150848 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.35499638, 'global_step': 30, 'accuracy': 0.9182}

Removing gs://yangyou-mnist/log/#1565637163818306...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565637163.v3-8-tpu#1565637246145035...
Removing gs://yangyou-mnist/log/checkpoint#1565637242716781...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565637239563918...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565637168164712...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565637240425222...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565637175283707...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565637180511319...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565637176162309...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565637245221666...
Removing gs://yangyou-mnist/log/eval/#1565637359989998...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565637360.v3-8-tpu#1565637363177552...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:16:07.301271 140035406472640 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:16:07.302063 140035406472640 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:16:07.304858 140035406472640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:16:07.305694 140035406472640 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:16:07.306345 140035406472640 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:16:07.306489 140035406472640 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:16:07.725431 140035406472640 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:16:07.733016 140035406472640 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:16:07.737565 140035406472640 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:16:07.832849 140035406472640 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:16:07.833125 140035406472640 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:16:08.020108 140035406472640 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:16:08.067910 140035406472640 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:16:08.068209 140035406472640 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:16:08.228178 140035406472640 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5c62d210d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5c64efe210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:16:08.228545 140035406472640 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:16:08.582493 140035406472640 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:16:08.585479: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:16:08.597832 140035406472640 tpu_system_metadata.py:148] Found TPU system:
I0812 19:16:08.598107 140035406472640 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:16:08.598685 140035406472640 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:16:08.598746 140035406472640 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:16:08.598799 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:16:08.599091 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:16:08.599147 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:16:08.599198 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:16:08.599246 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:16:08.599293 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:16:08.599340 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:16:08.599390 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:16:08.599437 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:16:08.599493 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:16:08.599541 140035406472640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:16:08.605504 140035406472640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:16:08.617842 140035406472640 estimator.py:1145] Calling model_fn.
W0812 19:16:08.618489 140035406472640 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:16:08.893193 140035406472640 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:16:09.476234 140035406472640 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:16:09.538304 140035406472640 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:16:09.544234 140035406472640 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:16:09.722896 140035406472640 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:16:09.736617 140035406472640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:16:09.752007 140035406472640 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:16:09.762207 140035406472640 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:16:09.768276 140035406472640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:16:10.186116 140035406472640 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:16:10.202270 140035406472640 estimator.py:1147] Done calling model_fn.
I0812 19:16:13.425600 140035406472640 tpu_estimator.py:499] TPU job name worker
I0812 19:16:13.539824 140035406472640 monitored_session.py:240] Graph was finalized.
I0812 19:16:14.094568 140035406472640 session_manager.py:500] Running local_init_op.
I0812 19:16:14.128422 140035406472640 session_manager.py:502] Done running local_init_op.
I0812 19:16:16.536243 140035406472640 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:16:28.488532 140035406472640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:16:28.593636 140035406472640 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:16:28.594101 140035406472640 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:16:28.594524: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:16:28.599251 140035406472640 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:16:28.601680 140035406472640 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:16:28.605564 140035406472640 tpu_estimator.py:557] Init TPU system
I0812 19:17:12.088133 140035406472640 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 19:17:12.089234 140034506217216 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:17:12.089776 140034497824512 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:17:12.134938 140035406472640 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:17:12.135904 140035406472640 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:17:12.194578 140034489431808 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:17:12.286928 140034489431808 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 19:17:16.653327 140034497824512 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:17:21.204715 140035406472640 basic_session_run_hooks.py:262] loss = 0.28010747, step = 30
I0812 19:17:21.207168 140035406472640 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:17:34.277590 140035406472640 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:17:34.277900 140035406472640 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:17:34.278132 140034506217216 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:17:34.278312 140034506217216 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:17:34.278501 140035406472640 error_handling.py:96] infeed marked as finished
I0812 19:17:34.278610 140035406472640 tpu_estimator.py:602] Stop output thread controller
I0812 19:17:34.278667 140035406472640 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:17:34.278789 140034497824512 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:17:34.278879 140034497824512 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:17:34.279000 140035406472640 error_handling.py:96] outfeed marked as finished
I0812 19:17:34.279107 140035406472640 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:17:42.420736 140035406472640 estimator.py:368] Loss for final step: 0.28010747.
I0812 19:17:42.421590 140035406472640 error_handling.py:96] training_loop marked as finished
I0812 19:17:43.215616 140035406472640 estimator.py:1145] Calling model_fn.
E0812 19:17:43.907607 140035406472640 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:17:44.136857 140035406472640 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:17:44.160041 140035406472640 estimator.py:1147] Done calling model_fn.
I0812 19:17:44.179454 140035406472640 evaluation.py:255] Starting evaluation at 2019-08-12T19:17:44Z
I0812 19:17:44.179711 140035406472640 tpu_estimator.py:499] TPU job name worker
I0812 19:17:44.266021 140035406472640 monitored_session.py:240] Graph was finalized.
W0812 19:17:44.266792 140035406472640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:17:44.449907 140035406472640 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:17:46.885325 140035406472640 session_manager.py:500] Running local_init_op.
I0812 19:17:46.913996 140035406472640 session_manager.py:502] Done running local_init_op.
I0812 19:17:46.965435 140035406472640 tpu_estimator.py:557] Init TPU system
I0812 19:18:56.045773 140035406472640 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 19:18:56.046921 140034497824512 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:18:56.047756 140034489431808 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:18:56.113725 140035406472640 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:18:56.139828 140035406472640 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:18:56.140259 140035406472640 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:18:56.175040 140034481039104 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:18:56.378458 140034481039104 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:18:56.908610 140034489431808 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:18:57.259299 140035406472640 evaluation.py:167] Evaluation [10/10]
I0812 19:18:57.259630 140035406472640 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:18:57.259718 140035406472640 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:18:57.260006 140034497824512 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:18:57.260112 140034497824512 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:18:57.260286 140035406472640 error_handling.py:96] infeed marked as finished
I0812 19:18:57.260389 140035406472640 tpu_estimator.py:602] Stop output thread controller
I0812 19:18:57.260437 140035406472640 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:18:57.260577 140034489431808 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:18:57.260657 140034489431808 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:18:57.260812 140035406472640 error_handling.py:96] outfeed marked as finished
I0812 19:18:57.260904 140035406472640 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:19:26.476825 140035406472640 evaluation.py:275] Finished evaluation at 2019-08-12-19:19:26
I0812 19:19:26.477255 140035406472640 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9338, global_step = 30, loss = 0.26204288
I0812 19:19:30.762558 140035406472640 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:19:31.556286 140035406472640 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.26204288, 'global_step': 30, 'accuracy': 0.9338}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565637383726850...
Removing gs://yangyou-mnist/log/checkpoint#1565637450893689...
Removing gs://yangyou-mnist/log/#1565637371712665...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565637448674362...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565637376000714...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565637447848130...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565637371.v3-8-tpu#1565637453948432...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565637387999585...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565637382884003...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565637453010269...
Removing gs://yangyou-mnist/log/eval/#1565637568154446...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565637568.v3-8-tpu#1565637571242801...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:19:35.423558 140629984839104 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:19:35.424365 140629984839104 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:19:35.427136 140629984839104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:19:35.427975 140629984839104 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:19:35.428585 140629984839104 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:19:35.428711 140629984839104 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:19:35.853053 140629984839104 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:19:35.861027 140629984839104 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:19:35.865456 140629984839104 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:19:35.951174 140629984839104 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:19:35.951464 140629984839104 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:19:36.075984 140629984839104 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:19:36.124171 140629984839104 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:19:36.124495 140629984839104 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:19:36.230273 140629984839104 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe6d273f110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe6d491c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:19:36.230669 140629984839104 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:19:36.573204 140629984839104 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:19:36.576304: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:19:36.590565 140629984839104 tpu_system_metadata.py:148] Found TPU system:
I0812 19:19:36.590797 140629984839104 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:19:36.591407 140629984839104 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:19:36.591466 140629984839104 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:19:36.591550 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:19:36.591877 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:19:36.591933 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:19:36.591990 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:19:36.592039 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:19:36.592084 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:19:36.592130 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:19:36.592176 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:19:36.592222 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:19:36.592267 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:19:36.592314 140629984839104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:19:36.598359 140629984839104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:19:36.610677 140629984839104 estimator.py:1145] Calling model_fn.
W0812 19:19:36.611304 140629984839104 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:19:36.903132 140629984839104 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:19:37.489094 140629984839104 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:19:37.551291 140629984839104 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:19:37.557306 140629984839104 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:19:37.739805 140629984839104 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:19:37.753762 140629984839104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:19:37.769295 140629984839104 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:19:37.779634 140629984839104 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:19:37.785684 140629984839104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:19:38.207254 140629984839104 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:19:38.222728 140629984839104 estimator.py:1147] Done calling model_fn.
I0812 19:19:41.609999 140629984839104 tpu_estimator.py:499] TPU job name worker
I0812 19:19:41.725181 140629984839104 monitored_session.py:240] Graph was finalized.
I0812 19:19:42.295790 140629984839104 session_manager.py:500] Running local_init_op.
I0812 19:19:42.336730 140629984839104 session_manager.py:502] Done running local_init_op.
I0812 19:19:44.826284 140629984839104 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:19:57.034261 140629984839104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:19:57.144294 140629984839104 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:19:57.144726 140629984839104 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:19:57.145176: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:19:57.150327 140629984839104 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:19:57.152769 140629984839104 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:19:57.158382 140629984839104 tpu_estimator.py:557] Init TPU system
I0812 19:20:40.036132 140629984839104 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:20:40.037015 140629090752256 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:20:40.037492 140629082359552 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:20:40.082529 140629984839104 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:20:40.083841 140629984839104 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:20:40.094594 140629073966848 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:20:40.212316 140629073966848 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 19:20:44.520788 140629082359552 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:20:48.938771 140629984839104 basic_session_run_hooks.py:262] loss = 0.25026065, step = 30
I0812 19:20:48.941286 140629984839104 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:21:02.056346 140629984839104 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:21:02.056680 140629984839104 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:21:02.057051 140629090752256 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:21:02.057449 140629090752256 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:21:02.057708 140629984839104 error_handling.py:96] infeed marked as finished
I0812 19:21:02.057995 140629984839104 tpu_estimator.py:602] Stop output thread controller
I0812 19:21:02.058074 140629984839104 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:21:02.058334 140629082359552 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:21:02.058549 140629082359552 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:21:02.058801 140629984839104 error_handling.py:96] outfeed marked as finished
I0812 19:21:02.058984 140629984839104 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:21:10.344571 140629984839104 estimator.py:368] Loss for final step: 0.25026065.
I0812 19:21:10.345438 140629984839104 error_handling.py:96] training_loop marked as finished
I0812 19:21:11.020908 140629984839104 estimator.py:1145] Calling model_fn.
E0812 19:21:11.731278 140629984839104 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:21:11.956310 140629984839104 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:21:11.979361 140629984839104 estimator.py:1147] Done calling model_fn.
I0812 19:21:11.998034 140629984839104 evaluation.py:255] Starting evaluation at 2019-08-12T19:21:11Z
I0812 19:21:11.998330 140629984839104 tpu_estimator.py:499] TPU job name worker
I0812 19:21:12.084914 140629984839104 monitored_session.py:240] Graph was finalized.
W0812 19:21:12.085660 140629984839104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:21:12.271076 140629984839104 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:21:14.827605 140629984839104 session_manager.py:500] Running local_init_op.
I0812 19:21:14.850752 140629984839104 session_manager.py:502] Done running local_init_op.
I0812 19:21:14.905426 140629984839104 tpu_estimator.py:557] Init TPU system
I0812 19:22:23.994292 140629984839104 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 19:22:23.995116 140629078689536 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:22:23.995547 140629070296832 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:22:24.064163 140629984839104 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:22:24.089333 140629984839104 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:22:24.089699 140629984839104 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:22:24.121653 140629061904128 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:22:24.217111 140629061904128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:22:24.861695 140629070296832 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:22:25.149784 140629984839104 evaluation.py:167] Evaluation [10/10]
I0812 19:22:25.150219 140629984839104 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:22:25.150314 140629984839104 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:22:25.150497 140629078689536 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:22:25.150584 140629078689536 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:22:25.150748 140629984839104 error_handling.py:96] infeed marked as finished
I0812 19:22:25.150856 140629984839104 tpu_estimator.py:602] Stop output thread controller
I0812 19:22:25.150908 140629984839104 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:22:25.151016 140629070296832 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:22:25.151089 140629070296832 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:22:25.151205 140629984839104 error_handling.py:96] outfeed marked as finished
I0812 19:22:25.151281 140629984839104 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:22:54.319652 140629984839104 evaluation.py:275] Finished evaluation at 2019-08-12-19:22:54
I0812 19:22:54.320015 140629984839104 estimator.py:2039] Saving dict for global step 30: accuracy = 0.938, global_step = 30, loss = 0.2481567
I0812 19:22:58.595041 140629984839104 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:22:59.425456 140629984839104 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.2481567, 'global_step': 30, 'accuracy': 0.938}

Removing gs://yangyou-mnist/log/#1565637579777415...
Removing gs://yangyou-mnist/log/checkpoint#1565637658742474...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565637579.v3-8-tpu#1565637661740540...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565637592121864...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565637655597145...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565637584297895...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565637596551029...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565637656455689...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565637591191765...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565637660835595...
Removing gs://yangyou-mnist/log/eval/#1565637776006580...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565637776.v3-8-tpu#1565637779111987...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:23:03.257147 140070901888448 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:23:03.257939 140070901888448 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:23:03.261226 140070901888448 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:23:03.262195 140070901888448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:23:03.262866 140070901888448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:23:03.263010 140070901888448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:23:03.679034 140070901888448 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:23:03.685358 140070901888448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:23:03.689193 140070901888448 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:23:03.827302 140070901888448 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:23:03.827604 140070901888448 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:23:03.943857 140070901888448 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:23:03.989898 140070901888448 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:23:03.990225 140070901888448 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:23:04.203547 140070901888448 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f64a68321d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f64a8a0f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:23:04.203929 140070901888448 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:23:04.530668 140070901888448 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:23:04.533951: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:23:04.547888 140070901888448 tpu_system_metadata.py:148] Found TPU system:
I0812 19:23:04.548156 140070901888448 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:23:04.548692 140070901888448 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:23:04.548758 140070901888448 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:23:04.548824 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:23:04.549169 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:23:04.549245 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:23:04.549305 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:23:04.549376 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:23:04.549431 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:23:04.549485 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:23:04.549539 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:23:04.549592 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:23:04.549644 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:23:04.549699 140070901888448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:23:04.556416 140070901888448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:23:04.570379 140070901888448 estimator.py:1145] Calling model_fn.
W0812 19:23:04.571063 140070901888448 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:23:04.836563 140070901888448 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:23:05.238790 140070901888448 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:23:05.299904 140070901888448 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:23:05.305665 140070901888448 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:23:05.491806 140070901888448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:23:05.505424 140070901888448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:23:05.520859 140070901888448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:23:05.531104 140070901888448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:23:05.537081 140070901888448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:23:05.950576 140070901888448 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:23:05.966089 140070901888448 estimator.py:1147] Done calling model_fn.
I0812 19:23:09.373668 140070901888448 tpu_estimator.py:499] TPU job name worker
I0812 19:23:09.486582 140070901888448 monitored_session.py:240] Graph was finalized.
I0812 19:23:10.050060 140070901888448 session_manager.py:500] Running local_init_op.
I0812 19:23:10.080853 140070901888448 session_manager.py:502] Done running local_init_op.
I0812 19:23:12.656138 140070901888448 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:23:25.255578 140070901888448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:23:25.383382 140070901888448 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:23:25.383835 140070901888448 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:23:25.384298: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:23:25.389224 140070901888448 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:23:25.391583 140070901888448 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:23:25.395308 140070901888448 tpu_estimator.py:557] Init TPU system
I0812 19:24:08.072118 140070901888448 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:24:08.073149 140070006806272 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:24:08.073788 140069998413568 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:24:08.122118 140070901888448 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:24:08.123547 140070901888448 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:24:08.135629 140069990020864 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:24:08.222022 140069990020864 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 19:24:12.591829 140069998413568 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:24:17.157690 140070901888448 basic_session_run_hooks.py:262] loss = 0.24350508, step = 30
I0812 19:24:17.160042 140070901888448 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:24:30.293489 140070901888448 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:24:30.293775 140070901888448 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:24:30.294018 140070006806272 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:24:30.294177 140070006806272 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:24:30.294362 140070901888448 error_handling.py:96] infeed marked as finished
I0812 19:24:30.294466 140070901888448 tpu_estimator.py:602] Stop output thread controller
I0812 19:24:30.294517 140070901888448 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:24:30.294637 140069998413568 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:24:30.294709 140069998413568 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:24:30.294823 140070901888448 error_handling.py:96] outfeed marked as finished
I0812 19:24:30.294904 140070901888448 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:24:38.356097 140070901888448 estimator.py:368] Loss for final step: 0.24350508.
I0812 19:24:38.356913 140070901888448 error_handling.py:96] training_loop marked as finished
I0812 19:24:39.133085 140070901888448 estimator.py:1145] Calling model_fn.
E0812 19:24:39.909713 140070901888448 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:24:40.133589 140070901888448 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:24:40.157404 140070901888448 estimator.py:1147] Done calling model_fn.
I0812 19:24:40.175455 140070901888448 evaluation.py:255] Starting evaluation at 2019-08-12T19:24:40Z
I0812 19:24:40.175713 140070901888448 tpu_estimator.py:499] TPU job name worker
I0812 19:24:40.257028 140070901888448 monitored_session.py:240] Graph was finalized.
W0812 19:24:40.257797 140070901888448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:24:40.449346 140070901888448 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:24:43.019022 140070901888448 session_manager.py:500] Running local_init_op.
I0812 19:24:43.043034 140070901888448 session_manager.py:502] Done running local_init_op.
I0812 19:24:43.096327 140070901888448 tpu_estimator.py:557] Init TPU system
I0812 19:25:51.998826 140070901888448 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 19:25:51.999994 140069995792128 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:25:52.000897 140069987399424 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:25:52.070341 140070901888448 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:25:52.098315 140070901888448 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:25:52.098685 140070901888448 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:25:52.129731 140069979006720 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:25:52.239676 140069979006720 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:25:52.853127 140069987399424 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:25:53.187863 140070901888448 evaluation.py:167] Evaluation [10/10]
I0812 19:25:53.188209 140070901888448 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:25:53.188278 140070901888448 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:25:53.188550 140069995792128 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:25:53.188858 140069995792128 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:25:53.189114 140070901888448 error_handling.py:96] infeed marked as finished
I0812 19:25:53.189342 140070901888448 tpu_estimator.py:602] Stop output thread controller
I0812 19:25:53.189413 140070901888448 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:25:53.189621 140069987399424 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:25:53.189800 140069987399424 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:25:53.189995 140070901888448 error_handling.py:96] outfeed marked as finished
I0812 19:25:53.190196 140070901888448 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:26:22.336585 140070901888448 evaluation.py:275] Finished evaluation at 2019-08-12-19:26:22
I0812 19:26:22.336935 140070901888448 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9405, global_step = 30, loss = 0.22809282
I0812 19:26:26.576657 140070901888448 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:26:27.336613 140070901888448 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.22809282, 'global_step': 30, 'accuracy': 0.9405}

Removing gs://yangyou-mnist/log/#1565637787562981...
Removing gs://yangyou-mnist/log/checkpoint#1565637866899999...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565637787.v3-8-tpu#1565637869976381...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565637799648491...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565637863758859...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565637792129033...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565637800492368...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565637804773119...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565637864631352...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565637869025584...
Removing gs://yangyou-mnist/log/eval/#1565637984018714...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565637984.v3-8-tpu#1565637987029255...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:26:31.206944 140555219649984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:26:31.207762 140555219649984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:26:31.210660 140555219649984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:26:31.211555 140555219649984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:26:31.212168 140555219649984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:26:31.212302 140555219649984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:26:31.633126 140555219649984 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:26:31.640912 140555219649984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:26:31.645193 140555219649984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:26:31.696552 140555219649984 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:26:31.696841 140555219649984 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:26:31.870740 140555219649984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:26:31.915771 140555219649984 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:26:31.916050 140555219649984 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:26:32.028357 140555219649984 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd56a19b190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd56c378210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:26:32.028742 140555219649984 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:26:32.355545 140555219649984 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:26:32.358704: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:26:32.371638 140555219649984 tpu_system_metadata.py:148] Found TPU system:
I0812 19:26:32.371882 140555219649984 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:26:32.372407 140555219649984 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:26:32.372473 140555219649984 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:26:32.372531 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:26:32.372848 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:26:32.372927 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:26:32.372998 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:26:32.373054 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:26:32.373106 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:26:32.373159 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:26:32.373213 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:26:32.373265 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:26:32.373317 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:26:32.373369 140555219649984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:26:32.380232 140555219649984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:26:32.394464 140555219649984 estimator.py:1145] Calling model_fn.
W0812 19:26:32.395149 140555219649984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:26:32.665173 140555219649984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:26:33.218679 140555219649984 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:26:33.287154 140555219649984 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:26:33.293097 140555219649984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:26:33.472516 140555219649984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:26:33.486099 140555219649984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:26:33.501507 140555219649984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:26:33.511603 140555219649984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:26:33.517488 140555219649984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:26:33.935338 140555219649984 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:26:33.951143 140555219649984 estimator.py:1147] Done calling model_fn.
I0812 19:26:37.199182 140555219649984 tpu_estimator.py:499] TPU job name worker
I0812 19:26:37.320485 140555219649984 monitored_session.py:240] Graph was finalized.
I0812 19:26:37.897969 140555219649984 session_manager.py:500] Running local_init_op.
I0812 19:26:37.935090 140555219649984 session_manager.py:502] Done running local_init_op.
I0812 19:26:40.401546 140555219649984 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:26:52.008570 140555219649984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:26:52.126081 140555219649984 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:26:52.126615 140555219649984 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:26:52.127030: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:26:52.132744 140555219649984 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:26:52.134989 140555219649984 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:26:52.139080 140555219649984 tpu_estimator.py:557] Init TPU system
I0812 19:27:36.059370 140555219649984 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 19:27:36.060364 140554325710592 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:27:36.060842 140554317317888 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:27:36.107716 140555219649984 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:27:36.108659 140555219649984 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:27:36.119290 140554308925184 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:27:36.363342 140554308925184 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:27:40.621238 140554317317888 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:27:45.113610 140555219649984 basic_session_run_hooks.py:262] loss = 0.2516062, step = 30
I0812 19:27:45.116338 140555219649984 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:27:58.388394 140555219649984 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:27:58.388693 140555219649984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:27:58.389058 140554325710592 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:27:58.389372 140554325710592 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:27:58.389584 140555219649984 error_handling.py:96] infeed marked as finished
I0812 19:27:58.389795 140555219649984 tpu_estimator.py:602] Stop output thread controller
I0812 19:27:58.389931 140555219649984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:27:58.390206 140554317317888 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:27:58.390397 140554317317888 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:27:58.390618 140555219649984 error_handling.py:96] outfeed marked as finished
I0812 19:27:58.390816 140555219649984 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:28:06.497423 140555219649984 estimator.py:368] Loss for final step: 0.2516062.
I0812 19:28:06.498485 140555219649984 error_handling.py:96] training_loop marked as finished
I0812 19:28:07.290903 140555219649984 estimator.py:1145] Calling model_fn.
E0812 19:28:07.989240 140555219649984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:28:08.219027 140555219649984 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:28:08.242983 140555219649984 estimator.py:1147] Done calling model_fn.
I0812 19:28:08.259965 140555219649984 evaluation.py:255] Starting evaluation at 2019-08-12T19:28:08Z
I0812 19:28:08.260209 140555219649984 tpu_estimator.py:499] TPU job name worker
I0812 19:28:08.339515 140555219649984 monitored_session.py:240] Graph was finalized.
W0812 19:28:08.340331 140555219649984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:28:08.527715 140555219649984 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:28:11.171694 140555219649984 session_manager.py:500] Running local_init_op.
I0812 19:28:11.200506 140555219649984 session_manager.py:502] Done running local_init_op.
I0812 19:28:11.250433 140555219649984 tpu_estimator.py:557] Init TPU system
I0812 19:29:19.993302 140555219649984 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 19:29:19.994442 140554313647872 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:29:19.995474 140554300270336 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:29:20.060240 140555219649984 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:29:20.086611 140555219649984 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:29:20.087043 140555219649984 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:29:20.125602 140554291877632 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:29:20.365149 140554291877632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:29:20.851223 140554300270336 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:29:21.263916 140555219649984 evaluation.py:167] Evaluation [10/10]
I0812 19:29:21.264327 140555219649984 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:29:21.264403 140555219649984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:29:21.264734 140554313647872 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:29:21.265013 140554313647872 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:29:21.265239 140555219649984 error_handling.py:96] infeed marked as finished
I0812 19:29:21.265404 140555219649984 tpu_estimator.py:602] Stop output thread controller
I0812 19:29:21.265459 140555219649984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:29:21.265671 140554300270336 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:29:21.265934 140554300270336 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:29:21.266196 140555219649984 error_handling.py:96] outfeed marked as finished
I0812 19:29:21.266344 140555219649984 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:29:50.457537 140555219649984 evaluation.py:275] Finished evaluation at 2019-08-12-19:29:50
I0812 19:29:50.457885 140555219649984 estimator.py:2039] Saving dict for global step 30: accuracy = 0.942, global_step = 30, loss = 0.24196967
I0812 19:29:54.997229 140555219649984 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:29:55.880501 140555219649984 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.24196967, 'global_step': 30, 'accuracy': 0.942}

Removing gs://yangyou-mnist/log/#1565637995393559...
Removing gs://yangyou-mnist/log/checkpoint#1565638074804955...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565637995.v3-8-tpu#1565638078069358...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565637999871430...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565638007393055...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565638006516429...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565638011523384...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565638071753966...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565638072614403...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565638077145834...
Removing gs://yangyou-mnist/log/eval/#1565638192268581...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565638192.v3-8-tpu#1565638195541043...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:29:59.776055 140630172034496 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:29:59.776846 140630172034496 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:29:59.779469 140630172034496 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:29:59.780277 140630172034496 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:29:59.780846 140630172034496 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:29:59.780970 140630172034496 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:30:00.199960 140630172034496 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:30:00.208137 140630172034496 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:30:00.212449 140630172034496 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:30:00.260515 140630172034496 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:30:00.260847 140630172034496 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:30:00.413645 140630172034496 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:30:00.461402 140630172034496 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:30:00.461704 140630172034496 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:30:00.597918 140630172034496 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe6dd9c5190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe6dfba2210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:30:00.598361 140630172034496 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:30:00.926891 140630172034496 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:30:00.929823: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:30:00.947140 140630172034496 tpu_system_metadata.py:148] Found TPU system:
I0812 19:30:00.947390 140630172034496 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:30:00.947901 140630172034496 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:30:00.947968 140630172034496 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:30:00.948055 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:30:00.948402 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:30:00.948466 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:30:00.948534 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:30:00.948582 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:30:00.948632 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:30:00.948678 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:30:00.948725 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:30:00.948771 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:30:00.948823 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:30:00.948875 140630172034496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:30:00.955017 140630172034496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:30:00.967667 140630172034496 estimator.py:1145] Calling model_fn.
W0812 19:30:00.968302 140630172034496 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:30:01.244271 140630172034496 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:30:01.679766 140630172034496 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:30:01.742326 140630172034496 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:30:01.748414 140630172034496 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:30:01.935669 140630172034496 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:30:01.950581 140630172034496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:30:01.966051 140630172034496 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:30:01.976346 140630172034496 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:30:01.982598 140630172034496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:30:02.418096 140630172034496 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:30:02.434257 140630172034496 estimator.py:1147] Done calling model_fn.
I0812 19:30:05.850300 140630172034496 tpu_estimator.py:499] TPU job name worker
I0812 19:30:05.966448 140630172034496 monitored_session.py:240] Graph was finalized.
I0812 19:30:06.534979 140630172034496 session_manager.py:500] Running local_init_op.
I0812 19:30:06.575247 140630172034496 session_manager.py:502] Done running local_init_op.
I0812 19:30:09.222275 140630172034496 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:30:21.627537 140630172034496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:30:21.748317 140630172034496 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:30:21.748857 140630172034496 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:30:21.749287: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:30:21.754878 140630172034496 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:30:21.757447 140630172034496 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:30:21.761923 140630172034496 tpu_estimator.py:557] Init TPU system
I0812 19:31:04.003737 140630172034496 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:31:04.004990 140629278181120 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:31:04.005757 140629269788416 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:31:04.050713 140630172034496 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:31:04.051739 140630172034496 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:31:04.064006 140629261395712 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:31:04.173890 140629261395712 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:31:08.802114 140629269788416 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:31:13.437412 140630172034496 basic_session_run_hooks.py:262] loss = 0.14875956, step = 30
I0812 19:31:13.440103 140630172034496 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:31:27.227713 140630172034496 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:31:27.228028 140630172034496 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:31:27.228367 140629278181120 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:31:27.228658 140629278181120 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:31:27.228919 140630172034496 error_handling.py:96] infeed marked as finished
I0812 19:31:27.229134 140630172034496 tpu_estimator.py:602] Stop output thread controller
I0812 19:31:27.229212 140630172034496 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:31:27.229479 140629269788416 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:31:27.229681 140629269788416 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:31:27.229882 140630172034496 error_handling.py:96] outfeed marked as finished
I0812 19:31:27.230036 140630172034496 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:31:34.309628 140630172034496 estimator.py:368] Loss for final step: 0.14875956.
I0812 19:31:34.310607 140630172034496 error_handling.py:96] training_loop marked as finished
I0812 19:31:35.196649 140630172034496 estimator.py:1145] Calling model_fn.
E0812 19:31:35.881810 140630172034496 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:31:36.109371 140630172034496 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:31:36.132662 140630172034496 estimator.py:1147] Done calling model_fn.
I0812 19:31:36.151283 140630172034496 evaluation.py:255] Starting evaluation at 2019-08-12T19:31:36Z
I0812 19:31:36.151536 140630172034496 tpu_estimator.py:499] TPU job name worker
I0812 19:31:36.238461 140630172034496 monitored_session.py:240] Graph was finalized.
W0812 19:31:36.239228 140630172034496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:31:36.430643 140630172034496 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:31:39.029690 140630172034496 session_manager.py:500] Running local_init_op.
I0812 19:31:39.058204 140630172034496 session_manager.py:502] Done running local_init_op.
I0812 19:31:39.105056 140630172034496 tpu_estimator.py:557] Init TPU system
I0812 19:32:48.004336 140630172034496 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 19:32:48.005208 140629266118400 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:32:48.005515 140629252740864 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:32:48.072447 140630172034496 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:32:48.097867 140630172034496 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:32:48.098326 140630172034496 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:32:48.118473 140628906211072 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:32:48.208126 140628906211072 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:32:48.873863 140629252740864 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:32:49.217123 140630172034496 evaluation.py:167] Evaluation [10/10]
I0812 19:32:49.217449 140630172034496 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:32:49.217515 140630172034496 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:32:49.217746 140629266118400 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:32:49.217859 140629266118400 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:32:49.218003 140630172034496 error_handling.py:96] infeed marked as finished
I0812 19:32:49.218089 140630172034496 tpu_estimator.py:602] Stop output thread controller
I0812 19:32:49.218316 140630172034496 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:32:49.218455 140629252740864 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:32:49.218540 140629252740864 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:32:49.218661 140630172034496 error_handling.py:96] outfeed marked as finished
I0812 19:32:49.218749 140630172034496 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:33:18.301327 140630172034496 evaluation.py:275] Finished evaluation at 2019-08-12-19:33:18
I0812 19:33:18.301747 140630172034496 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9625, global_step = 30, loss = 0.12639429
I0812 19:33:22.601795 140630172034496 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:33:23.424551 140630172034496 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12639429, 'global_step': 30, 'accuracy': 0.9625}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565638216617062...
Removing gs://yangyou-mnist/log/#1565638203991344...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565638221135448...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565638215701806...
Removing gs://yangyou-mnist/log/checkpoint#1565638283756376...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565638208671435...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565638204.v3-8-tpu#1565638286918438...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565638281394843...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565638280552951...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565638285888918...
Removing gs://yangyou-mnist/log/eval/#1565638399928565...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565638400.v3-8-tpu#1565638403108270...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:33:27.266349 139803636999616 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:33:27.267143 139803636999616 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:33:27.269748 139803636999616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:33:27.270632 139803636999616 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:33:27.271228 139803636999616 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:33:27.271362 139803636999616 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:33:27.684169 139803636999616 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:33:27.690356 139803636999616 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:33:27.693989 139803636999616 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:33:27.793929 139803636999616 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:33:27.794244 139803636999616 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:33:27.902611 139803636999616 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:33:27.967916 139803636999616 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:33:27.968194 139803636999616 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:33:28.124834 139803636999616 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f266c489190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f266e666210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:33:28.125170 139803636999616 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:33:28.449214 139803636999616 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:33:28.452120: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:33:28.464278 139803636999616 tpu_system_metadata.py:148] Found TPU system:
I0812 19:33:28.464596 139803636999616 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:33:28.465089 139803636999616 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:33:28.465147 139803636999616 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:33:28.465200 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:33:28.465471 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:33:28.465534 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:33:28.465584 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:33:28.465632 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:33:28.465694 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:33:28.465743 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:33:28.465790 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:33:28.465837 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:33:28.465883 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:33:28.465929 139803636999616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:33:28.471854 139803636999616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:33:28.484150 139803636999616 estimator.py:1145] Calling model_fn.
W0812 19:33:28.484752 139803636999616 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:33:28.748537 139803636999616 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:33:29.347153 139803636999616 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:33:29.407907 139803636999616 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:33:29.413793 139803636999616 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:33:29.591197 139803636999616 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:33:29.604609 139803636999616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:33:29.619539 139803636999616 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:33:29.629508 139803636999616 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:33:29.635462 139803636999616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:33:30.048531 139803636999616 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:33:30.064203 139803636999616 estimator.py:1147] Done calling model_fn.
I0812 19:33:33.686655 139803636999616 tpu_estimator.py:499] TPU job name worker
I0812 19:33:33.802088 139803636999616 monitored_session.py:240] Graph was finalized.
I0812 19:33:34.400671 139803636999616 session_manager.py:500] Running local_init_op.
I0812 19:33:34.441356 139803636999616 session_manager.py:502] Done running local_init_op.
I0812 19:33:37.097536 139803636999616 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:33:49.118618 139803636999616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:33:49.238938 139803636999616 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:33:49.239439 139803636999616 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:33:49.239839: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:33:49.244395 139803636999616 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:33:49.246645 139803636999616 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:33:49.250515 139803636999616 tpu_estimator.py:557] Init TPU system
I0812 19:34:32.068869 139803636999616 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:34:32.070197 139802944587520 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:34:32.070899 139802460550912 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:34:32.117825 139803636999616 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:34:32.124655 139803636999616 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:34:32.130402 139802452158208 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:34:32.299299 139802452158208 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:34:36.524301 139802460550912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:34:41.157429 139803636999616 basic_session_run_hooks.py:262] loss = 0.14081249, step = 30
I0812 19:34:41.160243 139803636999616 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:34:54.606936 139803636999616 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:34:54.607263 139803636999616 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:34:54.607594 139802944587520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:34:54.607872 139802944587520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:34:54.608078 139803636999616 error_handling.py:96] infeed marked as finished
I0812 19:34:54.608294 139803636999616 tpu_estimator.py:602] Stop output thread controller
I0812 19:34:54.608376 139803636999616 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:34:54.608555 139802460550912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:34:54.608700 139802460550912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:34:54.608864 139803636999616 error_handling.py:96] outfeed marked as finished
I0812 19:34:54.608995 139803636999616 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:35:02.431782 139803636999616 estimator.py:368] Loss for final step: 0.14081249.
I0812 19:35:02.432655 139803636999616 error_handling.py:96] training_loop marked as finished
I0812 19:35:03.236924 139803636999616 estimator.py:1145] Calling model_fn.
E0812 19:35:03.947102 139803636999616 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:35:04.179786 139803636999616 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:35:04.202852 139803636999616 estimator.py:1147] Done calling model_fn.
I0812 19:35:04.218791 139803636999616 evaluation.py:255] Starting evaluation at 2019-08-12T19:35:04Z
I0812 19:35:04.219017 139803636999616 tpu_estimator.py:499] TPU job name worker
I0812 19:35:04.293951 139803636999616 monitored_session.py:240] Graph was finalized.
W0812 19:35:04.294697 139803636999616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:35:04.482903 139803636999616 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:35:06.886945 139803636999616 session_manager.py:500] Running local_init_op.
I0812 19:35:06.910306 139803636999616 session_manager.py:502] Done running local_init_op.
I0812 19:35:06.956041 139803636999616 tpu_estimator.py:557] Init TPU system
I0812 19:36:16.020142 139803636999616 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 19:36:16.021133 139802460550912 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:36:16.021759 139802452158208 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:36:16.087933 139803636999616 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:36:16.114259 139803636999616 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:36:16.114733 139803636999616 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:36:16.145956 139802443765504 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:36:16.259965 139802443765504 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:36:16.875932 139802452158208 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:36:17.321194 139803636999616 evaluation.py:167] Evaluation [10/10]
I0812 19:36:17.321527 139803636999616 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:36:17.321630 139803636999616 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:36:17.321929 139802460550912 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:36:17.322323 139802460550912 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:36:17.322549 139803636999616 error_handling.py:96] infeed marked as finished
I0812 19:36:17.322748 139803636999616 tpu_estimator.py:602] Stop output thread controller
I0812 19:36:17.322807 139803636999616 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:36:17.322983 139802452158208 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:36:17.323144 139802452158208 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:36:17.323292 139803636999616 error_handling.py:96] outfeed marked as finished
I0812 19:36:17.323410 139803636999616 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:36:46.332500 139803636999616 evaluation.py:275] Finished evaluation at 2019-08-12-19:36:46
I0812 19:36:46.332859 139803636999616 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9667, global_step = 30, loss = 0.114693664
I0812 19:36:50.608639 139803636999616 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:36:51.438302 139803636999616 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.114693664, 'global_step': 30, 'accuracy': 0.9667}

Removing gs://yangyou-mnist/log/checkpoint#1565638491143521...
Removing gs://yangyou-mnist/log/#1565638411570899...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565638424275879...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565638411.v3-8-tpu#1565638494291531...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565638416563739...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565638487915314...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565638428631860...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565638488790997...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565638423373566...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565638493333009...
Removing gs://yangyou-mnist/log/eval/#1565638607995795...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565638608.v3-8-tpu#1565638611103114...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:36:55.251655 140070587872704 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:36:55.252410 140070587872704 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:36:55.255062 140070587872704 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:36:55.255886 140070587872704 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:36:55.263006 140070587872704 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:36:55.263231 140070587872704 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:36:55.669863 140070587872704 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:36:55.676397 140070587872704 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:36:55.680197 140070587872704 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:36:55.737555 140070587872704 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:36:55.737840 140070587872704 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:36:55.859994 140070587872704 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:36:55.901911 140070587872704 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:36:55.902250 140070587872704 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:36:56.052735 140070587872704 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f6493cba290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f6495e97210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:36:56.053095 140070587872704 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:36:56.384852 140070587872704 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:36:56.387729: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:36:56.399983 140070587872704 tpu_system_metadata.py:148] Found TPU system:
I0812 19:36:56.400232 140070587872704 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:36:56.400706 140070587872704 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:36:56.400762 140070587872704 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:36:56.400814 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:36:56.401093 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:36:56.401149 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:36:56.401200 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:36:56.401248 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:36:56.401297 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:36:56.401356 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:36:56.401403 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:36:56.401449 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:36:56.401504 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:36:56.401554 140070587872704 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:36:56.407399 140070587872704 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:36:56.419531 140070587872704 estimator.py:1145] Calling model_fn.
W0812 19:36:56.420101 140070587872704 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:36:56.674561 140070587872704 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:36:57.203543 140070587872704 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:36:57.270421 140070587872704 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:36:57.276120 140070587872704 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:36:57.454248 140070587872704 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:36:57.467917 140070587872704 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:36:57.483159 140070587872704 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:36:57.493155 140070587872704 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:36:57.499269 140070587872704 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:36:57.913826 140070587872704 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:36:57.929495 140070587872704 estimator.py:1147] Done calling model_fn.
I0812 19:37:01.486598 140070587872704 tpu_estimator.py:499] TPU job name worker
I0812 19:37:01.602757 140070587872704 monitored_session.py:240] Graph was finalized.
I0812 19:37:02.217533 140070587872704 session_manager.py:500] Running local_init_op.
I0812 19:37:02.250252 140070587872704 session_manager.py:502] Done running local_init_op.
I0812 19:37:04.745383 140070587872704 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:37:17.118666 140070587872704 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:37:17.226296 140070587872704 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:37:17.226790 140070587872704 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:37:17.227193: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:37:17.232609 140070587872704 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:37:17.235091 140070587872704 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:37:17.239922 140070587872704 tpu_estimator.py:557] Init TPU system
I0812 19:38:00.054589 140070587872704 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:38:00.055546 140069553829632 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:38:00.056008 140069545436928 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:38:00.099845 140070587872704 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:38:00.100944 140070587872704 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:38:00.111059 140069537044224 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:38:00.260755 140069537044224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 19:38:04.914315 140069545436928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:38:09.598695 140070587872704 basic_session_run_hooks.py:262] loss = 0.11687246, step = 30
I0812 19:38:09.601281 140070587872704 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:38:23.113545 140070587872704 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:38:23.113894 140070587872704 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:38:23.114363 140069553829632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:38:23.114712 140069553829632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:38:23.114969 140070587872704 error_handling.py:96] infeed marked as finished
I0812 19:38:23.115221 140070587872704 tpu_estimator.py:602] Stop output thread controller
I0812 19:38:23.115283 140070587872704 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:38:23.115472 140069545436928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:38:23.115648 140069545436928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:38:23.115850 140070587872704 error_handling.py:96] outfeed marked as finished
I0812 19:38:23.116008 140070587872704 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:38:30.397890 140070587872704 estimator.py:368] Loss for final step: 0.11687246.
I0812 19:38:30.398827 140070587872704 error_handling.py:96] training_loop marked as finished
I0812 19:38:31.123774 140070587872704 estimator.py:1145] Calling model_fn.
E0812 19:38:31.845154 140070587872704 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:38:32.066092 140070587872704 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:38:32.088699 140070587872704 estimator.py:1147] Done calling model_fn.
I0812 19:38:32.105401 140070587872704 evaluation.py:255] Starting evaluation at 2019-08-12T19:38:32Z
I0812 19:38:32.105662 140070587872704 tpu_estimator.py:499] TPU job name worker
I0812 19:38:32.186743 140070587872704 monitored_session.py:240] Graph was finalized.
W0812 19:38:32.187567 140070587872704 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:38:32.377435 140070587872704 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:38:34.914730 140070587872704 session_manager.py:500] Running local_init_op.
I0812 19:38:34.939479 140070587872704 session_manager.py:502] Done running local_init_op.
I0812 19:38:34.985919 140070587872704 tpu_estimator.py:557] Init TPU system
I0812 19:39:44.008686 140070587872704 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 19:39:44.009679 140069553829632 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:39:44.010627 140069545436928 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:39:44.072381 140070587872704 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:39:44.098917 140070587872704 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:39:44.099297 140070587872704 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:39:44.138062 140069537044224 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:39:44.280587 140069537044224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:39:44.890479 140069545436928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:39:45.220449 140070587872704 evaluation.py:167] Evaluation [10/10]
I0812 19:39:45.220814 140070587872704 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:39:45.220885 140070587872704 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:39:45.221204 140069553829632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:39:45.221493 140069553829632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:39:45.221721 140070587872704 error_handling.py:96] infeed marked as finished
I0812 19:39:45.221904 140070587872704 tpu_estimator.py:602] Stop output thread controller
I0812 19:39:45.222048 140070587872704 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:39:45.222310 140069545436928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:39:45.222477 140069545436928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:39:45.222671 140070587872704 error_handling.py:96] outfeed marked as finished
I0812 19:39:45.222836 140070587872704 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:40:14.356961 140070587872704 evaluation.py:275] Finished evaluation at 2019-08-12-19:40:14
I0812 19:40:14.357316 140070587872704 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9678, global_step = 30, loss = 0.10880792
I0812 19:40:18.603003 140070587872704 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:40:19.388457 140070587872704 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10880792, 'global_step': 30, 'accuracy': 0.9678}

Removing gs://yangyou-mnist/log/#1565638619551599...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565638632003365...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565638636635698...
Removing gs://yangyou-mnist/log/checkpoint#1565638699684988...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565638696354247...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565638619.v3-8-tpu#1565638702796466...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565638624209058...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565638697339715...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565638631129572...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565638701928285...
Removing gs://yangyou-mnist/log/eval/#1565638816096796...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565638816.v3-8-tpu#1565638819062401...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:40:23.313333 140508154623424 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:40:23.314095 140508154623424 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:40:23.316701 140508154623424 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:40:23.317495 140508154623424 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:40:23.318054 140508154623424 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:40:23.318330 140508154623424 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:40:23.731784 140508154623424 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:40:23.738434 140508154623424 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:40:23.742316 140508154623424 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:40:23.791373 140508154623424 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:40:23.791666 140508154623424 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:40:24.031476 140508154623424 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:40:24.077574 140508154623424 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:40:24.077850 140508154623424 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:40:24.164674 140508154623424 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fca74ce6090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fca76ec3210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:40:24.165045 140508154623424 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:40:24.491516 140508154623424 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:40:24.494498: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:40:24.507819 140508154623424 tpu_system_metadata.py:148] Found TPU system:
I0812 19:40:24.508078 140508154623424 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:40:24.508555 140508154623424 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:40:24.508613 140508154623424 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:40:24.508665 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:40:24.508936 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:40:24.509008 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:40:24.509059 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:40:24.509108 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:40:24.509155 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:40:24.509202 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:40:24.509262 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:40:24.509308 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:40:24.509354 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:40:24.509401 140508154623424 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:40:24.515325 140508154623424 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:40:24.528337 140508154623424 estimator.py:1145] Calling model_fn.
W0812 19:40:24.528945 140508154623424 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:40:24.805577 140508154623424 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:40:25.245023 140508154623424 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:40:25.307033 140508154623424 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:40:25.312927 140508154623424 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:40:25.495033 140508154623424 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:40:25.508821 140508154623424 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:40:25.524174 140508154623424 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:40:25.534383 140508154623424 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:40:25.540513 140508154623424 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:40:25.959403 140508154623424 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:40:25.974962 140508154623424 estimator.py:1147] Done calling model_fn.
I0812 19:40:29.486113 140508154623424 tpu_estimator.py:499] TPU job name worker
I0812 19:40:29.601036 140508154623424 monitored_session.py:240] Graph was finalized.
I0812 19:40:30.174993 140508154623424 session_manager.py:500] Running local_init_op.
I0812 19:40:30.207653 140508154623424 session_manager.py:502] Done running local_init_op.
I0812 19:40:32.812226 140508154623424 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:40:44.932626 140508154623424 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:40:45.049757 140508154623424 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:40:45.050213 140508154623424 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:40:45.050592: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:40:45.055016 140508154623424 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:40:45.057447 140508154623424 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:40:45.061388 140508154623424 tpu_estimator.py:557] Init TPU system
I0812 19:41:28.063745 140508154623424 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 19:41:28.064801 140507394844416 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:41:28.065414 140507386451712 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:41:28.116976 140508154623424 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:41:28.117897 140508154623424 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:41:28.179773 140506902296320 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:41:28.420588 140506902296320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:41:32.561995 140507386451712 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:41:37.121326 140508154623424 basic_session_run_hooks.py:262] loss = 0.18035169, step = 30
I0812 19:41:37.124126 140508154623424 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:41:50.700289 140508154623424 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:41:50.700611 140508154623424 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:41:50.702006 140507394844416 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:41:50.702347 140507394844416 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:41:50.702586 140508154623424 error_handling.py:96] infeed marked as finished
I0812 19:41:50.702971 140508154623424 tpu_estimator.py:602] Stop output thread controller
I0812 19:41:50.703080 140508154623424 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:41:50.703283 140507386451712 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:41:50.703476 140507386451712 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:41:50.703634 140508154623424 error_handling.py:96] outfeed marked as finished
I0812 19:41:50.703768 140508154623424 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:41:58.554423 140508154623424 estimator.py:368] Loss for final step: 0.18035169.
I0812 19:41:58.555296 140508154623424 error_handling.py:96] training_loop marked as finished
I0812 19:41:59.257301 140508154623424 estimator.py:1145] Calling model_fn.
E0812 19:42:00.061891 140508154623424 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:42:00.290055 140508154623424 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:42:00.312524 140508154623424 estimator.py:1147] Done calling model_fn.
I0812 19:42:00.328378 140508154623424 evaluation.py:255] Starting evaluation at 2019-08-12T19:42:00Z
I0812 19:42:00.328614 140508154623424 tpu_estimator.py:499] TPU job name worker
I0812 19:42:00.404524 140508154623424 monitored_session.py:240] Graph was finalized.
W0812 19:42:00.405260 140508154623424 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:42:00.623214 140508154623424 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:42:03.083682 140508154623424 session_manager.py:500] Running local_init_op.
I0812 19:42:03.112768 140508154623424 session_manager.py:502] Done running local_init_op.
I0812 19:42:03.160679 140508154623424 tpu_estimator.py:557] Init TPU system
I0812 19:43:11.986916 140508154623424 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 19:43:11.988029 140506902296320 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:43:11.988985 140506893903616 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:43:12.054327 140508154623424 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:43:12.077344 140508154623424 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:43:12.077685 140508154623424 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:43:12.123989 140506885510912 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:43:12.362878 140506885510912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:43:12.857176 140506893903616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:43:13.175045 140508154623424 evaluation.py:167] Evaluation [10/10]
I0812 19:43:13.175596 140508154623424 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:43:13.175719 140508154623424 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:43:13.175998 140506902296320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:43:13.176276 140506902296320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:43:13.176527 140508154623424 error_handling.py:96] infeed marked as finished
I0812 19:43:13.176732 140508154623424 tpu_estimator.py:602] Stop output thread controller
I0812 19:43:13.176795 140508154623424 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:43:13.176953 140506893903616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:43:13.177090 140506893903616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:43:13.177249 140508154623424 error_handling.py:96] outfeed marked as finished
I0812 19:43:13.177378 140508154623424 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:43:42.460119 140508154623424 evaluation.py:275] Finished evaluation at 2019-08-12-19:43:42
I0812 19:43:42.460517 140508154623424 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9593, global_step = 30, loss = 0.14797637
I0812 19:43:47.156002 140508154623424 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:43:47.970312 140508154623424 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.14797637, 'global_step': 30, 'accuracy': 0.9593}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565638840169465...
Removing gs://yangyou-mnist/log/checkpoint#1565638906943321...
Removing gs://yangyou-mnist/log/#1565638827596557...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565638844449303...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565638827.v3-8-tpu#1565638910395390...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565638832164826...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565638839327494...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565638903831349...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565638904676010...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565638909358926...
Removing gs://yangyou-mnist/log/eval/#1565639024165184...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565639024.v3-8-tpu#1565639027662258...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:43:51.817914 140456256124352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:43:51.818811 140456256124352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:43:51.821398 140456256124352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:43:51.822257 140456256124352 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:43:51.822841 140456256124352 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:43:51.822973 140456256124352 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:43:52.239676 140456256124352 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:43:52.246808 140456256124352 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:43:52.251158 140456256124352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:43:52.338114 140456256124352 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:43:52.338455 140456256124352 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:43:52.580575 140456256124352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:43:52.623528 140456256124352 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:43:52.623810 140456256124352 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:43:53.020598 140456256124352 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fbe5f68b250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fbe6187f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:43:53.021013 140456256124352 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:43:53.438780 140456256124352 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:43:53.441564: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:43:53.453736 140456256124352 tpu_system_metadata.py:148] Found TPU system:
I0812 19:43:53.453974 140456256124352 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:43:53.454577 140456256124352 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:43:53.454638 140456256124352 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:43:53.454690 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:43:53.454972 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:43:53.455034 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:43:53.455085 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:43:53.455135 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:43:53.455182 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:43:53.455228 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:43:53.455275 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:43:53.455321 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:43:53.455382 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:43:53.455430 140456256124352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:43:53.461410 140456256124352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:43:53.474303 140456256124352 estimator.py:1145] Calling model_fn.
W0812 19:43:53.474920 140456256124352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:43:53.757791 140456256124352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:43:54.171681 140456256124352 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:43:54.231178 140456256124352 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:43:54.236814 140456256124352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:43:54.416946 140456256124352 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:43:54.430290 140456256124352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:43:54.445377 140456256124352 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:43:54.455353 140456256124352 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:43:54.461191 140456256124352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:43:54.867093 140456256124352 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:43:54.882350 140456256124352 estimator.py:1147] Done calling model_fn.
I0812 19:43:58.165841 140456256124352 tpu_estimator.py:499] TPU job name worker
I0812 19:43:58.286048 140456256124352 monitored_session.py:240] Graph was finalized.
I0812 19:43:58.850655 140456256124352 session_manager.py:500] Running local_init_op.
I0812 19:43:58.884231 140456256124352 session_manager.py:502] Done running local_init_op.
I0812 19:44:01.394826 140456256124352 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:44:13.620162 140456256124352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:44:13.735807 140456256124352 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:44:13.736299 140456256124352 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:44:13.736666: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:44:13.741647 140456256124352 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:44:13.744007 140456256124352 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:44:13.747773 140456256124352 tpu_estimator.py:557] Init TPU system
I0812 19:44:56.061595 140456256124352 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:44:56.062859 140455220078336 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:44:56.063822 140455211685632 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:44:56.112262 140456256124352 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:44:56.113217 140456256124352 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:44:56.127422 140455203292928 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:44:56.298996 140455203292928 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 19:45:00.687685 140455211685632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:45:05.322438 140456256124352 basic_session_run_hooks.py:262] loss = 0.10955673, step = 30
I0812 19:45:05.325407 140456256124352 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:45:18.642275 140456256124352 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:45:18.642628 140456256124352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:45:18.643116 140455220078336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:45:18.644629 140455220078336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:45:18.645005 140456256124352 error_handling.py:96] infeed marked as finished
I0812 19:45:18.645323 140456256124352 tpu_estimator.py:602] Stop output thread controller
I0812 19:45:18.645394 140456256124352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:45:18.645622 140455211685632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:45:18.645896 140455211685632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:45:18.646212 140456256124352 error_handling.py:96] outfeed marked as finished
I0812 19:45:18.646379 140456256124352 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:45:26.433054 140456256124352 estimator.py:368] Loss for final step: 0.10955673.
I0812 19:45:26.433984 140456256124352 error_handling.py:96] training_loop marked as finished
I0812 19:45:27.143773 140456256124352 estimator.py:1145] Calling model_fn.
E0812 19:45:27.865647 140456256124352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:45:28.100684 140456256124352 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:45:28.125576 140456256124352 estimator.py:1147] Done calling model_fn.
I0812 19:45:28.145309 140456256124352 evaluation.py:255] Starting evaluation at 2019-08-12T19:45:28Z
I0812 19:45:28.145579 140456256124352 tpu_estimator.py:499] TPU job name worker
I0812 19:45:28.240643 140456256124352 monitored_session.py:240] Graph was finalized.
W0812 19:45:28.241494 140456256124352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:45:28.444535 140456256124352 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:45:30.828901 140456256124352 session_manager.py:500] Running local_init_op.
I0812 19:45:30.852085 140456256124352 session_manager.py:502] Done running local_init_op.
I0812 19:45:30.900177 140456256124352 tpu_estimator.py:557] Init TPU system
I0812 19:46:40.074132 140456256124352 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 19:46:40.075228 140455220078336 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:46:40.075906 140455211685632 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:46:40.141365 140456256124352 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:46:40.169066 140456256124352 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:46:40.169452 140456256124352 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:46:40.244329 140455203292928 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:46:40.346927 140455203292928 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:46:40.940694 140455211685632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:46:41.209443 140456256124352 evaluation.py:167] Evaluation [10/10]
I0812 19:46:41.210051 140456256124352 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:46:41.210211 140456256124352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:46:41.210488 140455220078336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:46:41.210751 140455220078336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:46:41.211994 140456256124352 error_handling.py:96] infeed marked as finished
I0812 19:46:41.212294 140456256124352 tpu_estimator.py:602] Stop output thread controller
I0812 19:46:41.212366 140456256124352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:46:41.212603 140455211685632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:46:41.212810 140455211685632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:46:41.213088 140456256124352 error_handling.py:96] outfeed marked as finished
I0812 19:46:41.213255 140456256124352 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:47:10.445354 140456256124352 evaluation.py:275] Finished evaluation at 2019-08-12-19:47:10
I0812 19:47:10.445704 140456256124352 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9744, global_step = 30, loss = 0.08855908
I0812 19:47:14.811233 140456256124352 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:47:15.575337 140456256124352 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08855908, 'global_step': 30, 'accuracy': 0.9744}

Removing gs://yangyou-mnist/log/#1565639036386466...
Removing gs://yangyou-mnist/log/checkpoint#1565639114988839...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565639040857748...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565639048619572...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565639053139462...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565639036.v3-8-tpu#1565639118329032...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565639047723321...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565639111883955...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565639112764781...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565639117127331...
Removing gs://yangyou-mnist/log/eval/#1565639232171616...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565639232.v3-8-tpu#1565639235245743...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:47:19.372443 140633698858432 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:47:19.373229 140633698858432 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:47:19.375966 140633698858432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:47:19.376811 140633698858432 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:47:19.377379 140633698858432 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:47:19.377516 140633698858432 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:47:19.790642 140633698858432 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:47:19.798324 140633698858432 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:47:19.803107 140633698858432 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:47:19.852758 140633698858432 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:47:19.853043 140633698858432 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:47:20.143527 140633698858432 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:47:20.195770 140633698858432 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:47:20.196082 140633698858432 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:47:20.314553 140633698858432 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe7afd36190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe7b1f13210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:47:20.314937 140633698858432 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:47:20.645220 140633698858432 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:47:20.648166: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:47:20.661312 140633698858432 tpu_system_metadata.py:148] Found TPU system:
I0812 19:47:20.661586 140633698858432 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:47:20.662201 140633698858432 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:47:20.662286 140633698858432 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:47:20.662352 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:47:20.662728 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:47:20.662791 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:47:20.662848 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:47:20.662903 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:47:20.662956 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:47:20.663012 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:47:20.663064 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:47:20.663116 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:47:20.663168 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:47:20.663239 140633698858432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:47:20.669648 140633698858432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:47:20.683101 140633698858432 estimator.py:1145] Calling model_fn.
W0812 19:47:20.683736 140633698858432 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:47:21.013010 140633698858432 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:47:21.585407 140633698858432 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:47:21.648127 140633698858432 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:47:21.654257 140633698858432 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:47:21.839327 140633698858432 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:47:21.853208 140633698858432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:47:21.868843 140633698858432 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:47:21.879292 140633698858432 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:47:21.885363 140633698858432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:47:22.305011 140633698858432 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:47:22.320497 140633698858432 estimator.py:1147] Done calling model_fn.
I0812 19:47:25.750050 140633698858432 tpu_estimator.py:499] TPU job name worker
I0812 19:47:25.863984 140633698858432 monitored_session.py:240] Graph was finalized.
I0812 19:47:26.454612 140633698858432 session_manager.py:500] Running local_init_op.
I0812 19:47:26.495171 140633698858432 session_manager.py:502] Done running local_init_op.
I0812 19:47:28.943629 140633698858432 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:47:40.955140 140633698858432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:47:41.074999 140633698858432 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:47:41.075442 140633698858432 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:47:41.075817: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:47:41.080275 140633698858432 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:47:41.082470 140633698858432 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:47:41.086365 140633698858432 tpu_estimator.py:557] Init TPU system
I0812 19:48:24.103017 140633698858432 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 19:48:24.103987 140632664307456 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:48:24.104747 140632655914752 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:48:24.152738 140633698858432 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:48:24.153605 140633698858432 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:48:24.167540 140632647522048 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:48:24.334434 140632647522048 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:48:28.671705 140632655914752 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:48:33.199853 140633698858432 basic_session_run_hooks.py:262] loss = 0.13821699, step = 30
I0812 19:48:33.203145 140633698858432 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:48:46.613030 140633698858432 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:48:46.613312 140633698858432 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:48:46.613651 140632664307456 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:48:46.614025 140632664307456 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:48:46.614320 140633698858432 error_handling.py:96] infeed marked as finished
I0812 19:48:46.614556 140633698858432 tpu_estimator.py:602] Stop output thread controller
I0812 19:48:46.614634 140633698858432 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:48:46.614885 140632655914752 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:48:46.615189 140632655914752 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:48:46.615400 140633698858432 error_handling.py:96] outfeed marked as finished
I0812 19:48:46.615572 140633698858432 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:48:54.468417 140633698858432 estimator.py:368] Loss for final step: 0.13821699.
I0812 19:48:54.469261 140633698858432 error_handling.py:96] training_loop marked as finished
I0812 19:48:55.285293 140633698858432 estimator.py:1145] Calling model_fn.
E0812 19:48:55.976321 140633698858432 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:48:56.205275 140633698858432 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:48:56.228866 140633698858432 estimator.py:1147] Done calling model_fn.
I0812 19:48:56.245584 140633698858432 evaluation.py:255] Starting evaluation at 2019-08-12T19:48:56Z
I0812 19:48:56.245825 140633698858432 tpu_estimator.py:499] TPU job name worker
I0812 19:48:56.330604 140633698858432 monitored_session.py:240] Graph was finalized.
W0812 19:48:56.331397 140633698858432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:48:56.538847 140633698858432 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:48:59.152209 140633698858432 session_manager.py:500] Running local_init_op.
I0812 19:48:59.175662 140633698858432 session_manager.py:502] Done running local_init_op.
I0812 19:48:59.229296 140633698858432 tpu_estimator.py:557] Init TPU system
I0812 19:50:08.002295 140633698858432 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 19:50:08.003454 140632655914752 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:50:08.004884 140632647522048 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:50:08.070462 140633698858432 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:50:08.100306 140633698858432 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:50:08.100955 140633698858432 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:50:08.146966 140632639129344 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:50:08.294610 140632639129344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:50:08.882818 140632647522048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:50:09.188786 140633698858432 evaluation.py:167] Evaluation [10/10]
I0812 19:50:09.189141 140633698858432 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:50:09.189222 140633698858432 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:50:09.189708 140632655914752 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:50:09.189955 140632655914752 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:50:09.190248 140633698858432 error_handling.py:96] infeed marked as finished
I0812 19:50:09.190380 140633698858432 tpu_estimator.py:602] Stop output thread controller
I0812 19:50:09.190439 140633698858432 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:50:09.190663 140632647522048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:50:09.190764 140632647522048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:50:09.190973 140633698858432 error_handling.py:96] outfeed marked as finished
I0812 19:50:09.191087 140633698858432 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:50:38.390244 140633698858432 evaluation.py:275] Finished evaluation at 2019-08-12-19:50:38
I0812 19:50:38.390603 140633698858432 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9624, global_step = 30, loss = 0.12717786
I0812 19:50:42.650830 140633698858432 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:50:43.500511 140633698858432 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12717786, 'global_step': 30, 'accuracy': 0.9624}

Removing gs://yangyou-mnist/log/#1565639243816638...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565639243.v3-8-tpu#1565639326308200...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565639260480982...
Removing gs://yangyou-mnist/log/checkpoint#1565639323190230...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565639256148351...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565639248366621...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565639320911224...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565639320086935...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565639255251441...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565639325351538...
Removing gs://yangyou-mnist/log/eval/#1565639440065430...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565639440.v3-8-tpu#1565639443198411...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:50:47.293699 140050645693888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:50:47.294514 140050645693888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:50:47.297080 140050645693888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:50:47.297879 140050645693888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:50:47.298604 140050645693888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:50:47.298734 140050645693888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:50:47.714298 140050645693888 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:50:47.722778 140050645693888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:50:47.727005 140050645693888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:50:47.774642 140050645693888 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:50:47.774913 140050645693888 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:50:48.016652 140050645693888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:50:48.065001 140050645693888 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:50:48.065280 140050645693888 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:50:48.285716 140050645693888 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5fef262150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5ff143f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:50:48.286207 140050645693888 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:50:48.618705 140050645693888 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:50:48.621660: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:50:48.634021 140050645693888 tpu_system_metadata.py:148] Found TPU system:
I0812 19:50:48.634329 140050645693888 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:50:48.634814 140050645693888 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:50:48.634877 140050645693888 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:50:48.634932 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:50:48.635214 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:50:48.635271 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:50:48.635320 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:50:48.635370 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:50:48.635416 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:50:48.635464 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:50:48.635520 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:50:48.635567 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:50:48.635613 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:50:48.635662 140050645693888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:50:48.641505 140050645693888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:50:48.653517 140050645693888 estimator.py:1145] Calling model_fn.
W0812 19:50:48.654103 140050645693888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:50:48.924998 140050645693888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:50:49.443749 140050645693888 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:50:49.504455 140050645693888 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:50:49.510381 140050645693888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:50:49.689498 140050645693888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:50:49.703146 140050645693888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:50:49.718430 140050645693888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:50:49.728566 140050645693888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:50:49.734736 140050645693888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:50:50.150280 140050645693888 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:50:50.165847 140050645693888 estimator.py:1147] Done calling model_fn.
I0812 19:50:53.718828 140050645693888 tpu_estimator.py:499] TPU job name worker
I0812 19:50:53.835675 140050645693888 monitored_session.py:240] Graph was finalized.
I0812 19:50:54.398581 140050645693888 session_manager.py:500] Running local_init_op.
I0812 19:50:54.440258 140050645693888 session_manager.py:502] Done running local_init_op.
I0812 19:50:57.141601 140050645693888 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:51:09.644115 140050645693888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:51:09.768415 140050645693888 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:51:09.768867 140050645693888 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:51:09.769282: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:51:09.773931 140050645693888 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:51:09.776530 140050645693888 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:51:09.781084 140050645693888 tpu_estimator.py:557] Init TPU system
I0812 19:51:52.053302 140050645693888 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:51:52.054306 140049614104320 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:51:52.055073 140049605711616 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:51:52.100282 140050645693888 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:51:52.101119 140050645693888 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:51:52.112447 140049597318912 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:51:52.221641 140049597318912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:51:56.586983 140049605711616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:52:00.969866 140050645693888 basic_session_run_hooks.py:262] loss = 2.2509604, step = 30
I0812 19:52:00.972404 140050645693888 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:52:14.642420 140050645693888 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:52:14.642698 140050645693888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:52:14.643024 140049614104320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:52:14.643320 140049614104320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:52:14.643512 140050645693888 error_handling.py:96] infeed marked as finished
I0812 19:52:14.643707 140050645693888 tpu_estimator.py:602] Stop output thread controller
I0812 19:52:14.643779 140050645693888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:52:14.643940 140049605711616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:52:14.644093 140049605711616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:52:14.644237 140050645693888 error_handling.py:96] outfeed marked as finished
I0812 19:52:14.644366 140050645693888 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:52:22.355634 140050645693888 estimator.py:368] Loss for final step: 2.2509604.
I0812 19:52:22.356458 140050645693888 error_handling.py:96] training_loop marked as finished
I0812 19:52:23.140018 140050645693888 estimator.py:1145] Calling model_fn.
E0812 19:52:24.006094 140050645693888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:52:24.243659 140050645693888 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:52:24.267062 140050645693888 estimator.py:1147] Done calling model_fn.
I0812 19:52:24.285702 140050645693888 evaluation.py:255] Starting evaluation at 2019-08-12T19:52:24Z
I0812 19:52:24.285959 140050645693888 tpu_estimator.py:499] TPU job name worker
I0812 19:52:24.372029 140050645693888 monitored_session.py:240] Graph was finalized.
W0812 19:52:24.372813 140050645693888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:52:24.564969 140050645693888 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:52:27.145087 140050645693888 session_manager.py:500] Running local_init_op.
I0812 19:52:27.174216 140050645693888 session_manager.py:502] Done running local_init_op.
I0812 19:52:27.228470 140050645693888 tpu_estimator.py:557] Init TPU system
I0812 19:53:36.057725 140050645693888 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 19:53:36.059043 140049613580032 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:53:36.059973 140049605187328 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:53:36.125468 140050645693888 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:53:36.149266 140050645693888 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:53:36.149605 140050645693888 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:53:36.175023 140049596794624 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:53:36.334902 140049596794624 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:53:36.927428 140049605187328 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:53:37.194428 140050645693888 evaluation.py:167] Evaluation [10/10]
I0812 19:53:37.194789 140050645693888 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:53:37.194957 140050645693888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:53:37.195233 140049613580032 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:53:37.195517 140049613580032 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:53:37.195748 140050645693888 error_handling.py:96] infeed marked as finished
I0812 19:53:37.195947 140050645693888 tpu_estimator.py:602] Stop output thread controller
I0812 19:53:37.196007 140050645693888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:53:37.196213 140049605187328 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:53:37.196369 140049605187328 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:53:37.196530 140050645693888 error_handling.py:96] outfeed marked as finished
I0812 19:53:37.196661 140050645693888 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:54:06.434772 140050645693888 evaluation.py:275] Finished evaluation at 2019-08-12-19:54:06
I0812 19:54:06.435117 140050645693888 estimator.py:2039] Saving dict for global step 30: accuracy = 0.2519, global_step = 30, loss = 2.1666913
I0812 19:54:10.716115 140050645693888 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:54:12.143129 140050645693888 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.1666913, 'global_step': 30, 'accuracy': 0.2519}

Removing gs://yangyou-mnist/log/#1565639451768125...
Removing gs://yangyou-mnist/log/checkpoint#1565639531141740...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565639528049254...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565639469109057...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565639464741251...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565639451.v3-8-tpu#1565639534331861...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565639528932002...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565639456589276...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565639463830634...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565639533405031...
Removing gs://yangyou-mnist/log/eval/#1565639648115743...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565639648.v3-8-tpu#1565639651796466...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:54:16.062169 140015977141696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:54:16.062966 140015977141696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:54:16.065499 140015977141696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:54:16.066477 140015977141696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:54:16.067074 140015977141696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:54:16.067198 140015977141696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:54:16.502223 140015977141696 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:54:16.510283 140015977141696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:54:16.514827 140015977141696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:54:16.556071 140015977141696 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:54:16.556386 140015977141696 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:54:16.681921 140015977141696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:54:16.733416 140015977141696 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:54:16.733702 140015977141696 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:54:16.883985 140015977141696 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f57dcbe0210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f57dedbd210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:54:16.884341 140015977141696 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:54:17.206927 140015977141696 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:54:17.209902: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:54:17.221693 140015977141696 tpu_system_metadata.py:148] Found TPU system:
I0812 19:54:17.221931 140015977141696 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:54:17.222536 140015977141696 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:54:17.222635 140015977141696 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:54:17.222727 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:54:17.223057 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:54:17.223119 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:54:17.223170 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:54:17.223218 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:54:17.223267 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:54:17.223314 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:54:17.223360 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:54:17.223406 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:54:17.223459 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:54:17.223507 140015977141696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:54:17.229588 140015977141696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:54:17.242300 140015977141696 estimator.py:1145] Calling model_fn.
W0812 19:54:17.242948 140015977141696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:54:17.518081 140015977141696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:54:17.952336 140015977141696 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:54:18.014693 140015977141696 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:54:18.020804 140015977141696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:54:18.209271 140015977141696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:54:18.223440 140015977141696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:54:18.239044 140015977141696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:54:18.249284 140015977141696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:54:18.255665 140015977141696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:54:18.675802 140015977141696 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:54:18.691194 140015977141696 estimator.py:1147] Done calling model_fn.
I0812 19:54:22.299279 140015977141696 tpu_estimator.py:499] TPU job name worker
I0812 19:54:22.415833 140015977141696 monitored_session.py:240] Graph was finalized.
I0812 19:54:22.987328 140015977141696 session_manager.py:500] Running local_init_op.
I0812 19:54:23.027820 140015977141696 session_manager.py:502] Done running local_init_op.
I0812 19:54:25.495971 140015977141696 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:54:37.502294 140015977141696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:54:37.614639 140015977141696 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:54:37.615082 140015977141696 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:54:37.615461: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:54:37.621028 140015977141696 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:54:37.623593 140015977141696 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:54:37.627989 140015977141696 tpu_estimator.py:557] Init TPU system
I0812 19:55:20.073443 140015977141696 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 19:55:20.074723 140015217387264 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:55:20.075758 140015208994560 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:55:20.125819 140015977141696 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:55:20.129213 140015977141696 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:55:20.204374 140014725887744 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:55:20.364479 140014725887744 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 19:55:24.791260 140015208994560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:55:29.421909 140015977141696 basic_session_run_hooks.py:262] loss = 2.3024669, step = 30
I0812 19:55:29.424859 140015977141696 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:55:42.652911 140015977141696 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:55:42.653215 140015977141696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:55:42.653456 140015217387264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:55:42.653567 140015217387264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:55:42.653712 140015977141696 error_handling.py:96] infeed marked as finished
I0812 19:55:42.653819 140015977141696 tpu_estimator.py:602] Stop output thread controller
I0812 19:55:42.653877 140015977141696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:55:42.654000 140015208994560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:55:42.654092 140015208994560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:55:42.654272 140015977141696 error_handling.py:96] outfeed marked as finished
I0812 19:55:42.654376 140015977141696 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:55:50.497874 140015977141696 estimator.py:368] Loss for final step: 2.3024669.
I0812 19:55:50.498748 140015977141696 error_handling.py:96] training_loop marked as finished
I0812 19:55:51.261776 140015977141696 estimator.py:1145] Calling model_fn.
E0812 19:55:51.956939 140015977141696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:55:52.195975 140015977141696 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:55:52.218194 140015977141696 estimator.py:1147] Done calling model_fn.
I0812 19:55:52.234003 140015977141696 evaluation.py:255] Starting evaluation at 2019-08-12T19:55:52Z
I0812 19:55:52.234277 140015977141696 tpu_estimator.py:499] TPU job name worker
I0812 19:55:52.312300 140015977141696 monitored_session.py:240] Graph was finalized.
W0812 19:55:52.313085 140015977141696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:55:52.512285 140015977141696 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:55:55.095145 140015977141696 session_manager.py:500] Running local_init_op.
I0812 19:55:55.118891 140015977141696 session_manager.py:502] Done running local_init_op.
I0812 19:55:55.171626 140015977141696 tpu_estimator.py:557] Init TPU system
I0812 19:57:03.998848 140015977141696 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 19:57:03.999773 140014725887744 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:57:04.000272 140014717495040 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:57:04.063824 140015977141696 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:57:04.086591 140015977141696 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 19:57:04.086944 140015977141696 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 19:57:04.165945 140014709102336 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:57:04.288621 140014709102336 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:57:04.849411 140014717495040 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:57:05.166115 140015977141696 evaluation.py:167] Evaluation [10/10]
I0812 19:57:05.166484 140015977141696 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:57:05.166559 140015977141696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:57:05.166743 140014725887744 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:57:05.166876 140014725887744 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:57:05.167012 140015977141696 error_handling.py:96] infeed marked as finished
I0812 19:57:05.167105 140015977141696 tpu_estimator.py:602] Stop output thread controller
I0812 19:57:05.167155 140015977141696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:57:05.167346 140014717495040 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:57:05.167454 140014717495040 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:57:05.167570 140015977141696 error_handling.py:96] outfeed marked as finished
I0812 19:57:05.167646 140015977141696 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:57:34.386800 140015977141696 evaluation.py:275] Finished evaluation at 2019-08-12-19:57:34
I0812 19:57:34.387254 140015977141696 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2986817
I0812 19:57:38.536756 140015977141696 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 19:57:39.435461 140015977141696 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2986817, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565639660244320...
Removing gs://yangyou-mnist/log/checkpoint#1565639739267556...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565639677011660...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565639672522945...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565639660.v3-8-tpu#1565639742345420...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565639664960039...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565639671594449...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565639736186889...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565639737044614...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565639741399412...
Removing gs://yangyou-mnist/log/eval/#1565639856058841...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565639856.v3-8-tpu#1565639859124263...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 19:57:43.280843 140666629457344 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 19:57:43.281615 140666629457344 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 19:57:43.284252 140666629457344 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 19:57:43.285046 140666629457344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 19:57:43.285615 140666629457344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 19:57:43.285739 140666629457344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 19:57:43.696412 140666629457344 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 19:57:43.702586 140666629457344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 19:57:43.706294 140666629457344 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:57:43.746697 140666629457344 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:57:43.746958 140666629457344 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:57:43.940073 140666629457344 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 19:57:43.984247 140666629457344 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 19:57:43.984522 140666629457344 transport.py:157] Attempting refresh to obtain initial access_token
I0812 19:57:44.132889 140666629457344 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fef5aa47290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fef5cc241d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 19:57:44.133248 140666629457344 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 19:57:44.456866 140666629457344 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 19:57:44.459903: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:57:44.471858 140666629457344 tpu_system_metadata.py:148] Found TPU system:
I0812 19:57:44.472106 140666629457344 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 19:57:44.472585 140666629457344 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 19:57:44.472644 140666629457344 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 19:57:44.472695 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 19:57:44.472990 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 19:57:44.473047 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 19:57:44.473107 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 19:57:44.473155 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 19:57:44.473201 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 19:57:44.473247 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 19:57:44.473293 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 19:57:44.473337 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 19:57:44.473382 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 19:57:44.473428 140666629457344 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 19:57:44.479429 140666629457344 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 19:57:44.491789 140666629457344 estimator.py:1145] Calling model_fn.
W0812 19:57:44.492407 140666629457344 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 19:57:44.769156 140666629457344 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 19:57:45.182240 140666629457344 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 19:57:45.244105 140666629457344 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 19:57:45.251519 140666629457344 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:57:45.435775 140666629457344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 19:57:45.449399 140666629457344 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 19:57:45.464438 140666629457344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 19:57:45.474641 140666629457344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 19:57:45.480530 140666629457344 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 19:57:45.888187 140666629457344 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 19:57:45.903651 140666629457344 estimator.py:1147] Done calling model_fn.
I0812 19:57:49.188764 140666629457344 tpu_estimator.py:499] TPU job name worker
I0812 19:57:49.309595 140666629457344 monitored_session.py:240] Graph was finalized.
I0812 19:57:49.883800 140666629457344 session_manager.py:500] Running local_init_op.
I0812 19:57:49.925753 140666629457344 session_manager.py:502] Done running local_init_op.
I0812 19:57:52.456657 140666629457344 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 19:58:04.453222 140666629457344 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 19:58:04.573023 140666629457344 util.py:98] Initialized dataset iterators in 0 seconds
I0812 19:58:04.573491 140666629457344 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 19:58:04.573862: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 19:58:04.579402 140666629457344 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 19:58:04.581693 140666629457344 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 19:58:04.585530 140666629457344 tpu_estimator.py:557] Init TPU system
I0812 19:58:48.061249 140666629457344 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 19:58:48.062294 140665723799296 tpu_estimator.py:514] Starting infeed thread controller.
I0812 19:58:48.062807 140665715406592 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 19:58:48.108899 140666629457344 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 19:58:48.109806 140666629457344 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 19:58:48.122847 140665707013888 transport.py:157] Attempting refresh to obtain initial access_token
W0812 19:58:48.234342 140665707013888 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 19:58:52.473644 140665715406592 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 19:58:57.057508 140666629457344 basic_session_run_hooks.py:262] loss = 2.3020298, step = 30
I0812 19:58:57.060580 140666629457344 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 19:59:10.503226 140666629457344 tpu_estimator.py:598] Stop infeed thread controller
I0812 19:59:10.503528 140666629457344 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 19:59:10.503747 140665723799296 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 19:59:10.503860 140665723799296 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 19:59:10.504007 140666629457344 error_handling.py:96] infeed marked as finished
I0812 19:59:10.504098 140666629457344 tpu_estimator.py:602] Stop output thread controller
I0812 19:59:10.504147 140666629457344 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 19:59:10.504261 140665715406592 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 19:59:10.504336 140665715406592 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 19:59:10.504450 140666629457344 error_handling.py:96] outfeed marked as finished
I0812 19:59:10.504528 140666629457344 tpu_estimator.py:606] Shutdown TPU system.
I0812 19:59:18.368303 140666629457344 estimator.py:368] Loss for final step: 2.3020298.
I0812 19:59:18.369177 140666629457344 error_handling.py:96] training_loop marked as finished
I0812 19:59:19.254163 140666629457344 estimator.py:1145] Calling model_fn.
E0812 19:59:20.161623 140666629457344 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 19:59:20.386090 140666629457344 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 19:59:20.409454 140666629457344 estimator.py:1147] Done calling model_fn.
I0812 19:59:20.428369 140666629457344 evaluation.py:255] Starting evaluation at 2019-08-12T19:59:20Z
I0812 19:59:20.428620 140666629457344 tpu_estimator.py:499] TPU job name worker
I0812 19:59:20.517205 140666629457344 monitored_session.py:240] Graph was finalized.
W0812 19:59:20.518002 140666629457344 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 19:59:20.709836 140666629457344 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 19:59:23.488744 140666629457344 session_manager.py:500] Running local_init_op.
I0812 19:59:23.518208 140666629457344 session_manager.py:502] Done running local_init_op.
I0812 19:59:23.564955 140666629457344 tpu_estimator.py:557] Init TPU system
I0812 20:00:32.021456 140666629457344 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:00:32.022454 140665723799296 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:00:32.023008 140665715406592 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:00:32.086654 140666629457344 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:00:32.112138 140666629457344 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:00:32.112469 140666629457344 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:00:32.146673 140665707013888 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:00:32.247373 140665707013888 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:00:32.865938 140665715406592 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:00:33.351749 140666629457344 evaluation.py:167] Evaluation [10/10]
I0812 20:00:33.352081 140666629457344 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:00:33.352262 140666629457344 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:00:33.352583 140665723799296 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:00:33.352713 140665723799296 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:00:33.352916 140666629457344 error_handling.py:96] infeed marked as finished
I0812 20:00:33.353037 140666629457344 tpu_estimator.py:602] Stop output thread controller
I0812 20:00:33.353092 140666629457344 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:00:33.353264 140665715406592 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:00:33.353352 140665715406592 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:00:33.353522 140666629457344 error_handling.py:96] outfeed marked as finished
I0812 20:00:33.353625 140666629457344 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:01:02.339432 140666629457344 evaluation.py:275] Finished evaluation at 2019-08-12-20:01:02
I0812 20:01:02.339792 140666629457344 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2982018
I0812 20:01:06.806230 140666629457344 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:01:07.624623 140666629457344 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2982018, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565639867355604...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565639879500321...
Removing gs://yangyou-mnist/log/checkpoint#1565639947021457...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565639883957942...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565639943914562...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565639878596084...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565639867.v3-8-tpu#1565639950198197...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565639944875077...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565639871926588...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565639949267621...
Removing gs://yangyou-mnist/log/eval/#1565640064026546...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565640064.v3-8-tpu#1565640067312897...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:01:11.546386 139723367921088 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:01:11.547178 139723367921088 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:01:11.549786 139723367921088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:01:11.550684 139723367921088 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:01:11.551285 139723367921088 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:01:11.551419 139723367921088 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:01:11.971913 139723367921088 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:01:11.978760 139723367921088 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:01:11.982789 139723367921088 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:01:12.023109 139723367921088 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:01:12.023416 139723367921088 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:01:12.152873 139723367921088 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:01:12.200973 139723367921088 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:01:12.201261 139723367921088 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:01:12.435484 139723367921088 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f13bbdfa190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f13bdfd7210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:01:12.435893 139723367921088 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:01:12.785886 139723367921088 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:01:12.789028: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:01:12.801875 139723367921088 tpu_system_metadata.py:148] Found TPU system:
I0812 20:01:12.802184 139723367921088 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:01:12.802732 139723367921088 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:01:12.802792 139723367921088 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:01:12.802845 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:01:12.803141 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:01:12.803196 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:01:12.803246 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:01:12.803301 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:01:12.803348 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:01:12.803394 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:01:12.803443 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:01:12.803489 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:01:12.803549 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:01:12.803596 139723367921088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:01:12.809592 139723367921088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:01:12.822101 139723367921088 estimator.py:1145] Calling model_fn.
W0812 20:01:12.822804 139723367921088 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:01:13.121115 139723367921088 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:01:13.768800 139723367921088 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:01:13.831438 139723367921088 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:01:13.837310 139723367921088 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:01:14.017784 139723367921088 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:01:14.031663 139723367921088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:01:14.046886 139723367921088 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:01:14.057185 139723367921088 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:01:14.063342 139723367921088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:01:14.492984 139723367921088 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:01:14.508799 139723367921088 estimator.py:1147] Done calling model_fn.
I0812 20:01:17.770694 139723367921088 tpu_estimator.py:499] TPU job name worker
I0812 20:01:17.892571 139723367921088 monitored_session.py:240] Graph was finalized.
I0812 20:01:18.466393 139723367921088 session_manager.py:500] Running local_init_op.
I0812 20:01:18.507834 139723367921088 session_manager.py:502] Done running local_init_op.
I0812 20:01:21.101070 139723367921088 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:01:33.154711 139723367921088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:01:33.282258 139723367921088 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:01:33.282743 139723367921088 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:01:33.283331: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:01:33.287714 139723367921088 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:01:33.290081 139723367921088 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:01:33.294267 139723367921088 tpu_estimator.py:557] Init TPU system
I0812 20:02:16.082086 139723367921088 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:02:16.083133 139722332567296 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:02:16.083637 139722324174592 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:02:16.129987 139723367921088 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:02:16.130948 139723367921088 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:02:16.147612 139722315781888 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:02:16.373316 139722315781888 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:02:20.500252 139722324174592 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:02:25.138797 139723367921088 basic_session_run_hooks.py:262] loss = 1.2521107, step = 30
I0812 20:02:25.142682 139723367921088 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:02:38.591176 139723367921088 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:02:38.591470 139723367921088 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:02:38.591775 139722332567296 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:02:38.592094 139722332567296 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:02:38.592401 139723367921088 error_handling.py:96] infeed marked as finished
I0812 20:02:38.592623 139723367921088 tpu_estimator.py:602] Stop output thread controller
I0812 20:02:38.592689 139723367921088 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:02:38.592920 139722324174592 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:02:38.593087 139722324174592 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:02:38.593327 139723367921088 error_handling.py:96] outfeed marked as finished
I0812 20:02:38.593467 139723367921088 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:02:46.508832 139723367921088 estimator.py:368] Loss for final step: 1.2521107.
I0812 20:02:46.509695 139723367921088 error_handling.py:96] training_loop marked as finished
I0812 20:02:47.211069 139723367921088 estimator.py:1145] Calling model_fn.
E0812 20:02:47.960895 139723367921088 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:02:48.191375 139723367921088 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:02:48.214363 139723367921088 estimator.py:1147] Done calling model_fn.
I0812 20:02:48.231069 139723367921088 evaluation.py:255] Starting evaluation at 2019-08-12T20:02:48Z
I0812 20:02:48.231307 139723367921088 tpu_estimator.py:499] TPU job name worker
I0812 20:02:48.307643 139723367921088 monitored_session.py:240] Graph was finalized.
W0812 20:02:48.308382 139723367921088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:02:48.499162 139723367921088 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:02:51.033790 139723367921088 session_manager.py:500] Running local_init_op.
I0812 20:02:51.058306 139723367921088 session_manager.py:502] Done running local_init_op.
I0812 20:02:51.107652 139723367921088 tpu_estimator.py:557] Init TPU system
I0812 20:04:00.064250 139723367921088 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:04:00.065251 139722332567296 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:04:00.065782 139722324174592 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:04:00.132812 139723367921088 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:04:00.160837 139723367921088 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:04:00.161201 139723367921088 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:04:00.190860 139722315781888 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:04:00.414225 139722315781888 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:04:00.934652 139722324174592 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:04:01.271681 139723367921088 evaluation.py:167] Evaluation [10/10]
I0812 20:04:01.272013 139723367921088 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:04:01.272083 139723367921088 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:04:01.272260 139722332567296 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:04:01.272358 139722332567296 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:04:01.272490 139723367921088 error_handling.py:96] infeed marked as finished
I0812 20:04:01.272588 139723367921088 tpu_estimator.py:602] Stop output thread controller
I0812 20:04:01.272639 139723367921088 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:04:01.272746 139722324174592 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:04:01.272815 139722324174592 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:04:01.272922 139723367921088 error_handling.py:96] outfeed marked as finished
I0812 20:04:01.273000 139723367921088 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:04:30.503066 139723367921088 evaluation.py:275] Finished evaluation at 2019-08-12-20:04:30
I0812 20:04:30.503468 139723367921088 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8155, global_step = 30, loss = 1.1615751
I0812 20:04:35.154568 139723367921088 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:04:37.129728 139723367921088 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.1615751, 'global_step': 30, 'accuracy': 0.8155}

Removing gs://yangyou-mnist/log/#1565640075975174...
Removing gs://yangyou-mnist/log/checkpoint#1565640155025677...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565640080563128...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565640076.v3-8-tpu#1565640158282673...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565640087278588...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565640088166104...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565640092661585...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565640152830861...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565640151968882...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565640157284000...
Removing gs://yangyou-mnist/log/eval/#1565640272211968...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565640272.v3-8-tpu#1565640276822560...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:04:41.065071 140521241392576 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:04:41.065890 140521241392576 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:04:41.068641 140521241392576 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:04:41.069452 140521241392576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:04:41.070018 140521241392576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:04:41.070306 140521241392576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:04:41.472963 140521241392576 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:04:41.479391 140521241392576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:04:41.482949 140521241392576 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:04:41.526443 140521241392576 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:04:41.526715 140521241392576 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:04:41.642592 140521241392576 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:04:41.692734 140521241392576 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:04:41.693005 140521241392576 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:04:41.898353 140521241392576 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcd80d6a1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcd82f47210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:04:41.898736 140521241392576 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:04:42.279489 140521241392576 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:04:42.282290: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:04:42.293123 140521241392576 tpu_system_metadata.py:148] Found TPU system:
I0812 20:04:42.293351 140521241392576 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:04:42.293925 140521241392576 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:04:42.293984 140521241392576 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:04:42.294038 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:04:42.294394 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:04:42.294454 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:04:42.294513 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:04:42.294565 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:04:42.294619 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:04:42.294666 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:04:42.294713 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:04:42.294759 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:04:42.294805 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:04:42.294852 140521241392576 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:04:42.300590 140521241392576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:04:42.312509 140521241392576 estimator.py:1145] Calling model_fn.
W0812 20:04:42.313100 140521241392576 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:04:42.591629 140521241392576 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:04:42.999785 140521241392576 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:04:43.062196 140521241392576 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:04:43.068044 140521241392576 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:04:43.256170 140521241392576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:04:43.269675 140521241392576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:04:43.284648 140521241392576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:04:43.294764 140521241392576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:04:43.300709 140521241392576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:04:43.710556 140521241392576 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:04:43.725789 140521241392576 estimator.py:1147] Done calling model_fn.
I0812 20:04:47.191960 140521241392576 tpu_estimator.py:499] TPU job name worker
I0812 20:04:47.313380 140521241392576 monitored_session.py:240] Graph was finalized.
I0812 20:04:47.886904 140521241392576 session_manager.py:500] Running local_init_op.
I0812 20:04:47.928838 140521241392576 session_manager.py:502] Done running local_init_op.
I0812 20:04:50.473066 140521241392576 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:05:02.972434 140521241392576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:05:03.080699 140521241392576 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:05:03.081120 140521241392576 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:05:03.081612: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:05:03.086263 140521241392576 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:05:03.088617 140521241392576 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:05:03.092438 140521241392576 tpu_estimator.py:557] Init TPU system
I0812 20:05:44.062727 140521241392576 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0812 20:05:44.063828 140520473466624 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:05:44.064805 140519988524800 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:05:44.112201 140521241392576 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:05:44.113049 140521241392576 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:05:44.132339 140519980132096 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:05:44.307876 140519980132096 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:05:48.801028 140519988524800 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:05:53.361339 140521241392576 basic_session_run_hooks.py:262] loss = 0.5591414, step = 30
I0812 20:05:53.363537 140521241392576 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:06:07.075372 140521241392576 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:06:07.075691 140521241392576 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:06:07.076010 140520473466624 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:06:07.076332 140520473466624 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:06:07.076569 140521241392576 error_handling.py:96] infeed marked as finished
I0812 20:06:07.076817 140521241392576 tpu_estimator.py:602] Stop output thread controller
I0812 20:06:07.076894 140521241392576 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:06:07.077157 140519988524800 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:06:07.077411 140519988524800 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:06:07.077625 140521241392576 error_handling.py:96] outfeed marked as finished
I0812 20:06:07.077801 140521241392576 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:06:14.443280 140521241392576 estimator.py:368] Loss for final step: 0.5591414.
I0812 20:06:14.444138 140521241392576 error_handling.py:96] training_loop marked as finished
I0812 20:06:15.172432 140521241392576 estimator.py:1145] Calling model_fn.
E0812 20:06:15.896445 140521241392576 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:06:16.151196 140521241392576 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:06:16.176971 140521241392576 estimator.py:1147] Done calling model_fn.
I0812 20:06:16.196543 140521241392576 evaluation.py:255] Starting evaluation at 2019-08-12T20:06:16Z
I0812 20:06:16.196822 140521241392576 tpu_estimator.py:499] TPU job name worker
I0812 20:06:16.285792 140521241392576 monitored_session.py:240] Graph was finalized.
W0812 20:06:16.286586 140521241392576 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:06:16.481817 140521241392576 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:06:18.991067 140521241392576 session_manager.py:500] Running local_init_op.
I0812 20:06:19.019866 140521241392576 session_manager.py:502] Done running local_init_op.
I0812 20:06:19.073035 140521241392576 tpu_estimator.py:557] Init TPU system
I0812 20:07:28.059216 140521241392576 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:07:28.060328 140519988524800 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:07:28.060849 140519980132096 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:07:28.127156 140521241392576 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:07:28.154479 140521241392576 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:07:28.154997 140521241392576 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:07:28.177048 140519971739392 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:07:28.289192 140519971739392 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:07:28.929512 140519980132096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:07:29.248069 140521241392576 evaluation.py:167] Evaluation [10/10]
I0812 20:07:29.248425 140521241392576 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:07:29.248538 140521241392576 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:07:29.248855 140519988524800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:07:29.249181 140519988524800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:07:29.249403 140521241392576 error_handling.py:96] infeed marked as finished
I0812 20:07:29.249614 140521241392576 tpu_estimator.py:602] Stop output thread controller
I0812 20:07:29.249675 140521241392576 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:07:29.249854 140519980132096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:07:29.250063 140519980132096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:07:29.250364 140521241392576 error_handling.py:96] outfeed marked as finished
I0812 20:07:29.250536 140521241392576 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:07:58.389365 140521241392576 evaluation.py:275] Finished evaluation at 2019-08-12-20:07:58
I0812 20:07:58.389714 140521241392576 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8716, global_step = 30, loss = 0.51139724
I0812 20:08:02.661338 140521241392576 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:08:03.429640 140521241392576 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.51139724, 'global_step': 30, 'accuracy': 0.8716}

Removing gs://yangyou-mnist/log/#1565640285258003...
Removing gs://yangyou-mnist/log/checkpoint#1565640363377025...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565640297958723...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565640285.v3-8-tpu#1565640366769423...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565640302490201...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565640289939086...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565640360047372...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565640361048589...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565640297090784...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565640365794672...
Removing gs://yangyou-mnist/log/eval/#1565640480017015...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565640480.v3-8-tpu#1565640483123097...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:08:07.427035 139650681259456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:08:07.427849 139650681259456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:08:07.430463 139650681259456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:08:07.431282 139650681259456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:08:07.431864 139650681259456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:08:07.431993 139650681259456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:08:07.844486 139650681259456 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:08:07.851967 139650681259456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:08:07.856093 139650681259456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:08:07.898268 139650681259456 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:08:07.898542 139650681259456 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:08:08.161048 139650681259456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:08:08.210267 139650681259456 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:08:08.210580 139650681259456 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:08:08.332573 139650681259456 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f02cf67c610>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f02d1870210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:08:08.332952 139650681259456 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:08:08.694353 139650681259456 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:08:08.698194: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:08:08.711637 139650681259456 tpu_system_metadata.py:148] Found TPU system:
I0812 20:08:08.711926 139650681259456 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:08:08.712440 139650681259456 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:08:08.712505 139650681259456 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:08:08.712558 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:08:08.712858 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:08:08.713017 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:08:08.713072 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:08:08.713120 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:08:08.713171 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:08:08.713219 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:08:08.713267 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:08:08.713314 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:08:08.713360 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:08:08.713412 139650681259456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:08:08.719759 139650681259456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:08:08.732523 139650681259456 estimator.py:1145] Calling model_fn.
W0812 20:08:08.733161 139650681259456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:08:09.003531 139650681259456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:08:09.608728 139650681259456 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:08:09.671508 139650681259456 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:08:09.677567 139650681259456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:08:09.863697 139650681259456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:08:09.878063 139650681259456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:08:09.893512 139650681259456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:08:09.903923 139650681259456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:08:09.910027 139650681259456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:08:10.356153 139650681259456 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:08:10.372524 139650681259456 estimator.py:1147] Done calling model_fn.
I0812 20:08:13.992825 139650681259456 tpu_estimator.py:499] TPU job name worker
I0812 20:08:14.113723 139650681259456 monitored_session.py:240] Graph was finalized.
I0812 20:08:14.715596 139650681259456 session_manager.py:500] Running local_init_op.
I0812 20:08:14.755465 139650681259456 session_manager.py:502] Done running local_init_op.
I0812 20:08:17.381361 139650681259456 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:08:29.201122 139650681259456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:08:29.312818 139650681259456 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:08:29.313328 139650681259456 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:08:29.313719: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:08:29.318192 139650681259456 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:08:29.320636 139650681259456 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:08:29.324671 139650681259456 tpu_estimator.py:557] Init TPU system
I0812 20:09:11.965353 139650681259456 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:09:11.966485 139649905317632 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:09:11.967341 139649896924928 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:09:12.012279 139650681259456 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:09:12.013191 139650681259456 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:09:12.029232 139649888532224 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:09:12.150368 139649888532224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:09:16.438649 139649896924928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:09:20.849391 139650681259456 basic_session_run_hooks.py:262] loss = 0.3306785, step = 30
I0812 20:09:20.851728 139650681259456 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:09:33.335859 139650681259456 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:09:33.336209 139650681259456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:09:33.336549 139649905317632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:09:33.336872 139649905317632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:09:33.337116 139650681259456 error_handling.py:96] infeed marked as finished
I0812 20:09:33.337321 139650681259456 tpu_estimator.py:602] Stop output thread controller
I0812 20:09:33.337373 139650681259456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:09:33.337546 139649896924928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:09:33.337711 139649896924928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:09:33.337905 139650681259456 error_handling.py:96] outfeed marked as finished
I0812 20:09:33.338084 139650681259456 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:09:42.288218 139650681259456 estimator.py:368] Loss for final step: 0.3306785.
I0812 20:09:42.289134 139650681259456 error_handling.py:96] training_loop marked as finished
I0812 20:09:42.987484 139650681259456 estimator.py:1145] Calling model_fn.
E0812 20:09:43.712145 139650681259456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:09:43.931535 139650681259456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:09:43.954652 139650681259456 estimator.py:1147] Done calling model_fn.
I0812 20:09:43.971235 139650681259456 evaluation.py:255] Starting evaluation at 2019-08-12T20:09:43Z
I0812 20:09:43.971481 139650681259456 tpu_estimator.py:499] TPU job name worker
I0812 20:09:44.048629 139650681259456 monitored_session.py:240] Graph was finalized.
W0812 20:09:44.049403 139650681259456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:09:44.227404 139650681259456 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:09:46.944077 139650681259456 session_manager.py:500] Running local_init_op.
I0812 20:09:46.973334 139650681259456 session_manager.py:502] Done running local_init_op.
I0812 20:09:47.028620 139650681259456 tpu_estimator.py:557] Init TPU system
I0812 20:10:56.023658 139650681259456 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:10:56.024683 139649896924928 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:10:56.025244 139649888532224 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:10:56.091474 139650681259456 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:10:56.119255 139650681259456 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:10:56.119590 139650681259456 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:10:56.151987 139649880139520 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:10:56.388046 139649880139520 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:10:56.883913 139649888532224 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:10:57.273369 139650681259456 evaluation.py:167] Evaluation [10/10]
I0812 20:10:57.273732 139650681259456 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:10:57.273817 139650681259456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:10:57.274070 139649896924928 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:10:57.274229 139649896924928 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:10:57.274403 139650681259456 error_handling.py:96] infeed marked as finished
I0812 20:10:57.274503 139650681259456 tpu_estimator.py:602] Stop output thread controller
I0812 20:10:57.274554 139650681259456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:10:57.274692 139649888532224 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:10:57.274769 139649888532224 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:10:57.274991 139650681259456 error_handling.py:96] outfeed marked as finished
I0812 20:10:57.275116 139650681259456 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:11:26.460057 139650681259456 evaluation.py:275] Finished evaluation at 2019-08-12-20:11:26
I0812 20:11:26.460438 139650681259456 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9214, global_step = 30, loss = 0.32098266
I0812 20:11:30.786330 139650681259456 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:11:31.552683 139650681259456 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.32098266, 'global_step': 30, 'accuracy': 0.9214}

Removing gs://yangyou-mnist/log/#1565640492058273...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565640492.v3-8-tpu#1565640573040221...
Removing gs://yangyou-mnist/log/checkpoint#1565640570113846...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565640496829365...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565640504415392...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565640503476499...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565640508722060...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565640567354657...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565640568147408...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565640572173499...
Removing gs://yangyou-mnist/log/eval/#1565640688184716...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565640688.v3-8-tpu#1565640691267454...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:11:35.418943 140195945850304 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:11:35.419714 140195945850304 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:11:35.422349 140195945850304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:11:35.423182 140195945850304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:11:35.423765 140195945850304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:11:35.423893 140195945850304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:11:35.836155 140195945850304 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:11:35.842835 140195945850304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:11:35.846560 140195945850304 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:11:35.894723 140195945850304 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:11:35.895013 140195945850304 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:11:36.137860 140195945850304 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:11:36.187755 140195945850304 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:11:36.188051 140195945850304 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:11:36.400239 140195945850304 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f81c3b69290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f81c5d46210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:11:36.400604 140195945850304 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:11:36.708115 140195945850304 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:11:36.711096: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:11:36.727368 140195945850304 tpu_system_metadata.py:148] Found TPU system:
I0812 20:11:36.727613 140195945850304 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:11:36.728140 140195945850304 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:11:36.728198 140195945850304 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:11:36.728250 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:11:36.728545 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:11:36.728600 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:11:36.728651 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:11:36.728698 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:11:36.728748 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:11:36.728796 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:11:36.728851 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:11:36.728909 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:11:36.728955 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:11:36.729012 140195945850304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:11:36.735291 140195945850304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:11:36.748065 140195945850304 estimator.py:1145] Calling model_fn.
W0812 20:11:36.748682 140195945850304 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:11:37.047899 140195945850304 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:11:37.761826 140195945850304 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:11:37.823520 140195945850304 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:11:37.829405 140195945850304 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:11:38.007453 140195945850304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:11:38.021358 140195945850304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:11:38.036604 140195945850304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:11:38.046838 140195945850304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:11:38.052985 140195945850304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:11:38.476640 140195945850304 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:11:38.492296 140195945850304 estimator.py:1147] Done calling model_fn.
I0812 20:11:41.863168 140195945850304 tpu_estimator.py:499] TPU job name worker
I0812 20:11:41.979268 140195945850304 monitored_session.py:240] Graph was finalized.
I0812 20:11:42.545552 140195945850304 session_manager.py:500] Running local_init_op.
I0812 20:11:42.586494 140195945850304 session_manager.py:502] Done running local_init_op.
I0812 20:11:44.964509 140195945850304 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:11:56.919783 140195945850304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:11:57.043255 140195945850304 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:11:57.043709 140195945850304 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:11:57.044119: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:11:57.049554 140195945850304 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:11:57.051852 140195945850304 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:11:57.056512 140195945850304 tpu_estimator.py:557] Init TPU system
I0812 20:12:40.064413 140195945850304 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 20:12:40.065460 140194913187584 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:12:40.066639 140194904794880 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:12:40.113915 140195945850304 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:12:40.115093 140195945850304 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:12:40.127055 140194896402176 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:12:40.242847 140194896402176 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:12:44.950367 140194904794880 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:12:49.519932 140195945850304 basic_session_run_hooks.py:262] loss = 0.29183543, step = 30
I0812 20:12:49.522983 140195945850304 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:13:02.531488 140195945850304 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:13:02.531800 140195945850304 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:13:02.532196 140194913187584 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:13:02.532493 140194913187584 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:13:02.532721 140195945850304 error_handling.py:96] infeed marked as finished
I0812 20:13:02.533013 140195945850304 tpu_estimator.py:602] Stop output thread controller
I0812 20:13:02.533068 140195945850304 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:13:02.533246 140194904794880 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:13:02.533412 140194904794880 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:13:02.533608 140195945850304 error_handling.py:96] outfeed marked as finished
I0812 20:13:02.533889 140195945850304 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:13:10.388917 140195945850304 estimator.py:368] Loss for final step: 0.29183543.
I0812 20:13:10.389796 140195945850304 error_handling.py:96] training_loop marked as finished
I0812 20:13:11.199650 140195945850304 estimator.py:1145] Calling model_fn.
E0812 20:13:11.928237 140195945850304 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:13:12.183243 140195945850304 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:13:12.211333 140195945850304 estimator.py:1147] Done calling model_fn.
I0812 20:13:12.229747 140195945850304 evaluation.py:255] Starting evaluation at 2019-08-12T20:13:12Z
I0812 20:13:12.230003 140195945850304 tpu_estimator.py:499] TPU job name worker
I0812 20:13:12.312258 140195945850304 monitored_session.py:240] Graph was finalized.
W0812 20:13:12.313091 140195945850304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:13:12.501764 140195945850304 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:13:15.248143 140195945850304 session_manager.py:500] Running local_init_op.
I0812 20:13:15.272697 140195945850304 session_manager.py:502] Done running local_init_op.
I0812 20:13:15.328061 140195945850304 tpu_estimator.py:557] Init TPU system
I0812 20:14:24.009648 140195945850304 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:14:24.010601 140194904794880 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:14:24.011076 140194896402176 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:14:24.076555 140195945850304 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:14:24.101955 140195945850304 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:14:24.102416 140195945850304 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:14:24.135118 140194888009472 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:14:24.249365 140194888009472 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:14:24.860430 140194896402176 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:14:25.333173 140195945850304 evaluation.py:167] Evaluation [10/10]
I0812 20:14:25.333528 140195945850304 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:14:25.333647 140195945850304 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:14:25.333837 140194904794880 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:14:25.333920 140194904794880 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:14:25.334064 140195945850304 error_handling.py:96] infeed marked as finished
I0812 20:14:25.334187 140195945850304 tpu_estimator.py:602] Stop output thread controller
I0812 20:14:25.334252 140195945850304 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:14:25.334368 140194896402176 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:14:25.334439 140194896402176 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:14:25.334551 140195945850304 error_handling.py:96] outfeed marked as finished
I0812 20:14:25.334638 140195945850304 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:14:54.349353 140195945850304 evaluation.py:275] Finished evaluation at 2019-08-12-20:14:54
I0812 20:14:54.349719 140195945850304 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9313, global_step = 30, loss = 0.26870185
I0812 20:14:58.805516 140195945850304 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:14:59.579384 140195945850304 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.26870185, 'global_step': 30, 'accuracy': 0.9313}

Removing gs://yangyou-mnist/log/#1565640699977328...
Removing gs://yangyou-mnist/log/checkpoint#1565640779140240...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565640700.v3-8-tpu#1565640782219149...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565640712325652...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565640704480787...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565640711526987...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565640716438249...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565640776956569...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565640776096115...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565640781289141...
Removing gs://yangyou-mnist/log/eval/#1565640896014943...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565640896.v3-8-tpu#1565640899265631...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:15:03.549145 140231071442368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:15:03.549932 140231071442368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:15:03.552587 140231071442368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:15:03.553419 140231071442368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:15:03.553997 140231071442368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:15:03.554124 140231071442368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:15:03.973020 140231071442368 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:15:03.980146 140231071442368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:15:03.983990 140231071442368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:15:04.080791 140231071442368 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:15:04.081072 140231071442368 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:15:04.186558 140231071442368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:15:04.285024 140231071442368 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:15:04.285299 140231071442368 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:15:04.432252 140231071442368 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f89f15c9190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f89f37a6210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:15:04.432622 140231071442368 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:15:04.768522 140231071442368 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:15:04.771605: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:15:04.784324 140231071442368 tpu_system_metadata.py:148] Found TPU system:
I0812 20:15:04.784681 140231071442368 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:15:04.785186 140231071442368 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:15:04.785243 140231071442368 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:15:04.785295 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:15:04.785598 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:15:04.785655 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:15:04.785706 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:15:04.785753 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:15:04.785800 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:15:04.785845 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:15:04.785891 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:15:04.785937 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:15:04.785981 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:15:04.786032 140231071442368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:15:04.792284 140231071442368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:15:04.805250 140231071442368 estimator.py:1145] Calling model_fn.
W0812 20:15:04.805875 140231071442368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:15:05.083177 140231071442368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:15:05.682519 140231071442368 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:15:05.746180 140231071442368 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:15:05.751983 140231071442368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:15:05.935034 140231071442368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:15:05.949172 140231071442368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:15:05.965025 140231071442368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:15:05.975357 140231071442368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:15:05.981532 140231071442368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:15:06.417390 140231071442368 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:15:06.433329 140231071442368 estimator.py:1147] Done calling model_fn.
I0812 20:15:09.725254 140231071442368 tpu_estimator.py:499] TPU job name worker
I0812 20:15:09.841700 140231071442368 monitored_session.py:240] Graph was finalized.
I0812 20:15:10.454345 140231071442368 session_manager.py:500] Running local_init_op.
I0812 20:15:10.486406 140231071442368 session_manager.py:502] Done running local_init_op.
I0812 20:15:12.986699 140231071442368 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:15:24.815057 140231071442368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:15:24.941612 140231071442368 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:15:24.942070 140231071442368 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:15:24.942489: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:15:24.947611 140231071442368 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:15:24.949992 140231071442368 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:15:24.954103 140231071442368 tpu_estimator.py:557] Init TPU system
I0812 20:16:08.073200 140231071442368 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 20:16:08.074348 140230311786240 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:16:08.075272 140230303393536 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:16:08.124739 140231071442368 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:16:08.125711 140231071442368 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:16:08.139291 140230295000832 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:16:08.257508 140230295000832 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:16:12.734124 140230303393536 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:16:17.279604 140231071442368 basic_session_run_hooks.py:262] loss = 0.2772227, step = 30
I0812 20:16:17.282521 140231071442368 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:16:30.443631 140231071442368 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:16:30.444004 140231071442368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:16:30.445486 140230311786240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:16:30.445648 140230311786240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:16:30.445887 140231071442368 error_handling.py:96] infeed marked as finished
I0812 20:16:30.446002 140231071442368 tpu_estimator.py:602] Stop output thread controller
I0812 20:16:30.446053 140231071442368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:16:30.446259 140230303393536 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:16:30.446348 140230303393536 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:16:30.446468 140231071442368 error_handling.py:96] outfeed marked as finished
I0812 20:16:30.446557 140231071442368 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:16:38.392261 140231071442368 estimator.py:368] Loss for final step: 0.2772227.
I0812 20:16:38.393122 140231071442368 error_handling.py:96] training_loop marked as finished
I0812 20:16:39.219553 140231071442368 estimator.py:1145] Calling model_fn.
E0812 20:16:40.019160 140231071442368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:16:40.254832 140231071442368 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:16:40.278846 140231071442368 estimator.py:1147] Done calling model_fn.
I0812 20:16:40.295511 140231071442368 evaluation.py:255] Starting evaluation at 2019-08-12T20:16:40Z
I0812 20:16:40.295748 140231071442368 tpu_estimator.py:499] TPU job name worker
I0812 20:16:40.373362 140231071442368 monitored_session.py:240] Graph was finalized.
W0812 20:16:40.374077 140231071442368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:16:40.543293 140231071442368 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:16:43.125848 140231071442368 session_manager.py:500] Running local_init_op.
I0812 20:16:43.150227 140231071442368 session_manager.py:502] Done running local_init_op.
I0812 20:16:43.203114 140231071442368 tpu_estimator.py:557] Init TPU system
I0812 20:17:52.015433 140231071442368 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:17:52.016697 140230308116224 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:17:52.017909 140230299723520 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:17:52.093430 140231071442368 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:17:52.119755 140231071442368 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:17:52.120178 140231071442368 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:17:52.195463 140229809796864 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:17:52.322438 140229809796864 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:17:52.883514 140230299723520 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:17:53.176379 140231071442368 evaluation.py:167] Evaluation [10/10]
I0812 20:17:53.176737 140231071442368 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:17:53.176810 140231071442368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:17:53.177108 140230308116224 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:17:53.177598 140230308116224 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:17:53.177932 140231071442368 error_handling.py:96] infeed marked as finished
I0812 20:17:53.178102 140231071442368 tpu_estimator.py:602] Stop output thread controller
I0812 20:17:53.178180 140231071442368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:17:53.178384 140230299723520 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:17:53.178560 140230299723520 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:17:53.178726 140231071442368 error_handling.py:96] outfeed marked as finished
I0812 20:17:53.178900 140231071442368 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:18:22.415576 140231071442368 evaluation.py:275] Finished evaluation at 2019-08-12-20:18:22
I0812 20:18:22.415982 140231071442368 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9307, global_step = 30, loss = 0.25796673
I0812 20:18:26.665846 140231071442368 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:18:27.488121 140231071442368 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.25796673, 'global_step': 30, 'accuracy': 0.9307}

Removing gs://yangyou-mnist/log/#1565640907948240...
Removing gs://yangyou-mnist/log/checkpoint#1565640986788230...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565640920112265...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565640908.v3-8-tpu#1565640990098612...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565640924295811...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565640983893751...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565640984679659...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565640912454430...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565640919192350...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565640989195376...
Removing gs://yangyou-mnist/log/eval/#1565641104091972...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565641104.v3-8-tpu#1565641107194927...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:18:31.335314 140234549966272 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:18:31.336164 140234549966272 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:18:31.338886 140234549966272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:18:31.339716 140234549966272 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:18:31.340321 140234549966272 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:18:31.340454 140234549966272 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:18:31.761816 140234549966272 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:18:31.768856 140234549966272 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:18:31.772798 140234549966272 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:18:31.865636 140234549966272 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:18:31.865925 140234549966272 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:18:31.999922 140234549966272 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:18:32.048260 140234549966272 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:18:32.048543 140234549966272 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:18:32.152730 140234549966272 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8ac0b2a190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8ac2d07210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:18:32.153094 140234549966272 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:18:32.474597 140234549966272 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:18:32.477400: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:18:32.489255 140234549966272 tpu_system_metadata.py:148] Found TPU system:
I0812 20:18:32.489533 140234549966272 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:18:32.491287 140234549966272 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:18:32.491425 140234549966272 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:18:32.491573 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:18:32.492083 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:18:32.492145 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:18:32.492197 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:18:32.492248 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:18:32.492295 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:18:32.492343 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:18:32.492389 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:18:32.492436 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:18:32.492492 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:18:32.492542 140234549966272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:18:32.498622 140234549966272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:18:32.511132 140234549966272 estimator.py:1145] Calling model_fn.
W0812 20:18:32.511768 140234549966272 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:18:32.803024 140234549966272 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:18:33.416258 140234549966272 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:18:33.478343 140234549966272 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:18:33.484220 140234549966272 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:18:33.665770 140234549966272 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:18:33.679593 140234549966272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:18:33.695135 140234549966272 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:18:33.705348 140234549966272 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:18:33.711461 140234549966272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:18:34.142929 140234549966272 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:18:34.159269 140234549966272 estimator.py:1147] Done calling model_fn.
I0812 20:18:37.515233 140234549966272 tpu_estimator.py:499] TPU job name worker
I0812 20:18:37.634541 140234549966272 monitored_session.py:240] Graph was finalized.
I0812 20:18:38.242588 140234549966272 session_manager.py:500] Running local_init_op.
I0812 20:18:38.274840 140234549966272 session_manager.py:502] Done running local_init_op.
I0812 20:18:40.737123 140234549966272 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:18:52.490667 140234549966272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:18:52.600188 140234549966272 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:18:52.600630 140234549966272 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:18:52.601098: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:18:52.606192 140234549966272 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:18:52.608660 140234549966272 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:18:52.612261 140234549966272 tpu_estimator.py:557] Init TPU system
I0812 20:19:36.084470 140234549966272 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 20:19:36.085463 140233790433024 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:19:36.085925 140233782040320 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:19:36.132090 140234549966272 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:19:36.133097 140234549966272 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:19:36.194936 140233299457792 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:19:36.347423 140233299457792 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:19:40.622621 140233782040320 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:19:45.300826 140234549966272 basic_session_run_hooks.py:262] loss = 0.24951237, step = 30
I0812 20:19:45.303188 140234549966272 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:19:58.481260 140234549966272 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:19:58.481601 140234549966272 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:19:58.481848 140233790433024 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:19:58.481951 140233790433024 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:19:58.482079 140234549966272 error_handling.py:96] infeed marked as finished
I0812 20:19:58.482224 140234549966272 tpu_estimator.py:602] Stop output thread controller
I0812 20:19:58.482276 140234549966272 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:19:58.482388 140233782040320 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:19:58.482465 140233782040320 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:19:58.482572 140234549966272 error_handling.py:96] outfeed marked as finished
I0812 20:19:58.482650 140234549966272 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:20:06.481302 140234549966272 estimator.py:368] Loss for final step: 0.24951237.
I0812 20:20:06.482220 140234549966272 error_handling.py:96] training_loop marked as finished
I0812 20:20:07.184504 140234549966272 estimator.py:1145] Calling model_fn.
E0812 20:20:07.896491 140234549966272 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:20:08.132188 140234549966272 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:20:08.156119 140234549966272 estimator.py:1147] Done calling model_fn.
I0812 20:20:08.174470 140234549966272 evaluation.py:255] Starting evaluation at 2019-08-12T20:20:08Z
I0812 20:20:08.174731 140234549966272 tpu_estimator.py:499] TPU job name worker
I0812 20:20:08.262655 140234549966272 monitored_session.py:240] Graph was finalized.
W0812 20:20:08.263500 140234549966272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:20:08.453178 140234549966272 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:20:10.951801 140234549966272 session_manager.py:500] Running local_init_op.
I0812 20:20:10.976392 140234549966272 session_manager.py:502] Done running local_init_op.
I0812 20:20:11.032675 140234549966272 tpu_estimator.py:557] Init TPU system
I0812 20:21:20.010742 140234549966272 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:21:20.011945 140233786763008 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:21:20.012973 140233299457792 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:21:20.091460 140234549966272 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:21:20.119167 140234549966272 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:21:20.119534 140234549966272 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:21:20.188239 140233291065088 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:21:20.283210 140233291065088 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:21:20.901721 140233299457792 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:21:21.171523 140234549966272 evaluation.py:167] Evaluation [10/10]
I0812 20:21:21.171974 140234549966272 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:21:21.172070 140234549966272 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:21:21.172384 140233786763008 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:21:21.172672 140233786763008 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:21:21.172991 140234549966272 error_handling.py:96] infeed marked as finished
I0812 20:21:21.173175 140234549966272 tpu_estimator.py:602] Stop output thread controller
I0812 20:21:21.173254 140234549966272 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:21:21.173526 140233299457792 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:21:21.173727 140233299457792 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:21:21.173969 140234549966272 error_handling.py:96] outfeed marked as finished
I0812 20:21:21.174175 140234549966272 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:21:50.374947 140234549966272 evaluation.py:275] Finished evaluation at 2019-08-12-20:21:50
I0812 20:21:50.375305 140234549966272 estimator.py:2039] Saving dict for global step 30: accuracy = 0.934, global_step = 30, loss = 0.25600022
I0812 20:21:54.627150 140234549966272 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:21:55.422900 140234549966272 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.25600022, 'global_step': 30, 'accuracy': 0.934}

Removing gs://yangyou-mnist/log/#1565641115649042...
Removing gs://yangyou-mnist/log/checkpoint#1565641194993692...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565641115.v3-8-tpu#1565641198168948...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565641132064524...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565641127870656...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565641120254069...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565641192861080...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565641192036465...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565641127047937...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565641197263850...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565641312091069...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565641312.v3-8-tpu#1565641315115934...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:21:59.235871 140693112255936 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:21:59.236670 140693112255936 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:21:59.239334 140693112255936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:21:59.240161 140693112255936 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:21:59.240755 140693112255936 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:21:59.240911 140693112255936 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:21:59.669898 140693112255936 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:21:59.678683 140693112255936 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:21:59.683290 140693112255936 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:21:59.734447 140693112255936 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:21:59.734745 140693112255936 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:21:59.846128 140693112255936 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:21:59.936368 140693112255936 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:21:59.936655 140693112255936 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:22:00.030342 140693112255936 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff58523e250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff58741b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:22:00.030702 140693112255936 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:22:00.380932 140693112255936 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:22:00.383698: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:22:00.396363 140693112255936 tpu_system_metadata.py:148] Found TPU system:
I0812 20:22:00.396600 140693112255936 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:22:00.397097 140693112255936 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:22:00.397155 140693112255936 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:22:00.397207 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:22:00.397490 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:22:00.397564 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:22:00.397617 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:22:00.397665 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:22:00.397711 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:22:00.397758 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:22:00.397805 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:22:00.397852 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:22:00.397900 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:22:00.397947 140693112255936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:22:00.403913 140693112255936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:22:00.416393 140693112255936 estimator.py:1145] Calling model_fn.
W0812 20:22:00.417049 140693112255936 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:22:00.686316 140693112255936 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:22:01.283838 140693112255936 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:22:01.345071 140693112255936 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:22:01.350927 140693112255936 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:22:01.529078 140693112255936 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:22:01.542787 140693112255936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:22:01.557616 140693112255936 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:22:01.567632 140693112255936 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:22:01.573447 140693112255936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:22:01.987565 140693112255936 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:22:02.002893 140693112255936 estimator.py:1147] Done calling model_fn.
I0812 20:22:05.302675 140693112255936 tpu_estimator.py:499] TPU job name worker
I0812 20:22:05.417712 140693112255936 monitored_session.py:240] Graph was finalized.
I0812 20:22:05.974855 140693112255936 session_manager.py:500] Running local_init_op.
I0812 20:22:06.007360 140693112255936 session_manager.py:502] Done running local_init_op.
I0812 20:22:08.491147 140693112255936 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:22:20.613442 140693112255936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:22:20.746810 140693112255936 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:22:20.747277 140693112255936 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:22:20.747667: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:22:20.753289 140693112255936 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:22:20.755812 140693112255936 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:22:20.761713 140693112255936 tpu_estimator.py:557] Init TPU system
I0812 20:23:04.061765 140693112255936 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 20:23:04.062925 140692361037568 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:23:04.063754 140692352644864 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:23:04.112138 140693112255936 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:23:04.113148 140693112255936 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:23:04.125596 140692344252160 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:23:04.229857 140692344252160 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 20:23:08.666505 140692352644864 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:23:13.339313 140693112255936 basic_session_run_hooks.py:262] loss = 0.3052638, step = 30
I0812 20:23:13.341799 140693112255936 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:23:26.680598 140693112255936 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:23:26.680924 140693112255936 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:23:26.681184 140692361037568 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:23:26.681302 140692361037568 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:23:26.681468 140693112255936 error_handling.py:96] infeed marked as finished
I0812 20:23:26.681607 140693112255936 tpu_estimator.py:602] Stop output thread controller
I0812 20:23:26.681667 140693112255936 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:23:26.681798 140692352644864 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:23:26.681884 140692352644864 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:23:26.682013 140693112255936 error_handling.py:96] outfeed marked as finished
I0812 20:23:26.682100 140693112255936 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:23:34.348156 140693112255936 estimator.py:368] Loss for final step: 0.3052638.
I0812 20:23:34.349113 140693112255936 error_handling.py:96] training_loop marked as finished
I0812 20:23:35.056968 140693112255936 estimator.py:1145] Calling model_fn.
E0812 20:23:35.762120 140693112255936 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:23:35.988149 140693112255936 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:23:36.011060 140693112255936 estimator.py:1147] Done calling model_fn.
I0812 20:23:36.028208 140693112255936 evaluation.py:255] Starting evaluation at 2019-08-12T20:23:36Z
I0812 20:23:36.028461 140693112255936 tpu_estimator.py:499] TPU job name worker
I0812 20:23:36.108376 140693112255936 monitored_session.py:240] Graph was finalized.
W0812 20:23:36.109277 140693112255936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:23:36.313505 140693112255936 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:23:38.770840 140693112255936 session_manager.py:500] Running local_init_op.
I0812 20:23:38.798557 140693112255936 session_manager.py:502] Done running local_init_op.
I0812 20:23:38.852333 140693112255936 tpu_estimator.py:557] Init TPU system
I0812 20:24:48.018901 140693112255936 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 20:24:48.019985 140692357367552 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:24:48.021356 140692348974848 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:24:48.088301 140693112255936 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:24:48.114589 140693112255936 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:24:48.115036 140693112255936 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:24:48.149045 140692335597312 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:24:48.306377 140692335597312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:24:48.875235 140692348974848 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:24:49.345326 140693112255936 evaluation.py:167] Evaluation [10/10]
I0812 20:24:49.345679 140693112255936 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:24:49.345760 140693112255936 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:24:49.346026 140692357367552 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:24:49.346410 140692357367552 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:24:49.346632 140693112255936 error_handling.py:96] infeed marked as finished
I0812 20:24:49.346824 140693112255936 tpu_estimator.py:602] Stop output thread controller
I0812 20:24:49.346879 140693112255936 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:24:49.347037 140692348974848 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:24:49.347201 140692348974848 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:24:49.347361 140693112255936 error_handling.py:96] outfeed marked as finished
I0812 20:24:49.347490 140693112255936 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:25:18.403295 140693112255936 evaluation.py:275] Finished evaluation at 2019-08-12-20:25:18
I0812 20:25:18.403664 140693112255936 estimator.py:2039] Saving dict for global step 30: accuracy = 0.933, global_step = 30, loss = 0.33420956
I0812 20:25:22.914630 140693112255936 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:25:23.762794 140693112255936 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.33420956, 'global_step': 30, 'accuracy': 0.933}

Removing gs://yangyou-mnist/log/#1565641323538084...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565641323.v3-8-tpu#1565641406367970...
Removing gs://yangyou-mnist/log/checkpoint#1565641403333665...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565641327959452...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565641334773049...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565641335682801...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565641340116797...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565641400144902...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565641400983274...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565641405501476...
Removing gs://yangyou-mnist/log/eval/#1565641520091267...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565641520.v3-8-tpu#1565641523453243...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:25:27.646951 139784233227712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:25:27.647747 139784233227712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:25:27.650677 139784233227712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:25:27.651532 139784233227712 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:25:27.652121 139784233227712 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:25:27.652246 139784233227712 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:25:28.078969 139784233227712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:25:28.085814 139784233227712 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:25:28.089878 139784233227712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:25:28.136940 139784233227712 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:25:28.137214 139784233227712 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:25:28.333991 139784233227712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:25:28.382936 139784233227712 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:25:28.383219 139784233227712 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:25:28.488679 139784233227712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f21e7ba8150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f21e9d85210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:25:28.489187 139784233227712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:25:28.819920 139784233227712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:25:28.822947: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:25:28.835539 139784233227712 tpu_system_metadata.py:148] Found TPU system:
I0812 20:25:28.835776 139784233227712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:25:28.836267 139784233227712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:25:28.836325 139784233227712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:25:28.836379 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:25:28.836813 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:25:28.836873 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:25:28.836937 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:25:28.836987 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:25:28.837038 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:25:28.837085 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:25:28.837131 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:25:28.837176 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:25:28.837222 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:25:28.837269 139784233227712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:25:28.843244 139784233227712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:25:28.855611 139784233227712 estimator.py:1145] Calling model_fn.
W0812 20:25:28.856220 139784233227712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:25:29.134881 139784233227712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:25:29.719453 139784233227712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:25:29.780514 139784233227712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:25:29.786395 139784233227712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:25:29.962677 139784233227712 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:25:29.976267 139784233227712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:25:29.991652 139784233227712 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:25:30.001696 139784233227712 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:25:30.007671 139784233227712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:25:30.438802 139784233227712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:25:30.454341 139784233227712 estimator.py:1147] Done calling model_fn.
I0812 20:25:33.838421 139784233227712 tpu_estimator.py:499] TPU job name worker
I0812 20:25:33.954678 139784233227712 monitored_session.py:240] Graph was finalized.
I0812 20:25:34.550272 139784233227712 session_manager.py:500] Running local_init_op.
I0812 20:25:34.591798 139784233227712 session_manager.py:502] Done running local_init_op.
I0812 20:25:37.221931 139784233227712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:25:49.665062 139784233227712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:25:49.781498 139784233227712 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:25:49.782037 139784233227712 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:25:49.782499: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:25:49.787709 139784233227712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:25:49.790060 139784233227712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:25:49.794666 139784233227712 tpu_estimator.py:557] Init TPU system
I0812 20:26:32.096930 139784233227712 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:26:32.098167 139783200306944 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:26:32.098968 139783191914240 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:26:32.146894 139784233227712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:26:32.147881 139784233227712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:26:32.168359 139783183521536 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:26:32.466967 139783183521536 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:26:36.665697 139783191914240 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:26:41.443789 139784233227712 basic_session_run_hooks.py:262] loss = 0.19972809, step = 30
I0812 20:26:41.446113 139784233227712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:26:54.593590 139784233227712 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:26:54.593882 139784233227712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:26:54.594125 139783200306944 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:26:54.594280 139783200306944 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:26:54.594436 139784233227712 error_handling.py:96] infeed marked as finished
I0812 20:26:54.594537 139784233227712 tpu_estimator.py:602] Stop output thread controller
I0812 20:26:54.594585 139784233227712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:26:54.594697 139783191914240 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:26:54.594789 139783191914240 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:26:54.594914 139784233227712 error_handling.py:96] outfeed marked as finished
I0812 20:26:54.594997 139784233227712 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:27:02.605313 139784233227712 estimator.py:368] Loss for final step: 0.19972809.
I0812 20:27:02.606271 139784233227712 error_handling.py:96] training_loop marked as finished
I0812 20:27:03.329628 139784233227712 estimator.py:1145] Calling model_fn.
E0812 20:27:04.126197 139784233227712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:27:04.351175 139784233227712 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:27:04.374488 139784233227712 estimator.py:1147] Done calling model_fn.
I0812 20:27:04.391100 139784233227712 evaluation.py:255] Starting evaluation at 2019-08-12T20:27:04Z
I0812 20:27:04.391341 139784233227712 tpu_estimator.py:499] TPU job name worker
I0812 20:27:04.469468 139784233227712 monitored_session.py:240] Graph was finalized.
W0812 20:27:04.470274 139784233227712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:27:04.678613 139784233227712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:27:07.146581 139784233227712 session_manager.py:500] Running local_init_op.
I0812 20:27:07.169919 139784233227712 session_manager.py:502] Done running local_init_op.
I0812 20:27:07.221736 139784233227712 tpu_estimator.py:557] Init TPU system
I0812 20:28:16.057199 139784233227712 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:28:16.058257 139783200306944 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:28:16.058836 139783191914240 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:28:16.132287 139784233227712 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:28:16.161784 139784233227712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:28:16.162199 139784233227712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:28:16.191834 139783183521536 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:28:16.350773 139783183521536 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:28:16.951476 139783191914240 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:28:17.405600 139784233227712 evaluation.py:167] Evaluation [10/10]
I0812 20:28:17.406056 139784233227712 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:28:17.406174 139784233227712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:28:17.406373 139783200306944 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:28:17.406472 139783200306944 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:28:17.406611 139784233227712 error_handling.py:96] infeed marked as finished
I0812 20:28:17.406722 139784233227712 tpu_estimator.py:602] Stop output thread controller
I0812 20:28:17.406773 139784233227712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:28:17.406886 139783191914240 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:28:17.406955 139783191914240 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:28:17.407068 139784233227712 error_handling.py:96] outfeed marked as finished
I0812 20:28:17.407155 139784233227712 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:28:46.450524 139784233227712 evaluation.py:275] Finished evaluation at 2019-08-12-20:28:46
I0812 20:28:46.450884 139784233227712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9489, global_step = 30, loss = 0.21398374
I0812 20:28:50.844791 139784233227712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:28:51.688244 139784233227712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.21398374, 'global_step': 30, 'accuracy': 0.9489}

Removing gs://yangyou-mnist/log/#1565641532113328...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565641544564205...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565641549072347...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565641607987854...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565641608830922...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565641532.v3-8-tpu#1565641614269227...
Removing gs://yangyou-mnist/log/checkpoint#1565641611128522...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565641543707883...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565641536690400...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565641613335769...
Removing gs://yangyou-mnist/log/eval/#1565641728279727...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565641728.v3-8-tpu#1565641731380852...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:28:55.552284 139872399959488 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:28:55.553066 139872399959488 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:28:55.555769 139872399959488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:28:55.556591 139872399959488 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:28:55.557182 139872399959488 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:28:55.557303 139872399959488 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:28:55.964543 139872399959488 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:28:55.971813 139872399959488 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:28:55.975809 139872399959488 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:28:56.027050 139872399959488 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:28:56.027323 139872399959488 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:28:56.125215 139872399959488 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:28:56.282206 139872399959488 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:28:56.282521 139872399959488 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:28:56.466027 139872399959488 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f366ee012d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3670fde210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:28:56.466430 139872399959488 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:28:56.829929 139872399959488 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:28:56.832970: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:28:56.845963 139872399959488 tpu_system_metadata.py:148] Found TPU system:
I0812 20:28:56.846281 139872399959488 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:28:56.846904 139872399959488 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:28:56.846970 139872399959488 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:28:56.847070 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:28:56.847424 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:28:56.847495 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:28:56.847554 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:28:56.847625 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:28:56.847681 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:28:56.847733 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:28:56.847785 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:28:56.847837 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:28:56.847889 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:28:56.847944 139872399959488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:28:56.854306 139872399959488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:28:56.867980 139872399959488 estimator.py:1145] Calling model_fn.
W0812 20:28:56.868623 139872399959488 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:28:57.159041 139872399959488 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:28:57.605537 139872399959488 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:28:57.665874 139872399959488 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:28:57.671782 139872399959488 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:28:57.849546 139872399959488 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:28:57.863660 139872399959488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:28:57.878752 139872399959488 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:28:57.888766 139872399959488 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:28:57.895345 139872399959488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:28:58.325134 139872399959488 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:28:58.340569 139872399959488 estimator.py:1147] Done calling model_fn.
I0812 20:29:01.829624 139872399959488 tpu_estimator.py:499] TPU job name worker
I0812 20:29:01.946873 139872399959488 monitored_session.py:240] Graph was finalized.
I0812 20:29:02.558329 139872399959488 session_manager.py:500] Running local_init_op.
I0812 20:29:02.599854 139872399959488 session_manager.py:502] Done running local_init_op.
I0812 20:29:05.258063 139872399959488 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:29:17.499751 139872399959488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:29:17.610580 139872399959488 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:29:17.611058 139872399959488 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:29:17.611499: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:29:17.616982 139872399959488 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:29:17.619240 139872399959488 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:29:17.624219 139872399959488 tpu_estimator.py:557] Init TPU system
I0812 20:30:00.064737 139872399959488 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:30:00.066346 139871490393856 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:30:00.066757 139871482001152 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:30:00.113950 139872399959488 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:30:00.114869 139872399959488 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:30:00.130625 139871473608448 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:30:00.373929 139871473608448 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 20:30:04.682629 139871482001152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:30:09.327617 139872399959488 basic_session_run_hooks.py:262] loss = 0.13616773, step = 30
I0812 20:30:09.330004 139872399959488 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:30:22.829114 139872399959488 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:30:22.829400 139872399959488 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:30:22.829744 139871490393856 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:30:22.830104 139871490393856 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:30:22.830369 139872399959488 error_handling.py:96] infeed marked as finished
I0812 20:30:22.830610 139872399959488 tpu_estimator.py:602] Stop output thread controller
I0812 20:30:22.830687 139872399959488 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:30:22.830846 139871482001152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:30:22.831059 139871482001152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:30:22.831218 139872399959488 error_handling.py:96] outfeed marked as finished
I0812 20:30:22.831377 139872399959488 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:30:30.514023 139872399959488 estimator.py:368] Loss for final step: 0.13616773.
I0812 20:30:30.514997 139872399959488 error_handling.py:96] training_loop marked as finished
I0812 20:30:31.326613 139872399959488 estimator.py:1145] Calling model_fn.
E0812 20:30:32.067739 139872399959488 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:30:32.302871 139872399959488 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:30:32.328155 139872399959488 estimator.py:1147] Done calling model_fn.
I0812 20:30:32.347229 139872399959488 evaluation.py:255] Starting evaluation at 2019-08-12T20:30:32Z
I0812 20:30:32.347484 139872399959488 tpu_estimator.py:499] TPU job name worker
I0812 20:30:32.435045 139872399959488 monitored_session.py:240] Graph was finalized.
W0812 20:30:32.435811 139872399959488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:30:32.659077 139872399959488 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:30:35.225831 139872399959488 session_manager.py:500] Running local_init_op.
I0812 20:30:35.251168 139872399959488 session_manager.py:502] Done running local_init_op.
I0812 20:30:35.298084 139872399959488 tpu_estimator.py:557] Init TPU system
I0812 20:31:44.044095 139872399959488 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:31:44.045104 139871515571968 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:31:44.045697 139871490393856 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:31:44.111954 139872399959488 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:31:44.141132 139872399959488 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:31:44.141494 139872399959488 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:31:44.165265 139871482001152 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:31:44.293556 139871482001152 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:31:44.896864 139871490393856 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:31:45.211256 139872399959488 evaluation.py:167] Evaluation [10/10]
I0812 20:31:45.211604 139872399959488 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:31:45.211705 139872399959488 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:31:45.211957 139871515571968 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:31:45.212068 139871515571968 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:31:45.212248 139872399959488 error_handling.py:96] infeed marked as finished
I0812 20:31:45.212354 139872399959488 tpu_estimator.py:602] Stop output thread controller
I0812 20:31:45.212404 139872399959488 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:31:45.212558 139871490393856 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:31:45.212637 139871490393856 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:31:45.212790 139872399959488 error_handling.py:96] outfeed marked as finished
I0812 20:31:45.212881 139872399959488 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:32:14.387850 139872399959488 evaluation.py:275] Finished evaluation at 2019-08-12-20:32:14
I0812 20:32:14.388171 139872399959488 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9654, global_step = 30, loss = 0.111928
I0812 20:32:18.588907 139872399959488 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:32:19.514703 139872399959488 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.111928, 'global_step': 30, 'accuracy': 0.9654}

Removing gs://yangyou-mnist/log/#1565641739818562...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565641752516970...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565641757009242...
Removing gs://yangyou-mnist/log/checkpoint#1565641819420149...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565641817186724...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565641744695478...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565641816249385...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565641739.v3-8-tpu#1565641822522232...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565641751687758...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565641821624748...
Removing gs://yangyou-mnist/log/eval/#1565641936036488...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565641936.v3-8-tpu#1565641939205390...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:32:23.501115 140704678708672 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:32:23.501899 140704678708672 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:32:23.504503 140704678708672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:32:23.505330 140704678708672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:32:23.505934 140704678708672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:32:23.506068 140704678708672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:32:23.936969 140704678708672 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:32:23.944252 140704678708672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:32:23.948810 140704678708672 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:32:23.992676 140704678708672 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:32:23.992947 140704678708672 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:32:24.152158 140704678708672 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:32:24.192804 140704678708672 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:32:24.193075 140704678708672 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:32:24.287144 140704678708672 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff8368df090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff838abc210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:32:24.287502 140704678708672 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:32:24.607505 140704678708672 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:32:24.610372: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:32:24.623696 140704678708672 tpu_system_metadata.py:148] Found TPU system:
I0812 20:32:24.623948 140704678708672 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:32:24.624453 140704678708672 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:32:24.624520 140704678708672 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:32:24.624577 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:32:24.624861 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:32:24.624916 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:32:24.624964 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:32:24.625016 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:32:24.625080 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:32:24.625128 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:32:24.625174 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:32:24.625220 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:32:24.625266 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:32:24.625313 140704678708672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:32:24.631326 140704678708672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:32:24.644170 140704678708672 estimator.py:1145] Calling model_fn.
W0812 20:32:24.644805 140704678708672 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:32:24.947659 140704678708672 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:32:25.649224 140704678708672 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:32:25.714333 140704678708672 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:32:25.720395 140704678708672 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:32:25.903081 140704678708672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:32:25.917144 140704678708672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:32:25.932153 140704678708672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:32:25.942348 140704678708672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:32:25.948407 140704678708672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:32:26.372607 140704678708672 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:32:26.388410 140704678708672 estimator.py:1147] Done calling model_fn.
I0812 20:32:29.712080 140704678708672 tpu_estimator.py:499] TPU job name worker
I0812 20:32:29.827949 140704678708672 monitored_session.py:240] Graph was finalized.
I0812 20:32:30.434386 140704678708672 session_manager.py:500] Running local_init_op.
I0812 20:32:30.474591 140704678708672 session_manager.py:502] Done running local_init_op.
I0812 20:32:33.029090 140704678708672 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:32:45.075460 140704678708672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:32:45.187849 140704678708672 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:32:45.188303 140704678708672 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:32:45.188701: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:32:45.193172 140704678708672 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:32:45.195399 140704678708672 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:32:45.199018 140704678708672 tpu_estimator.py:557] Init TPU system
I0812 20:33:27.989471 140704678708672 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:33:27.990645 140703774525184 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:33:27.991182 140703766132480 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:33:28.035651 140704678708672 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:33:28.037000 140704678708672 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:33:28.045813 140703757739776 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:33:28.186192 140703757739776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:33:32.613275 140703766132480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:33:37.016299 140704678708672 basic_session_run_hooks.py:262] loss = 0.15385376, step = 30
I0812 20:33:37.018652 140704678708672 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:33:50.482053 140704678708672 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:33:50.482446 140704678708672 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:33:50.482748 140703774525184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:33:50.483078 140703774525184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:33:50.483294 140704678708672 error_handling.py:96] infeed marked as finished
I0812 20:33:50.483527 140704678708672 tpu_estimator.py:602] Stop output thread controller
I0812 20:33:50.483596 140704678708672 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:33:50.483768 140703766132480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:33:50.483925 140703766132480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:33:50.484133 140704678708672 error_handling.py:96] outfeed marked as finished
I0812 20:33:50.484251 140704678708672 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:33:58.325162 140704678708672 estimator.py:368] Loss for final step: 0.15385376.
I0812 20:33:58.326004 140704678708672 error_handling.py:96] training_loop marked as finished
I0812 20:33:59.129353 140704678708672 estimator.py:1145] Calling model_fn.
E0812 20:33:59.837794 140704678708672 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:34:00.072334 140704678708672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:34:00.097073 140704678708672 estimator.py:1147] Done calling model_fn.
I0812 20:34:00.117316 140704678708672 evaluation.py:255] Starting evaluation at 2019-08-12T20:34:00Z
I0812 20:34:00.117567 140704678708672 tpu_estimator.py:499] TPU job name worker
I0812 20:34:00.203710 140704678708672 monitored_session.py:240] Graph was finalized.
W0812 20:34:00.204586 140704678708672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:34:00.393106 140704678708672 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:34:03.089402 140704678708672 session_manager.py:500] Running local_init_op.
I0812 20:34:03.117640 140704678708672 session_manager.py:502] Done running local_init_op.
I0812 20:34:03.167001 140704678708672 tpu_estimator.py:557] Init TPU system
I0812 20:35:12.031506 140704678708672 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:35:12.032414 140703766132480 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:35:12.032825 140703757739776 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:35:12.099700 140704678708672 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:35:12.124783 140704678708672 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:35:12.125137 140704678708672 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:35:12.157177 140703749347072 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:35:12.265826 140703749347072 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:35:12.928167 140703757739776 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:35:13.216759 140704678708672 evaluation.py:167] Evaluation [10/10]
I0812 20:35:13.217082 140704678708672 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:35:13.217152 140704678708672 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:35:13.217334 140703766132480 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:35:13.217431 140703766132480 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:35:13.217581 140704678708672 error_handling.py:96] infeed marked as finished
I0812 20:35:13.217669 140704678708672 tpu_estimator.py:602] Stop output thread controller
I0812 20:35:13.217717 140704678708672 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:35:13.217825 140703757739776 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:35:13.217894 140703757739776 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:35:13.218102 140704678708672 error_handling.py:96] outfeed marked as finished
I0812 20:35:13.218260 140704678708672 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:35:42.362066 140704678708672 evaluation.py:275] Finished evaluation at 2019-08-12-20:35:42
I0812 20:35:42.362457 140704678708672 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9615, global_step = 30, loss = 0.13554361
I0812 20:35:46.813513 140704678708672 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:35:47.576531 140704678708672 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.13554361, 'global_step': 30, 'accuracy': 0.9615}

Removing gs://yangyou-mnist/log/#1565641947904134...
Removing gs://yangyou-mnist/log/checkpoint#1565642027104072...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565641964566963...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565641960414693...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565641948.v3-8-tpu#1565642030177004...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565641952445472...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565642024048398...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565642024875010...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565641959529900...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565642029245453...
Removing gs://yangyou-mnist/log/eval/#1565642144081321...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565642144.v3-8-tpu#1565642147269096...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:35:51.377753 140467515852224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:35:51.378643 140467515852224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:35:51.381325 140467515852224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:35:51.382219 140467515852224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:35:51.382862 140467515852224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:35:51.382988 140467515852224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:35:51.800430 140467515852224 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:35:51.807864 140467515852224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:35:51.811980 140467515852224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:35:51.864258 140467515852224 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:35:51.864664 140467515852224 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:35:52.029560 140467515852224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:35:52.076651 140467515852224 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:35:52.076944 140467515852224 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:35:52.247566 140467515852224 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc0fe8bf090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc100a9c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:35:52.247910 140467515852224 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:35:52.571643 140467515852224 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:35:52.574607: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:35:52.587153 140467515852224 tpu_system_metadata.py:148] Found TPU system:
I0812 20:35:52.587532 140467515852224 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:35:52.588249 140467515852224 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:35:52.588310 140467515852224 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:35:52.588363 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:35:52.588670 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:35:52.588727 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:35:52.588778 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:35:52.588825 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:35:52.588872 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:35:52.588918 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:35:52.588983 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:35:52.589030 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:35:52.589076 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:35:52.589123 140467515852224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:35:52.595146 140467515852224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:35:52.608083 140467515852224 estimator.py:1145] Calling model_fn.
W0812 20:35:52.608711 140467515852224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:35:52.904249 140467515852224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:35:53.315391 140467515852224 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:35:53.376352 140467515852224 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:35:53.382246 140467515852224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:35:53.559261 140467515852224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:35:53.572717 140467515852224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:35:53.587790 140467515852224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:35:53.597826 140467515852224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:35:53.603739 140467515852224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:35:54.014964 140467515852224 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:35:54.030317 140467515852224 estimator.py:1147] Done calling model_fn.
I0812 20:35:57.668459 140467515852224 tpu_estimator.py:499] TPU job name worker
I0812 20:35:57.783245 140467515852224 monitored_session.py:240] Graph was finalized.
I0812 20:35:58.381479 140467515852224 session_manager.py:500] Running local_init_op.
I0812 20:35:58.413355 140467515852224 session_manager.py:502] Done running local_init_op.
I0812 20:36:00.974083 140467515852224 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:36:13.586529 140467515852224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:36:13.706132 140467515852224 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:36:13.706653 140467515852224 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:36:13.707031: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:36:13.712044 140467515852224 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:36:13.714413 140467515852224 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:36:13.718563 140467515852224 tpu_estimator.py:557] Init TPU system
I0812 20:36:56.061026 140467515852224 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:36:56.062230 140466620192512 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:36:56.063134 140466611799808 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:36:56.110732 140467515852224 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:36:56.111675 140467515852224 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:36:56.124538 140466603407104 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:36:56.255785 140466603407104 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:37:00.512888 140466611799808 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:37:04.999581 140467515852224 basic_session_run_hooks.py:262] loss = 0.15548237, step = 30
I0812 20:37:05.001393 140467515852224 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:37:18.190468 140467515852224 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:37:18.190758 140467515852224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:37:18.191042 140466620192512 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:37:18.191329 140466620192512 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:37:18.191535 140467515852224 error_handling.py:96] infeed marked as finished
I0812 20:37:18.191729 140467515852224 tpu_estimator.py:602] Stop output thread controller
I0812 20:37:18.191781 140467515852224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:37:18.191967 140466611799808 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:37:18.192142 140466611799808 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:37:18.192297 140467515852224 error_handling.py:96] outfeed marked as finished
I0812 20:37:18.192420 140467515852224 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:37:26.396665 140467515852224 estimator.py:368] Loss for final step: 0.15548237.
I0812 20:37:26.397593 140467515852224 error_handling.py:96] training_loop marked as finished
I0812 20:37:27.187808 140467515852224 estimator.py:1145] Calling model_fn.
E0812 20:37:27.968938 140467515852224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:37:28.197673 140467515852224 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:37:28.220890 140467515852224 estimator.py:1147] Done calling model_fn.
I0812 20:37:28.237041 140467515852224 evaluation.py:255] Starting evaluation at 2019-08-12T20:37:28Z
I0812 20:37:28.237270 140467515852224 tpu_estimator.py:499] TPU job name worker
I0812 20:37:28.315412 140467515852224 monitored_session.py:240] Graph was finalized.
W0812 20:37:28.316138 140467515852224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:37:28.508316 140467515852224 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:37:31.248090 140467515852224 session_manager.py:500] Running local_init_op.
I0812 20:37:31.271318 140467515852224 session_manager.py:502] Done running local_init_op.
I0812 20:37:31.317492 140467515852224 tpu_estimator.py:557] Init TPU system
I0812 20:38:40.007632 140467515852224 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:38:40.008455 140466618095360 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:38:40.008840 140466609702656 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:38:40.074337 140467515852224 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:38:40.102611 140467515852224 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:38:40.102976 140467515852224 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:38:40.176640 140466601309952 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:38:40.446547 140466601309952 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:38:40.891449 140466609702656 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:38:41.228286 140467515852224 evaluation.py:167] Evaluation [10/10]
I0812 20:38:41.228612 140467515852224 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:38:41.228679 140467515852224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:38:41.228852 140466618095360 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:38:41.228945 140466618095360 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:38:41.229085 140467515852224 error_handling.py:96] infeed marked as finished
I0812 20:38:41.229175 140467515852224 tpu_estimator.py:602] Stop output thread controller
I0812 20:38:41.229222 140467515852224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:38:41.229398 140466609702656 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:38:41.229502 140466609702656 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:38:41.229618 140467515852224 error_handling.py:96] outfeed marked as finished
I0812 20:38:41.229693 140467515852224 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:39:10.543585 140467515852224 evaluation.py:275] Finished evaluation at 2019-08-12-20:39:10
I0812 20:39:10.543971 140467515852224 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9598, global_step = 30, loss = 0.14555226
I0812 20:39:14.907417 140467515852224 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:39:15.745371 140467515852224 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.14555226, 'global_step': 30, 'accuracy': 0.9598}

Removing gs://yangyou-mnist/log/#1565642155483799...
Removing gs://yangyou-mnist/log/checkpoint#1565642234779837...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565642155.v3-8-tpu#1565642237874511...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565642160422496...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565642167874810...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565642168743144...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565642173103542...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565642231690790...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565642232484476...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565642236966750...
Removing gs://yangyou-mnist/log/eval/#1565642352241053...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565642352.v3-8-tpu#1565642355439579...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:39:19.621622 140042306110912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:39:19.622514 140042306110912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:39:19.625078 140042306110912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:39:19.625900 140042306110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:39:19.626523 140042306110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:39:19.626658 140042306110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:39:20.043983 140042306110912 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:39:20.051043 140042306110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:39:20.054989 140042306110912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:39:20.106396 140042306110912 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:39:20.106686 140042306110912 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:39:20.325042 140042306110912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:39:20.373164 140042306110912 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:39:20.373457 140042306110912 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:39:20.566978 140042306110912 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5dfe123110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5e00300210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:39:20.567322 140042306110912 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:39:20.892396 140042306110912 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:39:20.895491: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:39:20.908611 140042306110912 tpu_system_metadata.py:148] Found TPU system:
I0812 20:39:20.908850 140042306110912 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:39:20.909341 140042306110912 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:39:20.909399 140042306110912 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:39:20.909452 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:39:20.909742 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:39:20.909796 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:39:20.909847 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:39:20.909897 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:39:20.909944 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:39:20.910001 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:39:20.910048 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:39:20.910109 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:39:20.910206 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:39:20.910265 140042306110912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:39:20.916136 140042306110912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:39:20.928632 140042306110912 estimator.py:1145] Calling model_fn.
W0812 20:39:20.929235 140042306110912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:39:21.240670 140042306110912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:39:21.649822 140042306110912 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:39:21.711980 140042306110912 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:39:21.718044 140042306110912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:39:21.900796 140042306110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:39:21.914572 140042306110912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:39:21.929910 140042306110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:39:21.940140 140042306110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:39:21.946365 140042306110912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:39:22.381453 140042306110912 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:39:22.397615 140042306110912 estimator.py:1147] Done calling model_fn.
I0812 20:39:25.849442 140042306110912 tpu_estimator.py:499] TPU job name worker
I0812 20:39:25.964570 140042306110912 monitored_session.py:240] Graph was finalized.
I0812 20:39:26.533051 140042306110912 session_manager.py:500] Running local_init_op.
I0812 20:39:26.573864 140042306110912 session_manager.py:502] Done running local_init_op.
I0812 20:39:29.141311 140042306110912 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:39:41.549931 140042306110912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:39:41.656306 140042306110912 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:39:41.656766 140042306110912 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:39:41.657234: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:39:41.662085 140042306110912 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:39:41.664410 140042306110912 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:39:41.668327 140042306110912 tpu_estimator.py:557] Init TPU system
I0812 20:40:24.069535 140042306110912 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:40:24.070672 140041412138752 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:40:24.071286 140041403746048 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:40:24.117038 140042306110912 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:40:24.118396 140042306110912 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:40:24.128742 140041395353344 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:40:24.254117 140041395353344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:40:28.727404 140041403746048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:40:33.167597 140042306110912 basic_session_run_hooks.py:262] loss = 0.10960382, step = 30
I0812 20:40:33.169960 140042306110912 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:40:46.475410 140042306110912 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:40:46.475734 140042306110912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:40:46.475965 140041412138752 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:40:46.476072 140041412138752 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:40:46.476210 140042306110912 error_handling.py:96] infeed marked as finished
I0812 20:40:46.476300 140042306110912 tpu_estimator.py:602] Stop output thread controller
I0812 20:40:46.476350 140042306110912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:40:46.476463 140041403746048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:40:46.476536 140041403746048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:40:46.476660 140042306110912 error_handling.py:96] outfeed marked as finished
I0812 20:40:46.476761 140042306110912 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:40:54.389897 140042306110912 estimator.py:368] Loss for final step: 0.10960382.
I0812 20:40:54.390820 140042306110912 error_handling.py:96] training_loop marked as finished
I0812 20:40:55.074914 140042306110912 estimator.py:1145] Calling model_fn.
E0812 20:40:55.765671 140042306110912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:40:55.989676 140042306110912 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:40:56.012207 140042306110912 estimator.py:1147] Done calling model_fn.
I0812 20:40:56.028445 140042306110912 evaluation.py:255] Starting evaluation at 2019-08-12T20:40:56Z
I0812 20:40:56.028692 140042306110912 tpu_estimator.py:499] TPU job name worker
I0812 20:40:56.104979 140042306110912 monitored_session.py:240] Graph was finalized.
W0812 20:40:56.105719 140042306110912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:40:56.293617 140042306110912 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:40:58.762758 140042306110912 session_manager.py:500] Running local_init_op.
I0812 20:40:58.788331 140042306110912 session_manager.py:502] Done running local_init_op.
I0812 20:40:58.841613 140042306110912 tpu_estimator.py:557] Init TPU system
I0812 20:42:07.971489 140042306110912 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 20:42:07.972678 140041408468736 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:42:07.973295 140041400076032 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:42:08.041820 140042306110912 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:42:08.073443 140042306110912 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:42:08.073858 140042306110912 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:42:08.106887 140041386698496 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:42:08.348540 140041386698496 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 20:42:08.815776 140041400076032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:42:09.293921 140042306110912 evaluation.py:167] Evaluation [10/10]
I0812 20:42:09.294338 140042306110912 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:42:09.294411 140042306110912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:42:09.294703 140041408468736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:42:09.294827 140041408468736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:42:09.295007 140042306110912 error_handling.py:96] infeed marked as finished
I0812 20:42:09.295113 140042306110912 tpu_estimator.py:602] Stop output thread controller
I0812 20:42:09.295162 140042306110912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:42:09.295314 140041400076032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:42:09.295396 140041400076032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:42:09.295538 140042306110912 error_handling.py:96] outfeed marked as finished
I0812 20:42:09.295629 140042306110912 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:42:38.438316 140042306110912 evaluation.py:275] Finished evaluation at 2019-08-12-20:42:38
I0812 20:42:38.438668 140042306110912 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9691, global_step = 30, loss = 0.08361554
I0812 20:42:42.767019 140042306110912 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:42:43.612251 140042306110912 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08361554, 'global_step': 30, 'accuracy': 0.9691}

Removing gs://yangyou-mnist/log/#1565642363925764...
Removing gs://yangyou-mnist/log/checkpoint#1565642442998783...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565642364.v3-8-tpu#1565642446165543...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565642368603550...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565642381050823...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565642439878051...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565642375495686...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565642440753872...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565642376445519...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565642445207298...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565642560151232...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565642560.v3-8-tpu#1565642563307249...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:42:47.437006 139939917350336 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:42:47.437777 139939917350336 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:42:47.440330 139939917350336 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:42:47.441137 139939917350336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:42:47.441705 139939917350336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:42:47.441845 139939917350336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:42:47.853121 139939917350336 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:42:47.859877 139939917350336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:42:47.863567 139939917350336 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:42:47.911240 139939917350336 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:42:47.911529 139939917350336 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:42:48.212701 139939917350336 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:42:48.259592 139939917350336 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:42:48.259890 139939917350336 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:42:48.434750 139939917350336 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f462739b150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4629578210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:42:48.435086 139939917350336 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:42:48.757750 139939917350336 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:42:48.760697: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:42:48.773571 139939917350336 tpu_system_metadata.py:148] Found TPU system:
I0812 20:42:48.773818 139939917350336 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:42:48.774350 139939917350336 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:42:48.774410 139939917350336 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:42:48.774466 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:42:48.774763 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:42:48.774820 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:42:48.774871 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:42:48.774919 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:42:48.774965 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:42:48.775015 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:42:48.775062 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:42:48.775106 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:42:48.775166 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:42:48.775216 139939917350336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:42:48.781033 139939917350336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:42:48.793355 139939917350336 estimator.py:1145] Calling model_fn.
W0812 20:42:48.793967 139939917350336 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:42:49.078546 139939917350336 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:42:49.496113 139939917350336 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:42:49.555538 139939917350336 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:42:49.561445 139939917350336 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:42:49.738269 139939917350336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:42:49.751605 139939917350336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:42:49.766480 139939917350336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:42:49.776525 139939917350336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:42:49.782255 139939917350336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:42:50.193170 139939917350336 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:42:50.208890 139939917350336 estimator.py:1147] Done calling model_fn.
I0812 20:42:53.613112 139939917350336 tpu_estimator.py:499] TPU job name worker
I0812 20:42:53.724524 139939917350336 monitored_session.py:240] Graph was finalized.
I0812 20:42:54.286979 139939917350336 session_manager.py:500] Running local_init_op.
I0812 20:42:54.331105 139939917350336 session_manager.py:502] Done running local_init_op.
I0812 20:42:56.992090 139939917350336 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:43:09.457360 139939917350336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:43:09.567322 139939917350336 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:43:09.567760 139939917350336 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:43:09.568142: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:43:09.572721 139939917350336 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:43:09.574958 139939917350336 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:43:09.579020 139939917350336 tpu_estimator.py:557] Init TPU system
I0812 20:43:52.021595 139939917350336 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:43:52.022562 139938884478720 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:43:52.023041 139938876086016 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:43:52.072015 139939917350336 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:43:52.073226 139939917350336 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:43:52.083362 139938867693312 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:43:52.189297 139938867693312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:43:56.647583 139938876086016 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:44:01.241015 139939917350336 basic_session_run_hooks.py:262] loss = 0.39533797, step = 30
I0812 20:44:01.243706 139939917350336 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:44:15.717570 139939917350336 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:44:15.717915 139939917350336 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:44:15.718190 139938884478720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:44:15.718322 139938884478720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:44:15.718480 139939917350336 error_handling.py:96] infeed marked as finished
I0812 20:44:15.718580 139939917350336 tpu_estimator.py:602] Stop output thread controller
I0812 20:44:15.718628 139939917350336 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:44:15.718748 139938876086016 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:44:15.718821 139938876086016 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:44:15.718934 139939917350336 error_handling.py:96] outfeed marked as finished
I0812 20:44:15.719014 139939917350336 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:44:22.323255 139939917350336 estimator.py:368] Loss for final step: 0.39533797.
I0812 20:44:22.324101 139939917350336 error_handling.py:96] training_loop marked as finished
I0812 20:44:23.087277 139939917350336 estimator.py:1145] Calling model_fn.
E0812 20:44:23.819508 139939917350336 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:44:24.051891 139939917350336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:44:24.076539 139939917350336 estimator.py:1147] Done calling model_fn.
I0812 20:44:24.094926 139939917350336 evaluation.py:255] Starting evaluation at 2019-08-12T20:44:24Z
I0812 20:44:24.095185 139939917350336 tpu_estimator.py:499] TPU job name worker
I0812 20:44:24.181399 139939917350336 monitored_session.py:240] Graph was finalized.
W0812 20:44:24.182445 139939917350336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:44:24.379755 139939917350336 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:44:26.961227 139939917350336 session_manager.py:500] Running local_init_op.
I0812 20:44:26.990214 139939917350336 session_manager.py:502] Done running local_init_op.
I0812 20:44:27.036955 139939917350336 tpu_estimator.py:557] Init TPU system
I0812 20:45:36.059885 139939917350336 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 20:45:36.061034 139938876086016 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:45:36.061589 139938867693312 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:45:36.129102 139939917350336 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:45:36.158138 139939917350336 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:45:36.158626 139939917350336 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:45:36.192718 139938859300608 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:45:36.291496 139938859300608 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:45:36.899981 139938867693312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:45:37.386318 139939917350336 evaluation.py:167] Evaluation [10/10]
I0812 20:45:37.386702 139939917350336 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:45:37.386782 139939917350336 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:45:37.386971 139938876086016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:45:37.387075 139938876086016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:45:37.387216 139939917350336 error_handling.py:96] infeed marked as finished
I0812 20:45:37.387315 139939917350336 tpu_estimator.py:602] Stop output thread controller
I0812 20:45:37.387362 139939917350336 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:45:37.387471 139938867693312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:45:37.387547 139938867693312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:45:37.387669 139939917350336 error_handling.py:96] outfeed marked as finished
I0812 20:45:37.387749 139939917350336 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:46:06.388067 139939917350336 evaluation.py:275] Finished evaluation at 2019-08-12-20:46:06
I0812 20:46:06.388417 139939917350336 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9031, global_step = 30, loss = 0.34443483
I0812 20:46:10.741517 139939917350336 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:46:11.579453 139939917350336 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.34443483, 'global_step': 30, 'accuracy': 0.9031}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565642584472868...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565642588955373...
Removing gs://yangyou-mnist/log/#1565642571779634...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565642649040836...
Removing gs://yangyou-mnist/log/checkpoint#1565642652235316...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565642571.v3-8-tpu#1565642655414371...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565642583589262...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565642649942569...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565642576452858...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565642654472705...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565642768169429...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565642768.v3-8-tpu#1565642771269995...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:46:15.408272 139715094836672 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:46:15.409080 139715094836672 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:46:15.411715 139715094836672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:46:15.412558 139715094836672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:46:15.413191 139715094836672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:46:15.413321 139715094836672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:46:15.838536 139715094836672 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:46:15.848458 139715094836672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:46:15.852988 139715094836672 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:46:15.949795 139715094836672 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:46:15.950094 139715094836672 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:46:16.065876 139715094836672 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:46:16.148674 139715094836672 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:46:16.148953 139715094836672 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:46:16.259742 139715094836672 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f11cec26150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f11d0e03210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:46:16.260123 139715094836672 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:46:16.580271 139715094836672 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:46:16.583406: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:46:16.597254 139715094836672 tpu_system_metadata.py:148] Found TPU system:
I0812 20:46:16.597503 139715094836672 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:46:16.597995 139715094836672 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:46:16.598056 139715094836672 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:46:16.598109 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:46:16.598505 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:46:16.598565 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:46:16.598617 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:46:16.598665 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:46:16.598715 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:46:16.598762 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:46:16.598808 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:46:16.598855 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:46:16.598932 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:46:16.598994 139715094836672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:46:16.605289 139715094836672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:46:16.618254 139715094836672 estimator.py:1145] Calling model_fn.
W0812 20:46:16.618906 139715094836672 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:46:16.915083 139715094836672 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:46:17.362021 139715094836672 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:46:17.425156 139715094836672 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:46:17.431272 139715094836672 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:46:17.617764 139715094836672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:46:17.631989 139715094836672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:46:17.647450 139715094836672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:46:17.657916 139715094836672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:46:17.664699 139715094836672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:46:18.087815 139715094836672 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:46:18.103492 139715094836672 estimator.py:1147] Done calling model_fn.
I0812 20:46:21.609029 139715094836672 tpu_estimator.py:499] TPU job name worker
I0812 20:46:21.728631 139715094836672 monitored_session.py:240] Graph was finalized.
I0812 20:46:22.332639 139715094836672 session_manager.py:500] Running local_init_op.
I0812 20:46:22.365288 139715094836672 session_manager.py:502] Done running local_init_op.
I0812 20:46:24.784691 139715094836672 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:46:37.038733 139715094836672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:46:37.167346 139715094836672 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:46:37.167794 139715094836672 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:46:37.168198: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:46:37.172486 139715094836672 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:46:37.174771 139715094836672 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:46:37.178478 139715094836672 tpu_estimator.py:557] Init TPU system
I0812 20:47:20.085253 139715094836672 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:47:20.086436 139714187216640 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:47:20.087486 139714178823936 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:47:20.135521 139715094836672 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:47:20.136382 139715094836672 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:47:20.166363 139714170431232 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:47:20.397326 139714170431232 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:47:24.637442 139714178823936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:47:29.317893 139715094836672 basic_session_run_hooks.py:262] loss = 0.27972463, step = 30
I0812 20:47:29.320390 139715094836672 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:47:41.980950 139715094836672 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:47:41.981261 139715094836672 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:47:41.981638 139714187216640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:47:41.981772 139714187216640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:47:41.981930 139715094836672 error_handling.py:96] infeed marked as finished
I0812 20:47:41.982065 139715094836672 tpu_estimator.py:602] Stop output thread controller
I0812 20:47:41.982135 139715094836672 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:47:41.982321 139714178823936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:47:41.982405 139714178823936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:47:41.982532 139715094836672 error_handling.py:96] outfeed marked as finished
I0812 20:47:41.982625 139715094836672 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:47:50.530505 139715094836672 estimator.py:368] Loss for final step: 0.27972463.
I0812 20:47:50.531380 139715094836672 error_handling.py:96] training_loop marked as finished
I0812 20:47:51.364792 139715094836672 estimator.py:1145] Calling model_fn.
E0812 20:47:52.165360 139715094836672 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:47:52.420919 139715094836672 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:47:52.447990 139715094836672 estimator.py:1147] Done calling model_fn.
I0812 20:47:52.465285 139715094836672 evaluation.py:255] Starting evaluation at 2019-08-12T20:47:52Z
I0812 20:47:52.465540 139715094836672 tpu_estimator.py:499] TPU job name worker
I0812 20:47:52.545494 139715094836672 monitored_session.py:240] Graph was finalized.
W0812 20:47:52.546325 139715094836672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:47:52.740952 139715094836672 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:47:55.436003 139715094836672 session_manager.py:500] Running local_init_op.
I0812 20:47:55.465584 139715094836672 session_manager.py:502] Done running local_init_op.
I0812 20:47:55.516782 139715094836672 tpu_estimator.py:557] Init TPU system
I0812 20:49:03.986223 139715094836672 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:49:03.987204 139714212394752 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:49:03.987678 139714187216640 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:49:04.053421 139715094836672 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:49:04.083367 139715094836672 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:49:04.083723 139715094836672 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:49:04.111629 139714178823936 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:49:04.256000 139714178823936 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:49:04.820777 139714187216640 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:49:05.302515 139715094836672 evaluation.py:167] Evaluation [10/10]
I0812 20:49:05.302841 139715094836672 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:49:05.302910 139715094836672 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:49:05.303174 139714212394752 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:49:05.303275 139714212394752 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:49:05.303411 139715094836672 error_handling.py:96] infeed marked as finished
I0812 20:49:05.303502 139715094836672 tpu_estimator.py:602] Stop output thread controller
I0812 20:49:05.303550 139715094836672 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:49:05.303662 139714187216640 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:49:05.303731 139714187216640 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:49:05.303844 139715094836672 error_handling.py:96] outfeed marked as finished
I0812 20:49:05.303920 139715094836672 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:49:34.349721 139715094836672 evaluation.py:275] Finished evaluation at 2019-08-12-20:49:34
I0812 20:49:34.350059 139715094836672 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9293, global_step = 30, loss = 0.23479362
I0812 20:49:38.690907 139715094836672 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:49:39.510925 139715094836672 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.23479362, 'global_step': 30, 'accuracy': 0.9293}

Removing gs://yangyou-mnist/log/#1565642779587103...
Removing gs://yangyou-mnist/log/checkpoint#1565642858568651...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565642779.v3-8-tpu#1565642861691089...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565642784296763...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565642791333802...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565642792240690...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565642796532866...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565642855675727...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565642856506900...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565642860874620...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565642976108848...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565642976.v3-8-tpu#1565642979192664...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:49:43.312912 140123284878784 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:49:43.313711 140123284878784 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:49:43.316351 140123284878784 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:49:43.317192 140123284878784 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:49:43.317789 140123284878784 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:49:43.317931 140123284878784 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:49:43.744016 140123284878784 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:49:43.751246 140123284878784 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:49:43.755290 140123284878784 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:49:43.850929 140123284878784 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:49:43.851242 140123284878784 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:49:43.966100 140123284878784 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:49:44.011771 140123284878784 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:49:44.012052 140123284878784 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:49:44.166098 140123284878784 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f70d8c82190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f70dae5f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:49:44.166496 140123284878784 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:49:44.516041 140123284878784 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:49:44.519084: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:49:44.531867 140123284878784 tpu_system_metadata.py:148] Found TPU system:
I0812 20:49:44.532104 140123284878784 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:49:44.532694 140123284878784 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:49:44.532778 140123284878784 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:49:44.532860 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:49:44.533230 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:49:44.533291 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:49:44.533346 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:49:44.533397 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:49:44.533446 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:49:44.533492 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:49:44.533546 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:49:44.533591 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:49:44.533638 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:49:44.533684 140123284878784 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:49:44.539652 140123284878784 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:49:44.551947 140123284878784 estimator.py:1145] Calling model_fn.
W0812 20:49:44.552561 140123284878784 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:49:44.818638 140123284878784 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:49:45.473361 140123284878784 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:49:45.533242 140123284878784 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:49:45.538932 140123284878784 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:49:45.712025 140123284878784 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:49:45.725548 140123284878784 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:49:45.740406 140123284878784 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:49:45.750392 140123284878784 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:49:45.756299 140123284878784 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:49:46.173639 140123284878784 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:49:46.188973 140123284878784 estimator.py:1147] Done calling model_fn.
I0812 20:49:49.905849 140123284878784 tpu_estimator.py:499] TPU job name worker
I0812 20:49:50.018462 140123284878784 monitored_session.py:240] Graph was finalized.
I0812 20:49:50.620625 140123284878784 session_manager.py:500] Running local_init_op.
I0812 20:49:50.654731 140123284878784 session_manager.py:502] Done running local_init_op.
I0812 20:49:53.529692 140123284878784 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:50:05.798572 140123284878784 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:50:05.924261 140123284878784 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:50:05.924738 140123284878784 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:50:05.925173: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:50:05.930102 140123284878784 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:50:05.932394 140123284878784 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:50:05.937500 140123284878784 tpu_estimator.py:557] Init TPU system
I0812 20:50:48.037599 140123284878784 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:50:48.038749 140122525247232 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:50:48.039566 140122516854528 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:50:48.084970 140123284878784 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:50:48.086014 140123284878784 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:50:48.096927 140122032961280 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:50:48.174490 140122032961280 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:50:52.696567 140122516854528 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:50:57.175857 140123284878784 basic_session_run_hooks.py:262] loss = 2.3019145, step = 30
I0812 20:50:57.178946 140123284878784 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:51:10.693454 140123284878784 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:51:10.693732 140123284878784 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:51:10.694091 140122525247232 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:51:10.694426 140122525247232 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:51:10.694670 140123284878784 error_handling.py:96] infeed marked as finished
I0812 20:51:10.694941 140123284878784 tpu_estimator.py:602] Stop output thread controller
I0812 20:51:10.695009 140123284878784 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:51:10.695261 140122516854528 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:51:10.695478 140122516854528 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:51:10.695668 140123284878784 error_handling.py:96] outfeed marked as finished
I0812 20:51:10.695826 140123284878784 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:51:18.317562 140123284878784 estimator.py:368] Loss for final step: 2.3019145.
I0812 20:51:18.318470 140123284878784 error_handling.py:96] training_loop marked as finished
I0812 20:51:19.173342 140123284878784 estimator.py:1145] Calling model_fn.
E0812 20:51:19.873313 140123284878784 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:51:20.098126 140123284878784 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:51:20.126806 140123284878784 estimator.py:1147] Done calling model_fn.
I0812 20:51:20.143558 140123284878784 evaluation.py:255] Starting evaluation at 2019-08-12T20:51:20Z
I0812 20:51:20.143809 140123284878784 tpu_estimator.py:499] TPU job name worker
I0812 20:51:20.221927 140123284878784 monitored_session.py:240] Graph was finalized.
W0812 20:51:20.222760 140123284878784 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:51:20.410836 140123284878784 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:51:23.118786 140123284878784 session_manager.py:500] Running local_init_op.
I0812 20:51:23.143584 140123284878784 session_manager.py:502] Done running local_init_op.
I0812 20:51:23.199368 140123284878784 tpu_estimator.py:557] Init TPU system
I0812 20:52:31.977497 140123284878784 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:52:31.978466 140122521577216 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:52:31.979487 140122032961280 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:52:32.046133 140123284878784 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:52:32.074809 140123284878784 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:52:32.075189 140123284878784 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:52:32.109922 140122024568576 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:52:32.249881 140122024568576 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:52:32.852112 140122032961280 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:52:33.151422 140123284878784 evaluation.py:167] Evaluation [10/10]
I0812 20:52:33.151890 140123284878784 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:52:33.151997 140123284878784 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:52:33.152326 140122521577216 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:52:33.152640 140122521577216 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:52:33.152919 140123284878784 error_handling.py:96] infeed marked as finished
I0812 20:52:33.153211 140123284878784 tpu_estimator.py:602] Stop output thread controller
I0812 20:52:33.153273 140123284878784 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:52:33.153523 140122032961280 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:52:33.153691 140122032961280 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:52:33.153882 140123284878784 error_handling.py:96] outfeed marked as finished
I0812 20:52:33.154110 140123284878784 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:53:02.337410 140123284878784 evaluation.py:275] Finished evaluation at 2019-08-12-20:53:02
I0812 20:53:02.337768 140123284878784 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2990134
I0812 20:53:06.675878 140123284878784 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:53:07.541382 140123284878784 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2990134, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565642987677950...
Removing gs://yangyou-mnist/log/checkpoint#1565643067216715...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565643000807889...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565643005307884...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565642987.v3-8-tpu#1565643070382798...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565643064128384...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565642999992654...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565642993001797...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565643064947535...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565643069457421...
Removing gs://yangyou-mnist/log/eval/#1565643184087409...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565643184.v3-8-tpu#1565643187234413...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:53:11.400084 139952557811136 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:53:11.400856 139952557811136 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:53:11.403517 139952557811136 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:53:11.404325 139952557811136 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:53:11.404900 139952557811136 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:53:11.405050 139952557811136 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:53:11.819324 139952557811136 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:53:11.826445 139952557811136 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:53:11.830598 139952557811136 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:53:11.877578 139952557811136 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:53:11.877849 139952557811136 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:53:11.984954 139952557811136 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:53:12.031960 139952557811136 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:53:12.032233 139952557811136 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:53:12.128122 139952557811136 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4918a66290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f491ac5a1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:53:12.128468 139952557811136 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:53:12.446393 139952557811136 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:53:12.449308: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:53:12.463222 139952557811136 tpu_system_metadata.py:148] Found TPU system:
I0812 20:53:12.463465 139952557811136 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:53:12.463953 139952557811136 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:53:12.464014 139952557811136 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:53:12.464066 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:53:12.464358 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:53:12.464413 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:53:12.464464 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:53:12.464521 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:53:12.464570 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:53:12.464617 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:53:12.464663 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:53:12.464709 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:53:12.464754 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:53:12.464802 139952557811136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:53:12.470731 139952557811136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:53:12.482934 139952557811136 estimator.py:1145] Calling model_fn.
W0812 20:53:12.483536 139952557811136 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:53:12.768368 139952557811136 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:53:13.181539 139952557811136 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:53:13.242505 139952557811136 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:53:13.248595 139952557811136 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:53:13.427575 139952557811136 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:53:13.441185 139952557811136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:53:13.456429 139952557811136 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:53:13.466662 139952557811136 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:53:13.472687 139952557811136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:53:13.885994 139952557811136 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:53:13.901673 139952557811136 estimator.py:1147] Done calling model_fn.
I0812 20:53:17.298218 139952557811136 tpu_estimator.py:499] TPU job name worker
I0812 20:53:17.410346 139952557811136 monitored_session.py:240] Graph was finalized.
I0812 20:53:17.986377 139952557811136 session_manager.py:500] Running local_init_op.
I0812 20:53:18.017869 139952557811136 session_manager.py:502] Done running local_init_op.
I0812 20:53:20.566215 139952557811136 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:53:32.526761 139952557811136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:53:32.636522 139952557811136 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:53:32.637123 139952557811136 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:53:32.637552: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:53:32.642889 139952557811136 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:53:32.645570 139952557811136 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:53:32.650116 139952557811136 tpu_estimator.py:557] Init TPU system
I0812 20:54:16.062417 139952557811136 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 20:54:16.063456 139951789807360 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:54:16.064476 139951308011264 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:54:16.110503 139952557811136 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:54:16.111538 139952557811136 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:54:16.123697 139951299618560 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:54:16.244719 139951299618560 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:54:20.556552 139951308011264 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:54:25.037863 139952557811136 basic_session_run_hooks.py:262] loss = 2.3027933, step = 30
I0812 20:54:25.040734 139952557811136 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:54:38.759850 139952557811136 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:54:38.760169 139952557811136 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:54:38.761827 139951789807360 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:54:38.762224 139951789807360 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:54:38.762511 139952557811136 error_handling.py:96] infeed marked as finished
I0812 20:54:38.762749 139952557811136 tpu_estimator.py:602] Stop output thread controller
I0812 20:54:38.762810 139952557811136 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:54:38.763017 139951308011264 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:54:38.763209 139951308011264 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:54:38.763425 139952557811136 error_handling.py:96] outfeed marked as finished
I0812 20:54:38.763624 139952557811136 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:54:46.369584 139952557811136 estimator.py:368] Loss for final step: 2.3027933.
I0812 20:54:46.370541 139952557811136 error_handling.py:96] training_loop marked as finished
I0812 20:54:47.104351 139952557811136 estimator.py:1145] Calling model_fn.
E0812 20:54:47.803352 139952557811136 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:54:48.035016 139952557811136 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:54:48.058784 139952557811136 estimator.py:1147] Done calling model_fn.
I0812 20:54:48.075984 139952557811136 evaluation.py:255] Starting evaluation at 2019-08-12T20:54:48Z
I0812 20:54:48.076234 139952557811136 tpu_estimator.py:499] TPU job name worker
I0812 20:54:48.157084 139952557811136 monitored_session.py:240] Graph was finalized.
W0812 20:54:48.157983 139952557811136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:54:48.351279 139952557811136 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:54:50.918232 139952557811136 session_manager.py:500] Running local_init_op.
I0812 20:54:50.946799 139952557811136 session_manager.py:502] Done running local_init_op.
I0812 20:54:51.000910 139952557811136 tpu_estimator.py:557] Init TPU system
I0812 20:55:59.993757 139952557811136 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:55:59.994976 139951789807360 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:55:59.995676 139951308011264 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:56:00.061436 139952557811136 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:56:00.091895 139952557811136 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:56:00.092294 139952557811136 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:56:00.114243 139951299618560 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:56:00.356695 139951299618560 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:56:00.881511 139951308011264 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:56:01.151912 139952557811136 evaluation.py:167] Evaluation [10/10]
I0812 20:56:01.152271 139952557811136 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:56:01.152339 139952557811136 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:56:01.152637 139951789807360 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:56:01.152934 139951789807360 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:56:01.153213 139952557811136 error_handling.py:96] infeed marked as finished
I0812 20:56:01.153403 139952557811136 tpu_estimator.py:602] Stop output thread controller
I0812 20:56:01.153456 139952557811136 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:56:01.153657 139951308011264 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:56:01.153851 139951308011264 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:56:01.154022 139952557811136 error_handling.py:96] outfeed marked as finished
I0812 20:56:01.154194 139952557811136 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:56:30.431117 139952557811136 evaluation.py:275] Finished evaluation at 2019-08-12-20:56:30
I0812 20:56:30.431471 139952557811136 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2995355
I0812 20:56:35.195552 139952557811136 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 20:56:36.078934 139952557811136 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2995355, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/#1565643195438160...
Removing gs://yangyou-mnist/log/checkpoint#1565643275346884...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565643195.v3-8-tpu#1565643278437415...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565643271596305...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565643200032880...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565643272463826...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565643206992791...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565643212034942...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565643207865586...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565643277550371...
Removing gs://yangyou-mnist/log/eval/#1565643392633407...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565643392.v3-8-tpu#1565643395768796...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 20:56:39.975928 139635665958336 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 20:56:39.976747 139635665958336 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 20:56:39.979577 139635665958336 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 20:56:39.980437 139635665958336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 20:56:39.981043 139635665958336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 20:56:39.981170 139635665958336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 20:56:40.398446 139635665958336 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 20:56:40.405865 139635665958336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 20:56:40.410181 139635665958336 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:56:40.457029 139635665958336 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:56:40.457339 139635665958336 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:56:40.587932 139635665958336 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 20:56:40.631488 139635665958336 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 20:56:40.631789 139635665958336 transport.py:157] Attempting refresh to obtain initial access_token
I0812 20:56:40.740500 139635665958336 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7eff506de050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7eff528bb210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 20:56:40.740881 139635665958336 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 20:56:41.061124 139635665958336 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 20:56:41.064072: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:56:41.076107 139635665958336 tpu_system_metadata.py:148] Found TPU system:
I0812 20:56:41.076340 139635665958336 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 20:56:41.076869 139635665958336 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 20:56:41.076932 139635665958336 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 20:56:41.076984 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 20:56:41.077280 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 20:56:41.077336 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 20:56:41.077387 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 20:56:41.077436 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 20:56:41.077485 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 20:56:41.077543 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 20:56:41.077591 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 20:56:41.077637 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 20:56:41.077683 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 20:56:41.077732 139635665958336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 20:56:41.083580 139635665958336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 20:56:41.096155 139635665958336 estimator.py:1145] Calling model_fn.
W0812 20:56:41.096761 139635665958336 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 20:56:41.380331 139635665958336 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 20:56:41.805563 139635665958336 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 20:56:41.866550 139635665958336 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 20:56:41.872396 139635665958336 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:56:42.047352 139635665958336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 20:56:42.060641 139635665958336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 20:56:42.075203 139635665958336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 20:56:42.090751 139635665958336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 20:56:42.096437 139635665958336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 20:56:42.509526 139635665958336 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 20:56:42.525187 139635665958336 estimator.py:1147] Done calling model_fn.
I0812 20:56:45.906779 139635665958336 tpu_estimator.py:499] TPU job name worker
I0812 20:56:46.019906 139635665958336 monitored_session.py:240] Graph was finalized.
I0812 20:56:46.569749 139635665958336 session_manager.py:500] Running local_init_op.
I0812 20:56:46.610991 139635665958336 session_manager.py:502] Done running local_init_op.
I0812 20:56:49.147732 139635665958336 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 20:57:01.190577 139635665958336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 20:57:01.300185 139635665958336 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:57:01.300685 139635665958336 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 20:57:01.301092: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 20:57:01.305224 139635665958336 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 20:57:01.307815 139635665958336 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 20:57:01.311342 139635665958336 tpu_estimator.py:557] Init TPU system
I0812 20:57:44.055762 139635665958336 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 20:57:44.056885 139634487064320 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:57:44.057503 139634478671616 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:57:44.105134 139635665958336 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 20:57:44.106235 139635665958336 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 20:57:44.120549 139634470278912 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:57:44.223026 139634470278912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 20:57:48.707943 139634478671616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:57:53.211807 139635665958336 basic_session_run_hooks.py:262] loss = 1.3162823, step = 30
I0812 20:57:53.213771 139635665958336 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 20:58:06.732238 139635665958336 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:58:06.732537 139635665958336 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:58:06.732769 139634487064320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:58:06.732882 139634487064320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:58:06.733023 139635665958336 error_handling.py:96] infeed marked as finished
I0812 20:58:06.733124 139635665958336 tpu_estimator.py:602] Stop output thread controller
I0812 20:58:06.733171 139635665958336 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:58:06.733287 139634478671616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:58:06.733365 139634478671616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:58:06.733481 139635665958336 error_handling.py:96] outfeed marked as finished
I0812 20:58:06.733568 139635665958336 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:58:14.361521 139635665958336 estimator.py:368] Loss for final step: 1.3162823.
I0812 20:58:14.362405 139635665958336 error_handling.py:96] training_loop marked as finished
I0812 20:58:15.178998 139635665958336 estimator.py:1145] Calling model_fn.
E0812 20:58:15.872422 139635665958336 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 20:58:16.100315 139635665958336 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 20:58:16.124833 139635665958336 estimator.py:1147] Done calling model_fn.
I0812 20:58:16.141603 139635665958336 evaluation.py:255] Starting evaluation at 2019-08-12T20:58:16Z
I0812 20:58:16.141855 139635665958336 tpu_estimator.py:499] TPU job name worker
I0812 20:58:16.222810 139635665958336 monitored_session.py:240] Graph was finalized.
W0812 20:58:16.223536 139635665958336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 20:58:16.410056 139635665958336 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 20:58:19.056118 139635665958336 session_manager.py:500] Running local_init_op.
I0812 20:58:19.086241 139635665958336 session_manager.py:502] Done running local_init_op.
I0812 20:58:19.136020 139635665958336 tpu_estimator.py:557] Init TPU system
I0812 20:59:28.055957 139635665958336 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 20:59:28.057070 139634478671616 tpu_estimator.py:514] Starting infeed thread controller.
I0812 20:59:28.057817 139634470278912 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 20:59:28.125642 139635665958336 util.py:98] Initialized dataset iterators in 0 seconds
I0812 20:59:28.155642 139635665958336 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 20:59:28.156846 139635665958336 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 20:59:28.190031 139634461886208 transport.py:157] Attempting refresh to obtain initial access_token
W0812 20:59:28.304980 139634461886208 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 20:59:28.934689 139634470278912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 20:59:29.258009 139635665958336 evaluation.py:167] Evaluation [10/10]
I0812 20:59:29.258465 139635665958336 tpu_estimator.py:598] Stop infeed thread controller
I0812 20:59:29.258542 139635665958336 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 20:59:29.259043 139634478671616 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 20:59:29.259315 139634478671616 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 20:59:29.259526 139635665958336 error_handling.py:96] infeed marked as finished
I0812 20:59:29.259723 139635665958336 tpu_estimator.py:602] Stop output thread controller
I0812 20:59:29.259784 139635665958336 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 20:59:29.259972 139634470278912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 20:59:29.260155 139634470278912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 20:59:29.260330 139635665958336 error_handling.py:96] outfeed marked as finished
I0812 20:59:29.260471 139635665958336 tpu_estimator.py:606] Shutdown TPU system.
I0812 20:59:58.404839 139635665958336 evaluation.py:275] Finished evaluation at 2019-08-12-20:59:58
I0812 20:59:58.405183 139635665958336 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8036, global_step = 30, loss = 1.2348832
I0812 21:00:02.851377 139635665958336 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:00:03.662246 139635665958336 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.2348832, 'global_step': 30, 'accuracy': 0.8036}

Removing gs://yangyou-mnist/log/#1565643404062848...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565643404.v3-8-tpu#1565643486431109...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565643416351288...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565643408622718...
Removing gs://yangyou-mnist/log/checkpoint#1565643483296214...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565643415445725...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565643420710306...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565643481017469...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565643480070933...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565643485437496...
Removing gs://yangyou-mnist/log/eval/#1565643600154685...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565643600.v3-8-tpu#1565643603355804...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:00:07.558301 140520481129920 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:00:07.559073 140520481129920 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:00:07.561614 140520481129920 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:00:07.562505 140520481129920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:00:07.563097 140520481129920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:00:07.563227 140520481129920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:00:07.981877 140520481129920 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:00:07.998280 140520481129920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:00:08.002551 140520481129920 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:00:08.052035 140520481129920 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:00:08.052334 140520481129920 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:00:08.168049 140520481129920 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:00:08.210874 140520481129920 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:00:08.211189 140520481129920 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:00:08.286570 140520481129920 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcd5385f0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcd55a3c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:00:08.286926 140520481129920 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:00:08.610750 140520481129920 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:00:08.613664: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:00:08.626399 140520481129920 tpu_system_metadata.py:148] Found TPU system:
I0812 21:00:08.626642 140520481129920 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:00:08.627125 140520481129920 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:00:08.627182 140520481129920 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:00:08.627234 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:00:08.627532 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:00:08.627594 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:00:08.627646 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:00:08.627696 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:00:08.627743 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:00:08.627789 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:00:08.627835 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:00:08.627881 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:00:08.627927 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:00:08.627974 140520481129920 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:00:08.634268 140520481129920 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:00:08.647264 140520481129920 estimator.py:1145] Calling model_fn.
W0812 21:00:08.647903 140520481129920 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:00:08.934849 140520481129920 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:00:09.575225 140520481129920 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:00:09.637160 140520481129920 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:00:09.643405 140520481129920 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:00:09.823832 140520481129920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:00:09.837604 140520481129920 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:00:09.853017 140520481129920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:00:09.863327 140520481129920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:00:09.869436 140520481129920 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:00:10.299062 140520481129920 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:00:10.315083 140520481129920 estimator.py:1147] Done calling model_fn.
I0812 21:00:13.972251 140520481129920 tpu_estimator.py:499] TPU job name worker
I0812 21:00:14.090771 140520481129920 monitored_session.py:240] Graph was finalized.
I0812 21:00:14.669045 140520481129920 session_manager.py:500] Running local_init_op.
I0812 21:00:14.700901 140520481129920 session_manager.py:502] Done running local_init_op.
I0812 21:00:17.346430 140520481129920 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:00:29.349378 140520481129920 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:00:29.458462 140520481129920 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:00:29.458908 140520481129920 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:00:29.459302: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:00:29.463999 140520481129920 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:00:29.466270 140520481129920 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:00:29.470365 140520481129920 tpu_estimator.py:557] Init TPU system
I0812 21:01:12.060542 140520481129920 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:01:12.061597 140519451653888 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:01:12.062107 140519443261184 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:01:12.110291 140520481129920 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:01:12.111875 140520481129920 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:01:12.116425 140519434868480 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:01:12.277030 140519434868480 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:01:16.653863 140519443261184 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:01:21.202342 140520481129920 basic_session_run_hooks.py:262] loss = 0.6173046, step = 30
I0812 21:01:21.204983 140520481129920 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:01:34.883657 140520481129920 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:01:34.883954 140520481129920 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:01:34.884196 140519451653888 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:01:34.884306 140519451653888 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:01:34.884448 140520481129920 error_handling.py:96] infeed marked as finished
I0812 21:01:34.884545 140520481129920 tpu_estimator.py:602] Stop output thread controller
I0812 21:01:34.884593 140520481129920 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:01:34.884706 140519443261184 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:01:34.884778 140519443261184 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:01:34.884891 140520481129920 error_handling.py:96] outfeed marked as finished
I0812 21:01:34.884974 140520481129920 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:01:42.418421 140520481129920 estimator.py:368] Loss for final step: 0.6173046.
I0812 21:01:42.419292 140520481129920 error_handling.py:96] training_loop marked as finished
I0812 21:01:43.150326 140520481129920 estimator.py:1145] Calling model_fn.
E0812 21:01:43.863168 140520481129920 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:01:44.094274 140520481129920 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:01:44.117564 140520481129920 estimator.py:1147] Done calling model_fn.
I0812 21:01:44.134274 140520481129920 evaluation.py:255] Starting evaluation at 2019-08-12T21:01:44Z
I0812 21:01:44.134516 140520481129920 tpu_estimator.py:499] TPU job name worker
I0812 21:01:44.213464 140520481129920 monitored_session.py:240] Graph was finalized.
W0812 21:01:44.214389 140520481129920 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:01:44.404465 140520481129920 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:01:46.955589 140520481129920 session_manager.py:500] Running local_init_op.
I0812 21:01:46.984836 140520481129920 session_manager.py:502] Done running local_init_op.
I0812 21:01:47.032762 140520481129920 tpu_estimator.py:557] Init TPU system
I0812 21:02:56.005300 140520481129920 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 21:02:56.006254 140519449032448 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:02:56.006829 140519440639744 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:02:56.073770 140520481129920 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:02:56.101418 140520481129920 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:02:56.101816 140520481129920 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:02:56.132493 140519432247040 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:02:56.266850 140519432247040 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:02:56.877062 140519440639744 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:02:57.326246 140520481129920 evaluation.py:167] Evaluation [10/10]
I0812 21:02:57.326561 140520481129920 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:02:57.326658 140520481129920 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:02:57.326895 140519449032448 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:02:57.327018 140519449032448 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:02:57.327192 140520481129920 error_handling.py:96] infeed marked as finished
I0812 21:02:57.327301 140520481129920 tpu_estimator.py:602] Stop output thread controller
I0812 21:02:57.327351 140520481129920 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:02:57.327497 140519440639744 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:02:57.327577 140519440639744 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:02:57.327728 140520481129920 error_handling.py:96] outfeed marked as finished
I0812 21:02:57.327817 140520481129920 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:03:26.368997 140520481129920 evaluation.py:275] Finished evaluation at 2019-08-12-21:03:26
I0812 21:03:26.369388 140520481129920 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8625, global_step = 30, loss = 0.55068266
I0812 21:03:31.025598 140520481129920 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:03:31.824316 140520481129920 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.55068266, 'global_step': 30, 'accuracy': 0.8625}

Removing gs://yangyou-mnist/log/#1565643611842601...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565643612.v3-8-tpu#1565643694571618...
Removing gs://yangyou-mnist/log/checkpoint#1565643691415980...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565643616801091...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565643623675909...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565643624599057...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565643628872784...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565643688378573...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565643689242829...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565643693581400...
Removing gs://yangyou-mnist/log/eval/#1565643808053012...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565643808.v3-8-tpu#1565643811530534...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:03:35.686945 140237137413568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:03:35.687727 140237137413568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:03:35.690531 140237137413568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:03:35.691384 140237137413568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:03:35.691970 140237137413568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:03:35.692115 140237137413568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:03:36.119599 140237137413568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:03:36.126388 140237137413568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:03:36.130378 140237137413568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:03:36.224666 140237137413568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:03:36.224976 140237137413568 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:03:36.377551 140237137413568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:03:36.428900 140237137413568 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:03:36.429197 140237137413568 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:03:36.513191 140237137413568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8b5aebf250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8b5d09c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:03:36.513581 140237137413568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:03:36.827478 140237137413568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:03:36.830599: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:03:36.847625 140237137413568 tpu_system_metadata.py:148] Found TPU system:
I0812 21:03:36.847867 140237137413568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:03:36.848470 140237137413568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:03:36.848539 140237137413568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:03:36.848614 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:03:36.848968 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:03:36.849040 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:03:36.849092 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:03:36.849142 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:03:36.849193 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:03:36.849241 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:03:36.849287 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:03:36.849333 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:03:36.849379 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:03:36.849425 140237137413568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:03:36.855662 140237137413568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:03:36.868536 140237137413568 estimator.py:1145] Calling model_fn.
W0812 21:03:36.869148 140237137413568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:03:37.151942 140237137413568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:03:37.742302 140237137413568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:03:37.805599 140237137413568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:03:37.811706 140237137413568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:03:37.995635 140237137413568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:03:38.010075 140237137413568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:03:38.025650 140237137413568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:03:38.036075 140237137413568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:03:38.042216 140237137413568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:03:38.472587 140237137413568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:03:38.488280 140237137413568 estimator.py:1147] Done calling model_fn.
I0812 21:03:41.842195 140237137413568 tpu_estimator.py:499] TPU job name worker
I0812 21:03:41.961143 140237137413568 monitored_session.py:240] Graph was finalized.
I0812 21:03:42.566258 140237137413568 session_manager.py:500] Running local_init_op.
I0812 21:03:42.598409 140237137413568 session_manager.py:502] Done running local_init_op.
I0812 21:03:45.161473 140237137413568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:03:57.377243 140237137413568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:03:57.498579 140237137413568 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:03:57.499093 140237137413568 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:03:57.499479: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:03:57.504725 140237137413568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:03:57.506980 140237137413568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:03:57.511267 140237137413568 tpu_estimator.py:557] Init TPU system
I0812 21:04:39.958878 140237137413568 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:04:39.960045 140236109375232 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:04:39.960855 140236100982528 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:04:40.010848 140237137413568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:04:40.013686 140237137413568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:04:40.018603 140236092589824 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:04:40.124946 140236092589824 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:04:44.567147 140236100982528 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:04:49.184931 140237137413568 basic_session_run_hooks.py:262] loss = 0.34718683, step = 30
I0812 21:04:49.187434 140237137413568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:05:03.019306 140237137413568 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:05:03.019609 140237137413568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:05:03.019934 140236109375232 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:05:03.020287 140236109375232 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:05:03.020499 140237137413568 error_handling.py:96] infeed marked as finished
I0812 21:05:03.020685 140237137413568 tpu_estimator.py:602] Stop output thread controller
I0812 21:05:03.020740 140237137413568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:05:03.020945 140236100982528 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:05:03.021141 140236100982528 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:05:03.021552 140237137413568 error_handling.py:96] outfeed marked as finished
I0812 21:05:03.021740 140237137413568 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:05:10.268352 140237137413568 estimator.py:368] Loss for final step: 0.34718683.
I0812 21:05:10.269162 140237137413568 error_handling.py:96] training_loop marked as finished
I0812 21:05:10.973995 140237137413568 estimator.py:1145] Calling model_fn.
E0812 21:05:11.674638 140237137413568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:05:11.900352 140237137413568 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:05:11.923336 140237137413568 estimator.py:1147] Done calling model_fn.
I0812 21:05:11.939841 140237137413568 evaluation.py:255] Starting evaluation at 2019-08-12T21:05:11Z
I0812 21:05:11.940072 140237137413568 tpu_estimator.py:499] TPU job name worker
I0812 21:05:12.017344 140237137413568 monitored_session.py:240] Graph was finalized.
W0812 21:05:12.018042 140237137413568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:05:12.215261 140237137413568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:05:14.961318 140237137413568 session_manager.py:500] Running local_init_op.
I0812 21:05:14.991350 140237137413568 session_manager.py:502] Done running local_init_op.
I0812 21:05:15.043940 140237137413568 tpu_estimator.py:557] Init TPU system
I0812 21:06:24.071947 140237137413568 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 21:06:24.073236 140236097312512 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:06:24.074019 140236083934976 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:06:24.138350 140237137413568 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:06:24.162081 140237137413568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:06:24.162528 140237137413568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:06:24.242955 140236075542272 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:06:24.347075 140236075542272 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 21:06:24.938561 140236083934976 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:06:25.260854 140237137413568 evaluation.py:167] Evaluation [10/10]
I0812 21:06:25.261243 140237137413568 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:06:25.261332 140237137413568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:06:25.261589 140236097312512 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:06:25.261955 140236097312512 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:06:25.262228 140237137413568 error_handling.py:96] infeed marked as finished
I0812 21:06:25.262403 140237137413568 tpu_estimator.py:602] Stop output thread controller
I0812 21:06:25.262454 140237137413568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:06:25.262608 140236083934976 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:06:25.262767 140236083934976 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:06:25.263046 140237137413568 error_handling.py:96] outfeed marked as finished
I0812 21:06:25.263230 140237137413568 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:06:54.442008 140237137413568 evaluation.py:275] Finished evaluation at 2019-08-12-21:06:54
I0812 21:06:54.442421 140237137413568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9122, global_step = 30, loss = 0.35429528
I0812 21:06:59.046587 140237137413568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:06:59.840042 140237137413568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.35429528, 'global_step': 30, 'accuracy': 0.9122}

Removing gs://yangyou-mnist/log/#1565643819971435...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565643832389305...
Removing gs://yangyou-mnist/log/checkpoint#1565643899573757...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565643836873143...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565643820.v3-8-tpu#1565643902707352...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565643896354106...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565643824624909...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565643897221038...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565643831563262...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565643901769997...
Removing gs://yangyou-mnist/log/eval/#1565644016149516...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565644016.v3-8-tpu#1565644019532090...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:07:03.759186 140056711603648 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:07:03.759946 140056711603648 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:07:03.762928 140056711603648 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:07:03.763753 140056711603648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:07:03.764345 140056711603648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:07:03.764477 140056711603648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:07:04.182056 140056711603648 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:07:04.188477 140056711603648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:07:04.191988 140056711603648 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:07:04.325705 140056711603648 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:07:04.325978 140056711603648 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:07:04.423046 140056711603648 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:07:04.470935 140056711603648 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:07:04.471215 140056711603648 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:07:04.574843 140056711603648 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f6158b491d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f615ad26210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:07:04.575217 140056711603648 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:07:04.900347 140056711603648 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:07:04.903645: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:07:04.916950 140056711603648 tpu_system_metadata.py:148] Found TPU system:
I0812 21:07:04.917290 140056711603648 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:07:04.917886 140056711603648 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:07:04.917953 140056711603648 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:07:04.918020 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:07:04.918450 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:07:04.918517 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:07:04.918576 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:07:04.918637 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:07:04.918690 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:07:04.918745 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:07:04.918797 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:07:04.918848 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:07:04.918900 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:07:04.918952 140056711603648 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:07:04.925539 140056711603648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:07:04.939752 140056711603648 estimator.py:1145] Calling model_fn.
W0812 21:07:04.940397 140056711603648 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:07:05.219719 140056711603648 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:07:05.804441 140056711603648 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:07:05.867295 140056711603648 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:07:05.873316 140056711603648 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:07:06.061629 140056711603648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:07:06.082482 140056711603648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:07:06.097673 140056711603648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:07:06.108004 140056711603648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:07:06.113967 140056711603648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:07:06.537204 140056711603648 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:07:06.553196 140056711603648 estimator.py:1147] Done calling model_fn.
I0812 21:07:09.810307 140056711603648 tpu_estimator.py:499] TPU job name worker
I0812 21:07:09.926402 140056711603648 monitored_session.py:240] Graph was finalized.
I0812 21:07:10.505970 140056711603648 session_manager.py:500] Running local_init_op.
I0812 21:07:10.548522 140056711603648 session_manager.py:502] Done running local_init_op.
I0812 21:07:13.465358 140056711603648 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:07:25.604734 140056711603648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:07:25.714215 140056711603648 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:07:25.714694 140056711603648 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:07:25.715089: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:07:25.719681 140056711603648 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:07:25.722018 140056711603648 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:07:25.726392 140056711603648 tpu_estimator.py:557] Init TPU system
I0812 21:08:08.070492 140056711603648 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:08:08.071424 140055951943424 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:08:08.071930 140055943550720 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:08:08.120228 140056711603648 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:08:08.121058 140056711603648 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:08:08.140197 140055460968192 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:08:08.249089 140055460968192 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:08:12.628911 140055943550720 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:08:17.055912 140056711603648 basic_session_run_hooks.py:262] loss = 0.30241707, step = 30
I0812 21:08:17.058309 140056711603648 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:08:30.459074 140056711603648 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:08:30.459368 140056711603648 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:08:30.459673 140055951943424 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:08:30.460000 140055951943424 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:08:30.460213 140056711603648 error_handling.py:96] infeed marked as finished
I0812 21:08:30.460434 140056711603648 tpu_estimator.py:602] Stop output thread controller
I0812 21:08:30.460491 140056711603648 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:08:30.460659 140055943550720 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:08:30.460844 140055943550720 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:08:30.460993 140056711603648 error_handling.py:96] outfeed marked as finished
I0812 21:08:30.461138 140056711603648 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:08:38.385664 140056711603648 estimator.py:368] Loss for final step: 0.30241707.
I0812 21:08:38.386626 140056711603648 error_handling.py:96] training_loop marked as finished
I0812 21:08:39.083534 140056711603648 estimator.py:1145] Calling model_fn.
E0812 21:08:39.771644 140056711603648 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:08:39.996917 140056711603648 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:08:40.020951 140056711603648 estimator.py:1147] Done calling model_fn.
I0812 21:08:40.039192 140056711603648 evaluation.py:255] Starting evaluation at 2019-08-12T21:08:40Z
I0812 21:08:40.039448 140056711603648 tpu_estimator.py:499] TPU job name worker
I0812 21:08:40.126761 140056711603648 monitored_session.py:240] Graph was finalized.
W0812 21:08:40.127563 140056711603648 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:08:40.315668 140056711603648 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:08:42.970726 140056711603648 session_manager.py:500] Running local_init_op.
I0812 21:08:43.000847 140056711603648 session_manager.py:502] Done running local_init_op.
I0812 21:08:43.053186 140056711603648 tpu_estimator.py:557] Init TPU system
I0812 21:09:52.071062 140056711603648 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 21:09:52.072166 140055460968192 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:09:52.072993 140055452575488 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:09:52.137588 140056711603648 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:09:52.162471 140056711603648 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:09:52.162822 140056711603648 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:09:52.238327 140055444182784 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:09:52.331015 140055444182784 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:09:52.939378 140055452575488 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:09:53.270607 140056711603648 evaluation.py:167] Evaluation [10/10]
I0812 21:09:53.270953 140056711603648 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:09:53.271023 140056711603648 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:09:53.271322 140055460968192 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:09:53.271591 140055460968192 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:09:53.271805 140056711603648 error_handling.py:96] infeed marked as finished
I0812 21:09:53.271979 140056711603648 tpu_estimator.py:602] Stop output thread controller
I0812 21:09:53.272032 140056711603648 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:09:53.272285 140055452575488 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:09:53.272478 140055452575488 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:09:53.272654 140056711603648 error_handling.py:96] outfeed marked as finished
I0812 21:09:53.272793 140056711603648 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:10:22.419807 140056711603648 evaluation.py:275] Finished evaluation at 2019-08-12-21:10:22
I0812 21:10:22.420155 140056711603648 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9285, global_step = 30, loss = 0.27921554
I0812 21:10:26.695837 140056711603648 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:10:27.439290 140056711603648 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.27921554, 'global_step': 30, 'accuracy': 0.9285}

Removing gs://yangyou-mnist/log/#1565644028081737...
Removing gs://yangyou-mnist/log/checkpoint#1565644107043839...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565644028.v3-8-tpu#1565644110153622...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565644032926291...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565644040019266...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565644103875593...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565644045106076...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565644040931176...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565644104687063...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565644109265169...
Removing gs://yangyou-mnist/log/eval/#1565644224082859...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565644224.v3-8-tpu#1565644227130734...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:10:31.428944 140189336118720 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:10:31.429764 140189336118720 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:10:31.432569 140189336118720 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:10:31.433362 140189336118720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:10:31.433909 140189336118720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:10:31.434035 140189336118720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:10:31.836930 140189336118720 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:10:31.844080 140189336118720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:10:31.847994 140189336118720 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:10:31.940675 140189336118720 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:10:31.940951 140189336118720 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:10:32.121546 140189336118720 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:10:32.212806 140189336118720 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:10:32.213105 140189336118720 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:10:32.409151 140189336118720 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8039be1110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f803bdbe210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:10:32.409533 140189336118720 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:10:32.796185 140189336118720 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:10:32.799242: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:10:32.818736 140189336118720 tpu_system_metadata.py:148] Found TPU system:
I0812 21:10:32.818986 140189336118720 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:10:32.819500 140189336118720 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:10:32.819567 140189336118720 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:10:32.819627 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:10:32.819953 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:10:32.820019 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:10:32.820077 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:10:32.820132 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:10:32.820189 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:10:32.820242 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:10:32.820296 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:10:32.820348 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:10:32.820400 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:10:32.820457 140189336118720 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:10:32.826982 140189336118720 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:10:32.840624 140189336118720 estimator.py:1145] Calling model_fn.
W0812 21:10:32.841285 140189336118720 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:10:33.115709 140189336118720 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:10:33.538217 140189336118720 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:10:33.598875 140189336118720 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:10:33.604602 140189336118720 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:10:33.781151 140189336118720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:10:33.794447 140189336118720 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:10:33.809336 140189336118720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:10:33.819396 140189336118720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:10:33.825226 140189336118720 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:10:34.242502 140189336118720 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:10:34.258549 140189336118720 estimator.py:1147] Done calling model_fn.
I0812 21:10:37.715723 140189336118720 tpu_estimator.py:499] TPU job name worker
I0812 21:10:37.829844 140189336118720 monitored_session.py:240] Graph was finalized.
I0812 21:10:38.423573 140189336118720 session_manager.py:500] Running local_init_op.
I0812 21:10:38.456828 140189336118720 session_manager.py:502] Done running local_init_op.
I0812 21:10:41.042345 140189336118720 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:10:53.052063 140189336118720 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:10:53.172712 140189336118720 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:10:53.173203 140189336118720 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:10:53.173595: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:10:53.178518 140189336118720 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:10:53.180808 140189336118720 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:10:53.185173 140189336118720 tpu_estimator.py:557] Init TPU system
I0812 21:11:36.056313 140189336118720 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:11:36.057499 140188442150656 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:11:36.058067 140188433757952 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:11:36.105778 140189336118720 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:11:36.106709 140189336118720 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:11:36.117050 140188425365248 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:11:36.352516 140188425365248 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 21:11:40.522538 140188433757952 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:11:45.241799 140189336118720 basic_session_run_hooks.py:262] loss = 0.28125334, step = 30
I0812 21:11:45.244250 140189336118720 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:11:58.841624 140189336118720 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:11:58.842012 140189336118720 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:11:58.842288 140188442150656 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:11:58.842454 140188442150656 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:11:58.842598 140189336118720 error_handling.py:96] infeed marked as finished
I0812 21:11:58.842696 140189336118720 tpu_estimator.py:602] Stop output thread controller
I0812 21:11:58.842760 140189336118720 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:11:58.842873 140188433757952 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:11:58.842958 140188433757952 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:11:58.843066 140189336118720 error_handling.py:96] outfeed marked as finished
I0812 21:11:58.843146 140189336118720 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:12:06.491152 140189336118720 estimator.py:368] Loss for final step: 0.28125334.
I0812 21:12:06.491946 140189336118720 error_handling.py:96] training_loop marked as finished
I0812 21:12:07.310081 140189336118720 estimator.py:1145] Calling model_fn.
E0812 21:12:08.016424 140189336118720 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:12:08.262725 140189336118720 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:12:08.289046 140189336118720 estimator.py:1147] Done calling model_fn.
I0812 21:12:08.307570 140189336118720 evaluation.py:255] Starting evaluation at 2019-08-12T21:12:08Z
I0812 21:12:08.307828 140189336118720 tpu_estimator.py:499] TPU job name worker
I0812 21:12:08.395091 140189336118720 monitored_session.py:240] Graph was finalized.
W0812 21:12:08.395899 140189336118720 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:12:08.596178 140189336118720 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:12:11.275466 140189336118720 session_manager.py:500] Running local_init_op.
I0812 21:12:11.307725 140189336118720 session_manager.py:502] Done running local_init_op.
I0812 21:12:11.365578 140189336118720 tpu_estimator.py:557] Init TPU system
I0812 21:13:20.031045 140189336118720 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 21:13:20.032159 140188430087936 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:13:20.033009 140188416710400 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:13:20.103915 140189336118720 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:13:20.138998 140189336118720 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:13:20.139648 140189336118720 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:13:20.221311 140188068083456 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:13:20.460263 140188068083456 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:13:20.931570 140188416710400 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:13:21.216686 140189336118720 evaluation.py:167] Evaluation [10/10]
I0812 21:13:21.217127 140189336118720 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:13:21.217212 140189336118720 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:13:21.217551 140188430087936 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:13:21.217842 140188430087936 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:13:21.218106 140189336118720 error_handling.py:96] infeed marked as finished
I0812 21:13:21.218369 140189336118720 tpu_estimator.py:602] Stop output thread controller
I0812 21:13:21.218436 140189336118720 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:13:21.218642 140188416710400 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:13:21.218872 140188416710400 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:13:21.219141 140189336118720 error_handling.py:96] outfeed marked as finished
I0812 21:13:21.219368 140189336118720 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:13:50.557920 140189336118720 evaluation.py:275] Finished evaluation at 2019-08-12-21:13:50
I0812 21:13:50.558377 140189336118720 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9332, global_step = 30, loss = 0.27566132
I0812 21:13:54.943627 140189336118720 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:13:55.764802 140189336118720 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.27566132, 'global_step': 30, 'accuracy': 0.9332}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565644248207397...
Removing gs://yangyou-mnist/log/#1565644235867381...
Removing gs://yangyou-mnist/log/checkpoint#1565644315374990...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565644240488568...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565644236.v3-8-tpu#1565644318535224...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565644252570371...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565644247366234...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565644313197499...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565644312242309...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565644317574960...
Removing gs://yangyou-mnist/log/eval/#1565644432249094...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565644432.v3-8-tpu#1565644435446464...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:13:59.698594 140566691698112 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:13:59.699376 140566691698112 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:13:59.701934 140566691698112 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:13:59.703001 140566691698112 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:13:59.703619 140566691698112 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:13:59.703752 140566691698112 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:14:00.117917 140566691698112 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:14:00.128637 140566691698112 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:14:00.133042 140566691698112 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:14:00.224164 140566691698112 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:14:00.224514 140566691698112 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:14:00.474423 140566691698112 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:14:00.559534 140566691698112 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:14:00.559844 140566691698112 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:14:00.684519 140566691698112 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd815e340d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd818011210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:14:00.684927 140566691698112 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:14:01.008829 140566691698112 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:14:01.011851: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:14:01.024673 140566691698112 tpu_system_metadata.py:148] Found TPU system:
I0812 21:14:01.024914 140566691698112 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:14:01.025424 140566691698112 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:14:01.025499 140566691698112 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:14:01.025556 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:14:01.025840 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:14:01.025897 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:14:01.025955 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:14:01.026005 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:14:01.026060 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:14:01.026108 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:14:01.026206 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:14:01.026271 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:14:01.026319 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:14:01.026367 140566691698112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:14:01.032588 140566691698112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:14:01.046200 140566691698112 estimator.py:1145] Calling model_fn.
W0812 21:14:01.046854 140566691698112 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:14:01.329401 140566691698112 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:14:01.895699 140566691698112 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:14:01.957207 140566691698112 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:14:01.963130 140566691698112 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:14:02.155000 140566691698112 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:14:02.169310 140566691698112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:14:02.185456 140566691698112 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:14:02.195868 140566691698112 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:14:02.202482 140566691698112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:14:02.628739 140566691698112 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:14:02.644875 140566691698112 estimator.py:1147] Done calling model_fn.
I0812 21:14:05.853341 140566691698112 tpu_estimator.py:499] TPU job name worker
I0812 21:14:05.972158 140566691698112 monitored_session.py:240] Graph was finalized.
I0812 21:14:06.543656 140566691698112 session_manager.py:500] Running local_init_op.
I0812 21:14:06.583429 140566691698112 session_manager.py:502] Done running local_init_op.
I0812 21:14:09.445918 140566691698112 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:14:21.888264 140566691698112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:14:22.016233 140566691698112 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:14:22.016732 140566691698112 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:14:22.017222: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:14:22.022244 140566691698112 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:14:22.024529 140566691698112 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:14:22.028117 140566691698112 tpu_estimator.py:557] Init TPU system
I0812 21:15:04.068661 140566691698112 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:15:04.069693 140565789521664 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:15:04.070455 140565781128960 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:15:04.116508 140566691698112 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:15:04.117432 140566691698112 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:15:04.128541 140565772736256 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:15:04.247797 140565772736256 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:15:08.662080 140565781128960 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:15:13.122575 140566691698112 basic_session_run_hooks.py:262] loss = 0.26492643, step = 30
I0812 21:15:13.125339 140566691698112 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:15:26.892064 140566691698112 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:15:26.892416 140566691698112 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:15:26.893796 140565789521664 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:15:26.894093 140565789521664 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:15:26.894412 140566691698112 error_handling.py:96] infeed marked as finished
I0812 21:15:26.894644 140566691698112 tpu_estimator.py:602] Stop output thread controller
I0812 21:15:26.894711 140566691698112 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:15:26.894941 140565781128960 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:15:26.895153 140565781128960 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:15:26.895678 140566691698112 error_handling.py:96] outfeed marked as finished
I0812 21:15:26.895962 140566691698112 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:15:34.389314 140566691698112 estimator.py:368] Loss for final step: 0.26492643.
I0812 21:15:34.390185 140566691698112 error_handling.py:96] training_loop marked as finished
I0812 21:15:35.198220 140566691698112 estimator.py:1145] Calling model_fn.
E0812 21:15:35.893213 140566691698112 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:15:36.113148 140566691698112 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:15:36.136120 140566691698112 estimator.py:1147] Done calling model_fn.
I0812 21:15:36.152681 140566691698112 evaluation.py:255] Starting evaluation at 2019-08-12T21:15:36Z
I0812 21:15:36.152921 140566691698112 tpu_estimator.py:499] TPU job name worker
I0812 21:15:36.229968 140566691698112 monitored_session.py:240] Graph was finalized.
W0812 21:15:36.230767 140566691698112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:15:36.431339 140566691698112 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:15:38.986998 140566691698112 session_manager.py:500] Running local_init_op.
I0812 21:15:39.011652 140566691698112 session_manager.py:502] Done running local_init_op.
I0812 21:15:39.068388 140566691698112 tpu_estimator.py:557] Init TPU system
I0812 21:16:47.997267 140566691698112 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 21:16:47.998508 140565789521664 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:16:47.999272 140565781128960 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:16:48.066926 140566691698112 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:16:48.091912 140566691698112 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:16:48.092344 140566691698112 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:16:48.119307 140565772736256 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:16:48.364114 140565772736256 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:16:48.823607 140565781128960 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:16:49.326324 140566691698112 evaluation.py:167] Evaluation [10/10]
I0812 21:16:49.326683 140566691698112 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:16:49.326766 140566691698112 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:16:49.327044 140565789521664 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:16:49.327325 140565789521664 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:16:49.327617 140566691698112 error_handling.py:96] infeed marked as finished
I0812 21:16:49.327804 140566691698112 tpu_estimator.py:602] Stop output thread controller
I0812 21:16:49.327876 140566691698112 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:16:49.328147 140565781128960 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:16:49.328300 140565781128960 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:16:49.328471 140566691698112 error_handling.py:96] outfeed marked as finished
I0812 21:16:49.328615 140566691698112 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:17:18.456240 140566691698112 evaluation.py:275] Finished evaluation at 2019-08-12-21:17:18
I0812 21:17:18.456628 140566691698112 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9298, global_step = 30, loss = 0.2631256
I0812 21:17:22.838112 140566691698112 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:17:23.608464 140566691698112 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.2631256, 'global_step': 30, 'accuracy': 0.9298}

Removing gs://yangyou-mnist/log/#1565644444160423...
Removing gs://yangyou-mnist/log/checkpoint#1565644523130866...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565644444.v3-8-tpu#1565644526582164...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565644448905925...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565644461401009...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565644456644516...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565644455770632...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565644520072397...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565644520956611...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565644525681579...
Removing gs://yangyou-mnist/log/eval/#1565644640099665...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565644640.v3-8-tpu#1565644643299316...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:17:27.510430 139727263503808 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:17:27.511225 139727263503808 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:17:27.513953 139727263503808 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:17:27.514903 139727263503808 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:17:27.515539 139727263503808 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:17:27.515695 139727263503808 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:17:27.928771 139727263503808 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:17:27.935944 139727263503808 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:17:27.940038 139727263503808 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:17:27.984740 139727263503808 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:17:27.985028 139727263503808 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:17:28.355952 139727263503808 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:17:28.408241 139727263503808 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:17:28.408519 139727263503808 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:17:28.592366 139727263503808 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f14a4118310>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f14a62f5210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:17:28.592705 139727263503808 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:17:28.917464 139727263503808 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:17:28.920468: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:17:28.932877 139727263503808 tpu_system_metadata.py:148] Found TPU system:
I0812 21:17:28.933110 139727263503808 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:17:28.933715 139727263503808 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:17:28.933784 139727263503808 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:17:28.933840 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:17:28.934382 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:17:28.934453 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:17:28.934520 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:17:28.934572 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:17:28.934621 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:17:28.934669 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:17:28.934719 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:17:28.934766 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:17:28.934812 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:17:28.934859 139727263503808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:17:28.940952 139727263503808 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:17:28.953485 139727263503808 estimator.py:1145] Calling model_fn.
W0812 21:17:28.954098 139727263503808 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:17:29.235155 139727263503808 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:17:29.844077 139727263503808 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:17:29.905833 139727263503808 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:17:29.911889 139727263503808 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:17:30.103164 139727263503808 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:17:30.117255 139727263503808 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:17:30.132549 139727263503808 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:17:30.142971 139727263503808 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:17:30.149236 139727263503808 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:17:30.569652 139727263503808 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:17:30.585321 139727263503808 estimator.py:1147] Done calling model_fn.
I0812 21:17:34.099373 139727263503808 tpu_estimator.py:499] TPU job name worker
I0812 21:17:34.215264 139727263503808 monitored_session.py:240] Graph was finalized.
I0812 21:17:34.771290 139727263503808 session_manager.py:500] Running local_init_op.
I0812 21:17:34.805613 139727263503808 session_manager.py:502] Done running local_init_op.
I0812 21:17:37.364579 139727263503808 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:17:49.858798 139727263503808 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:17:49.982501 139727263503808 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:17:49.982955 139727263503808 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:17:49.983417: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:17:49.987623 139727263503808 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:17:49.989835 139727263503808 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:17:49.994225 139727263503808 tpu_estimator.py:557] Init TPU system
I0812 21:18:32.088033 139727263503808 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:18:32.089066 139726571091712 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:18:32.089639 139726090663680 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:18:32.134927 139727263503808 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:18:32.135855 139727263503808 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:18:32.147047 139726082270976 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:18:32.389389 139726082270976 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:18:37.008637 139726090663680 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:18:41.609054 139727263503808 basic_session_run_hooks.py:262] loss = 0.25065085, step = 30
I0812 21:18:41.611278 139727263503808 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:18:54.776855 139727263503808 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:18:54.777154 139727263503808 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:18:54.777461 139726571091712 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:18:54.777826 139726571091712 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:18:54.778093 139727263503808 error_handling.py:96] infeed marked as finished
I0812 21:18:54.778368 139727263503808 tpu_estimator.py:602] Stop output thread controller
I0812 21:18:54.778429 139727263503808 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:18:54.778614 139726090663680 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:18:54.778879 139726090663680 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:18:54.779088 139727263503808 error_handling.py:96] outfeed marked as finished
I0812 21:18:54.779268 139727263503808 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:19:02.530600 139727263503808 estimator.py:368] Loss for final step: 0.25065085.
I0812 21:19:02.531446 139727263503808 error_handling.py:96] training_loop marked as finished
I0812 21:19:03.412825 139727263503808 estimator.py:1145] Calling model_fn.
E0812 21:19:04.167402 139727263503808 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:19:04.394645 139727263503808 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:19:04.420164 139727263503808 estimator.py:1147] Done calling model_fn.
I0812 21:19:04.436542 139727263503808 evaluation.py:255] Starting evaluation at 2019-08-12T21:19:04Z
I0812 21:19:04.436794 139727263503808 tpu_estimator.py:499] TPU job name worker
I0812 21:19:04.514266 139727263503808 monitored_session.py:240] Graph was finalized.
W0812 21:19:04.514972 139727263503808 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:19:04.707243 139727263503808 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:19:07.251210 139727263503808 session_manager.py:500] Running local_init_op.
I0812 21:19:07.279284 139727263503808 session_manager.py:502] Done running local_init_op.
I0812 21:19:07.330343 139727263503808 tpu_estimator.py:557] Init TPU system
I0812 21:20:16.078424 139727263503808 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 21:20:16.079451 139726082270976 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:20:16.079967 139726073878272 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:20:16.146051 139727263503808 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:20:16.170670 139727263503808 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:20:16.171078 139727263503808 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:20:16.202217 139726065485568 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:20:16.309740 139726065485568 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:20:16.954423 139726073878272 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:20:17.312077 139727263503808 evaluation.py:167] Evaluation [10/10]
I0812 21:20:17.312515 139727263503808 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:20:17.312596 139727263503808 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:20:17.312836 139726082270976 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:20:17.312949 139726082270976 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:20:17.313091 139727263503808 error_handling.py:96] infeed marked as finished
I0812 21:20:17.313183 139727263503808 tpu_estimator.py:602] Stop output thread controller
I0812 21:20:17.313327 139727263503808 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:20:17.313469 139726073878272 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:20:17.313543 139726073878272 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:20:17.313656 139727263503808 error_handling.py:96] outfeed marked as finished
I0812 21:20:17.313735 139727263503808 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:20:46.382630 139727263503808 evaluation.py:275] Finished evaluation at 2019-08-12-21:20:46
I0812 21:20:46.382950 139727263503808 estimator.py:2039] Saving dict for global step 30: accuracy = 0.941, global_step = 30, loss = 0.24791905
I0812 21:20:50.546592 139727263503808 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:20:51.353317 139727263503808 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.24791905, 'global_step': 30, 'accuracy': 0.941}

Removing gs://yangyou-mnist/log/#1565644652101583...
Removing gs://yangyou-mnist/log/checkpoint#1565644731393068...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565644665210708...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565644652.v3-8-tpu#1565644734469946...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565644669371922...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565644656826014...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565644729256007...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565644728376463...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565644664296139...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565644733544457...
Removing gs://yangyou-mnist/log/eval/#1565644848046267...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565644848.v3-8-tpu#1565644851044042...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:20:55.195264 140081664939456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:20:55.196012 140081664939456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:20:55.198666 140081664939456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:20:55.199461 140081664939456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:20:55.200028 140081664939456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:20:55.200169 140081664939456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:20:55.605047 140081664939456 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:20:55.611843 140081664939456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:20:55.615742 140081664939456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:20:55.663893 140081664939456 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:20:55.664155 140081664939456 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:20:55.775305 140081664939456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:20:55.865803 140081664939456 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:20:55.866094 140081664939456 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:20:55.973445 140081664939456 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f67280a41d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f672a281210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:20:55.973798 140081664939456 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:20:56.298293 140081664939456 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:20:56.301073: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:20:56.313776 140081664939456 tpu_system_metadata.py:148] Found TPU system:
I0812 21:20:56.314016 140081664939456 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:20:56.314603 140081664939456 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:20:56.314672 140081664939456 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:20:56.314726 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:20:56.315017 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:20:56.315089 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:20:56.315146 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:20:56.315195 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:20:56.315243 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:20:56.315289 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:20:56.315335 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:20:56.315381 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:20:56.315427 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:20:56.315474 140081664939456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:20:56.321377 140081664939456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:20:56.333693 140081664939456 estimator.py:1145] Calling model_fn.
W0812 21:20:56.334357 140081664939456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:20:56.606195 140081664939456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:20:57.144089 140081664939456 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:20:57.205629 140081664939456 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:20:57.212793 140081664939456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:20:57.407978 140081664939456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:20:57.421694 140081664939456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:20:57.436733 140081664939456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:20:57.446825 140081664939456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:20:57.452811 140081664939456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:20:57.862783 140081664939456 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:20:57.878730 140081664939456 estimator.py:1147] Done calling model_fn.
I0812 21:21:01.127777 140081664939456 tpu_estimator.py:499] TPU job name worker
I0812 21:21:01.243432 140081664939456 monitored_session.py:240] Graph was finalized.
I0812 21:21:01.823115 140081664939456 session_manager.py:500] Running local_init_op.
I0812 21:21:01.854883 140081664939456 session_manager.py:502] Done running local_init_op.
I0812 21:21:04.432475 140081664939456 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:21:16.619012 140081664939456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:21:16.749701 140081664939456 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:21:16.750286 140081664939456 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:21:16.750708: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:21:16.756159 140081664939456 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:21:16.758642 140081664939456 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:21:16.762572 140081664939456 tpu_estimator.py:557] Init TPU system
I0812 21:22:00.057599 140081664939456 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 21:22:00.058650 140080972527360 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:22:00.059551 140080492574464 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:22:00.109905 140080484181760 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:22:00.111109 140081664939456 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:22:00.113279 140081664939456 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0812 21:22:00.233022 140080484181760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:22:04.805334 140080492574464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:22:09.373491 140081664939456 basic_session_run_hooks.py:262] loss = 0.19532642, step = 30
I0812 21:22:09.376415 140081664939456 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:22:22.608995 140081664939456 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:22:22.609265 140081664939456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:22:22.609469 140080972527360 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:22:22.609577 140080972527360 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:22:22.609716 140081664939456 error_handling.py:96] infeed marked as finished
I0812 21:22:22.609808 140081664939456 tpu_estimator.py:602] Stop output thread controller
I0812 21:22:22.609874 140081664939456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:22:22.609987 140080492574464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:22:22.610059 140080492574464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:22:22.610219 140081664939456 error_handling.py:96] outfeed marked as finished
I0812 21:22:22.610306 140081664939456 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:22:30.376759 140081664939456 estimator.py:368] Loss for final step: 0.19532642.
I0812 21:22:30.377547 140081664939456 error_handling.py:96] training_loop marked as finished
I0812 21:22:31.169583 140081664939456 estimator.py:1145] Calling model_fn.
E0812 21:22:31.864573 140081664939456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:22:32.087322 140081664939456 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:22:32.109467 140081664939456 estimator.py:1147] Done calling model_fn.
I0812 21:22:32.125507 140081664939456 evaluation.py:255] Starting evaluation at 2019-08-12T21:22:32Z
I0812 21:22:32.125735 140081664939456 tpu_estimator.py:499] TPU job name worker
I0812 21:22:32.201324 140081664939456 monitored_session.py:240] Graph was finalized.
W0812 21:22:32.202038 140081664939456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:22:32.391071 140081664939456 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:22:35.096563 140081664939456 session_manager.py:500] Running local_init_op.
I0812 21:22:35.122793 140081664939456 session_manager.py:502] Done running local_init_op.
I0812 21:22:35.179001 140081664939456 tpu_estimator.py:557] Init TPU system
I0812 21:23:44.055898 140081664939456 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 21:23:44.057148 140080484181760 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:23:44.058085 140080475789056 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:23:44.130278 140081664939456 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:23:44.157320 140081664939456 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:23:44.157677 140081664939456 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:23:44.185306 140080467396352 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:23:44.274629 140080467396352 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:23:44.914102 140080475789056 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:23:45.390808 140081664939456 evaluation.py:167] Evaluation [10/10]
I0812 21:23:45.391216 140081664939456 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:23:45.391307 140081664939456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:23:45.391571 140080484181760 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:23:45.391844 140080484181760 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:23:45.392167 140081664939456 error_handling.py:96] infeed marked as finished
I0812 21:23:45.392354 140081664939456 tpu_estimator.py:602] Stop output thread controller
I0812 21:23:45.392415 140081664939456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:23:45.392600 140080475789056 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:23:45.392760 140080475789056 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:23:45.392991 140081664939456 error_handling.py:96] outfeed marked as finished
I0812 21:23:45.393237 140081664939456 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:24:14.374244 140081664939456 evaluation.py:275] Finished evaluation at 2019-08-12-21:24:14
I0812 21:24:14.374596 140081664939456 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9487, global_step = 30, loss = 0.20901223
I0812 21:24:18.814409 140081664939456 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:24:19.611048 140081664939456 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.20901223, 'global_step': 30, 'accuracy': 0.9487}

Removing gs://yangyou-mnist/log/#1565644859396875...
Removing gs://yangyou-mnist/log/checkpoint#1565644939267425...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565644871647831...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565644863892407...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565644876110448...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565644870758012...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565644859.v3-8-tpu#1565644942303131...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565644936177871...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565644937053390...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565644941386007...
Removing gs://yangyou-mnist/log/eval/#1565645056024469...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565645056.v3-8-tpu#1565645059305110...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:24:23.551670 140357996426688 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:24:23.552448 140357996426688 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:24:23.555366 140357996426688 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:24:23.556247 140357996426688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:24:23.556870 140357996426688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:24:23.557008 140357996426688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:24:23.988065 140357996426688 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:24:23.996695 140357996426688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:24:24.001183 140357996426688 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:24:24.050208 140357996426688 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:24:24.050503 140357996426688 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:24:24.155637 140357996426688 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:24:24.197053 140357996426688 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:24:24.197329 140357996426688 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:24:24.306030 140357996426688 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa77eae2290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa780cbf210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:24:24.306463 140357996426688 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:24:24.654063 140357996426688 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:24:24.657058: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:24:24.671895 140357996426688 tpu_system_metadata.py:148] Found TPU system:
I0812 21:24:24.672138 140357996426688 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:24:24.672646 140357996426688 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:24:24.672704 140357996426688 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:24:24.672756 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:24:24.673038 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:24:24.673094 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:24:24.673146 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:24:24.673207 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:24:24.673254 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:24:24.673301 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:24:24.673347 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:24:24.673393 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:24:24.673439 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:24:24.673485 140357996426688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:24:24.679816 140357996426688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:24:24.692604 140357996426688 estimator.py:1145] Calling model_fn.
W0812 21:24:24.693242 140357996426688 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:24:24.971915 140357996426688 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:24:25.540750 140357996426688 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:24:25.603012 140357996426688 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:24:25.609134 140357996426688 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:24:25.792583 140357996426688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:24:25.806723 140357996426688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:24:25.822550 140357996426688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:24:25.832818 140357996426688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:24:25.839024 140357996426688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:24:26.268718 140357996426688 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:24:26.284684 140357996426688 estimator.py:1147] Done calling model_fn.
I0812 21:24:29.669147 140357996426688 tpu_estimator.py:499] TPU job name worker
I0812 21:24:29.789268 140357996426688 monitored_session.py:240] Graph was finalized.
I0812 21:24:30.401261 140357996426688 session_manager.py:500] Running local_init_op.
I0812 21:24:30.441134 140357996426688 session_manager.py:502] Done running local_init_op.
I0812 21:24:32.831367 140357996426688 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:24:45.822848 140357996426688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:24:45.945245 140357996426688 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:24:45.945683 140357996426688 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:24:45.946076: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:24:45.951278 140357996426688 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:24:45.953490 140357996426688 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:24:45.957941 140357996426688 tpu_estimator.py:557] Init TPU system
I0812 21:25:28.052218 140357996426688 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:25:28.053153 140357098526464 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:25:28.053637 140357090133760 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:25:28.099327 140357996426688 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:25:28.100183 140357996426688 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:25:28.113097 140357081741056 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:25:28.224528 140357081741056 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:25:32.598372 140357090133760 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:25:37.209676 140357996426688 basic_session_run_hooks.py:262] loss = 0.16194399, step = 30
I0812 21:25:37.212322 140357996426688 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:25:50.461935 140357996426688 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:25:50.462290 140357996426688 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:25:50.462505 140357098526464 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:25:50.462600 140357098526464 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:25:50.462743 140357996426688 error_handling.py:96] infeed marked as finished
I0812 21:25:50.462837 140357996426688 tpu_estimator.py:602] Stop output thread controller
I0812 21:25:50.462892 140357996426688 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:25:50.463005 140357090133760 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:25:50.463076 140357090133760 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:25:50.463201 140357996426688 error_handling.py:96] outfeed marked as finished
I0812 21:25:50.463284 140357996426688 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:25:58.363343 140357996426688 estimator.py:368] Loss for final step: 0.16194399.
I0812 21:25:58.364098 140357996426688 error_handling.py:96] training_loop marked as finished
I0812 21:25:59.183056 140357996426688 estimator.py:1145] Calling model_fn.
E0812 21:25:59.896943 140357996426688 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:26:00.117846 140357996426688 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:26:00.142667 140357996426688 estimator.py:1147] Done calling model_fn.
I0812 21:26:00.159775 140357996426688 evaluation.py:255] Starting evaluation at 2019-08-12T21:26:00Z
I0812 21:26:00.160012 140357996426688 tpu_estimator.py:499] TPU job name worker
I0812 21:26:00.237219 140357996426688 monitored_session.py:240] Graph was finalized.
W0812 21:26:00.237972 140357996426688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:26:00.430090 140357996426688 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:26:03.066859 140357996426688 session_manager.py:500] Running local_init_op.
I0812 21:26:03.095459 140357996426688 session_manager.py:502] Done running local_init_op.
I0812 21:26:03.145385 140357996426688 tpu_estimator.py:557] Init TPU system
I0812 21:27:12.009742 140357996426688 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 21:27:12.010804 140357098526464 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:27:12.011281 140357090133760 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:27:12.077027 140357996426688 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:27:12.104964 140357996426688 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:27:12.105406 140357996426688 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:27:12.133919 140357081741056 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:27:12.220602 140357081741056 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:27:12.841418 140357090133760 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:27:13.344805 140357996426688 evaluation.py:167] Evaluation [10/10]
I0812 21:27:13.345146 140357996426688 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:27:13.345232 140357996426688 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:27:13.345465 140357098526464 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:27:13.345659 140357098526464 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:27:13.345874 140357996426688 error_handling.py:96] infeed marked as finished
I0812 21:27:13.345997 140357996426688 tpu_estimator.py:602] Stop output thread controller
I0812 21:27:13.346060 140357996426688 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:27:13.346395 140357090133760 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:27:13.346540 140357090133760 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:27:13.346776 140357996426688 error_handling.py:96] outfeed marked as finished
I0812 21:27:13.346898 140357996426688 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:27:42.315253 140357996426688 evaluation.py:275] Finished evaluation at 2019-08-12-21:27:42
I0812 21:27:42.315593 140357996426688 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9621, global_step = 30, loss = 0.14408338
I0812 21:27:46.595413 140357996426688 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:27:47.388276 140357996426688 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.14408338, 'global_step': 30, 'accuracy': 0.9621}

Removing gs://yangyou-mnist/log/#1565645067781463...
Removing gs://yangyou-mnist/log/checkpoint#1565645146971581...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565645067.v3-8-tpu#1565645150103495...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565645085343502...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565645072295309...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565645081038311...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565645080160939...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565645143897612...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565645144810278...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565645149147381...
Removing gs://yangyou-mnist/log/eval/#1565645263982042...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565645264.v3-8-tpu#1565645267081108...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:27:51.257955 140527250871744 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:27:51.258877 140527250871744 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:27:51.261509 140527250871744 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:27:51.262394 140527250871744 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:27:51.262984 140527250871744 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:27:51.263114 140527250871744 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:27:51.678622 140527250871744 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:27:51.686021 140527250871744 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:27:51.689994 140527250871744 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:27:51.732398 140527250871744 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:27:51.732695 140527250871744 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:27:51.851084 140527250871744 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:27:51.893659 140527250871744 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:27:51.893930 140527250871744 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:27:52.024415 140527250871744 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcee7080210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcee925d210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:27:52.024775 140527250871744 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:27:52.348200 140527250871744 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:27:52.351046: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:27:52.363830 140527250871744 tpu_system_metadata.py:148] Found TPU system:
I0812 21:27:52.364073 140527250871744 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:27:52.364541 140527250871744 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:27:52.364598 140527250871744 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:27:52.364649 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:27:52.364923 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:27:52.364979 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:27:52.365036 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:27:52.365084 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:27:52.365147 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:27:52.365195 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:27:52.365241 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:27:52.365287 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:27:52.365333 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:27:52.365380 140527250871744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:27:52.371467 140527250871744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:27:52.384063 140527250871744 estimator.py:1145] Calling model_fn.
W0812 21:27:52.384653 140527250871744 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:27:52.648313 140527250871744 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:27:53.258393 140527250871744 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:27:53.320040 140527250871744 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:27:53.325844 140527250871744 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:27:53.506201 140527250871744 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:27:53.520205 140527250871744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:27:53.535533 140527250871744 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:27:53.545536 140527250871744 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:27:53.551445 140527250871744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:27:53.973462 140527250871744 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:27:53.990114 140527250871744 estimator.py:1147] Done calling model_fn.
I0812 21:27:57.379102 140527250871744 tpu_estimator.py:499] TPU job name worker
I0812 21:27:57.497494 140527250871744 monitored_session.py:240] Graph was finalized.
I0812 21:27:58.067044 140527250871744 session_manager.py:500] Running local_init_op.
I0812 21:27:58.109458 140527250871744 session_manager.py:502] Done running local_init_op.
I0812 21:28:00.676825 140527250871744 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:28:15.297857 140527250871744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:28:15.415323 140527250871744 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:28:15.415760 140527250871744 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:28:15.416173: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:28:15.420624 140527250871744 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:28:15.423151 140527250871744 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:28:15.427464 140527250871744 tpu_estimator.py:557] Init TPU system
I0812 21:28:56.038887 140527250871744 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0812 21:28:56.039751 140526221256448 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:28:56.041207 140526212863744 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:28:56.088068 140527250871744 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:28:56.088949 140527250871744 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:28:56.101546 140526204471040 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:28:56.301793 140526204471040 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:29:00.601927 140526212863744 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:29:05.289230 140527250871744 basic_session_run_hooks.py:262] loss = 0.11662181, step = 30
I0812 21:29:05.291188 140527250871744 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:29:18.710469 140527250871744 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:29:18.710776 140527250871744 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:29:18.711083 140526221256448 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:29:18.711386 140526221256448 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:29:18.711580 140527250871744 error_handling.py:96] infeed marked as finished
I0812 21:29:18.711760 140527250871744 tpu_estimator.py:602] Stop output thread controller
I0812 21:29:18.711815 140527250871744 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:29:18.712064 140526212863744 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:29:18.712336 140526212863744 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:29:18.712524 140527250871744 error_handling.py:96] outfeed marked as finished
I0812 21:29:18.712687 140527250871744 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:29:26.446544 140527250871744 estimator.py:368] Loss for final step: 0.11662181.
I0812 21:29:26.447396 140527250871744 error_handling.py:96] training_loop marked as finished
I0812 21:29:27.363636 140527250871744 estimator.py:1145] Calling model_fn.
E0812 21:29:28.057607 140527250871744 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:29:28.295737 140527250871744 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:29:28.319392 140527250871744 estimator.py:1147] Done calling model_fn.
I0812 21:29:28.336545 140527250871744 evaluation.py:255] Starting evaluation at 2019-08-12T21:29:28Z
I0812 21:29:28.336813 140527250871744 tpu_estimator.py:499] TPU job name worker
I0812 21:29:28.416004 140527250871744 monitored_session.py:240] Graph was finalized.
W0812 21:29:28.416819 140527250871744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:29:28.607758 140527250871744 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:29:31.230706 140527250871744 session_manager.py:500] Running local_init_op.
I0812 21:29:31.259963 140527250871744 session_manager.py:502] Done running local_init_op.
I0812 21:29:31.316102 140527250871744 tpu_estimator.py:557] Init TPU system
I0812 21:30:40.039539 140527250871744 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 21:30:40.040409 140526218897152 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:30:40.040865 140526210504448 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:30:40.106033 140527250871744 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:30:40.129252 140527250871744 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:30:40.129630 140527250871744 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:30:40.165446 140526202111744 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:30:40.271819 140526202111744 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:30:40.876379 140526210504448 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:30:41.349746 140527250871744 evaluation.py:167] Evaluation [10/10]
I0812 21:30:41.350085 140527250871744 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:30:41.350188 140527250871744 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:30:41.350467 140526218897152 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:30:41.350763 140526218897152 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:30:41.350961 140527250871744 error_handling.py:96] infeed marked as finished
I0812 21:30:41.351121 140527250871744 tpu_estimator.py:602] Stop output thread controller
I0812 21:30:41.351175 140527250871744 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:30:41.351325 140526210504448 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:30:41.351480 140526210504448 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:30:41.351627 140527250871744 error_handling.py:96] outfeed marked as finished
I0812 21:30:41.351753 140527250871744 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:31:10.371380 140527250871744 evaluation.py:275] Finished evaluation at 2019-08-12-21:31:10
I0812 21:31:10.371817 140527250871744 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9698, global_step = 30, loss = 0.10260687
I0812 21:31:14.913031 140527250871744 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:31:15.772772 140527250871744 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10260687, 'global_step': 30, 'accuracy': 0.9698}

Removing gs://yangyou-mnist/log/#1565645275475729...
Removing gs://yangyou-mnist/log/checkpoint#1565645355164067...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565645294808330...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565645275.v3-8-tpu#1565645358408725...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565645352071320...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565645290484711...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565645280143861...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565645352966721...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565645289650493...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565645357268172...
Removing gs://yangyou-mnist/log/eval/#1565645471991665...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565645472.v3-8-tpu#1565645475469894...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:31:19.592675 139844336952768 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:31:19.593425 139844336952768 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:31:19.596471 139844336952768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:31:19.597330 139844336952768 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:31:19.597929 139844336952768 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:31:19.598074 139844336952768 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:31:20.008470 139844336952768 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:31:20.015356 139844336952768 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:31:20.019815 139844336952768 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:31:20.118954 139844336952768 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:31:20.119232 139844336952768 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:31:20.228202 139844336952768 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:31:20.321043 139844336952768 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:31:20.321310 139844336952768 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:31:20.472628 139844336952768 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2fe6309190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2fe84e6210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:31:20.472987 139844336952768 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:31:20.792675 139844336952768 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:31:20.795805: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:31:20.808836 139844336952768 tpu_system_metadata.py:148] Found TPU system:
I0812 21:31:20.809160 139844336952768 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:31:20.809664 139844336952768 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:31:20.809724 139844336952768 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:31:20.809776 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:31:20.810061 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:31:20.810118 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:31:20.810223 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:31:20.810283 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:31:20.810332 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:31:20.810394 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:31:20.810441 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:31:20.810487 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:31:20.810537 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:31:20.810584 139844336952768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:31:20.816490 139844336952768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:31:20.828933 139844336952768 estimator.py:1145] Calling model_fn.
W0812 21:31:20.829540 139844336952768 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:31:21.120712 139844336952768 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:31:21.682423 139844336952768 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:31:21.744163 139844336952768 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:31:21.750300 139844336952768 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:31:21.931612 139844336952768 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:31:21.945321 139844336952768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:31:21.960347 139844336952768 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:31:21.970452 139844336952768 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:31:21.976471 139844336952768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:31:22.404573 139844336952768 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:31:22.420463 139844336952768 estimator.py:1147] Done calling model_fn.
I0812 21:31:25.905308 139844336952768 tpu_estimator.py:499] TPU job name worker
I0812 21:31:26.020921 139844336952768 monitored_session.py:240] Graph was finalized.
I0812 21:31:26.607955 139844336952768 session_manager.py:500] Running local_init_op.
I0812 21:31:26.650675 139844336952768 session_manager.py:502] Done running local_init_op.
I0812 21:31:29.321074 139844336952768 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:31:41.536019 139844336952768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:31:41.662235 139844336952768 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:31:41.662698 139844336952768 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:31:41.663089: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:31:41.668639 139844336952768 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:31:41.671076 139844336952768 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:31:41.675420 139844336952768 tpu_estimator.py:557] Init TPU system
I0812 21:32:24.040842 139844336952768 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:32:24.041824 139843443087104 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:32:24.042593 139843434694400 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:32:24.089612 139844336952768 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:32:24.090488 139844336952768 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:32:24.146362 139843426301696 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:32:24.237643 139843426301696 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 21:32:28.657794 139843434694400 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:32:33.068679 139844336952768 basic_session_run_hooks.py:262] loss = 0.14148577, step = 30
I0812 21:32:33.071278 139844336952768 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
2019-08-12 21:32:54.241323: I tensorflow/core/platform/cloud/retrying_utils.cc:73] The operation failed and will be automatically retried in 0.339338 seconds (attempt 1 out of 10), caused by: Unavailable: Error executing an HTTP request: HTTP response code 500 with body '{
 "error": {
  "errors": [
   {
    "domain": "global",
    "reason": "backendError",
    "message": "Backend Error"
   }
  ],
  "code": 500,
  "message": "Backend Error"
 }
}
'
	 when uploading gs://yangyou-mnist/log/model.ckpt-30.meta.tmp161a41c26a0244cb8b347b2303087434
I0812 21:32:54.376565 139843426301696 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:32:54.445266 139843426301696 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
2019-08-12 21:32:54.605302: I tensorflow/core/platform/cloud/retrying_utils.cc:73] The operation failed and will be automatically retried in 0.461659 seconds (attempt 1 out of 10), caused by: Unavailable: Upload to gs://yangyou-mnist/log/model.ckpt-30.meta.tmp161a41c26a0244cb8b347b2303087434 failed, caused by: Not found: Error executing an HTTP request: HTTP response code 410 with body '{
 "error": {
  "errors": [
   {
    "domain": "global",
    "reason": "backendError",
    "message": "Backend Error"
   }
  ],
  "code": 500,
  "message": "Backend Error"
 }
}
'
	 when resuming upload gs://yangyou-mnist/log/model.ckpt-30.meta.tmp161a41c26a0244cb8b347b2303087434
I0812 21:32:57.712498 139844336952768 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:32:57.712820 139844336952768 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:32:57.713064 139843443087104 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:32:57.713174 139843443087104 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:32:57.713354 139844336952768 error_handling.py:96] infeed marked as finished
I0812 21:32:57.713464 139844336952768 tpu_estimator.py:602] Stop output thread controller
I0812 21:32:57.713530 139844336952768 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:32:57.713651 139843434694400 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:32:57.713730 139843434694400 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:32:57.713852 139844336952768 error_handling.py:96] outfeed marked as finished
I0812 21:32:57.713938 139844336952768 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:33:24.583801 139844336952768 estimator.py:368] Loss for final step: 0.14148577.
I0812 21:33:24.584681 139844336952768 error_handling.py:96] training_loop marked as finished
I0812 21:33:25.390718 139844336952768 estimator.py:1145] Calling model_fn.
E0812 21:33:26.094415 139844336952768 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:33:26.320839 139844336952768 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:33:26.343308 139844336952768 estimator.py:1147] Done calling model_fn.
I0812 21:33:26.361129 139844336952768 evaluation.py:255] Starting evaluation at 2019-08-12T21:33:26Z
I0812 21:33:26.361391 139844336952768 tpu_estimator.py:499] TPU job name worker
I0812 21:33:26.444850 139844336952768 monitored_session.py:240] Graph was finalized.
W0812 21:33:26.445652 139844336952768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:33:26.634047 139844336952768 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:33:29.258675 139844336952768 session_manager.py:500] Running local_init_op.
I0812 21:33:29.287750 139844336952768 session_manager.py:502] Done running local_init_op.
I0812 21:33:29.336786 139844336952768 tpu_estimator.py:557] Init TPU system
I0812 21:34:07.980173 139844336952768 tpu_estimator.py:566] Initialized TPU in 38 seconds
I0812 21:34:07.981194 139843439679232 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:34:07.981744 139843431286528 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:34:08.048064 139844336952768 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:34:08.073623 139844336952768 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:34:08.074002 139844336952768 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:34:08.155498 139843417384704 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:34:08.266185 139843417384704 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:34:08.871845 139843431286528 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:34:09.221569 139844336952768 evaluation.py:167] Evaluation [10/10]
I0812 21:34:09.221997 139844336952768 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:34:09.222090 139844336952768 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:34:09.222357 139843439679232 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:34:09.222506 139843439679232 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:34:09.222686 139844336952768 error_handling.py:96] infeed marked as finished
I0812 21:34:09.222791 139844336952768 tpu_estimator.py:602] Stop output thread controller
I0812 21:34:09.222841 139844336952768 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:34:09.222991 139843431286528 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:34:09.223071 139843431286528 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:34:09.223217 139844336952768 error_handling.py:96] outfeed marked as finished
I0812 21:34:09.223309 139844336952768 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:34:38.363089 139844336952768 evaluation.py:275] Finished evaluation at 2019-08-12-21:34:38
I0812 21:34:38.363440 139844336952768 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9659, global_step = 30, loss = 0.115798436
I0812 21:34:42.614639 139844336952768 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:34:43.440743 139844336952768 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.115798436, 'global_step': 30, 'accuracy': 0.9659}

Removing gs://yangyou-mnist/log/#1565645483878892...
Removing gs://yangyou-mnist/log/checkpoint#1565645562987567...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565645484.v3-8-tpu#1565645577377255...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565645488749582...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565645495788785...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565645496704957...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565645501052842...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565645559856105...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565645560720741...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565645576415721...
Removing gs://yangyou-mnist/log/eval/#1565645680001817...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565645680.v3-8-tpu#1565645683124790...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:34:47.308238 140406609515968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:34:47.309134 140406609515968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:34:47.311841 140406609515968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:34:47.312658 140406609515968 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:34:47.313258 140406609515968 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:34:47.313388 140406609515968 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:34:47.739749 140406609515968 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:34:47.747174 140406609515968 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:34:47.751234 140406609515968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:34:47.799705 140406609515968 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:34:47.800018 140406609515968 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:34:47.952949 140406609515968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:34:48.001441 140406609515968 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:34:48.001743 140406609515968 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:34:48.119115 140406609515968 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb2d03f0150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb2d25cd210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:34:48.119457 140406609515968 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:34:48.449129 140406609515968 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:34:48.452166: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:34:48.465415 140406609515968 tpu_system_metadata.py:148] Found TPU system:
I0812 21:34:48.465653 140406609515968 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:34:48.466339 140406609515968 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:34:48.466415 140406609515968 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:34:48.466469 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:34:48.466797 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:34:48.466852 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:34:48.466911 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:34:48.466960 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:34:48.467010 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:34:48.467073 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:34:48.467123 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:34:48.467170 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:34:48.467217 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:34:48.467272 140406609515968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:34:48.473360 140406609515968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:34:48.485904 140406609515968 estimator.py:1145] Calling model_fn.
W0812 21:34:48.486552 140406609515968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:34:48.762607 140406609515968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:34:49.334173 140406609515968 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:34:49.399763 140406609515968 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:34:49.405675 140406609515968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:34:49.594729 140406609515968 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:34:49.609127 140406609515968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:34:49.625335 140406609515968 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:34:49.636152 140406609515968 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:34:49.642406 140406609515968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:34:50.080554 140406609515968 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:34:50.097280 140406609515968 estimator.py:1147] Done calling model_fn.
I0812 21:34:53.457030 140406609515968 tpu_estimator.py:499] TPU job name worker
I0812 21:34:53.574476 140406609515968 monitored_session.py:240] Graph was finalized.
I0812 21:34:54.126215 140406609515968 session_manager.py:500] Running local_init_op.
I0812 21:34:54.158349 140406609515968 session_manager.py:502] Done running local_init_op.
I0812 21:34:56.907628 140406609515968 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:35:09.226634 140406609515968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:35:09.340562 140406609515968 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:35:09.341008 140406609515968 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:35:09.341480: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:35:09.346411 140406609515968 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:35:09.348642 140406609515968 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:35:09.352648 140406609515968 tpu_estimator.py:557] Init TPU system
I0812 21:35:52.067404 140406609515968 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:35:52.068679 140405433693952 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:35:52.069642 140405425301248 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:35:52.116312 140406609515968 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:35:52.118117 140406609515968 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:35:52.129697 140405416908544 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:35:52.233360 140405416908544 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:35:56.714499 140405425301248 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:36:01.235960 140406609515968 basic_session_run_hooks.py:262] loss = 0.088640645, step = 30
I0812 21:36:01.238934 140406609515968 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:36:14.726104 140406609515968 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:36:14.726443 140406609515968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:36:14.726716 140405433693952 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:36:14.726989 140405433693952 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:36:14.727194 140406609515968 error_handling.py:96] infeed marked as finished
I0812 21:36:14.727371 140406609515968 tpu_estimator.py:602] Stop output thread controller
I0812 21:36:14.727425 140406609515968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:36:14.727603 140405425301248 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:36:14.727786 140405425301248 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:36:14.727952 140406609515968 error_handling.py:96] outfeed marked as finished
I0812 21:36:14.728096 140406609515968 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:36:22.342910 140406609515968 estimator.py:368] Loss for final step: 0.088640645.
I0812 21:36:22.343693 140406609515968 error_handling.py:96] training_loop marked as finished
I0812 21:36:23.045794 140406609515968 estimator.py:1145] Calling model_fn.
E0812 21:36:23.739583 140406609515968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:36:23.964195 140406609515968 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:36:23.987225 140406609515968 estimator.py:1147] Done calling model_fn.
I0812 21:36:24.004405 140406609515968 evaluation.py:255] Starting evaluation at 2019-08-12T21:36:24Z
I0812 21:36:24.004648 140406609515968 tpu_estimator.py:499] TPU job name worker
I0812 21:36:24.086575 140406609515968 monitored_session.py:240] Graph was finalized.
W0812 21:36:24.087311 140406609515968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:36:24.285895 140406609515968 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:36:26.857729 140406609515968 session_manager.py:500] Running local_init_op.
I0812 21:36:26.888114 140406609515968 session_manager.py:502] Done running local_init_op.
I0812 21:36:26.937319 140406609515968 tpu_estimator.py:557] Init TPU system
I0812 21:37:36.014507 140406609515968 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 21:37:36.015559 140405425301248 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:37:36.015928 140405416908544 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:37:36.079504 140406609515968 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:37:36.102930 140406609515968 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:37:36.103321 140406609515968 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:37:36.136104 140405408515840 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:37:36.252392 140405408515840 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:37:36.913927 140405416908544 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:37:37.185801 140406609515968 evaluation.py:167] Evaluation [10/10]
I0812 21:37:37.186116 140406609515968 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:37:37.186218 140406609515968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:37:37.186388 140405425301248 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:37:37.186474 140405425301248 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:37:37.186619 140406609515968 error_handling.py:96] infeed marked as finished
I0812 21:37:37.186731 140406609515968 tpu_estimator.py:602] Stop output thread controller
I0812 21:37:37.186780 140406609515968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:37:37.186892 140405416908544 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:37:37.186960 140405416908544 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:37:37.187108 140406609515968 error_handling.py:96] outfeed marked as finished
I0812 21:37:37.187196 140406609515968 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:38:06.349325 140406609515968 evaluation.py:275] Finished evaluation at 2019-08-12-21:38:06
I0812 21:38:06.349644 140406609515968 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9762, global_step = 30, loss = 0.071168914
I0812 21:38:10.791019 140406609515968 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:38:11.589075 140406609515968 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.071168914, 'global_step': 30, 'accuracy': 0.9762}

Removing gs://yangyou-mnist/log/#1565645691581467...
Removing gs://yangyou-mnist/log/checkpoint#1565645771221649...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565645691.v3-8-tpu#1565645774425785...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565645696372114...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565645704177097...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565645703323834...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565645708743858...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565645768049792...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565645769015453...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565645773463842...
Removing gs://yangyou-mnist/log/eval/#1565645888012483...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565645888.v3-8-tpu#1565645891287072...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:38:15.664381 140133979092416 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:38:15.665206 140133979092416 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:38:15.668137 140133979092416 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:38:15.669037 140133979092416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:38:15.669681 140133979092416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:38:15.669843 140133979092416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:38:16.117285 140133979092416 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:38:16.124974 140133979092416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:38:16.128959 140133979092416 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:38:16.176564 140133979092416 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:38:16.176999 140133979092416 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:38:16.300436 140133979092416 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:38:16.349030 140133979092416 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:38:16.349311 140133979092416 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:38:16.449965 140133979092416 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f735634e110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f735852b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:38:16.450362 140133979092416 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:38:16.786683 140133979092416 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:38:16.789592: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:38:16.803770 140133979092416 tpu_system_metadata.py:148] Found TPU system:
I0812 21:38:16.804012 140133979092416 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:38:16.804574 140133979092416 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:38:16.804641 140133979092416 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:38:16.804701 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:38:16.805027 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:38:16.805084 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:38:16.805135 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:38:16.805181 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:38:16.805228 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:38:16.805275 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:38:16.805321 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:38:16.805368 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:38:16.805414 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:38:16.805461 140133979092416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:38:16.811810 140133979092416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:38:16.824563 140133979092416 estimator.py:1145] Calling model_fn.
W0812 21:38:16.825167 140133979092416 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:38:17.095442 140133979092416 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:38:17.762584 140133979092416 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:38:17.824739 140133979092416 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:38:17.830822 140133979092416 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:38:18.008197 140133979092416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:38:18.021828 140133979092416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:38:18.036637 140133979092416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:38:18.046860 140133979092416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:38:18.052757 140133979092416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:38:18.469070 140133979092416 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:38:18.484878 140133979092416 estimator.py:1147] Done calling model_fn.
I0812 21:38:21.875967 140133979092416 tpu_estimator.py:499] TPU job name worker
I0812 21:38:21.992405 140133979092416 monitored_session.py:240] Graph was finalized.
I0812 21:38:22.563685 140133979092416 session_manager.py:500] Running local_init_op.
I0812 21:38:22.596117 140133979092416 session_manager.py:502] Done running local_init_op.
I0812 21:38:25.121280 140133979092416 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:38:37.355925 140133979092416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:38:37.477448 140133979092416 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:38:37.477888 140133979092416 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:38:37.478311: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:38:37.482970 140133979092416 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:38:37.485321 140133979092416 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:38:37.489228 140133979092416 tpu_estimator.py:557] Init TPU system
I0812 21:39:20.071504 140133979092416 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:39:20.072611 140133085206272 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:39:20.073561 140133076813568 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:39:20.120536 140133979092416 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:39:20.121442 140133979092416 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:39:20.136514 140133068420864 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:39:20.242269 140133068420864 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 21:39:24.942416 140133076813568 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:39:29.620280 140133979092416 basic_session_run_hooks.py:262] loss = 0.07440907, step = 30
I0812 21:39:29.623219 140133979092416 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:39:43.650134 140133979092416 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:39:43.650485 140133979092416 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:39:43.651884 140133085206272 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:39:43.652158 140133085206272 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:39:43.652388 140133979092416 error_handling.py:96] infeed marked as finished
I0812 21:39:43.652626 140133979092416 tpu_estimator.py:602] Stop output thread controller
I0812 21:39:43.652690 140133979092416 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:39:43.652854 140133076813568 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:39:43.653095 140133076813568 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:39:43.653295 140133979092416 error_handling.py:96] outfeed marked as finished
I0812 21:39:43.653470 140133979092416 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:39:50.377120 140133979092416 estimator.py:368] Loss for final step: 0.07440907.
I0812 21:39:50.377880 140133979092416 error_handling.py:96] training_loop marked as finished
I0812 21:39:51.059324 140133979092416 estimator.py:1145] Calling model_fn.
E0812 21:39:51.754106 140133979092416 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:39:51.972692 140133979092416 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:39:51.996397 140133979092416 estimator.py:1147] Done calling model_fn.
I0812 21:39:52.013051 140133979092416 evaluation.py:255] Starting evaluation at 2019-08-12T21:39:52Z
I0812 21:39:52.013293 140133979092416 tpu_estimator.py:499] TPU job name worker
I0812 21:39:52.089997 140133979092416 monitored_session.py:240] Graph was finalized.
W0812 21:39:52.090811 140133979092416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:39:52.284651 140133979092416 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:39:54.792176 140133979092416 session_manager.py:500] Running local_init_op.
I0812 21:39:54.821444 140133979092416 session_manager.py:502] Done running local_init_op.
I0812 21:39:54.877094 140133979092416 tpu_estimator.py:557] Init TPU system
I0812 21:41:03.907073 140133979092416 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0812 21:41:03.908041 140133073143552 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:41:03.908468 140133059766016 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:41:03.973015 140133979092416 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:41:03.997117 140133979092416 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:41:03.997450 140133979092416 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:41:04.030983 140133051373312 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:41:04.255273 140133051373312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:41:04.842991 140133059766016 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:41:05.160330 140133979092416 evaluation.py:167] Evaluation [10/10]
I0812 21:41:05.160739 140133979092416 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:41:05.160820 140133979092416 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:41:05.160981 140133073143552 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:41:05.161160 140133073143552 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:41:05.161308 140133979092416 error_handling.py:96] infeed marked as finished
I0812 21:41:05.161396 140133979092416 tpu_estimator.py:602] Stop output thread controller
I0812 21:41:05.161452 140133979092416 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:41:05.161567 140133059766016 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:41:05.161654 140133059766016 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:41:05.161770 140133979092416 error_handling.py:96] outfeed marked as finished
I0812 21:41:05.161849 140133979092416 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:41:34.329755 140133979092416 evaluation.py:275] Finished evaluation at 2019-08-12-21:41:34
I0812 21:41:34.330221 140133979092416 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9812, global_step = 30, loss = 0.04921477
I0812 21:41:38.675307 140133979092416 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:41:39.520442 140133979092416 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.04921477, 'global_step': 30, 'accuracy': 0.9812}

Removing gs://yangyou-mnist/log/#1565645899968694...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565645912372965...
Removing gs://yangyou-mnist/log/checkpoint#1565645980006323...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565645900.v3-8-tpu#1565645983353351...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565645916870774...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565645976856189...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565645904588092...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565645977759988...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565645911452648...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565645982421009...
Removing gs://yangyou-mnist/log/eval/#1565646095959570...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565646096.v3-8-tpu#1565646099212058...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:41:43.383753 140283066725824 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:41:43.384509 140283066725824 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:41:43.387140 140283066725824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:41:43.387936 140283066725824 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:41:43.388497 140283066725824 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:41:43.388623 140283066725824 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:41:43.809159 140283066725824 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:41:43.818236 140283066725824 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:41:43.822534 140283066725824 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:41:43.914346 140283066725824 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:41:43.914644 140283066725824 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:41:44.030370 140283066725824 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:41:44.125073 140283066725824 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:41:44.125354 140283066725824 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:41:44.364706 140283066725824 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f960c85a050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f960ea37210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:41:44.365044 140283066725824 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:41:44.687861 140283066725824 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:41:44.690720: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:41:44.702368 140283066725824 tpu_system_metadata.py:148] Found TPU system:
I0812 21:41:44.702708 140283066725824 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:41:44.703242 140283066725824 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:41:44.703299 140283066725824 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:41:44.703351 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:41:44.703654 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:41:44.703722 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:41:44.703773 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:41:44.703820 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:41:44.703867 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:41:44.703915 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:41:44.703960 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:41:44.704008 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:41:44.704054 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:41:44.704101 140283066725824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:41:44.710295 140283066725824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:41:44.722985 140283066725824 estimator.py:1145] Calling model_fn.
W0812 21:41:44.723614 140283066725824 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:41:44.997955 140283066725824 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:41:45.601301 140283066725824 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:41:45.661927 140283066725824 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:41:45.667710 140283066725824 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:41:45.844885 140283066725824 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:41:45.858700 140283066725824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:41:45.873789 140283066725824 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:41:45.883816 140283066725824 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:41:45.889818 140283066725824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:41:46.310959 140283066725824 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:41:46.326368 140283066725824 estimator.py:1147] Done calling model_fn.
I0812 21:41:49.667676 140283066725824 tpu_estimator.py:499] TPU job name worker
I0812 21:41:49.782211 140283066725824 monitored_session.py:240] Graph was finalized.
I0812 21:41:50.334590 140283066725824 session_manager.py:500] Running local_init_op.
I0812 21:41:50.365407 140283066725824 session_manager.py:502] Done running local_init_op.
I0812 21:41:52.903394 140283066725824 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:42:05.592092 140283066725824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:42:05.696815 140283066725824 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:42:05.697320 140283066725824 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:42:05.697698: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:42:05.701971 140283066725824 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:42:05.704427 140283066725824 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:42:05.708791 140283066725824 tpu_estimator.py:557] Init TPU system
I0812 21:42:48.061630 140283066725824 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0812 21:42:48.062505 140282298603264 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:42:48.063000 140281819166464 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:42:48.110951 140283066725824 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:42:48.111820 140283066725824 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:42:48.167198 140281810773760 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:42:48.343069 140281810773760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:42:52.649238 140281819166464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:42:56.962402 140283066725824 basic_session_run_hooks.py:262] loss = 0.3135899, step = 30
I0812 21:42:56.964799 140283066725824 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:43:10.607570 140283066725824 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:43:10.607868 140283066725824 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:43:10.608076 140282298603264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:43:10.608179 140282298603264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:43:10.608329 140283066725824 error_handling.py:96] infeed marked as finished
I0812 21:43:10.608422 140283066725824 tpu_estimator.py:602] Stop output thread controller
I0812 21:43:10.608469 140283066725824 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:43:10.608602 140281819166464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:43:10.608676 140281819166464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:43:10.608792 140283066725824 error_handling.py:96] outfeed marked as finished
I0812 21:43:10.608865 140283066725824 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:43:18.479765 140283066725824 estimator.py:368] Loss for final step: 0.3135899.
I0812 21:43:18.480725 140283066725824 error_handling.py:96] training_loop marked as finished
I0812 21:43:19.261996 140283066725824 estimator.py:1145] Calling model_fn.
E0812 21:43:19.963959 140283066725824 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:43:20.191931 140283066725824 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:43:20.215656 140283066725824 estimator.py:1147] Done calling model_fn.
I0812 21:43:20.233000 140283066725824 evaluation.py:255] Starting evaluation at 2019-08-12T21:43:20Z
I0812 21:43:20.233253 140283066725824 tpu_estimator.py:499] TPU job name worker
I0812 21:43:20.315196 140283066725824 monitored_session.py:240] Graph was finalized.
W0812 21:43:20.316028 140283066725824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:43:20.511686 140283066725824 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:43:23.196046 140283066725824 session_manager.py:500] Running local_init_op.
I0812 21:43:23.226198 140283066725824 session_manager.py:502] Done running local_init_op.
I0812 21:43:23.275414 140283066725824 tpu_estimator.py:557] Init TPU system
I0812 21:44:32.031480 140283066725824 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 21:44:32.032505 140282298603264 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:44:32.033036 140281819166464 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:44:32.098490 140283066725824 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:44:32.124070 140283066725824 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:44:32.124452 140283066725824 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:44:32.211016 140281810773760 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:44:32.464097 140281810773760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:44:32.910407 140281819166464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:44:33.228507 140283066725824 evaluation.py:167] Evaluation [10/10]
I0812 21:44:33.228948 140283066725824 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:44:33.229047 140283066725824 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:44:33.229350 140282298603264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:44:33.229491 140282298603264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:44:33.229685 140283066725824 error_handling.py:96] infeed marked as finished
I0812 21:44:33.229796 140283066725824 tpu_estimator.py:602] Stop output thread controller
I0812 21:44:33.229851 140283066725824 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:44:33.230020 140281819166464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:44:33.230107 140281819166464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:44:33.230292 140283066725824 error_handling.py:96] outfeed marked as finished
I0812 21:44:33.230421 140283066725824 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:45:02.554429 140283066725824 evaluation.py:275] Finished evaluation at 2019-08-12-21:45:02
I0812 21:45:02.554816 140283066725824 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9289, global_step = 30, loss = 0.23604187
I0812 21:45:06.784282 140283066725824 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:45:07.580054 140283066725824 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.23604187, 'global_step': 30, 'accuracy': 0.9289}

Removing gs://yangyou-mnist/log/#1565646107781682...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565646119874798...
Removing gs://yangyou-mnist/log/checkpoint#1565646187099942...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565646125108215...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565646183981741...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565646112366107...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565646119043362...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565646184822467...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565646107.v3-8-tpu#1565646190294732...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565646189281244...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565646304179171...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565646304.v3-8-tpu#1565646307274268...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:45:11.562891 139884840838592 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:45:11.563713 139884840838592 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:45:11.567003 139884840838592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:45:11.567857 139884840838592 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:45:11.568478 139884840838592 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:45:11.568608 139884840838592 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:45:11.989245 139884840838592 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:45:11.998287 139884840838592 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:45:12.002703 139884840838592 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:45:12.111952 139884840838592 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:45:12.112226 139884840838592 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:45:12.352113 139884840838592 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:45:12.397953 139884840838592 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:45:12.398250 139884840838592 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:45:12.495028 139884840838592 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f395468d090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f395686a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:45:12.495378 139884840838592 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:45:12.820506 139884840838592 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:45:12.823672: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:45:12.836611 139884840838592 tpu_system_metadata.py:148] Found TPU system:
I0812 21:45:12.836864 139884840838592 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:45:12.837397 139884840838592 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:45:12.837455 139884840838592 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:45:12.837508 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:45:12.837929 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:45:12.837986 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:45:12.838038 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:45:12.838104 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:45:12.838184 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:45:12.838248 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:45:12.838298 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:45:12.838346 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:45:12.838392 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:45:12.838439 139884840838592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:45:12.844459 139884840838592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:45:12.856880 139884840838592 estimator.py:1145] Calling model_fn.
W0812 21:45:12.857497 139884840838592 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:45:13.170905 139884840838592 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:45:13.846131 139884840838592 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:45:13.908072 139884840838592 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:45:13.913950 139884840838592 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:45:14.103359 139884840838592 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:45:14.120946 139884840838592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:45:14.136389 139884840838592 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:45:14.146482 139884840838592 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:45:14.152499 139884840838592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:45:14.589420 139884840838592 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:45:14.605283 139884840838592 estimator.py:1147] Done calling model_fn.
I0812 21:45:17.922210 139884840838592 tpu_estimator.py:499] TPU job name worker
I0812 21:45:18.036273 139884840838592 monitored_session.py:240] Graph was finalized.
I0812 21:45:18.616341 139884840838592 session_manager.py:500] Running local_init_op.
I0812 21:45:18.653255 139884840838592 session_manager.py:502] Done running local_init_op.
I0812 21:45:22.038976 139884840838592 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:45:34.095083 139884840838592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:45:34.200639 139884840838592 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:45:34.201128 139884840838592 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:45:34.201530: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:45:34.206686 139884840838592 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:45:34.209043 139884840838592 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:45:34.213633 139884840838592 tpu_estimator.py:557] Init TPU system
I0812 21:46:16.078644 139884840838592 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0812 21:46:16.079487 139884148426496 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:46:16.079945 139883662276352 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:46:16.126722 139884840838592 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:46:16.127712 139884840838592 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:46:16.137363 139883653883648 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:46:16.244174 139883653883648 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0812 21:46:20.724481 139883662276352 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:46:25.606678 139884840838592 basic_session_run_hooks.py:262] loss = 0.24904226, step = 30
I0812 21:46:25.609288 139884840838592 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:46:39.582820 139884840838592 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:46:39.583170 139884840838592 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:46:39.584827 139884148426496 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:46:39.585123 139884148426496 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:46:39.585330 139884840838592 error_handling.py:96] infeed marked as finished
I0812 21:46:39.585560 139884840838592 tpu_estimator.py:602] Stop output thread controller
I0812 21:46:39.585621 139884840838592 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:46:39.585834 139883662276352 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:46:39.586004 139883662276352 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:46:39.586261 139884840838592 error_handling.py:96] outfeed marked as finished
I0812 21:46:39.586406 139884840838592 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:46:46.357419 139884840838592 estimator.py:368] Loss for final step: 0.24904226.
I0812 21:46:46.358479 139884840838592 error_handling.py:96] training_loop marked as finished
I0812 21:46:47.160690 139884840838592 estimator.py:1145] Calling model_fn.
E0812 21:46:47.869090 139884840838592 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:46:48.098808 139884840838592 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:46:48.122034 139884840838592 estimator.py:1147] Done calling model_fn.
I0812 21:46:48.138545 139884840838592 evaluation.py:255] Starting evaluation at 2019-08-12T21:46:48Z
I0812 21:46:48.138767 139884840838592 tpu_estimator.py:499] TPU job name worker
I0812 21:46:48.216404 139884840838592 monitored_session.py:240] Graph was finalized.
W0812 21:46:48.217134 139884840838592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:46:48.418756 139884840838592 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:46:51.042346 139884840838592 session_manager.py:500] Running local_init_op.
I0812 21:46:51.067265 139884840838592 session_manager.py:502] Done running local_init_op.
I0812 21:46:51.113800 139884840838592 tpu_estimator.py:557] Init TPU system
I0812 21:47:59.993793 139884840838592 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 21:47:59.994752 139883653883648 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:47:59.995208 139883645490944 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:48:00.060590 139884840838592 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:48:00.084016 139884840838592 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:48:00.084400 139884840838592 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:48:00.123249 139883637098240 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:48:00.244780 139883637098240 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:48:00.842056 139883645490944 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:48:01.320492 139884840838592 evaluation.py:167] Evaluation [10/10]
I0812 21:48:01.320800 139884840838592 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:48:01.320879 139884840838592 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:48:01.321073 139883653883648 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:48:01.321170 139883653883648 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:48:01.321310 139884840838592 error_handling.py:96] infeed marked as finished
I0812 21:48:01.321408 139884840838592 tpu_estimator.py:602] Stop output thread controller
I0812 21:48:01.321464 139884840838592 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:48:01.321573 139883645490944 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:48:01.321737 139883645490944 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:48:01.321861 139884840838592 error_handling.py:96] outfeed marked as finished
I0812 21:48:01.321940 139884840838592 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:48:30.339440 139884840838592 evaluation.py:275] Finished evaluation at 2019-08-12-21:48:30
I0812 21:48:30.339754 139884840838592 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9416, global_step = 30, loss = 0.2175211
I0812 21:48:34.726747 139884840838592 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:48:35.611828 139884840838592 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.2175211, 'global_step': 30, 'accuracy': 0.9416}

Removing gs://yangyou-mnist/log/#1565646316161471...
Removing gs://yangyou-mnist/log/checkpoint#1565646395601371...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565646321499751...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565646316.v3-8-tpu#1565646399276456...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565646328346849...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565646329171918...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565646333578311...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565646392511754...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565646393380158...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565646397974916...
Removing gs://yangyou-mnist/log/eval/#1565646512022487...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565646512.v3-8-tpu#1565646515226501...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0812 21:48:39.478782 140193710704064 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0812 21:48:39.479571 140193710704064 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0812 21:48:39.482204 140193710704064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/adam/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0812 21:48:39.483053 140193710704064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:397: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0812 21:48:39.483659 140193710704064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0812 21:48:39.483787 140193710704064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:339: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0812 21:48:39.901566 140193710704064 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0812 21:48:39.909630 140193710704064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:358: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0812 21:48:39.914319 140193710704064 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:48:39.964775 140193710704064 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:48:39.965078 140193710704064 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:48:40.103693 140193710704064 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0812 21:48:40.151202 140193710704064 discovery.py:865] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0812 21:48:40.151465 140193710704064 transport.py:157] Attempting refresh to obtain initial access_token
I0812 21:48:40.243561 140193710704064 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f813e7cf150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f81409ac1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0812 21:48:40.243906 140193710704064 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0812 21:48:40.583183 140193710704064 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-12 21:48:40.585906: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:48:40.598705 140193710704064 tpu_system_metadata.py:148] Found TPU system:
I0812 21:48:40.598937 140193710704064 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0812 21:48:40.599414 140193710704064 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0812 21:48:40.599471 140193710704064 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0812 21:48:40.599530 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 7410105800881996051)
I0812 21:48:40.599808 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 13934708344244319317)
I0812 21:48:40.599865 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 4837918736922761809)
I0812 21:48:40.599916 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 2191654747481568116)
I0812 21:48:40.599965 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 7346189397158184854)
I0812 21:48:40.600028 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14647094821567373690)
I0812 21:48:40.600076 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 13231528318228405306)
I0812 21:48:40.600123 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 12531375807099359819)
I0812 21:48:40.600168 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 6012630311374469525)
I0812 21:48:40.600215 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 14976858665042847325)
I0812 21:48:40.600263 140193710704064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 8908022338835119338)
W0812 21:48:40.606380 140193710704064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0812 21:48:40.618845 140193710704064 estimator.py:1145] Calling model_fn.
W0812 21:48:40.619522 140193710704064 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0812 21:48:40.901617 140193710704064 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0812 21:48:41.459901 140193710704064 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0812 21:48:41.520279 140193710704064 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0812 21:48:41.526092 140193710704064 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:48:41.700570 140193710704064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0812 21:48:41.713841 140193710704064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0812 21:48:41.728256 140193710704064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:286: The name tf.train.get_global_step is deprecated. Please use tf.compat.v1.train.get_global_step instead.

W0812 21:48:41.738322 140193710704064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:287: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0812 21:48:41.743973 140193710704064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
I0812 21:48:42.160974 140193710704064 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0812 21:48:42.176227 140193710704064 estimator.py:1147] Done calling model_fn.
I0812 21:48:45.631623 140193710704064 tpu_estimator.py:499] TPU job name worker
I0812 21:48:45.746725 140193710704064 monitored_session.py:240] Graph was finalized.
I0812 21:48:46.356363 140193710704064 session_manager.py:500] Running local_init_op.
I0812 21:48:46.398047 140193710704064 session_manager.py:502] Done running local_init_op.
I0812 21:48:49.006119 140193710704064 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0812 21:49:00.750905 140193710704064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0812 21:49:00.877221 140193710704064 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:49:00.877628 140193710704064 session_support.py:332] Installing graceful shutdown hook.
2019-08-12 21:49:00.878239: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0812 21:49:00.883342 140193710704064 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0812 21:49:00.885700 140193710704064 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0812 21:49:00.890739 140193710704064 tpu_estimator.py:557] Init TPU system
I0812 21:49:44.054290 140193710704064 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0812 21:49:44.055337 140192807634688 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:49:44.056279 140192799241984 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:49:44.106374 140193710704064 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0812 21:49:44.107330 140193710704064 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0812 21:49:44.121073 140192790849280 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:49:44.245414 140192790849280 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:49:48.683172 140192799241984 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:49:53.335249 140193710704064 basic_session_run_hooks.py:262] loss = 2.30092, step = 30
I0812 21:49:53.337899 140193710704064 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0812 21:50:07.055689 140193710704064 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:50:07.056016 140193710704064 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:50:07.056345 140192807634688 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:50:07.056653 140192807634688 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:50:07.056922 140193710704064 error_handling.py:96] infeed marked as finished
I0812 21:50:07.057109 140193710704064 tpu_estimator.py:602] Stop output thread controller
I0812 21:50:07.057168 140193710704064 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:50:07.057326 140192799241984 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:50:07.057488 140192799241984 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:50:07.057662 140193710704064 error_handling.py:96] outfeed marked as finished
I0812 21:50:07.057800 140193710704064 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:50:14.386698 140193710704064 estimator.py:368] Loss for final step: 2.30092.
I0812 21:50:14.387690 140193710704064 error_handling.py:96] training_loop marked as finished
I0812 21:50:15.186032 140193710704064 estimator.py:1145] Calling model_fn.
E0812 21:50:15.879158 140193710704064 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0812 21:50:16.109348 140193710704064 deprecation_wrapper.py:119] From mnist_tpu_warm.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0812 21:50:16.132463 140193710704064 estimator.py:1147] Done calling model_fn.
I0812 21:50:16.148818 140193710704064 evaluation.py:255] Starting evaluation at 2019-08-12T21:50:16Z
I0812 21:50:16.149043 140193710704064 tpu_estimator.py:499] TPU job name worker
I0812 21:50:16.227670 140193710704064 monitored_session.py:240] Graph was finalized.
W0812 21:50:16.228460 140193710704064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0812 21:50:16.425368 140193710704064 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0812 21:50:18.997795 140193710704064 session_manager.py:500] Running local_init_op.
I0812 21:50:19.023773 140193710704064 session_manager.py:502] Done running local_init_op.
I0812 21:50:19.076339 140193710704064 tpu_estimator.py:557] Init TPU system
I0812 21:51:28.015614 140193710704064 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0812 21:51:28.016925 140192804488960 tpu_estimator.py:514] Starting infeed thread controller.
I0812 21:51:28.017642 140192796096256 tpu_estimator.py:533] Starting outfeed thread controller.
I0812 21:51:28.089320 140193710704064 util.py:98] Initialized dataset iterators in 0 seconds
I0812 21:51:28.114034 140193710704064 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0812 21:51:28.114489 140193710704064 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0812 21:51:28.148039 140192787703552 transport.py:157] Attempting refresh to obtain initial access_token
W0812 21:51:28.297301 140192787703552 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0812 21:51:28.931175 140192796096256 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0812 21:51:29.264738 140193710704064 evaluation.py:167] Evaluation [10/10]
I0812 21:51:29.265252 140193710704064 tpu_estimator.py:598] Stop infeed thread controller
I0812 21:51:29.265399 140193710704064 tpu_estimator.py:430] Shutting down InfeedController thread.
I0812 21:51:29.265635 140192804488960 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0812 21:51:29.265901 140192804488960 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0812 21:51:29.266258 140193710704064 error_handling.py:96] infeed marked as finished
I0812 21:51:29.266449 140193710704064 tpu_estimator.py:602] Stop output thread controller
I0812 21:51:29.266530 140193710704064 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0812 21:51:29.266726 140192796096256 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0812 21:51:29.266896 140192796096256 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0812 21:51:29.267064 140193710704064 error_handling.py:96] outfeed marked as finished
I0812 21:51:29.267200 140193710704064 tpu_estimator.py:606] Shutdown TPU system.
I0812 21:51:58.393853 140193710704064 evaluation.py:275] Finished evaluation at 2019-08-12-21:51:58
I0812 21:51:58.394213 140193710704064 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 2.2994092
I0812 21:52:02.785007 140193710704064 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0812 21:52:03.604429 140193710704064 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.2994092, 'global_step': 30, 'accuracy': 0.1135}

