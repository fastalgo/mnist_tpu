Removing gs://yangyou-mnist/log/#1565747431497859...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565747431.v3-8-tpu#1565747433046929...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565747436176301...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565747444599666...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565747443746059...
/ [1/5 objects]  20% Done                                                       / [2/5 objects]  40% Done                                                       / [3/5 objects]  60% Done                                                       / [4/5 objects]  80% Done                                                       / [5/5 objects] 100% Done                                                       
Operation completed over 5 objects.                                              
WARNING: Logging before flag parsing goes to stderr.
W0814 16:21:16.328510 140211081029056 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:21:16.330463 140211081029056 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:21:16.342953 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:21:16.343923 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:21:16.344624 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:21:16.344773 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:21:18.333892 140211081029056 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:21:18.344458 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:21:18.353378 140211081029056 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:21:18.417675 140211081029056 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:21:18.417979 140211081029056 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:21:18.669539 140211081029056 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:21:18.731004 140211081029056 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:21:18.731329 140211081029056 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:21:18.916857 140211081029056 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8549d70110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f854bf4f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:21:18.917301 140211081029056 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:21:19.288325 140211081029056 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:21:19.308071: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:21:19.321408 140211081029056 tpu_system_metadata.py:148] Found TPU system:
I0814 16:21:19.321713 140211081029056 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:21:19.322419 140211081029056 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:21:19.322485 140211081029056 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:21:19.322540 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:21:19.322851 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:21:19.322911 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:21:19.322961 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:21:19.323009 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:21:19.323056 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:21:19.323103 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:21:19.323149 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:21:19.323195 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:21:19.323241 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:21:19.323288 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:21:19.339828 140211081029056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:21:19.354680 140211081029056 estimator.py:1145] Calling model_fn.
W0814 16:21:19.355335 140211081029056 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:21:19.641606 140211081029056 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:21:20.274996 140211081029056 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:21:20.341911 140211081029056 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:21:20.348236 140211081029056 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:21:20.573867 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:21:20.591885 140211081029056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:21:20.604278 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:21:20.605405 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:21:20.612384 140211081029056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:21:20.617819 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:21:20.618037 140211081029056 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:21:20.630409 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:21:20.738734 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:21:20.780198 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:20.823405 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:20.874546 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.050498 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.100583 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.148684 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.203104 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.252923 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.295394 140211081029056 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:21:21.312391 140211081029056 estimator.py:1147] Done calling model_fn.
I0814 16:21:26.230050 140211081029056 tpu_estimator.py:499] TPU job name worker
I0814 16:21:26.354476 140211081029056 monitored_session.py:240] Graph was finalized.
I0814 16:21:27.047481 140211081029056 session_manager.py:500] Running local_init_op.
I0814 16:21:27.093094 140211081029056 session_manager.py:502] Done running local_init_op.
I0814 16:21:29.956681 140211081029056 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:21:42.272557 140211081029056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:21:42.408632 140211081029056 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:21:42.409096 140211081029056 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:21:42.409499: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:21:42.415148 140211081029056 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:21:42.417566 140211081029056 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:21:42.422240 140211081029056 tpu_estimator.py:557] Init TPU system
I0814 16:21:48.262099 140211081029056 tpu_estimator.py:566] Initialized TPU in 5 seconds
I0814 16:21:48.263189 140210176505600 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:21:48.264127 140210168112896 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:21:48.329732 140211081029056 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:21:48.332658 140211081029056 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:21:48.338917 140210159720192 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:21:48.476588 140210159720192 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:21:52.993062 140210168112896 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:21:57.696084 140211081029056 basic_session_run_hooks.py:262] loss = 2.0994298, step = 30
I0814 16:21:57.699053 140211081029056 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:22:12.271256 140211081029056 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:22:12.271593 140211081029056 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:22:12.271929 140210176505600 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:22:12.272243 140210176505600 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:22:12.272525 140211081029056 error_handling.py:96] infeed marked as finished
I0814 16:22:12.272713 140211081029056 tpu_estimator.py:602] Stop output thread controller
I0814 16:22:12.272784 140211081029056 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:22:12.272963 140210168112896 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:22:12.273215 140210168112896 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:22:12.273392 140211081029056 error_handling.py:96] outfeed marked as finished
I0814 16:22:12.273540 140211081029056 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:22:18.620368 140211081029056 estimator.py:368] Loss for final step: 2.0994298.
I0814 16:22:18.621273 140211081029056 error_handling.py:96] training_loop marked as finished
I0814 16:22:19.412905 140211081029056 estimator.py:1145] Calling model_fn.
E0814 16:22:20.384497 140211081029056 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:22:20.611768 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:22:20.634953 140211081029056 estimator.py:1147] Done calling model_fn.
I0814 16:22:20.652703 140211081029056 evaluation.py:255] Starting evaluation at 2019-08-14T16:22:20Z
I0814 16:22:20.652945 140211081029056 tpu_estimator.py:499] TPU job name worker
I0814 16:22:20.730618 140211081029056 monitored_session.py:240] Graph was finalized.
W0814 16:22:20.731425 140211081029056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:22:20.962727 140211081029056 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:22:23.611254 140211081029056 session_manager.py:500] Running local_init_op.
I0814 16:22:23.640927 140211081029056 session_manager.py:502] Done running local_init_op.
I0814 16:22:23.694312 140211081029056 tpu_estimator.py:557] Init TPU system
I0814 16:22:32.737191 140211081029056 tpu_estimator.py:566] Initialized TPU in 9 seconds
I0814 16:22:32.737979 140210176505600 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:22:32.738413 140210168112896 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:22:32.805556 140211081029056 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:22:32.831245 140211081029056 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:22:32.831579 140211081029056 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:22:32.869374 140210159720192 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:22:32.994386 140210159720192 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:22:33.610512 140210168112896 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:22:33.914004 140211081029056 evaluation.py:167] Evaluation [10/10]
I0814 16:22:33.914349 140211081029056 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:22:33.914439 140211081029056 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:22:33.914747 140210176505600 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:22:33.914916 140210176505600 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:22:33.915102 140211081029056 error_handling.py:96] infeed marked as finished
I0814 16:22:33.915225 140211081029056 tpu_estimator.py:602] Stop output thread controller
I0814 16:22:33.915283 140211081029056 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:22:33.915422 140210168112896 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:22:33.915529 140210168112896 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:22:33.915654 140211081029056 error_handling.py:96] outfeed marked as finished
I0814 16:22:33.915745 140211081029056 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:23:03.090492 140211081029056 evaluation.py:275] Finished evaluation at 2019-08-14-16:23:03
I0814 16:23:03.090833 140211081029056 estimator.py:2039] Saving dict for global step 30: accuracy = 0.6976, global_step = 30, loss = 2.090587
I0814 16:23:07.908184 140211081029056 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:23:08.815372 140211081029056 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.090587, 'global_step': 30, 'accuracy': 0.6976}

Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565799701757555...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565799697127410...
Removing gs://yangyou-mnist/log/checkpoint#1565799728504061...
Removing gs://yangyou-mnist/log/#1565799684267172...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565799725115782...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565799684.v3-8-tpu#1565799731958635...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565799696229888...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565799689377634...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565799725997740...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565799730865336...
Removing gs://yangyou-mnist/log/eval/#1565799784808512...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565799785.v3-8-tpu#1565799788503416...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:23:12.647447 139807187346880 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:23:12.648221 139807187346880 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:23:12.651030 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:23:12.651894 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:23:12.652546 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:23:12.652697 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:23:13.067591 139807187346880 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:23:13.076519 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:23:13.081130 139807187346880 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:23:13.139605 139807187346880 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:23:13.139899 139807187346880 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:23:13.247442 139807187346880 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:23:13.366307 139807187346880 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:23:13.366605 139807187346880 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:23:13.483253 139807187346880 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f273fe67210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2742046210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:23:13.483594 139807187346880 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:23:13.816725 139807187346880 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:23:13.819667: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:23:13.832494 139807187346880 tpu_system_metadata.py:148] Found TPU system:
I0814 16:23:13.832746 139807187346880 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:23:13.833214 139807187346880 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:23:13.833273 139807187346880 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:23:13.833327 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:23:13.833610 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:23:13.833669 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:23:13.833720 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:23:13.833769 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:23:13.833816 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:23:13.833875 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:23:13.833925 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:23:13.833980 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:23:13.834027 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:23:13.834074 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:23:13.840368 139807187346880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:23:13.853189 139807187346880 estimator.py:1145] Calling model_fn.
W0814 16:23:13.853810 139807187346880 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:23:14.125209 139807187346880 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:23:14.530884 139807187346880 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:23:14.594314 139807187346880 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:23:14.600307 139807187346880 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:23:14.796947 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:23:14.811242 139807187346880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:23:14.823664 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:23:14.824769 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:23:14.832216 139807187346880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:23:14.837873 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:23:14.838090 139807187346880 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:23:14.851197 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:23:14.964210 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:23:15.006942 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.053287 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.106261 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.277242 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.330473 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.380485 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.433027 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.479639 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.522533 139807187346880 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:23:15.538980 139807187346880 estimator.py:1147] Done calling model_fn.
I0814 16:23:18.903049 139807187346880 tpu_estimator.py:499] TPU job name worker
I0814 16:23:19.016777 139807187346880 monitored_session.py:240] Graph was finalized.
I0814 16:23:19.682920 139807187346880 session_manager.py:500] Running local_init_op.
I0814 16:23:19.736210 139807187346880 session_manager.py:502] Done running local_init_op.
I0814 16:23:22.544645 139807187346880 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:23:34.908052 139807187346880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:23:35.046561 139807187346880 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:23:35.047032 139807187346880 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:23:35.047518: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:23:35.052654 139807187346880 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:23:35.054928 139807187346880 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:23:35.059647 139807187346880 tpu_estimator.py:557] Init TPU system
I0814 16:23:47.304795 139807187346880 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:23:47.305816 139806151538432 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:23:47.306737 139806143145728 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:23:47.371077 139807187346880 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:23:47.372040 139807187346880 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:23:47.435630 139806134753024 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:23:47.586621 139806134753024 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:23:52.072916 139806143145728 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:23:56.452114 139807187346880 basic_session_run_hooks.py:262] loss = 1.8751954, step = 30
I0814 16:23:56.454574 139807187346880 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:24:09.960062 139807187346880 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:24:09.960397 139807187346880 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:24:09.962105 139806151538432 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:24:09.962471 139806151538432 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:24:09.963345 139807187346880 error_handling.py:96] infeed marked as finished
I0814 16:24:09.963591 139807187346880 tpu_estimator.py:602] Stop output thread controller
I0814 16:24:09.963722 139807187346880 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:24:09.963915 139806143145728 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:24:09.964078 139806143145728 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:24:09.964245 139807187346880 error_handling.py:96] outfeed marked as finished
I0814 16:24:09.964376 139807187346880 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:24:17.724968 139807187346880 estimator.py:368] Loss for final step: 1.8751954.
I0814 16:24:17.725887 139807187346880 error_handling.py:96] training_loop marked as finished
I0814 16:24:18.440507 139807187346880 estimator.py:1145] Calling model_fn.
E0814 16:24:19.138159 139807187346880 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:24:19.369590 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:24:19.392792 139807187346880 estimator.py:1147] Done calling model_fn.
I0814 16:24:19.410521 139807187346880 evaluation.py:255] Starting evaluation at 2019-08-14T16:24:19Z
I0814 16:24:19.410769 139807187346880 tpu_estimator.py:499] TPU job name worker
I0814 16:24:19.491384 139807187346880 monitored_session.py:240] Graph was finalized.
W0814 16:24:19.492119 139807187346880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:24:19.681451 139807187346880 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:24:22.244780 139807187346880 session_manager.py:500] Running local_init_op.
I0814 16:24:22.269366 139807187346880 session_manager.py:502] Done running local_init_op.
I0814 16:24:22.323884 139807187346880 tpu_estimator.py:557] Init TPU system
I0814 16:24:33.651722 139807187346880 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:24:33.652686 139806151538432 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:24:33.653898 139806143145728 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:24:33.719922 139807187346880 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:24:33.753943 139807187346880 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:24:33.754312 139807187346880 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:24:33.785062 139806134753024 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:24:33.908734 139806134753024 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:24:34.544770 139806143145728 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:24:34.846565 139807187346880 evaluation.py:167] Evaluation [10/10]
I0814 16:24:34.846895 139807187346880 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:24:34.846966 139807187346880 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:24:34.847208 139806151538432 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:24:34.847548 139806151538432 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:24:34.847733 139807187346880 error_handling.py:96] infeed marked as finished
I0814 16:24:34.847913 139807187346880 tpu_estimator.py:602] Stop output thread controller
I0814 16:24:34.847975 139807187346880 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:24:34.848125 139806143145728 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:24:34.848340 139806143145728 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:24:34.848661 139807187346880 error_handling.py:96] outfeed marked as finished
I0814 16:24:34.848850 139807187346880 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:25:04.011712 139807187346880 evaluation.py:275] Finished evaluation at 2019-08-14-16:25:04
I0814 16:25:04.012082 139807187346880 estimator.py:2039] Saving dict for global step 30: accuracy = 0.77, global_step = 30, loss = 1.8550341
I0814 16:25:08.654653 139807187346880 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:25:09.439197 139807187346880 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.8550341, 'global_step': 30, 'accuracy': 0.77}

Removing gs://yangyou-mnist/log/#1565799797086525...
Removing gs://yangyou-mnist/log/checkpoint#1565799846345839...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565799797.v3-8-tpu#1565799849645343...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565799808887892...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565799801956367...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565799843212672...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565799814383428...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565799809729058...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565799844117019...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565799848567204...
Removing gs://yangyou-mnist/log/eval/#1565799905844286...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565799906.v3-8-tpu#1565799909109359...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:25:13.342401 139797176632768 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:25:13.343194 139797176632768 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:25:13.345860 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:25:13.346698 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:25:13.347285 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:25:13.347414 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:25:13.757306 139797176632768 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:25:13.766930 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:25:13.771492 139797176632768 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:25:13.817085 139797176632768 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:25:13.817357 139797176632768 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:25:13.923451 139797176632768 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:25:13.982201 139797176632768 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:25:13.982489 139797176632768 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:25:14.085519 139797176632768 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f24eb35a2d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f24ed550210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:25:14.085885 139797176632768 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:25:14.458529 139797176632768 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:25:14.461741: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:25:14.473936 139797176632768 tpu_system_metadata.py:148] Found TPU system:
I0814 16:25:14.474267 139797176632768 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:25:14.474808 139797176632768 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:25:14.474867 139797176632768 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:25:14.474920 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:25:14.475223 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:25:14.475280 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:25:14.475331 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:25:14.475378 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:25:14.475425 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:25:14.475471 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:25:14.475517 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:25:14.475568 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:25:14.475615 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:25:14.475662 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:25:14.481645 139797176632768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:25:14.494385 139797176632768 estimator.py:1145] Calling model_fn.
W0814 16:25:14.494991 139797176632768 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:25:14.785408 139797176632768 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:25:15.336189 139797176632768 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:25:15.399009 139797176632768 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:25:15.405078 139797176632768 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:25:15.586766 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:25:15.600539 139797176632768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:25:15.612584 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:25:15.613652 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:25:15.621166 139797176632768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:25:15.626580 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:25:15.626796 139797176632768 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:25:15.639492 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:25:15.749501 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:25:15.791241 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:15.836585 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:15.889090 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.054248 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.105439 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.154901 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.207192 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.254262 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.297322 139797176632768 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:25:16.314104 139797176632768 estimator.py:1147] Done calling model_fn.
I0814 16:25:19.948261 139797176632768 tpu_estimator.py:499] TPU job name worker
I0814 16:25:20.061204 139797176632768 monitored_session.py:240] Graph was finalized.
I0814 16:25:20.734277 139797176632768 session_manager.py:500] Running local_init_op.
I0814 16:25:20.795780 139797176632768 session_manager.py:502] Done running local_init_op.
I0814 16:25:23.464164 139797176632768 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:25:35.775620 139797176632768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:25:35.931417 139797176632768 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:25:35.931852 139797176632768 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:25:35.932259: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:25:35.937156 139797176632768 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:25:35.939476 139797176632768 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:25:35.943749 139797176632768 tpu_estimator.py:557] Init TPU system
I0814 16:25:47.385360 139797176632768 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:25:47.386169 139796143924992 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:25:47.386626 139796135532288 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:25:47.442461 139796127139584 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:25:47.449800 139797176632768 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:25:47.452008 139797176632768 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:25:47.556119 139796127139584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:25:52.140136 139796135532288 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:25:56.742628 139797176632768 basic_session_run_hooks.py:262] loss = 1.285434, step = 30
I0814 16:25:56.745057 139797176632768 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:26:10.794018 139797176632768 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:26:10.794317 139797176632768 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:26:10.794532 139796143924992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:26:10.794646 139796143924992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:26:10.794785 139797176632768 error_handling.py:96] infeed marked as finished
I0814 16:26:10.794895 139797176632768 tpu_estimator.py:602] Stop output thread controller
I0814 16:26:10.794945 139797176632768 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:26:10.795054 139796135532288 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:26:10.795135 139796135532288 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:26:10.795242 139797176632768 error_handling.py:96] outfeed marked as finished
I0814 16:26:10.795316 139797176632768 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:26:17.671432 139797176632768 estimator.py:368] Loss for final step: 1.285434.
I0814 16:26:17.672239 139797176632768 error_handling.py:96] training_loop marked as finished
I0814 16:26:18.507708 139797176632768 estimator.py:1145] Calling model_fn.
E0814 16:26:19.225023 139797176632768 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:26:19.455071 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:26:19.477771 139797176632768 estimator.py:1147] Done calling model_fn.
I0814 16:26:19.496800 139797176632768 evaluation.py:255] Starting evaluation at 2019-08-14T16:26:19Z
I0814 16:26:19.497050 139797176632768 tpu_estimator.py:499] TPU job name worker
I0814 16:26:19.579277 139797176632768 monitored_session.py:240] Graph was finalized.
W0814 16:26:19.580044 139797176632768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:26:19.771220 139797176632768 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:26:22.290710 139797176632768 session_manager.py:500] Running local_init_op.
I0814 16:26:22.322113 139797176632768 session_manager.py:502] Done running local_init_op.
I0814 16:26:22.373693 139797176632768 tpu_estimator.py:557] Init TPU system
I0814 16:26:33.866260 139797176632768 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:26:33.867074 139796142352128 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:26:33.867548 139796133959424 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:26:33.932017 139797176632768 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:26:33.961030 139797176632768 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:26:33.961395 139797176632768 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:26:33.996833 139796125566720 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:26:34.203754 139796125566720 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:26:34.718810 139796133959424 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:26:35.236888 139797176632768 evaluation.py:167] Evaluation [10/10]
I0814 16:26:35.237211 139797176632768 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:26:35.237313 139797176632768 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:26:35.237504 139796142352128 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:26:35.237605 139796142352128 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:26:35.237843 139797176632768 error_handling.py:96] infeed marked as finished
I0814 16:26:35.238035 139797176632768 tpu_estimator.py:602] Stop output thread controller
I0814 16:26:35.238097 139797176632768 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:26:35.238245 139796133959424 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:26:35.238334 139796133959424 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:26:35.238466 139797176632768 error_handling.py:96] outfeed marked as finished
I0814 16:26:35.238554 139797176632768 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:27:04.299556 139797176632768 evaluation.py:275] Finished evaluation at 2019-08-14-16:27:04
I0814 16:27:04.299880 139797176632768 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8083, global_step = 30, loss = 1.240481
I0814 16:27:08.868134 139797176632768 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:27:09.696660 139797176632768 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.240481, 'global_step': 30, 'accuracy': 0.8083}

Removing gs://yangyou-mnist/log/#1565799917814623...
Removing gs://yangyou-mnist/log/checkpoint#1565799967202028...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565799930778848...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565799935257674...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565799918.v3-8-tpu#1565799970488868...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565799964068370...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565799964920734...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565799929874147...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565799922878754...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565799969427109...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800026.v3-8-tpu#1565800029387205...
Removing gs://yangyou-mnist/log/eval/#1565800025992759...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:27:13.514928 139863409300928 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:27:13.515726 139863409300928 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:27:13.518907 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:27:13.519782 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:27:13.520586 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:27:13.520733 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:27:13.932854 139863409300928 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:27:13.941929 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:27:13.946146 139863409300928 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:27:14.000932 139863409300928 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:27:14.001226 139863409300928 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:27:14.101975 139863409300928 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:27:14.146533 139863409300928 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:27:14.146812 139863409300928 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:27:14.253304 139863409300928 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3456fd6250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f34591b5210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:27:14.253681 139863409300928 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:27:14.582792 139863409300928 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:27:14.585812: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:27:14.598027 139863409300928 tpu_system_metadata.py:148] Found TPU system:
I0814 16:27:14.598278 139863409300928 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:27:14.598752 139863409300928 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:27:14.598815 139863409300928 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:27:14.598870 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:27:14.599159 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:27:14.599216 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:27:14.599267 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:27:14.599317 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:27:14.599364 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:27:14.599412 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:27:14.599459 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:27:14.599505 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:27:14.599631 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:27:14.599694 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:27:14.605755 139863409300928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:27:14.618480 139863409300928 estimator.py:1145] Calling model_fn.
W0814 16:27:14.619106 139863409300928 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:27:14.885938 139863409300928 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:27:15.312357 139863409300928 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:27:15.373940 139863409300928 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:27:15.379707 139863409300928 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:27:15.557609 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:27:15.571078 139863409300928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:27:15.583098 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:27:15.584157 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:27:15.591056 139863409300928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:27:15.596204 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:27:15.596424 139863409300928 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:27:15.608553 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:27:15.717794 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:27:15.758781 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:15.802947 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:15.854752 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.016655 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.066838 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.122915 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.172369 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.218342 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.260091 139863409300928 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:27:16.276106 139863409300928 estimator.py:1147] Done calling model_fn.
I0814 16:27:19.684200 139863409300928 tpu_estimator.py:499] TPU job name worker
I0814 16:27:19.796919 139863409300928 monitored_session.py:240] Graph was finalized.
I0814 16:27:20.458379 139863409300928 session_manager.py:500] Running local_init_op.
I0814 16:27:20.507018 139863409300928 session_manager.py:502] Done running local_init_op.
I0814 16:27:23.252034 139863409300928 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:27:35.185417 139863409300928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:27:35.353055 139863409300928 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:27:35.353529 139863409300928 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:27:35.354003: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:27:35.358756 139863409300928 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:27:35.360805 139863409300928 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:27:35.365250 139863409300928 tpu_estimator.py:557] Init TPU system
I0814 16:27:47.120641 139863409300928 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:27:47.121643 139862506198784 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:27:47.122114 139862497806080 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:27:47.184914 139863409300928 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:27:47.185775 139863409300928 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:27:47.254121 139862489413376 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:27:47.370362 139862489413376 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:27:52.074119 139862497806080 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:27:56.806979 139863409300928 basic_session_run_hooks.py:262] loss = 0.89347833, step = 30
I0814 16:27:56.809161 139863409300928 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:28:10.460455 139863409300928 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:28:10.460747 139863409300928 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:28:10.460928 139862506198784 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:28:10.461028 139862506198784 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:28:10.461179 139863409300928 error_handling.py:96] infeed marked as finished
I0814 16:28:10.461277 139863409300928 tpu_estimator.py:602] Stop output thread controller
I0814 16:28:10.461325 139863409300928 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:28:10.461436 139862497806080 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:28:10.461519 139862497806080 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:28:10.461647 139863409300928 error_handling.py:96] outfeed marked as finished
I0814 16:28:10.461724 139863409300928 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:28:17.512025 139863409300928 estimator.py:368] Loss for final step: 0.89347833.
I0814 16:28:17.512924 139863409300928 error_handling.py:96] training_loop marked as finished
I0814 16:28:18.208734 139863409300928 estimator.py:1145] Calling model_fn.
E0814 16:28:18.940510 139863409300928 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:28:19.169138 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:28:19.190582 139863409300928 estimator.py:1147] Done calling model_fn.
I0814 16:28:19.208070 139863409300928 evaluation.py:255] Starting evaluation at 2019-08-14T16:28:19Z
I0814 16:28:19.208308 139863409300928 tpu_estimator.py:499] TPU job name worker
I0814 16:28:19.290648 139863409300928 monitored_session.py:240] Graph was finalized.
W0814 16:28:19.291419 139863409300928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:28:19.490663 139863409300928 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:28:22.044178 139863409300928 session_manager.py:500] Running local_init_op.
I0814 16:28:22.074238 139863409300928 session_manager.py:502] Done running local_init_op.
I0814 16:28:22.124716 139863409300928 tpu_estimator.py:557] Init TPU system
I0814 16:28:33.867239 139863409300928 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:28:33.868105 139862506198784 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:28:33.868624 139862497806080 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:28:33.937299 139863409300928 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:28:33.962013 139863409300928 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:28:33.962363 139863409300928 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:28:34.063404 139862489413376 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:28:34.448915 139862489413376 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:28:34.719919 139862497806080 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:28:35.186980 139863409300928 evaluation.py:167] Evaluation [10/10]
I0814 16:28:35.187324 139863409300928 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:28:35.187402 139863409300928 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:28:35.187594 139862506198784 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:28:35.187700 139862506198784 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:28:35.187839 139863409300928 error_handling.py:96] infeed marked as finished
I0814 16:28:35.187937 139863409300928 tpu_estimator.py:602] Stop output thread controller
I0814 16:28:35.187984 139863409300928 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:28:35.188097 139862497806080 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:28:35.188174 139862497806080 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:28:35.188287 139863409300928 error_handling.py:96] outfeed marked as finished
I0814 16:28:35.188374 139863409300928 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:29:04.539004 139863409300928 evaluation.py:275] Finished evaluation at 2019-08-14-16:29:04
I0814 16:29:04.539325 139863409300928 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8351, global_step = 30, loss = 0.82463825
I0814 16:29:08.901562 139863409300928 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:29:10.019752 139863409300928 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.82463825, 'global_step': 30, 'accuracy': 0.8351}

Removing gs://yangyou-mnist/log/#1565800037735668...
Removing gs://yangyou-mnist/log/checkpoint#1565800087020468...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800042673839...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800037.v3-8-tpu#1565800090150395...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800083816314...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800049180680...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800050081791...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800054633646...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800084778481...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800089181928...
Removing gs://yangyou-mnist/log/eval/#1565800146226157...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800146.v3-8-tpu#1565800149679967...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:29:13.751085 139919165904320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:29:13.751854 139919165904320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:29:13.754523 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:29:13.755351 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:29:13.755934 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:29:13.756066 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:29:14.163357 139919165904320 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:29:14.170110 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:29:14.174045 139919165904320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:29:14.215631 139919165904320 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:29:14.215928 139919165904320 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:29:14.463635 139919165904320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:29:14.579571 139919165904320 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:29:14.579881 139919165904320 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:29:14.744282 139919165904320 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f41525791d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4154759210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:29:14.744693 139919165904320 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:29:15.060477 139919165904320 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:29:15.063464: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:29:15.075593 139919165904320 tpu_system_metadata.py:148] Found TPU system:
I0814 16:29:15.075865 139919165904320 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:29:15.076383 139919165904320 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:29:15.076505 139919165904320 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:29:15.076564 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:29:15.077068 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:29:15.077136 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:29:15.077195 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:29:15.077261 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:29:15.077316 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:29:15.077363 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:29:15.077409 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:29:15.077455 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:29:15.077502 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:29:15.077549 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:29:15.083570 139919165904320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:29:15.095772 139919165904320 estimator.py:1145] Calling model_fn.
W0814 16:29:15.096376 139919165904320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:29:15.366575 139919165904320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:29:15.788001 139919165904320 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:29:15.849550 139919165904320 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:29:15.855531 139919165904320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:29:16.033031 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:29:16.046855 139919165904320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:29:16.058958 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:29:16.059997 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:29:16.067120 139919165904320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:29:16.072308 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:29:16.072590 139919165904320 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:29:16.085186 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:29:16.200999 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:29:16.242353 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.286418 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.337553 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.506757 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.556305 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.604576 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.653918 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.698441 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.739311 139919165904320 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:29:16.755374 139919165904320 estimator.py:1147] Done calling model_fn.
I0814 16:29:20.046132 139919165904320 tpu_estimator.py:499] TPU job name worker
I0814 16:29:20.159032 139919165904320 monitored_session.py:240] Graph was finalized.
I0814 16:29:20.850455 139919165904320 session_manager.py:500] Running local_init_op.
I0814 16:29:20.897564 139919165904320 session_manager.py:502] Done running local_init_op.
I0814 16:29:23.605987 139919165904320 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:29:35.936510 139919165904320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:29:36.091989 139919165904320 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:29:36.092470 139919165904320 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:29:36.092922: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:29:36.098172 139919165904320 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:29:36.101109 139919165904320 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:29:36.105887 139919165904320 tpu_estimator.py:557] Init TPU system
I0814 16:29:47.800626 139919165904320 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:29:47.801723 139918269732608 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:29:47.802401 139918261339904 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:29:47.865531 139918252947200 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:29:47.865885 139919165904320 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:29:47.867577 139919165904320 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:29:47.988045 139918252947200 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:29:52.590040 139918261339904 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:29:57.213753 139919165904320 basic_session_run_hooks.py:262] loss = 0.5619462, step = 30
I0814 16:29:57.215807 139919165904320 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:30:10.833870 139919165904320 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:30:10.834161 139919165904320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:30:10.834359 139918269732608 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:30:10.834465 139918269732608 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:30:10.834597 139919165904320 error_handling.py:96] infeed marked as finished
I0814 16:30:10.834714 139919165904320 tpu_estimator.py:602] Stop output thread controller
I0814 16:30:10.834767 139919165904320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:30:10.834881 139918261339904 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:30:10.834950 139918261339904 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:30:10.835058 139919165904320 error_handling.py:96] outfeed marked as finished
I0814 16:30:10.835143 139919165904320 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:30:18.125354 139919165904320 estimator.py:368] Loss for final step: 0.5619462.
I0814 16:30:18.126120 139919165904320 error_handling.py:96] training_loop marked as finished
I0814 16:30:18.900769 139919165904320 estimator.py:1145] Calling model_fn.
E0814 16:30:19.690303 139919165904320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:30:19.920068 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:30:19.943411 139919165904320 estimator.py:1147] Done calling model_fn.
I0814 16:30:19.961319 139919165904320 evaluation.py:255] Starting evaluation at 2019-08-14T16:30:19Z
I0814 16:30:19.961560 139919165904320 tpu_estimator.py:499] TPU job name worker
I0814 16:30:20.045784 139919165904320 monitored_session.py:240] Graph was finalized.
W0814 16:30:20.046540 139919165904320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:30:20.233067 139919165904320 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:30:22.964025 139919165904320 session_manager.py:500] Running local_init_op.
I0814 16:30:22.988190 139919165904320 session_manager.py:502] Done running local_init_op.
I0814 16:30:23.041363 139919165904320 tpu_estimator.py:557] Init TPU system
I0814 16:30:34.872327 139919165904320 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:30:34.873256 139918266062592 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:30:34.873740 139918257669888 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:30:34.939445 139919165904320 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:30:34.964272 139919165904320 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:30:34.964663 139919165904320 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:30:34.996090 139918244292352 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:30:35.102171 139918244292352 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:30:35.754863 139918257669888 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:30:36.116168 139919165904320 evaluation.py:167] Evaluation [10/10]
I0814 16:30:36.116553 139919165904320 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:30:36.116648 139919165904320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:30:36.116856 139918266062592 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:30:36.116964 139918266062592 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:30:36.117109 139919165904320 error_handling.py:96] infeed marked as finished
I0814 16:30:36.117223 139919165904320 tpu_estimator.py:602] Stop output thread controller
I0814 16:30:36.117284 139919165904320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:30:36.117407 139918257669888 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:30:36.117486 139918257669888 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:30:36.117610 139919165904320 error_handling.py:96] outfeed marked as finished
I0814 16:30:36.117795 139919165904320 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:31:05.195046 139919165904320 evaluation.py:275] Finished evaluation at 2019-08-14-16:31:05
I0814 16:31:05.195369 139919165904320 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8787, global_step = 30, loss = 0.50310624
I0814 16:31:09.493438 139919165904320 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:31:10.264098 139919165904320 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.50310624, 'global_step': 30, 'accuracy': 0.8787}

Removing gs://yangyou-mnist/log/checkpoint#1565800207188151...
Removing gs://yangyou-mnist/log/#1565800158229956...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800158.v3-8-tpu#1565800210528694...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800163030270...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800170061944...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800204161974...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800175422914...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800205027612...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800171012423...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800209548094...
Removing gs://yangyou-mnist/log/eval/#1565800266838283...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800267.v3-8-tpu#1565800269959780...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:31:14.024374 140062906897856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:31:14.025208 140062906897856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:31:14.027760 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:31:14.028645 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:31:14.029244 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:31:14.029373 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:31:14.444479 140062906897856 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:31:14.451646 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:31:14.455707 140062906897856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:31:14.501713 140062906897856 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:31:14.501981 140062906897856 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:31:14.636269 140062906897856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:31:14.678530 140062906897856 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:31:14.678805 140062906897856 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:31:14.797434 140062906897856 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f62c9f91190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f62cc171210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:31:14.797781 140062906897856 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:31:15.120814 140062906897856 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:31:15.123677: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:31:15.137260 140062906897856 tpu_system_metadata.py:148] Found TPU system:
I0814 16:31:15.137511 140062906897856 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:31:15.138012 140062906897856 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:31:15.138072 140062906897856 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:31:15.138124 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:31:15.138415 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:31:15.138469 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:31:15.138519 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:31:15.138572 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:31:15.138618 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:31:15.138665 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:31:15.138710 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:31:15.138756 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:31:15.138801 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:31:15.138848 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:31:15.145133 140062906897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:31:15.157897 140062906897856 estimator.py:1145] Calling model_fn.
W0814 16:31:15.158514 140062906897856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:31:15.428519 140062906897856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:31:15.837637 140062906897856 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:31:15.899926 140062906897856 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:31:15.905955 140062906897856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:31:16.091157 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:31:16.105309 140062906897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:31:16.117628 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:31:16.118705 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:31:16.125861 140062906897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:31:16.131227 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:31:16.131439 140062906897856 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:31:16.144054 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:31:16.254796 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:31:16.296818 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.342339 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.394807 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.560595 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.611654 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.661609 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.712795 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.760462 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.802309 140062906897856 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:31:16.818576 140062906897856 estimator.py:1147] Done calling model_fn.
I0814 16:31:20.175715 140062906897856 tpu_estimator.py:499] TPU job name worker
I0814 16:31:20.285017 140062906897856 monitored_session.py:240] Graph was finalized.
I0814 16:31:20.998323 140062906897856 session_manager.py:500] Running local_init_op.
I0814 16:31:21.047856 140062906897856 session_manager.py:502] Done running local_init_op.
I0814 16:31:23.716692 140062906897856 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:31:35.820139 140062906897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:31:35.961509 140062906897856 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:31:35.962006 140062906897856 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:31:35.962422: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:31:35.966890 140062906897856 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:31:35.969096 140062906897856 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:31:35.973082 140062906897856 tpu_estimator.py:557] Init TPU system
I0814 16:31:47.792615 140062906897856 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:31:47.793548 140062010627840 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:31:47.794019 140062002235136 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:31:47.856390 140061993842432 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:31:47.858033 140062906897856 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:31:47.859759 140062906897856 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:31:48.073841 140061993842432 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:31:52.637478 140062002235136 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:31:57.282218 140062906897856 basic_session_run_hooks.py:262] loss = 0.4177891, step = 30
I0814 16:31:57.284706 140062906897856 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:32:10.631211 140062906897856 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:32:10.631535 140062906897856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:32:10.631772 140062010627840 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:32:10.631877 140062010627840 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:32:10.632019 140062906897856 error_handling.py:96] infeed marked as finished
I0814 16:32:10.632114 140062906897856 tpu_estimator.py:602] Stop output thread controller
I0814 16:32:10.632165 140062906897856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:32:10.632282 140062002235136 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:32:10.632359 140062002235136 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:32:10.632572 140062906897856 error_handling.py:96] outfeed marked as finished
I0814 16:32:10.632683 140062906897856 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:32:18.212265 140062906897856 estimator.py:368] Loss for final step: 0.4177891.
I0814 16:32:18.213206 140062906897856 error_handling.py:96] training_loop marked as finished
I0814 16:32:19.002778 140062906897856 estimator.py:1145] Calling model_fn.
E0814 16:32:19.747783 140062906897856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:32:19.976105 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:32:19.998132 140062906897856 estimator.py:1147] Done calling model_fn.
I0814 16:32:20.015768 140062906897856 evaluation.py:255] Starting evaluation at 2019-08-14T16:32:20Z
I0814 16:32:20.016005 140062906897856 tpu_estimator.py:499] TPU job name worker
I0814 16:32:20.097974 140062906897856 monitored_session.py:240] Graph was finalized.
W0814 16:32:20.098685 140062906897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:32:20.284238 140062906897856 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:32:22.968063 140062906897856 session_manager.py:500] Running local_init_op.
I0814 16:32:22.998986 140062906897856 session_manager.py:502] Done running local_init_op.
I0814 16:32:23.055191 140062906897856 tpu_estimator.py:557] Init TPU system
I0814 16:32:35.319789 140062906897856 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:32:35.320883 140062006957824 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:32:35.321729 140061998565120 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:32:35.388091 140062906897856 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:32:35.412913 140062906897856 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:32:35.413280 140062906897856 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:32:35.450551 140061985187584 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:32:35.561211 140061985187584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:32:36.185601 140061998565120 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:32:36.651011 140062906897856 evaluation.py:167] Evaluation [10/10]
I0814 16:32:36.651341 140062906897856 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:32:36.651422 140062906897856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:32:36.651669 140062006957824 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:32:36.651943 140062006957824 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:32:36.652151 140062906897856 error_handling.py:96] infeed marked as finished
I0814 16:32:36.652359 140062906897856 tpu_estimator.py:602] Stop output thread controller
I0814 16:32:36.652445 140062906897856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:32:36.652657 140061998565120 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:32:36.652847 140061998565120 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:32:36.653062 140062906897856 error_handling.py:96] outfeed marked as finished
I0814 16:32:36.653254 140062906897856 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:33:05.660665 140062906897856 evaluation.py:275] Finished evaluation at 2019-08-14-16:33:05
I0814 16:33:05.661017 140062906897856 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8982, global_step = 30, loss = 0.40788308
I0814 16:33:10.308789 140062906897856 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:33:11.104204 140062906897856 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.40788308, 'global_step': 30, 'accuracy': 0.8982}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800290838697...
Removing gs://yangyou-mnist/log/checkpoint#1565800327233001...
Removing gs://yangyou-mnist/log/#1565800278408821...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800278.v3-8-tpu#1565800330329659...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800295307837...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800283130370...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800324312036...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800325105690...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800289879665...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800329420184...
Removing gs://yangyou-mnist/log/eval/#1565800387317035...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800387.v3-8-tpu#1565800390796523...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:33:14.841559 139957271160256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:33:14.842329 139957271160256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:33:14.844969 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:33:14.845791 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:33:14.846373 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:33:14.846501 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:33:15.259291 139957271160256 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:33:15.266771 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:33:15.270701 139957271160256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:33:15.330071 139957271160256 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:33:15.330368 139957271160256 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:33:15.463334 139957271160256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:33:15.525108 139957271160256 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:33:15.525399 139957271160256 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:33:15.610764 139957271160256 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4a3197b290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4a33b5a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:33:15.611121 139957271160256 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:33:15.938179 139957271160256 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:33:15.941496: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:33:15.954339 139957271160256 tpu_system_metadata.py:148] Found TPU system:
I0814 16:33:15.954579 139957271160256 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:33:15.955075 139957271160256 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:33:15.955132 139957271160256 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:33:15.955183 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:33:15.955466 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:33:15.955521 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:33:15.955576 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:33:15.955625 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:33:15.955672 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:33:15.955723 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:33:15.955776 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:33:15.955823 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:33:15.955871 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:33:15.955919 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:33:15.962053 139957271160256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:33:15.974766 139957271160256 estimator.py:1145] Calling model_fn.
W0814 16:33:15.975394 139957271160256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:33:16.249557 139957271160256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:33:16.666893 139957271160256 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:33:16.728636 139957271160256 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:33:16.734591 139957271160256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:33:16.917298 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:33:16.930983 139957271160256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:33:16.943216 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:33:16.944282 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:33:16.951355 139957271160256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:33:16.956618 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:33:16.956828 139957271160256 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:33:16.969428 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:33:17.080559 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:33:17.123264 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.168704 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.221080 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.389868 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.440973 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.489742 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.539900 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.586704 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.627759 139957271160256 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:33:17.643933 139957271160256 estimator.py:1147] Done calling model_fn.
I0814 16:33:20.927438 139957271160256 tpu_estimator.py:499] TPU job name worker
I0814 16:33:21.040571 139957271160256 monitored_session.py:240] Graph was finalized.
I0814 16:33:21.752650 139957271160256 session_manager.py:500] Running local_init_op.
I0814 16:33:21.803766 139957271160256 session_manager.py:502] Done running local_init_op.
I0814 16:33:24.397095 139957271160256 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:33:37.444529 139957271160256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:33:37.611129 139957271160256 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:33:37.611807 139957271160256 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:33:37.613442: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:33:37.618383 139957271160256 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:33:37.620598 139957271160256 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:33:37.624492 139957271160256 tpu_estimator.py:557] Init TPU system
I0814 16:33:49.128107 139957271160256 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:33:49.129020 139956374980352 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:33:49.129390 139956366587648 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:33:49.191324 139956358194944 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:33:49.192987 139957271160256 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:33:49.194171 139957271160256 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:33:49.435729 139956358194944 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:33:53.854691 139956366587648 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:33:58.520600 139957271160256 basic_session_run_hooks.py:262] loss = 0.24504378, step = 30
I0814 16:33:58.523442 139957271160256 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:34:11.668962 139957271160256 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:34:11.669303 139957271160256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:34:11.669547 139956374980352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:34:11.669687 139956374980352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:34:11.669832 139957271160256 error_handling.py:96] infeed marked as finished
I0814 16:34:11.669948 139957271160256 tpu_estimator.py:602] Stop output thread controller
I0814 16:34:11.670000 139957271160256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:34:11.670115 139956366587648 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:34:11.670192 139956366587648 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:34:11.670325 139957271160256 error_handling.py:96] outfeed marked as finished
I0814 16:34:11.670402 139957271160256 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:34:19.577327 139957271160256 estimator.py:368] Loss for final step: 0.24504378.
I0814 16:34:19.578193 139957271160256 error_handling.py:96] training_loop marked as finished
I0814 16:34:20.269753 139957271160256 estimator.py:1145] Calling model_fn.
E0814 16:34:20.959471 139957271160256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:34:21.191406 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:34:21.213403 139957271160256 estimator.py:1147] Done calling model_fn.
I0814 16:34:21.229789 139957271160256 evaluation.py:255] Starting evaluation at 2019-08-14T16:34:21Z
I0814 16:34:21.230036 139957271160256 tpu_estimator.py:499] TPU job name worker
I0814 16:34:21.308046 139957271160256 monitored_session.py:240] Graph was finalized.
W0814 16:34:21.308881 139957271160256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:34:21.492996 139957271160256 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:34:24.875518 139957271160256 session_manager.py:500] Running local_init_op.
I0814 16:34:24.900290 139957271160256 session_manager.py:502] Done running local_init_op.
I0814 16:34:24.953341 139957271160256 tpu_estimator.py:557] Init TPU system
I0814 16:34:36.417017 139957271160256 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:34:36.418025 139956371310336 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:34:36.418858 139956362917632 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:34:36.484708 139957271160256 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:34:36.512917 139957271160256 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:34:36.513293 139957271160256 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:34:36.611262 139956005631744 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:34:36.713479 139956005631744 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:34:37.304500 139956362917632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:34:37.613789 139957271160256 evaluation.py:167] Evaluation [10/10]
I0814 16:34:37.614175 139957271160256 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:34:37.614250 139957271160256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:34:37.614531 139956371310336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:34:37.614821 139956371310336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:34:37.615014 139957271160256 error_handling.py:96] infeed marked as finished
I0814 16:34:37.615185 139957271160256 tpu_estimator.py:602] Stop output thread controller
I0814 16:34:37.615236 139957271160256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:34:37.615539 139956362917632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:34:37.615742 139956362917632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:34:37.615910 139957271160256 error_handling.py:96] outfeed marked as finished
I0814 16:34:37.616039 139957271160256 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:35:06.812582 139957271160256 evaluation.py:275] Finished evaluation at 2019-08-14-16:35:06
I0814 16:35:06.812913 139957271160256 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9357, global_step = 30, loss = 0.23616552
I0814 16:35:11.589915 139957271160256 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:35:12.437944 139957271160256 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.23616552, 'global_step': 30, 'accuracy': 0.9357}

Removing gs://yangyou-mnist/log/#1565800399128432...
Removing gs://yangyou-mnist/log/checkpoint#1565800448119420...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800399.v3-8-tpu#1565800451362048...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800403810195...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800410678361...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800444948475...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800416930070...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800411610812...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800445884107...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800450345949...
Removing gs://yangyou-mnist/log/eval/#1565800508742590...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800508.v3-8-tpu#1565800512132652...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:35:17.343458 140291257906624 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:35:17.344250 140291257906624 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:35:17.346837 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:35:17.347646 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:35:17.348213 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:35:17.348335 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:35:17.764842 140291257906624 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:35:17.771919 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:35:17.776097 140291257906624 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:35:17.831631 140291257906624 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:35:17.831932 140291257906624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:35:17.943519 140291257906624 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:35:18.064387 140291257906624 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:35:18.064762 140291257906624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:35:18.155823 140291257906624 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f97f4c10190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f97f6def210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:35:18.156188 140291257906624 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:35:18.475754 140291257906624 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:35:18.478685: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:35:18.490978 140291257906624 tpu_system_metadata.py:148] Found TPU system:
I0814 16:35:18.491293 140291257906624 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:35:18.492039 140291257906624 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:35:18.492163 140291257906624 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:35:18.492257 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:35:18.492877 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:35:18.492959 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:35:18.493031 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:35:18.493086 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:35:18.493134 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:35:18.493180 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:35:18.493227 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:35:18.493273 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:35:18.493338 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:35:18.493387 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:35:18.499747 140291257906624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:35:18.512140 140291257906624 estimator.py:1145] Calling model_fn.
W0814 16:35:18.512813 140291257906624 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:35:18.830687 140291257906624 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:35:19.350553 140291257906624 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:35:19.412497 140291257906624 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:35:19.418570 140291257906624 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:35:19.599117 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:35:19.612762 140291257906624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:35:19.624860 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:35:19.625943 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:35:19.633061 140291257906624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:35:19.638272 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:35:19.638493 140291257906624 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:35:19.650871 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:35:19.759995 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:35:19.800887 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:19.845340 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:19.895821 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.063416 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.113212 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.162009 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.212369 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.259166 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.300532 140291257906624 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:35:20.316612 140291257906624 estimator.py:1147] Done calling model_fn.
I0814 16:35:23.694284 140291257906624 tpu_estimator.py:499] TPU job name worker
I0814 16:35:23.804678 140291257906624 monitored_session.py:240] Graph was finalized.
I0814 16:35:24.511368 140291257906624 session_manager.py:500] Running local_init_op.
I0814 16:35:24.561284 140291257906624 session_manager.py:502] Done running local_init_op.
I0814 16:35:27.342081 140291257906624 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:35:39.870667 140291257906624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:35:40.038300 140291257906624 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:35:40.038737 140291257906624 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:35:40.039100: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:35:40.044153 140291257906624 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:35:40.046268 140291257906624 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:35:40.050107 140291257906624 tpu_estimator.py:557] Init TPU system
I0814 16:35:50.952131 140291257906624 tpu_estimator.py:566] Initialized TPU in 10 seconds
I0814 16:35:50.953016 140290495850240 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:35:50.953484 140290487457536 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:35:51.016660 140290006447872 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:35:51.017426 140291257906624 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:35:51.018661 140291257906624 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:35:51.105914 140290006447872 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:35:55.716172 140290487457536 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:36:00.326618 140291257906624 basic_session_run_hooks.py:262] loss = 0.1457841, step = 30
I0814 16:36:00.329220 140291257906624 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:36:13.583126 140291257906624 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:36:13.583457 140291257906624 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:36:13.583698 140290495850240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:36:13.583808 140290495850240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:36:13.583950 140291257906624 error_handling.py:96] infeed marked as finished
I0814 16:36:13.584038 140291257906624 tpu_estimator.py:602] Stop output thread controller
I0814 16:36:13.584086 140291257906624 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:36:13.584206 140290487457536 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:36:13.584278 140290487457536 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:36:13.584393 140291257906624 error_handling.py:96] outfeed marked as finished
I0814 16:36:13.584523 140291257906624 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:36:21.249121 140291257906624 estimator.py:368] Loss for final step: 0.1457841.
I0814 16:36:21.249953 140291257906624 error_handling.py:96] training_loop marked as finished
I0814 16:36:22.044281 140291257906624 estimator.py:1145] Calling model_fn.
E0814 16:36:22.782507 140291257906624 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:36:23.010406 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:36:23.035718 140291257906624 estimator.py:1147] Done calling model_fn.
I0814 16:36:23.052053 140291257906624 evaluation.py:255] Starting evaluation at 2019-08-14T16:36:23Z
I0814 16:36:23.052304 140291257906624 tpu_estimator.py:499] TPU job name worker
I0814 16:36:23.128056 140291257906624 monitored_session.py:240] Graph was finalized.
W0814 16:36:23.128909 140291257906624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:36:23.321285 140291257906624 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:36:25.988981 140291257906624 session_manager.py:500] Running local_init_op.
I0814 16:36:26.019553 140291257906624 session_manager.py:502] Done running local_init_op.
I0814 16:36:26.078659 140291257906624 tpu_estimator.py:557] Init TPU system
I0814 16:36:37.691621 140291257906624 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:36:37.692703 140290492180224 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:36:37.693528 140290006447872 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:36:37.761662 140291257906624 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:36:37.787470 140291257906624 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:36:37.787921 140291257906624 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:36:37.825781 140289998055168 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:36:38.003818 140289998055168 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:36:38.554018 140290006447872 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:36:39.081974 140291257906624 evaluation.py:167] Evaluation [10/10]
I0814 16:36:39.082333 140291257906624 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:36:39.082413 140291257906624 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:36:39.082653 140290492180224 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:36:39.082946 140290492180224 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:36:39.083153 140291257906624 error_handling.py:96] infeed marked as finished
I0814 16:36:39.083403 140291257906624 tpu_estimator.py:602] Stop output thread controller
I0814 16:36:39.083471 140291257906624 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:36:39.083671 140290006447872 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:36:39.083863 140290006447872 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:36:39.084048 140291257906624 error_handling.py:96] outfeed marked as finished
I0814 16:36:39.084193 140291257906624 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:37:08.100241 140291257906624 evaluation.py:275] Finished evaluation at 2019-08-14-16:37:08
I0814 16:37:08.100698 140291257906624 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9644, global_step = 30, loss = 0.12450703
I0814 16:37:12.245843 140291257906624 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:37:13.031465 140291257906624 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12450703, 'global_step': 30, 'accuracy': 0.9644}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800534808773...
Removing gs://yangyou-mnist/log/#1565800521866088...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800539345160...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800566935545...
Removing gs://yangyou-mnist/log/checkpoint#1565800569981751...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800522.v3-8-tpu#1565800573278411...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800526746376...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800567804005...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800533853470...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800572194988...
Removing gs://yangyou-mnist/log/eval/#1565800629743711...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800629.v3-8-tpu#1565800632720658...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:37:16.814965 139906964026816 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:37:16.816098 139906964026816 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:37:16.818686 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:37:16.819489 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:37:16.820080 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:37:16.820209 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:37:17.236471 139906964026816 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:37:17.244129 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:37:17.248647 139906964026816 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:37:17.370218 139906964026816 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:37:17.370526 139906964026816 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:37:17.524817 139906964026816 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:37:17.575846 139906964026816 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:37:17.576133 139906964026816 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:37:17.731390 139906964026816 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3e7b0dc110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3e7d2bb210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:37:17.731782 139906964026816 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:37:18.069947 139906964026816 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:37:18.072888: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:37:18.085201 139906964026816 tpu_system_metadata.py:148] Found TPU system:
I0814 16:37:18.085438 139906964026816 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:37:18.085921 139906964026816 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:37:18.085977 139906964026816 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:37:18.086029 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:37:18.086467 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:37:18.086524 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:37:18.086580 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:37:18.086627 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:37:18.086673 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:37:18.086719 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:37:18.086769 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:37:18.086813 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:37:18.086858 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:37:18.086905 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:37:18.093007 139906964026816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:37:18.105701 139906964026816 estimator.py:1145] Calling model_fn.
W0814 16:37:18.106333 139906964026816 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:37:18.377254 139906964026816 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:37:19.006583 139906964026816 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:37:19.069361 139906964026816 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:37:19.075459 139906964026816 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:37:19.274034 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:37:19.288217 139906964026816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:37:19.300596 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:37:19.301687 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:37:19.308967 139906964026816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:37:19.314690 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:37:19.314912 139906964026816 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:37:19.327955 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:37:19.441229 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:37:19.483655 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.529257 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.581258 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.750492 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.801631 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.851561 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.902739 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.950047 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.991780 139906964026816 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:37:20.007767 139906964026816 estimator.py:1147] Done calling model_fn.
I0814 16:37:23.411695 139906964026816 tpu_estimator.py:499] TPU job name worker
I0814 16:37:23.518867 139906964026816 monitored_session.py:240] Graph was finalized.
I0814 16:37:24.176702 139906964026816 session_manager.py:500] Running local_init_op.
I0814 16:37:24.223767 139906964026816 session_manager.py:502] Done running local_init_op.
I0814 16:37:26.975837 139906964026816 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:37:39.429331 139906964026816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:37:39.593708 139906964026816 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:37:39.594137 139906964026816 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:37:39.594610: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:37:39.599384 139906964026816 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:37:39.601583 139906964026816 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:37:39.605633 139906964026816 tpu_estimator.py:557] Init TPU system
I0814 16:37:51.610738 139906964026816 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:37:51.611557 139906059851520 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:37:51.612054 139906051458816 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:37:51.675384 139906964026816 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:37:51.677242 139906964026816 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:37:51.683280 139906043066112 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:37:51.796824 139906043066112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:37:56.373105 139906051458816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:38:00.804056 139906964026816 basic_session_run_hooks.py:262] loss = 0.21638884, step = 30
I0814 16:38:00.806601 139906964026816 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:38:13.907135 139906964026816 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:38:13.907493 139906964026816 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:38:13.907733 139906059851520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:38:13.907840 139906059851520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:38:13.908003 139906964026816 error_handling.py:96] infeed marked as finished
I0814 16:38:13.908103 139906964026816 tpu_estimator.py:602] Stop output thread controller
I0814 16:38:13.908153 139906964026816 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:38:13.908276 139906051458816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:38:13.908349 139906051458816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:38:13.908504 139906964026816 error_handling.py:96] outfeed marked as finished
I0814 16:38:13.908593 139906964026816 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:38:21.942331 139906964026816 estimator.py:368] Loss for final step: 0.21638884.
I0814 16:38:21.943106 139906964026816 error_handling.py:96] training_loop marked as finished
I0814 16:38:22.639136 139906964026816 estimator.py:1145] Calling model_fn.
E0814 16:38:23.362131 139906964026816 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:38:23.586662 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:38:23.607678 139906964026816 estimator.py:1147] Done calling model_fn.
I0814 16:38:23.624541 139906964026816 evaluation.py:255] Starting evaluation at 2019-08-14T16:38:23Z
I0814 16:38:23.624794 139906964026816 tpu_estimator.py:499] TPU job name worker
I0814 16:38:23.703768 139906964026816 monitored_session.py:240] Graph was finalized.
W0814 16:38:23.704539 139906964026816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:38:23.888813 139906964026816 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:38:26.749784 139906964026816 session_manager.py:500] Running local_init_op.
I0814 16:38:26.777087 139906964026816 session_manager.py:502] Done running local_init_op.
I0814 16:38:26.836671 139906964026816 tpu_estimator.py:557] Init TPU system
I0814 16:38:38.515608 139906964026816 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:38:38.516845 139906059851520 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:38:38.517904 139906051458816 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:38:38.586823 139906964026816 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:38:38.612456 139906964026816 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:38:38.612823 139906964026816 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:38:38.652776 139906043066112 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:38:38.782982 139906043066112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:38:39.368088 139906051458816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:38:39.868568 139906964026816 evaluation.py:167] Evaluation [10/10]
I0814 16:38:39.868973 139906964026816 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:38:39.869045 139906964026816 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:38:39.869335 139906059851520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:38:39.869616 139906059851520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:38:39.869818 139906964026816 error_handling.py:96] infeed marked as finished
I0814 16:38:39.870008 139906964026816 tpu_estimator.py:602] Stop output thread controller
I0814 16:38:39.870059 139906964026816 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:38:39.870227 139906051458816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:38:39.870605 139906051458816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:38:39.870843 139906964026816 error_handling.py:96] outfeed marked as finished
I0814 16:38:39.871048 139906964026816 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:39:08.878767 139906964026816 evaluation.py:275] Finished evaluation at 2019-08-14-16:39:08
I0814 16:39:08.879141 139906964026816 estimator.py:2039] Saving dict for global step 30: accuracy = 0.948, global_step = 30, loss = 0.1803973
I0814 16:39:13.188888 139906964026816 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:39:14.045236 139906964026816 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.1803973, 'global_step': 30, 'accuracy': 0.948}

Removing gs://yangyou-mnist/log/#1565800641596782...
Removing gs://yangyou-mnist/log/checkpoint#1565800690546869...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800641.v3-8-tpu#1565800693607267...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800687392836...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800654447141...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800658924843...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800646402803...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800688345114...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800653602498...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800692706114...
Removing gs://yangyou-mnist/log/eval/#1565800750598159...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800750.v3-8-tpu#1565800753736196...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:39:17.947360 139989440460224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:39:17.948159 139989440460224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:39:17.950838 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:39:17.951669 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:39:17.952258 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:39:17.952384 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:39:18.371953 139989440460224 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:39:18.378926 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:39:18.382849 139989440460224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:39:18.439532 139989440460224 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:39:18.439845 139989440460224 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:39:18.621057 139989440460224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:39:18.678905 139989440460224 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:39:18.679202 139989440460224 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:39:18.783895 139989440460224 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f51af084290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f51b1263210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:39:18.784271 139989440460224 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:39:19.118506 139989440460224 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:39:19.121568: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:39:19.134013 139989440460224 tpu_system_metadata.py:148] Found TPU system:
I0814 16:39:19.134287 139989440460224 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:39:19.134790 139989440460224 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:39:19.134848 139989440460224 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:39:19.134901 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:39:19.135185 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:39:19.135241 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:39:19.135291 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:39:19.135339 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:39:19.135385 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:39:19.135432 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:39:19.135478 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:39:19.135524 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:39:19.135596 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:39:19.135646 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:39:19.141917 139989440460224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:39:19.154628 139989440460224 estimator.py:1145] Calling model_fn.
W0814 16:39:19.155239 139989440460224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:39:19.427932 139989440460224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:39:19.845011 139989440460224 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:39:19.906332 139989440460224 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:39:19.912447 139989440460224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:39:20.093874 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:39:20.107609 139989440460224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:39:20.119739 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:39:20.120840 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:39:20.127813 139989440460224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:39:20.133027 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:39:20.133239 139989440460224 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:39:20.145615 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:39:20.256217 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:39:20.298455 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.344008 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.396711 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.565512 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.616430 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.664926 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.714432 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.760171 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.801548 139989440460224 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:39:20.817823 139989440460224 estimator.py:1147] Done calling model_fn.
I0814 16:39:24.364638 139989440460224 tpu_estimator.py:499] TPU job name worker
I0814 16:39:24.476725 139989440460224 monitored_session.py:240] Graph was finalized.
I0814 16:39:25.180274 139989440460224 session_manager.py:500] Running local_init_op.
I0814 16:39:25.228243 139989440460224 session_manager.py:502] Done running local_init_op.
I0814 16:39:28.135675 139989440460224 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:39:40.479521 139989440460224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:39:40.624885 139989440460224 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:39:40.625341 139989440460224 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:39:40.625761: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:39:40.630987 139989440460224 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:39:40.633409 139989440460224 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:39:40.637629 139989440460224 tpu_estimator.py:557] Init TPU system
I0814 16:39:52.320724 139989440460224 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:39:52.321647 139988528252672 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:39:52.322191 139988519859968 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:39:52.386051 139988511467264 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:39:52.386698 139989440460224 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:39:52.387830 139989440460224 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:39:52.703769 139988511467264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:39:57.118777 139988519859968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:40:01.706190 139989440460224 basic_session_run_hooks.py:262] loss = 0.21905355, step = 30
I0814 16:40:01.708394 139989440460224 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:40:15.046529 139989440460224 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:40:15.046885 139989440460224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:40:15.047255 139988528252672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:40:15.047566 139988528252672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:40:15.047821 139989440460224 error_handling.py:96] infeed marked as finished
I0814 16:40:15.048053 139989440460224 tpu_estimator.py:602] Stop output thread controller
I0814 16:40:15.048131 139989440460224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:40:15.048356 139988519859968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:40:15.048801 139988519859968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:40:15.049042 139989440460224 error_handling.py:96] outfeed marked as finished
I0814 16:40:15.049243 139989440460224 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:40:22.847697 139989440460224 estimator.py:368] Loss for final step: 0.21905355.
I0814 16:40:22.848542 139989440460224 error_handling.py:96] training_loop marked as finished
I0814 16:40:23.630080 139989440460224 estimator.py:1145] Calling model_fn.
E0814 16:40:24.335448 139989440460224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:40:24.566750 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:40:24.588481 139989440460224 estimator.py:1147] Done calling model_fn.
I0814 16:40:24.607625 139989440460224 evaluation.py:255] Starting evaluation at 2019-08-14T16:40:24Z
I0814 16:40:24.607867 139989440460224 tpu_estimator.py:499] TPU job name worker
I0814 16:40:24.686202 139989440460224 monitored_session.py:240] Graph was finalized.
W0814 16:40:24.686939 139989440460224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:40:24.861737 139989440460224 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:40:27.433790 139989440460224 session_manager.py:500] Running local_init_op.
I0814 16:40:27.463653 139989440460224 session_manager.py:502] Done running local_init_op.
I0814 16:40:27.516678 139989440460224 tpu_estimator.py:557] Init TPU system
I0814 16:40:39.427920 139989440460224 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:40:39.428843 139988536645376 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:40:39.429327 139988528252672 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:40:39.496721 139989440460224 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:40:39.525317 139989440460224 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:40:39.525741 139989440460224 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:40:39.563008 139988519859968 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:40:39.807420 139988519859968 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:40:40.323262 139988528252672 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:40:40.645251 139989440460224 evaluation.py:167] Evaluation [10/10]
I0814 16:40:40.645606 139989440460224 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:40:40.645709 139989440460224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:40:40.645956 139988536645376 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:40:40.646059 139988536645376 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:40:40.646233 139989440460224 error_handling.py:96] infeed marked as finished
I0814 16:40:40.646333 139989440460224 tpu_estimator.py:602] Stop output thread controller
I0814 16:40:40.646406 139989440460224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:40:40.646528 139988528252672 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:40:40.646616 139988528252672 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:40:40.646740 139989440460224 error_handling.py:96] outfeed marked as finished
I0814 16:40:40.646837 139989440460224 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:41:09.907979 139989440460224 evaluation.py:275] Finished evaluation at 2019-08-14-16:41:09
I0814 16:41:09.908310 139989440460224 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9431, global_step = 30, loss = 0.20919731
I0814 16:41:14.202033 139989440460224 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:41:15.065156 139989440460224 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.20919731, 'global_step': 30, 'accuracy': 0.9431}

Removing gs://yangyou-mnist/log/#1565800762361162...
Removing gs://yangyou-mnist/log/checkpoint#1565800811551691...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800767431908...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800775426201...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800762.v3-8-tpu#1565800814739245...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800774540362...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800779966589...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800808459920...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800809335348...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800813822148...
Removing gs://yangyou-mnist/log/eval/#1565800871623944...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800871.v3-8-tpu#1565800874758021...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:41:18.887661 140148895217088 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:41:18.888591 140148895217088 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:41:18.891172 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:41:18.891985 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:41:18.892612 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:41:18.892755 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:41:19.307646 140148895217088 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:41:19.314842 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:41:19.318705 140148895217088 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:41:19.372314 140148895217088 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:41:19.372638 140148895217088 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:41:19.509579 140148895217088 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:41:19.624089 140148895217088 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:41:19.624382 140148895217088 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:41:19.737571 140148895217088 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f76cf46c090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f76d164b1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:41:19.737950 140148895217088 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:41:20.069498 140148895217088 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:41:20.072904: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:41:20.087330 140148895217088 tpu_system_metadata.py:148] Found TPU system:
I0814 16:41:20.087591 140148895217088 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:41:20.088155 140148895217088 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:41:20.088238 140148895217088 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:41:20.088296 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:41:20.088669 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:41:20.088839 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:41:20.088897 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:41:20.088949 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:41:20.088998 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:41:20.089045 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:41:20.089092 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:41:20.089138 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:41:20.089186 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:41:20.089235 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:41:20.095540 140148895217088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:41:20.108114 140148895217088 estimator.py:1145] Calling model_fn.
W0814 16:41:20.108779 140148895217088 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:41:20.384980 140148895217088 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:41:20.786030 140148895217088 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:41:20.845607 140148895217088 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:41:20.851167 140148895217088 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:41:21.023781 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:41:21.037074 140148895217088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:41:21.048816 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:41:21.049866 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:41:21.056740 140148895217088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:41:21.062021 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:41:21.062213 140148895217088 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:41:21.074348 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:41:21.188270 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:41:21.229257 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.273463 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.324645 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.489168 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.537904 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.585218 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.634099 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.678731 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.719417 140148895217088 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:41:21.735800 140148895217088 estimator.py:1147] Done calling model_fn.
I0814 16:41:25.300800 140148895217088 tpu_estimator.py:499] TPU job name worker
I0814 16:41:25.414066 140148895217088 monitored_session.py:240] Graph was finalized.
I0814 16:41:26.084491 140148895217088 session_manager.py:500] Running local_init_op.
I0814 16:41:26.131705 140148895217088 session_manager.py:502] Done running local_init_op.
I0814 16:41:28.806469 140148895217088 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:41:40.879371 140148895217088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:41:41.028065 140148895217088 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:41:41.028537 140148895217088 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:41:41.029002: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:41:41.034383 140148895217088 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:41:41.036907 140148895217088 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:41:41.041162 140148895217088 tpu_estimator.py:557] Init TPU system
I0814 16:41:53.173396 140148895217088 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:41:53.174328 140147853088512 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:41:53.174822 140147844695808 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:41:53.235894 140148895217088 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:41:53.237756 140148895217088 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:41:53.244303 140147836303104 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:41:53.449064 140147836303104 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:41:57.940253 140147844695808 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:42:02.672560 140148895217088 basic_session_run_hooks.py:262] loss = 2.3166442, step = 30
I0814 16:42:02.674905 140148895217088 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:42:16.249541 140148895217088 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:42:16.249871 140148895217088 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:42:16.250087 140147853088512 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:42:16.250194 140147853088512 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:42:16.250343 140148895217088 error_handling.py:96] infeed marked as finished
I0814 16:42:16.250451 140148895217088 tpu_estimator.py:602] Stop output thread controller
I0814 16:42:16.250499 140148895217088 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:42:16.250612 140147844695808 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:42:16.250689 140147844695808 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:42:16.250799 140148895217088 error_handling.py:96] outfeed marked as finished
I0814 16:42:16.250888 140148895217088 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:42:23.584991 140148895217088 estimator.py:368] Loss for final step: 2.3166442.
I0814 16:42:23.585819 140148895217088 error_handling.py:96] training_loop marked as finished
I0814 16:42:24.397262 140148895217088 estimator.py:1145] Calling model_fn.
E0814 16:42:25.096049 140148895217088 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:42:25.316292 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:42:25.337553 140148895217088 estimator.py:1147] Done calling model_fn.
I0814 16:42:25.353954 140148895217088 evaluation.py:255] Starting evaluation at 2019-08-14T16:42:25Z
I0814 16:42:25.354197 140148895217088 tpu_estimator.py:499] TPU job name worker
I0814 16:42:25.431045 140148895217088 monitored_session.py:240] Graph was finalized.
W0814 16:42:25.431823 140148895217088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:42:25.617810 140148895217088 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:42:28.179415 140148895217088 session_manager.py:500] Running local_init_op.
I0814 16:42:28.209088 140148895217088 session_manager.py:502] Done running local_init_op.
I0814 16:42:28.261264 140148895217088 tpu_estimator.py:557] Init TPU system
I0814 16:42:40.319976 140148895217088 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:42:40.320960 140147860956928 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:42:40.321554 140147852564224 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:42:40.399771 140148895217088 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:42:40.424065 140148895217088 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:42:40.424524 140148895217088 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:42:40.464627 140147844171520 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:42:40.579420 140147844171520 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:42:41.199297 140147852564224 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:42:41.630342 140148895217088 evaluation.py:167] Evaluation [10/10]
I0814 16:42:41.630702 140148895217088 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:42:41.630770 140148895217088 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:42:41.631093 140147860956928 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:42:41.631400 140147860956928 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:42:41.631628 140148895217088 error_handling.py:96] infeed marked as finished
I0814 16:42:41.631789 140148895217088 tpu_estimator.py:602] Stop output thread controller
I0814 16:42:41.631851 140148895217088 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:42:41.632066 140147852564224 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:42:41.632262 140147852564224 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:42:41.632486 140148895217088 error_handling.py:96] outfeed marked as finished
I0814 16:42:41.632669 140148895217088 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:43:10.678519 140148895217088 evaluation.py:275] Finished evaluation at 2019-08-14-16:43:10
I0814 16:43:10.678930 140148895217088 estimator.py:2039] Saving dict for global step 30: accuracy = 0.101, global_step = 30, loss = 2.299601
I0814 16:43:14.950356 140148895217088 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:43:15.851397 140148895217088 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.299601, 'global_step': 30, 'accuracy': 0.101}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800895920799...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800900364905...
Removing gs://yangyou-mnist/log/checkpoint#1565800932812306...
Removing gs://yangyou-mnist/log/#1565800883360708...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800930490254...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800883.v3-8-tpu#1565800935942105...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800929648474...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800895111838...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800888216733...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800934972211...
Removing gs://yangyou-mnist/log/eval/#1565800992378294...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800992.v3-8-tpu#1565800995541697...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:43:19.628268 139705891243456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:43:19.629231 139705891243456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:43:19.631954 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:43:19.632824 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:43:19.633445 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:43:19.633577 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:43:20.049814 139705891243456 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:43:20.056802 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:43:20.060458 139705891243456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:43:20.115866 139705891243456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:43:20.116157 139705891243456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:43:20.239794 139705891243456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:43:20.363864 139705891243456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:43:20.364155 139705891243456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:43:20.534954 139705891243456 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0faa2e9110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0fac4c81d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:43:20.535307 139705891243456 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:43:20.864000 139705891243456 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:43:20.867062: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:43:20.878998 139705891243456 tpu_system_metadata.py:148] Found TPU system:
I0814 16:43:20.879265 139705891243456 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:43:20.879746 139705891243456 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:43:20.879802 139705891243456 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:43:20.879862 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:43:20.880150 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:43:20.880208 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:43:20.880258 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:43:20.880306 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:43:20.880353 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:43:20.880444 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:43:20.880515 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:43:20.880570 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:43:20.880619 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:43:20.880667 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:43:20.886511 139705891243456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:43:20.899009 139705891243456 estimator.py:1145] Calling model_fn.
W0814 16:43:20.899629 139705891243456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:43:21.173182 139705891243456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:43:21.683298 139705891243456 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:43:21.744720 139705891243456 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:43:21.750649 139705891243456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:43:21.927547 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:43:21.941212 139705891243456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:43:21.953532 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:43:21.954590 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:43:21.961750 139705891243456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:43:21.966965 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:43:21.967199 139705891243456 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:43:21.979739 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:43:22.089863 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:43:22.130743 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.174202 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.225193 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.387980 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.438760 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.487613 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.537817 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.583772 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.625823 139705891243456 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:43:22.641999 139705891243456 estimator.py:1147] Done calling model_fn.
I0814 16:43:26.008063 139705891243456 tpu_estimator.py:499] TPU job name worker
I0814 16:43:26.119736 139705891243456 monitored_session.py:240] Graph was finalized.
I0814 16:43:26.814243 139705891243456 session_manager.py:500] Running local_init_op.
I0814 16:43:26.861532 139705891243456 session_manager.py:502] Done running local_init_op.
I0814 16:43:29.502362 139705891243456 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:43:41.782440 139705891243456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:43:41.923603 139705891243456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:43:41.924158 139705891243456 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:43:41.924618: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:43:41.929882 139705891243456 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:43:41.932172 139705891243456 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:43:41.935883 139705891243456 tpu_estimator.py:557] Init TPU system
I0814 16:43:53.683883 139705891243456 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:43:53.684912 139704995141376 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:43:53.685307 139704986748672 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:43:53.755774 139705891243456 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:43:53.757323 139705891243456 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:43:53.759375 139704978355968 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:43:53.953646 139704978355968 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:43:58.466970 139704986748672 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:44:03.232526 139705891243456 basic_session_run_hooks.py:262] loss = 38844.582, step = 30
I0814 16:44:03.235419 139705891243456 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:44:16.623104 139705891243456 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:44:16.623418 139705891243456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:44:16.623739 139704995141376 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:44:16.623877 139704995141376 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:44:16.624056 139705891243456 error_handling.py:96] infeed marked as finished
I0814 16:44:16.624175 139705891243456 tpu_estimator.py:602] Stop output thread controller
I0814 16:44:16.624233 139705891243456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:44:16.624387 139704986748672 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:44:16.624527 139704986748672 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:44:16.624675 139705891243456 error_handling.py:96] outfeed marked as finished
I0814 16:44:16.624779 139705891243456 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:44:24.070473 139705891243456 estimator.py:368] Loss for final step: 38844.582.
I0814 16:44:24.071274 139705891243456 error_handling.py:96] training_loop marked as finished
I0814 16:44:24.773125 139705891243456 estimator.py:1145] Calling model_fn.
E0814 16:44:25.523696 139705891243456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:44:25.763849 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:44:25.787168 139705891243456 estimator.py:1147] Done calling model_fn.
I0814 16:44:25.804284 139705891243456 evaluation.py:255] Starting evaluation at 2019-08-14T16:44:25Z
I0814 16:44:25.804549 139705891243456 tpu_estimator.py:499] TPU job name worker
I0814 16:44:25.886648 139705891243456 monitored_session.py:240] Graph was finalized.
W0814 16:44:25.887420 139705891243456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:44:26.075992 139705891243456 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:44:28.691868 139705891243456 session_manager.py:500] Running local_init_op.
I0814 16:44:28.722311 139705891243456 session_manager.py:502] Done running local_init_op.
I0814 16:44:28.775171 139705891243456 tpu_estimator.py:557] Init TPU system
I0814 16:44:40.681623 139705891243456 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:44:40.682447 139704983078656 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:44:40.682874 139704969701120 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:44:40.757157 139705891243456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:44:40.787599 139705891243456 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:44:40.787988 139705891243456 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:44:40.829078 139704961308416 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:44:40.935726 139704961308416 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:44:41.569370 139704969701120 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:44:42.027090 139705891243456 evaluation.py:167] Evaluation [10/10]
I0814 16:44:42.027543 139705891243456 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:44:42.028748 139705891243456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:44:42.029007 139704983078656 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:44:42.029190 139704983078656 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:44:42.029391 139705891243456 error_handling.py:96] infeed marked as finished
I0814 16:44:42.029496 139705891243456 tpu_estimator.py:602] Stop output thread controller
I0814 16:44:42.029722 139705891243456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:44:42.029977 139704969701120 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:44:42.030147 139704969701120 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:44:42.030488 139705891243456 error_handling.py:96] outfeed marked as finished
I0814 16:44:42.030600 139705891243456 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:45:11.033981 139705891243456 evaluation.py:275] Finished evaluation at 2019-08-14-16:45:11
I0814 16:45:11.034557 139705891243456 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0958, global_step = 30, loss = 1003.3215
I0814 16:45:16.056474 139705891243456 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:45:16.843075 139705891243456 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1003.3215, 'global_step': 30, 'accuracy': 0.0958}

Removing gs://yangyou-mnist/log/#1565801004177449...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801016792767...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801021267926...
Removing gs://yangyou-mnist/log/checkpoint#1565801052990671...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801004.v3-8-tpu#1565801056306089...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801008898602...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801015953455...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801050770879...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801049866940...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801055352442...
Removing gs://yangyou-mnist/log/eval/#1565801113382150...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801113.v3-8-tpu#1565801116531807...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:45:20.634767 140140622910912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:45:20.635545 140140622910912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:45:20.638154 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:45:20.638987 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:45:20.639559 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:45:20.639691 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:45:21.047993 140140622910912 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:45:21.056382 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:45:21.060476 140140622910912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:45:21.114886 140140622910912 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:45:21.115176 140140622910912 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:45:21.314317 140140622910912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:45:21.371978 140140622910912 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:45:21.372277 140140622910912 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:45:21.490618 140140622910912 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f74e2356050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f74e45351d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:45:21.490958 140140622910912 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:45:21.820153 140140622910912 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:45:21.822969: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:45:21.836097 140140622910912 tpu_system_metadata.py:148] Found TPU system:
I0814 16:45:21.836354 140140622910912 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:45:21.836918 140140622910912 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:45:21.836977 140140622910912 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:45:21.837042 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:45:21.837333 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:45:21.837389 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:45:21.837440 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:45:21.837487 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:45:21.837534 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:45:21.837590 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:45:21.837637 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:45:21.837701 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:45:21.837759 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:45:21.837807 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:45:21.843924 140140622910912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:45:21.856614 140140622910912 estimator.py:1145] Calling model_fn.
W0814 16:45:21.857217 140140622910912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:45:22.133596 140140622910912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:45:22.600014 140140622910912 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:45:22.662786 140140622910912 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:45:22.668826 140140622910912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:45:22.854351 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:45:22.868269 140140622910912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:45:22.880778 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:45:22.881920 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:45:22.889414 140140622910912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:45:22.894723 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:45:22.894942 140140622910912 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:45:22.907798 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:45:23.019262 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:45:23.061780 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.115325 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.167144 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.337740 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.388324 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.438462 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.489842 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.536333 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.578120 140140622910912 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:45:23.594384 140140622910912 estimator.py:1147] Done calling model_fn.
I0814 16:45:26.991699 140140622910912 tpu_estimator.py:499] TPU job name worker
I0814 16:45:27.114047 140140622910912 monitored_session.py:240] Graph was finalized.
I0814 16:45:27.833199 140140622910912 session_manager.py:500] Running local_init_op.
I0814 16:45:27.894649 140140622910912 session_manager.py:502] Done running local_init_op.
I0814 16:45:30.806354 140140622910912 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:45:43.222059 140140622910912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:45:43.362984 140140622910912 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:45:43.363414 140140622910912 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:45:43.363806: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:45:43.368901 140140622910912 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:45:43.371057 140140622910912 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:45:43.375472 140140622910912 tpu_estimator.py:557] Init TPU system
I0814 16:45:55.314527 140140622910912 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:45:55.315499 140139718231808 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:45:55.316385 140139709839104 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:45:55.381546 140139701446400 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:45:55.384866 140140622910912 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:45:55.386045 140140622910912 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:45:55.498373 140139701446400 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:46:00.147661 140139709839104 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:46:04.722394 140140622910912 basic_session_run_hooks.py:262] loss = 83.401024, step = 30
I0814 16:46:04.724811 140140622910912 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:46:17.928092 140140622910912 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:46:17.928455 140140622910912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:46:17.928674 140139718231808 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:46:17.928775 140139718231808 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:46:17.928913 140140622910912 error_handling.py:96] infeed marked as finished
I0814 16:46:17.929003 140140622910912 tpu_estimator.py:602] Stop output thread controller
I0814 16:46:17.929059 140140622910912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:46:17.929172 140139709839104 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:46:17.929244 140139709839104 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:46:17.929357 140140622910912 error_handling.py:96] outfeed marked as finished
I0814 16:46:17.929438 140140622910912 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:46:25.646167 140140622910912 estimator.py:368] Loss for final step: 83.401024.
I0814 16:46:25.646915 140140622910912 error_handling.py:96] training_loop marked as finished
I0814 16:46:26.506934 140140622910912 estimator.py:1145] Calling model_fn.
E0814 16:46:27.241230 140140622910912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:46:27.472292 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:46:27.494394 140140622910912 estimator.py:1147] Done calling model_fn.
I0814 16:46:27.511538 140140622910912 evaluation.py:255] Starting evaluation at 2019-08-14T16:46:27Z
I0814 16:46:27.511789 140140622910912 tpu_estimator.py:499] TPU job name worker
I0814 16:46:27.594044 140140622910912 monitored_session.py:240] Graph was finalized.
W0814 16:46:27.594811 140140622910912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:46:27.765079 140140622910912 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:46:30.423245 140140622910912 session_manager.py:500] Running local_init_op.
I0814 16:46:30.448335 140140622910912 session_manager.py:502] Done running local_init_op.
I0814 16:46:30.496579 140140622910912 tpu_estimator.py:557] Init TPU system
I0814 16:46:42.049717 140140622910912 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:46:42.050632 140139718231808 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:46:42.051845 140139709839104 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:46:42.119071 140140622910912 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:46:42.144720 140140622910912 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:46:42.145068 140140622910912 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:46:42.184927 140139701446400 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:46:42.292392 140139701446400 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:46:42.936268 140139709839104 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:46:43.247150 140140622910912 evaluation.py:167] Evaluation [10/10]
I0814 16:46:43.247512 140140622910912 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:46:43.247590 140140622910912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:46:43.247787 140139718231808 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:46:43.247916 140139718231808 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:46:43.248076 140140622910912 error_handling.py:96] infeed marked as finished
I0814 16:46:43.248172 140140622910912 tpu_estimator.py:602] Stop output thread controller
I0814 16:46:43.248224 140140622910912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:46:43.248339 140139709839104 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:46:43.248476 140139709839104 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:46:43.248613 140140622910912 error_handling.py:96] outfeed marked as finished
I0814 16:46:43.248697 140140622910912 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:47:12.389045 140140622910912 evaluation.py:275] Finished evaluation at 2019-08-14-16:47:12
I0814 16:47:12.389410 140140622910912 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 71.01515
I0814 16:47:16.807614 140140622910912 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:47:17.575392 140140622910912 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 71.01515, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801138273982...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801125.v3-8-tpu#1565801177639355...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801142763992...
Removing gs://yangyou-mnist/log/#1565801125142314...
Removing gs://yangyou-mnist/log/checkpoint#1565801174396616...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801130202481...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801171524374...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801172321649...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801137394592...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801176725668...
Removing gs://yangyou-mnist/log/eval/#1565801234110445...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801234.v3-8-tpu#1565801237269013...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:47:21.446849 140400706733504 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:47:21.447644 140400706733504 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:47:21.450293 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:47:21.451142 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:47:21.451766 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:47:21.451898 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:47:21.872173 140400706733504 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:47:21.880351 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:47:21.884835 140400706733504 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:47:21.938730 140400706733504 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:47:21.939018 140400706733504 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:47:22.048970 140400706733504 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:47:22.103183 140400706733504 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:47:22.103485 140400706733504 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:47:22.234117 140400706733504 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb170682290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb1728781d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:47:22.234482 140400706733504 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:47:22.572779 140400706733504 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:47:22.575905: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:47:22.588345 140400706733504 tpu_system_metadata.py:148] Found TPU system:
I0814 16:47:22.588630 140400706733504 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:47:22.589150 140400706733504 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:47:22.589207 140400706733504 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:47:22.589291 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:47:22.589593 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:47:22.589652 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:47:22.589701 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:47:22.589759 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:47:22.589806 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:47:22.589853 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:47:22.589899 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:47:22.589945 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:47:22.589989 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:47:22.590037 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:47:22.596298 140400706733504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:47:22.609194 140400706733504 estimator.py:1145] Calling model_fn.
W0814 16:47:22.609838 140400706733504 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:47:22.889158 140400706733504 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:47:23.435411 140400706733504 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:47:23.498176 140400706733504 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:47:23.504200 140400706733504 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:47:23.690145 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:47:23.704240 140400706733504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:47:23.716883 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:47:23.717978 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:47:23.725122 140400706733504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:47:23.730449 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:47:23.730686 140400706733504 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:47:23.743386 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:47:23.857454 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:47:23.900722 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:23.946355 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:23.998684 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.176690 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.228859 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.280040 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.331511 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.378695 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.421471 140400706733504 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:47:24.437975 140400706733504 estimator.py:1147] Done calling model_fn.
I0814 16:47:27.896281 140400706733504 tpu_estimator.py:499] TPU job name worker
I0814 16:47:28.011476 140400706733504 monitored_session.py:240] Graph was finalized.
I0814 16:47:28.686532 140400706733504 session_manager.py:500] Running local_init_op.
I0814 16:47:28.734508 140400706733504 session_manager.py:502] Done running local_init_op.
I0814 16:47:31.297661 140400706733504 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:47:43.536839 140400706733504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:47:43.697454 140400706733504 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:47:43.697885 140400706733504 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:47:43.698273: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:47:43.703655 140400706733504 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:47:43.705969 140400706733504 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:47:43.710517 140400706733504 tpu_estimator.py:557] Init TPU system
I0814 16:47:55.823875 140400706733504 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:47:55.824899 140400011962112 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:47:55.825813 140399528113920 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:47:55.891305 140400706733504 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:47:55.892766 140400706733504 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:47:55.899529 140399519721216 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:47:56.104876 140399519721216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:48:00.687114 140399528113920 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:48:05.230817 140400706733504 basic_session_run_hooks.py:262] loss = 1676.7081, step = 30
I0814 16:48:05.233562 140400706733504 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:48:18.733438 140400706733504 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:48:18.733776 140400706733504 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:48:18.734122 140400011962112 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:48:18.734441 140400011962112 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:48:18.734666 140400706733504 error_handling.py:96] infeed marked as finished
I0814 16:48:18.734858 140400706733504 tpu_estimator.py:602] Stop output thread controller
I0814 16:48:18.734947 140400706733504 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:48:18.735166 140399528113920 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:48:18.735358 140399528113920 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:48:18.735547 140400706733504 error_handling.py:96] outfeed marked as finished
I0814 16:48:18.735721 140400706733504 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:48:26.239108 140400706733504 estimator.py:368] Loss for final step: 1676.7081.
I0814 16:48:26.240005 140400706733504 error_handling.py:96] training_loop marked as finished
I0814 16:48:26.936870 140400706733504 estimator.py:1145] Calling model_fn.
E0814 16:48:27.624489 140400706733504 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:48:27.850240 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:48:27.872267 140400706733504 estimator.py:1147] Done calling model_fn.
I0814 16:48:27.889286 140400706733504 evaluation.py:255] Starting evaluation at 2019-08-14T16:48:27Z
I0814 16:48:27.889523 140400706733504 tpu_estimator.py:499] TPU job name worker
I0814 16:48:27.968146 140400706733504 monitored_session.py:240] Graph was finalized.
W0814 16:48:27.968899 140400706733504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:48:28.155097 140400706733504 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:48:30.714253 140400706733504 session_manager.py:500] Running local_init_op.
I0814 16:48:30.746159 140400706733504 session_manager.py:502] Done running local_init_op.
I0814 16:48:30.798259 140400706733504 tpu_estimator.py:557] Init TPU system
I0814 16:48:42.630115 140400706733504 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:48:42.631551 140399528113920 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:48:42.632345 140399519721216 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:48:42.699493 140400706733504 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:48:42.725150 140400706733504 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:48:42.725483 140400706733504 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:48:42.763618 140399511328512 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:48:42.880242 140399511328512 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:48:43.464993 140399519721216 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:48:43.919456 140400706733504 evaluation.py:167] Evaluation [10/10]
I0814 16:48:43.919846 140400706733504 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:48:43.919948 140400706733504 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:48:43.920197 140399528113920 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:48:43.920495 140399528113920 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:48:43.920686 140400706733504 error_handling.py:96] infeed marked as finished
I0814 16:48:43.920850 140400706733504 tpu_estimator.py:602] Stop output thread controller
I0814 16:48:43.920908 140400706733504 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:48:43.921101 140399519721216 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:48:43.921288 140399519721216 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:48:43.921495 140400706733504 error_handling.py:96] outfeed marked as finished
I0814 16:48:43.921672 140400706733504 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:49:12.967879 140400706733504 evaluation.py:275] Finished evaluation at 2019-08-14-16:49:12
I0814 16:49:12.968224 140400706733504 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0892, global_step = 30, loss = 2227.2463
I0814 16:49:17.368952 140400706733504 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:49:18.164891 140400706733504 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2227.2463, 'global_step': 30, 'accuracy': 0.0892}

Removing gs://yangyou-mnist/log/#1565801246050298...
Removing gs://yangyou-mnist/log/checkpoint#1565801295200749...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801246.v3-8-tpu#1565801298416839...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801250718012...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801257881912...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801258690221...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801263020570...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801292072847...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801292927519...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801297464479...
Removing gs://yangyou-mnist/log/eval/#1565801354667752...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801354.v3-8-tpu#1565801357858989...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:49:22.041059 140052065547712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:49:22.041853 140052065547712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:49:22.044485 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:49:22.045381 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:49:22.046025 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:49:22.046158 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:49:22.478959 140052065547712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:49:22.488785 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:49:22.493418 140052065547712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:49:22.550146 140052065547712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:49:22.550580 140052065547712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:49:22.692751 140052065547712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:49:22.746792 140052065547712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:49:22.747081 140052065547712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:49:22.870920 140052065547712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f6043c74190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f6045e531d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:49:22.871357 140052065547712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:49:23.212240 140052065547712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:49:23.215587: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:49:23.229629 140052065547712 tpu_system_metadata.py:148] Found TPU system:
I0814 16:49:23.229902 140052065547712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:49:23.230521 140052065547712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:49:23.230581 140052065547712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:49:23.230642 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:49:23.230956 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:49:23.231015 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:49:23.231066 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:49:23.231115 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:49:23.231162 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:49:23.231209 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:49:23.231254 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:49:23.231301 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:49:23.231347 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:49:23.231396 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:49:23.237807 140052065547712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:49:23.251187 140052065547712 estimator.py:1145] Calling model_fn.
W0814 16:49:23.251857 140052065547712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:49:23.522481 140052065547712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:49:23.953263 140052065547712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:49:24.018369 140052065547712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:49:24.024627 140052065547712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:49:24.215303 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:49:24.229455 140052065547712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:49:24.242117 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:49:24.243211 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:49:24.250597 140052065547712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:49:24.255928 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:49:24.256141 140052065547712 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:49:24.268811 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:49:24.381058 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:49:24.422956 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.467631 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.520093 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.688766 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.739775 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.788378 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.839504 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.886657 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.930689 140052065547712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:49:24.947844 140052065547712 estimator.py:1147] Done calling model_fn.
I0814 16:49:28.391633 140052065547712 tpu_estimator.py:499] TPU job name worker
I0814 16:49:28.502816 140052065547712 monitored_session.py:240] Graph was finalized.
I0814 16:49:29.158584 140052065547712 session_manager.py:500] Running local_init_op.
I0814 16:49:29.203386 140052065547712 session_manager.py:502] Done running local_init_op.
I0814 16:49:31.904994 140052065547712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:49:44.994255 140052065547712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:49:45.138523 140052065547712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:49:45.139044 140052065547712 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:49:45.139467: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:49:45.145153 140052065547712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:49:45.147469 140052065547712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:49:45.151516 140052065547712 tpu_estimator.py:557] Init TPU system
I0814 16:49:56.852452 140052065547712 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:49:56.853602 140051031783168 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:49:56.854446 140051023390464 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:49:56.915435 140051014997760 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:49:56.918128 140052065547712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:49:56.919404 140052065547712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:49:57.006973 140051014997760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:50:01.693600 140051023390464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:50:06.321156 140052065547712 basic_session_run_hooks.py:262] loss = 71237.4, step = 30
I0814 16:50:06.323703 140052065547712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:50:19.749134 140052065547712 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:50:19.749448 140052065547712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:50:19.749752 140051031783168 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:50:19.750036 140051031783168 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:50:19.750293 140052065547712 error_handling.py:96] infeed marked as finished
I0814 16:50:19.750505 140052065547712 tpu_estimator.py:602] Stop output thread controller
I0814 16:50:19.750566 140052065547712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:50:19.750849 140051023390464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:50:19.751049 140051023390464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:50:19.751240 140052065547712 error_handling.py:96] outfeed marked as finished
I0814 16:50:19.751414 140052065547712 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:50:27.152544 140052065547712 estimator.py:368] Loss for final step: 71237.4.
I0814 16:50:27.153422 140052065547712 error_handling.py:96] training_loop marked as finished
I0814 16:50:27.923320 140052065547712 estimator.py:1145] Calling model_fn.
E0814 16:50:28.633466 140052065547712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:50:28.860601 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:50:28.882051 140052065547712 estimator.py:1147] Done calling model_fn.
I0814 16:50:28.899363 140052065547712 evaluation.py:255] Starting evaluation at 2019-08-14T16:50:28Z
I0814 16:50:28.899585 140052065547712 tpu_estimator.py:499] TPU job name worker
I0814 16:50:28.979566 140052065547712 monitored_session.py:240] Graph was finalized.
W0814 16:50:28.980276 140052065547712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:50:29.166491 140052065547712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:50:31.933495 140052065547712 session_manager.py:500] Running local_init_op.
I0814 16:50:31.958470 140052065547712 session_manager.py:502] Done running local_init_op.
I0814 16:50:32.017311 140052065547712 tpu_estimator.py:557] Init TPU system
I0814 16:50:43.525819 140052065547712 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:50:43.526933 140051031258880 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:50:43.527808 140051022866176 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:50:43.596682 140052065547712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:50:43.626560 140052065547712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:50:43.626930 140052065547712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:50:43.664582 140051014473472 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:50:43.851767 140051014473472 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:50:44.451097 140051022866176 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:50:44.710196 140052065547712 evaluation.py:167] Evaluation [10/10]
I0814 16:50:44.710635 140052065547712 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:50:44.710710 140052065547712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:50:44.710916 140051031258880 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:50:44.711020 140051031258880 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:50:44.711153 140052065547712 error_handling.py:96] infeed marked as finished
I0814 16:50:44.711257 140052065547712 tpu_estimator.py:602] Stop output thread controller
I0814 16:50:44.711311 140052065547712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:50:44.711421 140051022866176 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:50:44.711492 140051022866176 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:50:44.711611 140052065547712 error_handling.py:96] outfeed marked as finished
I0814 16:50:44.711689 140052065547712 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:51:13.939280 140052065547712 evaluation.py:275] Finished evaluation at 2019-08-14-16:51:13
I0814 16:51:13.939657 140052065547712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0974, global_step = 30, loss = 53146.273
I0814 16:51:18.510503 140052065547712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:51:19.463485 140052065547712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 53146.273, 'global_step': 30, 'accuracy': 0.0974}

Removing gs://yangyou-mnist/log/#1565801366411383...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801379000433...
Removing gs://yangyou-mnist/log/checkpoint#1565801416138470...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801366.v3-8-tpu#1565801419443914...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801384483363...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801413071860...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801371317570...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801413967296...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801378129419...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801418456558...
Removing gs://yangyou-mnist/log/eval/#1565801475634603...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801475.v3-8-tpu#1565801479035049...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:51:23.305118 140568902079936 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:51:23.305926 140568902079936 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:51:23.308563 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:51:23.309401 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:51:23.310002 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:51:23.310132 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:51:23.730638 140568902079936 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:51:23.738105 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:51:23.742372 140568902079936 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:51:23.864466 140568902079936 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:51:23.864799 140568902079936 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:51:23.988291 140568902079936 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:51:24.105911 140568902079936 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:51:24.106199 140568902079936 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:51:24.277194 140568902079936 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd899a2e110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd89bc0d1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:51:24.277535 140568902079936 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:51:24.603656 140568902079936 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:51:24.606646: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:51:24.620310 140568902079936 tpu_system_metadata.py:148] Found TPU system:
I0814 16:51:24.620600 140568902079936 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:51:24.621093 140568902079936 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:51:24.621153 140568902079936 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:51:24.621211 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:51:24.621510 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:51:24.621572 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:51:24.621623 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:51:24.621671 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:51:24.621718 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:51:24.621766 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:51:24.621828 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:51:24.621875 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:51:24.621922 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:51:24.621968 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:51:24.628211 140568902079936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:51:24.641472 140568902079936 estimator.py:1145] Calling model_fn.
W0814 16:51:24.642101 140568902079936 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:51:24.911665 140568902079936 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:51:25.334816 140568902079936 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:51:25.397965 140568902079936 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:51:25.404077 140568902079936 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:51:25.591293 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:51:25.605961 140568902079936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:51:25.618725 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:51:25.619817 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:51:25.627027 140568902079936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:51:25.632390 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:51:25.632661 140568902079936 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:51:25.645661 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:51:25.758272 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:51:25.800616 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:25.846633 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:25.899514 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.066577 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.117929 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.167510 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.219607 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.267512 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.310194 140568902079936 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:51:26.326852 140568902079936 estimator.py:1147] Done calling model_fn.
I0814 16:51:29.855087 140568902079936 tpu_estimator.py:499] TPU job name worker
I0814 16:51:29.969283 140568902079936 monitored_session.py:240] Graph was finalized.
I0814 16:51:30.621442 140568902079936 session_manager.py:500] Running local_init_op.
I0814 16:51:30.669084 140568902079936 session_manager.py:502] Done running local_init_op.
I0814 16:51:33.289458 140568902079936 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:51:45.769840 140568902079936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:51:45.926323 140568902079936 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:51:45.926745 140568902079936 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:51:45.927171: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:51:45.931972 140568902079936 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:51:45.934077 140568902079936 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:51:45.938735 140568902079936 tpu_estimator.py:557] Init TPU system
I0814 16:51:57.803494 140568902079936 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:51:57.804647 140568005953280 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:51:57.805548 140567997560576 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:51:57.871166 140568902079936 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:51:57.872046 140568902079936 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:51:57.945234 140567989167872 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:51:58.082292 140567989167872 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:52:02.749183 140567997560576 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:52:07.047986 140568902079936 basic_session_run_hooks.py:262] loss = 115351.086, step = 30
I0814 16:52:07.050539 140568902079936 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:52:20.841732 140568902079936 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:52:20.842089 140568902079936 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:52:20.843718 140568005953280 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:52:20.844016 140568005953280 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:52:20.844305 140568902079936 error_handling.py:96] infeed marked as finished
I0814 16:52:20.844604 140568902079936 tpu_estimator.py:602] Stop output thread controller
I0814 16:52:20.844675 140568902079936 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:52:20.844974 140567997560576 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:52:20.845175 140567997560576 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:52:20.845428 140568902079936 error_handling.py:96] outfeed marked as finished
I0814 16:52:20.845598 140568902079936 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:52:28.194668 140568902079936 estimator.py:368] Loss for final step: 115351.086.
I0814 16:52:28.195555 140568902079936 error_handling.py:96] training_loop marked as finished
I0814 16:52:28.990849 140568902079936 estimator.py:1145] Calling model_fn.
E0814 16:52:29.728632 140568902079936 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:52:29.958528 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:52:29.981347 140568902079936 estimator.py:1147] Done calling model_fn.
I0814 16:52:29.997829 140568902079936 evaluation.py:255] Starting evaluation at 2019-08-14T16:52:29Z
I0814 16:52:29.998064 140568902079936 tpu_estimator.py:499] TPU job name worker
I0814 16:52:30.078340 140568902079936 monitored_session.py:240] Graph was finalized.
W0814 16:52:30.079128 140568902079936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:52:30.265877 140568902079936 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:52:33.868067 140568902079936 session_manager.py:500] Running local_init_op.
I0814 16:52:33.892703 140568902079936 session_manager.py:502] Done running local_init_op.
I0814 16:52:33.947941 140568902079936 tpu_estimator.py:557] Init TPU system
I0814 16:52:45.235804 140568902079936 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:52:45.236763 140568002283264 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:52:45.237185 140567993890560 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:52:45.303673 140568902079936 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:52:45.329890 140568902079936 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:52:45.330248 140568902079936 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:52:45.366317 140567980513024 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:52:45.473627 140567980513024 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:52:46.115431 140567993890560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:52:46.509476 140568902079936 evaluation.py:167] Evaluation [10/10]
I0814 16:52:46.509896 140568902079936 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:52:46.509991 140568902079936 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:52:46.510194 140568002283264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:52:46.510298 140568002283264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:52:46.510521 140568902079936 error_handling.py:96] infeed marked as finished
I0814 16:52:46.510631 140568902079936 tpu_estimator.py:602] Stop output thread controller
I0814 16:52:46.510689 140568902079936 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:52:46.510798 140567993890560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:52:46.510879 140567993890560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:52:46.510993 140568902079936 error_handling.py:96] outfeed marked as finished
I0814 16:52:46.511070 140568902079936 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:53:15.573955 140568902079936 evaluation.py:275] Finished evaluation at 2019-08-14-16:53:15
I0814 16:53:15.574290 140568902079936 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 83268.73
I0814 16:53:19.947120 140568902079936 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:53:20.887361 140568902079936 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 83268.73, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/#1565801487870351...
Removing gs://yangyou-mnist/log/checkpoint#1565801537023451...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801533878837...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801500843641...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801488.v3-8-tpu#1565801540531939...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801505256668...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801492709271...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801534721530...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801499885608...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801539519351...
Removing gs://yangyou-mnist/log/eval/#1565801597244462...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801597.v3-8-tpu#1565801600571704...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:53:24.792735 140383681017280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:53:24.793535 140383681017280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:53:24.796118 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:53:24.796993 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:53:24.797601 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:53:24.797729 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:53:25.231339 140383681017280 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:53:25.239212 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:53:25.243405 140383681017280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:53:25.298985 140383681017280 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:53:25.299252 140383681017280 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:53:25.407341 140383681017280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:53:25.460679 140383681017280 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:53:25.460958 140383681017280 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:53:25.637618 140383681017280 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fad7999c090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fad7bb7b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:53:25.638005 140383681017280 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:53:25.969739 140383681017280 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:53:25.972976: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:53:25.987462 140383681017280 tpu_system_metadata.py:148] Found TPU system:
I0814 16:53:25.987709 140383681017280 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:53:25.988286 140383681017280 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:53:25.988346 140383681017280 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:53:25.988425 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:53:25.988821 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:53:25.988878 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:53:25.988930 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:53:25.988979 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:53:25.989026 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:53:25.989084 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:53:25.989131 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:53:25.989181 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:53:25.989229 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:53:25.989278 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:53:25.995400 140383681017280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:53:26.008057 140383681017280 estimator.py:1145] Calling model_fn.
W0814 16:53:26.008728 140383681017280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:53:26.296308 140383681017280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:53:26.712488 140383681017280 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:53:26.774641 140383681017280 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:53:26.780786 140383681017280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:53:26.963501 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:53:26.977211 140383681017280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:53:26.989408 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:53:26.990480 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:53:26.997420 140383681017280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:53:27.002621 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:53:27.002837 140383681017280 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 16:53:27.015346 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:53:27.125145 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:53:27.166362 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.210587 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.263556 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.431863 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.482589 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.531342 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.581677 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.627548 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.668843 140383681017280 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:53:27.685125 140383681017280 estimator.py:1147] Done calling model_fn.
I0814 16:53:31.157177 140383681017280 tpu_estimator.py:499] TPU job name worker
I0814 16:53:31.277435 140383681017280 monitored_session.py:240] Graph was finalized.
I0814 16:53:31.998920 140383681017280 session_manager.py:500] Running local_init_op.
I0814 16:53:32.049212 140383681017280 session_manager.py:502] Done running local_init_op.
I0814 16:53:35.118681 140383681017280 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:53:47.365119 140383681017280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:53:47.523297 140383681017280 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:53:47.523813 140383681017280 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:53:47.524233: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:53:47.529285 140383681017280 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:53:47.531625 140383681017280 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:53:47.535634 140383681017280 tpu_estimator.py:557] Init TPU system
I0814 16:53:59.166289 140383681017280 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:53:59.167201 140382776309504 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:53:59.167690 140382767916800 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:53:59.232702 140383681017280 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:53:59.234074 140383681017280 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:53:59.239451 140382759524096 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:53:59.344911 140382759524096 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:54:03.897690 140382767916800 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:54:08.592922 140383681017280 basic_session_run_hooks.py:262] loss = 2.1402035, step = 30
I0814 16:54:08.595289 140383681017280 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:54:21.942013 140383681017280 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:54:21.942305 140383681017280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:54:21.942542 140382776309504 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:54:21.942646 140382776309504 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:54:21.942780 140383681017280 error_handling.py:96] infeed marked as finished
I0814 16:54:21.942873 140383681017280 tpu_estimator.py:602] Stop output thread controller
I0814 16:54:21.942920 140383681017280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:54:21.943032 140382767916800 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:54:21.943105 140382767916800 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:54:21.943217 140383681017280 error_handling.py:96] outfeed marked as finished
I0814 16:54:21.943296 140383681017280 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:54:29.482610 140383681017280 estimator.py:368] Loss for final step: 2.1402035.
I0814 16:54:29.483401 140383681017280 error_handling.py:96] training_loop marked as finished
I0814 16:54:30.275368 140383681017280 estimator.py:1145] Calling model_fn.
E0814 16:54:31.088979 140383681017280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:54:31.320925 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:54:31.343482 140383681017280 estimator.py:1147] Done calling model_fn.
I0814 16:54:31.361084 140383681017280 evaluation.py:255] Starting evaluation at 2019-08-14T16:54:31Z
I0814 16:54:31.361341 140383681017280 tpu_estimator.py:499] TPU job name worker
I0814 16:54:31.442481 140383681017280 monitored_session.py:240] Graph was finalized.
W0814 16:54:31.443310 140383681017280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:54:31.649800 140383681017280 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:54:34.122704 140383681017280 session_manager.py:500] Running local_init_op.
I0814 16:54:34.148262 140383681017280 session_manager.py:502] Done running local_init_op.
I0814 16:54:34.203835 140383681017280 tpu_estimator.py:557] Init TPU system
I0814 16:54:46.080667 140383681017280 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:54:46.081928 140382776309504 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:54:46.082820 140382767916800 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:54:46.151648 140383681017280 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:54:46.180332 140383681017280 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:54:46.180813 140383681017280 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:54:46.288304 140382759524096 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:54:46.412986 140382759524096 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:54:46.976988 140382767916800 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:54:47.259898 140383681017280 evaluation.py:167] Evaluation [10/10]
I0814 16:54:47.260288 140383681017280 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:54:47.260379 140383681017280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:54:47.260715 140382776309504 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:54:47.261001 140382776309504 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:54:47.261245 140383681017280 error_handling.py:96] infeed marked as finished
I0814 16:54:47.261441 140383681017280 tpu_estimator.py:602] Stop output thread controller
I0814 16:54:47.261584 140383681017280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:54:47.261816 140382767916800 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:54:47.262017 140382767916800 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:54:47.262233 140383681017280 error_handling.py:96] outfeed marked as finished
I0814 16:54:47.262398 140383681017280 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:55:16.513804 140383681017280 evaluation.py:275] Finished evaluation at 2019-08-14-16:55:16
I0814 16:55:16.514162 140383681017280 estimator.py:2039] Saving dict for global step 30: accuracy = 0.5956, global_step = 30, loss = 2.1365159
I0814 16:55:20.765882 140383681017280 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:55:21.588284 140383681017280 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.1365159, 'global_step': 30, 'accuracy': 0.5956}

Removing gs://yangyou-mnist/log/#1565801609232262...
Removing gs://yangyou-mnist/log/checkpoint#1565801658520534...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801622477398...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801614533350...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801626818555...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801609.v3-8-tpu#1565801661625348...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801656410862...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801621586022...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801655602201...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801660696702...
Removing gs://yangyou-mnist/log/eval/#1565801718146289...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801718.v3-8-tpu#1565801721280430...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:55:25.441209 140497872299456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:55:25.441989 140497872299456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:55:25.444520 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:55:25.445312 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:55:25.445864 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:55:25.445987 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:55:25.861330 140497872299456 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:55:25.868091 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:55:25.871810 140497872299456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:55:25.926321 140497872299456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:55:25.926592 140497872299456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:55:26.041368 140497872299456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:55:26.097101 140497872299456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:55:26.097366 140497872299456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:55:26.204292 140497872299456 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc80fed0450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc8120c6210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:55:26.204715 140497872299456 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:55:26.525854 140497872299456 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:55:26.528646: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:55:26.540793 140497872299456 tpu_system_metadata.py:148] Found TPU system:
I0814 16:55:26.541030 140497872299456 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:55:26.541520 140497872299456 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:55:26.541579 140497872299456 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:55:26.541630 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:55:26.541934 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:55:26.541990 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:55:26.542047 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:55:26.542098 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:55:26.542145 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:55:26.542191 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:55:26.542237 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:55:26.542282 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:55:26.542326 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:55:26.542372 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:55:26.548168 140497872299456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:55:26.560355 140497872299456 estimator.py:1145] Calling model_fn.
W0814 16:55:26.561012 140497872299456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:55:26.834249 140497872299456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:55:27.281938 140497872299456 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:55:27.343012 140497872299456 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:55:27.349045 140497872299456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:55:27.527225 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:55:27.541107 140497872299456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:55:27.553246 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:55:27.554317 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:55:27.561564 140497872299456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:55:27.566898 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:55:27.567127 140497872299456 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 16:55:27.579988 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:55:27.690454 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:55:27.731286 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:27.775486 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:27.826077 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:27.986923 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:28.037307 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:28.085103 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:28.136224 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:28.181442 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:28.222723 140497872299456 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:55:28.238986 140497872299456 estimator.py:1147] Done calling model_fn.
I0814 16:55:31.620394 140497872299456 tpu_estimator.py:499] TPU job name worker
I0814 16:55:31.728564 140497872299456 monitored_session.py:240] Graph was finalized.
I0814 16:55:32.376312 140497872299456 session_manager.py:500] Running local_init_op.
I0814 16:55:32.423013 140497872299456 session_manager.py:502] Done running local_init_op.
I0814 16:55:35.967885 140497872299456 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:55:48.200680 140497872299456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:55:48.344666 140497872299456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:55:48.345124 140497872299456 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:55:48.345510: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:55:48.350439 140497872299456 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:55:48.352467 140497872299456 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:55:48.357286 140497872299456 tpu_estimator.py:557] Init TPU system
I0814 16:56:00.076384 140497872299456 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:56:00.077239 140496827574016 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:56:00.077718 140496819181312 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:56:00.142261 140497872299456 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:56:00.143748 140497872299456 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:56:00.145162 140496810788608 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:56:00.328438 140496810788608 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:56:04.860644 140496819181312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:56:09.152607 140497872299456 basic_session_run_hooks.py:262] loss = 1.9048946, step = 30
I0814 16:56:09.155145 140497872299456 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:56:22.171336 140497872299456 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:56:22.171622 140497872299456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:56:22.171840 140496827574016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:56:22.171952 140496827574016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:56:22.172092 140497872299456 error_handling.py:96] infeed marked as finished
I0814 16:56:22.172190 140497872299456 tpu_estimator.py:602] Stop output thread controller
I0814 16:56:22.172239 140497872299456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:56:22.172350 140496819181312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:56:22.172475 140496819181312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:56:22.172621 140497872299456 error_handling.py:96] outfeed marked as finished
I0814 16:56:22.172712 140497872299456 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:56:30.465734 140497872299456 estimator.py:368] Loss for final step: 1.9048946.
I0814 16:56:30.466665 140497872299456 error_handling.py:96] training_loop marked as finished
I0814 16:56:31.257411 140497872299456 estimator.py:1145] Calling model_fn.
E0814 16:56:31.972181 140497872299456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:56:32.203732 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:56:32.226886 140497872299456 estimator.py:1147] Done calling model_fn.
I0814 16:56:32.244384 140497872299456 evaluation.py:255] Starting evaluation at 2019-08-14T16:56:32Z
I0814 16:56:32.244754 140497872299456 tpu_estimator.py:499] TPU job name worker
I0814 16:56:32.323998 140497872299456 monitored_session.py:240] Graph was finalized.
W0814 16:56:32.324769 140497872299456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:56:32.505785 140497872299456 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:56:35.165374 140497872299456 session_manager.py:500] Running local_init_op.
I0814 16:56:35.195203 140497872299456 session_manager.py:502] Done running local_init_op.
I0814 16:56:35.240972 140497872299456 tpu_estimator.py:557] Init TPU system
I0814 16:56:47.052746 140497872299456 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:56:47.053613 140496835966720 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:56:47.054152 140496827574016 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:56:47.122179 140497872299456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:56:47.147422 140497872299456 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:56:47.147749 140497872299456 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:56:47.177381 140496819181312 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:56:47.299253 140496819181312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:56:47.925409 140496827574016 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:56:48.256516 140497872299456 evaluation.py:167] Evaluation [10/10]
I0814 16:56:48.256922 140497872299456 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:56:48.257013 140497872299456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:56:48.257188 140496835966720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:56:48.257294 140496835966720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:56:48.257431 140497872299456 error_handling.py:96] infeed marked as finished
I0814 16:56:48.257522 140497872299456 tpu_estimator.py:602] Stop output thread controller
I0814 16:56:48.257575 140497872299456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:56:48.257760 140496827574016 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:56:48.257879 140496827574016 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:56:48.258004 140497872299456 error_handling.py:96] outfeed marked as finished
I0814 16:56:48.258086 140497872299456 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:57:17.394304 140497872299456 evaluation.py:275] Finished evaluation at 2019-08-14-16:57:17
I0814 16:57:17.394622 140497872299456 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7467, global_step = 30, loss = 1.8920475
I0814 16:57:21.677419 140497872299456 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:57:22.481165 140497872299456 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.8920475, 'global_step': 30, 'accuracy': 0.7467}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801742988981...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801747657072...
Removing gs://yangyou-mnist/log/#1565801729788850...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801729.v3-8-tpu#1565801781866687...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801775736444...
Removing gs://yangyou-mnist/log/checkpoint#1565801778760464...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801735373129...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801776534370...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801742119012...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801780923077...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801839.v3-8-tpu#1565801842173506...
Removing gs://yangyou-mnist/log/eval/#1565801839071875...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:57:27.256669 140688732861888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:57:27.257462 140688732861888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:57:27.260024 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:57:27.261316 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:57:27.261939 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:57:27.262079 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:57:27.682370 140688732861888 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:57:27.689810 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:57:27.694470 140688732861888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:57:27.752513 140688732861888 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:57:27.752815 140688732861888 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:57:27.942851 140688732861888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:57:27.985528 140688732861888 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:57:27.985837 140688732861888 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:57:28.165596 140688732861888 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff4801a1610>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff482397210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:57:28.165982 140688732861888 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:57:28.500958 140688732861888 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:57:28.503962: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:57:28.517429 140688732861888 tpu_system_metadata.py:148] Found TPU system:
I0814 16:57:28.517671 140688732861888 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:57:28.518171 140688732861888 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:57:28.518234 140688732861888 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:57:28.518287 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:57:28.518575 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:57:28.518634 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:57:28.518683 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:57:28.518733 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:57:28.518796 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:57:28.518845 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:57:28.518891 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:57:28.518937 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:57:28.518984 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:57:28.519035 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:57:28.525238 140688732861888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:57:28.537921 140688732861888 estimator.py:1145] Calling model_fn.
W0814 16:57:28.538559 140688732861888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:57:28.817848 140688732861888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:57:29.238322 140688732861888 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:57:29.309422 140688732861888 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:57:29.315984 140688732861888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:57:29.501334 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:57:29.515331 140688732861888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:57:29.527865 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:57:29.529004 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:57:29.536173 140688732861888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:57:29.541567 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:57:29.541790 140688732861888 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 16:57:29.554687 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:57:29.665421 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:57:29.708652 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:29.753668 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:29.805094 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:29.972825 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:30.023889 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:30.072846 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:30.124386 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:30.171264 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:30.213650 140688732861888 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:57:30.230349 140688732861888 estimator.py:1147] Done calling model_fn.
I0814 16:57:33.493230 140688732861888 tpu_estimator.py:499] TPU job name worker
I0814 16:57:33.603982 140688732861888 monitored_session.py:240] Graph was finalized.
I0814 16:57:34.284243 140688732861888 session_manager.py:500] Running local_init_op.
I0814 16:57:34.342863 140688732861888 session_manager.py:502] Done running local_init_op.
I0814 16:57:37.035337 140688732861888 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:57:49.373789 140688732861888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:57:49.516052 140688732861888 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:57:49.516551 140688732861888 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:57:49.517095: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:57:49.523619 140688732861888 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:57:49.525955 140688732861888 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:57:49.530544 140688732861888 tpu_estimator.py:557] Init TPU system
I0814 16:58:04.080674 140688732861888 tpu_estimator.py:566] Initialized TPU in 14 seconds
I0814 16:58:04.081846 140687559358208 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:58:04.082631 140687550965504 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:58:04.148163 140688732861888 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:58:04.149142 140688732861888 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:58:04.198874 140687542572800 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:58:04.316035 140687542572800 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:58:08.854008 140687550965504 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:58:13.568273 140688732861888 basic_session_run_hooks.py:262] loss = 1.4816271, step = 30
I0814 16:58:13.571105 140688732861888 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:58:27.128334 140688732861888 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:58:27.128705 140688732861888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:58:27.128890 140687559358208 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:58:27.128992 140687559358208 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:58:27.129127 140688732861888 error_handling.py:96] infeed marked as finished
I0814 16:58:27.129216 140688732861888 tpu_estimator.py:602] Stop output thread controller
I0814 16:58:27.129266 140688732861888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:58:27.129375 140687550965504 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:58:27.129456 140687550965504 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:58:27.129565 140688732861888 error_handling.py:96] outfeed marked as finished
I0814 16:58:27.129647 140688732861888 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:58:34.466296 140688732861888 estimator.py:368] Loss for final step: 1.4816271.
I0814 16:58:34.467139 140688732861888 error_handling.py:96] training_loop marked as finished
I0814 16:58:35.255705 140688732861888 estimator.py:1145] Calling model_fn.
E0814 16:58:35.951736 140688732861888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:58:36.187741 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:58:36.210247 140688732861888 estimator.py:1147] Done calling model_fn.
I0814 16:58:36.229177 140688732861888 evaluation.py:255] Starting evaluation at 2019-08-14T16:58:36Z
I0814 16:58:36.229424 140688732861888 tpu_estimator.py:499] TPU job name worker
I0814 16:58:36.313575 140688732861888 monitored_session.py:240] Graph was finalized.
W0814 16:58:36.314326 140688732861888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:58:36.498368 140688732861888 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:58:39.240654 140688732861888 session_manager.py:500] Running local_init_op.
I0814 16:58:39.270512 140688732861888 session_manager.py:502] Done running local_init_op.
I0814 16:58:39.324062 140688732861888 tpu_estimator.py:557] Init TPU system
I0814 16:59:47.981028 140688732861888 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 16:59:47.982064 140687559358208 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:59:47.982799 140687550965504 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:59:48.082578 140688732861888 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:59:48.107841 140688732861888 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:59:48.108196 140688732861888 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:59:48.148453 140687542572800 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:59:48.264777 140687542572800 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:59:48.928708 140687550965504 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:59:49.226898 140688732861888 evaluation.py:167] Evaluation [10/10]
I0814 16:59:49.227255 140688732861888 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:59:49.227339 140688732861888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:59:49.227624 140687559358208 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:59:49.227888 140687559358208 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:59:49.228178 140688732861888 error_handling.py:96] infeed marked as finished
I0814 16:59:49.228395 140688732861888 tpu_estimator.py:602] Stop output thread controller
I0814 16:59:49.228492 140688732861888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:59:49.228682 140687550965504 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:59:49.228854 140687550965504 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:59:49.229074 140688732861888 error_handling.py:96] outfeed marked as finished
I0814 16:59:49.229244 140688732861888 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:00:18.361289 140688732861888 evaluation.py:275] Finished evaluation at 2019-08-14-17:00:18
I0814 17:00:18.361634 140688732861888 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7944, global_step = 30, loss = 1.4608225
I0814 17:00:22.713048 140688732861888 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:00:23.563783 140688732861888 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.4608225, 'global_step': 30, 'accuracy': 0.7944}

Removing gs://yangyou-mnist/log/#1565801851728881...
Removing gs://yangyou-mnist/log/checkpoint#1565801903597955...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801868862849...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801864604249...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801900321554...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801901161813...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801863750373...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801856456065...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801851.v3-8-tpu#1565801906827004...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801905876283...
Removing gs://yangyou-mnist/log/eval/#1565802020054190...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565802020.v3-8-tpu#1565802023197607...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:00:27.485354 139730227578304 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:00:27.486133 139730227578304 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:00:27.488804 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:00:27.489609 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:00:27.490174 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:00:27.490324 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:00:27.893548 139730227578304 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:00:27.900793 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:00:27.904776 139730227578304 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:00:27.960580 139730227578304 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:00:27.960856 139730227578304 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:00:28.065984 139730227578304 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:00:28.184269 139730227578304 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:00:28.184619 139730227578304 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:00:28.289793 139730227578304 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1554bd9150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1556db8210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:00:28.290142 139730227578304 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:00:28.609668 139730227578304 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:00:28.612664: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:00:28.625729 139730227578304 tpu_system_metadata.py:148] Found TPU system:
I0814 17:00:28.625955 139730227578304 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:00:28.626435 139730227578304 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:00:28.626497 139730227578304 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:00:28.626557 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:00:28.626867 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:00:28.626923 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:00:28.626972 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:00:28.627021 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:00:28.627070 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:00:28.627119 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:00:28.627166 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:00:28.627212 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:00:28.627258 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:00:28.627305 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:00:28.633212 139730227578304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:00:28.645472 139730227578304 estimator.py:1145] Calling model_fn.
W0814 17:00:28.646074 139730227578304 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:00:28.932342 139730227578304 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:00:29.347901 139730227578304 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:00:29.409866 139730227578304 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:00:29.416018 139730227578304 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:00:29.595463 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:00:29.609081 139730227578304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:00:29.621572 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:00:29.622606 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:00:29.629640 139730227578304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:00:29.634944 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:00:29.635160 139730227578304 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:00:29.647564 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:00:29.758445 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:00:29.799897 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:29.844110 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:29.896178 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.059950 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.110775 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.159548 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.210134 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.256114 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.300466 139730227578304 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:00:30.317451 139730227578304 estimator.py:1147] Done calling model_fn.
I0814 17:00:33.758816 139730227578304 tpu_estimator.py:499] TPU job name worker
I0814 17:00:33.871294 139730227578304 monitored_session.py:240] Graph was finalized.
I0814 17:00:34.537677 139730227578304 session_manager.py:500] Running local_init_op.
I0814 17:00:34.584908 139730227578304 session_manager.py:502] Done running local_init_op.
I0814 17:00:37.320750 139730227578304 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:00:50.027010 139730227578304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:00:50.167099 139730227578304 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:00:50.167577 139730227578304 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:00:50.168024: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:00:50.173830 139730227578304 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:00:50.176042 139730227578304 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:00:50.180038 139730227578304 tpu_estimator.py:557] Init TPU system
I0814 17:01:33.223598 139730227578304 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0814 17:01:33.224564 139729457092352 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:01:33.225179 139728976344832 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:01:33.298728 139730227578304 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:01:33.299906 139730227578304 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:01:33.310403 139728967952128 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:01:33.455982 139728967952128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:01:38.186568 139728976344832 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:01:42.918932 139730227578304 basic_session_run_hooks.py:262] loss = 0.96408373, step = 30
I0814 17:01:42.921492 139730227578304 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:01:56.401477 139730227578304 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:01:56.401834 139730227578304 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:01:56.403254 139729457092352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:01:56.403557 139729457092352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:01:56.403772 139730227578304 error_handling.py:96] infeed marked as finished
I0814 17:01:56.404007 139730227578304 tpu_estimator.py:602] Stop output thread controller
I0814 17:01:56.404073 139730227578304 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:01:56.404359 139728976344832 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:01:56.404570 139728976344832 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:01:56.404838 139730227578304 error_handling.py:96] outfeed marked as finished
I0814 17:01:56.405010 139730227578304 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:02:03.598409 139730227578304 estimator.py:368] Loss for final step: 0.96408373.
I0814 17:02:03.599303 139730227578304 error_handling.py:96] training_loop marked as finished
I0814 17:02:04.324347 139730227578304 estimator.py:1145] Calling model_fn.
E0814 17:02:05.014734 139730227578304 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:02:05.253493 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:02:05.275886 139730227578304 estimator.py:1147] Done calling model_fn.
I0814 17:02:05.292884 139730227578304 evaluation.py:255] Starting evaluation at 2019-08-14T17:02:05Z
I0814 17:02:05.293133 139730227578304 tpu_estimator.py:499] TPU job name worker
I0814 17:02:05.372026 139730227578304 monitored_session.py:240] Graph was finalized.
W0814 17:02:05.372868 139730227578304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:02:05.564785 139730227578304 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:02:08.143923 139730227578304 session_manager.py:500] Running local_init_op.
I0814 17:02:08.168703 139730227578304 session_manager.py:502] Done running local_init_op.
I0814 17:02:08.223021 139730227578304 tpu_estimator.py:557] Init TPU system
I0814 17:03:16.037003 139730227578304 tpu_estimator.py:566] Initialized TPU in 67 seconds
I0814 17:03:16.038110 139729457092352 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:03:16.039012 139728976344832 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:03:16.107378 139730227578304 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:03:16.132991 139730227578304 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:03:16.133368 139730227578304 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:03:16.162393 139728967952128 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:03:16.477562 139728967952128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:03:16.916219 139728976344832 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:03:17.300679 139730227578304 evaluation.py:167] Evaluation [10/10]
I0814 17:03:17.301084 139730227578304 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:03:17.301157 139730227578304 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:03:17.301461 139729457092352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:03:17.301745 139729457092352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:03:17.301955 139730227578304 error_handling.py:96] infeed marked as finished
I0814 17:03:17.302141 139730227578304 tpu_estimator.py:602] Stop output thread controller
I0814 17:03:17.302195 139730227578304 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:03:17.302366 139728976344832 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:03:17.302582 139728976344832 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:03:17.302764 139730227578304 error_handling.py:96] outfeed marked as finished
I0814 17:03:17.302908 139730227578304 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:03:46.561806 139730227578304 evaluation.py:275] Finished evaluation at 2019-08-14-17:03:46
I0814 17:03:46.562170 139730227578304 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8287, global_step = 30, loss = 0.9207134
I0814 17:03:50.825258 139730227578304 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:03:51.641634 139730227578304 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.9207134, 'global_step': 30, 'accuracy': 0.8287}

Removing gs://yangyou-mnist/log/#1565802031872169...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565802109487606...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565802045046721...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565802049484094...
Removing gs://yangyou-mnist/log/checkpoint#1565802112664688...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565802110377585...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565802032.v3-8-tpu#1565802116094728...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565802044199953...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565802036742222...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565802115150786...
Removing gs://yangyou-mnist/log/eval/#1565802228216932...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565802228.v3-8-tpu#1565802231326634...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:03:55.403925 140421252306368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:03:55.404772 140421252306368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:03:55.407396 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:03:55.408246 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:03:55.409033 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:03:55.409173 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:03:55.821697 140421252306368 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:03:55.830332 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:03:55.834440 140421252306368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:03:55.891433 140421252306368 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:03:55.891710 140421252306368 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:03:56.024672 140421252306368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:03:56.078352 140421252306368 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:03:56.078646 140421252306368 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:03:56.287662 140421252306368 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb6390622d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb63b241210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:03:56.288028 140421252306368 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:03:56.614146 140421252306368 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:03:56.617024: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:03:56.630192 140421252306368 tpu_system_metadata.py:148] Found TPU system:
I0814 17:03:56.630451 140421252306368 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:03:56.631031 140421252306368 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:03:56.631093 140421252306368 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:03:56.631148 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:03:56.631448 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:03:56.631505 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:03:56.631556 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:03:56.631613 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:03:56.631663 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:03:56.631710 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:03:56.631757 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:03:56.631804 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:03:56.631851 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:03:56.631900 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:03:56.638060 140421252306368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:03:56.650621 140421252306368 estimator.py:1145] Calling model_fn.
W0814 17:03:56.651279 140421252306368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:03:56.948177 140421252306368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:03:57.365710 140421252306368 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:03:57.428471 140421252306368 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:03:57.434562 140421252306368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:03:57.618441 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:03:57.632473 140421252306368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:03:57.645068 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:03:57.646167 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:03:57.653125 140421252306368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:03:57.658535 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:03:57.658760 140421252306368 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:03:57.671188 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:03:57.782726 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:03:57.825066 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:57.870121 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:57.922240 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.086350 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.138400 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.187479 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.238455 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.285469 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.327696 140421252306368 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:03:58.344228 140421252306368 estimator.py:1147] Done calling model_fn.
I0814 17:04:01.855125 140421252306368 tpu_estimator.py:499] TPU job name worker
I0814 17:04:01.970343 140421252306368 monitored_session.py:240] Graph was finalized.
I0814 17:04:02.704987 140421252306368 session_manager.py:500] Running local_init_op.
I0814 17:04:02.754853 140421252306368 session_manager.py:502] Done running local_init_op.
I0814 17:04:05.492604 140421252306368 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:04:18.040093 140421252306368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:04:18.181133 140421252306368 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:04:18.181612 140421252306368 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:04:18.182086: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:04:18.187202 140421252306368 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:04:18.189388 140421252306368 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:04:18.193540 140421252306368 tpu_estimator.py:557] Init TPU system
I0814 17:05:00.110631 140421252306368 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:05:00.111574 140420490180352 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:05:00.112056 140420481787648 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:05:00.172090 140419996317440 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:05:00.172837 140421252306368 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:05:00.174499 140421252306368 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:05:00.350337 140419996317440 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:05:04.993839 140420481787648 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:05:09.857790 140421252306368 basic_session_run_hooks.py:262] loss = 0.54357857, step = 30
I0814 17:05:09.860562 140421252306368 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:05:25.197037 140421252306368 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:05:25.197367 140421252306368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:05:25.197586 140420490180352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:05:25.197695 140420490180352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:05:25.197846 140421252306368 error_handling.py:96] infeed marked as finished
I0814 17:05:25.197953 140421252306368 tpu_estimator.py:602] Stop output thread controller
I0814 17:05:25.198013 140421252306368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:05:25.198148 140420481787648 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:05:25.198223 140420481787648 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:05:25.198338 140421252306368 error_handling.py:96] outfeed marked as finished
I0814 17:05:25.198417 140421252306368 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:05:30.482148 140421252306368 estimator.py:368] Loss for final step: 0.54357857.
I0814 17:05:30.483124 140421252306368 error_handling.py:96] training_loop marked as finished
I0814 17:05:31.260086 140421252306368 estimator.py:1145] Calling model_fn.
E0814 17:05:31.978066 140421252306368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:05:32.204037 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:05:32.225652 140421252306368 estimator.py:1147] Done calling model_fn.
I0814 17:05:32.241986 140421252306368 evaluation.py:255] Starting evaluation at 2019-08-14T17:05:32Z
I0814 17:05:32.242239 140421252306368 tpu_estimator.py:499] TPU job name worker
I0814 17:05:32.321507 140421252306368 monitored_session.py:240] Graph was finalized.
W0814 17:05:32.322299 140421252306368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:05:32.528239 140421252306368 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:05:35.279114 140421252306368 session_manager.py:500] Running local_init_op.
I0814 17:05:35.305438 140421252306368 session_manager.py:502] Done running local_init_op.
I0814 17:05:35.355272 140421252306368 tpu_estimator.py:557] Init TPU system
I0814 17:06:44.103483 140421252306368 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:06:44.104599 140420486510336 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:06:44.105086 140419996317440 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:06:44.173052 140421252306368 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:06:44.197448 140421252306368 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:06:44.197803 140421252306368 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:06:44.291934 140419987924736 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:06:44.520493 140419987924736 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:06:45.014193 140419996317440 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:06:45.329207 140421252306368 evaluation.py:167] Evaluation [10/10]
I0814 17:06:45.329540 140421252306368 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:06:45.329617 140421252306368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:06:45.329885 140420486510336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:06:45.329982 140420486510336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:06:45.330118 140421252306368 error_handling.py:96] infeed marked as finished
I0814 17:06:45.330214 140421252306368 tpu_estimator.py:602] Stop output thread controller
I0814 17:06:45.330280 140421252306368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:06:45.330393 140419996317440 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:06:45.330466 140419996317440 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:06:45.330583 140421252306368 error_handling.py:96] outfeed marked as finished
I0814 17:06:45.330696 140421252306368 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:07:14.611813 140421252306368 evaluation.py:275] Finished evaluation at 2019-08-14-17:07:14
I0814 17:07:14.612198 140421252306368 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8801, global_step = 30, loss = 0.50370854
I0814 17:07:18.826595 140421252306368 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:07:19.622123 140421252306368 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.50370854, 'global_step': 30, 'accuracy': 0.8801}

Removing gs://yangyou-mnist/log/#1565802239882846...
Removing gs://yangyou-mnist/log/checkpoint#1565802321748570...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565802240.v3-8-tpu#1565802324889175...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565802244920817...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565802252086855...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565802253013290...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565802257500034...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565802318242281...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565802319322193...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565802323913691...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565802436240474...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565802436.v3-8-tpu#1565802439324785...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:07:23.228228 139907471205824 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:07:23.229142 139907471205824 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:07:23.231734 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:07:23.232644 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:07:23.233261 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:07:23.233392 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:07:23.636337 139907471205824 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:07:23.643655 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:07:23.647737 139907471205824 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:07:23.767204 139907471205824 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:07:23.767487 139907471205824 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:07:23.883797 139907471205824 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:07:23.934264 139907471205824 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:07:23.934531 139907471205824 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:07:24.105953 139907471205824 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3e9948b150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3e9b66a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:07:24.106302 139907471205824 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:07:24.449430 139907471205824 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:07:24.452194: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:07:24.464282 139907471205824 tpu_system_metadata.py:148] Found TPU system:
I0814 17:07:24.464566 139907471205824 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:07:24.465035 139907471205824 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:07:24.465095 139907471205824 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:07:24.465147 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:07:24.465439 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:07:24.465493 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:07:24.465543 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:07:24.465619 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:07:24.465667 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:07:24.465723 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:07:24.465774 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:07:24.465820 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:07:24.465864 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:07:24.465912 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:07:24.471935 139907471205824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:07:24.483845 139907471205824 estimator.py:1145] Calling model_fn.
W0814 17:07:24.484464 139907471205824 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:07:24.750294 139907471205824 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:07:25.182238 139907471205824 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:07:25.244240 139907471205824 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:07:25.250242 139907471205824 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:07:25.432744 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:07:25.447144 139907471205824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:07:25.459486 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:07:25.460655 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:07:25.467861 139907471205824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:07:25.473211 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:07:25.473429 139907471205824 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:07:25.486049 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:07:25.595742 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:07:25.637257 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:25.681436 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:25.734714 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:25.895971 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:25.945431 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:25.993575 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:26.043243 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:26.088239 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:26.129601 139907471205824 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:07:26.145492 139907471205824 estimator.py:1147] Done calling model_fn.
I0814 17:07:29.567348 139907471205824 tpu_estimator.py:499] TPU job name worker
I0814 17:07:29.677918 139907471205824 monitored_session.py:240] Graph was finalized.
I0814 17:07:30.391627 139907471205824 session_manager.py:500] Running local_init_op.
I0814 17:07:30.452620 139907471205824 session_manager.py:502] Done running local_init_op.
I0814 17:07:33.835506 139907471205824 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:07:45.980592 139907471205824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:07:46.144332 139907471205824 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:07:46.144819 139907471205824 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:07:46.145234: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:07:46.150208 139907471205824 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:07:46.152875 139907471205824 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:07:46.157758 139907471205824 tpu_estimator.py:557] Init TPU system
I0814 17:08:28.121145 139907471205824 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:08:28.122042 139906709174016 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:08:28.122617 139906700781312 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:08:28.187484 139907471205824 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:08:28.188371 139907471205824 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:08:28.249284 139906692388608 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:08:28.432378 139906692388608 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:08:32.893049 139906700781312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:08:37.568593 139907471205824 basic_session_run_hooks.py:262] loss = 0.37476906, step = 30
I0814 17:08:37.571242 139907471205824 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:08:50.674580 139907471205824 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:08:50.674880 139907471205824 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:08:50.675086 139906709174016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:08:50.675194 139906709174016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:08:50.675338 139907471205824 error_handling.py:96] infeed marked as finished
I0814 17:08:50.675434 139907471205824 tpu_estimator.py:602] Stop output thread controller
I0814 17:08:50.675482 139907471205824 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:08:50.675590 139906700781312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:08:50.675673 139906700781312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:08:50.675796 139907471205824 error_handling.py:96] outfeed marked as finished
I0814 17:08:50.675873 139907471205824 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:08:58.570708 139907471205824 estimator.py:368] Loss for final step: 0.37476906.
I0814 17:08:58.571482 139907471205824 error_handling.py:96] training_loop marked as finished
I0814 17:08:59.243391 139907471205824 estimator.py:1145] Calling model_fn.
E0814 17:09:00.022573 139907471205824 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:09:00.260787 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:09:00.283252 139907471205824 estimator.py:1147] Done calling model_fn.
I0814 17:09:00.299886 139907471205824 evaluation.py:255] Starting evaluation at 2019-08-14T17:09:00Z
I0814 17:09:00.300138 139907471205824 tpu_estimator.py:499] TPU job name worker
I0814 17:09:00.382225 139907471205824 monitored_session.py:240] Graph was finalized.
W0814 17:09:00.383070 139907471205824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:09:00.568502 139907471205824 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:09:03.070804 139907471205824 session_manager.py:500] Running local_init_op.
I0814 17:09:03.095596 139907471205824 session_manager.py:502] Done running local_init_op.
I0814 17:09:03.143382 139907471205824 tpu_estimator.py:557] Init TPU system
I0814 17:10:12.115389 139907471205824 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:10:12.116533 139906705504000 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:10:12.117227 139906697111296 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:10:12.184189 139907471205824 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:10:12.209330 139907471205824 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:10:12.209762 139907471205824 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:10:12.250123 139906210854656 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:10:12.379838 139906210854656 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:10:13.000591 139906697111296 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:10:13.415128 139907471205824 evaluation.py:167] Evaluation [10/10]
I0814 17:10:13.415494 139907471205824 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:10:13.415568 139907471205824 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:10:13.415844 139906705504000 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:10:13.416115 139906705504000 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:10:13.416311 139907471205824 error_handling.py:96] infeed marked as finished
I0814 17:10:13.416559 139907471205824 tpu_estimator.py:602] Stop output thread controller
I0814 17:10:13.416618 139907471205824 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:10:13.416860 139906697111296 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:10:13.417017 139906697111296 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:10:13.417172 139907471205824 error_handling.py:96] outfeed marked as finished
I0814 17:10:13.417299 139907471205824 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:10:42.477709 139907471205824 evaluation.py:275] Finished evaluation at 2019-08-14-17:10:42
I0814 17:10:42.478072 139907471205824 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9088, global_step = 30, loss = 0.37200645
I0814 17:10:46.748213 139907471205824 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:10:47.544186 139907471205824 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.37200645, 'global_step': 30, 'accuracy': 0.9088}

Removing gs://yangyou-mnist/log/#1565802447659884...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565802447.v3-8-tpu#1565802530351993...
Removing gs://yangyou-mnist/log/checkpoint#1565802527155461...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565802453254472...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565802460279662...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565802461122412...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565802465462788...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565802524070018...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565802525021546...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565802529366401...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565802644.v3-8-tpu#1565802647235359...
Removing gs://yangyou-mnist/log/eval/#1565802644126283...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:10:51.334945 140189494261184 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:10:51.335779 140189494261184 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:10:51.338423 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:10:51.339251 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:10:51.339842 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:10:51.339970 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:10:51.744563 140189494261184 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:10:51.751255 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:10:51.755044 140189494261184 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:10:51.873960 140189494261184 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:10:51.874249 140189494261184 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:10:52.121611 140189494261184 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:10:52.176079 140189494261184 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:10:52.176376 140189494261184 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:10:52.311567 140189494261184 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f80432b0190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f804548f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:10:52.311950 140189494261184 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:10:52.666759 140189494261184 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:10:52.669893: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:10:52.682809 140189494261184 tpu_system_metadata.py:148] Found TPU system:
I0814 17:10:52.683043 140189494261184 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:10:52.683573 140189494261184 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:10:52.683640 140189494261184 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:10:52.683715 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:10:52.684022 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:10:52.684079 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:10:52.684133 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:10:52.684181 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:10:52.684230 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:10:52.684276 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:10:52.684323 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:10:52.684375 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:10:52.684478 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:10:52.684531 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:10:52.690610 140189494261184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:10:52.703402 140189494261184 estimator.py:1145] Calling model_fn.
W0814 17:10:52.703999 140189494261184 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:10:52.986718 140189494261184 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:10:53.430234 140189494261184 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:10:53.492274 140189494261184 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:10:53.498337 140189494261184 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:10:53.676189 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:10:53.690160 140189494261184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:10:53.702636 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:10:53.703756 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:10:53.710989 140189494261184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:10:53.716280 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:10:53.716536 140189494261184 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:10:53.729455 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:10:53.840665 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:10:53.881413 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:53.925611 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:53.976840 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.142777 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.192395 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.240817 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.291270 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.337512 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.378870 140189494261184 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:10:54.394983 140189494261184 estimator.py:1147] Done calling model_fn.
I0814 17:10:57.737667 140189494261184 tpu_estimator.py:499] TPU job name worker
I0814 17:10:57.847577 140189494261184 monitored_session.py:240] Graph was finalized.
I0814 17:10:58.546145 140189494261184 session_manager.py:500] Running local_init_op.
I0814 17:10:58.595479 140189494261184 session_manager.py:502] Done running local_init_op.
I0814 17:11:01.856662 140189494261184 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:11:13.846587 140189494261184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:11:14.003103 140189494261184 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:11:14.003530 140189494261184 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:11:14.003939: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:11:14.008977 140189494261184 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:11:14.011054 140189494261184 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:11:14.015108 140189494261184 tpu_estimator.py:557] Init TPU system
I0814 17:11:56.109111 140189494261184 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:11:56.110011 140188462343936 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:11:56.110538 140188453951232 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:11:56.170119 140188445558528 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:11:56.172060 140189494261184 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:11:56.173787 140189494261184 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:11:56.289376 140188445558528 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:12:00.871341 140188453951232 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:12:05.483587 140189494261184 basic_session_run_hooks.py:262] loss = 0.21683587, step = 30
I0814 17:12:05.485830 140189494261184 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:12:18.601636 140189494261184 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:12:18.601929 140189494261184 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:12:18.602184 140188462343936 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:12:18.602302 140188462343936 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:12:18.602443 140189494261184 error_handling.py:96] infeed marked as finished
I0814 17:12:18.602541 140189494261184 tpu_estimator.py:602] Stop output thread controller
I0814 17:12:18.602590 140189494261184 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:12:18.602703 140188453951232 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:12:18.602777 140188453951232 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:12:18.602899 140189494261184 error_handling.py:96] outfeed marked as finished
I0814 17:12:18.602986 140189494261184 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:12:26.432842 140189494261184 estimator.py:368] Loss for final step: 0.21683587.
I0814 17:12:26.433574 140189494261184 error_handling.py:96] training_loop marked as finished
I0814 17:12:27.124049 140189494261184 estimator.py:1145] Calling model_fn.
E0814 17:12:27.832734 140189494261184 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:12:28.062586 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:12:28.085311 140189494261184 estimator.py:1147] Done calling model_fn.
I0814 17:12:28.102283 140189494261184 evaluation.py:255] Starting evaluation at 2019-08-14T17:12:28Z
I0814 17:12:28.102534 140189494261184 tpu_estimator.py:499] TPU job name worker
I0814 17:12:28.181107 140189494261184 monitored_session.py:240] Graph was finalized.
W0814 17:12:28.181852 140189494261184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:12:28.366477 140189494261184 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:12:30.979939 140189494261184 session_manager.py:500] Running local_init_op.
I0814 17:12:31.004121 140189494261184 session_manager.py:502] Done running local_init_op.
I0814 17:12:31.057851 140189494261184 tpu_estimator.py:557] Init TPU system
I0814 17:13:40.052680 140189494261184 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:13:40.053525 140188459984640 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:13:40.053967 140188451591936 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:13:40.121182 140189494261184 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:13:40.145060 140189494261184 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:13:40.145441 140189494261184 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:13:40.184334 140188443199232 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:13:40.305330 140188443199232 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:13:40.887716 140188451591936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:13:41.347642 140189494261184 evaluation.py:167] Evaluation [10/10]
I0814 17:13:41.347971 140189494261184 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:13:41.348042 140189494261184 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:13:41.348315 140188459984640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:13:41.348479 140188459984640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:13:41.348630 140189494261184 error_handling.py:96] infeed marked as finished
I0814 17:13:41.348823 140189494261184 tpu_estimator.py:602] Stop output thread controller
I0814 17:13:41.348877 140189494261184 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:13:41.348995 140188451591936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:13:41.349070 140188451591936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:13:41.349185 140189494261184 error_handling.py:96] outfeed marked as finished
I0814 17:13:41.349270 140189494261184 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:14:10.403114 140189494261184 evaluation.py:275] Finished evaluation at 2019-08-14-17:14:10
I0814 17:14:10.403493 140189494261184 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9418, global_step = 30, loss = 0.21141449
I0814 17:14:14.914391 140189494261184 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:14:15.679527 140189494261184 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.21141449, 'global_step': 30, 'accuracy': 0.9418}

Removing gs://yangyou-mnist/log/#1565802655905811...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565802656.v3-8-tpu#1565802738298396...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565802673339509...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565802661284561...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565802732153624...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565802668902773...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565802668062398...
Removing gs://yangyou-mnist/log/checkpoint#1565802735144248...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565802732978317...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565802737333029...
Removing gs://yangyou-mnist/log/eval/#1565802852097700...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565802852.v3-8-tpu#1565802855372425...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:14:19.436542 140407842235840 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:14:19.437350 140407842235840 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:14:19.439929 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:14:19.440948 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:14:19.441572 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:14:19.441700 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:14:19.859945 140407842235840 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:14:19.867502 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:14:19.871437 140407842235840 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:14:19.925327 140407842235840 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:14:19.925865 140407842235840 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:14:20.105287 140407842235840 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:14:20.161925 140407842235840 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:14:20.162213 140407842235840 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:14:20.259083 140407842235840 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb319b74450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb31bd6a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:14:20.259435 140407842235840 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:14:20.585019 140407842235840 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:14:20.587924: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:14:20.600759 140407842235840 tpu_system_metadata.py:148] Found TPU system:
I0814 17:14:20.600999 140407842235840 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:14:20.601598 140407842235840 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:14:20.601660 140407842235840 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:14:20.601712 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:14:20.602001 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:14:20.602065 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:14:20.602125 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:14:20.602183 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:14:20.602230 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:14:20.602277 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:14:20.602323 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:14:20.602369 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:14:20.602417 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:14:20.602488 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:14:20.608571 140407842235840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:14:20.621129 140407842235840 estimator.py:1145] Calling model_fn.
W0814 17:14:20.621742 140407842235840 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:14:20.902228 140407842235840 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:14:21.342475 140407842235840 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:14:21.405261 140407842235840 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:14:21.411982 140407842235840 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:14:21.596045 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:14:21.610172 140407842235840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:14:21.622477 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:14:21.623557 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:14:21.630666 140407842235840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:14:21.635894 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:14:21.636113 140407842235840 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:14:21.648729 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:14:21.760164 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:14:21.802424 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:21.847819 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:21.900794 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.073051 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.122967 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.170690 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.220571 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.266180 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.307877 140407842235840 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:14:22.325164 140407842235840 estimator.py:1147] Done calling model_fn.
I0814 17:14:25.598550 140407842235840 tpu_estimator.py:499] TPU job name worker
I0814 17:14:25.707123 140407842235840 monitored_session.py:240] Graph was finalized.
I0814 17:14:26.391334 140407842235840 session_manager.py:500] Running local_init_op.
I0814 17:14:26.441165 140407842235840 session_manager.py:502] Done running local_init_op.
I0814 17:14:29.218322 140407842235840 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:14:41.224329 140407842235840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:14:41.382015 140407842235840 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:14:41.382545 140407842235840 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:14:41.382948: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:14:41.388192 140407842235840 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:14:41.390467 140407842235840 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:14:41.394869 140407842235840 tpu_estimator.py:557] Init TPU system
I0814 17:15:24.120263 140407842235840 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:15:24.121314 140406945990400 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:15:24.122018 140406937597696 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:15:24.186737 140406929204992 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:15:24.187576 140407842235840 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:15:24.189277 140407842235840 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:15:24.344846 140406929204992 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:15:28.874751 140406937597696 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:15:33.488372 140407842235840 basic_session_run_hooks.py:262] loss = 0.10975443, step = 30
I0814 17:15:33.491353 140407842235840 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:15:46.813872 140407842235840 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:15:46.814202 140407842235840 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:15:46.815644 140406945990400 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:15:46.815839 140406945990400 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:15:46.816009 140407842235840 error_handling.py:96] infeed marked as finished
I0814 17:15:46.816178 140407842235840 tpu_estimator.py:602] Stop output thread controller
I0814 17:15:46.816268 140407842235840 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:15:46.816394 140406937597696 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:15:46.816517 140406937597696 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:15:46.816725 140407842235840 error_handling.py:96] outfeed marked as finished
I0814 17:15:46.816823 140407842235840 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:15:54.490744 140407842235840 estimator.py:368] Loss for final step: 0.10975443.
I0814 17:15:54.491540 140407842235840 error_handling.py:96] training_loop marked as finished
I0814 17:15:55.180500 140407842235840 estimator.py:1145] Calling model_fn.
E0814 17:15:55.879117 140407842235840 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:15:56.109141 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:15:56.152113 140407842235840 estimator.py:1147] Done calling model_fn.
I0814 17:15:56.169094 140407842235840 evaluation.py:255] Starting evaluation at 2019-08-14T17:15:56Z
I0814 17:15:56.169327 140407842235840 tpu_estimator.py:499] TPU job name worker
I0814 17:15:56.250543 140407842235840 monitored_session.py:240] Graph was finalized.
W0814 17:15:56.251352 140407842235840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:15:56.441175 140407842235840 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:15:59.043204 140407842235840 session_manager.py:500] Running local_init_op.
I0814 17:15:59.072448 140407842235840 session_manager.py:502] Done running local_init_op.
I0814 17:15:59.124161 140407842235840 tpu_estimator.py:557] Init TPU system
I0814 17:17:08.112818 140407842235840 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:17:08.113816 140406942320384 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:17:08.114638 140406933927680 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:17:08.181438 140407842235840 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:17:08.207313 140407842235840 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:17:08.207741 140407842235840 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:17:08.242055 140406920550144 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:17:08.411058 140406920550144 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:17:08.960098 140406933927680 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:17:09.405545 140407842235840 evaluation.py:167] Evaluation [10/10]
I0814 17:17:09.405993 140407842235840 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:17:09.406073 140407842235840 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:17:09.406321 140406942320384 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:17:09.406595 140406942320384 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:17:09.406830 140407842235840 error_handling.py:96] infeed marked as finished
I0814 17:17:09.407043 140407842235840 tpu_estimator.py:602] Stop output thread controller
I0814 17:17:09.407129 140407842235840 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:17:09.407322 140406933927680 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:17:09.407565 140406933927680 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:17:09.407814 140407842235840 error_handling.py:96] outfeed marked as finished
I0814 17:17:09.407973 140407842235840 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:17:38.508783 140407842235840 evaluation.py:275] Finished evaluation at 2019-08-14-17:17:38
I0814 17:17:38.509157 140407842235840 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9725, global_step = 30, loss = 0.10025153
I0814 17:17:42.926175 140407842235840 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:17:43.780653 140407842235840 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10025153, 'global_step': 30, 'accuracy': 0.9725}

Removing gs://yangyou-mnist/log/#1565802863761507...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565802876423844...
Removing gs://yangyou-mnist/log/checkpoint#1565802943154624...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565802940012441...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565802880715634...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565802863.v3-8-tpu#1565802946497760...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565802875592601...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565802940923693...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565802868639882...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565802945514896...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565803060.v3-8-tpu#1565803063476382...
Removing gs://yangyou-mnist/log/eval/#1565803060159138...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:17:47.587202 139911418979776 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:17:47.587963 139911418979776 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:17:47.590615 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:17:47.591449 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:17:47.592012 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:17:47.592143 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:17:48.007909 139911418979776 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:17:48.016633 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:17:48.020818 139911418979776 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:17:48.139282 139911418979776 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:17:48.139564 139911418979776 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:17:48.310364 139911418979776 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:17:48.359534 139911418979776 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:17:48.359823 139911418979776 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:17:48.471416 139911418979776 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3f8496f190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3f86b4e210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:17:48.471764 139911418979776 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:17:48.790879 139911418979776 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:17:48.794044: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:17:48.806884 139911418979776 tpu_system_metadata.py:148] Found TPU system:
I0814 17:17:48.807152 139911418979776 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:17:48.807672 139911418979776 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:17:48.807743 139911418979776 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:17:48.807801 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:17:48.808120 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:17:48.808185 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:17:48.808258 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:17:48.808312 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:17:48.808368 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:17:48.808474 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:17:48.808538 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:17:48.808593 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:17:48.808646 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:17:48.808698 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:17:48.815267 139911418979776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:17:48.829163 139911418979776 estimator.py:1145] Calling model_fn.
W0814 17:17:48.829849 139911418979776 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:17:49.104752 139911418979776 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:17:49.519284 139911418979776 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:17:49.582398 139911418979776 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:17:49.588445 139911418979776 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:17:49.768627 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:17:49.782217 139911418979776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:17:49.794435 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:17:49.795512 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:17:49.802510 139911418979776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:17:49.807682 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:17:49.807894 139911418979776 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:17:49.820363 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:17:49.930461 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:17:49.972115 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.017396 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.068759 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.231494 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.282835 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.331923 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.383028 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.428487 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.469935 139911418979776 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:17:50.485830 139911418979776 estimator.py:1147] Done calling model_fn.
I0814 17:17:53.991230 139911418979776 tpu_estimator.py:499] TPU job name worker
I0814 17:17:54.103838 139911418979776 monitored_session.py:240] Graph was finalized.
I0814 17:17:54.779870 139911418979776 session_manager.py:500] Running local_init_op.
I0814 17:17:54.843678 139911418979776 session_manager.py:502] Done running local_init_op.
I0814 17:17:57.511703 139911418979776 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:18:09.620331 139911418979776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:18:09.764970 139911418979776 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:18:09.765399 139911418979776 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:18:09.765847: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:18:09.770905 139911418979776 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:18:09.773080 139911418979776 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:18:09.776981 139911418979776 tpu_estimator.py:557] Init TPU system
I0814 17:18:52.086215 139911418979776 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:18:52.087101 139910657058560 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:18:52.087595 139910648665856 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:18:52.147006 139910170277632 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:18:52.151338 139911418979776 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:18:52.152616 139911418979776 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:18:52.273020 139910170277632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:18:56.869394 139910648665856 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:19:01.520112 139911418979776 basic_session_run_hooks.py:262] loss = 0.091256216, step = 30
I0814 17:19:01.522463 139911418979776 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:19:15.072783 139911418979776 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:19:15.073061 139911418979776 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:19:15.073380 139910657058560 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:19:15.073745 139910657058560 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:19:15.073970 139911418979776 error_handling.py:96] infeed marked as finished
I0814 17:19:15.074227 139911418979776 tpu_estimator.py:602] Stop output thread controller
I0814 17:19:15.074289 139911418979776 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:19:15.074496 139910648665856 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:19:15.074702 139910648665856 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:19:15.074913 139911418979776 error_handling.py:96] outfeed marked as finished
I0814 17:19:15.075107 139911418979776 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:19:22.391129 139911418979776 estimator.py:368] Loss for final step: 0.091256216.
I0814 17:19:22.392044 139911418979776 error_handling.py:96] training_loop marked as finished
I0814 17:19:23.253281 139911418979776 estimator.py:1145] Calling model_fn.
E0814 17:19:23.946413 139911418979776 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:19:24.176263 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:19:24.198594 139911418979776 estimator.py:1147] Done calling model_fn.
I0814 17:19:24.215348 139911418979776 evaluation.py:255] Starting evaluation at 2019-08-14T17:19:24Z
I0814 17:19:24.215605 139911418979776 tpu_estimator.py:499] TPU job name worker
I0814 17:19:24.295516 139911418979776 monitored_session.py:240] Graph was finalized.
W0814 17:19:24.296338 139911418979776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:19:24.476139 139911418979776 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:19:27.196732 139911418979776 session_manager.py:500] Running local_init_op.
I0814 17:19:27.221304 139911418979776 session_manager.py:502] Done running local_init_op.
I0814 17:19:27.276333 139911418979776 tpu_estimator.py:557] Init TPU system
I0814 17:20:36.050715 139911418979776 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:20:36.051727 139910653388544 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:20:36.052491 139910170277632 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:20:36.119791 139911418979776 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:20:36.148749 139911418979776 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:20:36.149090 139911418979776 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:20:36.184448 139910161622784 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:20:36.362215 139910161622784 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:20:36.915397 139910170277632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:20:37.393472 139911418979776 evaluation.py:167] Evaluation [10/10]
I0814 17:20:37.393874 139911418979776 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:20:37.393951 139911418979776 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:20:37.394141 139910653388544 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:20:37.394237 139910653388544 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:20:37.394375 139911418979776 error_handling.py:96] infeed marked as finished
I0814 17:20:37.394464 139911418979776 tpu_estimator.py:602] Stop output thread controller
I0814 17:20:37.394511 139911418979776 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:20:37.394623 139910170277632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:20:37.394701 139910170277632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:20:37.394818 139911418979776 error_handling.py:96] outfeed marked as finished
I0814 17:20:37.394896 139911418979776 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:21:06.456993 139911418979776 evaluation.py:275] Finished evaluation at 2019-08-14-17:21:06
I0814 17:21:06.457410 139911418979776 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9755, global_step = 30, loss = 0.08571314
I0814 17:21:10.990874 139911418979776 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:21:11.833761 139911418979776 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08571314, 'global_step': 30, 'accuracy': 0.9755}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565803084660092...
Removing gs://yangyou-mnist/log/#1565803072061382...
Removing gs://yangyou-mnist/log/checkpoint#1565803151586052...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565803072.v3-8-tpu#1565803154768548...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565803089113026...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565803148412573...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565803149251596...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565803076936141...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565803083792309...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565803153833282...
Removing gs://yangyou-mnist/log/eval/#1565803268117188...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565803268.v3-8-tpu#1565803271524887...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:21:15.686269 140366740895168 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:21:15.687056 140366740895168 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:21:15.689640 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:21:15.690463 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:21:15.691045 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:21:15.691167 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:21:16.103918 140366740895168 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:21:16.110661 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:21:16.114423 140366740895168 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:21:16.204989 140366740895168 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:21:16.205284 140366740895168 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:21:16.388535 140366740895168 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:21:16.441286 140366740895168 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:21:16.441580 140366740895168 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:21:16.552278 140366740895168 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa987e40090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa98a01f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:21:16.552730 140366740895168 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:21:16.872243 140366740895168 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:21:16.875516: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:21:16.887928 140366740895168 tpu_system_metadata.py:148] Found TPU system:
I0814 17:21:16.888256 140366740895168 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:21:16.888925 140366740895168 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:21:16.888995 140366740895168 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:21:16.889054 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:21:16.889352 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:21:16.889406 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:21:16.889456 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:21:16.889655 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:21:16.889722 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:21:16.889769 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:21:16.889815 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:21:16.889861 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:21:16.889914 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:21:16.889961 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:21:16.896946 140366740895168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:21:16.911609 140366740895168 estimator.py:1145] Calling model_fn.
W0814 17:21:16.912307 140366740895168 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:21:17.188545 140366740895168 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:21:17.600459 140366740895168 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:21:17.662547 140366740895168 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:21:17.668718 140366740895168 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:21:17.851769 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:21:17.865573 140366740895168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:21:17.878103 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:21:17.879152 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:21:17.886132 140366740895168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:21:17.891355 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:21:17.891570 140366740895168 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:21:17.904295 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:21:18.015969 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:21:18.060043 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.105326 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.158780 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.332041 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.382709 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.431303 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.480982 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.526472 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.567195 140366740895168 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:21:18.583750 140366740895168 estimator.py:1147] Done calling model_fn.
I0814 17:21:21.983916 140366740895168 tpu_estimator.py:499] TPU job name worker
I0814 17:21:22.100236 140366740895168 monitored_session.py:240] Graph was finalized.
I0814 17:21:22.781570 140366740895168 session_manager.py:500] Running local_init_op.
I0814 17:21:22.844115 140366740895168 session_manager.py:502] Done running local_init_op.
I0814 17:21:25.592075 140366740895168 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:21:38.280868 140366740895168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:21:38.422422 140366740895168 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:21:38.422976 140366740895168 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:21:38.423404: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:21:38.428683 140366740895168 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:21:38.430846 140366740895168 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:21:38.434653 140366740895168 tpu_estimator.py:557] Init TPU system
I0814 17:22:20.092253 140366740895168 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:22:20.093377 140365705246464 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:22:20.094083 140365696853760 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:22:20.157777 140366740895168 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:22:20.158971 140366740895168 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:22:20.165999 140365688461056 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:22:20.273763 140365688461056 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:22:24.941093 140365696853760 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:22:29.401257 140366740895168 basic_session_run_hooks.py:262] loss = 0.09757991, step = 30
I0814 17:22:29.403953 140366740895168 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:22:42.586462 140366740895168 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:22:42.586802 140366740895168 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:22:42.587136 140365705246464 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:22:42.587452 140365705246464 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:22:42.587658 140366740895168 error_handling.py:96] infeed marked as finished
I0814 17:22:42.587830 140366740895168 tpu_estimator.py:602] Stop output thread controller
I0814 17:22:42.587904 140366740895168 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:22:42.588077 140365696853760 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:22:42.588244 140365696853760 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:22:42.588485 140366740895168 error_handling.py:96] outfeed marked as finished
I0814 17:22:42.588668 140366740895168 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:22:50.411436 140366740895168 estimator.py:368] Loss for final step: 0.09757991.
I0814 17:22:50.412564 140366740895168 error_handling.py:96] training_loop marked as finished
I0814 17:22:51.197225 140366740895168 estimator.py:1145] Calling model_fn.
E0814 17:22:51.928376 140366740895168 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:22:52.152635 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:22:52.173708 140366740895168 estimator.py:1147] Done calling model_fn.
I0814 17:22:52.191521 140366740895168 evaluation.py:255] Starting evaluation at 2019-08-14T17:22:52Z
I0814 17:22:52.191761 140366740895168 tpu_estimator.py:499] TPU job name worker
I0814 17:22:52.269105 140366740895168 monitored_session.py:240] Graph was finalized.
W0814 17:22:52.269901 140366740895168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:22:52.454760 140366740895168 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:22:54.995395 140366740895168 session_manager.py:500] Running local_init_op.
I0814 17:22:55.025033 140366740895168 session_manager.py:502] Done running local_init_op.
I0814 17:22:55.079135 140366740895168 tpu_estimator.py:557] Init TPU system
I0814 17:24:04.037775 140366740895168 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:24:04.038681 140365705246464 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:24:04.039098 140365696853760 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:24:04.108310 140366740895168 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:24:04.136717 140366740895168 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:24:04.137053 140366740895168 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:24:04.233702 140365688461056 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:24:04.348570 140365688461056 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:24:04.931909 140365696853760 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:24:05.215960 140366740895168 evaluation.py:167] Evaluation [10/10]
I0814 17:24:05.216296 140366740895168 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:24:05.216379 140366740895168 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:24:05.216583 140365705246464 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:24:05.216674 140365705246464 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:24:05.216819 140366740895168 error_handling.py:96] infeed marked as finished
I0814 17:24:05.216907 140366740895168 tpu_estimator.py:602] Stop output thread controller
I0814 17:24:05.216957 140366740895168 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:24:05.217066 140365696853760 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:24:05.217138 140365696853760 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:24:05.217259 140366740895168 error_handling.py:96] outfeed marked as finished
I0814 17:24:05.217354 140366740895168 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:24:34.445499 140366740895168 evaluation.py:275] Finished evaluation at 2019-08-14-17:24:34
I0814 17:24:34.445897 140366740895168 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9733, global_step = 30, loss = 0.086111695
I0814 17:24:38.611504 140366740895168 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:24:39.412214 140366740895168 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.086111695, 'global_step': 30, 'accuracy': 0.9733}

Removing gs://yangyou-mnist/log/#1565803280136326...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565803293184443...
Removing gs://yangyou-mnist/log/checkpoint#1565803359135664...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565803280.v3-8-tpu#1565803362279737...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565803285014487...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565803292306996...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565803297762400...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565803356977026...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565803356150434...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565803361346696...
Removing gs://yangyou-mnist/log/eval/#1565803476071538...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565803476.v3-8-tpu#1565803479107542...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:24:43.287883 140124188980672 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:24:43.288727 140124188980672 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:24:43.291373 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:24:43.292224 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:24:43.293026 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:24:43.293173 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:24:43.707947 140124188980672 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:24:43.715718 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:24:43.719655 140124188980672 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:24:43.777534 140124188980672 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:24:43.777853 140124188980672 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:24:44.083183 140124188980672 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:24:44.138108 140124188980672 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:24:44.138439 140124188980672 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:24:44.251061 140124188980672 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f710eaa1250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f7110c971d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:24:44.251473 140124188980672 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:24:44.574264 140124188980672 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:24:44.578308: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:24:44.591403 140124188980672 tpu_system_metadata.py:148] Found TPU system:
I0814 17:24:44.591669 140124188980672 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:24:44.592361 140124188980672 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:24:44.592458 140124188980672 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:24:44.592519 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:24:44.592828 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:24:44.592886 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:24:44.592938 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:24:44.592987 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:24:44.593034 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:24:44.593081 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:24:44.593128 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:24:44.593174 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:24:44.593240 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:24:44.593302 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:24:44.599833 140124188980672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:24:44.613702 140124188980672 estimator.py:1145] Calling model_fn.
W0814 17:24:44.614418 140124188980672 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:24:44.901822 140124188980672 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:24:45.345107 140124188980672 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:24:45.412822 140124188980672 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:24:45.419327 140124188980672 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:24:45.600752 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:24:45.614423 140124188980672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:24:45.626499 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:24:45.627585 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:24:45.634658 140124188980672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:24:45.639950 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:24:45.640172 140124188980672 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:24:45.652650 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:24:45.763581 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:24:45.805367 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:45.849154 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:45.900100 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.067106 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.118139 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.165707 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.214927 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.259244 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.300767 140124188980672 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:24:46.317773 140124188980672 estimator.py:1147] Done calling model_fn.
I0814 17:24:49.818206 140124188980672 tpu_estimator.py:499] TPU job name worker
I0814 17:24:49.931848 140124188980672 monitored_session.py:240] Graph was finalized.
I0814 17:24:50.614583 140124188980672 session_manager.py:500] Running local_init_op.
I0814 17:24:50.662431 140124188980672 session_manager.py:502] Done running local_init_op.
I0814 17:24:53.452644 140124188980672 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:25:06.462443 140124188980672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:25:06.622266 140124188980672 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:25:06.622814 140124188980672 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:25:06.623221: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:25:06.628654 140124188980672 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:25:06.630887 140124188980672 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:25:06.635034 140124188980672 tpu_estimator.py:557] Init TPU system
I0814 17:25:48.102138 140124188980672 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:25:48.103224 140123282851584 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:25:48.104012 140123274458880 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:25:48.164693 140123266066176 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:25:48.168474 140124188980672 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:25:48.169795 140124188980672 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:25:48.316625 140123266066176 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:25:52.898765 140123274458880 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:25:57.262574 140124188980672 basic_session_run_hooks.py:262] loss = 0.112192675, step = 30
I0814 17:25:57.265330 140124188980672 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:26:10.353666 140124188980672 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:26:10.353951 140124188980672 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:26:10.354149 140123282851584 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:26:10.354255 140123282851584 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:26:10.354388 140124188980672 error_handling.py:96] infeed marked as finished
I0814 17:26:10.354487 140124188980672 tpu_estimator.py:602] Stop output thread controller
I0814 17:26:10.354540 140124188980672 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:26:10.354667 140123274458880 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:26:10.354741 140123274458880 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:26:10.354861 140124188980672 error_handling.py:96] outfeed marked as finished
I0814 17:26:10.354964 140124188980672 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:26:18.454653 140124188980672 estimator.py:368] Loss for final step: 0.112192675.
I0814 17:26:18.455544 140124188980672 error_handling.py:96] training_loop marked as finished
I0814 17:26:19.172034 140124188980672 estimator.py:1145] Calling model_fn.
E0814 17:26:19.918620 140124188980672 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:26:20.149413 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:26:20.171088 140124188980672 estimator.py:1147] Done calling model_fn.
I0814 17:26:20.188594 140124188980672 evaluation.py:255] Starting evaluation at 2019-08-14T17:26:20Z
I0814 17:26:20.188831 140124188980672 tpu_estimator.py:499] TPU job name worker
I0814 17:26:20.271215 140124188980672 monitored_session.py:240] Graph was finalized.
W0814 17:26:20.271989 140124188980672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:26:20.443401 140124188980672 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:26:23.174102 140124188980672 session_manager.py:500] Running local_init_op.
I0814 17:26:23.204190 140124188980672 session_manager.py:502] Done running local_init_op.
I0814 17:26:23.256814 140124188980672 tpu_estimator.py:557] Init TPU system
I0814 17:27:32.036911 140124188980672 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:27:32.037992 140123282851584 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:27:32.038707 140123274458880 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:27:32.107906 140124188980672 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:27:32.131774 140124188980672 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:27:32.132111 140124188980672 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:27:32.172214 140123266066176 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:27:32.348787 140123266066176 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:27:32.880029 140123274458880 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:27:33.393889 140124188980672 evaluation.py:167] Evaluation [10/10]
I0814 17:27:33.394239 140124188980672 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:27:33.394326 140124188980672 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:27:33.394638 140123282851584 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:27:33.394920 140123282851584 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:27:33.395178 140124188980672 error_handling.py:96] infeed marked as finished
I0814 17:27:33.395380 140124188980672 tpu_estimator.py:602] Stop output thread controller
I0814 17:27:33.395437 140124188980672 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:27:33.395632 140123274458880 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:27:33.395829 140123274458880 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:27:33.395998 140124188980672 error_handling.py:96] outfeed marked as finished
I0814 17:27:33.396117 140124188980672 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:28:02.439544 140124188980672 evaluation.py:275] Finished evaluation at 2019-08-14-17:28:02
I0814 17:28:02.439909 140124188980672 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9684, global_step = 30, loss = 0.10927965
I0814 17:28:07.266041 140124188980672 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:28:08.115511 140124188980672 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10927965, 'global_step': 30, 'accuracy': 0.9684}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565803501121907...
Removing gs://yangyou-mnist/log/#1565803487824831...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565803505939073...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565803492871580...
Removing gs://yangyou-mnist/log/checkpoint#1565803567087142...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565803488.v3-8-tpu#1565803570067018...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565803564246492...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565803565201625...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565803500229005...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565803569209409...
Removing gs://yangyou-mnist/log/eval/#1565803684051455...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565803684.v3-8-tpu#1565803687783286...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:28:12.000243 139837891179968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:28:12.001075 139837891179968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:28:12.003699 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:28:12.004683 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:28:12.005301 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:28:12.005450 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:28:12.424093 139837891179968 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:28:12.431343 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:28:12.435425 139837891179968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:28:12.488934 139837891179968 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:28:12.489209 139837891179968 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:28:12.810646 139837891179968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:28:12.863229 139837891179968 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:28:12.863497 139837891179968 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:28:12.987401 139837891179968 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2e65fdc250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2e681bb1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:28:12.987752 139837891179968 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:28:13.323230 139837891179968 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:28:13.326121: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:28:13.340434 139837891179968 tpu_system_metadata.py:148] Found TPU system:
I0814 17:28:13.340687 139837891179968 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:28:13.341181 139837891179968 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:28:13.341243 139837891179968 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:28:13.341310 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:28:13.341649 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:28:13.341715 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:28:13.341768 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:28:13.341820 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:28:13.341875 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:28:13.341928 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:28:13.341983 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:28:13.342036 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:28:13.342086 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:28:13.342154 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:28:13.348165 139837891179968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:28:13.361063 139837891179968 estimator.py:1145] Calling model_fn.
W0814 17:28:13.361692 139837891179968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:28:13.633209 139837891179968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:28:14.143802 139837891179968 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:28:14.206367 139837891179968 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:28:14.212515 139837891179968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:28:14.398480 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:28:14.412390 139837891179968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:28:14.425263 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:28:14.426472 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:28:14.433938 139837891179968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:28:14.439374 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:28:14.439593 139837891179968 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:28:14.452312 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:28:14.563901 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:28:14.606654 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:14.652847 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:14.705395 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:14.870141 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:14.921066 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:14.969708 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:15.020042 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:15.066854 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:15.108639 139837891179968 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:28:15.124660 139837891179968 estimator.py:1147] Done calling model_fn.
I0814 17:28:18.622997 139837891179968 tpu_estimator.py:499] TPU job name worker
I0814 17:28:18.737811 139837891179968 monitored_session.py:240] Graph was finalized.
I0814 17:28:19.410353 139837891179968 session_manager.py:500] Running local_init_op.
I0814 17:28:19.470479 139837891179968 session_manager.py:502] Done running local_init_op.
I0814 17:28:22.137332 139837891179968 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:28:34.245296 139837891179968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:28:34.387614 139837891179968 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:28:34.388092 139837891179968 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:28:34.388602: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:28:34.393625 139837891179968 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:28:34.395803 139837891179968 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:28:34.399629 139837891179968 tpu_estimator.py:557] Init TPU system
I0814 17:29:16.101196 139837891179968 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:29:16.102174 139836986476288 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:29:16.102849 139836978083584 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:29:16.154066 139836969690880 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:29:16.164942 139837891179968 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:29:16.165955 139837891179968 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:29:16.309259 139836969690880 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:29:20.900809 139836978083584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:29:25.620521 139837891179968 basic_session_run_hooks.py:262] loss = 2.3542833, step = 30
I0814 17:29:25.622683 139837891179968 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:29:39.775696 139837891179968 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:29:39.775970 139837891179968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:29:39.776171 139836986476288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:29:39.776276 139836986476288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:29:39.776438 139837891179968 error_handling.py:96] infeed marked as finished
I0814 17:29:39.776551 139837891179968 tpu_estimator.py:602] Stop output thread controller
I0814 17:29:39.776602 139837891179968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:29:39.776717 139836978083584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:29:39.776793 139836978083584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:29:39.776909 139837891179968 error_handling.py:96] outfeed marked as finished
I0814 17:29:39.776990 139837891179968 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:29:46.429600 139837891179968 estimator.py:368] Loss for final step: 2.3542833.
I0814 17:29:46.430394 139837891179968 error_handling.py:96] training_loop marked as finished
I0814 17:29:47.438707 139837891179968 estimator.py:1145] Calling model_fn.
E0814 17:29:48.362667 139837891179968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:29:48.593086 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:29:48.614583 139837891179968 estimator.py:1147] Done calling model_fn.
I0814 17:29:48.631386 139837891179968 evaluation.py:255] Starting evaluation at 2019-08-14T17:29:48Z
I0814 17:29:48.631613 139837891179968 tpu_estimator.py:499] TPU job name worker
I0814 17:29:48.711632 139837891179968 monitored_session.py:240] Graph was finalized.
W0814 17:29:48.712425 139837891179968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:29:48.899358 139837891179968 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:29:51.628572 139837891179968 session_manager.py:500] Running local_init_op.
I0814 17:29:51.652705 139837891179968 session_manager.py:502] Done running local_init_op.
I0814 17:29:51.700587 139837891179968 tpu_estimator.py:557] Init TPU system
I0814 17:31:00.059973 139837891179968 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:31:00.061120 139836986476288 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:31:00.061950 139836978083584 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:31:00.127468 139837891179968 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:31:00.155272 139837891179968 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:31:00.155637 139837891179968 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:31:00.178862 139836969690880 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:31:00.373028 139836969690880 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:31:00.950532 139836978083584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:31:01.246465 139837891179968 evaluation.py:167] Evaluation [10/10]
I0814 17:31:01.246845 139837891179968 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:31:01.246942 139837891179968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:31:01.247263 139836986476288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:31:01.247575 139836986476288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:31:01.247805 139837891179968 error_handling.py:96] infeed marked as finished
I0814 17:31:01.248008 139837891179968 tpu_estimator.py:602] Stop output thread controller
I0814 17:31:01.248091 139837891179968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:31:01.248286 139836978083584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:31:01.248534 139836978083584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:31:01.248699 139837891179968 error_handling.py:96] outfeed marked as finished
I0814 17:31:01.248867 139837891179968 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:31:30.470509 139837891179968 evaluation.py:275] Finished evaluation at 2019-08-14-17:31:30
I0814 17:31:30.470866 139837891179968 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 2.3169105
I0814 17:31:37.172061 139837891179968 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:31:37.950676 139837891179968 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3169105, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/checkpoint#1565803776339723...
Removing gs://yangyou-mnist/log/#1565803696643453...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565803696.v3-8-tpu#1565803779467779...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565803701554290...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565803708540431...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565803709401359...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565803773188316...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565803713736736...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565803774175624...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565803778569525...
Removing gs://yangyou-mnist/log/eval/#1565803892169593...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565803892.v3-8-tpu#1565803897638742...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:31:41.891532 140041883088320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:31:41.892317 140041883088320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:31:41.894957 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:31:41.895767 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:31:41.896342 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:31:41.896533 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:31:42.317686 140041883088320 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:31:42.325027 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:31:42.328960 140041883088320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:31:42.378104 140041883088320 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:31:42.378413 140041883088320 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:31:42.495249 140041883088320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:31:42.603075 140041883088320 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:31:42.603359 140041883088320 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:31:42.900064 140041883088320 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5de4db4150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5de6f931d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:31:42.900546 140041883088320 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:31:43.227422 140041883088320 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:31:43.230529: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:31:43.243803 140041883088320 tpu_system_metadata.py:148] Found TPU system:
I0814 17:31:43.244046 140041883088320 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:31:43.244759 140041883088320 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:31:43.244834 140041883088320 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:31:43.244890 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:31:43.245244 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:31:43.245300 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:31:43.245351 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:31:43.245407 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:31:43.245455 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:31:43.245501 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:31:43.245548 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:31:43.245605 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:31:43.245654 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:31:43.245701 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:31:43.251919 140041883088320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:31:43.264955 140041883088320 estimator.py:1145] Calling model_fn.
W0814 17:31:43.265592 140041883088320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:31:43.531404 140041883088320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:31:43.950836 140041883088320 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:31:44.014863 140041883088320 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:31:44.020816 140041883088320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:31:44.205799 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:31:44.220101 140041883088320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:31:44.232538 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:31:44.233639 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:31:44.241003 140041883088320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:31:44.246539 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:31:44.246776 140041883088320 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:31:44.267385 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:31:44.378849 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:31:44.422199 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.467134 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.518852 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.685764 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.738936 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.788688 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.838946 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.885138 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.927210 140041883088320 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:31:44.943434 140041883088320 estimator.py:1147] Done calling model_fn.
I0814 17:31:48.234118 140041883088320 tpu_estimator.py:499] TPU job name worker
I0814 17:31:48.348567 140041883088320 monitored_session.py:240] Graph was finalized.
I0814 17:31:49.048276 140041883088320 session_manager.py:500] Running local_init_op.
I0814 17:31:49.097182 140041883088320 session_manager.py:502] Done running local_init_op.
I0814 17:31:51.893796 140041883088320 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:32:04.199779 140041883088320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:32:04.347640 140041883088320 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:32:04.348050 140041883088320 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:32:04.348477: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:32:04.353686 140041883088320 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:32:04.355753 140041883088320 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:32:04.359864 140041883088320 tpu_estimator.py:557] Init TPU system
I0814 17:32:44.123450 140041883088320 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 17:32:44.124284 140041121146624 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:32:44.125085 140041112753920 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:32:44.187477 140040629909248 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:32:44.188205 140041883088320 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:32:44.189522 140041883088320 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:32:44.311422 140040629909248 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:32:48.879442 140041112753920 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:32:53.748475 140041883088320 basic_session_run_hooks.py:262] loss = 18.998346, step = 30
I0814 17:32:53.751205 140041883088320 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:33:08.294626 140041883088320 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:33:08.294948 140041883088320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:33:08.295166 140041121146624 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:33:08.295281 140041121146624 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:33:08.295425 140041883088320 error_handling.py:96] infeed marked as finished
I0814 17:33:08.295521 140041883088320 tpu_estimator.py:602] Stop output thread controller
I0814 17:33:08.295568 140041883088320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:33:08.295679 140041112753920 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:33:08.295748 140041112753920 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:33:08.295861 140041883088320 error_handling.py:96] outfeed marked as finished
I0814 17:33:08.295941 140041883088320 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:33:14.451994 140041883088320 estimator.py:368] Loss for final step: 18.998346.
I0814 17:33:14.452866 140041883088320 error_handling.py:96] training_loop marked as finished
I0814 17:33:15.136044 140041883088320 estimator.py:1145] Calling model_fn.
E0814 17:33:15.820146 140041883088320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:33:16.046036 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:33:16.067612 140041883088320 estimator.py:1147] Done calling model_fn.
I0814 17:33:16.086215 140041883088320 evaluation.py:255] Starting evaluation at 2019-08-14T17:33:16Z
I0814 17:33:16.086458 140041883088320 tpu_estimator.py:499] TPU job name worker
I0814 17:33:16.170747 140041883088320 monitored_session.py:240] Graph was finalized.
W0814 17:33:16.171525 140041883088320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:33:16.358639 140041883088320 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:33:19.200000 140041883088320 session_manager.py:500] Running local_init_op.
I0814 17:33:19.224653 140041883088320 session_manager.py:502] Done running local_init_op.
I0814 17:33:19.278007 140041883088320 tpu_estimator.py:557] Init TPU system
I0814 17:34:28.038456 140041883088320 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:34:28.039442 140041117476608 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:34:28.039913 140040629909248 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:34:28.106909 140041883088320 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:34:28.131489 140041883088320 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:34:28.131910 140041883088320 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:34:28.158693 140040621516544 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:34:28.331486 140040621516544 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:34:28.942460 140040629909248 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:34:29.241261 140041883088320 evaluation.py:167] Evaluation [10/10]
I0814 17:34:29.241600 140041883088320 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:34:29.241678 140041883088320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:34:29.241983 140041117476608 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:34:29.242115 140041117476608 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:34:29.242257 140041883088320 error_handling.py:96] infeed marked as finished
I0814 17:34:29.242356 140041883088320 tpu_estimator.py:602] Stop output thread controller
I0814 17:34:29.242413 140041883088320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:34:29.242527 140040629909248 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:34:29.242598 140040629909248 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:34:29.242711 140041883088320 error_handling.py:96] outfeed marked as finished
I0814 17:34:29.242803 140041883088320 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:34:58.429954 140041883088320 evaluation.py:275] Finished evaluation at 2019-08-14-17:34:58
I0814 17:34:58.430309 140041883088320 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0974, global_step = 30, loss = 16.230158
I0814 17:35:02.799137 140041883088320 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:35:03.556171 140041883088320 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 16.230158, 'global_step': 30, 'accuracy': 0.0974}

Removing gs://yangyou-mnist/log/#1565803906413195...
Removing gs://yangyou-mnist/log/checkpoint#1565803984045556...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565803906.v3-8-tpu#1565803987991997...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565803911314563...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565803918402028...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565803919412776...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565803923692859...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565803980876719...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565803981809155...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565803986307637...
Removing gs://yangyou-mnist/log/eval/#1565804100100804...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565804100.v3-8-tpu#1565804103250604...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:35:07.382810 140042374657472 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:35:07.383601 140042374657472 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:35:07.386313 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:35:07.387183 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:35:07.387795 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:35:07.387933 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:35:07.799711 140042374657472 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:35:07.806894 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:35:07.811022 140042374657472 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:35:07.921689 140042374657472 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:35:07.921987 140042374657472 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:35:08.030267 140042374657472 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:35:08.070624 140042374657472 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:35:08.070908 140042374657472 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:35:08.210504 140042374657472 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5e02280150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5e0445f1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:35:08.210870 140042374657472 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:35:08.546307 140042374657472 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:35:08.549202: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:35:08.562336 140042374657472 tpu_system_metadata.py:148] Found TPU system:
I0814 17:35:08.562611 140042374657472 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:35:08.564560 140042374657472 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:35:08.564701 140042374657472 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:35:08.564773 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:35:08.565258 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:35:08.565354 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:35:08.565408 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:35:08.565459 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:35:08.565506 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:35:08.565553 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:35:08.565610 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:35:08.565665 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:35:08.565718 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:35:08.565862 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:35:08.571950 140042374657472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:35:08.584718 140042374657472 estimator.py:1145] Calling model_fn.
W0814 17:35:08.585320 140042374657472 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:35:08.854366 140042374657472 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:35:09.270458 140042374657472 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:35:09.332889 140042374657472 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:35:09.339616 140042374657472 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:35:09.524328 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:35:09.538583 140042374657472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:35:09.550812 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:35:09.551867 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:35:09.559053 140042374657472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:35:09.564366 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:35:09.564630 140042374657472 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:35:09.577254 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:35:09.687572 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:35:09.729355 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:09.773395 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:09.823683 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:09.990750 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:10.041848 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:10.090754 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:10.141963 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:10.188664 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:10.230971 140042374657472 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:35:10.247811 140042374657472 estimator.py:1147] Done calling model_fn.
I0814 17:35:13.742944 140042374657472 tpu_estimator.py:499] TPU job name worker
I0814 17:35:13.858665 140042374657472 monitored_session.py:240] Graph was finalized.
I0814 17:35:14.522151 140042374657472 session_manager.py:500] Running local_init_op.
I0814 17:35:14.570074 140042374657472 session_manager.py:502] Done running local_init_op.
I0814 17:35:17.378190 140042374657472 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:35:32.135451 140042374657472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:35:32.274919 140042374657472 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:35:32.275352 140042374657472 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:35:32.275743: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:35:32.280765 140042374657472 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:35:32.283054 140042374657472 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:35:32.286623 140042374657472 tpu_estimator.py:557] Init TPU system
I0814 17:36:12.107536 140042374657472 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 17:36:12.108709 140041478461184 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:36:12.109549 140041470068480 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:36:12.166553 140041461675776 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:36:12.172889 140042374657472 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:36:12.173716 140042374657472 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:36:12.278002 140041461675776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:36:17.162273 140041470068480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:36:22.000138 140042374657472 basic_session_run_hooks.py:262] loss = 438662.12, step = 30
I0814 17:36:22.003149 140042374657472 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:36:35.396635 140042374657472 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:36:35.396939 140042374657472 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:36:35.397229 140041478461184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:36:35.397532 140041478461184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:36:35.397876 140042374657472 error_handling.py:96] infeed marked as finished
I0814 17:36:35.398106 140042374657472 tpu_estimator.py:602] Stop output thread controller
I0814 17:36:35.398175 140042374657472 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:36:35.398349 140041470068480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:36:35.398519 140041470068480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:36:35.398669 140042374657472 error_handling.py:96] outfeed marked as finished
I0814 17:36:35.398803 140042374657472 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:36:42.419684 140042374657472 estimator.py:368] Loss for final step: 438662.12.
I0814 17:36:42.420577 140042374657472 error_handling.py:96] training_loop marked as finished
I0814 17:36:43.201194 140042374657472 estimator.py:1145] Calling model_fn.
E0814 17:36:43.941668 140042374657472 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:36:44.162260 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:36:44.183747 140042374657472 estimator.py:1147] Done calling model_fn.
I0814 17:36:44.200850 140042374657472 evaluation.py:255] Starting evaluation at 2019-08-14T17:36:44Z
I0814 17:36:44.201077 140042374657472 tpu_estimator.py:499] TPU job name worker
I0814 17:36:44.278979 140042374657472 monitored_session.py:240] Graph was finalized.
W0814 17:36:44.279714 140042374657472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:36:44.441605 140042374657472 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:36:47.164918 140042374657472 session_manager.py:500] Running local_init_op.
I0814 17:36:47.190996 140042374657472 session_manager.py:502] Done running local_init_op.
I0814 17:36:47.244111 140042374657472 tpu_estimator.py:557] Init TPU system
I0814 17:37:56.062367 140042374657472 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:37:56.063277 140041474791168 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:37:56.063796 140041466398464 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:37:56.131396 140042374657472 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:37:56.161092 140042374657472 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:37:56.161436 140042374657472 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:37:56.246680 140041453020928 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:37:56.382666 140041453020928 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:37:56.930010 140041466398464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:37:57.464221 140042374657472 evaluation.py:167] Evaluation [10/10]
I0814 17:37:57.464607 140042374657472 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:37:57.464684 140042374657472 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:37:57.464900 140041474791168 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:37:57.464996 140041474791168 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:37:57.465154 140042374657472 error_handling.py:96] infeed marked as finished
I0814 17:37:57.465245 140042374657472 tpu_estimator.py:602] Stop output thread controller
I0814 17:37:57.465321 140042374657472 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:37:57.465440 140041466398464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:37:57.465517 140041466398464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:37:57.465691 140042374657472 error_handling.py:96] outfeed marked as finished
I0814 17:37:57.465787 140042374657472 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:38:26.477191 140042374657472 evaluation.py:275] Finished evaluation at 2019-08-14-17:38:26
I0814 17:38:26.477540 140042374657472 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 309284.56
I0814 17:38:30.911732 140042374657472 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:38:31.767348 140042374657472 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 309284.56, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/checkpoint#1565804191971865...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565804112.v3-8-tpu#1565804195094604...
Removing gs://yangyou-mnist/log/#1565804111859680...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565804124787325...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565804130887876...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565804116797466...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565804189018013...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565804123908485...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565804189844535...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565804194181266...
Removing gs://yangyou-mnist/log/eval/#1565804308192282...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565804308.v3-8-tpu#1565804311458162...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:38:35.571763 140575797831104 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:38:35.572841 140575797831104 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:38:35.575404 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:38:35.576242 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:38:35.576884 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:38:35.577018 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:38:35.989207 140575797831104 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:38:35.996022 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:38:36.000057 140575797831104 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:38:36.508347 140575797831104 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:38:36.508686 140575797831104 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:38:36.817897 140575797831104 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:38:36.868443 140575797831104 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:38:36.868761 140575797831104 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:38:37.085180 140575797831104 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fda34a7b150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fda36c5a1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:38:37.085537 140575797831104 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:38:37.440650 140575797831104 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:38:37.443620: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:38:37.457835 140575797831104 tpu_system_metadata.py:148] Found TPU system:
I0814 17:38:37.458072 140575797831104 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:38:37.458547 140575797831104 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:38:37.458707 140575797831104 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:38:37.458772 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:38:37.459095 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:38:37.459155 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:38:37.459204 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:38:37.459253 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:38:37.459299 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:38:37.459343 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:38:37.459388 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:38:37.459434 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:38:37.459480 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:38:37.459526 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:38:37.465651 140575797831104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:38:37.478424 140575797831104 estimator.py:1145] Calling model_fn.
W0814 17:38:37.479057 140575797831104 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:38:37.753762 140575797831104 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:38:38.159540 140575797831104 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:38:38.224433 140575797831104 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:38:38.230644 140575797831104 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:38:38.419029 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:38:38.433188 140575797831104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:38:38.445301 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:38:38.446362 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:38:38.453440 140575797831104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:38:38.458688 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:38:38.458889 140575797831104 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:38:38.471319 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:38:38.581207 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:38:38.622505 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:38.666842 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:38.718838 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:38.889569 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:38.940316 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:38.989892 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:39.040884 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:39.087657 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:39.135282 140575797831104 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:38:39.151521 140575797831104 estimator.py:1147] Done calling model_fn.
I0814 17:38:42.611171 140575797831104 tpu_estimator.py:499] TPU job name worker
I0814 17:38:42.719130 140575797831104 monitored_session.py:240] Graph was finalized.
I0814 17:38:43.388798 140575797831104 session_manager.py:500] Running local_init_op.
I0814 17:38:43.435919 140575797831104 session_manager.py:502] Done running local_init_op.
I0814 17:38:46.189246 140575797831104 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:38:58.451277 140575797831104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:38:58.594968 140575797831104 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:38:58.595424 140575797831104 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:38:58.595855: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:38:58.601260 140575797831104 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:38:58.603324 140575797831104 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:38:58.607321 140575797831104 tpu_estimator.py:557] Init TPU system
I0814 17:39:40.102077 140575797831104 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:39:40.102993 140575035860736 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:39:40.103471 140575027468032 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:39:40.166793 140575797831104 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:39:40.168556 140575797831104 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:39:40.174278 140574548031232 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:39:40.405221 140574548031232 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:39:44.917798 140575027468032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:39:49.451988 140575797831104 basic_session_run_hooks.py:262] loss = 2856.1465, step = 30
I0814 17:39:49.454143 140575797831104 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:40:02.502904 140575797831104 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:40:02.503223 140575797831104 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:40:02.503458 140575035860736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:40:02.503566 140575035860736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:40:02.503715 140575797831104 error_handling.py:96] infeed marked as finished
I0814 17:40:02.503818 140575797831104 tpu_estimator.py:602] Stop output thread controller
I0814 17:40:02.503866 140575797831104 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:40:02.503983 140575027468032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:40:02.504054 140575027468032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:40:02.504169 140575797831104 error_handling.py:96] outfeed marked as finished
I0814 17:40:02.504264 140575797831104 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:40:10.543489 140575797831104 estimator.py:368] Loss for final step: 2856.1465.
I0814 17:40:10.544261 140575797831104 error_handling.py:96] training_loop marked as finished
I0814 17:40:11.335225 140575797831104 estimator.py:1145] Calling model_fn.
E0814 17:40:12.027327 140575797831104 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:40:12.259115 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:40:12.282341 140575797831104 estimator.py:1147] Done calling model_fn.
I0814 17:40:12.300519 140575797831104 evaluation.py:255] Starting evaluation at 2019-08-14T17:40:12Z
I0814 17:40:12.300779 140575797831104 tpu_estimator.py:499] TPU job name worker
I0814 17:40:12.385576 140575797831104 monitored_session.py:240] Graph was finalized.
W0814 17:40:12.386352 140575797831104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:40:12.573699 140575797831104 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:40:15.258687 140575797831104 session_manager.py:500] Running local_init_op.
I0814 17:40:15.283283 140575797831104 session_manager.py:502] Done running local_init_op.
I0814 17:40:15.334286 140575797831104 tpu_estimator.py:557] Init TPU system
I0814 17:41:24.070118 140575797831104 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:41:24.071172 140575032190720 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:41:24.071856 140574548031232 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:41:24.140057 140575797831104 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:41:24.169665 140575797831104 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:41:24.170061 140575797831104 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:41:24.200217 140574539638528 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:41:24.436645 140574539638528 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:41:25.001924 140574548031232 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:41:25.378427 140575797831104 evaluation.py:167] Evaluation [10/10]
I0814 17:41:25.378832 140575797831104 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:41:25.378914 140575797831104 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:41:25.379184 140575032190720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:41:25.379477 140575032190720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:41:25.379704 140575797831104 error_handling.py:96] infeed marked as finished
I0814 17:41:25.380023 140575797831104 tpu_estimator.py:602] Stop output thread controller
I0814 17:41:25.380091 140575797831104 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:41:25.380249 140574548031232 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:41:25.380388 140574548031232 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:41:25.380701 140575797831104 error_handling.py:96] outfeed marked as finished
I0814 17:41:25.381010 140575797831104 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:41:54.520745 140575797831104 evaluation.py:275] Finished evaluation at 2019-08-14-17:41:54
I0814 17:41:54.521138 140575797831104 estimator.py:2039] Saving dict for global step 30: accuracy = 0.098, global_step = 30, loss = 2982.6396
I0814 17:41:58.612622 140575797831104 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:41:59.372227 140575797831104 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2982.6396, 'global_step': 30, 'accuracy': 0.098}

Removing gs://yangyou-mnist/log/#1565804320722778...
Removing gs://yangyou-mnist/log/checkpoint#1565804399127598...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565804320.v3-8-tpu#1565804402163082...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565804333421353...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565804397062435...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565804396230431...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565804337938612...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565804325599438...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565804332488203...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565804401249912...
Removing gs://yangyou-mnist/log/eval/#1565804516141783...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565804516.v3-8-tpu#1565804519065542...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:42:03.226680 139894822974912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:42:03.227452 139894822974912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:42:03.230191 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:42:03.231062 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:42:03.231643 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:42:03.231796 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:42:03.645872 139894822974912 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:42:03.653012 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:42:03.657151 139894822974912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:42:03.711834 139894822974912 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:42:03.712106 139894822974912 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:42:03.828300 139894822974912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:42:03.942184 139894822974912 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:42:03.942467 139894822974912 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:42:04.059900 139894822974912 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3ba7640250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3ba981f1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:42:04.060271 139894822974912 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:42:04.386739 139894822974912 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:42:04.389625: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:42:04.401642 139894822974912 tpu_system_metadata.py:148] Found TPU system:
I0814 17:42:04.401879 139894822974912 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:42:04.402368 139894822974912 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:42:04.402426 139894822974912 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:42:04.402481 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:42:04.402782 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:42:04.402841 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:42:04.402892 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:42:04.402940 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:42:04.402988 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:42:04.403039 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:42:04.403088 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:42:04.403135 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:42:04.403182 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:42:04.403306 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:42:04.409326 139894822974912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:42:04.422133 139894822974912 estimator.py:1145] Calling model_fn.
W0814 17:42:04.422744 139894822974912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:42:04.699726 139894822974912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:42:05.219965 139894822974912 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:42:05.288543 139894822974912 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:42:05.295068 139894822974912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:42:05.474369 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:42:05.488215 139894822974912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:42:05.500722 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:42:05.501939 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:42:05.509177 139894822974912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:42:05.514524 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:42:05.514753 139894822974912 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:42:05.527519 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:42:05.638425 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:42:05.679651 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:05.724591 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:05.775340 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:05.936393 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:05.986706 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:06.035902 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:06.086462 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:06.132339 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:06.173558 139894822974912 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:42:06.190171 139894822974912 estimator.py:1147] Done calling model_fn.
I0814 17:42:09.606687 139894822974912 tpu_estimator.py:499] TPU job name worker
I0814 17:42:09.720432 139894822974912 monitored_session.py:240] Graph was finalized.
I0814 17:42:10.452481 139894822974912 session_manager.py:500] Running local_init_op.
I0814 17:42:10.501282 139894822974912 session_manager.py:502] Done running local_init_op.
I0814 17:42:13.354233 139894822974912 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:42:25.807972 139894822974912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:42:25.974025 139894822974912 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:42:25.974535 139894822974912 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:42:25.974930: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:42:25.980006 139894822974912 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:42:25.982182 139894822974912 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:42:25.985817 139894822974912 tpu_estimator.py:557] Init TPU system
I0814 17:43:08.117136 139894822974912 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:43:08.118087 139893787322112 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:43:08.118612 139893778929408 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:43:08.181006 139893770536704 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:43:08.187119 139894822974912 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:43:08.188961 139894822974912 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:43:08.290844 139893770536704 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:43:12.919740 139893778929408 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:43:17.437957 139894822974912 basic_session_run_hooks.py:262] loss = 274920.97, step = 30
I0814 17:43:17.440859 139894822974912 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:43:31.098445 139894822974912 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:43:31.098748 139894822974912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:43:31.098993 139893787322112 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:43:31.099122 139893787322112 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:43:31.099281 139894822974912 error_handling.py:96] infeed marked as finished
I0814 17:43:31.099385 139894822974912 tpu_estimator.py:602] Stop output thread controller
I0814 17:43:31.099438 139894822974912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:43:31.099562 139893778929408 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:43:31.099638 139893778929408 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:43:31.099757 139894822974912 error_handling.py:96] outfeed marked as finished
I0814 17:43:31.099862 139894822974912 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:43:38.423779 139894822974912 estimator.py:368] Loss for final step: 274920.97.
I0814 17:43:38.424679 139894822974912 error_handling.py:96] training_loop marked as finished
I0814 17:43:39.219192 139894822974912 estimator.py:1145] Calling model_fn.
E0814 17:43:39.933130 139894822974912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:43:40.169569 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:43:40.192032 139894822974912 estimator.py:1147] Done calling model_fn.
I0814 17:43:40.209883 139894822974912 evaluation.py:255] Starting evaluation at 2019-08-14T17:43:40Z
I0814 17:43:40.210140 139894822974912 tpu_estimator.py:499] TPU job name worker
I0814 17:43:40.291867 139894822974912 monitored_session.py:240] Graph was finalized.
W0814 17:43:40.292701 139894822974912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:43:40.490685 139894822974912 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:43:43.293124 139894822974912 session_manager.py:500] Running local_init_op.
I0814 17:43:43.323575 139894822974912 session_manager.py:502] Done running local_init_op.
I0814 17:43:43.378623 139894822974912 tpu_estimator.py:557] Init TPU system
I0814 17:44:52.100712 139894822974912 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:44:52.101881 139893787322112 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:44:52.102696 139893778929408 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:44:52.168483 139894822974912 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:44:52.196681 139894822974912 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:44:52.197077 139894822974912 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:44:52.234298 139893770536704 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:44:52.316509 139893770536704 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:44:52.973578 139893778929408 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:44:53.269551 139894822974912 evaluation.py:167] Evaluation [10/10]
I0814 17:44:53.269896 139894822974912 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:44:53.269965 139894822974912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:44:53.270214 139893787322112 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:44:53.270559 139893787322112 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:44:53.270771 139894822974912 error_handling.py:96] infeed marked as finished
I0814 17:44:53.271078 139894822974912 tpu_estimator.py:602] Stop output thread controller
I0814 17:44:53.271132 139894822974912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:44:53.271289 139893778929408 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:44:53.271512 139893778929408 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:44:53.271693 139894822974912 error_handling.py:96] outfeed marked as finished
I0814 17:44:53.271909 139894822974912 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:45:22.394087 139894822974912 evaluation.py:275] Finished evaluation at 2019-08-14-17:45:22
I0814 17:45:22.394428 139894822974912 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0892, global_step = 30, loss = 200682.31
I0814 17:45:26.606761 139894822974912 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:45:27.377006 139894822974912 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 200682.31, 'global_step': 30, 'accuracy': 0.0892}

Removing gs://yangyou-mnist/log/#1565804527749436...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565804527.v3-8-tpu#1565804610785742...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565804540907949...
Removing gs://yangyou-mnist/log/checkpoint#1565804607678632...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565804604461982...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565804545288857...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565804605320590...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565804532770466...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565804539959400...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565804609876004...
Removing gs://yangyou-mnist/log/eval/#1565804724011906...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565804724.v3-8-tpu#1565804727048213...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:45:31.155704 139938102109632 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:45:31.156552 139938102109632 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:45:31.159198 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:45:31.160028 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:45:31.160945 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:45:31.161087 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:45:31.565706 139938102109632 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:45:31.572508 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:45:31.576076 139938102109632 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:45:31.679526 139938102109632 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:45:31.679805 139938102109632 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:45:31.850732 139938102109632 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:45:31.963239 139938102109632 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:45:31.963511 139938102109632 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:45:32.073729 139938102109632 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f45bb073190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f45bd252210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:45:32.074065 139938102109632 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:45:32.397964 139938102109632 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:45:32.400743: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:45:32.412563 139938102109632 tpu_system_metadata.py:148] Found TPU system:
I0814 17:45:32.412823 139938102109632 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:45:32.413362 139938102109632 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:45:32.413419 139938102109632 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:45:32.413471 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:45:32.413891 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:45:32.413949 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:45:32.413999 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:45:32.414047 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:45:32.414096 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:45:32.414160 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:45:32.414207 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:45:32.414254 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:45:32.414302 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:45:32.414349 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:45:32.420463 139938102109632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:45:32.433161 139938102109632 estimator.py:1145] Calling model_fn.
W0814 17:45:32.433788 139938102109632 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:45:32.703704 139938102109632 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:45:33.129522 139938102109632 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:45:33.190404 139938102109632 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:45:33.196429 139938102109632 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:45:33.385653 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:45:33.399363 139938102109632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:45:33.411377 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:45:33.412478 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:45:33.419657 139938102109632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:45:33.424992 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:45:33.425223 139938102109632 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 17:45:33.437710 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:45:33.546449 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:45:33.587610 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.632289 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.683020 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.844594 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.894586 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.941497 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.990885 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:34.035991 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:34.076162 139938102109632 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:45:34.092207 139938102109632 estimator.py:1147] Done calling model_fn.
I0814 17:45:38.436458 139938102109632 tpu_estimator.py:499] TPU job name worker
I0814 17:45:38.544878 139938102109632 monitored_session.py:240] Graph was finalized.
I0814 17:45:39.227183 139938102109632 session_manager.py:500] Running local_init_op.
I0814 17:45:39.287369 139938102109632 session_manager.py:502] Done running local_init_op.
I0814 17:45:42.133191 139938102109632 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:45:53.983195 139938102109632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:45:54.152751 139938102109632 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:45:54.153222 139938102109632 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:45:54.153699: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:45:54.158395 139938102109632 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:45:54.160495 139938102109632 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:45:54.164544 139938102109632 tpu_estimator.py:557] Init TPU system
I0814 17:46:36.121292 139938102109632 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:46:36.122193 139937189971712 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:46:36.122878 139937181579008 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:46:36.186428 139938102109632 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:46:36.187294 139938102109632 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:46:36.253182 139937173186304 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:46:36.439450 139937173186304 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:46:41.044446 139937181579008 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:46:45.857594 139938102109632 basic_session_run_hooks.py:262] loss = 2.1417282, step = 30
I0814 17:46:45.860230 139938102109632 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:46:58.729213 139938102109632 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:46:58.729515 139938102109632 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:46:58.729746 139937189971712 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:46:58.729857 139937189971712 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:46:58.729993 139938102109632 error_handling.py:96] infeed marked as finished
I0814 17:46:58.730098 139938102109632 tpu_estimator.py:602] Stop output thread controller
I0814 17:46:58.730145 139938102109632 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:46:58.730262 139937181579008 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:46:58.730349 139937181579008 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:46:58.730463 139938102109632 error_handling.py:96] outfeed marked as finished
I0814 17:46:58.730552 139938102109632 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:47:06.580017 139938102109632 estimator.py:368] Loss for final step: 2.1417282.
I0814 17:47:06.580842 139938102109632 error_handling.py:96] training_loop marked as finished
I0814 17:47:07.272459 139938102109632 estimator.py:1145] Calling model_fn.
E0814 17:47:08.007642 139938102109632 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:47:08.242865 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:47:08.266958 139938102109632 estimator.py:1147] Done calling model_fn.
I0814 17:47:08.285918 139938102109632 evaluation.py:255] Starting evaluation at 2019-08-14T17:47:08Z
I0814 17:47:08.286181 139938102109632 tpu_estimator.py:499] TPU job name worker
I0814 17:47:08.372951 139938102109632 monitored_session.py:240] Graph was finalized.
W0814 17:47:08.373768 139938102109632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:47:08.540229 139938102109632 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:47:11.851591 139938102109632 session_manager.py:500] Running local_init_op.
I0814 17:47:11.877760 139938102109632 session_manager.py:502] Done running local_init_op.
I0814 17:47:11.926246 139938102109632 tpu_estimator.py:557] Init TPU system
I0814 17:48:20.038640 139938102109632 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:48:20.039645 139937198364416 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:48:20.040134 139937189971712 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:48:20.131820 139938102109632 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:48:20.160727 139938102109632 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:48:20.161140 139938102109632 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:48:20.194849 139937181579008 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:48:20.317217 139937181579008 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:48:20.947518 139937189971712 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:48:21.251693 139938102109632 evaluation.py:167] Evaluation [10/10]
I0814 17:48:21.252011 139938102109632 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:48:21.252083 139938102109632 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:48:21.252300 139937198364416 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:48:21.252434 139937198364416 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:48:21.252743 139938102109632 error_handling.py:96] infeed marked as finished
I0814 17:48:21.252931 139938102109632 tpu_estimator.py:602] Stop output thread controller
I0814 17:48:21.253006 139938102109632 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:48:21.253142 139937189971712 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:48:21.253226 139937189971712 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:48:21.253578 139938102109632 error_handling.py:96] outfeed marked as finished
I0814 17:48:21.253865 139938102109632 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:48:50.400371 139938102109632 evaluation.py:275] Finished evaluation at 2019-08-14-17:48:50
I0814 17:48:50.401134 139938102109632 estimator.py:2039] Saving dict for global step 30: accuracy = 0.6722, global_step = 30, loss = 2.1346107
I0814 17:48:54.734021 139938102109632 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:48:55.518728 139938102109632 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.1346107, 'global_step': 30, 'accuracy': 0.6722}

Removing gs://yangyou-mnist/log/#1565804735684601...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565804749458223...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565804753461729...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565804735.v3-8-tpu#1565804818440689...
Removing gs://yangyou-mnist/log/checkpoint#1565804815548075...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565804741539227...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565804812681813...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565804748604786...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565804813566662...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565804817568393...
Removing gs://yangyou-mnist/log/eval/#1565804932119996...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565804932.v3-8-tpu#1565804935196257...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:48:59.321764 139754750731712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:48:59.322526 139754750731712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:48:59.325383 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:48:59.326219 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:48:59.326786 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:48:59.326911 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:48:59.734651 139754750731712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:48:59.741355 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:48:59.745131 139754750731712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:48:59.797450 139754750731712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:48:59.797734 139754750731712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:48:59.891968 139754750731712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:48:59.944180 139754750731712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:48:59.944494 139754750731712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:49:00.111449 139754750731712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1b0a6f3350>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1b0c8d2210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:49:00.111819 139754750731712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:49:00.457084 139754750731712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:49:00.459993: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:49:00.474510 139754750731712 tpu_system_metadata.py:148] Found TPU system:
I0814 17:49:00.474760 139754750731712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:49:00.475322 139754750731712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:49:00.475380 139754750731712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:49:00.475434 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:49:00.475857 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:49:00.475924 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:49:00.475975 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:49:00.476025 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:49:00.476073 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:49:00.476123 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:49:00.476171 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:49:00.476217 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:49:00.476263 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:49:00.476310 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:49:00.482557 139754750731712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:49:00.495445 139754750731712 estimator.py:1145] Calling model_fn.
W0814 17:49:00.496078 139754750731712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:49:00.780488 139754750731712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:49:01.299232 139754750731712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:49:01.360899 139754750731712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:49:01.366858 139754750731712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:49:01.549089 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:49:01.562983 139754750731712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:49:01.575047 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:49:01.576088 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:49:01.582971 139754750731712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:49:01.588150 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:49:01.588376 139754750731712 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 17:49:01.600879 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:49:01.710273 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:49:01.751261 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:01.795449 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:01.846235 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.014059 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.064224 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.113863 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.164427 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.210832 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.252057 139754750731712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:49:02.268625 139754750731712 estimator.py:1147] Done calling model_fn.
I0814 17:49:05.662265 139754750731712 tpu_estimator.py:499] TPU job name worker
I0814 17:49:05.771939 139754750731712 monitored_session.py:240] Graph was finalized.
I0814 17:49:06.433213 139754750731712 session_manager.py:500] Running local_init_op.
I0814 17:49:06.484270 139754750731712 session_manager.py:502] Done running local_init_op.
I0814 17:49:09.282258 139754750731712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:49:20.910053 139754750731712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:49:21.073530 139754750731712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:49:21.074014 139754750731712 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:49:21.074419: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:49:21.079359 139754750731712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:49:21.081660 139754750731712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:49:21.086714 139754750731712 tpu_estimator.py:557] Init TPU system
I0814 17:50:04.125765 139754750731712 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0814 17:50:04.126715 139753854588672 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:50:04.127151 139753846195968 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:50:04.192447 139754750731712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:50:04.193361 139754750731712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:50:04.252717 139753837803264 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:50:04.402867 139753837803264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:50:08.897512 139753846195968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:50:13.384923 139754750731712 basic_session_run_hooks.py:262] loss = 1.9154099, step = 30
I0814 17:50:13.387166 139754750731712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:50:26.890656 139754750731712 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:50:26.890959 139754750731712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:50:26.891182 139753854588672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:50:26.891299 139753854588672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:50:26.891446 139754750731712 error_handling.py:96] infeed marked as finished
I0814 17:50:26.891562 139754750731712 tpu_estimator.py:602] Stop output thread controller
I0814 17:50:26.891618 139754750731712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:50:26.891729 139753846195968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:50:26.891804 139753846195968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:50:26.891916 139754750731712 error_handling.py:96] outfeed marked as finished
I0814 17:50:26.891993 139754750731712 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:50:34.809513 139754750731712 estimator.py:368] Loss for final step: 1.9154099.
I0814 17:50:34.810400 139754750731712 error_handling.py:96] training_loop marked as finished
I0814 17:50:35.516103 139754750731712 estimator.py:1145] Calling model_fn.
E0814 17:50:36.232307 139754750731712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:50:36.461837 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:50:36.483678 139754750731712 estimator.py:1147] Done calling model_fn.
I0814 17:50:36.501022 139754750731712 evaluation.py:255] Starting evaluation at 2019-08-14T17:50:36Z
I0814 17:50:36.501261 139754750731712 tpu_estimator.py:499] TPU job name worker
I0814 17:50:36.579961 139754750731712 monitored_session.py:240] Graph was finalized.
W0814 17:50:36.580741 139754750731712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:50:36.771752 139754750731712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:50:39.260004 139754750731712 session_manager.py:500] Running local_init_op.
I0814 17:50:39.284558 139754750731712 session_manager.py:502] Done running local_init_op.
I0814 17:50:39.342138 139754750731712 tpu_estimator.py:557] Init TPU system
I0814 17:51:48.043863 139754750731712 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:51:48.044944 139753850918656 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:51:48.045831 139753842525952 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:51:48.113940 139754750731712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:51:48.138303 139754750731712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:51:48.138660 139754750731712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:51:48.166533 139753829148416 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:51:48.286889 139753829148416 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:51:48.938724 139753842525952 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:51:49.251777 139754750731712 evaluation.py:167] Evaluation [10/10]
I0814 17:51:49.252146 139754750731712 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:51:49.252237 139754750731712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:51:49.252623 139753850918656 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:51:49.252904 139753850918656 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:51:49.253174 139754750731712 error_handling.py:96] infeed marked as finished
I0814 17:51:49.253406 139754750731712 tpu_estimator.py:602] Stop output thread controller
I0814 17:51:49.253469 139754750731712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:51:49.253664 139753842525952 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:51:49.253823 139753842525952 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:51:49.254014 139754750731712 error_handling.py:96] outfeed marked as finished
I0814 17:51:49.254194 139754750731712 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:52:18.375199 139754750731712 evaluation.py:275] Finished evaluation at 2019-08-14-17:52:18
I0814 17:52:18.375638 139754750731712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7591, global_step = 30, loss = 1.9054855
I0814 17:52:22.641433 139754750731712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:52:23.432240 139754750731712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.9054855, 'global_step': 30, 'accuracy': 0.7591}

Removing gs://yangyou-mnist/log/#1565804943747625...
Removing gs://yangyou-mnist/log/checkpoint#1565805023212619...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565804943.v3-8-tpu#1565805026582005...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565804956084903...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565804955248473...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565804948694840...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565805020180789...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565805021040445...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565804960400009...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565805025542644...
Removing gs://yangyou-mnist/log/eval/#1565805140019242...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565805140.v3-8-tpu#1565805143128684...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:52:27.534907 140044267435456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:52:27.535721 140044267435456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:52:27.538322 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:52:27.539139 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:52:27.539722 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:52:27.539849 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:52:27.953311 140044267435456 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:52:27.960894 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:52:27.965190 140044267435456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:52:28.020525 140044267435456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:52:28.020831 140044267435456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:52:28.134306 140044267435456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:52:28.244190 140044267435456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:52:28.244514 140044267435456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:52:28.414736 140044267435456 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5e72f81250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5e75177210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:52:28.415117 140044267435456 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:52:28.739953 140044267435456 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:52:28.743256: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:52:28.758064 140044267435456 tpu_system_metadata.py:148] Found TPU system:
I0814 17:52:28.758310 140044267435456 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:52:28.758910 140044267435456 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:52:28.758970 140044267435456 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:52:28.759028 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:52:28.759392 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:52:28.759449 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:52:28.759499 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:52:28.759547 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:52:28.759594 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:52:28.759640 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:52:28.759686 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:52:28.759742 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:52:28.759788 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:52:28.759836 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:52:28.765902 140044267435456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:52:28.780167 140044267435456 estimator.py:1145] Calling model_fn.
W0814 17:52:28.780853 140044267435456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:52:29.045900 140044267435456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:52:29.452647 140044267435456 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:52:29.513274 140044267435456 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:52:29.519110 140044267435456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:52:29.699728 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:52:29.713315 140044267435456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:52:29.725603 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:52:29.726681 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:52:29.733864 140044267435456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:52:29.739155 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:52:29.739377 140044267435456 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 17:52:29.751935 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:52:29.862751 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:52:29.904246 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:29.948836 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.000261 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.169646 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.219403 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.269484 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.320096 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.366811 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.409003 140044267435456 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:52:30.425591 140044267435456 estimator.py:1147] Done calling model_fn.
I0814 17:52:33.859828 140044267435456 tpu_estimator.py:499] TPU job name worker
I0814 17:52:33.972203 140044267435456 monitored_session.py:240] Graph was finalized.
I0814 17:52:34.642605 140044267435456 session_manager.py:500] Running local_init_op.
I0814 17:52:34.702327 140044267435456 session_manager.py:502] Done running local_init_op.
I0814 17:52:37.480849 140044267435456 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:52:49.559148 140044267435456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:52:49.723694 140044267435456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:52:49.724189 140044267435456 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:52:49.724726: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:52:49.730525 140044267435456 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:52:49.733606 140044267435456 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:52:49.742607 140044267435456 tpu_estimator.py:557] Init TPU system
I0814 17:53:32.132013 140044267435456 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:53:32.132934 140043364587264 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:53:32.133501 140043356194560 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:53:32.197379 140043347801856 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:53:32.200249 140044267435456 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:53:32.201755 140044267435456 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:53:32.379008 140043347801856 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:53:36.932826 140043356194560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:53:41.658951 140044267435456 basic_session_run_hooks.py:262] loss = 1.4342101, step = 30
I0814 17:53:41.661727 140044267435456 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:53:54.988013 140044267435456 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:53:54.988336 140044267435456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:53:54.988703 140043364587264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:53:54.989001 140043364587264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:53:54.989232 140044267435456 error_handling.py:96] infeed marked as finished
I0814 17:53:54.989487 140044267435456 tpu_estimator.py:602] Stop output thread controller
I0814 17:53:54.989550 140044267435456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:53:54.989748 140043356194560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:53:54.990016 140043356194560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:53:54.990252 140044267435456 error_handling.py:96] outfeed marked as finished
I0814 17:53:54.990410 140044267435456 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:54:02.518925 140044267435456 estimator.py:368] Loss for final step: 1.4342101.
I0814 17:54:02.519736 140044267435456 error_handling.py:96] training_loop marked as finished
I0814 17:54:03.325839 140044267435456 estimator.py:1145] Calling model_fn.
E0814 17:54:04.022561 140044267435456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:54:04.254884 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:54:04.277719 140044267435456 estimator.py:1147] Done calling model_fn.
I0814 17:54:04.294838 140044267435456 evaluation.py:255] Starting evaluation at 2019-08-14T17:54:04Z
I0814 17:54:04.295070 140044267435456 tpu_estimator.py:499] TPU job name worker
I0814 17:54:04.372792 140044267435456 monitored_session.py:240] Graph was finalized.
W0814 17:54:04.373531 140044267435456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:54:04.597706 140044267435456 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:54:07.246196 140044267435456 session_manager.py:500] Running local_init_op.
I0814 17:54:07.277206 140044267435456 session_manager.py:502] Done running local_init_op.
I0814 17:54:07.333537 140044267435456 tpu_estimator.py:557] Init TPU system
I0814 17:55:16.094132 140044267435456 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:55:16.095051 140043364587264 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:55:16.095592 140043356194560 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:55:16.161449 140044267435456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:55:16.189199 140044267435456 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:55:16.189547 140044267435456 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:55:16.215007 140043347801856 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:55:16.423830 140043347801856 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:55:16.939863 140043356194560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:55:17.344589 140044267435456 evaluation.py:167] Evaluation [10/10]
I0814 17:55:17.345068 140044267435456 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:55:17.345145 140044267435456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:55:17.345357 140043364587264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:55:17.345462 140043364587264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:55:17.345598 140044267435456 error_handling.py:96] infeed marked as finished
I0814 17:55:17.345706 140044267435456 tpu_estimator.py:602] Stop output thread controller
I0814 17:55:17.345756 140044267435456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:55:17.345891 140043356194560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:55:17.346040 140043356194560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:55:17.346159 140044267435456 error_handling.py:96] outfeed marked as finished
I0814 17:55:17.346246 140044267435456 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:55:46.520782 140044267435456 evaluation.py:275] Finished evaluation at 2019-08-14-17:55:46
I0814 17:55:46.521114 140044267435456 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8168, global_step = 30, loss = 1.3891516
I0814 17:55:50.791774 140044267435456 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:55:51.696712 140044267435456 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.3891516, 'global_step': 30, 'accuracy': 0.8168}

Removing gs://yangyou-mnist/log/#1565805151976443...
Removing gs://yangyou-mnist/log/checkpoint#1565805231421089...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565805164526685...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565805152.v3-8-tpu#1565805234677201...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565805156909479...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565805228297926...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565805169044167...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565805163653464...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565805229190821...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565805233735107...
Removing gs://yangyou-mnist/log/eval/#1565805348177390...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565805348.v3-8-tpu#1565805351407197...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:55:55.421936 139978773259712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:55:55.422710 139978773259712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:55:55.425340 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:55:55.426166 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:55:55.426754 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:55:55.426886 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:55:55.830066 139978773259712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:55:55.838129 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:55:55.842586 139978773259712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:55:55.890080 139978773259712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:55:55.890412 139978773259712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:55:56.008471 139978773259712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:55:56.064191 139978773259712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:55:56.064507 139978773259712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:55:56.160876 139978773259712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4f33364310>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4f3555a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:55:56.161222 139978773259712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:55:56.483733 139978773259712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:55:56.486742: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:55:56.499314 139978773259712 tpu_system_metadata.py:148] Found TPU system:
I0814 17:55:56.499564 139978773259712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:55:56.500179 139978773259712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:55:56.500236 139978773259712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:55:56.500291 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:55:56.500674 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:55:56.500744 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:55:56.500794 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:55:56.500859 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:55:56.500907 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:55:56.500955 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:55:56.501002 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:55:56.501055 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:55:56.501104 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:55:56.501152 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:55:56.507160 139978773259712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:55:56.519784 139978773259712 estimator.py:1145] Calling model_fn.
W0814 17:55:56.520395 139978773259712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:55:56.789361 139978773259712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:55:57.229922 139978773259712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:55:57.297715 139978773259712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:55:57.303733 139978773259712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:55:57.484189 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:55:57.497734 139978773259712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:55:57.509710 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:55:57.510788 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:55:57.517916 139978773259712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:55:57.523189 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:55:57.523403 139978773259712 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 17:55:57.535967 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:55:57.645834 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:55:57.687509 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:57.732070 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:57.783286 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:57.949615 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:57.999414 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:58.047832 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:58.104615 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:58.150274 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:58.192296 139978773259712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:55:58.208782 139978773259712 estimator.py:1147] Done calling model_fn.
I0814 17:56:01.708295 139978773259712 tpu_estimator.py:499] TPU job name worker
I0814 17:56:01.820060 139978773259712 monitored_session.py:240] Graph was finalized.
I0814 17:56:02.470223 139978773259712 session_manager.py:500] Running local_init_op.
I0814 17:56:02.520301 139978773259712 session_manager.py:502] Done running local_init_op.
I0814 17:56:05.170803 139978773259712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:56:17.229655 139978773259712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:56:17.373357 139978773259712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:56:17.375197 139978773259712 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:56:17.375760: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:56:17.380500 139978773259712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:56:17.382719 139978773259712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:56:17.386861 139978773259712 tpu_estimator.py:557] Init TPU system
I0814 17:57:00.118247 139978773259712 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:57:00.119313 139977732118272 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:57:00.119862 139977723725568 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:57:00.180111 139977715332864 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:57:00.186314 139978773259712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:57:00.187046 139978773259712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:57:00.433883 139977715332864 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:57:04.849188 139977723725568 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:57:09.568948 139978773259712 basic_session_run_hooks.py:262] loss = 0.8892836, step = 30
I0814 17:57:09.571723 139978773259712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:57:24.628309 139978773259712 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:57:24.628686 139978773259712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:57:24.630331 139977732118272 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:57:24.630480 139977732118272 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:57:24.630621 139978773259712 error_handling.py:96] infeed marked as finished
I0814 17:57:24.630738 139978773259712 tpu_estimator.py:602] Stop output thread controller
I0814 17:57:24.630876 139978773259712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:57:24.631002 139977723725568 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:57:24.631079 139977723725568 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:57:24.631195 139978773259712 error_handling.py:96] outfeed marked as finished
I0814 17:57:24.631288 139978773259712 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:57:30.566610 139978773259712 estimator.py:368] Loss for final step: 0.8892836.
I0814 17:57:30.567394 139978773259712 error_handling.py:96] training_loop marked as finished
I0814 17:57:31.401679 139978773259712 estimator.py:1145] Calling model_fn.
E0814 17:57:32.100879 139978773259712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:57:32.337479 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:57:32.360277 139978773259712 estimator.py:1147] Done calling model_fn.
I0814 17:57:32.377051 139978773259712 evaluation.py:255] Starting evaluation at 2019-08-14T17:57:32Z
I0814 17:57:32.377307 139978773259712 tpu_estimator.py:499] TPU job name worker
I0814 17:57:32.458324 139978773259712 monitored_session.py:240] Graph was finalized.
W0814 17:57:32.459121 139978773259712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:57:32.652923 139978773259712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:57:35.228755 139978773259712 session_manager.py:500] Running local_init_op.
I0814 17:57:35.253137 139978773259712 session_manager.py:502] Done running local_init_op.
I0814 17:57:35.312235 139978773259712 tpu_estimator.py:557] Init TPU system
I0814 17:58:44.137368 139978773259712 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:58:44.138483 139977732118272 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:58:44.139298 139977723725568 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:58:44.207206 139978773259712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:58:44.236723 139978773259712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:58:44.237102 139978773259712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:58:44.268162 139977715332864 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:58:44.424520 139977715332864 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:58:45.022901 139977723725568 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:58:45.341099 139978773259712 evaluation.py:167] Evaluation [10/10]
I0814 17:58:45.341542 139978773259712 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:58:45.341634 139978773259712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:58:45.341928 139977732118272 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:58:45.342228 139977732118272 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:58:45.342494 139978773259712 error_handling.py:96] infeed marked as finished
I0814 17:58:45.342653 139978773259712 tpu_estimator.py:602] Stop output thread controller
I0814 17:58:45.342704 139978773259712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:58:45.342885 139977723725568 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:58:45.343077 139977723725568 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:58:45.343278 139978773259712 error_handling.py:96] outfeed marked as finished
I0814 17:58:45.343488 139978773259712 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:59:14.523720 139978773259712 evaluation.py:275] Finished evaluation at 2019-08-14-17:59:14
I0814 17:59:14.524111 139978773259712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8264, global_step = 30, loss = 0.82866657
I0814 17:59:19.090161 139978773259712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:59:19.925352 139978773259712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.82866657, 'global_step': 30, 'accuracy': 0.8264}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565805372422049...
Removing gs://yangyou-mnist/log/#1565805359659163...
Removing gs://yangyou-mnist/log/checkpoint#1565805440958132...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565805359.v3-8-tpu#1565805444316370...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565805376745936...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565805364626294...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565805437908010...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565805371601891...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565805438736792...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565805443265152...
Removing gs://yangyou-mnist/log/eval/#1565805556227118...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565805556.v3-8-tpu#1565805559569515...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:59:23.759295 140206887175616 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:59:23.760107 140206887175616 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:59:23.762710 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:59:23.763530 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:59:23.764100 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:59:23.764230 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:59:24.168870 140206887175616 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:59:24.176397 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:59:24.180644 140206887175616 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:59:24.297714 140206887175616 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:59:24.297991 140206887175616 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:59:24.396243 140206887175616 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:59:24.450087 140206887175616 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:59:24.450382 140206887175616 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:59:24.587450 140206887175616 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f844fddd190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8451fbc210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:59:24.587868 140206887175616 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:59:24.912631 140206887175616 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:59:24.915411: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:59:24.928338 140206887175616 tpu_system_metadata.py:148] Found TPU system:
I0814 17:59:24.928621 140206887175616 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:59:24.929104 140206887175616 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:59:24.929161 140206887175616 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:59:24.929219 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:59:24.929506 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:59:24.929560 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:59:24.929621 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:59:24.929670 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:59:24.929717 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:59:24.929761 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:59:24.929807 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:59:24.929860 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:59:24.929904 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:59:24.929964 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:59:24.936110 140206887175616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:59:24.948633 140206887175616 estimator.py:1145] Calling model_fn.
W0814 17:59:24.949229 140206887175616 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:59:25.219566 140206887175616 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:59:25.675761 140206887175616 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:59:25.737804 140206887175616 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:59:25.743889 140206887175616 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:59:25.922068 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:59:25.935549 140206887175616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:59:25.947722 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:59:25.948823 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:59:25.955697 140206887175616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:59:25.960922 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:59:25.961138 140206887175616 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 17:59:25.973278 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:59:26.081175 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:59:26.129235 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.172955 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.224886 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.389008 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.439383 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.488027 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.538151 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.583607 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.624222 140206887175616 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:59:26.639998 140206887175616 estimator.py:1147] Done calling model_fn.
I0814 17:59:30.030416 140206887175616 tpu_estimator.py:499] TPU job name worker
I0814 17:59:30.147332 140206887175616 monitored_session.py:240] Graph was finalized.
I0814 17:59:30.817852 140206887175616 session_manager.py:500] Running local_init_op.
I0814 17:59:30.866223 140206887175616 session_manager.py:502] Done running local_init_op.
I0814 17:59:35.552565 140206887175616 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:59:48.122467 140206887175616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:59:48.292033 140206887175616 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:59:48.292555 140206887175616 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:59:48.292971: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:59:48.298837 140206887175616 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:59:48.301492 140206887175616 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:59:48.306266 140206887175616 tpu_estimator.py:557] Init TPU system
I0814 18:00:28.033720 140206887175616 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 18:00:28.034861 140205851932416 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:00:28.035896 140205843539712 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:00:28.097999 140205835147008 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:00:28.124742 140206887175616 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:00:28.125600 140206887175616 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:00:28.216713 140205835147008 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:00:32.877161 140205843539712 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:00:37.516247 140206887175616 basic_session_run_hooks.py:262] loss = 0.6425506, step = 30
I0814 18:00:37.519373 140206887175616 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:00:51.256309 140206887175616 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:00:51.256638 140206887175616 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:00:51.256824 140205851932416 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:00:51.256912 140205851932416 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:00:51.257035 140206887175616 error_handling.py:96] infeed marked as finished
I0814 18:00:51.257133 140206887175616 tpu_estimator.py:602] Stop output thread controller
I0814 18:00:51.257196 140206887175616 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:00:51.257309 140205843539712 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:00:51.257390 140205843539712 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:00:51.257505 140206887175616 error_handling.py:96] outfeed marked as finished
I0814 18:00:51.257586 140206887175616 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:00:58.347961 140206887175616 estimator.py:368] Loss for final step: 0.6425506.
I0814 18:00:58.348810 140206887175616 error_handling.py:96] training_loop marked as finished
I0814 18:00:59.229146 140206887175616 estimator.py:1145] Calling model_fn.
E0814 18:00:59.914640 140206887175616 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:01:00.142427 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:01:00.163611 140206887175616 estimator.py:1147] Done calling model_fn.
I0814 18:01:00.179620 140206887175616 evaluation.py:255] Starting evaluation at 2019-08-14T18:01:00Z
I0814 18:01:00.179856 140206887175616 tpu_estimator.py:499] TPU job name worker
I0814 18:01:00.258059 140206887175616 monitored_session.py:240] Graph was finalized.
W0814 18:01:00.258817 140206887175616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:01:00.453092 140206887175616 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:01:03.110733 140206887175616 session_manager.py:500] Running local_init_op.
I0814 18:01:03.135641 140206887175616 session_manager.py:502] Done running local_init_op.
I0814 18:01:03.192315 140206887175616 tpu_estimator.py:557] Init TPU system
I0814 18:02:12.031619 140206887175616 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:02:12.032782 140205851932416 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:02:12.033715 140205843539712 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:02:12.108459 140206887175616 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:02:12.135737 140206887175616 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:02:12.136121 140206887175616 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:02:12.169275 140205835147008 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:02:12.276494 140205835147008 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:02:12.904613 140205843539712 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:02:13.208710 140206887175616 evaluation.py:167] Evaluation [10/10]
I0814 18:02:13.209112 140206887175616 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:02:13.209203 140206887175616 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:02:13.209527 140205851932416 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:02:13.209855 140205851932416 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:02:13.210099 140206887175616 error_handling.py:96] infeed marked as finished
I0814 18:02:13.210304 140206887175616 tpu_estimator.py:602] Stop output thread controller
I0814 18:02:13.210431 140206887175616 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:02:13.210864 140205843539712 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:02:13.211050 140205843539712 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:02:13.211267 140206887175616 error_handling.py:96] outfeed marked as finished
I0814 18:02:13.211457 140206887175616 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:02:42.373843 140206887175616 evaluation.py:275] Finished evaluation at 2019-08-14-18:02:42
I0814 18:02:42.374193 140206887175616 estimator.py:2039] Saving dict for global step 30: accuracy = 0.863, global_step = 30, loss = 0.5889317
I0814 18:02:46.574275 140206887175616 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:02:47.485526 140206887175616 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.5889317, 'global_step': 30, 'accuracy': 0.863}

Removing gs://yangyou-mnist/log/events.out.tfevents.1565805568.v3-8-tpu#1565805650936187...
Removing gs://yangyou-mnist/log/checkpoint#1565805647559200...
Removing gs://yangyou-mnist/log/#1565805568193983...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565805574954987...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565805582226769...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565805587597361...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565805583117780...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565805644433157...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565805645311565...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565805649938279...
Removing gs://yangyou-mnist/log/eval/#1565805764033407...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565805764.v3-8-tpu#1565805767159112...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:02:51.286230 140390262437312 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:02:51.286993 140390262437312 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:02:51.289588 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:02:51.290422 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:02:51.291006 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:02:51.291136 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:02:51.698998 140390262437312 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:02:51.706862 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:02:51.710732 140390262437312 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:02:51.763158 140390262437312 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:02:51.763437 140390262437312 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:02:51.869345 140390262437312 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:02:51.988166 140390262437312 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:02:51.988467 140390262437312 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:02:52.192657 140390262437312 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7faf01e0d3d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7faf04003210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:02:52.193048 140390262437312 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:02:52.519264 140390262437312 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:02:52.522415: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:02:52.536528 140390262437312 tpu_system_metadata.py:148] Found TPU system:
I0814 18:02:52.536765 140390262437312 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:02:52.537249 140390262437312 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:02:52.537307 140390262437312 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:02:52.537362 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:02:52.537640 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:02:52.537695 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:02:52.537745 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:02:52.537792 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:02:52.537839 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:02:52.537885 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:02:52.537931 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:02:52.537977 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:02:52.538022 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:02:52.538069 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:02:52.543984 140390262437312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:02:52.556174 140390262437312 estimator.py:1145] Calling model_fn.
W0814 18:02:52.556807 140390262437312 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:02:52.828882 140390262437312 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:02:53.272891 140390262437312 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:02:53.334518 140390262437312 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:02:53.340364 140390262437312 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:02:53.520879 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:02:53.534506 140390262437312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:02:53.546706 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:02:53.547751 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:02:53.554769 140390262437312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:02:53.560014 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:02:53.560239 140390262437312 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:02:53.572567 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:02:53.680984 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:02:53.721893 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:53.766500 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:53.818775 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:53.982589 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:54.032246 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:54.081012 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:54.138721 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:54.184432 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:54.226469 140390262437312 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:02:54.243412 140390262437312 estimator.py:1147] Done calling model_fn.
I0814 18:02:57.712296 140390262437312 tpu_estimator.py:499] TPU job name worker
I0814 18:02:57.820007 140390262437312 monitored_session.py:240] Graph was finalized.
I0814 18:02:58.487760 140390262437312 session_manager.py:500] Running local_init_op.
I0814 18:02:58.547858 140390262437312 session_manager.py:502] Done running local_init_op.
I0814 18:03:01.346405 140390262437312 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:03:13.539187 140390262437312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:03:13.696787 140390262437312 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:03:13.697242 140390262437312 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:03:13.697651: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:03:13.702663 140390262437312 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:03:13.704878 140390262437312 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:03:13.710359 140390262437312 tpu_estimator.py:557] Init TPU system
I0814 18:03:56.116142 140390262437312 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 18:03:56.117345 140389366089472 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:03:56.118129 140389357696768 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:03:56.182048 140390262437312 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:03:56.184341 140390262437312 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 18:03:56.191678 140389349304064 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:03:56.355429 140389349304064 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:04:00.932945 140389357696768 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:04:05.572829 140390262437312 basic_session_run_hooks.py:262] loss = 0.4675296, step = 30
I0814 18:04:05.575110 140390262437312 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:04:19.202739 140390262437312 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:04:19.203238 140390262437312 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:04:19.203558 140389366089472 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:04:19.204008 140389366089472 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:04:19.204530 140390262437312 error_handling.py:96] infeed marked as finished
I0814 18:04:19.204725 140390262437312 tpu_estimator.py:602] Stop output thread controller
I0814 18:04:19.204782 140390262437312 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:04:19.204977 140389357696768 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:04:19.205255 140389357696768 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:04:19.205497 140390262437312 error_handling.py:96] outfeed marked as finished
I0814 18:04:19.205648 140390262437312 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:04:26.504281 140390262437312 estimator.py:368] Loss for final step: 0.4675296.
I0814 18:04:26.505197 140390262437312 error_handling.py:96] training_loop marked as finished
I0814 18:04:27.286472 140390262437312 estimator.py:1145] Calling model_fn.
E0814 18:04:27.976898 140390262437312 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:04:28.202512 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:04:28.223458 140390262437312 estimator.py:1147] Done calling model_fn.
I0814 18:04:28.239397 140390262437312 evaluation.py:255] Starting evaluation at 2019-08-14T18:04:28Z
I0814 18:04:28.239650 140390262437312 tpu_estimator.py:499] TPU job name worker
I0814 18:04:28.317456 140390262437312 monitored_session.py:240] Graph was finalized.
W0814 18:04:28.318239 140390262437312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:04:29.102158 140390262437312 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:04:31.634990 140390262437312 session_manager.py:500] Running local_init_op.
I0814 18:04:31.659962 140390262437312 session_manager.py:502] Done running local_init_op.
I0814 18:04:31.710313 140390262437312 tpu_estimator.py:557] Init TPU system
I0814 18:05:40.045058 140390262437312 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:05:40.045918 140389362419456 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:05:40.046380 140389354026752 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:05:40.112601 140390262437312 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:05:40.137510 140390262437312 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:05:40.137862 140390262437312 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:05:40.177469 140389340649216 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:05:40.940011 140389354026752 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
W0814 18:05:41.054797 140389340649216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:05:41.277532 140390262437312 evaluation.py:167] Evaluation [10/10]
I0814 18:05:41.277863 140390262437312 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:05:41.277937 140390262437312 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:05:41.278121 140389362419456 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:05:41.278213 140389362419456 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:05:41.278352 140390262437312 error_handling.py:96] infeed marked as finished
I0814 18:05:41.278439 140390262437312 tpu_estimator.py:602] Stop output thread controller
I0814 18:05:41.278486 140390262437312 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:05:41.278599 140389354026752 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:05:41.278696 140389354026752 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:05:41.278814 140390262437312 error_handling.py:96] outfeed marked as finished
I0814 18:05:41.278898 140390262437312 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:06:11.128855 140390262437312 evaluation.py:275] Finished evaluation at 2019-08-14-18:06:11
I0814 18:06:11.129178 140390262437312 estimator.py:2039] Saving dict for global step 30: accuracy = 0.891, global_step = 30, loss = 0.44235554
I0814 18:06:15.531778 140390262437312 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:06:16.353367 140390262437312 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.44235554, 'global_step': 30, 'accuracy': 0.891}

Removing gs://yangyou-mnist/log/#1565805775735127...
Removing gs://yangyou-mnist/log/checkpoint#1565805855755329...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565805788696956...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565805775.v3-8-tpu#1565805858898423...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565805780761491...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565805793016242...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565805787790347...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565805852589398...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565805853462109...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565805857925459...
Removing gs://yangyou-mnist/log/eval/#1565805972808075...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565805972.v3-8-tpu#1565805976061593...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:06:20.038815 139883997414848 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:06:20.039621 139883997414848 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:06:20.042355 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:06:20.043200 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:06:20.043812 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:06:20.043943 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:06:20.465480 139883997414848 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:06:20.472888 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:06:20.476984 139883997414848 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:06:20.535749 139883997414848 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:06:20.536058 139883997414848 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:06:20.793981 139883997414848 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:06:20.852302 139883997414848 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:06:20.852615 139883997414848 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:06:21.116167 139883997414848 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3922231210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3924410210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:06:21.116569 139883997414848 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:06:21.426177 139883997414848 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:06:21.429307: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:06:21.441313 139883997414848 tpu_system_metadata.py:148] Found TPU system:
I0814 18:06:21.441555 139883997414848 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:06:21.442075 139883997414848 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:06:21.442142 139883997414848 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:06:21.442194 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:06:21.442476 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:06:21.442533 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:06:21.442595 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:06:21.442646 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:06:21.442727 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:06:21.442774 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:06:21.442820 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:06:21.442864 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:06:21.442917 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:06:21.442966 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:06:21.449471 139883997414848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:06:21.462338 139883997414848 estimator.py:1145] Calling model_fn.
W0814 18:06:21.462940 139883997414848 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:06:21.759181 139883997414848 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:06:22.240303 139883997414848 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:06:22.302462 139883997414848 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:06:22.308450 139883997414848 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:06:22.488965 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:06:22.502866 139883997414848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:06:22.515089 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:06:22.516153 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:06:22.523165 139883997414848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:06:22.528512 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:06:22.528723 139883997414848 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:06:22.541446 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:06:22.651530 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:06:22.693516 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:22.738815 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:22.789917 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:22.956257 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:23.006417 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:23.055577 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:23.106450 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:23.153737 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:23.195669 139883997414848 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:06:23.212061 139883997414848 estimator.py:1147] Done calling model_fn.
I0814 18:06:26.588330 139883997414848 tpu_estimator.py:499] TPU job name worker
I0814 18:06:26.700690 139883997414848 monitored_session.py:240] Graph was finalized.
I0814 18:06:27.344583 139883997414848 session_manager.py:500] Running local_init_op.
I0814 18:06:27.393368 139883997414848 session_manager.py:502] Done running local_init_op.
I0814 18:06:29.967585 139883997414848 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:06:42.190201 139883997414848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:06:42.355948 139883997414848 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:06:42.356380 139883997414848 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:06:42.356803: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:06:42.361701 139883997414848 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:06:42.363876 139883997414848 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:06:42.368297 139883997414848 tpu_estimator.py:557] Init TPU system
I0814 18:07:24.129581 139883997414848 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 18:07:24.130548 139883101280000 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:07:24.131004 139883092887296 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:07:24.194194 139883084494592 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:07:24.196741 139883997414848 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:07:24.197928 139883997414848 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:07:24.386814 139883084494592 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:07:28.925771 139883092887296 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:07:33.593555 139883997414848 basic_session_run_hooks.py:262] loss = 0.22694764, step = 30
I0814 18:07:33.596000 139883997414848 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:07:48.401870 139883997414848 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:07:48.402172 139883997414848 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:07:48.402391 139883101280000 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:07:48.402503 139883101280000 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:07:48.402640 139883997414848 error_handling.py:96] infeed marked as finished
I0814 18:07:48.402736 139883997414848 tpu_estimator.py:602] Stop output thread controller
I0814 18:07:48.402785 139883997414848 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:07:48.402892 139883092887296 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:07:48.402962 139883092887296 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:07:48.403069 139883997414848 error_handling.py:96] outfeed marked as finished
I0814 18:07:48.403151 139883997414848 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:07:54.522712 139883997414848 estimator.py:368] Loss for final step: 0.22694764.
I0814 18:07:54.523653 139883997414848 error_handling.py:96] training_loop marked as finished
I0814 18:07:55.335495 139883997414848 estimator.py:1145] Calling model_fn.
E0814 18:07:56.031929 139883997414848 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:07:56.258137 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:07:56.279787 139883997414848 estimator.py:1147] Done calling model_fn.
I0814 18:07:56.296125 139883997414848 evaluation.py:255] Starting evaluation at 2019-08-14T18:07:56Z
I0814 18:07:56.296370 139883997414848 tpu_estimator.py:499] TPU job name worker
I0814 18:07:56.373168 139883997414848 monitored_session.py:240] Graph was finalized.
W0814 18:07:56.373950 139883997414848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:07:56.564754 139883997414848 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:07:59.355593 139883997414848 session_manager.py:500] Running local_init_op.
I0814 18:07:59.379395 139883997414848 session_manager.py:502] Done running local_init_op.
I0814 18:07:59.434596 139883997414848 tpu_estimator.py:557] Init TPU system
I0814 18:09:08.077927 139883997414848 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:09:08.079051 139883097609984 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:09:08.079515 139883089217280 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:09:08.149059 139883997414848 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:09:08.173568 139883997414848 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:09:08.173919 139883997414848 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:09:08.210429 139883075839744 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:09:08.381752 139883075839744 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:09:08.982950 139883089217280 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:09:09.281531 139883997414848 evaluation.py:167] Evaluation [10/10]
I0814 18:09:09.281934 139883997414848 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:09:09.282022 139883997414848 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:09:09.282193 139883097609984 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:09:09.282285 139883097609984 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:09:09.282418 139883997414848 error_handling.py:96] infeed marked as finished
I0814 18:09:09.282507 139883997414848 tpu_estimator.py:602] Stop output thread controller
I0814 18:09:09.282556 139883997414848 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:09:09.282661 139883089217280 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:09:09.282835 139883089217280 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:09:09.282957 139883997414848 error_handling.py:96] outfeed marked as finished
I0814 18:09:09.283036 139883997414848 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:09:38.481161 139883997414848 evaluation.py:275] Finished evaluation at 2019-08-14-18:09:38
I0814 18:09:38.481483 139883997414848 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9404, global_step = 30, loss = 0.23294409
I0814 18:09:42.793234 139883997414848 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:09:43.551460 139883997414848 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.23294409, 'global_step': 30, 'accuracy': 0.9404}

Removing gs://yangyou-mnist/log/#1565805984694370...
Removing gs://yangyou-mnist/log/checkpoint#1565806063536725...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565805984.v3-8-tpu#1565806067347729...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565806001726129...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565805997178652...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565806060577559...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565806061480110...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565805989437089...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565805996309588...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565806065894431...
Removing gs://yangyou-mnist/log/eval/#1565806180147583...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565806180.v3-8-tpu#1565806183244335...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:09:47.377491 140075262924224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:09:47.378267 140075262924224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:09:47.380883 140075262924224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:09:47.381669 140075262924224 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:09:47.382277 140075262924224 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:09:47.382402 140075262924224 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:09:47.806083 140075262924224 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:09:47.813937 140075262924224 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:09:47.818109 140075262924224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:09:47.863836 140075262924224 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:09:47.864136 140075262924224 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:09:48.138761 140075262924224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:09:48.198086 140075262924224 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:09:48.198379 140075262924224 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:09:48.402820 140075262924224 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f65aa732090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f65ac911210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:09:48.403209 140075262924224 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:09:48.738328 140075262924224 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:09:48.741470: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:09:48.755568 140075262924224 tpu_system_metadata.py:148] Found TPU system:
I0814 18:09:48.755892 140075262924224 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:09:48.756382 140075262924224 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:09:48.756474 140075262924224 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:09:48.756531 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:09:48.756850 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:09:48.756906 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:09:48.756966 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:09:48.757014 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:09:48.757064 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:09:48.757110 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:09:48.757163 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:09:48.757214 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:09:48.757261 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:09:48.757308 140075262924224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:09:48.763533 140075262924224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:09:48.777060 140075262924224 estimator.py:1145] Calling model_fn.
W0814 18:09:48.777760 140075262924224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:09:49.054455 140075262924224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:09:49.478467 140075262924224 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:09:49.539624 140075262924224 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:09:49.545533 140075262924224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:09:49.721838 140075262924224 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:09:49.736013 140075262924224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:09:49.748069 140075262924224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:09:49.749156 140075262924224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:09:49.756194 140075262924224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:09:49.761392 140075262924224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:09:49.761610 140075262924224 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:09:49.773895 140075262924224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:09:49.881812 140075262924224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:09:49.922353 140075262924224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:09:49.965934 140075262924224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:09:50.016745 140075262924224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:09:50.189735 140075262924224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:09:50.239454 140075262924224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:09:50.295720 140075262924224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:09:50.345472 140075262924224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:09:50.390381 140075262924224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:09:50.431606 140075262924224 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:09:50.448055 140075262924224 estimator.py:1147] Done calling model_fn.
I0814 18:09:53.924026 140075262924224 tpu_estimator.py:499] TPU job name worker
I0814 18:09:54.039195 140075262924224 monitored_session.py:240] Graph was finalized.
I0814 18:09:54.765927 140075262924224 session_manager.py:500] Running local_init_op.
I0814 18:09:54.829689 140075262924224 session_manager.py:502] Done running local_init_op.
I0814 18:09:57.481247 140075262924224 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:10:09.827867 140075262924224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:10:09.997828 140075262924224 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:10:09.998246 140075262924224 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:10:09.998714: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:10:10.004280 140075262924224 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:10:10.006628 140075262924224 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:10:10.011009 140075262924224 tpu_estimator.py:557] Init TPU system
I0814 18:10:52.123738 140075262924224 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 18:10:52.124803 140074366785280 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:10:52.125483 140074358392576 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:10:52.191899 140074349999872 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:10:52.198502 140075262924224 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:10:52.199260 140075262924224 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:10:52.476351 140074349999872 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:10:57.012617 140074358392576 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:11:01.480464 140075262924224 basic_session_run_hooks.py:262] loss = 0.100022465, step = 30
I0814 18:11:01.482764 140075262924224 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:11:17.063252 140075262924224 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:11:17.063534 140075262924224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:11:17.063764 140074366785280 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:11:17.063868 140074366785280 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:11:17.064007 140075262924224 error_handling.py:96] infeed marked as finished
I0814 18:11:17.064119 140075262924224 tpu_estimator.py:602] Stop output thread controller
I0814 18:11:17.064168 140075262924224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:11:17.064284 140074358392576 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:11:17.064357 140074358392576 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:11:17.064516 140075262924224 error_handling.py:96] outfeed marked as finished
I0814 18:11:17.064620 140075262924224 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:11:22.625358 140075262924224 estimator.py:368] Loss for final step: 0.100022465.
I0814 18:11:22.626116 140075262924224 error_handling.py:96] training_loop marked as finished
I0814 18:11:23.406649 140075262924224 estimator.py:1145] Calling model_fn.
E0814 18:11:24.099760 140075262924224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:11:24.337750 140075262924224 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:11:24.360927 140075262924224 estimator.py:1147] Done calling model_fn.
I0814 18:11:24.378185 140075262924224 evaluation.py:255] Starting evaluation at 2019-08-14T18:11:24Z
I0814 18:11:24.378421 140075262924224 tpu_estimator.py:499] TPU job name worker
I0814 18:11:24.457480 140075262924224 monitored_session.py:240] Graph was finalized.
W0814 18:11:24.458237 140075262924224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:11:24.647979 140075262924224 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:11:27.357928 140075262924224 session_manager.py:500] Running local_init_op.
I0814 18:11:27.388382 140075262924224 session_manager.py:502] Done running local_init_op.
I0814 18:11:27.439342 140075262924224 tpu_estimator.py:557] Init TPU system
I0814 18:12:36.093403 140075262924224 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:12:36.094243 140074363115264 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:12:36.095016 140074354722560 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:12:36.162118 140075262924224 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:12:36.186916 140075262924224 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:12:36.187345 140075262924224 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:12:36.293879 140074341345024 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:12:36.679142 140074341345024 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:12:36.991636 140074354722560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:12:37.305828 140075262924224 evaluation.py:167] Evaluation [10/10]
I0814 18:12:37.306173 140075262924224 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:12:37.306245 140075262924224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:12:37.306490 140074363115264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:12:37.306766 140074363115264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:12:37.307025 140075262924224 error_handling.py:96] infeed marked as finished
I0814 18:12:37.307284 140075262924224 tpu_estimator.py:602] Stop output thread controller
I0814 18:12:37.307349 140075262924224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:12:37.307526 140074354722560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:12:37.307683 140074354722560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:12:37.307851 140075262924224 error_handling.py:96] outfeed marked as finished
I0814 18:12:37.307991 140075262924224 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:13:06.784085 140075262924224 evaluation.py:275] Finished evaluation at 2019-08-14-18:13:06
I0814 18:13:06.784456 140075262924224 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9719, global_step = 30, loss = 0.09829174
I0814 18:13:11.311016 140075262924224 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:13:12.113905 140075262924224 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09829174, 'global_step': 30, 'accuracy': 0.9719}

Removing gs://yangyou-mnist/log/#1565806191952156...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565806204705393...
Removing gs://yangyou-mnist/log/checkpoint#1565806271442411...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565806209301087...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565806192.v3-8-tpu#1565806276750096...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565806196898089...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565806268328251...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565806203828932...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565806269192662...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565806273658464...
Removing gs://yangyou-mnist/log/eval/#1565806388547967...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565806388.v3-8-tpu#1565806391795680...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:13:16.051090 140632555124160 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:13:16.051853 140632555124160 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:13:16.054663 140632555124160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:13:16.055495 140632555124160 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:13:16.056066 140632555124160 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:13:16.056206 140632555124160 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:13:16.472173 140632555124160 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:13:16.480029 140632555124160 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:13:16.484172 140632555124160 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:13:16.536252 140632555124160 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:13:16.536566 140632555124160 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:13:16.800127 140632555124160 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:13:16.855377 140632555124160 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:13:16.855665 140632555124160 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:13:17.122713 140632555124160 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe76ba74150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe76dc53210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:13:17.123147 140632555124160 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:13:17.449299 140632555124160 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:13:17.452219: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:13:17.465429 140632555124160 tpu_system_metadata.py:148] Found TPU system:
I0814 18:13:17.465692 140632555124160 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:13:17.466203 140632555124160 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:13:17.466264 140632555124160 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:13:17.466315 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:13:17.466597 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:13:17.466651 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:13:17.466701 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:13:17.466747 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:13:17.466799 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:13:17.466850 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:13:17.466900 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:13:17.466947 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:13:17.467008 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:13:17.467055 140632555124160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:13:17.473082 140632555124160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:13:17.485647 140632555124160 estimator.py:1145] Calling model_fn.
W0814 18:13:17.486257 140632555124160 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:13:17.755201 140632555124160 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:13:18.180561 140632555124160 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:13:18.242306 140632555124160 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:13:18.248212 140632555124160 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:13:18.425699 140632555124160 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:13:18.439420 140632555124160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:13:18.451354 140632555124160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:13:18.452454 140632555124160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:13:18.459338 140632555124160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:13:18.464436 140632555124160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:13:18.464639 140632555124160 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:13:18.476819 140632555124160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:13:18.585225 140632555124160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:13:18.626431 140632555124160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:13:18.669553 140632555124160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:13:18.720016 140632555124160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:13:18.883184 140632555124160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:13:18.932785 140632555124160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:13:18.979947 140632555124160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:13:19.028978 140632555124160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:13:19.073690 140632555124160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:13:19.115820 140632555124160 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:13:19.131582 140632555124160 estimator.py:1147] Done calling model_fn.
I0814 18:13:22.697096 140632555124160 tpu_estimator.py:499] TPU job name worker
I0814 18:13:22.803385 140632555124160 monitored_session.py:240] Graph was finalized.
I0814 18:13:23.473736 140632555124160 session_manager.py:500] Running local_init_op.
I0814 18:13:23.535032 140632555124160 session_manager.py:502] Done running local_init_op.
I0814 18:13:26.466998 140632555124160 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:13:38.935518 140632555124160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:13:39.079499 140632555124160 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:13:39.079942 140632555124160 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:13:39.080328: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:13:39.084856 140632555124160 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:13:39.087008 140632555124160 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:13:39.091559 140632555124160 tpu_estimator.py:557] Init TPU system
I0814 18:14:20.112302 140632555124160 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 18:14:20.113562 140631515064064 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:14:20.114366 140631506671360 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:14:20.202156 140632555124160 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:14:20.202970 140632555124160 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 18:14:20.217823 140631498278656 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:14:20.658755 140631498278656 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:14:24.966766 140631506671360 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:14:29.572278 140632555124160 basic_session_run_hooks.py:262] loss = 0.07368452, step = 30
I0814 18:14:29.574898 140632555124160 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:14:43.165381 140632555124160 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:14:43.165710 140632555124160 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:14:43.165956 140631515064064 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:14:43.166079 140631515064064 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:14:43.166219 140632555124160 error_handling.py:96] infeed marked as finished
I0814 18:14:43.166316 140632555124160 tpu_estimator.py:602] Stop output thread controller
I0814 18:14:43.166393 140632555124160 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:14:43.166508 140631506671360 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:14:43.166589 140631506671360 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:14:43.166708 140632555124160 error_handling.py:96] outfeed marked as finished
I0814 18:14:43.166802 140632555124160 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:14:50.803091 140632555124160 estimator.py:368] Loss for final step: 0.07368452.
I0814 18:14:50.803929 140632555124160 error_handling.py:96] training_loop marked as finished
I0814 18:14:51.530761 140632555124160 estimator.py:1145] Calling model_fn.
E0814 18:14:52.242537 140632555124160 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:14:52.471579 140632555124160 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:14:52.493428 140632555124160 estimator.py:1147] Done calling model_fn.
I0814 18:14:52.510750 140632555124160 evaluation.py:255] Starting evaluation at 2019-08-14T18:14:52Z
I0814 18:14:52.510987 140632555124160 tpu_estimator.py:499] TPU job name worker
I0814 18:14:52.589885 140632555124160 monitored_session.py:240] Graph was finalized.
W0814 18:14:52.590662 140632555124160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:14:52.781610 140632555124160 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:14:55.494882 140632555124160 session_manager.py:500] Running local_init_op.
I0814 18:14:55.520555 140632555124160 session_manager.py:502] Done running local_init_op.
I0814 18:14:55.569524 140632555124160 tpu_estimator.py:557] Init TPU system
I0814 18:16:04.042745 140632555124160 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:16:04.043653 140631520835328 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:16:04.044101 140631512442624 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:16:04.112512 140632555124160 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:16:04.137768 140632555124160 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:16:04.138180 140632555124160 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:16:04.187858 140631504049920 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:16:04.379024 140631504049920 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:16:04.931859 140631512442624 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:16:05.223355 140632555124160 evaluation.py:167] Evaluation [10/10]
I0814 18:16:05.223786 140632555124160 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:16:05.223879 140632555124160 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:16:05.224045 140631520835328 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:16:05.224129 140631520835328 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:16:05.224266 140632555124160 error_handling.py:96] infeed marked as finished
I0814 18:16:05.224354 140632555124160 tpu_estimator.py:602] Stop output thread controller
I0814 18:16:05.224457 140632555124160 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:16:05.224589 140631512442624 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:16:05.224668 140631512442624 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:16:05.224783 140632555124160 error_handling.py:96] outfeed marked as finished
I0814 18:16:05.224865 140632555124160 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:16:34.476742 140632555124160 evaluation.py:275] Finished evaluation at 2019-08-14-18:16:34
I0814 18:16:34.477067 140632555124160 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9773, global_step = 30, loss = 0.08756777
I0814 18:16:39.658354 140632555124160 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:16:40.592977 140632555124160 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08756777, 'global_step': 30, 'accuracy': 0.9773}

Removing gs://yangyou-mnist/log/#1565806400622268...
Removing gs://yangyou-mnist/log/checkpoint#1565806479656699...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565806400.v3-8-tpu#1565806482853570...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565806405875081...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565806412944053...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565806413893451...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565806418416209...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565806476356159...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565806477361326...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565806481883050...
Removing gs://yangyou-mnist/log/eval/#1565806597076166...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565806597.v3-8-tpu#1565806600285628...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:16:44.565637 139823986165184 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:16:44.566428 139823986165184 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:16:44.569196 139823986165184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:16:44.570036 139823986165184 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:16:44.570669 139823986165184 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:16:44.570822 139823986165184 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:16:44.986726 139823986165184 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:16:44.993581 139823986165184 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:16:44.997510 139823986165184 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:16:45.052315 139823986165184 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:16:45.052645 139823986165184 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:16:45.388501 139823986165184 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:16:45.443270 139823986165184 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:16:45.443555 139823986165184 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:16:45.702418 139823986165184 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2b29301150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2b2b4e0210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:16:45.702804 139823986165184 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:16:46.024864 139823986165184 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:16:46.027889: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:16:46.039760 139823986165184 tpu_system_metadata.py:148] Found TPU system:
I0814 18:16:46.039997 139823986165184 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:16:46.040548 139823986165184 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:16:46.040616 139823986165184 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:16:46.040676 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:16:46.040983 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:16:46.041057 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:16:46.041111 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:16:46.041160 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:16:46.041208 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:16:46.041253 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:16:46.041297 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:16:46.041343 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:16:46.041388 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:16:46.041443 139823986165184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:16:46.047353 139823986165184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:16:46.059789 139823986165184 estimator.py:1145] Calling model_fn.
W0814 18:16:46.060439 139823986165184 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:16:46.333465 139823986165184 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:16:46.760008 139823986165184 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:16:46.824764 139823986165184 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:16:46.830842 139823986165184 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:16:47.018789 139823986165184 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:16:47.033495 139823986165184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:16:47.046272 139823986165184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:16:47.047362 139823986165184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:16:47.054693 139823986165184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:16:47.060112 139823986165184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:16:47.060333 139823986165184 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:16:47.073323 139823986165184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:16:47.185599 139823986165184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:16:47.228667 139823986165184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:16:47.274971 139823986165184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:16:47.327197 139823986165184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:16:47.491411 139823986165184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:16:47.543503 139823986165184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:16:47.593127 139823986165184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:16:47.645189 139823986165184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:16:47.692266 139823986165184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:16:47.737039 139823986165184 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:16:47.753701 139823986165184 estimator.py:1147] Done calling model_fn.
I0814 18:16:51.538533 139823986165184 tpu_estimator.py:499] TPU job name worker
I0814 18:16:51.656375 139823986165184 monitored_session.py:240] Graph was finalized.
I0814 18:16:52.401973 139823986165184 session_manager.py:500] Running local_init_op.
I0814 18:16:52.462233 139823986165184 session_manager.py:502] Done running local_init_op.
I0814 18:16:55.318078 139823986165184 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:17:07.831078 139823986165184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:17:07.983665 139823986165184 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:17:07.984190 139823986165184 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:17:07.984657: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:17:07.990638 139823986165184 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:17:07.992964 139823986165184 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:17:07.997150 139823986165184 tpu_estimator.py:557] Init TPU system
I0814 18:17:48.117643 139823986165184 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 18:17:48.118614 139823224174336 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:17:48.119106 139823215781632 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:17:48.182261 139823986165184 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:17:48.184144 139823986165184 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 18:17:48.192761 139823207388928 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:17:48.494566 139823207388928 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:17:52.925669 139823215781632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:17:57.616957 139823986165184 basic_session_run_hooks.py:262] loss = 0.07097298, step = 30
I0814 18:17:57.620321 139823986165184 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:18:11.733633 139823986165184 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:18:11.733959 139823986165184 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:18:11.735621 139823224174336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:18:11.736004 139823224174336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:18:11.736251 139823986165184 error_handling.py:96] infeed marked as finished
I0814 18:18:11.736543 139823986165184 tpu_estimator.py:602] Stop output thread controller
I0814 18:18:11.736624 139823986165184 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:18:11.736874 139823215781632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:18:11.737056 139823215781632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:18:11.737276 139823986165184 error_handling.py:96] outfeed marked as finished
I0814 18:18:11.737462 139823986165184 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:18:18.626019 139823986165184 estimator.py:368] Loss for final step: 0.07097298.
I0814 18:18:18.626919 139823986165184 error_handling.py:96] training_loop marked as finished
I0814 18:18:19.326339 139823986165184 estimator.py:1145] Calling model_fn.
E0814 18:18:20.051758 139823986165184 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:18:20.280795 139823986165184 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:18:20.301888 139823986165184 estimator.py:1147] Done calling model_fn.
I0814 18:18:20.318171 139823986165184 evaluation.py:255] Starting evaluation at 2019-08-14T18:18:20Z
I0814 18:18:20.318397 139823986165184 tpu_estimator.py:499] TPU job name worker
I0814 18:18:20.398215 139823986165184 monitored_session.py:240] Graph was finalized.
W0814 18:18:20.398958 139823986165184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:18:20.590620 139823986165184 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:18:23.421168 139823986165184 session_manager.py:500] Running local_init_op.
I0814 18:18:23.447025 139823986165184 session_manager.py:502] Done running local_init_op.
I0814 18:18:23.503186 139823986165184 tpu_estimator.py:557] Init TPU system
I0814 18:19:32.077748 139823986165184 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:19:32.078623 139823220504320 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:19:32.079564 139823212111616 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:19:32.146281 139823986165184 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:19:32.170438 139823986165184 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:19:32.170885 139823986165184 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:19:32.209467 139822727427840 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:19:32.366203 139822727427840 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:19:32.971348 139823212111616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:19:33.260229 139823986165184 evaluation.py:167] Evaluation [10/10]
I0814 18:19:33.260636 139823986165184 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:19:33.260715 139823986165184 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:19:33.260894 139823220504320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:19:33.260987 139823220504320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:19:33.261125 139823986165184 error_handling.py:96] infeed marked as finished
I0814 18:19:33.261220 139823986165184 tpu_estimator.py:602] Stop output thread controller
I0814 18:19:33.261275 139823986165184 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:19:33.261398 139823212111616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:19:33.261471 139823212111616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:19:33.261588 139823986165184 error_handling.py:96] outfeed marked as finished
I0814 18:19:33.261760 139823986165184 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:20:02.467775 139823986165184 evaluation.py:275] Finished evaluation at 2019-08-14-18:20:02
I0814 18:20:02.468131 139823986165184 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9836, global_step = 30, loss = 0.043160733
I0814 18:20:07.013030 139823986165184 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:20:07.887015 139823986165184 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.043160733, 'global_step': 30, 'accuracy': 0.9836}

Removing gs://yangyou-mnist/log/#1565806609320326...
Removing gs://yangyou-mnist/log/checkpoint#1565806688044619...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565806627313662...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565806609.v3-8-tpu#1565806691399414...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565806622833551...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565806684602393...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565806614717665...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565806621783649...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565806685719216...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565806690389411...
Removing gs://yangyou-mnist/log/eval/#1565806804334633...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565806804.v3-8-tpu#1565806807541788...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:20:11.683125 140509249529280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:20:11.683936 140509249529280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:20:11.686695 140509249529280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:20:11.687556 140509249529280 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:20:11.688152 140509249529280 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:20:11.688290 140509249529280 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:20:12.094527 140509249529280 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:20:12.102056 140509249529280 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:20:12.106069 140509249529280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:20:12.162585 140509249529280 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:20:12.162868 140509249529280 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:20:12.416928 140509249529280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:20:12.534990 140509249529280 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:20:12.535289 140509249529280 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:20:12.743865 140509249529280 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcab61131d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcab82f21d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:20:12.744338 140509249529280 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:20:13.099844 140509249529280 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:20:13.102786: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:20:13.116568 140509249529280 tpu_system_metadata.py:148] Found TPU system:
I0814 18:20:13.116828 140509249529280 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:20:13.117321 140509249529280 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:20:13.117384 140509249529280 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:20:13.117444 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:20:13.117734 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:20:13.117790 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:20:13.117841 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:20:13.117887 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:20:13.117933 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:20:13.117980 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:20:13.118031 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:20:13.118077 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:20:13.118125 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:20:13.118172 140509249529280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:20:13.124313 140509249529280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:20:13.136965 140509249529280 estimator.py:1145] Calling model_fn.
W0814 18:20:13.137716 140509249529280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:20:13.414184 140509249529280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:20:13.987241 140509249529280 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:20:14.049341 140509249529280 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:20:14.055414 140509249529280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:20:14.240139 140509249529280 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:20:14.254542 140509249529280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:20:14.267035 140509249529280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:20:14.268094 140509249529280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:20:14.275244 140509249529280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:20:14.280577 140509249529280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:20:14.280797 140509249529280 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:20:14.293500 140509249529280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:20:14.404247 140509249529280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:20:14.445960 140509249529280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:20:14.490586 140509249529280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:20:14.542448 140509249529280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:20:14.705384 140509249529280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:20:14.755880 140509249529280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:20:14.805469 140509249529280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:20:14.855906 140509249529280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:20:14.901779 140509249529280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:20:14.943677 140509249529280 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:20:14.960066 140509249529280 estimator.py:1147] Done calling model_fn.
I0814 18:20:18.595777 140509249529280 tpu_estimator.py:499] TPU job name worker
I0814 18:20:18.704528 140509249529280 monitored_session.py:240] Graph was finalized.
I0814 18:20:19.377060 140509249529280 session_manager.py:500] Running local_init_op.
I0814 18:20:19.426683 140509249529280 session_manager.py:502] Done running local_init_op.
I0814 18:20:22.233756 140509249529280 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:20:35.002357 140509249529280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:20:35.145976 140509249529280 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:20:35.146424 140509249529280 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:20:35.146815: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:20:35.151870 140509249529280 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:20:35.153997 140509249529280 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:20:35.157978 140509249529280 tpu_estimator.py:557] Init TPU system
I0814 18:21:16.129573 140509249529280 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 18:21:16.130640 140508353255168 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:21:16.132071 140508344862464 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:21:16.194964 140509249529280 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:21:16.197244 140509249529280 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 18:21:16.204477 140508336469760 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:21:16.513866 140508336469760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:21:21.043169 140508344862464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:21:25.421155 140509249529280 basic_session_run_hooks.py:262] loss = 0.07552267, step = 30
I0814 18:21:25.423885 140509249529280 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:21:39.024669 140509249529280 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:21:39.024998 140509249529280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:21:39.025197 140508353255168 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:21:39.025290 140508353255168 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:21:39.025429 140509249529280 error_handling.py:96] infeed marked as finished
I0814 18:21:39.025530 140509249529280 tpu_estimator.py:602] Stop output thread controller
I0814 18:21:39.025578 140509249529280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:21:39.025692 140508344862464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:21:39.025767 140508344862464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:21:39.025876 140509249529280 error_handling.py:96] outfeed marked as finished
I0814 18:21:39.025957 140509249529280 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:21:46.626162 140509249529280 estimator.py:368] Loss for final step: 0.07552267.
I0814 18:21:46.626934 140509249529280 error_handling.py:96] training_loop marked as finished
I0814 18:21:47.326859 140509249529280 estimator.py:1145] Calling model_fn.
E0814 18:21:48.009637 140509249529280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:21:48.239149 140509249529280 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:21:48.261527 140509249529280 estimator.py:1147] Done calling model_fn.
I0814 18:21:48.281579 140509249529280 evaluation.py:255] Starting evaluation at 2019-08-14T18:21:48Z
I0814 18:21:48.281829 140509249529280 tpu_estimator.py:499] TPU job name worker
I0814 18:21:48.364856 140509249529280 monitored_session.py:240] Graph was finalized.
W0814 18:21:48.365581 140509249529280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:21:48.558928 140509249529280 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:21:51.310981 140509249529280 session_manager.py:500] Running local_init_op.
I0814 18:21:51.336431 140509249529280 session_manager.py:502] Done running local_init_op.
I0814 18:21:51.390999 140509249529280 tpu_estimator.py:557] Init TPU system
I0814 18:23:00.030167 140509249529280 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:23:00.031038 140508349585152 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:23:00.031863 140508341192448 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:23:00.098862 140509249529280 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:23:00.124772 140509249529280 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:23:00.125118 140509249529280 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:23:00.153014 140508327814912 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:23:00.546679 140508327814912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 18:23:00.908947 140508341192448 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:23:01.317378 140509249529280 evaluation.py:167] Evaluation [10/10]
I0814 18:23:01.317718 140509249529280 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:23:01.317792 140509249529280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:23:01.317970 140508349585152 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:23:01.318098 140508349585152 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:23:01.318267 140509249529280 error_handling.py:96] infeed marked as finished
I0814 18:23:01.318363 140509249529280 tpu_estimator.py:602] Stop output thread controller
I0814 18:23:01.318418 140509249529280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:23:01.318535 140508341192448 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:23:01.318649 140508341192448 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:23:01.318780 140509249529280 error_handling.py:96] outfeed marked as finished
I0814 18:23:01.318866 140509249529280 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:23:30.644015 140509249529280 evaluation.py:275] Finished evaluation at 2019-08-14-18:23:30
I0814 18:23:30.644464 140509249529280 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9824, global_step = 30, loss = 0.058187116
I0814 18:23:35.114813 140509249529280 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:23:35.946024 140509249529280 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.058187116, 'global_step': 30, 'accuracy': 0.9824}

Removing gs://yangyou-mnist/log/#1565806816480458...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565806892367324...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565806829447300...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565806816.v3-8-tpu#1565806898716278...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565806893220146...
Removing gs://yangyou-mnist/log/checkpoint#1565806895489818...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565806834482659...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565806821633122...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565806828487440...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565806897728749...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565807012350672...
/ [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565807012.v3-8-tpu#1565807015641617...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:23:39.905515 140019695199680 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:23:39.906307 140019695199680 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:23:39.908920 140019695199680 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:23:39.909729 140019695199680 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:23:39.910331 140019695199680 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:23:39.910470 140019695199680 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:23:40.319967 140019695199680 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:23:40.326972 140019695199680 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:23:40.330894 140019695199680 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:23:40.388159 140019695199680 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:23:40.388676 140019695199680 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:23:40.701674 140019695199680 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:23:40.746680 140019695199680 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:23:40.746979 140019695199680 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:23:41.005696 140019695199680 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f58ba5af210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f58bc78e1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:23:41.006129 140019695199680 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:23:41.341492 140019695199680 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:23:41.344927: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:23:41.357738 140019695199680 tpu_system_metadata.py:148] Found TPU system:
I0814 18:23:41.358022 140019695199680 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:23:41.358551 140019695199680 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:23:41.358611 140019695199680 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:23:41.358671 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:23:41.358963 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:23:41.359025 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:23:41.359081 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:23:41.359129 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:23:41.359181 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:23:41.359227 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:23:41.359275 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:23:41.359350 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:23:41.359400 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:23:41.359448 140019695199680 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:23:41.365695 140019695199680 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:23:41.378456 140019695199680 estimator.py:1145] Calling model_fn.
W0814 18:23:41.379092 140019695199680 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:23:41.646419 140019695199680 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:23:42.054791 140019695199680 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:23:42.117741 140019695199680 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:23:42.123584 140019695199680 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:23:42.311652 140019695199680 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:23:42.325438 140019695199680 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:23:42.337601 140019695199680 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:23:42.338675 140019695199680 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:23:42.345829 140019695199680 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:23:42.351063 140019695199680 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:23:42.351290 140019695199680 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:23:42.363764 140019695199680 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:23:42.475462 140019695199680 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:23:42.517507 140019695199680 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:23:42.562613 140019695199680 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:23:42.615231 140019695199680 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:23:42.779112 140019695199680 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:23:42.835690 140019695199680 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:23:42.886535 140019695199680 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:23:42.936986 140019695199680 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:23:42.982532 140019695199680 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:23:43.024979 140019695199680 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:23:43.041631 140019695199680 estimator.py:1147] Done calling model_fn.
I0814 18:23:46.475064 140019695199680 tpu_estimator.py:499] TPU job name worker
I0814 18:23:46.582917 140019695199680 monitored_session.py:240] Graph was finalized.
I0814 18:23:47.319516 140019695199680 session_manager.py:500] Running local_init_op.
I0814 18:23:47.380181 140019695199680 session_manager.py:502] Done running local_init_op.
I0814 18:23:50.104037 140019695199680 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:24:02.486046 140019695199680 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:24:02.640932 140019695199680 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:24:02.641401 140019695199680 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:24:02.641931: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:24:02.647130 140019695199680 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:24:02.649368 140019695199680 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:24:02.653119 140019695199680 tpu_estimator.py:557] Init TPU system
I0814 18:24:44.110706 140019695199680 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 18:24:44.111568 140018799073024 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:24:44.112078 140018790680320 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:24:44.175564 140018782287616 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:24:44.177309 140019695199680 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:24:44.178368 140019695199680 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:24:44.363876 140018782287616 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 18:24:49.002926 140018790680320 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:24:53.618782 140019695199680 basic_session_run_hooks.py:262] loss = 2.0765133, step = 30
I0814 18:24:53.620996 140019695199680 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:25:07.389803 140019695199680 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:25:07.390100 140019695199680 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:25:07.390491 140018799073024 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:25:07.390811 140018799073024 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:25:07.391083 140019695199680 error_handling.py:96] infeed marked as finished
I0814 18:25:07.391344 140019695199680 tpu_estimator.py:602] Stop output thread controller
I0814 18:25:07.391421 140019695199680 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:25:07.391614 140018790680320 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:25:07.391777 140018790680320 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:25:07.392009 140019695199680 error_handling.py:96] outfeed marked as finished
I0814 18:25:07.392188 140019695199680 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:25:14.511205 140019695199680 estimator.py:368] Loss for final step: 2.0765133.
I0814 18:25:14.512099 140019695199680 error_handling.py:96] training_loop marked as finished
I0814 18:25:15.339853 140019695199680 estimator.py:1145] Calling model_fn.
E0814 18:25:16.051295 140019695199680 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:25:16.280986 140019695199680 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:25:16.302733 140019695199680 estimator.py:1147] Done calling model_fn.
I0814 18:25:16.319840 140019695199680 evaluation.py:255] Starting evaluation at 2019-08-14T18:25:16Z
I0814 18:25:16.320074 140019695199680 tpu_estimator.py:499] TPU job name worker
I0814 18:25:16.397797 140019695199680 monitored_session.py:240] Graph was finalized.
W0814 18:25:16.398535 140019695199680 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:25:16.593827 140019695199680 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:25:19.574165 140019695199680 session_manager.py:500] Running local_init_op.
I0814 18:25:19.599268 140019695199680 session_manager.py:502] Done running local_init_op.
I0814 18:25:19.648607 140019695199680 tpu_estimator.py:557] Init TPU system
I0814 18:26:28.036947 140019695199680 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:26:28.038083 140018795403008 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:26:28.038955 140018787010304 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:26:28.105432 140019695199680 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:26:28.130534 140019695199680 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:26:28.130942 140019695199680 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:26:28.168081 140018773632768 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:26:28.562947 140018773632768 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 18:26:28.929363 140018787010304 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:26:29.231318 140019695199680 evaluation.py:167] Evaluation [10/10]
I0814 18:26:29.231664 140019695199680 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:26:29.231813 140019695199680 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:26:29.232083 140018795403008 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:26:29.232391 140018795403008 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:26:29.232831 140019695199680 error_handling.py:96] infeed marked as finished
I0814 18:26:29.233062 140019695199680 tpu_estimator.py:602] Stop output thread controller
I0814 18:26:29.233125 140019695199680 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:26:29.233287 140018787010304 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:26:29.233485 140018787010304 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:26:29.233652 140019695199680 error_handling.py:96] outfeed marked as finished
I0814 18:26:29.233856 140019695199680 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:26:58.641952 140019695199680 evaluation.py:275] Finished evaluation at 2019-08-14-18:26:58
I0814 18:26:58.642328 140019695199680 estimator.py:2039] Saving dict for global step 30: accuracy = 0.4465, global_step = 30, loss = 3.1659133
I0814 18:27:03.306803 140019695199680 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:27:04.119198 140019695199680 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 3.1659133, 'global_step': 30, 'accuracy': 0.4465}

Removing gs://yangyou-mnist/log/#1565807024496120...
Removing gs://yangyou-mnist/log/checkpoint#1565807103839044...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565807024.v3-8-tpu#1565807107082517...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565807029524159...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565807101586213...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565807100650256...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565807041963366...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565807036707007...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565807037605085...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565807106134447...
Removing gs://yangyou-mnist/log/eval/#1565807220307641...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565807220.v3-8-tpu#1565807223808252...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:27:08.027774 139894294701504 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:27:08.028649 139894294701504 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:27:08.031364 139894294701504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:27:08.032257 139894294701504 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:27:08.033150 139894294701504 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:27:08.033298 139894294701504 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:27:08.471191 139894294701504 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:27:08.478750 139894294701504 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:27:08.483242 139894294701504 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:27:08.540186 139894294701504 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:27:08.540539 139894294701504 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:27:08.716012 139894294701504 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:27:08.833112 139894294701504 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:27:08.833434 139894294701504 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:27:09.015922 139894294701504 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3b87e731d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3b8a0521d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:27:09.016309 139894294701504 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:27:09.330130 139894294701504 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:27:09.332970: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:27:09.346777 139894294701504 tpu_system_metadata.py:148] Found TPU system:
I0814 18:27:09.347021 139894294701504 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:27:09.347542 139894294701504 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:27:09.347603 139894294701504 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:27:09.347672 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:27:09.347994 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:27:09.348051 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:27:09.348113 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:27:09.348161 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:27:09.348216 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:27:09.348267 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:27:09.348314 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:27:09.348360 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:27:09.348450 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:27:09.348521 139894294701504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:27:09.355006 139894294701504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:27:09.368042 139894294701504 estimator.py:1145] Calling model_fn.
W0814 18:27:09.368714 139894294701504 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:27:09.628247 139894294701504 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:27:10.133980 139894294701504 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:27:10.197421 139894294701504 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:27:10.203576 139894294701504 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:27:10.389306 139894294701504 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:27:10.403371 139894294701504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:27:10.415451 139894294701504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:27:10.416487 139894294701504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:27:10.423486 139894294701504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:27:10.428771 139894294701504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:27:10.428975 139894294701504 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:27:10.441647 139894294701504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:27:10.552517 139894294701504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:27:10.596438 139894294701504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:27:10.642563 139894294701504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:27:10.694896 139894294701504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:27:10.864469 139894294701504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:27:10.914659 139894294701504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:27:10.962986 139894294701504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:27:11.014054 139894294701504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:27:11.060221 139894294701504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:27:11.102049 139894294701504 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:27:11.118324 139894294701504 estimator.py:1147] Done calling model_fn.
I0814 18:27:14.531097 139894294701504 tpu_estimator.py:499] TPU job name worker
I0814 18:27:14.644541 139894294701504 monitored_session.py:240] Graph was finalized.
I0814 18:27:15.304160 139894294701504 session_manager.py:500] Running local_init_op.
I0814 18:27:15.358731 139894294701504 session_manager.py:502] Done running local_init_op.
I0814 18:27:18.537432 139894294701504 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:27:31.337383 139894294701504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:27:31.504024 139894294701504 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:27:31.504456 139894294701504 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:27:31.504857: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:27:31.510080 139894294701504 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:27:31.512459 139894294701504 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:27:31.517137 139894294701504 tpu_estimator.py:557] Init TPU system
I0814 18:28:12.112799 139894294701504 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 18:28:12.114176 139893258843904 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:28:12.116671 139893250451200 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:28:12.189697 139893242058496 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:28:12.193322 139894294701504 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:28:12.194453 139894294701504 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:28:12.677226 139893242058496 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:28:17.053508 139893250451200 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:28:21.777672 139894294701504 basic_session_run_hooks.py:262] loss = 2.9976792, step = 30
I0814 18:28:21.779843 139894294701504 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:28:35.528692 139894294701504 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:28:35.528959 139894294701504 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:28:35.529253 139893258843904 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:28:35.529596 139893258843904 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:28:35.529815 139894294701504 error_handling.py:96] infeed marked as finished
I0814 18:28:35.530024 139894294701504 tpu_estimator.py:602] Stop output thread controller
I0814 18:28:35.530078 139894294701504 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:28:35.530236 139893250451200 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:28:35.530464 139893250451200 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:28:35.530670 139894294701504 error_handling.py:96] outfeed marked as finished
I0814 18:28:35.530843 139894294701504 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:28:42.819665 139894294701504 estimator.py:368] Loss for final step: 2.9976792.
I0814 18:28:42.820611 139894294701504 error_handling.py:96] training_loop marked as finished
I0814 18:28:43.616281 139894294701504 estimator.py:1145] Calling model_fn.
E0814 18:28:44.315057 139894294701504 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:28:44.543939 139894294701504 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:28:44.565640 139894294701504 estimator.py:1147] Done calling model_fn.
I0814 18:28:44.583897 139894294701504 evaluation.py:255] Starting evaluation at 2019-08-14T18:28:44Z
I0814 18:28:44.584141 139894294701504 tpu_estimator.py:499] TPU job name worker
I0814 18:28:44.666397 139894294701504 monitored_session.py:240] Graph was finalized.
W0814 18:28:44.667150 139894294701504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:28:44.855907 139894294701504 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:28:47.440959 139894294701504 session_manager.py:500] Running local_init_op.
I0814 18:28:47.471740 139894294701504 session_manager.py:502] Done running local_init_op.
I0814 18:28:47.524030 139894294701504 tpu_estimator.py:557] Init TPU system
I0814 18:29:56.038227 139894294701504 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:29:56.039375 139893258843904 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:29:56.040148 139893250451200 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:29:56.107986 139894294701504 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:29:56.132757 139894294701504 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:29:56.133146 139894294701504 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:29:56.173549 139893242058496 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:29:56.469449 139893242058496 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:29:56.930285 139893250451200 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:29:57.215419 139894294701504 evaluation.py:167] Evaluation [10/10]
I0814 18:29:57.215830 139894294701504 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:29:57.215929 139894294701504 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:29:57.216195 139893258843904 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:29:57.216530 139893258843904 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:29:57.216782 139894294701504 error_handling.py:96] infeed marked as finished
I0814 18:29:57.216970 139894294701504 tpu_estimator.py:602] Stop output thread controller
I0814 18:29:57.217022 139894294701504 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:29:57.217206 139893250451200 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:29:57.217386 139893250451200 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:29:57.217742 139894294701504 error_handling.py:96] outfeed marked as finished
I0814 18:29:57.217924 139894294701504 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:30:26.565886 139894294701504 evaluation.py:275] Finished evaluation at 2019-08-14-18:30:26
I0814 18:30:26.566284 139894294701504 estimator.py:2039] Saving dict for global step 30: accuracy = 0.101, global_step = 30, loss = 2.697728
I0814 18:30:31.131449 139894294701504 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:30:31.981287 139894294701504 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.697728, 'global_step': 30, 'accuracy': 0.101}

Removing gs://yangyou-mnist/log/#1565807232678125...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565807246259012...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565807237764304...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565807232.v3-8-tpu#1565807315224976...
Removing gs://yangyou-mnist/log/checkpoint#1565807311899895...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565807308685518...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565807309649010...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565807250826278...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565807245192073...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565807314186396...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565807428306578...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565807428.v3-8-tpu#1565807431678735...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:30:35.919101 139703333135808 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:30:35.919899 139703333135808 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:30:35.922575 139703333135808 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:30:35.923491 139703333135808 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:30:35.924072 139703333135808 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:30:35.924202 139703333135808 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:30:36.346299 139703333135808 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:30:36.353372 139703333135808 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:30:36.357336 139703333135808 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:30:36.418297 139703333135808 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:30:36.418615 139703333135808 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:30:36.862848 139703333135808 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:30:36.919092 139703333135808 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:30:36.919368 139703333135808 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:30:37.316688 139703333135808 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0f11b4f1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0f13d2e1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:30:37.317097 139703333135808 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:30:37.637829 139703333135808 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:30:37.640734: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:30:37.654205 139703333135808 tpu_system_metadata.py:148] Found TPU system:
I0814 18:30:37.654443 139703333135808 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:30:37.654928 139703333135808 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:30:37.654987 139703333135808 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:30:37.655040 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:30:37.655462 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:30:37.655522 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:30:37.655577 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:30:37.655627 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:30:37.655674 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:30:37.655721 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:30:37.655767 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:30:37.655813 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:30:37.655858 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:30:37.655906 139703333135808 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:30:37.662369 139703333135808 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:30:37.675293 139703333135808 estimator.py:1145] Calling model_fn.
W0814 18:30:37.675926 139703333135808 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:30:37.945313 139703333135808 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:30:38.343017 139703333135808 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:30:38.405381 139703333135808 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:30:38.411427 139703333135808 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:30:38.593887 139703333135808 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:30:38.608200 139703333135808 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:30:38.620693 139703333135808 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:30:38.621929 139703333135808 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:30:38.629256 139703333135808 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:30:38.634748 139703333135808 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:30:38.634994 139703333135808 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:30:38.647607 139703333135808 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:30:38.758285 139703333135808 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:30:38.808275 139703333135808 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:30:38.854278 139703333135808 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:30:38.905741 139703333135808 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:30:39.077577 139703333135808 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:30:39.129775 139703333135808 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:30:39.179620 139703333135808 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:30:39.231566 139703333135808 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:30:39.278459 139703333135808 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:30:39.320959 139703333135808 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:30:39.337421 139703333135808 estimator.py:1147] Done calling model_fn.
I0814 18:30:43.423480 139703333135808 tpu_estimator.py:499] TPU job name worker
I0814 18:30:43.536807 139703333135808 monitored_session.py:240] Graph was finalized.
I0814 18:30:44.210786 139703333135808 session_manager.py:500] Running local_init_op.
I0814 18:30:44.258048 139703333135808 session_manager.py:502] Done running local_init_op.
I0814 18:30:47.131330 139703333135808 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:30:59.840868 139703333135808 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:30:59.999758 139703333135808 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:31:00.000238 139703333135808 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:31:00.000678: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:31:00.005990 139703333135808 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:31:00.008152 139703333135808 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:31:00.012316 139703333135808 tpu_estimator.py:557] Init TPU system
I0814 18:31:40.114808 139703333135808 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 18:31:40.115917 139702436873984 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:31:40.116873 139702428481280 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:31:40.177711 139702420088576 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:31:40.181199 139703333135808 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:31:40.182722 139703333135808 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:31:40.390083 139702420088576 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:31:44.944221 139702428481280 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:31:49.616276 139703333135808 basic_session_run_hooks.py:262] loss = 558.06213, step = 30
I0814 18:31:49.618447 139703333135808 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:32:03.662683 139703333135808 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:32:03.663001 139703333135808 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:32:03.663207 139702436873984 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:32:03.663325 139702436873984 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:32:03.663471 139703333135808 error_handling.py:96] infeed marked as finished
I0814 18:32:03.663567 139703333135808 tpu_estimator.py:602] Stop output thread controller
I0814 18:32:03.663615 139703333135808 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:32:03.663727 139702428481280 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:32:03.663806 139702428481280 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:32:03.663923 139703333135808 error_handling.py:96] outfeed marked as finished
I0814 18:32:03.664001 139703333135808 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:32:10.513892 139703333135808 estimator.py:368] Loss for final step: 558.06213.
I0814 18:32:10.514738 139703333135808 error_handling.py:96] training_loop marked as finished
I0814 18:32:11.261136 139703333135808 estimator.py:1145] Calling model_fn.
E0814 18:32:11.964214 139703333135808 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:32:12.188980 139703333135808 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:32:12.210619 139703333135808 estimator.py:1147] Done calling model_fn.
I0814 18:32:12.226588 139703333135808 evaluation.py:255] Starting evaluation at 2019-08-14T18:32:12Z
I0814 18:32:12.226843 139703333135808 tpu_estimator.py:499] TPU job name worker
I0814 18:32:12.306248 139703333135808 monitored_session.py:240] Graph was finalized.
W0814 18:32:12.307035 139703333135808 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:32:12.501960 139703333135808 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:32:14.994782 139703333135808 session_manager.py:500] Running local_init_op.
I0814 18:32:15.019092 139703333135808 session_manager.py:502] Done running local_init_op.
I0814 18:32:15.069359 139703333135808 tpu_estimator.py:557] Init TPU system
I0814 18:33:23.958060 139703333135808 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:33:23.959134 139702433203968 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:33:23.959939 139702424811264 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:33:24.032871 139703333135808 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:33:24.094141 139702411433728 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:33:24.110830 139703333135808 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:33:24.111202 139703333135808 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
W0814 18:33:24.261080 139702411433728 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:33:24.917572 139702424811264 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:33:25.245668 139703333135808 evaluation.py:167] Evaluation [10/10]
I0814 18:33:25.246032 139703333135808 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:33:25.246112 139703333135808 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:33:25.246433 139702433203968 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:33:25.246731 139702433203968 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:33:25.247054 139703333135808 error_handling.py:96] infeed marked as finished
I0814 18:33:25.247241 139703333135808 tpu_estimator.py:602] Stop output thread controller
I0814 18:33:25.247308 139703333135808 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:33:25.247545 139702424811264 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:33:25.247699 139702424811264 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:33:25.247931 139703333135808 error_handling.py:96] outfeed marked as finished
I0814 18:33:25.248068 139703333135808 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:33:54.356826 139703333135808 evaluation.py:275] Finished evaluation at 2019-08-14-18:33:54
I0814 18:33:54.357240 139703333135808 estimator.py:2039] Saving dict for global step 30: accuracy = 0.101, global_step = 30, loss = 501.4743
I0814 18:33:58.878279 139703333135808 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:33:59.766149 139703333135808 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 501.4743, 'global_step': 30, 'accuracy': 0.101}

Removing gs://yangyou-mnist/log/#1565807440874806...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565807441.v3-8-tpu#1565807523355812...
Removing gs://yangyou-mnist/log/checkpoint#1565807520244108...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565807446529242...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565807455020219...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565807459322849...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565807454044021...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565807517073711...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565807517991658...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565807522398188...
Removing gs://yangyou-mnist/log/eval/#1565807636113234...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565807636.v3-8-tpu#1565807639449426...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:34:03.551213 140493795030464 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:34:03.551975 140493795030464 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:34:03.554606 140493795030464 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:34:03.555445 140493795030464 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:34:03.556035 140493795030464 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:34:03.556170 140493795030464 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:34:03.975332 140493795030464 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:34:03.982665 140493795030464 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:34:03.986820 140493795030464 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:34:04.041974 140493795030464 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:34:04.042256 140493795030464 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:34:04.216922 140493795030464 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:34:04.273367 140493795030464 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:34:04.273672 140493795030464 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:34:04.437148 140493795030464 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc71ce84090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc71f0631d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:34:04.437493 140493795030464 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:34:04.760824 140493795030464 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:34:04.763770: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:34:04.776396 140493795030464 tpu_system_metadata.py:148] Found TPU system:
I0814 18:34:04.776726 140493795030464 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:34:04.778740 140493795030464 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:34:04.778877 140493795030464 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:34:04.778939 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:34:04.779511 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:34:04.779577 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:34:04.779629 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:34:04.779683 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:34:04.779731 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:34:04.779792 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:34:04.779839 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:34:04.779886 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:34:04.779932 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:34:04.779980 140493795030464 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:34:04.786181 140493795030464 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:34:04.798593 140493795030464 estimator.py:1145] Calling model_fn.
W0814 18:34:04.799206 140493795030464 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:34:05.080672 140493795030464 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:34:05.682005 140493795030464 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:34:05.744187 140493795030464 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:34:05.750031 140493795030464 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:34:05.930002 140493795030464 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:34:05.944063 140493795030464 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:34:05.956466 140493795030464 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:34:05.957532 140493795030464 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:34:05.964613 140493795030464 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:34:05.969986 140493795030464 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:34:05.970231 140493795030464 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:34:05.982835 140493795030464 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:34:06.093534 140493795030464 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:34:06.135483 140493795030464 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:34:06.180210 140493795030464 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:34:06.232434 140493795030464 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:34:06.395315 140493795030464 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:34:06.446836 140493795030464 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:34:06.495985 140493795030464 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:34:06.547154 140493795030464 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:34:06.594127 140493795030464 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:34:06.635828 140493795030464 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:34:06.652061 140493795030464 estimator.py:1147] Done calling model_fn.
I0814 18:34:10.344094 140493795030464 tpu_estimator.py:499] TPU job name worker
I0814 18:34:10.458646 140493795030464 monitored_session.py:240] Graph was finalized.
I0814 18:34:11.119748 140493795030464 session_manager.py:500] Running local_init_op.
I0814 18:34:11.180630 140493795030464 session_manager.py:502] Done running local_init_op.
I0814 18:34:13.786524 140493795030464 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:34:26.361682 140493795030464 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:34:26.508771 140493795030464 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:34:26.509309 140493795030464 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:34:26.509748: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:34:26.514481 140493795030464 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:34:26.516832 140493795030464 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:34:26.522093 140493795030464 tpu_estimator.py:557] Init TPU system
I0814 18:35:08.117824 140493795030464 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 18:35:08.118721 140493024630528 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:35:08.119323 140492540999424 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:35:08.183367 140492532606720 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:35:08.186271 140493795030464 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:35:08.187424 140493795030464 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:35:08.330594 140492532606720 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:35:13.026484 140492540999424 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:35:17.725692 140493795030464 basic_session_run_hooks.py:262] loss = 1810.7678, step = 30
I0814 18:35:17.728111 140493795030464 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:35:31.937129 140493795030464 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:35:31.937493 140493795030464 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:35:31.937793 140493024630528 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:35:31.938105 140493024630528 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:35:31.938371 140493795030464 error_handling.py:96] infeed marked as finished
I0814 18:35:31.938587 140493795030464 tpu_estimator.py:602] Stop output thread controller
I0814 18:35:31.938643 140493795030464 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:35:31.938865 140492540999424 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:35:31.939105 140492540999424 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:35:31.939313 140493795030464 error_handling.py:96] outfeed marked as finished
I0814 18:35:31.939492 140493795030464 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:35:38.469335 140493795030464 estimator.py:368] Loss for final step: 1810.7678.
I0814 18:35:38.470154 140493795030464 error_handling.py:96] training_loop marked as finished
I0814 18:35:39.165684 140493795030464 estimator.py:1145] Calling model_fn.
E0814 18:35:39.897294 140493795030464 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:35:40.132076 140493795030464 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:35:40.154633 140493795030464 estimator.py:1147] Done calling model_fn.
I0814 18:35:40.172187 140493795030464 evaluation.py:255] Starting evaluation at 2019-08-14T18:35:40Z
I0814 18:35:40.172471 140493795030464 tpu_estimator.py:499] TPU job name worker
I0814 18:35:40.251014 140493795030464 monitored_session.py:240] Graph was finalized.
W0814 18:35:40.251749 140493795030464 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:35:40.440853 140493795030464 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:35:43.024717 140493795030464 session_manager.py:500] Running local_init_op.
I0814 18:35:43.049849 140493795030464 session_manager.py:502] Done running local_init_op.
I0814 18:35:43.103255 140493795030464 tpu_estimator.py:557] Init TPU system
I0814 18:36:52.076332 140493795030464 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:36:52.077332 140493024630528 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:36:52.077789 140492540999424 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:36:52.141726 140493795030464 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:36:52.169385 140493795030464 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:36:52.169737 140493795030464 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:36:52.267848 140492532606720 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:36:52.457191 140492532606720 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:36:52.954387 140492540999424 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:36:53.259955 140493795030464 evaluation.py:167] Evaluation [10/10]
I0814 18:36:53.260324 140493795030464 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:36:53.260442 140493795030464 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:36:53.260643 140493024630528 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:36:53.260756 140493024630528 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:36:53.260906 140493795030464 error_handling.py:96] infeed marked as finished
I0814 18:36:53.260994 140493795030464 tpu_estimator.py:602] Stop output thread controller
I0814 18:36:53.261042 140493795030464 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:36:53.261173 140492540999424 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:36:53.261251 140492540999424 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:36:53.261377 140493795030464 error_handling.py:96] outfeed marked as finished
I0814 18:36:53.261454 140493795030464 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:37:22.558203 140493795030464 evaluation.py:275] Finished evaluation at 2019-08-14-18:37:22
I0814 18:37:22.558545 140493795030464 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1009, global_step = 30, loss = 1872.2297
I0814 18:37:26.783498 140493795030464 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:37:27.587521 140493795030464 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1872.2297, 'global_step': 30, 'accuracy': 0.1009}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565807661428139...
Removing gs://yangyou-mnist/log/checkpoint#1565807728169821...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565807648.v3-8-tpu#1565807731632350...
Removing gs://yangyou-mnist/log/#1565807648143166...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565807653208100...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565807660490108...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565807665847854...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565807724954037...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565807725910207...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565807730531129...
Removing gs://yangyou-mnist/log/eval/#1565807844268616...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565807844.v3-8-tpu#1565807847291255...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:37:31.201081 140242286396864 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:37:31.201900 140242286396864 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:37:31.204634 140242286396864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:37:31.205527 140242286396864 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:37:31.206171 140242286396864 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:37:31.206302 140242286396864 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:37:31.642113 140242286396864 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:37:31.649940 140242286396864 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:37:31.654350 140242286396864 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:37:31.698596 140242286396864 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:37:31.698863 140242286396864 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:37:31.956135 140242286396864 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:37:32.008234 140242286396864 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:37:32.008538 140242286396864 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:37:32.171654 140242286396864 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8c8dd31210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8c8ff101d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:37:32.172002 140242286396864 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:37:32.482441 140242286396864 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:37:32.485305: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:37:32.502671 140242286396864 tpu_system_metadata.py:148] Found TPU system:
I0814 18:37:32.502938 140242286396864 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:37:32.503462 140242286396864 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:37:32.503530 140242286396864 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:37:32.503613 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:37:32.503979 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:37:32.504043 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:37:32.504117 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:37:32.504174 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:37:32.504228 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:37:32.504281 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:37:32.504332 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:37:32.504385 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:37:32.504494 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:37:32.504551 140242286396864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:37:32.511179 140242286396864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:37:32.525171 140242286396864 estimator.py:1145] Calling model_fn.
W0814 18:37:32.525836 140242286396864 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:37:32.817105 140242286396864 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:37:33.247833 140242286396864 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:37:33.317991 140242286396864 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:37:33.323899 140242286396864 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:37:33.505469 140242286396864 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:37:33.519450 140242286396864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:37:33.531387 140242286396864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:37:33.532494 140242286396864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:37:33.539423 140242286396864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:37:33.544615 140242286396864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:37:33.544814 140242286396864 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:37:33.557641 140242286396864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:37:33.669555 140242286396864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:37:33.711616 140242286396864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:37:33.756330 140242286396864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:37:33.808844 140242286396864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:37:33.977626 140242286396864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:37:34.029006 140242286396864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:37:34.078720 140242286396864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:37:34.130095 140242286396864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:37:34.176054 140242286396864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:37:34.218312 140242286396864 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:37:34.234600 140242286396864 estimator.py:1147] Done calling model_fn.
I0814 18:37:37.847517 140242286396864 tpu_estimator.py:499] TPU job name worker
I0814 18:37:37.956561 140242286396864 monitored_session.py:240] Graph was finalized.
I0814 18:37:38.606777 140242286396864 session_manager.py:500] Running local_init_op.
I0814 18:37:38.656258 140242286396864 session_manager.py:502] Done running local_init_op.
I0814 18:37:41.448518 140242286396864 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:37:53.454493 140242286396864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:37:53.617561 140242286396864 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:37:53.618032 140242286396864 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:37:53.618432: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:37:53.623934 140242286396864 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:37:53.626152 140242286396864 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:37:53.630625 140242286396864 tpu_estimator.py:557] Init TPU system
I0814 18:38:36.126645 140242286396864 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 18:38:36.127687 140241390257920 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:38:36.128180 140241381865216 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:38:36.189584 140241373472512 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:38:36.193280 140242286396864 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:38:36.194462 140242286396864 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:38:36.344830 140241373472512 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 18:38:41.033127 140241381865216 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:38:45.868529 140242286396864 basic_session_run_hooks.py:262] loss = 19824.787, step = 30
I0814 18:38:45.871053 140242286396864 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:38:59.405175 140242286396864 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:38:59.405457 140242286396864 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:38:59.405802 140241390257920 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:38:59.406146 140241390257920 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:38:59.406389 140242286396864 error_handling.py:96] infeed marked as finished
I0814 18:38:59.406747 140242286396864 tpu_estimator.py:602] Stop output thread controller
I0814 18:38:59.406816 140242286396864 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:38:59.407026 140241381865216 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:38:59.407233 140241381865216 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:38:59.407491 140242286396864 error_handling.py:96] outfeed marked as finished
I0814 18:38:59.407740 140242286396864 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:39:06.492557 140242286396864 estimator.py:368] Loss for final step: 19824.787.
I0814 18:39:06.493398 140242286396864 error_handling.py:96] training_loop marked as finished
I0814 18:39:07.276283 140242286396864 estimator.py:1145] Calling model_fn.
E0814 18:39:07.955848 140242286396864 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:39:08.187894 140242286396864 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:39:08.212070 140242286396864 estimator.py:1147] Done calling model_fn.
I0814 18:39:08.228853 140242286396864 evaluation.py:255] Starting evaluation at 2019-08-14T18:39:08Z
I0814 18:39:08.229103 140242286396864 tpu_estimator.py:499] TPU job name worker
I0814 18:39:08.305716 140242286396864 monitored_session.py:240] Graph was finalized.
W0814 18:39:08.306513 140242286396864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:39:08.497864 140242286396864 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:39:11.401966 140242286396864 session_manager.py:500] Running local_init_op.
I0814 18:39:11.426780 140242286396864 session_manager.py:502] Done running local_init_op.
I0814 18:39:11.476159 140242286396864 tpu_estimator.py:557] Init TPU system
I0814 18:40:20.106120 140242286396864 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:40:20.107202 140241386587904 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:40:20.108107 140241378195200 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:40:20.181535 140242286396864 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:40:20.207475 140242286396864 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:40:20.207921 140242286396864 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:40:20.233069 140241364817664 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:40:20.517748 140241364817664 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:40:20.986205 140241378195200 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:40:21.447444 140242286396864 evaluation.py:167] Evaluation [10/10]
I0814 18:40:21.447786 140242286396864 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:40:21.447863 140242286396864 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:40:21.448072 140241386587904 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:40:21.448178 140241386587904 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:40:21.448312 140242286396864 error_handling.py:96] infeed marked as finished
I0814 18:40:21.448523 140242286396864 tpu_estimator.py:602] Stop output thread controller
I0814 18:40:21.448597 140242286396864 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:40:21.448718 140241378195200 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:40:21.448792 140241378195200 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:40:21.448909 140242286396864 error_handling.py:96] outfeed marked as finished
I0814 18:40:21.448995 140242286396864 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:40:50.616539 140242286396864 evaluation.py:275] Finished evaluation at 2019-08-14-18:40:50
I0814 18:40:50.616926 140242286396864 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0892, global_step = 30, loss = 2434464800000000.0
I0814 18:40:54.904721 140242286396864 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:40:55.744486 140242286396864 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2434464800000000.0, 'global_step': 30, 'accuracy': 0.0892}

Removing gs://yangyou-mnist/log/#1565807855840469...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565807868646353...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565807856.v3-8-tpu#1565807939097951...
Removing gs://yangyou-mnist/log/checkpoint#1565807935838964...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565807860904426...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565807872978279...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565807867752906...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565807932819733...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565807933615694...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565807938065526...
Removing gs://yangyou-mnist/log/eval/#1565808052286591...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565808052.v3-8-tpu#1565808055429929...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:40:59.554991 139686761858496 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:40:59.555799 139686761858496 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:40:59.558469 139686761858496 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:40:59.559300 139686761858496 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:40:59.559920 139686761858496 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:40:59.560055 139686761858496 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:40:59.981683 139686761858496 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:40:59.989280 139686761858496 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:40:59.993228 139686761858496 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:41:00.046397 139686761858496 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:41:00.046673 139686761858496 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:41:00.279645 139686761858496 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:41:00.331052 139686761858496 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:41:00.331331 139686761858496 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:41:00.521070 139686761858496 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0b35fb5190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0b38194210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:41:00.521447 139686761858496 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:41:00.874916 139686761858496 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:41:00.878289: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:41:00.891715 139686761858496 tpu_system_metadata.py:148] Found TPU system:
I0814 18:41:00.892010 139686761858496 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:41:00.892579 139686761858496 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:41:00.892644 139686761858496 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:41:00.892705 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:41:00.893023 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:41:00.893086 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:41:00.893138 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:41:00.893187 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:41:00.893239 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:41:00.893294 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:41:00.893341 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:41:00.893388 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:41:00.893434 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:41:00.893481 139686761858496 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:41:00.899656 139686761858496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:41:00.912491 139686761858496 estimator.py:1145] Calling model_fn.
W0814 18:41:00.913158 139686761858496 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:41:01.185537 139686761858496 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:41:01.803114 139686761858496 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:41:01.865686 139686761858496 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:41:01.871814 139686761858496 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:41:02.056186 139686761858496 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:41:02.070676 139686761858496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:41:02.082835 139686761858496 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:41:02.083945 139686761858496 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:41:02.091286 139686761858496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:41:02.096676 139686761858496 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:41:02.096925 139686761858496 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 18:41:02.109661 139686761858496 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:41:02.223831 139686761858496 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:41:02.268481 139686761858496 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:41:02.314362 139686761858496 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:41:02.365850 139686761858496 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:41:02.543905 139686761858496 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:41:02.593772 139686761858496 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:41:02.642100 139686761858496 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:41:02.691267 139686761858496 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:41:02.736614 139686761858496 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:41:02.779227 139686761858496 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:41:02.795943 139686761858496 estimator.py:1147] Done calling model_fn.
I0814 18:41:06.269197 139686761858496 tpu_estimator.py:499] TPU job name worker
I0814 18:41:06.381676 139686761858496 monitored_session.py:240] Graph was finalized.
I0814 18:41:07.074625 139686761858496 session_manager.py:500] Running local_init_op.
I0814 18:41:07.135921 139686761858496 session_manager.py:502] Done running local_init_op.
I0814 18:41:09.888861 139686761858496 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:41:22.393368 139686761858496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:41:22.570986 139686761858496 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:41:22.571471 139686761858496 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:41:22.571873: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:41:22.576724 139686761858496 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:41:22.578815 139686761858496 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:41:22.582624 139686761858496 tpu_estimator.py:557] Init TPU system
I0814 18:42:04.125334 139686761858496 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 18:42:04.126198 139685865707264 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:42:04.126754 139685857314560 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:42:04.191246 139686761858496 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:42:04.194760 139686761858496 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 18:42:04.200087 139685848921856 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:42:04.451397 139685848921856 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:42:08.926341 139685857314560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:42:13.583714 139686761858496 basic_session_run_hooks.py:262] loss = 2.1485925, step = 30
I0814 18:42:13.586333 139686761858496 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:42:27.632016 139686761858496 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:42:27.632361 139686761858496 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:42:27.633821 139685865707264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:42:27.633979 139685865707264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:42:27.634128 139686761858496 error_handling.py:96] infeed marked as finished
I0814 18:42:27.634325 139686761858496 tpu_estimator.py:602] Stop output thread controller
I0814 18:42:27.634388 139686761858496 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:42:27.634512 139685857314560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:42:27.634608 139685857314560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:42:27.634742 139686761858496 error_handling.py:96] outfeed marked as finished
I0814 18:42:27.634825 139686761858496 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:42:34.579420 139686761858496 estimator.py:368] Loss for final step: 2.1485925.
I0814 18:42:34.580178 139686761858496 error_handling.py:96] training_loop marked as finished
I0814 18:42:35.277888 139686761858496 estimator.py:1145] Calling model_fn.
E0814 18:42:35.994524 139686761858496 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:42:36.220179 139686761858496 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:42:36.243249 139686761858496 estimator.py:1147] Done calling model_fn.
I0814 18:42:36.260636 139686761858496 evaluation.py:255] Starting evaluation at 2019-08-14T18:42:36Z
I0814 18:42:36.260881 139686761858496 tpu_estimator.py:499] TPU job name worker
I0814 18:42:36.339478 139686761858496 monitored_session.py:240] Graph was finalized.
W0814 18:42:36.340257 139686761858496 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:42:36.528878 139686761858496 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:42:39.079348 139686761858496 session_manager.py:500] Running local_init_op.
I0814 18:42:39.104489 139686761858496 session_manager.py:502] Done running local_init_op.
I0814 18:42:39.159516 139686761858496 tpu_estimator.py:557] Init TPU system
I0814 18:43:48.024087 139686761858496 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:43:48.025008 139685862037248 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:43:48.025580 139685853644544 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:43:48.093005 139686761858496 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:43:48.118534 139686761858496 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:43:48.118880 139686761858496 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:43:48.165746 139685840267008 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:43:48.356049 139685840267008 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:43:48.902537 139685853644544 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:43:49.227108 139686761858496 evaluation.py:167] Evaluation [10/10]
I0814 18:43:49.227430 139686761858496 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:43:49.227495 139686761858496 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:43:49.227691 139685862037248 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:43:49.228064 139685862037248 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:43:49.228437 139686761858496 error_handling.py:96] infeed marked as finished
I0814 18:43:49.228699 139686761858496 tpu_estimator.py:602] Stop output thread controller
I0814 18:43:49.228769 139686761858496 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:43:49.228950 139685853644544 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:43:49.229141 139685853644544 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:43:49.229317 139686761858496 error_handling.py:96] outfeed marked as finished
I0814 18:43:49.229456 139686761858496 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:44:18.452275 139686761858496 evaluation.py:275] Finished evaluation at 2019-08-14-18:44:18
I0814 18:44:18.452759 139686761858496 estimator.py:2039] Saving dict for global step 30: accuracy = 0.5924, global_step = 30, loss = 2.1438365
I0814 18:44:22.995186 139686761858496 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:44:23.893785 139686761858496 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.1438365, 'global_step': 30, 'accuracy': 0.5924}

Removing gs://yangyou-mnist/log/#1565808064319693...
Removing gs://yangyou-mnist/log/checkpoint#1565808143805733...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565808064.v3-8-tpu#1565808147327240...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565808069302783...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565808076492521...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565808077419204...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565808140448201...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565808081883228...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565808141429878...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565808146265352...
Removing gs://yangyou-mnist/log/eval/#1565808260084346...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565808260.v3-8-tpu#1565808263591137...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:44:27.754879 140336245786048 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:44:27.755743 140336245786048 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:44:27.758480 140336245786048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:44:27.759310 140336245786048 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:44:27.759882 140336245786048 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:44:27.760005 140336245786048 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:44:28.175654 140336245786048 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:44:28.184597 140336245786048 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:44:28.189019 140336245786048 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:44:28.245048 140336245786048 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:44:28.245352 140336245786048 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:44:28.518520 140336245786048 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:44:28.570888 140336245786048 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:44:28.571198 140336245786048 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:44:28.717550 140336245786048 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa26e3d8190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa2705b8210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:44:28.717900 140336245786048 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:44:29.049375 140336245786048 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:44:29.052430: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:44:29.066493 140336245786048 tpu_system_metadata.py:148] Found TPU system:
I0814 18:44:29.066826 140336245786048 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:44:29.067368 140336245786048 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:44:29.067426 140336245786048 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:44:29.067481 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:44:29.067780 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:44:29.067836 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:44:29.067887 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:44:29.067934 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:44:29.068010 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:44:29.068057 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:44:29.068118 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:44:29.068166 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:44:29.068212 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:44:29.068259 140336245786048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:44:29.075964 140336245786048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:44:29.088815 140336245786048 estimator.py:1145] Calling model_fn.
W0814 18:44:29.089420 140336245786048 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:44:29.357667 140336245786048 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:44:30.082602 140336245786048 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:44:30.143435 140336245786048 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:44:30.149338 140336245786048 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:44:30.332163 140336245786048 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:44:30.346187 140336245786048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:44:30.358635 140336245786048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:44:30.359713 140336245786048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:44:30.366847 140336245786048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:44:30.372162 140336245786048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:44:30.372380 140336245786048 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 18:44:30.385257 140336245786048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:44:30.496450 140336245786048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:44:30.538309 140336245786048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:44:30.583765 140336245786048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:44:30.634983 140336245786048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:44:30.797779 140336245786048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:44:30.848683 140336245786048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:44:30.897954 140336245786048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:44:30.948987 140336245786048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:44:30.994929 140336245786048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:44:31.037221 140336245786048 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:44:31.053574 140336245786048 estimator.py:1147] Done calling model_fn.
I0814 18:44:35.559230 140336245786048 tpu_estimator.py:499] TPU job name worker
I0814 18:44:35.667571 140336245786048 monitored_session.py:240] Graph was finalized.
I0814 18:44:36.327441 140336245786048 session_manager.py:500] Running local_init_op.
I0814 18:44:36.387700 140336245786048 session_manager.py:502] Done running local_init_op.
I0814 18:44:39.096483 140336245786048 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:44:51.940756 140336245786048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:44:52.081897 140336245786048 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:44:52.082357 140336245786048 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:44:52.082886: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:44:52.087982 140336245786048 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:44:52.090156 140336245786048 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:44:52.094480 140336245786048 tpu_estimator.py:557] Init TPU system
I0814 18:45:32.132561 140336245786048 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 18:45:32.133512 140335349487360 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:45:32.133986 140335341094656 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:45:32.194856 140335332701952 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:45:32.200014 140336245786048 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:45:32.202711 140336245786048 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:45:32.343492 140335332701952 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:45:36.967649 140335341094656 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:45:41.885315 140336245786048 basic_session_run_hooks.py:262] loss = 1.9664519, step = 30
I0814 18:45:41.887676 140336245786048 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:45:55.468960 140336245786048 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:45:55.469257 140336245786048 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:45:55.469460 140335349487360 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:45:55.469561 140335349487360 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:45:55.469692 140336245786048 error_handling.py:96] infeed marked as finished
I0814 18:45:55.469796 140336245786048 tpu_estimator.py:602] Stop output thread controller
I0814 18:45:55.469852 140336245786048 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:45:55.469964 140335341094656 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:45:55.470035 140335341094656 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:45:55.470151 140336245786048 error_handling.py:96] outfeed marked as finished
I0814 18:45:55.470235 140336245786048 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:46:02.487147 140336245786048 estimator.py:368] Loss for final step: 1.9664519.
I0814 18:46:02.488055 140336245786048 error_handling.py:96] training_loop marked as finished
I0814 18:46:03.196335 140336245786048 estimator.py:1145] Calling model_fn.
E0814 18:46:03.992712 140336245786048 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:46:04.231483 140336245786048 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:46:04.255426 140336245786048 estimator.py:1147] Done calling model_fn.
I0814 18:46:04.272202 140336245786048 evaluation.py:255] Starting evaluation at 2019-08-14T18:46:04Z
I0814 18:46:04.272469 140336245786048 tpu_estimator.py:499] TPU job name worker
I0814 18:46:04.350318 140336245786048 monitored_session.py:240] Graph was finalized.
W0814 18:46:04.351054 140336245786048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:46:04.547633 140336245786048 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:46:07.204309 140336245786048 session_manager.py:500] Running local_init_op.
I0814 18:46:07.228259 140336245786048 session_manager.py:502] Done running local_init_op.
I0814 18:46:07.274590 140336245786048 tpu_estimator.py:557] Init TPU system
I0814 18:47:16.040314 140336245786048 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:47:16.041471 140335345817344 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:47:16.042289 140335337424640 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:47:16.108439 140336245786048 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:47:16.138503 140336245786048 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:47:16.138943 140336245786048 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:47:16.238748 140335324047104 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:47:16.394581 140335324047104 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:47:16.933382 140335337424640 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:47:17.205205 140336245786048 evaluation.py:167] Evaluation [10/10]
I0814 18:47:17.205641 140336245786048 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:47:17.205718 140336245786048 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:47:17.205993 140335345817344 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:47:17.206278 140335345817344 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:47:17.206517 140336245786048 error_handling.py:96] infeed marked as finished
I0814 18:47:17.206696 140336245786048 tpu_estimator.py:602] Stop output thread controller
I0814 18:47:17.206749 140336245786048 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:47:17.206907 140335337424640 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:47:17.207067 140335337424640 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:47:17.207240 140336245786048 error_handling.py:96] outfeed marked as finished
I0814 18:47:17.207385 140336245786048 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:47:46.494045 140336245786048 evaluation.py:275] Finished evaluation at 2019-08-14-18:47:46
I0814 18:47:46.494395 140336245786048 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7286, global_step = 30, loss = 1.953298
I0814 18:47:50.823817 140336245786048 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:47:51.618685 140336245786048 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.953298, 'global_step': 30, 'accuracy': 0.7286}

Removing gs://yangyou-mnist/log/#1565808273443327...
Removing gs://yangyou-mnist/log/checkpoint#1565808352131547...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565808273.v3-8-tpu#1565808355165093...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565808286538220...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565808278519264...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565808291419286...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565808285605004...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565808349117572...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565808349980593...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565808354258450...
Removing gs://yangyou-mnist/log/eval/#1565808468202017...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565808468.v3-8-tpu#1565808471305177...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:47:55.560714 139654115853760 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:47:55.561501 139654115853760 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:47:55.564101 139654115853760 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:47:55.565013 139654115853760 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:47:55.565602 139654115853760 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:47:55.565741 139654115853760 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:47:55.971019 139654115853760 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:47:55.978456 139654115853760 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:47:55.982537 139654115853760 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:47:56.097405 139654115853760 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:47:56.097687 139654115853760 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:47:56.357048 139654115853760 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:47:56.410969 139654115853760 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:47:56.411241 139654115853760 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:47:56.570216 139654115853760 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f039c1f6450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f039e3ec210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:47:56.570569 139654115853760 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:47:56.893582 139654115853760 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:47:56.896593: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:47:56.909800 139654115853760 tpu_system_metadata.py:148] Found TPU system:
I0814 18:47:56.910052 139654115853760 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:47:56.910660 139654115853760 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:47:56.910731 139654115853760 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:47:56.910789 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:47:56.911094 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:47:56.911158 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:47:56.911207 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:47:56.911288 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:47:56.911345 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:47:56.911391 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:47:56.911437 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:47:56.911483 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:47:56.911529 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:47:56.911587 139654115853760 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:47:56.917728 139654115853760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:47:56.930546 139654115853760 estimator.py:1145] Calling model_fn.
W0814 18:47:56.931148 139654115853760 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:47:57.195274 139654115853760 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:47:57.887586 139654115853760 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:47:57.948435 139654115853760 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:47:57.954432 139654115853760 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:47:58.133375 139654115853760 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:47:58.147027 139654115853760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:47:58.158992 139654115853760 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:47:58.160015 139654115853760 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:47:58.166990 139654115853760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:47:58.172216 139654115853760 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:47:58.172455 139654115853760 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 18:47:58.184915 139654115853760 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:47:58.294307 139654115853760 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:47:58.335865 139654115853760 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:47:58.380506 139654115853760 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:47:58.431154 139654115853760 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:47:58.592330 139654115853760 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:47:58.641166 139654115853760 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:47:58.689162 139654115853760 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:47:58.738146 139654115853760 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:47:58.783427 139654115853760 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:47:58.824491 139654115853760 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:47:58.840233 139654115853760 estimator.py:1147] Done calling model_fn.
I0814 18:48:02.280569 139654115853760 tpu_estimator.py:499] TPU job name worker
I0814 18:48:02.389986 139654115853760 monitored_session.py:240] Graph was finalized.
I0814 18:48:03.031954 139654115853760 session_manager.py:500] Running local_init_op.
I0814 18:48:03.092885 139654115853760 session_manager.py:502] Done running local_init_op.
I0814 18:48:05.847960 139654115853760 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:48:18.069650 139654115853760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:48:18.211380 139654115853760 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:48:18.211882 139654115853760 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:48:18.212308: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:48:18.217665 139654115853760 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:48:18.219867 139654115853760 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:48:18.223895 139654115853760 tpu_estimator.py:557] Init TPU system
I0814 18:49:00.106684 139654115853760 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 18:49:00.108053 139653421082368 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:49:00.108819 139652942001920 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:49:00.166594 139652933609216 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:49:00.176301 139654115853760 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:49:00.177494 139654115853760 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:49:00.379306 139652933609216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:49:04.957382 139652942001920 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:49:09.746546 139654115853760 basic_session_run_hooks.py:262] loss = 1.4579048, step = 30
I0814 18:49:09.749223 139654115853760 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:49:23.074644 139654115853760 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:49:23.074934 139654115853760 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:49:23.075273 139653421082368 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:49:23.075556 139653421082368 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:49:23.075803 139654115853760 error_handling.py:96] infeed marked as finished
I0814 18:49:23.076028 139654115853760 tpu_estimator.py:602] Stop output thread controller
I0814 18:49:23.076097 139654115853760 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:49:23.076456 139652942001920 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:49:23.076647 139652942001920 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:49:23.076885 139654115853760 error_handling.py:96] outfeed marked as finished
I0814 18:49:23.077142 139654115853760 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:49:30.523474 139654115853760 estimator.py:368] Loss for final step: 1.4579048.
I0814 18:49:30.524605 139654115853760 error_handling.py:96] training_loop marked as finished
I0814 18:49:31.256223 139654115853760 estimator.py:1145] Calling model_fn.
E0814 18:49:31.944734 139654115853760 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:49:32.168112 139654115853760 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:49:32.192289 139654115853760 estimator.py:1147] Done calling model_fn.
I0814 18:49:32.210930 139654115853760 evaluation.py:255] Starting evaluation at 2019-08-14T18:49:32Z
I0814 18:49:32.211183 139654115853760 tpu_estimator.py:499] TPU job name worker
I0814 18:49:32.297449 139654115853760 monitored_session.py:240] Graph was finalized.
W0814 18:49:32.298165 139654115853760 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:49:32.488524 139654115853760 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:49:35.264354 139654115853760 session_manager.py:500] Running local_init_op.
I0814 18:49:35.289464 139654115853760 session_manager.py:502] Done running local_init_op.
I0814 18:49:35.345669 139654115853760 tpu_estimator.py:557] Init TPU system
I0814 18:50:44.042866 139654115853760 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:50:44.043941 139652942001920 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:50:44.044672 139652933609216 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:50:44.111629 139654115853760 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:50:44.141922 139654115853760 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:50:44.142290 139654115853760 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:50:44.931415 139652933609216 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:50:45.254338 139654115853760 evaluation.py:167] Evaluation [10/10]
I0814 18:50:45.254779 139654115853760 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:50:45.254848 139654115853760 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:50:45.255163 139652942001920 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:50:45.255455 139652942001920 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:50:45.255644 139654115853760 error_handling.py:96] infeed marked as finished
I0814 18:50:45.255805 139654115853760 tpu_estimator.py:602] Stop output thread controller
I0814 18:50:45.255857 139654115853760 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:50:45.256083 139652933609216 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:50:45.256310 139652933609216 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:50:45.256542 139654115853760 error_handling.py:96] outfeed marked as finished
I0814 18:50:45.256732 139654115853760 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:50:45.291366 139652925216512 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:50:45.427508 139652925216512 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:51:15.531156 139654115853760 evaluation.py:275] Finished evaluation at 2019-08-14-18:51:15
I0814 18:51:15.531486 139654115853760 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7968, global_step = 30, loss = 1.4160124
I0814 18:51:19.847862 139654115853760 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:51:20.638025 139654115853760 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.4160124, 'global_step': 30, 'accuracy': 0.7968}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565808492928307...
Removing gs://yangyou-mnist/log/checkpoint#1565808559558523...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565808497561592...
Removing gs://yangyou-mnist/log/#1565808480312015...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565808556520395...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565808485228469...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565808480.v3-8-tpu#1565808562771599...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565808557388345...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565808492104082...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565808561793743...
Removing gs://yangyou-mnist/log/eval/#1565808677180303...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565808677.v3-8-tpu#1565808680330436...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:51:24.393040 140216488842688 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:51:24.393838 140216488842688 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:51:24.396501 140216488842688 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:51:24.397373 140216488842688 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:51:24.397977 140216488842688 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:51:24.398116 140216488842688 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:51:24.800803 140216488842688 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:51:24.809011 140216488842688 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:51:24.813225 140216488842688 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:51:24.870543 140216488842688 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:51:24.870825 140216488842688 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:51:25.046149 140216488842688 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:51:25.097090 140216488842688 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:51:25.097362 140216488842688 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:51:25.258986 140216488842688 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f868c2ba190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f868e499210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:51:25.259383 140216488842688 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:51:25.586249 140216488842688 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:51:25.589044: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:51:25.601109 140216488842688 tpu_system_metadata.py:148] Found TPU system:
I0814 18:51:25.601332 140216488842688 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:51:25.601928 140216488842688 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:51:25.601986 140216488842688 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:51:25.602041 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:51:25.602402 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:51:25.602458 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:51:25.602509 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:51:25.602570 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:51:25.602618 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:51:25.602672 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:51:25.602719 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:51:25.602766 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:51:25.602813 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:51:25.602859 140216488842688 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:51:25.608829 140216488842688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:51:25.621284 140216488842688 estimator.py:1145] Calling model_fn.
W0814 18:51:25.621906 140216488842688 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:51:25.893575 140216488842688 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:51:26.497600 140216488842688 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:51:26.559962 140216488842688 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:51:26.565942 140216488842688 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:51:26.748091 140216488842688 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:51:26.762203 140216488842688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:51:26.775036 140216488842688 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:51:26.776148 140216488842688 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:51:26.783191 140216488842688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:51:26.788525 140216488842688 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:51:26.788742 140216488842688 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 18:51:26.801662 140216488842688 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:51:26.912913 140216488842688 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:51:26.955027 140216488842688 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:51:26.999394 140216488842688 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:51:27.051445 140216488842688 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:51:27.213232 140216488842688 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:51:27.268610 140216488842688 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:51:27.317838 140216488842688 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:51:27.368765 140216488842688 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:51:27.416107 140216488842688 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:51:27.459646 140216488842688 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:51:27.476336 140216488842688 estimator.py:1147] Done calling model_fn.
I0814 18:51:31.071983 140216488842688 tpu_estimator.py:499] TPU job name worker
I0814 18:51:31.183695 140216488842688 monitored_session.py:240] Graph was finalized.
I0814 18:51:31.845220 140216488842688 session_manager.py:500] Running local_init_op.
I0814 18:51:31.893544 140216488842688 session_manager.py:502] Done running local_init_op.
I0814 18:51:34.566307 140216488842688 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:51:46.856266 140216488842688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:51:47.021264 140216488842688 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:51:47.021677 140216488842688 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:51:47.022172: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:51:47.026180 140216488842688 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:51:47.028331 140216488842688 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:51:47.033201 140216488842688 tpu_estimator.py:557] Init TPU system
I0814 18:52:28.131805 140216488842688 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 18:52:28.132841 140215794071296 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:52:28.133589 140215314282240 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:52:28.196993 140216488842688 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:52:28.198792 140216488842688 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 18:52:28.204191 140215305889536 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:52:28.374526 140215305889536 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:52:33.218589 140215314282240 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:52:37.451466 140216488842688 basic_session_run_hooks.py:262] loss = 1.1170956, step = 30
I0814 18:52:37.454205 140216488842688 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:52:51.330673 140216488842688 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:52:51.331023 140216488842688 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:52:51.331316 140215794071296 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:52:51.331588 140215794071296 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:52:51.331788 140216488842688 error_handling.py:96] infeed marked as finished
I0814 18:52:51.331985 140216488842688 tpu_estimator.py:602] Stop output thread controller
I0814 18:52:51.332062 140216488842688 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:52:51.332223 140215314282240 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:52:51.332330 140215314282240 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:52:51.332532 140216488842688 error_handling.py:96] outfeed marked as finished
I0814 18:52:51.332792 140216488842688 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:52:58.514508 140216488842688 estimator.py:368] Loss for final step: 1.1170956.
I0814 18:52:58.515434 140216488842688 error_handling.py:96] training_loop marked as finished
I0814 18:52:59.198241 140216488842688 estimator.py:1145] Calling model_fn.
E0814 18:52:59.892787 140216488842688 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:53:00.115115 140216488842688 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:53:00.136621 140216488842688 estimator.py:1147] Done calling model_fn.
I0814 18:53:00.152928 140216488842688 evaluation.py:255] Starting evaluation at 2019-08-14T18:53:00Z
I0814 18:53:00.153176 140216488842688 tpu_estimator.py:499] TPU job name worker
I0814 18:53:00.231209 140216488842688 monitored_session.py:240] Graph was finalized.
W0814 18:53:00.232002 140216488842688 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:53:00.427046 140216488842688 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:53:03.152610 140216488842688 session_manager.py:500] Running local_init_op.
I0814 18:53:03.177956 140216488842688 session_manager.py:502] Done running local_init_op.
I0814 18:53:03.226461 140216488842688 tpu_estimator.py:557] Init TPU system
I0814 18:54:12.047276 140216488842688 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:54:12.048192 140215314282240 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:54:12.048619 140215305889536 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:54:12.115390 140216488842688 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:54:12.139691 140216488842688 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:54:12.140024 140216488842688 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:54:12.178548 140215297496832 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:54:12.351864 140215297496832 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:54:12.918164 140215305889536 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:54:13.333096 140216488842688 evaluation.py:167] Evaluation [10/10]
I0814 18:54:13.333453 140216488842688 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:54:13.333529 140216488842688 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:54:13.333713 140215314282240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:54:13.333803 140215314282240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:54:13.333949 140216488842688 error_handling.py:96] infeed marked as finished
I0814 18:54:13.334036 140216488842688 tpu_estimator.py:602] Stop output thread controller
I0814 18:54:13.334084 140216488842688 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:54:13.334208 140215305889536 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:54:13.334280 140215305889536 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:54:13.334389 140216488842688 error_handling.py:96] outfeed marked as finished
I0814 18:54:13.334481 140216488842688 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:54:42.451204 140216488842688 evaluation.py:275] Finished evaluation at 2019-08-14-18:54:42
I0814 18:54:42.451627 140216488842688 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8097, global_step = 30, loss = 1.0630358
I0814 18:54:47.085108 140216488842688 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:54:47.921471 140216488842688 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.0630358, 'global_step': 30, 'accuracy': 0.8097}

Removing gs://yangyou-mnist/log/#1565808689020355...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565808701962318...
Removing gs://yangyou-mnist/log/checkpoint#1565808767637736...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565808764537622...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565808706345960...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565808689.v3-8-tpu#1565808771022598...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565808765474745...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565808693992827...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565808700939004...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565808770017716...
Removing gs://yangyou-mnist/log/eval/#1565808884165958...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565808884.v3-8-tpu#1565808887616024...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:54:51.757172 140143179814336 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:54:51.757981 140143179814336 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:54:51.760668 140143179814336 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:54:51.761512 140143179814336 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:54:51.762115 140143179814336 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:54:51.762244 140143179814336 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:54:52.183543 140143179814336 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:54:52.190522 140143179814336 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:54:52.195107 140143179814336 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:54:52.248547 140143179814336 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:54:52.248846 140143179814336 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:54:52.431549 140143179814336 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:54:52.553102 140143179814336 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:54:52.553374 140143179814336 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:54:52.679008 140143179814336 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f757a9ca290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f757cba9210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:54:52.679352 140143179814336 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:54:52.999509 140143179814336 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:54:53.002518: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:54:53.014031 140143179814336 tpu_system_metadata.py:148] Found TPU system:
I0814 18:54:53.014349 140143179814336 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:54:53.014832 140143179814336 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:54:53.014889 140143179814336 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:54:53.014945 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:54:53.015234 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:54:53.015291 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:54:53.015345 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:54:53.015408 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:54:53.015456 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:54:53.015503 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:54:53.015548 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:54:53.015600 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:54:53.015646 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:54:53.015695 140143179814336 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:54:53.021800 140143179814336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:54:53.034770 140143179814336 estimator.py:1145] Calling model_fn.
W0814 18:54:53.035463 140143179814336 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:54:53.320226 140143179814336 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:54:54.021295 140143179814336 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:54:54.083221 140143179814336 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:54:54.095927 140143179814336 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:54:54.286792 140143179814336 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:54:54.300863 140143179814336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:54:54.312995 140143179814336 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:54:54.314160 140143179814336 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:54:54.321165 140143179814336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:54:54.326438 140143179814336 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:54:54.326637 140143179814336 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 18:54:54.339047 140143179814336 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:54:54.450539 140143179814336 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:54:54.492160 140143179814336 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:54:54.537317 140143179814336 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:54:54.589777 140143179814336 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:54:54.762048 140143179814336 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:54:54.812973 140143179814336 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:54:54.862649 140143179814336 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:54:54.914556 140143179814336 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:54:54.961329 140143179814336 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:54:55.003771 140143179814336 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:54:55.020220 140143179814336 estimator.py:1147] Done calling model_fn.
I0814 18:54:58.458043 140143179814336 tpu_estimator.py:499] TPU job name worker
I0814 18:54:58.567080 140143179814336 monitored_session.py:240] Graph was finalized.
I0814 18:54:59.263351 140143179814336 session_manager.py:500] Running local_init_op.
I0814 18:54:59.321369 140143179814336 session_manager.py:502] Done running local_init_op.
I0814 18:55:02.080142 140143179814336 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:55:15.569519 140143179814336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:55:15.740129 140143179814336 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:55:15.740586 140143179814336 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:55:15.741073: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:55:15.747041 140143179814336 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:55:15.749285 140143179814336 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:55:15.753304 140143179814336 tpu_estimator.py:557] Init TPU system
I0814 18:55:56.132884 140143179814336 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 18:55:56.133753 140142283052800 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:55:56.134593 140142274660096 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:55:56.197429 140142266267392 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:55:56.200031 140143179814336 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:55:56.201401 140143179814336 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:55:56.366519 140142266267392 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:56:00.957251 140142274660096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:56:05.361115 140143179814336 basic_session_run_hooks.py:262] loss = 0.64792967, step = 30
I0814 18:56:05.363651 140143179814336 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:56:19.014507 140143179814336 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:56:19.014823 140143179814336 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:56:19.015045 140142283052800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:56:19.015156 140142283052800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:56:19.015297 140143179814336 error_handling.py:96] infeed marked as finished
I0814 18:56:19.015397 140143179814336 tpu_estimator.py:602] Stop output thread controller
I0814 18:56:19.015445 140143179814336 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:56:19.015558 140142274660096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:56:19.015633 140142274660096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:56:19.015752 140143179814336 error_handling.py:96] outfeed marked as finished
I0814 18:56:19.015830 140143179814336 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:56:26.485471 140143179814336 estimator.py:368] Loss for final step: 0.64792967.
I0814 18:56:26.486274 140143179814336 error_handling.py:96] training_loop marked as finished
I0814 18:56:27.364468 140143179814336 estimator.py:1145] Calling model_fn.
E0814 18:56:28.038356 140143179814336 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:56:28.265671 140143179814336 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:56:28.287096 140143179814336 estimator.py:1147] Done calling model_fn.
I0814 18:56:28.303987 140143179814336 evaluation.py:255] Starting evaluation at 2019-08-14T18:56:28Z
I0814 18:56:28.304239 140143179814336 tpu_estimator.py:499] TPU job name worker
I0814 18:56:28.383507 140143179814336 monitored_session.py:240] Graph was finalized.
W0814 18:56:28.384298 140143179814336 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:56:28.577606 140143179814336 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:56:31.303909 140143179814336 session_manager.py:500] Running local_init_op.
I0814 18:56:31.328658 140143179814336 session_manager.py:502] Done running local_init_op.
I0814 18:56:31.376775 140143179814336 tpu_estimator.py:557] Init TPU system
I0814 18:57:40.041640 140143179814336 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:57:40.042727 140142279644928 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:57:40.043659 140142271252224 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:57:40.115346 140143179814336 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:57:40.201194 140143179814336 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:57:40.201673 140143179814336 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:57:40.299314 140142262859520 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:57:40.501899 140142262859520 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:57:40.984194 140142271252224 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:57:41.429477 140143179814336 evaluation.py:167] Evaluation [10/10]
I0814 18:57:41.429898 140143179814336 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:57:41.429980 140143179814336 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:57:41.430268 140142279644928 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:57:41.430620 140142279644928 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:57:41.430846 140143179814336 error_handling.py:96] infeed marked as finished
I0814 18:57:41.431031 140143179814336 tpu_estimator.py:602] Stop output thread controller
I0814 18:57:41.431104 140143179814336 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:57:41.431416 140142271252224 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:57:41.431598 140142271252224 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:57:41.431778 140143179814336 error_handling.py:96] outfeed marked as finished
I0814 18:57:41.431921 140143179814336 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:58:10.582987 140143179814336 evaluation.py:275] Finished evaluation at 2019-08-14-18:58:10
I0814 18:58:10.583352 140143179814336 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8637, global_step = 30, loss = 0.595755
I0814 18:58:14.950762 140143179814336 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:58:15.777128 140143179814336 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.595755, 'global_step': 30, 'accuracy': 0.8637}

Removing gs://yangyou-mnist/log/#1565808896551594...
Removing gs://yangyou-mnist/log/checkpoint#1565808975576909...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565808909760818...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565808901501814...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565808910605726...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565808973312667...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565808915054236...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565808896.v3-8-tpu#1565808978708485...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565808972410294...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565808977759614...
Removing gs://yangyou-mnist/log/eval/#1565809092262292...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565809092.v3-8-tpu#1565809095470264...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:58:19.646701 139746985854400 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:58:19.647473 139746985854400 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:58:19.650325 139746985854400 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:58:19.651168 139746985854400 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:58:19.651746 139746985854400 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:58:19.651871 139746985854400 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:58:20.063287 139746985854400 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:58:20.070475 139746985854400 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:58:20.074418 139746985854400 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:58:20.152976 139746985854400 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:58:20.153301 139746985854400 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:58:20.336337 139746985854400 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:58:20.388061 139746985854400 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:58:20.388341 139746985854400 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:58:20.551595 139746985854400 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f193b9c9150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f193dba8210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:58:20.551983 139746985854400 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:58:20.916856 139746985854400 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:58:20.920018: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:58:20.932720 139746985854400 tpu_system_metadata.py:148] Found TPU system:
I0814 18:58:20.932975 139746985854400 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:58:20.933512 139746985854400 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:58:20.933661 139746985854400 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:58:20.933727 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:58:20.934125 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:58:20.934191 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:58:20.934256 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:58:20.934314 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:58:20.934367 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:58:20.934422 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:58:20.934473 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:58:20.934525 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:58:20.934586 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:58:20.934639 139746985854400 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:58:20.941009 139746985854400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:58:20.955015 139746985854400 estimator.py:1145] Calling model_fn.
W0814 18:58:20.955662 139746985854400 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:58:21.223529 139746985854400 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:58:21.838855 139746985854400 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:58:21.902468 139746985854400 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:58:21.908519 139746985854400 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:58:22.104664 139746985854400 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:58:22.119240 139746985854400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:58:22.131792 139746985854400 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:58:22.132908 139746985854400 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:58:22.140229 139746985854400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:58:22.145628 139746985854400 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:58:22.145854 139746985854400 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 18:58:22.158690 139746985854400 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:58:22.280910 139746985854400 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:58:22.324048 139746985854400 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:58:22.369801 139746985854400 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:58:22.422741 139746985854400 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:58:22.588907 139746985854400 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:58:22.639866 139746985854400 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:58:22.690947 139746985854400 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:58:22.743416 139746985854400 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:58:22.791011 139746985854400 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:58:22.833642 139746985854400 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:58:22.850169 139746985854400 estimator.py:1147] Done calling model_fn.
I0814 18:58:26.220602 139746985854400 tpu_estimator.py:499] TPU job name worker
I0814 18:58:26.343924 139746985854400 monitored_session.py:240] Graph was finalized.
I0814 18:58:27.073887 139746985854400 session_manager.py:500] Running local_init_op.
I0814 18:58:27.133579 139746985854400 session_manager.py:502] Done running local_init_op.
I0814 18:58:29.842787 139746985854400 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:58:42.007128 139746985854400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:58:42.168509 139746985854400 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:58:42.169058 139746985854400 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:58:42.169457: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:58:42.175379 139746985854400 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:58:42.177625 139746985854400 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:58:42.183243 139746985854400 tpu_estimator.py:557] Init TPU system
I0814 18:59:24.117518 139746985854400 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 18:59:24.118377 139745954887424 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:59:24.118889 139745946494720 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:59:24.180924 139745938102016 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:59:24.181607 139746985854400 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:59:24.182651 139746985854400 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:59:24.330584 139745938102016 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:59:28.926987 139745946494720 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:59:33.700212 139746985854400 basic_session_run_hooks.py:262] loss = 0.4737382, step = 30
I0814 18:59:33.703336 139746985854400 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:59:47.313062 139746985854400 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:59:47.313417 139746985854400 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:59:47.313770 139745954887424 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:59:47.314093 139745954887424 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:59:47.314476 139746985854400 error_handling.py:96] infeed marked as finished
I0814 18:59:47.314691 139746985854400 tpu_estimator.py:602] Stop output thread controller
I0814 18:59:47.314744 139746985854400 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:59:47.314965 139745946494720 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:59:47.315184 139745946494720 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:59:47.315483 139746985854400 error_handling.py:96] outfeed marked as finished
I0814 18:59:47.315635 139746985854400 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:59:54.472151 139746985854400 estimator.py:368] Loss for final step: 0.4737382.
I0814 18:59:54.472986 139746985854400 error_handling.py:96] training_loop marked as finished
I0814 18:59:55.252574 139746985854400 estimator.py:1145] Calling model_fn.
E0814 18:59:55.976803 139746985854400 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:59:56.208790 139746985854400 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:59:56.231673 139746985854400 estimator.py:1147] Done calling model_fn.
I0814 18:59:56.249202 139746985854400 evaluation.py:255] Starting evaluation at 2019-08-14T18:59:56Z
I0814 18:59:56.249459 139746985854400 tpu_estimator.py:499] TPU job name worker
I0814 18:59:56.328243 139746985854400 monitored_session.py:240] Graph was finalized.
W0814 18:59:56.329055 139746985854400 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:59:56.525218 139746985854400 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:59:59.112848 139746985854400 session_manager.py:500] Running local_init_op.
I0814 18:59:59.137186 139746985854400 session_manager.py:502] Done running local_init_op.
I0814 18:59:59.183435 139746985854400 tpu_estimator.py:557] Init TPU system
I0814 19:01:07.971951 139746985854400 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:01:07.973232 139745951479552 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:01:07.973972 139745943086848 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:01:08.045080 139746985854400 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:01:08.072205 139746985854400 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:01:08.072709 139746985854400 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:01:08.108376 139745934694144 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:01:08.282841 139745934694144 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:01:08.877484 139745943086848 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:01:09.276648 139746985854400 evaluation.py:167] Evaluation [10/10]
I0814 19:01:09.276999 139746985854400 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:01:09.277098 139746985854400 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:01:09.277287 139745951479552 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:01:09.277384 139745951479552 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:01:09.277537 139746985854400 error_handling.py:96] infeed marked as finished
I0814 19:01:09.277632 139746985854400 tpu_estimator.py:602] Stop output thread controller
I0814 19:01:09.277687 139746985854400 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:01:09.277800 139745943086848 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:01:09.277873 139745943086848 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:01:09.277987 139746985854400 error_handling.py:96] outfeed marked as finished
I0814 19:01:09.278069 139746985854400 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:01:38.379528 139746985854400 evaluation.py:275] Finished evaluation at 2019-08-14-19:01:38
I0814 19:01:38.379861 139746985854400 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8913, global_step = 30, loss = 0.45022154
I0814 19:01:42.908811 139746985854400 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:01:43.834553 139746985854400 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.45022154, 'global_step': 30, 'accuracy': 0.8913}

Removing gs://yangyou-mnist/log/#1565809104359963...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565809121499925...
Removing gs://yangyou-mnist/log/checkpoint#1565809183854427...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565809180584502...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565809104.v3-8-tpu#1565809187005524...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565809117146560...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565809181730277...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565809109269904...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565809116335296...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565809186045793...
Removing gs://yangyou-mnist/log/eval/#1565809300131352...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565809300.v3-8-tpu#1565809303522342...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:01:47.661125 140322833552832 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:01:47.661915 140322833552832 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:01:47.664516 140322833552832 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:01:47.665338 140322833552832 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:01:47.665921 140322833552832 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:01:47.666055 140322833552832 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:01:48.071593 140322833552832 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:01:48.078135 140322833552832 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:01:48.082231 140322833552832 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:01:48.199851 140322833552832 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:01:48.200138 140322833552832 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:01:48.412924 140322833552832 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:01:48.454121 140322833552832 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:01:48.454411 140322833552832 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:01:48.696989 140322833552832 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f9f4ecf2290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f9f50ed1210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:01:48.697340 140322833552832 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:01:49.042068 140322833552832 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:01:49.045054: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:01:49.059032 140322833552832 tpu_system_metadata.py:148] Found TPU system:
I0814 19:01:49.059273 140322833552832 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:01:49.059792 140322833552832 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:01:49.059850 140322833552832 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:01:49.059909 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:01:49.060214 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:01:49.060272 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:01:49.060323 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:01:49.060372 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:01:49.060473 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:01:49.060617 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:01:49.060681 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:01:49.060729 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:01:49.060776 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:01:49.060842 140322833552832 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:01:49.066982 140322833552832 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:01:49.079840 140322833552832 estimator.py:1145] Calling model_fn.
W0814 19:01:49.080501 140322833552832 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:01:49.357088 140322833552832 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:01:49.871295 140322833552832 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:01:49.932015 140322833552832 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:01:49.937809 140322833552832 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:01:50.123451 140322833552832 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:01:50.137321 140322833552832 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:01:50.149327 140322833552832 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:01:50.150369 140322833552832 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:01:50.157155 140322833552832 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:01:50.162240 140322833552832 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:01:50.162446 140322833552832 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 19:01:50.174774 140322833552832 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:01:50.283354 140322833552832 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:01:50.324328 140322833552832 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:01:50.368583 140322833552832 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:01:50.419650 140322833552832 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:01:50.581374 140322833552832 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:01:50.631158 140322833552832 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:01:50.679210 140322833552832 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:01:50.728648 140322833552832 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:01:50.774302 140322833552832 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:01:50.815279 140322833552832 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:01:50.831017 140322833552832 estimator.py:1147] Done calling model_fn.
I0814 19:01:54.288456 140322833552832 tpu_estimator.py:499] TPU job name worker
I0814 19:01:54.396738 140322833552832 monitored_session.py:240] Graph was finalized.
I0814 19:01:55.064868 140322833552832 session_manager.py:500] Running local_init_op.
I0814 19:01:55.115184 140322833552832 session_manager.py:502] Done running local_init_op.
I0814 19:01:57.812555 140322833552832 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:02:10.081192 140322833552832 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:02:10.223231 140322833552832 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:02:10.223685 140322833552832 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:02:10.224154: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:02:10.229255 140322833552832 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:02:10.231461 140322833552832 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:02:10.235460 140322833552832 tpu_estimator.py:557] Init TPU system
I0814 19:02:52.116615 140322833552832 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 19:02:52.117481 140321933481728 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:02:52.118046 140321925089024 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:02:52.172243 140321916696320 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:02:52.181015 140322833552832 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:02:52.182063 140322833552832 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 19:02:52.366801 140321916696320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:02:56.988097 140321925089024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:03:01.521034 140322833552832 basic_session_run_hooks.py:262] loss = 0.25009087, step = 30
I0814 19:03:01.523034 140322833552832 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:03:15.132627 140322833552832 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:03:15.132937 140322833552832 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:03:15.133220 140321933481728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:03:15.133375 140321933481728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:03:15.133544 140322833552832 error_handling.py:96] infeed marked as finished
I0814 19:03:15.133683 140322833552832 tpu_estimator.py:602] Stop output thread controller
I0814 19:03:15.133748 140322833552832 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:03:15.133872 140321925089024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:03:15.133945 140321925089024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:03:15.134056 140322833552832 error_handling.py:96] outfeed marked as finished
I0814 19:03:15.134143 140322833552832 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:03:22.507494 140322833552832 estimator.py:368] Loss for final step: 0.25009087.
I0814 19:03:22.508335 140322833552832 error_handling.py:96] training_loop marked as finished
I0814 19:03:23.336950 140322833552832 estimator.py:1145] Calling model_fn.
E0814 19:03:24.074927 140322833552832 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:03:24.315617 140322833552832 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:03:24.337920 140322833552832 estimator.py:1147] Done calling model_fn.
I0814 19:03:24.357158 140322833552832 evaluation.py:255] Starting evaluation at 2019-08-14T19:03:24Z
I0814 19:03:24.357393 140322833552832 tpu_estimator.py:499] TPU job name worker
I0814 19:03:24.435888 140322833552832 monitored_session.py:240] Graph was finalized.
W0814 19:03:24.436681 140322833552832 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:03:24.623155 140322833552832 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:03:27.170295 140322833552832 session_manager.py:500] Running local_init_op.
I0814 19:03:27.200684 140322833552832 session_manager.py:502] Done running local_init_op.
I0814 19:03:27.251645 140322833552832 tpu_estimator.py:557] Init TPU system
I0814 19:04:36.028990 140322833552832 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:04:36.029880 140321933481728 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:04:36.030358 140321925089024 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:04:36.096554 140322833552832 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:04:36.125392 140322833552832 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:04:36.125804 140322833552832 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:04:36.156080 140321916696320 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:04:36.427571 140321916696320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:04:36.926611 140321925089024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:04:37.243016 140322833552832 evaluation.py:167] Evaluation [10/10]
I0814 19:04:37.243367 140322833552832 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:04:37.243443 140322833552832 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:04:37.243710 140321933481728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:04:37.243876 140321933481728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:04:37.244018 140322833552832 error_handling.py:96] infeed marked as finished
I0814 19:04:37.244136 140322833552832 tpu_estimator.py:602] Stop output thread controller
I0814 19:04:37.244195 140322833552832 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:04:37.244332 140321925089024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:04:37.244445 140321925089024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:04:37.244590 140322833552832 error_handling.py:96] outfeed marked as finished
I0814 19:04:37.244672 140322833552832 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:05:06.523924 140322833552832 evaluation.py:275] Finished evaluation at 2019-08-14-19:05:06
I0814 19:05:06.524240 140322833552832 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9369, global_step = 30, loss = 0.23220387
I0814 19:05:11.763340 140322833552832 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:05:12.558486 140322833552832 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.23220387, 'global_step': 30, 'accuracy': 0.9369}

Removing gs://yangyou-mnist/log/events.out.tfevents.1565809312.v3-8-tpu#1565809394817246...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565809325100845...
Removing gs://yangyou-mnist/log/checkpoint#1565809391620183...
Removing gs://yangyou-mnist/log/#1565809312350729...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565809317279529...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565809324283784...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565809329621987...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565809388487383...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565809389454039...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565809393846532...
Removing gs://yangyou-mnist/log/eval/#1565809508213787...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565809508.v3-8-tpu#1565809512250891...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:05:16.369822 140047676937664 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:05:16.370673 140047676937664 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:05:16.373379 140047676937664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:05:16.374231 140047676937664 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:05:16.374854 140047676937664 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:05:16.374989 140047676937664 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:05:16.810369 140047676937664 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:05:16.817900 140047676937664 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:05:16.822815 140047676937664 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:05:16.879924 140047676937664 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:05:16.880193 140047676937664 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:05:17.048547 140047676937664 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:05:17.165450 140047676937664 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:05:17.165740 140047676937664 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:05:17.335545 140047676937664 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5f3e326150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5f40505210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:05:17.335894 140047676937664 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:05:17.702419 140047676937664 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:05:17.705527: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:05:17.718739 140047676937664 tpu_system_metadata.py:148] Found TPU system:
I0814 19:05:17.718981 140047676937664 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:05:17.719463 140047676937664 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:05:17.719521 140047676937664 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:05:17.719587 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:05:17.719877 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:05:17.719947 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:05:17.719999 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:05:17.720051 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:05:17.720101 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:05:17.720146 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:05:17.720194 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:05:17.720241 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:05:17.720288 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:05:17.720345 140047676937664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:05:17.726963 140047676937664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:05:17.739836 140047676937664 estimator.py:1145] Calling model_fn.
W0814 19:05:17.740482 140047676937664 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:05:18.006392 140047676937664 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:05:18.419686 140047676937664 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:05:18.482090 140047676937664 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:05:18.488224 140047676937664 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:05:18.671351 140047676937664 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:05:18.685271 140047676937664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:05:18.697668 140047676937664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:05:18.698744 140047676937664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:05:18.705823 140047676937664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:05:18.711081 140047676937664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:05:18.711297 140047676937664 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 19:05:18.723869 140047676937664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:05:18.834763 140047676937664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:05:18.875842 140047676937664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:05:18.920335 140047676937664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:05:18.971744 140047676937664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:05:19.142479 140047676937664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:05:19.193082 140047676937664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:05:19.242089 140047676937664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:05:19.293081 140047676937664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:05:19.339015 140047676937664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:05:19.380635 140047676937664 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:05:19.396761 140047676937664 estimator.py:1147] Done calling model_fn.
I0814 19:05:23.053543 140047676937664 tpu_estimator.py:499] TPU job name worker
I0814 19:05:23.166533 140047676937664 monitored_session.py:240] Graph was finalized.
I0814 19:05:23.817431 140047676937664 session_manager.py:500] Running local_init_op.
I0814 19:05:23.880286 140047676937664 session_manager.py:502] Done running local_init_op.
I0814 19:05:26.586268 140047676937664 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:05:38.693310 140047676937664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:05:38.863056 140047676937664 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:05:38.863512 140047676937664 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:05:38.863928: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:05:38.868634 140047676937664 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:05:38.870785 140047676937664 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:05:38.876533 140047676937664 tpu_estimator.py:557] Init TPU system
I0814 19:06:20.138183 140047676937664 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 19:06:20.139091 140046780585728 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:06:20.139676 140046772193024 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:06:20.218406 140047676937664 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:06:20.219254 140047676937664 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 19:06:20.282705 140046763800320 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:06:20.453579 140046763800320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:06:24.983767 140046772193024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:06:29.672306 140047676937664 basic_session_run_hooks.py:262] loss = 0.1474835, step = 30
I0814 19:06:29.675261 140047676937664 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:06:50.598340 140046763800320 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:06:50.868397 140046763800320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:06:54.373313 140047676937664 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:06:54.373599 140047676937664 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:06:54.373847 140046780585728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:06:54.373961 140046780585728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:06:54.374099 140047676937664 error_handling.py:96] infeed marked as finished
I0814 19:06:54.374202 140047676937664 tpu_estimator.py:602] Stop output thread controller
I0814 19:06:54.374262 140047676937664 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:06:54.374385 140046772193024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:06:54.374458 140046772193024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:06:54.374572 140047676937664 error_handling.py:96] outfeed marked as finished
I0814 19:06:54.374660 140047676937664 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:07:21.011270 140047676937664 estimator.py:368] Loss for final step: 0.1474835.
I0814 19:07:21.012034 140047676937664 error_handling.py:96] training_loop marked as finished
I0814 19:07:21.725383 140047676937664 estimator.py:1145] Calling model_fn.
E0814 19:07:22.508523 140047676937664 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:07:22.751620 140047676937664 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:07:22.786760 140047676937664 estimator.py:1147] Done calling model_fn.
I0814 19:07:22.805850 140047676937664 evaluation.py:255] Starting evaluation at 2019-08-14T19:07:22Z
I0814 19:07:22.806107 140047676937664 tpu_estimator.py:499] TPU job name worker
I0814 19:07:22.887758 140047676937664 monitored_session.py:240] Graph was finalized.
W0814 19:07:22.888561 140047676937664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:07:23.077513 140047676937664 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:07:25.765455 140047676937664 session_manager.py:500] Running local_init_op.
I0814 19:07:25.790312 140047676937664 session_manager.py:502] Done running local_init_op.
I0814 19:07:25.848848 140047676937664 tpu_estimator.py:557] Init TPU system
I0814 19:08:04.058749 140047676937664 tpu_estimator.py:566] Initialized TPU in 38 seconds
I0814 19:08:04.059737 140046777177856 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:08:04.060333 140046768785152 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:08:04.129559 140047676937664 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:08:04.155901 140047676937664 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:08:04.156270 140047676937664 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:08:04.191351 140046754883328 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:08:04.324748 140046754883328 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 19:08:04.965559 140046768785152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:08:05.317907 140047676937664 evaluation.py:167] Evaluation [10/10]
I0814 19:08:05.318229 140047676937664 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:08:05.318303 140047676937664 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:08:05.318502 140046777177856 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:08:05.318607 140046777177856 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:08:05.318798 140047676937664 error_handling.py:96] infeed marked as finished
I0814 19:08:05.318907 140047676937664 tpu_estimator.py:602] Stop output thread controller
I0814 19:08:05.318957 140047676937664 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:08:05.319076 140046768785152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:08:05.319214 140046768785152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:08:05.319356 140047676937664 error_handling.py:96] outfeed marked as finished
I0814 19:08:05.319441 140047676937664 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:08:34.417515 140047676937664 evaluation.py:275] Finished evaluation at 2019-08-14-19:08:34
I0814 19:08:34.417885 140047676937664 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9603, global_step = 30, loss = 0.12914568
I0814 19:08:38.874356 140047676937664 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:08:39.663671 140047676937664 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12914568, 'global_step': 30, 'accuracy': 0.9603}

Removing gs://yangyou-mnist/log/#1565809521064310...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565809533714531...
Removing gs://yangyou-mnist/log/checkpoint#1565809610875681...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565809608090993...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565809526010918...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565809521.v3-8-tpu#1565809614067147...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565809538184601...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565809608981703...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565809532846243...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565809613123903...
Removing gs://yangyou-mnist/log/eval/#1565809716031677...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565809716.v3-8-tpu#1565809719362625...
/ [1/14 objects]   7% Done                                                      / [2/14 objects]  14% Done                                                      Removing gs://yangyou-mnist/log/model.ckpt-30_temp_8357b4ca19b1424d825c012bd45f392b/#1565809590320260...
Removing gs://yangyou-mnist/log/model.ckpt-30_temp_8357b4ca19b1424d825c012bd45f392b/part-00000-of-00001.data-00000-of-00001.tempstate3427600264025422271#1565809606132515...
/ [3/14 objects]  21% Done                                                      / [4/14 objects]  28% Done                                                      / [5/14 objects]  35% Done                                                      / [6/14 objects]  42% Done                                                      / [7/14 objects]  50% Done                                                      / [8/14 objects]  57% Done                                                      / [9/14 objects]  64% Done                                                      / [10/14 objects]  71% Done                                                     / [11/14 objects]  78% Done                                                     / [12/14 objects]  85% Done                                                     / [13/14 objects]  92% Done                                                     / [14/14 objects] 100% Done                                                     
Operation completed over 14 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:08:43.485918 139672943560128 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:08:43.486720 139672943560128 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:08:43.489396 139672943560128 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:08:43.490241 139672943560128 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:08:43.490847 139672943560128 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:08:43.490978 139672943560128 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:08:43.909707 139672943560128 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:08:43.916433 139672943560128 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:08:43.919972 139672943560128 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:08:44.039208 139672943560128 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:08:44.039485 139672943560128 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:08:44.173228 139672943560128 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:08:44.292016 139672943560128 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:08:44.292313 139672943560128 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:08:44.442111 139672943560128 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f07fe58d110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f080076c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:08:44.442488 139672943560128 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:08:44.779779 139672943560128 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:08:44.782953: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:08:44.794790 139672943560128 tpu_system_metadata.py:148] Found TPU system:
I0814 19:08:44.795077 139672943560128 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:08:44.795577 139672943560128 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:08:44.795667 139672943560128 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:08:44.795725 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:08:44.796070 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:08:44.796133 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:08:44.796194 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:08:44.796242 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:08:44.796293 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:08:44.796386 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:08:44.796504 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:08:44.796555 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:08:44.796607 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:08:44.796655 139672943560128 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:08:44.802891 139672943560128 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:08:44.816077 139672943560128 estimator.py:1145] Calling model_fn.
W0814 19:08:44.816754 139672943560128 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:08:45.087367 139672943560128 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:08:45.799734 139672943560128 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:08:45.864113 139672943560128 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:08:45.870487 139672943560128 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:08:46.060503 139672943560128 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:08:46.074517 139672943560128 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:08:46.087025 139672943560128 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:08:46.088160 139672943560128 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:08:46.095426 139672943560128 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:08:46.100828 139672943560128 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:08:46.101051 139672943560128 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 19:08:46.113723 139672943560128 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:08:46.225977 139672943560128 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:08:46.269555 139672943560128 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:08:46.314870 139672943560128 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:08:46.366756 139672943560128 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:08:46.528912 139672943560128 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:08:46.581042 139672943560128 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:08:46.630651 139672943560128 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:08:46.682332 139672943560128 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:08:46.729281 139672943560128 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:08:46.771485 139672943560128 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:08:46.788091 139672943560128 estimator.py:1147] Done calling model_fn.
I0814 19:08:50.209008 139672943560128 tpu_estimator.py:499] TPU job name worker
I0814 19:08:50.323668 139672943560128 monitored_session.py:240] Graph was finalized.
I0814 19:08:51.000452 139672943560128 session_manager.py:500] Running local_init_op.
I0814 19:08:51.061599 139672943560128 session_manager.py:502] Done running local_init_op.
I0814 19:08:53.768919 139672943560128 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:09:06.344294 139672943560128 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:09:06.491333 139672943560128 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:09:06.491844 139672943560128 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:09:06.492268: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:09:06.497126 139672943560128 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:09:06.499265 139672943560128 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:09:06.502912 139672943560128 tpu_estimator.py:557] Init TPU system
I0814 19:09:48.125832 139672943560128 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 19:09:48.126971 139672047310592 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:09:48.127696 139672038917888 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:09:48.179716 139672030525184 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:09:48.189438 139672943560128 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:09:48.190308 139672943560128 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 19:09:48.395558 139672030525184 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:09:52.977580 139672038917888 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:09:57.842794 139672943560128 basic_session_run_hooks.py:262] loss = 0.091226645, step = 30
I0814 19:09:57.845161 139672943560128 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:10:11.844316 139672943560128 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:10:11.844727 139672943560128 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:10:11.846896 139672047310592 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:10:11.847157 139672047310592 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:10:11.847371 139672943560128 error_handling.py:96] infeed marked as finished
I0814 19:10:11.847564 139672943560128 tpu_estimator.py:602] Stop output thread controller
I0814 19:10:11.847635 139672943560128 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:10:11.847798 139672038917888 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:10:11.847881 139672038917888 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:10:11.848048 139672943560128 error_handling.py:96] outfeed marked as finished
I0814 19:10:11.848140 139672943560128 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:10:18.525187 139672943560128 estimator.py:368] Loss for final step: 0.091226645.
I0814 19:10:18.525995 139672943560128 error_handling.py:96] training_loop marked as finished
I0814 19:10:19.328679 139672943560128 estimator.py:1145] Calling model_fn.
E0814 19:10:20.021286 139672943560128 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:10:20.253966 139672943560128 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:10:20.275855 139672943560128 estimator.py:1147] Done calling model_fn.
I0814 19:10:20.293147 139672943560128 evaluation.py:255] Starting evaluation at 2019-08-14T19:10:20Z
I0814 19:10:20.293390 139672943560128 tpu_estimator.py:499] TPU job name worker
I0814 19:10:20.371391 139672943560128 monitored_session.py:240] Graph was finalized.
W0814 19:10:20.372199 139672943560128 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:10:20.584620 139672943560128 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:10:23.123898 139672943560128 session_manager.py:500] Running local_init_op.
I0814 19:10:23.153326 139672943560128 session_manager.py:502] Done running local_init_op.
I0814 19:10:23.203233 139672943560128 tpu_estimator.py:557] Init TPU system
I0814 19:11:32.064181 139672943560128 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:11:32.065049 139672043640576 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:11:32.065546 139672035247872 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:11:32.132560 139672943560128 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:11:32.182202 139672943560128 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:11:32.182518 139672943560128 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:11:32.228538 139672021870336 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:11:32.362979 139672021870336 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:11:32.974246 139672035247872 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:11:33.402424 139672943560128 evaluation.py:167] Evaluation [10/10]
I0814 19:11:33.402765 139672943560128 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:11:33.402841 139672943560128 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:11:33.403064 139672043640576 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:11:33.403239 139672043640576 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:11:33.403409 139672943560128 error_handling.py:96] infeed marked as finished
I0814 19:11:33.403512 139672943560128 tpu_estimator.py:602] Stop output thread controller
I0814 19:11:33.403579 139672943560128 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:11:33.404212 139672035247872 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:11:33.404393 139672035247872 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:11:33.404711 139672943560128 error_handling.py:96] outfeed marked as finished
I0814 19:11:33.404949 139672943560128 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:12:02.460750 139672943560128 evaluation.py:275] Finished evaluation at 2019-08-14-19:12:02
I0814 19:12:02.461107 139672943560128 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9761, global_step = 30, loss = 0.07417773
I0814 19:12:06.808159 139672943560128 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:12:07.695596 139672943560128 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07417773, 'global_step': 30, 'accuracy': 0.9761}

Removing gs://yangyou-mnist/log/#1565809728238484...
Removing gs://yangyou-mnist/log/checkpoint#1565809808117476...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565809745835762...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565809741170204...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565809805028828...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565809728.v3-8-tpu#1565809811534545...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565809733194776...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565809805910625...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565809740291106...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565809810366863...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565809924.v3-8-tpu#1565809927388149...
Removing gs://yangyou-mnist/log/eval/#1565809924089283...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:12:11.738229 140555073586624 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:12:11.739044 140555073586624 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:12:11.741889 140555073586624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:12:11.742749 140555073586624 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:12:11.743370 140555073586624 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:12:11.743504 140555073586624 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:12:12.171314 140555073586624 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:12:12.179568 140555073586624 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:12:12.184004 140555073586624 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:12:12.229268 140555073586624 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:12:12.229587 140555073586624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:12:12.377129 140555073586624 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:12:12.427958 140555073586624 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:12:12.428280 140555073586624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:12:12.607436 140555073586624 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd56164d190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd56382c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:12:12.607811 140555073586624 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:12:12.924067 140555073586624 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:12:12.929821: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:12:12.942869 140555073586624 tpu_system_metadata.py:148] Found TPU system:
I0814 19:12:12.943203 140555073586624 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:12:12.943892 140555073586624 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:12:12.943953 140555073586624 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:12:12.944013 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:12:12.944313 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:12:12.944376 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:12:12.944457 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:12:12.944515 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:12:12.944585 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:12:12.944633 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:12:12.944680 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:12:12.944727 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:12:12.944780 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:12:12.944828 140555073586624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:12:12.951246 140555073586624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:12:12.964044 140555073586624 estimator.py:1145] Calling model_fn.
W0814 19:12:12.964751 140555073586624 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:12:13.230127 140555073586624 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:12:14.572508 140555073586624 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:12:14.635060 140555073586624 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:12:14.641019 140555073586624 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:12:14.823267 140555073586624 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:12:14.837157 140555073586624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:12:14.849550 140555073586624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:12:14.850651 140555073586624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:12:14.857661 140555073586624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:12:14.862946 140555073586624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:12:14.863166 140555073586624 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 19:12:14.876097 140555073586624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:12:14.986903 140555073586624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:12:15.028959 140555073586624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:12:15.074662 140555073586624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:12:15.132096 140555073586624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:12:15.310543 140555073586624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:12:15.362056 140555073586624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:12:15.411585 140555073586624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:12:15.462507 140555073586624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:12:15.508138 140555073586624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:12:15.550406 140555073586624 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:12:15.566740 140555073586624 estimator.py:1147] Done calling model_fn.
I0814 19:12:19.134329 140555073586624 tpu_estimator.py:499] TPU job name worker
I0814 19:12:19.248217 140555073586624 monitored_session.py:240] Graph was finalized.
I0814 19:12:19.945827 140555073586624 session_manager.py:500] Running local_init_op.
I0814 19:12:20.005187 140555073586624 session_manager.py:502] Done running local_init_op.
I0814 19:12:22.895473 140555073586624 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:12:35.248197 140555073586624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:12:35.402767 140555073586624 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:12:35.403280 140555073586624 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:12:35.403701: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:12:35.409099 140555073586624 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:12:35.411482 140555073586624 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:12:35.415957 140555073586624 tpu_estimator.py:557] Init TPU system
I0814 19:13:16.136161 140555073586624 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 19:13:16.137150 140554319939328 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:13:16.137640 140554311546624 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:13:16.191553 140554303153920 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:13:16.200686 140555073586624 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:13:16.201709 140555073586624 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 19:13:16.356673 140554303153920 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:13:20.917052 140554311546624 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:13:25.669948 140555073586624 basic_session_run_hooks.py:262] loss = 0.07959153, step = 30
I0814 19:13:25.673002 140555073586624 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:13:42.060786 140555073586624 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:13:42.061075 140555073586624 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:13:42.061382 140554319939328 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:13:42.061675 140554319939328 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:13:42.061901 140555073586624 error_handling.py:96] infeed marked as finished
I0814 19:13:42.062138 140555073586624 tpu_estimator.py:602] Stop output thread controller
I0814 19:13:42.062211 140555073586624 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:13:42.062422 140554311546624 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:13:42.062609 140554311546624 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:13:42.062839 140555073586624 error_handling.py:96] outfeed marked as finished
I0814 19:13:42.063075 140555073586624 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:13:46.482567 140555073586624 estimator.py:368] Loss for final step: 0.07959153.
I0814 19:13:46.483500 140555073586624 error_handling.py:96] training_loop marked as finished
I0814 19:13:47.288995 140555073586624 estimator.py:1145] Calling model_fn.
E0814 19:13:47.993334 140555073586624 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:13:48.226265 140555073586624 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:13:48.248718 140555073586624 estimator.py:1147] Done calling model_fn.
I0814 19:13:48.265590 140555073586624 evaluation.py:255] Starting evaluation at 2019-08-14T19:13:48Z
I0814 19:13:48.265845 140555073586624 tpu_estimator.py:499] TPU job name worker
I0814 19:13:48.344676 140555073586624 monitored_session.py:240] Graph was finalized.
W0814 19:13:48.345458 140555073586624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:13:48.534902 140555073586624 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:13:51.187810 140555073586624 session_manager.py:500] Running local_init_op.
I0814 19:13:51.217809 140555073586624 session_manager.py:502] Done running local_init_op.
I0814 19:13:51.271969 140555073586624 tpu_estimator.py:557] Init TPU system
I0814 19:15:00.041704 140555073586624 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:15:00.042897 140554316269312 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:15:00.043960 140554307876608 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:15:00.111932 140555073586624 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:15:00.139070 140555073586624 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:15:00.140207 140555073586624 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:15:00.252645 140554294499072 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:15:00.425108 140554294499072 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:15:00.945962 140554307876608 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:15:01.198621 140555073586624 evaluation.py:167] Evaluation [10/10]
I0814 19:15:01.199008 140555073586624 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:15:01.199099 140555073586624 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:15:01.199403 140554316269312 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:15:01.199690 140554316269312 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:15:01.199940 140555073586624 error_handling.py:96] infeed marked as finished
I0814 19:15:01.200098 140555073586624 tpu_estimator.py:602] Stop output thread controller
I0814 19:15:01.200153 140555073586624 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:15:01.200304 140554307876608 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:15:01.200520 140554307876608 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:15:01.200784 140555073586624 error_handling.py:96] outfeed marked as finished
I0814 19:15:01.200925 140555073586624 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:15:30.523108 140555073586624 evaluation.py:275] Finished evaluation at 2019-08-14-19:15:30
I0814 19:15:30.523454 140555073586624 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9793, global_step = 30, loss = 0.066491954
I0814 19:15:35.620018 140555073586624 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:15:36.438610 140555073586624 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.066491954, 'global_step': 30, 'accuracy': 0.9793}

Removing gs://yangyou-mnist/log/checkpoint#1565810018554640...
Removing gs://yangyou-mnist/log/#1565809937200715...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565809937.v3-8-tpu#1565810021755284...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565809954732106...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565809949989317...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565810012472505...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565809942300099...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565810013396565...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565809949081088...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565810020749617...
Removing gs://yangyou-mnist/log/eval/#1565810132958191...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565810133.v3-8-tpu#1565810136138264...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:15:40.318640 139840440866240 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:15:40.319431 139840440866240 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:15:40.322468 139840440866240 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:15:40.323323 139840440866240 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:15:40.323900 139840440866240 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:15:40.324029 139840440866240 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:15:40.738734 139840440866240 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:15:40.745527 139840440866240 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:15:40.749263 139840440866240 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:15:40.801135 139840440866240 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:15:40.801419 139840440866240 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:15:41.071376 139840440866240 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:15:41.125988 139840440866240 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:15:41.126290 139840440866240 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:15:41.334497 139840440866240 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2efdf6e190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2f0014d1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:15:41.334862 139840440866240 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:15:41.657196 139840440866240 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:15:41.660167: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:15:41.673135 139840440866240 tpu_system_metadata.py:148] Found TPU system:
I0814 19:15:41.673388 139840440866240 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:15:41.673888 139840440866240 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:15:41.673949 139840440866240 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:15:41.674001 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:15:41.674314 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:15:41.674372 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:15:41.674423 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:15:41.674485 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:15:41.674535 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:15:41.674586 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:15:41.674633 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:15:41.674680 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:15:41.674727 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:15:41.674774 139840440866240 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:15:41.681118 139840440866240 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:15:41.694453 139840440866240 estimator.py:1145] Calling model_fn.
W0814 19:15:41.695100 139840440866240 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:15:41.975194 139840440866240 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:15:42.643872 139840440866240 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:15:42.709162 139840440866240 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:15:42.715303 139840440866240 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:15:42.899895 139840440866240 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:15:42.914297 139840440866240 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:15:42.926909 139840440866240 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:15:42.928170 139840440866240 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:15:42.935878 139840440866240 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:15:42.941473 139840440866240 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:15:42.941708 139840440866240 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 19:15:42.954719 139840440866240 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:15:43.069813 139840440866240 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:15:43.113086 139840440866240 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:15:43.158536 139840440866240 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:15:43.212114 139840440866240 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:15:43.378983 139840440866240 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:15:43.431094 139840440866240 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:15:43.480874 139840440866240 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:15:43.532989 139840440866240 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:15:43.580610 139840440866240 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:15:43.623282 139840440866240 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:15:43.640135 139840440866240 estimator.py:1147] Done calling model_fn.
I0814 19:15:47.001873 139840440866240 tpu_estimator.py:499] TPU job name worker
I0814 19:15:47.117646 139840440866240 monitored_session.py:240] Graph was finalized.
I0814 19:15:47.790687 139840440866240 session_manager.py:500] Running local_init_op.
I0814 19:15:47.842266 139840440866240 session_manager.py:502] Done running local_init_op.
I0814 19:15:50.687927 139840440866240 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:16:02.529813 139840440866240 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:16:02.689181 139840440866240 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:16:02.689603 139840440866240 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:16:02.690115: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:16:02.695090 139840440866240 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:16:02.697700 139840440866240 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:16:02.701752 139840440866240 tpu_estimator.py:557] Init TPU system
I0814 19:16:44.111552 139840440866240 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 19:16:44.112710 139839536350976 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:16:44.113687 139839527958272 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:16:44.182375 139840440866240 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:16:44.183273 139840440866240 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 19:16:44.228697 139839519565568 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:16:44.394624 139839519565568 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 19:16:48.892555 139839527958272 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:16:53.753673 139840440866240 basic_session_run_hooks.py:262] loss = 0.062552415, step = 30
I0814 19:16:53.756331 139840440866240 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:17:07.182653 139840440866240 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:17:07.182992 139840440866240 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:17:07.184530 139839536350976 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:17:07.184814 139839536350976 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:17:07.185108 139840440866240 error_handling.py:96] infeed marked as finished
I0814 19:17:07.185355 139840440866240 tpu_estimator.py:602] Stop output thread controller
I0814 19:17:07.185432 139840440866240 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:17:07.185610 139839527958272 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:17:07.185772 139839527958272 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:17:07.185955 139840440866240 error_handling.py:96] outfeed marked as finished
I0814 19:17:07.186125 139840440866240 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:17:14.534905 139840440866240 estimator.py:368] Loss for final step: 0.062552415.
I0814 19:17:14.535708 139840440866240 error_handling.py:96] training_loop marked as finished
I0814 19:17:15.407044 139840440866240 estimator.py:1145] Calling model_fn.
E0814 19:17:16.098680 139840440866240 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:17:16.326421 139840440866240 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:17:16.348684 139840440866240 estimator.py:1147] Done calling model_fn.
I0814 19:17:16.366328 139840440866240 evaluation.py:255] Starting evaluation at 2019-08-14T19:17:16Z
I0814 19:17:16.366579 139840440866240 tpu_estimator.py:499] TPU job name worker
I0814 19:17:16.446049 139840440866240 monitored_session.py:240] Graph was finalized.
W0814 19:17:16.446885 139840440866240 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:17:16.636112 139840440866240 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:17:19.284811 139840440866240 session_manager.py:500] Running local_init_op.
I0814 19:17:19.317748 139840440866240 session_manager.py:502] Done running local_init_op.
I0814 19:17:19.372195 139840440866240 tpu_estimator.py:557] Init TPU system
I0814 19:18:28.022664 139840440866240 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:18:28.023829 139839536350976 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:18:28.024596 139839527958272 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:18:28.092838 139840440866240 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:18:28.117496 139840440866240 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:18:28.117912 139840440866240 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:18:28.158710 139839519565568 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:18:28.334952 139839519565568 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:18:28.917079 139839527958272 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:18:29.183110 139840440866240 evaluation.py:167] Evaluation [10/10]
I0814 19:18:29.183470 139840440866240 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:18:29.183542 139840440866240 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:18:29.183783 139839536350976 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:18:29.184065 139839536350976 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:18:29.184298 139840440866240 error_handling.py:96] infeed marked as finished
I0814 19:18:29.184535 139840440866240 tpu_estimator.py:602] Stop output thread controller
I0814 19:18:29.184676 139840440866240 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:18:29.184850 139839527958272 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:18:29.185034 139839527958272 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:18:29.185205 139840440866240 error_handling.py:96] outfeed marked as finished
I0814 19:18:29.185340 139840440866240 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:18:58.434828 139840440866240 evaluation.py:275] Finished evaluation at 2019-08-14-19:18:58
I0814 19:18:58.435183 139840440866240 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9855, global_step = 30, loss = 0.04742385
I0814 19:19:02.839212 139840440866240 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:19:03.703524 139840440866240 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.04742385, 'global_step': 30, 'accuracy': 0.9855}

Removing gs://yangyou-mnist/log/#1565810145153040...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565810145.v3-8-tpu#1565810226871568...
Removing gs://yangyou-mnist/log/checkpoint#1565810223684511...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565810157761144...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565810161996289...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565810150113434...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565810156885291...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565810221545615...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565810220687791...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565810225937934...
Removing gs://yangyou-mnist/log/eval/#1565810340158286...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565810340.v3-8-tpu#1565810343401003...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:19:07.641532 140011751953856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:19:07.642328 140011751953856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:19:07.644994 140011751953856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:19:07.645838 140011751953856 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:19:07.646416 140011751953856 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:19:07.646555 140011751953856 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:19:08.071986 140011751953856 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:19:08.079719 140011751953856 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:19:08.083861 140011751953856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:19:08.139664 140011751953856 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:19:08.139981 140011751953856 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:19:08.321458 140011751953856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:19:08.395524 140011751953856 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:19:08.395800 140011751953856 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:19:08.675466 140011751953856 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f56e0e6a250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f56e30491d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:19:08.675857 140011751953856 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:19:09.001669 140011751953856 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:19:09.004806: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:19:09.018148 140011751953856 tpu_system_metadata.py:148] Found TPU system:
I0814 19:19:09.018393 140011751953856 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:19:09.019025 140011751953856 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:19:09.019093 140011751953856 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:19:09.019146 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:19:09.019445 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:19:09.019501 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:19:09.019563 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:19:09.019614 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:19:09.019661 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:19:09.019707 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:19:09.019754 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:19:09.019799 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:19:09.019845 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:19:09.019892 140011751953856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:19:09.026221 140011751953856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:19:09.039211 140011751953856 estimator.py:1145] Calling model_fn.
W0814 19:19:09.039863 140011751953856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:19:09.300905 140011751953856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:19:09.938194 140011751953856 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:19:10.000814 140011751953856 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:19:10.006994 140011751953856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:19:10.189872 140011751953856 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:19:10.203943 140011751953856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:19:10.216228 140011751953856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:19:10.217355 140011751953856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:19:10.224659 140011751953856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:19:10.230122 140011751953856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:19:10.230365 140011751953856 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 19:19:10.242973 140011751953856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:19:10.355169 140011751953856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:19:10.397485 140011751953856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:19:10.442171 140011751953856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:19:10.493288 140011751953856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:19:10.661210 140011751953856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:19:10.710840 140011751953856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:19:10.758846 140011751953856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:19:10.808465 140011751953856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:19:10.854203 140011751953856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:19:10.898278 140011751953856 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:19:10.914861 140011751953856 estimator.py:1147] Done calling model_fn.
I0814 19:19:14.437284 140011751953856 tpu_estimator.py:499] TPU job name worker
I0814 19:19:14.545872 140011751953856 monitored_session.py:240] Graph was finalized.
I0814 19:19:15.202294 140011751953856 session_manager.py:500] Running local_init_op.
I0814 19:19:15.250498 140011751953856 session_manager.py:502] Done running local_init_op.
I0814 19:19:18.035010 140011751953856 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:19:30.524168 140011751953856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:19:30.665491 140011751953856 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:19:30.665977 140011751953856 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:19:30.666369: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:19:30.670607 140011751953856 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:19:30.672801 140011751953856 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:19:30.677020 140011751953856 tpu_estimator.py:557] Init TPU system
I0814 19:20:12.112770 140011751953856 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 19:20:12.113817 140010990053120 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:20:12.114676 140010981660416 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:20:12.176064 140010498029312 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:20:12.179609 140011751953856 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:20:12.180918 140011751953856 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 19:20:12.355863 140010498029312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:20:17.010345 140010981660416 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:20:21.660706 140011751953856 basic_session_run_hooks.py:262] loss = 1.4284577, step = 30
I0814 19:20:21.662892 140011751953856 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:20:35.447529 140011751953856 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:20:35.447855 140011751953856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:20:35.449702 140010990053120 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:20:35.449878 140010990053120 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:20:35.450133 140011751953856 error_handling.py:96] infeed marked as finished
I0814 19:20:35.450326 140011751953856 tpu_estimator.py:602] Stop output thread controller
I0814 19:20:35.450427 140011751953856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:20:35.450598 140010981660416 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:20:35.450683 140010981660416 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:20:35.450829 140011751953856 error_handling.py:96] outfeed marked as finished
I0814 19:20:35.450922 140011751953856 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:20:42.500591 140011751953856 estimator.py:368] Loss for final step: 1.4284577.
I0814 19:20:42.501471 140011751953856 error_handling.py:96] training_loop marked as finished
I0814 19:20:43.233628 140011751953856 estimator.py:1145] Calling model_fn.
E0814 19:20:43.927218 140011751953856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:20:44.156997 140011751953856 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:20:44.178306 140011751953856 estimator.py:1147] Done calling model_fn.
I0814 19:20:44.195669 140011751953856 evaluation.py:255] Starting evaluation at 2019-08-14T19:20:44Z
I0814 19:20:44.195909 140011751953856 tpu_estimator.py:499] TPU job name worker
I0814 19:20:44.275734 140011751953856 monitored_session.py:240] Graph was finalized.
W0814 19:20:44.276516 140011751953856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:20:44.479633 140011751953856 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:20:47.253249 140011751953856 session_manager.py:500] Running local_init_op.
I0814 19:20:47.283951 140011751953856 session_manager.py:502] Done running local_init_op.
I0814 19:20:47.341350 140011751953856 tpu_estimator.py:557] Init TPU system
I0814 19:21:56.048962 140011751953856 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:21:56.049818 140010986383104 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:21:56.050278 140010498029312 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:21:56.120222 140011751953856 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:21:56.147854 140011751953856 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:21:56.148220 140011751953856 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:21:56.237420 140010489636608 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:21:56.448954 140010489636608 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:21:56.955533 140010498029312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:21:57.250365 140011751953856 evaluation.py:167] Evaluation [10/10]
I0814 19:21:57.250823 140011751953856 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:21:57.250905 140011751953856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:21:57.251243 140010986383104 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:21:57.251563 140010986383104 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:21:57.251831 140011751953856 error_handling.py:96] infeed marked as finished
I0814 19:21:57.252024 140011751953856 tpu_estimator.py:602] Stop output thread controller
I0814 19:21:57.252104 140011751953856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:21:57.252270 140010498029312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:21:57.252598 140010498029312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:21:57.252862 140011751953856 error_handling.py:96] outfeed marked as finished
I0814 19:21:57.252995 140011751953856 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:22:26.548269 140011751953856 evaluation.py:275] Finished evaluation at 2019-08-14-19:22:26
I0814 19:22:26.548739 140011751953856 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7963, global_step = 30, loss = 0.7615142
I0814 19:22:31.163353 140011751953856 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:22:32.114803 140011751953856 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.7615142, 'global_step': 30, 'accuracy': 0.7963}

Removing gs://yangyou-mnist/log/#1565810352394290...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565810365659795...
Removing gs://yangyou-mnist/log/checkpoint#1565810431915031...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565810369995573...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565810352.v3-8-tpu#1565810435142381...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565810357452944...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565810364783195...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565810429547157...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565810428531135...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565810434235349...
Removing gs://yangyou-mnist/log/eval/#1565810548298064...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565810548.v3-8-tpu#1565810551691614...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:22:36.102122 140498267469248 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:22:36.102891 140498267469248 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:22:36.105520 140498267469248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:22:36.106321 140498267469248 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:22:36.106869 140498267469248 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:22:36.107028 140498267469248 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:22:36.520224 140498267469248 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:22:36.526899 140498267469248 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:22:36.530561 140498267469248 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:22:36.586447 140498267469248 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:22:36.586719 140498267469248 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:22:36.812750 140498267469248 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:22:36.864217 140498267469248 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:22:36.864528 140498267469248 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:22:37.038420 140498267469248 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc8277c40d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc8299a31d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:22:37.038774 140498267469248 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:22:37.364124 140498267469248 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:22:37.367236: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:22:37.378806 140498267469248 tpu_system_metadata.py:148] Found TPU system:
I0814 19:22:37.379056 140498267469248 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:22:37.379551 140498267469248 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:22:37.379610 140498267469248 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:22:37.379662 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:22:37.379947 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:22:37.380003 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:22:37.380079 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:22:37.380129 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:22:37.380177 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:22:37.380225 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:22:37.380274 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:22:37.380321 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:22:37.380368 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:22:37.380461 140498267469248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:22:37.386326 140498267469248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:22:37.398951 140498267469248 estimator.py:1145] Calling model_fn.
W0814 19:22:37.399576 140498267469248 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:22:37.679985 140498267469248 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:22:38.286237 140498267469248 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:22:38.346764 140498267469248 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:22:38.352468 140498267469248 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:22:38.528697 140498267469248 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:22:38.541901 140498267469248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:22:38.553724 140498267469248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:22:38.554768 140498267469248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:22:38.561680 140498267469248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:22:38.566798 140498267469248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:22:38.567009 140498267469248 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 19:22:38.579338 140498267469248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:22:38.687953 140498267469248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:22:38.729032 140498267469248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:22:38.774440 140498267469248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:22:38.824981 140498267469248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:22:38.984385 140498267469248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:22:39.034785 140498267469248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:22:39.082726 140498267469248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:22:39.132977 140498267469248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:22:39.178975 140498267469248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:22:39.219352 140498267469248 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:22:39.235557 140498267469248 estimator.py:1147] Done calling model_fn.
I0814 19:22:42.656078 140498267469248 tpu_estimator.py:499] TPU job name worker
I0814 19:22:42.764177 140498267469248 monitored_session.py:240] Graph was finalized.
I0814 19:22:43.441922 140498267469248 session_manager.py:500] Running local_init_op.
I0814 19:22:43.501965 140498267469248 session_manager.py:502] Done running local_init_op.
I0814 19:22:46.268388 140498267469248 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:22:58.534204 140498267469248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:22:58.680186 140498267469248 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:22:58.680666 140498267469248 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:22:58.681077: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:22:58.685863 140498267469248 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:22:58.687947 140498267469248 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:22:58.692722 140498267469248 tpu_estimator.py:557] Init TPU system
I0814 19:23:40.117192 140498267469248 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 19:23:40.118377 140497221834496 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:23:40.119318 140497213441792 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:23:40.182696 140497205049088 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:23:40.183568 140498267469248 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:23:40.185015 140498267469248 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 19:23:40.429564 140497205049088 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 19:23:45.013415 140497213441792 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:23:49.621776 140498267469248 basic_session_run_hooks.py:262] loss = 2.3072312, step = 30
I0814 19:23:49.624466 140498267469248 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:24:03.733933 140498267469248 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:24:03.734288 140498267469248 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:24:03.735658 140497221834496 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:24:03.735888 140497221834496 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:24:03.736052 140498267469248 error_handling.py:96] infeed marked as finished
I0814 19:24:03.736243 140498267469248 tpu_estimator.py:602] Stop output thread controller
I0814 19:24:03.736323 140498267469248 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:24:03.736488 140497213441792 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:24:03.736593 140497213441792 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:24:03.736813 140498267469248 error_handling.py:96] outfeed marked as finished
I0814 19:24:03.736917 140498267469248 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:24:10.570895 140498267469248 estimator.py:368] Loss for final step: 2.3072312.
I0814 19:24:10.571666 140498267469248 error_handling.py:96] training_loop marked as finished
I0814 19:24:11.356250 140498267469248 estimator.py:1145] Calling model_fn.
E0814 19:24:12.043497 140498267469248 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:24:12.274000 140498267469248 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:24:12.295159 140498267469248 estimator.py:1147] Done calling model_fn.
I0814 19:24:12.312073 140498267469248 evaluation.py:255] Starting evaluation at 2019-08-14T19:24:12Z
I0814 19:24:12.312299 140498267469248 tpu_estimator.py:499] TPU job name worker
I0814 19:24:12.391200 140498267469248 monitored_session.py:240] Graph was finalized.
W0814 19:24:12.391932 140498267469248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:24:12.582168 140498267469248 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:24:15.252516 140498267469248 session_manager.py:500] Running local_init_op.
I0814 19:24:15.276721 140498267469248 session_manager.py:502] Done running local_init_op.
I0814 19:24:15.334568 140498267469248 tpu_estimator.py:557] Init TPU system
I0814 19:25:24.069403 140498267469248 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:25:24.070419 140497221834496 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:25:24.071633 140497213441792 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:25:24.137959 140498267469248 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:25:24.162242 140498267469248 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:25:24.162617 140498267469248 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:25:24.203759 140497205049088 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:25:24.399246 140497205049088 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:25:24.938580 140497213441792 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:25:25.409718 140498267469248 evaluation.py:167] Evaluation [10/10]
I0814 19:25:25.410089 140498267469248 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:25:25.410170 140498267469248 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:25:25.410470 140497221834496 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:25:25.410830 140497221834496 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:25:25.411043 140498267469248 error_handling.py:96] infeed marked as finished
I0814 19:25:25.411222 140498267469248 tpu_estimator.py:602] Stop output thread controller
I0814 19:25:25.411281 140498267469248 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:25:25.411470 140497213441792 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:25:25.411653 140497213441792 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:25:25.411914 140498267469248 error_handling.py:96] outfeed marked as finished
I0814 19:25:25.412085 140498267469248 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:25:54.476551 140498267469248 evaluation.py:275] Finished evaluation at 2019-08-14-19:25:54
I0814 19:25:54.476906 140498267469248 estimator.py:2039] Saving dict for global step 30: accuracy = 0.098, global_step = 30, loss = 2.3109162
I0814 19:25:58.878107 140498267469248 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:25:59.646369 140498267469248 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3109162, 'global_step': 30, 'accuracy': 0.098}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565810573568554...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565810578026360...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565810636836402...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565810560.v3-8-tpu#1565810643428847...
Removing gs://yangyou-mnist/log/checkpoint#1565810640124022...
Removing gs://yangyou-mnist/log/#1565810560765913...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565810565699694...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565810637745213...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565810572680219...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565810642459057...
Removing gs://yangyou-mnist/log/eval/#1565810756209154...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565810756.v3-8-tpu#1565810759339292...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:26:03.561347 140031558784448 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:26:03.562140 140031558784448 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:26:03.564768 140031558784448 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:26:03.565584 140031558784448 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:26:03.566164 140031558784448 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:26:03.566291 140031558784448 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:26:03.983206 140031558784448 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:26:03.990420 140031558784448 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:26:03.994318 140031558784448 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:26:04.047843 140031558784448 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:26:04.048135 140031558784448 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:26:04.195127 140031558784448 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:26:04.236718 140031558784448 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:26:04.236990 140031558784448 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:26:04.427007 140031558784448 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5b7d7ae150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5b7f98d1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:26:04.427369 140031558784448 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:26:04.752835 140031558784448 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:26:04.755744: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:26:04.770318 140031558784448 tpu_system_metadata.py:148] Found TPU system:
I0814 19:26:04.770556 140031558784448 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:26:04.771059 140031558784448 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:26:04.771127 140031558784448 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:26:04.771182 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:26:04.771486 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:26:04.771543 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:26:04.771596 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:26:04.771646 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:26:04.771692 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:26:04.771739 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:26:04.771785 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:26:04.771830 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:26:04.771874 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:26:04.771922 140031558784448 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:26:04.778009 140031558784448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:26:04.790776 140031558784448 estimator.py:1145] Calling model_fn.
W0814 19:26:04.791409 140031558784448 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:26:05.082727 140031558784448 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:26:05.712477 140031558784448 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:26:05.775686 140031558784448 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:26:05.781704 140031558784448 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:26:05.965228 140031558784448 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:26:05.979497 140031558784448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:26:05.991485 140031558784448 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:26:05.992548 140031558784448 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:26:05.999506 140031558784448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:26:06.005018 140031558784448 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:26:06.005251 140031558784448 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 19:26:06.017967 140031558784448 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:26:06.130310 140031558784448 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:26:06.172341 140031558784448 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:26:06.218475 140031558784448 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:26:06.271480 140031558784448 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:26:06.438872 140031558784448 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:26:06.489012 140031558784448 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:26:06.539815 140031558784448 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:26:06.590542 140031558784448 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:26:06.636543 140031558784448 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:26:06.679743 140031558784448 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:26:06.696271 140031558784448 estimator.py:1147] Done calling model_fn.
I0814 19:26:10.250448 140031558784448 tpu_estimator.py:499] TPU job name worker
I0814 19:26:10.361536 140031558784448 monitored_session.py:240] Graph was finalized.
I0814 19:26:11.042674 140031558784448 session_manager.py:500] Running local_init_op.
I0814 19:26:11.093575 140031558784448 session_manager.py:502] Done running local_init_op.
I0814 19:26:13.892319 140031558784448 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:26:26.475596 140031558784448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:26:26.618916 140031558784448 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:26:26.619338 140031558784448 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:26:26.619747: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:26:26.624492 140031558784448 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:26:26.626657 140031558784448 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:26:26.631098 140031558784448 tpu_estimator.py:557] Init TPU system
I0814 19:27:08.025476 140031558784448 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 19:27:08.026421 140030662657792 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:27:08.026890 140030654265088 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:27:08.089317 140030645872384 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:27:08.090181 140031558784448 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:27:08.091420 140031558784448 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 19:27:08.281083 140030645872384 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:27:13.010715 140030654265088 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:27:17.506818 140031558784448 basic_session_run_hooks.py:262] loss = 43.170395, step = 30
I0814 19:27:17.509030 140031558784448 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:27:31.422705 140031558784448 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:27:31.423028 140031558784448 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:27:31.424607 140030662657792 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:27:31.424776 140030662657792 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:27:31.424912 140031558784448 error_handling.py:96] infeed marked as finished
I0814 19:27:31.425014 140031558784448 tpu_estimator.py:602] Stop output thread controller
I0814 19:27:31.425132 140031558784448 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:27:31.425318 140030654265088 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:27:31.425400 140030654265088 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:27:31.425529 140031558784448 error_handling.py:96] outfeed marked as finished
I0814 19:27:31.425630 140031558784448 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:27:38.422338 140031558784448 estimator.py:368] Loss for final step: 43.170395.
I0814 19:27:38.423191 140031558784448 error_handling.py:96] training_loop marked as finished
I0814 19:27:39.115719 140031558784448 estimator.py:1145] Calling model_fn.
E0814 19:27:39.812861 140031558784448 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:27:40.036575 140031558784448 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:27:40.060020 140031558784448 estimator.py:1147] Done calling model_fn.
I0814 19:27:40.076303 140031558784448 evaluation.py:255] Starting evaluation at 2019-08-14T19:27:40Z
I0814 19:27:40.076587 140031558784448 tpu_estimator.py:499] TPU job name worker
I0814 19:27:40.153898 140031558784448 monitored_session.py:240] Graph was finalized.
W0814 19:27:40.154709 140031558784448 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:27:40.353190 140031558784448 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:27:43.142290 140031558784448 session_manager.py:500] Running local_init_op.
I0814 19:27:43.167393 140031558784448 session_manager.py:502] Done running local_init_op.
I0814 19:27:43.224798 140031558784448 tpu_estimator.py:557] Init TPU system
I0814 19:28:52.044646 140031558784448 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:28:52.045695 140030658987776 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:28:52.046127 140030650595072 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:28:52.113737 140031558784448 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:28:52.138459 140031558784448 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:28:52.138839 140031558784448 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:28:52.179827 140030295144192 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:28:52.403515 140030295144192 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:28:52.905134 140030650595072 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:28:53.357506 140031558784448 evaluation.py:167] Evaluation [10/10]
I0814 19:28:53.357894 140031558784448 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:28:53.357988 140031558784448 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:28:53.358172 140030658987776 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:28:53.358273 140030658987776 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:28:53.358424 140031558784448 error_handling.py:96] infeed marked as finished
I0814 19:28:53.358526 140031558784448 tpu_estimator.py:602] Stop output thread controller
I0814 19:28:53.358577 140031558784448 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:28:53.358691 140030650595072 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:28:53.358767 140030650595072 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:28:53.358897 140031558784448 error_handling.py:96] outfeed marked as finished
I0814 19:28:53.358980 140031558784448 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:29:22.501034 140031558784448 evaluation.py:275] Finished evaluation at 2019-08-14-19:29:22
I0814 19:29:22.501413 140031558784448 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1135, global_step = 30, loss = 34.201645
I0814 19:29:26.954720 140031558784448 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:29:27.794734 140031558784448 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 34.201645, 'global_step': 30, 'accuracy': 0.1135}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565810781470685...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565810785962701...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565810844592345...
Removing gs://yangyou-mnist/log/#1565810768312024...
Removing gs://yangyou-mnist/log/checkpoint#1565810847740550...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565810768.v3-8-tpu#1565810851113606...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565810773311663...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565810845420884...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565810780535440...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565810850141449...
Removing gs://yangyou-mnist/log/eval/#1565810964169875...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565810964.v3-8-tpu#1565810967485079...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:29:31.669459 140517038265792 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:29:31.670243 140517038265792 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:29:31.672878 140517038265792 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:29:31.673712 140517038265792 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:29:31.674302 140517038265792 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:29:31.674427 140517038265792 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:29:32.098696 140517038265792 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:29:32.106184 140517038265792 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:29:32.110714 140517038265792 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:29:32.165244 140517038265792 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:29:32.165553 140517038265792 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:29:32.326061 140517038265792 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:29:32.381850 140517038265792 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:29:32.382154 140517038265792 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:29:32.558032 140517038265792 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcc864fe090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcc886dd1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:29:32.558382 140517038265792 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:29:32.890064 140517038265792 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:29:32.893221: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:29:32.906706 140517038265792 tpu_system_metadata.py:148] Found TPU system:
I0814 19:29:32.906946 140517038265792 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:29:32.907432 140517038265792 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:29:32.907495 140517038265792 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:29:32.907555 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:29:32.907968 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:29:32.908032 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:29:32.908083 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:29:32.908132 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:29:32.908188 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:29:32.908235 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:29:32.908282 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:29:32.908328 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:29:32.908374 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:29:32.908494 140517038265792 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:29:32.914649 140517038265792 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:29:32.927349 140517038265792 estimator.py:1145] Calling model_fn.
W0814 19:29:32.927958 140517038265792 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:29:33.205019 140517038265792 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:29:33.992902 140517038265792 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:29:34.055119 140517038265792 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:29:34.061110 140517038265792 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:29:34.251332 140517038265792 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:29:34.265172 140517038265792 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:29:34.277169 140517038265792 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:29:34.278249 140517038265792 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:29:34.285224 140517038265792 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:29:34.290431 140517038265792 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:29:34.290648 140517038265792 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 19:29:34.303198 140517038265792 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:29:34.414871 140517038265792 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:29:34.457904 140517038265792 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:29:34.502270 140517038265792 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:29:34.554327 140517038265792 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:29:34.716694 140517038265792 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:29:34.766927 140517038265792 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:29:34.815465 140517038265792 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:29:34.865967 140517038265792 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:29:34.911761 140517038265792 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:29:34.953685 140517038265792 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:29:34.972146 140517038265792 estimator.py:1147] Done calling model_fn.
I0814 19:29:38.403280 140517038265792 tpu_estimator.py:499] TPU job name worker
I0814 19:29:38.517025 140517038265792 monitored_session.py:240] Graph was finalized.
I0814 19:29:39.202393 140517038265792 session_manager.py:500] Running local_init_op.
I0814 19:29:39.264559 140517038265792 session_manager.py:502] Done running local_init_op.
I0814 19:29:42.195575 140517038265792 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:29:54.543581 140517038265792 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:29:54.703582 140517038265792 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:29:54.704082 140517038265792 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:29:54.704598: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:29:54.708883 140517038265792 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:29:54.711066 140517038265792 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:29:54.714947 140517038265792 tpu_estimator.py:557] Init TPU system
I0814 19:30:36.076862 140517038265792 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 19:30:36.078035 140516142077696 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:30:36.078779 140516133684992 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:30:36.147119 140517038265792 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:30:36.149391 140517038265792 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 19:30:36.152563 140516125292288 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:30:36.443417 140516125292288 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 19:30:40.952024 140516133684992 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:30:45.689534 140517038265792 basic_session_run_hooks.py:262] loss = 483.3843, step = 30
I0814 19:30:45.691947 140517038265792 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:30:59.629647 140517038265792 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:30:59.630011 140517038265792 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:30:59.630197 140516142077696 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:30:59.630399 140516142077696 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:30:59.630755 140517038265792 error_handling.py:96] infeed marked as finished
I0814 19:30:59.630842 140517038265792 tpu_estimator.py:602] Stop output thread controller
I0814 19:30:59.630891 140517038265792 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:30:59.631217 140516133684992 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:30:59.631546 140516133684992 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:30:59.631828 140517038265792 error_handling.py:96] outfeed marked as finished
I0814 19:30:59.632056 140517038265792 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:31:06.565531 140517038265792 estimator.py:368] Loss for final step: 483.3843.
I0814 19:31:06.566401 140517038265792 error_handling.py:96] training_loop marked as finished
I0814 19:31:07.347069 140517038265792 estimator.py:1145] Calling model_fn.
E0814 19:31:08.059701 140517038265792 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:31:08.288814 140517038265792 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:31:08.311000 140517038265792 estimator.py:1147] Done calling model_fn.
I0814 19:31:08.327714 140517038265792 evaluation.py:255] Starting evaluation at 2019-08-14T19:31:08Z
I0814 19:31:08.327960 140517038265792 tpu_estimator.py:499] TPU job name worker
I0814 19:31:08.405313 140517038265792 monitored_session.py:240] Graph was finalized.
W0814 19:31:08.406086 140517038265792 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:31:08.607194 140517038265792 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:31:11.210808 140517038265792 session_manager.py:500] Running local_init_op.
I0814 19:31:11.241776 140517038265792 session_manager.py:502] Done running local_init_op.
I0814 19:31:11.297914 140517038265792 tpu_estimator.py:557] Init TPU system
I0814 19:32:20.026592 140517038265792 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:32:20.027647 140516138407680 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:32:20.028049 140516130014976 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:32:20.098434 140517038265792 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:32:20.125405 140517038265792 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:32:20.125757 140517038265792 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:32:20.219302 140516116637440 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:32:20.580888 140516116637440 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:32:20.924118 140516130014976 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:32:21.250209 140517038265792 evaluation.py:167] Evaluation [10/10]
I0814 19:32:21.250571 140517038265792 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:32:21.250653 140517038265792 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:32:21.250834 140516138407680 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:32:21.250941 140516138407680 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:32:21.251081 140517038265792 error_handling.py:96] infeed marked as finished
I0814 19:32:21.251188 140517038265792 tpu_estimator.py:602] Stop output thread controller
I0814 19:32:21.251244 140517038265792 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:32:21.251461 140516130014976 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:32:21.251558 140516130014976 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:32:21.251678 140517038265792 error_handling.py:96] outfeed marked as finished
I0814 19:32:21.251758 140517038265792 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:32:50.679281 140517038265792 evaluation.py:275] Finished evaluation at 2019-08-14-19:32:50
I0814 19:32:50.679651 140517038265792 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1009, global_step = 30, loss = 437.12848
I0814 19:32:54.992348 140517038265792 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:32:55.829622 140517038265792 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 437.12848, 'global_step': 30, 'accuracy': 0.1009}

Removing gs://yangyou-mnist/log/checkpoint#1565811056016863...
Removing gs://yangyou-mnist/log/#1565810976531839...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565810976.v3-8-tpu#1565811059278015...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565810988645677...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565810989547240...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565810981606537...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565810994015282...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565811053734512...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565811052748628...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565811058229488...
Removing gs://yangyou-mnist/log/eval/#1565811172297777...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565811172.v3-8-tpu#1565811175517283...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:32:59.685307 140138671297984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:32:59.686096 140138671297984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:32:59.688738 140138671297984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:32:59.689560 140138671297984 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:32:59.690148 140138671297984 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:32:59.690294 140138671297984 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:33:00.101043 140138671297984 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:33:00.109292 140138671297984 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:33:00.113337 140138671297984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:33:00.158822 140138671297984 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:33:00.159091 140138671297984 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:33:00.458034 140138671297984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:33:00.575623 140138671297984 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:33:00.575911 140138671297984 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:33:00.904999 140138671297984 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f746de22150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f74700011d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:33:00.905388 140138671297984 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:33:01.232297 140138671297984 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:33:01.235699: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:33:01.249551 140138671297984 tpu_system_metadata.py:148] Found TPU system:
I0814 19:33:01.249861 140138671297984 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:33:01.250422 140138671297984 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:33:01.250482 140138671297984 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:33:01.250540 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:33:01.250864 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:33:01.250936 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:33:01.250988 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:33:01.251044 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:33:01.251094 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:33:01.251142 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:33:01.251189 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:33:01.251235 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:33:01.251282 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:33:01.251338 140138671297984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:33:01.257424 140138671297984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:33:01.270308 140138671297984 estimator.py:1145] Calling model_fn.
W0814 19:33:01.270912 140138671297984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:33:01.556919 140138671297984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:33:01.978224 140138671297984 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:33:02.040440 140138671297984 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:33:02.046454 140138671297984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:33:02.231288 140138671297984 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:33:02.245589 140138671297984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:33:02.257848 140138671297984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:33:02.258953 140138671297984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:33:02.265969 140138671297984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:33:02.271297 140138671297984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:33:02.271531 140138671297984 optimization.py:36] ++++++ warmup starts at step 0, for 6 steps ++++++
W0814 19:33:02.284064 140138671297984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:33:02.394047 140138671297984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:33:02.436119 140138671297984 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:33:02.480319 140138671297984 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:33:02.530647 140138671297984 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:33:02.703756 140138671297984 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:33:02.753711 140138671297984 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:33:02.801883 140138671297984 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:33:02.851167 140138671297984 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:33:02.896039 140138671297984 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:33:02.937495 140138671297984 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:33:02.954766 140138671297984 estimator.py:1147] Done calling model_fn.
I0814 19:33:06.316373 140138671297984 tpu_estimator.py:499] TPU job name worker
I0814 19:33:06.432821 140138671297984 monitored_session.py:240] Graph was finalized.
I0814 19:33:07.092050 140138671297984 session_manager.py:500] Running local_init_op.
I0814 19:33:07.156425 140138671297984 session_manager.py:502] Done running local_init_op.
I0814 19:33:10.159210 140138671297984 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:33:23.015652 140138671297984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:33:23.163631 140138671297984 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:33:23.164117 140138671297984 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:33:23.164628: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:33:23.169646 140138671297984 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:33:23.171766 140138671297984 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:33:23.175801 140138671297984 tpu_estimator.py:557] Init TPU system
I0814 19:34:04.118695 140138671297984 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 19:34:04.119626 140137909176064 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:34:04.120111 140137900783360 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:34:04.186523 140138671297984 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:34:04.188292 140138671297984 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 19:34:04.195447 140137892390656 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:34:04.490906 140137892390656 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 19:34:09.015113 140137900783360 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:34:13.561300 140138671297984 basic_session_run_hooks.py:262] loss = 4925.611, step = 30
I0814 19:34:13.564013 140138671297984 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:34:27.387474 140138671297984 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:34:27.387741 140138671297984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:34:27.387937 140137909176064 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:34:27.388037 140137909176064 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:34:27.388173 140138671297984 error_handling.py:96] infeed marked as finished
I0814 19:34:27.388267 140138671297984 tpu_estimator.py:602] Stop output thread controller
I0814 19:34:27.388317 140138671297984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:34:27.388458 140137900783360 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:34:27.388540 140137900783360 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:34:27.388663 140138671297984 error_handling.py:96] outfeed marked as finished
I0814 19:34:27.388751 140138671297984 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:34:34.621918 140138671297984 estimator.py:368] Loss for final step: 4925.611.
I0814 19:34:34.622673 140138671297984 error_handling.py:96] training_loop marked as finished
I0814 19:34:35.411147 140138671297984 estimator.py:1145] Calling model_fn.
E0814 19:34:36.095674 140138671297984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:34:36.320513 140138671297984 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:34:36.341828 140138671297984 estimator.py:1147] Done calling model_fn.
I0814 19:34:36.358253 140138671297984 evaluation.py:255] Starting evaluation at 2019-08-14T19:34:36Z
I0814 19:34:36.358520 140138671297984 tpu_estimator.py:499] TPU job name worker
I0814 19:34:36.435044 140138671297984 monitored_session.py:240] Graph was finalized.
W0814 19:34:36.435812 140138671297984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:34:36.639065 140138671297984 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:34:39.410088 140138671297984 session_manager.py:500] Running local_init_op.
I0814 19:34:39.440650 140138671297984 session_manager.py:502] Done running local_init_op.
I0814 19:34:39.494250 140138671297984 tpu_estimator.py:557] Init TPU system
I0814 19:35:48.082808 140138671297984 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:35:48.083857 140137905506048 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:35:48.084769 140137897113344 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:35:48.153753 140138671297984 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:35:48.180376 140138671297984 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:35:48.180778 140138671297984 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:35:48.284725 140137883735808 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:35:48.643405 140137883735808 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:35:49.003546 140137897113344 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:35:49.195327 140138671297984 evaluation.py:167] Evaluation [10/10]
I0814 19:35:49.195750 140138671297984 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:35:49.195839 140138671297984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:35:49.196110 140137905506048 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:35:49.196434 140137905506048 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:35:49.196629 140138671297984 error_handling.py:96] infeed marked as finished
I0814 19:35:49.196787 140138671297984 tpu_estimator.py:602] Stop output thread controller
I0814 19:35:49.196837 140138671297984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:35:49.197010 140137897113344 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:35:49.197181 140137897113344 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:35:49.197339 140138671297984 error_handling.py:96] outfeed marked as finished
I0814 19:35:49.197472 140138671297984 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:36:18.744642 140138671297984 evaluation.py:275] Finished evaluation at 2019-08-14-19:36:18
I0814 19:36:18.745009 140138671297984 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0974, global_step = 30, loss = 4463.4844
I0814 19:36:23.276556 140138671297984 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:36:24.042128 140138671297984 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 4463.4844, 'global_step': 30, 'accuracy': 0.0974}

Removing gs://yangyou-mnist/log/#1565811184444375...
Removing gs://yangyou-mnist/log/checkpoint#1565811263740290...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565811198083850...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565811202498607...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565811184.v3-8-tpu#1565811267082874...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565811189529702...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565811261590232...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565811197162466...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565811260663969...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565811266142194...
Removing gs://yangyou-mnist/log/eval/#1565811380506073...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565811380.v3-8-tpu#1565811383738647...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:36:27.884768 140610356405696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:36:27.885574 140610356405696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:36:27.888135 140610356405696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:36:27.889136 140610356405696 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:36:27.889736 140610356405696 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:36:27.889867 140610356405696 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:36:28.317851 140610356405696 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:36:28.324532 140610356405696 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:36:28.328435 140610356405696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:36:28.448239 140610356405696 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:36:28.448558 140610356405696 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:36:28.847908 140610356405696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:36:28.901329 140610356405696 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:36:28.901618 140610356405696 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:36:29.155133 140610356405696 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe24081b1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe2429fa210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:36:29.155587 140610356405696 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:36:29.490446 140610356405696 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:36:29.493380: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:36:29.505817 140610356405696 tpu_system_metadata.py:148] Found TPU system:
I0814 19:36:29.506056 140610356405696 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:36:29.506555 140610356405696 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:36:29.506622 140610356405696 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:36:29.506680 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:36:29.506956 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:36:29.507010 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:36:29.507061 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:36:29.507111 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:36:29.507158 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:36:29.507204 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:36:29.507250 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:36:29.507296 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:36:29.507342 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:36:29.507388 140610356405696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:36:29.513514 140610356405696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:36:29.526165 140610356405696 estimator.py:1145] Calling model_fn.
W0814 19:36:29.526777 140610356405696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:36:29.789962 140610356405696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:36:30.370661 140610356405696 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:36:30.432183 140610356405696 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:36:30.438190 140610356405696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:36:30.619139 140610356405696 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:36:30.632677 140610356405696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:36:30.644977 140610356405696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:36:30.646068 140610356405696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:36:30.653512 140610356405696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:36:30.658839 140610356405696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:36:30.659059 140610356405696 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 19:36:30.671592 140610356405696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:36:30.781985 140610356405696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:36:30.823247 140610356405696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:36:30.868279 140610356405696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:36:30.919523 140610356405696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:36:31.088159 140610356405696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:36:31.138267 140610356405696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:36:31.187196 140610356405696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:36:31.238291 140610356405696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:36:31.284738 140610356405696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:36:31.326953 140610356405696 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:36:31.343389 140610356405696 estimator.py:1147] Done calling model_fn.
I0814 19:36:34.830713 140610356405696 tpu_estimator.py:499] TPU job name worker
I0814 19:36:34.942215 140610356405696 monitored_session.py:240] Graph was finalized.
I0814 19:36:35.619896 140610356405696 session_manager.py:500] Running local_init_op.
I0814 19:36:35.667552 140610356405696 session_manager.py:502] Done running local_init_op.
I0814 19:36:38.438941 140610356405696 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:36:50.897639 140610356405696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:36:51.039474 140610356405696 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:36:51.039932 140610356405696 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:36:51.040322: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:36:51.045351 140610356405696 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:36:51.047349 140610356405696 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:36:51.055018 140610356405696 tpu_estimator.py:557] Init TPU system
I0814 19:37:32.040268 140610356405696 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 19:37:32.041114 140609594304256 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:37:32.041577 140609243313920 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:37:32.108135 140610356405696 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:37:32.111496 140610356405696 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 19:37:32.114510 140609234921216 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:37:32.460268 140609234921216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 19:37:37.086395 140609243313920 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:37:41.728653 140610356405696 basic_session_run_hooks.py:262] loss = 2.1813962, step = 30
I0814 19:37:41.731581 140610356405696 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:37:55.355148 140610356405696 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:37:55.355433 140610356405696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:37:55.355662 140609594304256 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:37:55.355782 140609594304256 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:37:55.355933 140610356405696 error_handling.py:96] infeed marked as finished
I0814 19:37:55.356038 140610356405696 tpu_estimator.py:602] Stop output thread controller
I0814 19:37:55.356086 140610356405696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:37:55.356201 140609243313920 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:37:55.356276 140609243313920 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:37:55.356385 140610356405696 error_handling.py:96] outfeed marked as finished
I0814 19:37:55.356498 140610356405696 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:38:02.602765 140610356405696 estimator.py:368] Loss for final step: 2.1813962.
I0814 19:38:02.603563 140610356405696 error_handling.py:96] training_loop marked as finished
I0814 19:38:03.314661 140610356405696 estimator.py:1145] Calling model_fn.
E0814 19:38:04.085961 140610356405696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:38:04.314115 140610356405696 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:38:04.336328 140610356405696 estimator.py:1147] Done calling model_fn.
I0814 19:38:04.353144 140610356405696 evaluation.py:255] Starting evaluation at 2019-08-14T19:38:04Z
I0814 19:38:04.353373 140610356405696 tpu_estimator.py:499] TPU job name worker
I0814 19:38:04.431926 140610356405696 monitored_session.py:240] Graph was finalized.
W0814 19:38:04.432688 140610356405696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:38:04.622045 140610356405696 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:38:07.231004 140610356405696 session_manager.py:500] Running local_init_op.
I0814 19:38:07.255831 140610356405696 session_manager.py:502] Done running local_init_op.
I0814 19:38:07.313294 140610356405696 tpu_estimator.py:557] Init TPU system
I0814 19:39:16.108953 140610356405696 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:39:16.109793 140609243313920 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:39:16.110271 140609234921216 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:39:16.178833 140610356405696 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:39:16.207468 140610356405696 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:39:16.207835 140610356405696 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:39:16.241272 140609226528512 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:39:16.506624 140609226528512 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:39:17.018791 140609234921216 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:39:17.413537 140610356405696 evaluation.py:167] Evaluation [10/10]
I0814 19:39:17.413908 140610356405696 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:39:17.413988 140610356405696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:39:17.414170 140609243313920 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:39:17.414298 140609243313920 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:39:17.414462 140610356405696 error_handling.py:96] infeed marked as finished
I0814 19:39:17.414561 140610356405696 tpu_estimator.py:602] Stop output thread controller
I0814 19:39:17.414611 140610356405696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:39:17.414730 140609234921216 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:39:17.414803 140609234921216 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:39:17.414921 140610356405696 error_handling.py:96] outfeed marked as finished
I0814 19:39:17.414997 140610356405696 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:39:46.594769 140610356405696 evaluation.py:275] Finished evaluation at 2019-08-14-19:39:46
I0814 19:39:46.595104 140610356405696 estimator.py:2039] Saving dict for global step 30: accuracy = 0.6533, global_step = 30, loss = 2.1763988
I0814 19:39:51.058187 140610356405696 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:39:51.890158 140610356405696 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.1763988, 'global_step': 30, 'accuracy': 0.6533}

Removing gs://yangyou-mnist/log/#1565811392897238...
Removing gs://yangyou-mnist/log/checkpoint#1565811471776963...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565811393.v3-8-tpu#1565811475045097...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565811405811813...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565811397856905...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565811410384073...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565811468511677...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565811404898215...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565811469621486...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565811474067730...
Removing gs://yangyou-mnist/log/eval/#1565811588272291...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565811588.v3-8-tpu#1565811591574540...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:39:55.800838 140696366634432 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:39:55.801652 140696366634432 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:39:55.804599 140696366634432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:39:55.805433 140696366634432 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:39:55.806040 140696366634432 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:39:55.806169 140696366634432 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:39:56.215369 140696366634432 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:39:56.222428 140696366634432 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:39:56.226053 140696366634432 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:39:56.345001 140696366634432 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:39:56.345288 140696366634432 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:39:56.742194 140696366634432 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:39:56.797625 140696366634432 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:39:56.797935 140696366634432 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:39:57.192152 140696366634432 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff6471da1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff6493b9210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:39:57.192603 140696366634432 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:39:57.524137 140696366634432 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:39:57.527840: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:39:57.543317 140696366634432 tpu_system_metadata.py:148] Found TPU system:
I0814 19:39:57.543689 140696366634432 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:39:57.544269 140696366634432 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:39:57.544342 140696366634432 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:39:57.544450 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:39:57.544770 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:39:57.544828 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:39:57.544883 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:39:57.544960 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:39:57.545030 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:39:57.545082 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:39:57.545129 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:39:57.545192 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:39:57.545249 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:39:57.545298 140696366634432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:39:57.552078 140696366634432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:39:57.565510 140696366634432 estimator.py:1145] Calling model_fn.
W0814 19:39:57.566189 140696366634432 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:39:57.849852 140696366634432 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:39:58.416192 140696366634432 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:39:58.478890 140696366634432 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:39:58.484944 140696366634432 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:39:58.671627 140696366634432 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:39:58.686156 140696366634432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:39:58.698517 140696366634432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:39:58.699610 140696366634432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:39:58.706691 140696366634432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:39:58.712040 140696366634432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:39:58.712260 140696366634432 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 19:39:58.724500 140696366634432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:39:58.838275 140696366634432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:39:58.882138 140696366634432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:39:58.927617 140696366634432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:39:58.980549 140696366634432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:39:59.157834 140696366634432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:39:59.216514 140696366634432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:39:59.269335 140696366634432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:39:59.322979 140696366634432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:39:59.372209 140696366634432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:39:59.415350 140696366634432 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:39:59.432199 140696366634432 estimator.py:1147] Done calling model_fn.
I0814 19:40:03.021392 140696366634432 tpu_estimator.py:499] TPU job name worker
I0814 19:40:03.141577 140696366634432 monitored_session.py:240] Graph was finalized.
I0814 19:40:03.834172 140696366634432 session_manager.py:500] Running local_init_op.
I0814 19:40:03.894498 140696366634432 session_manager.py:502] Done running local_init_op.
I0814 19:40:06.756870 140696366634432 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:40:19.356451 140696366634432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:40:19.523662 140696366634432 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:40:19.524158 140696366634432 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:40:19.524616: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:40:19.529987 140696366634432 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:40:19.532217 140696366634432 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:40:19.537664 140696366634432 tpu_estimator.py:557] Init TPU system
I0814 19:41:00.133183 140696366634432 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 19:41:00.134273 140695335593728 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:41:00.134985 140695327201024 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:41:00.198642 140696366634432 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:41:00.199569 140696366634432 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 19:41:00.252197 140695318808320 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:41:00.687216 140695318808320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:41:05.113842 140695327201024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:41:09.802815 140696366634432 basic_session_run_hooks.py:262] loss = 2.0439694, step = 30
I0814 19:41:09.805603 140696366634432 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:41:23.435301 140696366634432 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:41:23.435659 140696366634432 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:41:23.437320 140695335593728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:41:23.437465 140695335593728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:41:23.437740 140696366634432 error_handling.py:96] infeed marked as finished
I0814 19:41:23.437848 140696366634432 tpu_estimator.py:602] Stop output thread controller
I0814 19:41:23.437899 140696366634432 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:41:23.438154 140695327201024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:41:23.438330 140695327201024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:41:23.438529 140696366634432 error_handling.py:96] outfeed marked as finished
I0814 19:41:23.438626 140696366634432 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:41:30.833327 140696366634432 estimator.py:368] Loss for final step: 2.0439694.
I0814 19:41:30.834156 140696366634432 error_handling.py:96] training_loop marked as finished
I0814 19:41:31.618479 140696366634432 estimator.py:1145] Calling model_fn.
E0814 19:41:32.402169 140696366634432 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:41:32.625164 140696366634432 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:41:32.646408 140696366634432 estimator.py:1147] Done calling model_fn.
I0814 19:41:32.663202 140696366634432 evaluation.py:255] Starting evaluation at 2019-08-14T19:41:32Z
I0814 19:41:32.663434 140696366634432 tpu_estimator.py:499] TPU job name worker
I0814 19:41:32.740346 140696366634432 monitored_session.py:240] Graph was finalized.
W0814 19:41:32.741108 140696366634432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:41:32.936795 140696366634432 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:41:35.702176 140696366634432 session_manager.py:500] Running local_init_op.
I0814 19:41:35.726741 140696366634432 session_manager.py:502] Done running local_init_op.
I0814 19:41:35.774019 140696366634432 tpu_estimator.py:557] Init TPU system
I0814 19:42:44.064820 140696366634432 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:42:44.065957 140695332185856 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:42:44.066952 140695323793152 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:42:44.139465 140696366634432 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:42:44.167365 140696366634432 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:42:44.167776 140696366634432 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:42:44.204715 140695315400448 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:42:44.483125 140695315400448 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:42:44.945084 140695323793152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:42:45.403014 140696366634432 evaluation.py:167] Evaluation [10/10]
I0814 19:42:45.403390 140696366634432 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:42:45.403470 140696366634432 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:42:45.403749 140695332185856 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:42:45.404062 140695332185856 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:42:45.404431 140696366634432 error_handling.py:96] infeed marked as finished
I0814 19:42:45.404622 140696366634432 tpu_estimator.py:602] Stop output thread controller
I0814 19:42:45.404683 140696366634432 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:42:45.404918 140695323793152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:42:45.405107 140695323793152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:42:45.405284 140696366634432 error_handling.py:96] outfeed marked as finished
I0814 19:42:45.405491 140696366634432 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:43:14.575352 140696366634432 evaluation.py:275] Finished evaluation at 2019-08-14-19:43:14
I0814 19:43:14.575714 140696366634432 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7269, global_step = 30, loss = 2.0387363
I0814 19:43:19.042933 140696366634432 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:43:19.992722 140696366634432 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.0387363, 'global_step': 30, 'accuracy': 0.7269}

Removing gs://yangyou-mnist/log/#1565811600920125...
Removing gs://yangyou-mnist/log/checkpoint#1565811679914620...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565811601.v3-8-tpu#1565811683131693...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565811606183814...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565811614256299...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565811618846050...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565811676743099...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565811613269721...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565811677585311...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565811682184412...
Removing gs://yangyou-mnist/log/eval/#1565811796255086...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565811796.v3-8-tpu#1565811799670227...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:43:23.867825 139894927570368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:43:23.868874 139894927570368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:43:23.872057 139894927570368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:43:23.873006 139894927570368 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:43:23.873684 139894927570368 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:43:23.873842 139894927570368 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:43:24.301052 139894927570368 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:43:24.309520 139894927570368 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:43:24.313484 139894927570368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:43:24.434551 139894927570368 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:43:24.434824 139894927570368 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:43:24.851273 139894927570368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:43:24.893563 139894927570368 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:43:24.893836 139894927570368 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:43:25.230237 139894927570368 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3bada00190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3bafbdf210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:43:25.230638 139894927570368 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:43:25.561283 139894927570368 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:43:25.564506: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:43:25.577784 139894927570368 tpu_system_metadata.py:148] Found TPU system:
I0814 19:43:25.578028 139894927570368 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:43:25.578567 139894927570368 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:43:25.578645 139894927570368 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:43:25.578715 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:43:25.579046 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:43:25.579113 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:43:25.579171 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:43:25.579226 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:43:25.579279 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:43:25.579334 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:43:25.579385 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:43:25.579443 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:43:25.579498 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:43:25.579550 139894927570368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:43:25.586296 139894927570368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:43:25.600541 139894927570368 estimator.py:1145] Calling model_fn.
W0814 19:43:25.601645 139894927570368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:43:25.879652 139894927570368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:43:26.948074 139894927570368 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:43:27.009696 139894927570368 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:43:27.015553 139894927570368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:43:27.193809 139894927570368 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:43:27.207829 139894927570368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:43:27.219969 139894927570368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:43:27.221039 139894927570368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:43:27.228032 139894927570368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:43:27.233659 139894927570368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:43:27.233875 139894927570368 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 19:43:27.246058 139894927570368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:43:27.362540 139894927570368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:43:27.404656 139894927570368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:43:27.449049 139894927570368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:43:27.499847 139894927570368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:43:27.662419 139894927570368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:43:27.712856 139894927570368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:43:27.761033 139894927570368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:43:27.810914 139894927570368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:43:27.856836 139894927570368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:43:27.898533 139894927570368 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:43:27.914340 139894927570368 estimator.py:1147] Done calling model_fn.
I0814 19:43:31.312396 139894927570368 tpu_estimator.py:499] TPU job name worker
I0814 19:43:31.425319 139894927570368 monitored_session.py:240] Graph was finalized.
I0814 19:43:32.074711 139894927570368 session_manager.py:500] Running local_init_op.
I0814 19:43:32.122411 139894927570368 session_manager.py:502] Done running local_init_op.
I0814 19:43:34.750878 139894927570368 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:43:47.273427 139894927570368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:43:47.446854 139894927570368 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:43:47.447293 139894927570368 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:43:47.447721: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:43:47.453457 139894927570368 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:43:47.455641 139894927570368 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:43:47.460333 139894927570368 tpu_estimator.py:557] Init TPU system
I0814 19:44:28.091267 139894927570368 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 19:44:28.092153 139894165587712 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:44:28.092662 139894157195008 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:44:28.161987 139894927570368 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:44:28.165730 139894927570368 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 19:44:28.167701 139894148802304 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:44:28.480689 139894148802304 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 19:44:33.032157 139894157195008 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:44:37.707972 139894927570368 basic_session_run_hooks.py:262] loss = 1.5505612, step = 30
I0814 19:44:37.710391 139894927570368 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:44:51.401489 139894927570368 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:44:51.401782 139894927570368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:44:51.401992 139894165587712 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:44:51.402105 139894165587712 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:44:51.402251 139894927570368 error_handling.py:96] infeed marked as finished
I0814 19:44:51.402375 139894927570368 tpu_estimator.py:602] Stop output thread controller
I0814 19:44:51.402435 139894927570368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:44:51.402551 139894157195008 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:44:51.402623 139894157195008 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:44:51.402733 139894927570368 error_handling.py:96] outfeed marked as finished
I0814 19:44:51.402817 139894927570368 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:44:58.617933 139894927570368 estimator.py:368] Loss for final step: 1.5505612.
I0814 19:44:58.618710 139894927570368 error_handling.py:96] training_loop marked as finished
I0814 19:44:59.416382 139894927570368 estimator.py:1145] Calling model_fn.
E0814 19:45:00.218885 139894927570368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:45:00.445132 139894927570368 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:45:00.467772 139894927570368 estimator.py:1147] Done calling model_fn.
I0814 19:45:00.484550 139894927570368 evaluation.py:255] Starting evaluation at 2019-08-14T19:45:00Z
I0814 19:45:00.484791 139894927570368 tpu_estimator.py:499] TPU job name worker
I0814 19:45:00.561932 139894927570368 monitored_session.py:240] Graph was finalized.
W0814 19:45:00.562694 139894927570368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:45:00.754827 139894927570368 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:45:03.385627 139894927570368 session_manager.py:500] Running local_init_op.
I0814 19:45:03.409257 139894927570368 session_manager.py:502] Done running local_init_op.
I0814 19:45:03.457578 139894927570368 tpu_estimator.py:557] Init TPU system
I0814 19:46:12.081772 139894927570368 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:46:12.082669 139894161917696 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:46:12.083108 139894153524992 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:46:12.150216 139894927570368 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:46:12.175626 139894927570368 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:46:12.176042 139894927570368 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:46:12.205180 139894140147456 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:46:12.489950 139894140147456 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:46:12.969475 139894153524992 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:46:13.397105 139894927570368 evaluation.py:167] Evaluation [10/10]
I0814 19:46:13.397471 139894927570368 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:46:13.397555 139894927570368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:46:13.397751 139894161917696 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:46:13.397850 139894161917696 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:46:13.397985 139894927570368 error_handling.py:96] infeed marked as finished
I0814 19:46:13.398077 139894927570368 tpu_estimator.py:602] Stop output thread controller
I0814 19:46:13.398124 139894927570368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:46:13.398245 139894153524992 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:46:13.398324 139894153524992 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:46:13.398437 139894927570368 error_handling.py:96] outfeed marked as finished
I0814 19:46:13.398514 139894927570368 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:46:42.586322 139894927570368 evaluation.py:275] Finished evaluation at 2019-08-14-19:46:42
I0814 19:46:42.586639 139894927570368 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8163, global_step = 30, loss = 1.5199945
I0814 19:46:47.182225 139894927570368 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:46:48.102848 139894927570368 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.5199945, 'global_step': 30, 'accuracy': 0.8163}

Removing gs://yangyou-mnist/log/#1565811809430425...
Removing gs://yangyou-mnist/log/checkpoint#1565811887870526...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565811809.v3-8-tpu#1565811891086649...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565811826757377...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565811822145417...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565811814179441...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565811884760305...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565811821246539...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565811885664000...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565811890057609...
Removing gs://yangyou-mnist/log/eval/#1565812004251117...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565812004.v3-8-tpu#1565812007797817...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:46:51.952594 140253435762112 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:46:51.953393 140253435762112 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:46:51.955971 140253435762112 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:46:51.956967 140253435762112 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:46:51.957591 140253435762112 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:46:51.957720 140253435762112 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:46:52.375830 140253435762112 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:46:52.382436 140253435762112 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:46:52.386287 140253435762112 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:46:52.429610 140253435762112 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:46:52.429892 140253435762112 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:46:52.758682 140253435762112 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:46:52.876626 140253435762112 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:46:52.876897 140253435762112 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:46:53.261816 140253435762112 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8f2660e1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8f287ed210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:46:53.262186 140253435762112 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:46:53.628813 140253435762112 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:46:53.631780: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:46:53.644695 140253435762112 tpu_system_metadata.py:148] Found TPU system:
I0814 19:46:53.644931 140253435762112 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:46:53.645415 140253435762112 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:46:53.645471 140253435762112 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:46:53.645523 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:46:53.645842 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:46:53.645899 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:46:53.645948 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:46:53.645996 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:46:53.646043 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:46:53.646090 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:46:53.646152 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:46:53.646202 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:46:53.646248 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:46:53.646295 140253435762112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:46:53.652529 140253435762112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:46:53.665124 140253435762112 estimator.py:1145] Calling model_fn.
W0814 19:46:53.665731 140253435762112 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:46:53.932866 140253435762112 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:46:54.598170 140253435762112 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:46:54.660835 140253435762112 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:46:54.666732 140253435762112 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:46:54.850725 140253435762112 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:46:54.864293 140253435762112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:46:54.876499 140253435762112 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:46:54.877572 140253435762112 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:46:54.884722 140253435762112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:46:54.889940 140253435762112 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:46:54.890150 140253435762112 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 19:46:54.902741 140253435762112 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:46:55.012619 140253435762112 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:46:55.055424 140253435762112 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:46:55.101655 140253435762112 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:46:55.153125 140253435762112 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:46:55.320641 140253435762112 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:46:55.371386 140253435762112 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:46:55.421014 140253435762112 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:46:55.471787 140253435762112 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:46:55.517702 140253435762112 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:46:55.558725 140253435762112 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:46:55.574964 140253435762112 estimator.py:1147] Done calling model_fn.
I0814 19:46:59.347841 140253435762112 tpu_estimator.py:499] TPU job name worker
I0814 19:46:59.456907 140253435762112 monitored_session.py:240] Graph was finalized.
I0814 19:47:00.152041 140253435762112 session_manager.py:500] Running local_init_op.
I0814 19:47:00.212949 140253435762112 session_manager.py:502] Done running local_init_op.
I0814 19:47:02.855817 140253435762112 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:47:15.635523 140253435762112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:47:15.802927 140253435762112 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:47:15.803396 140253435762112 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:47:15.803896: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:47:15.809127 140253435762112 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:47:15.811346 140253435762112 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:47:15.815960 140253435762112 tpu_estimator.py:557] Init TPU system
I0814 19:47:56.037600 140253435762112 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 19:47:56.038477 140252539508480 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:47:56.039053 140252531115776 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:47:56.105331 140252522723072 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:47:56.105851 140253435762112 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:47:56.107222 140253435762112 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 19:47:56.544025 140252522723072 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:48:00.903848 140252531115776 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:48:05.710438 140253435762112 basic_session_run_hooks.py:262] loss = 1.0261577, step = 30
I0814 19:48:05.712688 140253435762112 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:48:19.616628 140253435762112 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:48:19.616954 140253435762112 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:48:19.618283 140252539508480 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:48:19.618449 140252539508480 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:48:19.618618 140253435762112 error_handling.py:96] infeed marked as finished
I0814 19:48:19.618716 140253435762112 tpu_estimator.py:602] Stop output thread controller
I0814 19:48:19.618844 140253435762112 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:48:19.619014 140252531115776 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:48:19.619095 140252531115776 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:48:19.619208 140253435762112 error_handling.py:96] outfeed marked as finished
I0814 19:48:19.619313 140253435762112 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:48:26.658340 140253435762112 estimator.py:368] Loss for final step: 1.0261577.
I0814 19:48:26.659095 140253435762112 error_handling.py:96] training_loop marked as finished
I0814 19:48:27.443557 140253435762112 estimator.py:1145] Calling model_fn.
E0814 19:48:28.163513 140253435762112 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:48:28.391484 140253435762112 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:48:28.413948 140253435762112 estimator.py:1147] Done calling model_fn.
I0814 19:48:28.432357 140253435762112 evaluation.py:255] Starting evaluation at 2019-08-14T19:48:28Z
I0814 19:48:28.432634 140253435762112 tpu_estimator.py:499] TPU job name worker
I0814 19:48:28.512799 140253435762112 monitored_session.py:240] Graph was finalized.
W0814 19:48:28.513537 140253435762112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:48:28.707165 140253435762112 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:48:31.450100 140253435762112 session_manager.py:500] Running local_init_op.
I0814 19:48:31.475330 140253435762112 session_manager.py:502] Done running local_init_op.
I0814 19:48:31.524336 140253435762112 tpu_estimator.py:557] Init TPU system
I0814 19:49:40.032854 140253435762112 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:49:40.033931 140252535838464 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:49:40.034452 140252527445760 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:49:40.103595 140253435762112 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:49:40.130943 140253435762112 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:49:40.131273 140253435762112 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:49:40.158476 140252514068224 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:49:40.439454 140252514068224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:49:40.939980 140252527445760 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:49:41.252981 140253435762112 evaluation.py:167] Evaluation [10/10]
I0814 19:49:41.253325 140253435762112 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:49:41.253401 140253435762112 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:49:41.253583 140252535838464 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:49:41.253691 140252535838464 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:49:41.253886 140253435762112 error_handling.py:96] infeed marked as finished
I0814 19:49:41.254008 140253435762112 tpu_estimator.py:602] Stop output thread controller
I0814 19:49:41.254056 140253435762112 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:49:41.254180 140252527445760 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:49:41.254343 140252527445760 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:49:41.254492 140253435762112 error_handling.py:96] outfeed marked as finished
I0814 19:49:41.254575 140253435762112 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:50:10.528359 140253435762112 evaluation.py:275] Finished evaluation at 2019-08-14-19:50:10
I0814 19:50:10.528752 140253435762112 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8268, global_step = 30, loss = 0.96739274
I0814 19:50:15.176739 140253435762112 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:50:16.025229 140253435762112 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.96739274, 'global_step': 30, 'accuracy': 0.8268}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565812030434353...
Removing gs://yangyou-mnist/log/#1565812017095483...
Removing gs://yangyou-mnist/log/checkpoint#1565812096046625...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565812035116643...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565812017.v3-8-tpu#1565812099308274...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565812092813918...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565812022263531...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565812029471762...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565812093731045...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565812098364551...
Removing gs://yangyou-mnist/log/eval/#1565812212298781...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565812212.v3-8-tpu#1565812215716549...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:50:19.947082 139949228524992 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:50:19.947894 139949228524992 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:50:19.950839 139949228524992 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:50:19.951740 139949228524992 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:50:19.952394 139949228524992 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:50:19.952578 139949228524992 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:50:20.391933 139949228524992 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:50:20.400898 139949228524992 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:50:20.405567 139949228524992 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:50:20.529673 139949228524992 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:50:20.529989 139949228524992 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:50:20.790878 139949228524992 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:50:20.845345 139949228524992 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:50:20.845638 139949228524992 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:50:21.336554 139949228524992 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f485236d290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f485454c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:50:21.336992 139949228524992 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:50:21.689124 139949228524992 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:50:21.692425: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:50:21.707819 139949228524992 tpu_system_metadata.py:148] Found TPU system:
I0814 19:50:21.708065 139949228524992 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:50:21.708750 139949228524992 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:50:21.708810 139949228524992 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:50:21.708864 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:50:21.709172 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:50:21.709228 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:50:21.709280 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:50:21.709328 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:50:21.709376 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:50:21.709425 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:50:21.709491 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:50:21.709537 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:50:21.709587 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:50:21.709635 139949228524992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:50:21.715964 139949228524992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:50:21.729212 139949228524992 estimator.py:1145] Calling model_fn.
W0814 19:50:21.729840 139949228524992 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:50:22.001929 139949228524992 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:50:22.688983 139949228524992 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:50:22.752316 139949228524992 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:50:22.758318 139949228524992 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:50:22.941402 139949228524992 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:50:22.961965 139949228524992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:50:22.976222 139949228524992 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:50:22.977402 139949228524992 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:50:22.984920 139949228524992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:50:22.990236 139949228524992 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:50:22.990607 139949228524992 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 19:50:23.003429 139949228524992 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:50:23.119132 139949228524992 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:50:23.161895 139949228524992 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:50:23.208614 139949228524992 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:50:23.271064 139949228524992 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:50:23.443636 139949228524992 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:50:23.495686 139949228524992 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:50:23.546047 139949228524992 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:50:23.598480 139949228524992 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:50:23.645992 139949228524992 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:50:23.688602 139949228524992 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:50:23.705358 139949228524992 estimator.py:1147] Done calling model_fn.
I0814 19:50:27.223706 139949228524992 tpu_estimator.py:499] TPU job name worker
I0814 19:50:27.343416 139949228524992 monitored_session.py:240] Graph was finalized.
I0814 19:50:28.024725 139949228524992 session_manager.py:500] Running local_init_op.
I0814 19:50:28.075066 139949228524992 session_manager.py:502] Done running local_init_op.
I0814 19:50:30.822717 139949228524992 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:50:43.901716 139949228524992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:50:44.044066 139949228524992 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:50:44.044538 139949228524992 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:50:44.044957: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:50:44.050379 139949228524992 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:50:44.052607 139949228524992 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:50:44.056715 139949228524992 tpu_estimator.py:557] Init TPU system
I0814 19:51:24.127353 139949228524992 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 19:51:24.128456 139948466624256 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:51:24.128758 139948458231552 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:51:24.195029 139949228524992 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:51:24.195861 139949228524992 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 19:51:24.261096 139948449838848 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:51:24.672643 139948449838848 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:51:29.003385 139948458231552 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:51:33.717935 139949228524992 basic_session_run_hooks.py:262] loss = 0.7012384, step = 30
I0814 19:51:33.720164 139949228524992 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:51:48.106641 139949228524992 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:51:48.106962 139949228524992 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:51:48.107280 139948466624256 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:51:48.107423 139948466624256 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:51:48.107620 139949228524992 error_handling.py:96] infeed marked as finished
I0814 19:51:48.107764 139949228524992 tpu_estimator.py:602] Stop output thread controller
I0814 19:51:48.107817 139949228524992 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:51:48.107973 139948458231552 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:51:48.108053 139948458231552 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:51:48.108198 139949228524992 error_handling.py:96] outfeed marked as finished
I0814 19:51:48.108289 139949228524992 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:51:54.816179 139949228524992 estimator.py:368] Loss for final step: 0.7012384.
I0814 19:51:54.817008 139949228524992 error_handling.py:96] training_loop marked as finished
I0814 19:51:55.525584 139949228524992 estimator.py:1145] Calling model_fn.
E0814 19:51:56.214073 139949228524992 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:51:56.441709 139949228524992 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:51:56.463475 139949228524992 estimator.py:1147] Done calling model_fn.
I0814 19:51:56.480143 139949228524992 evaluation.py:255] Starting evaluation at 2019-08-14T19:51:56Z
I0814 19:51:56.480376 139949228524992 tpu_estimator.py:499] TPU job name worker
I0814 19:51:56.558902 139949228524992 monitored_session.py:240] Graph was finalized.
W0814 19:51:56.559617 139949228524992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:51:56.753283 139949228524992 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:51:59.320599 139949228524992 session_manager.py:500] Running local_init_op.
I0814 19:51:59.345082 139949228524992 session_manager.py:502] Done running local_init_op.
I0814 19:51:59.394040 139949228524992 tpu_estimator.py:557] Init TPU system
I0814 19:53:08.067440 139949228524992 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:53:08.068659 139948454561536 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:53:08.068363 139948462954240 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:53:08.139501 139949228524992 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:53:08.165929 139949228524992 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:53:08.166340 139949228524992 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:53:08.205189 139948441184000 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:53:08.636337 139948441184000 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:53:08.973318 139948454561536 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:53:09.434953 139949228524992 evaluation.py:167] Evaluation [10/10]
I0814 19:53:09.435307 139949228524992 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:53:09.435410 139949228524992 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:53:09.435578 139948462954240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:53:09.435692 139948462954240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:53:09.435852 139949228524992 error_handling.py:96] infeed marked as finished
I0814 19:53:09.435944 139949228524992 tpu_estimator.py:602] Stop output thread controller
I0814 19:53:09.435991 139949228524992 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:53:09.436103 139948454561536 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:53:09.436180 139948454561536 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:53:09.436312 139949228524992 error_handling.py:96] outfeed marked as finished
I0814 19:53:09.436394 139949228524992 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:53:38.728434 139949228524992 evaluation.py:275] Finished evaluation at 2019-08-14-19:53:38
I0814 19:53:38.728797 139949228524992 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8478, global_step = 30, loss = 0.6513664
I0814 19:53:43.412209 139949228524992 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:53:44.367105 139949228524992 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.6513664, 'global_step': 30, 'accuracy': 0.8478}

Removing gs://yangyou-mnist/log/#1565812225326227...
Removing gs://yangyou-mnist/log/checkpoint#1565812304510237...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565812225.v3-8-tpu#1565812307794083...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565812230248983...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565812238751364...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565812301268210...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565812243388083...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565812302194859...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565812237776922...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565812306844863...
Removing gs://yangyou-mnist/log/eval/#1565812420486592...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565812420.v3-8-tpu#1565812424057361...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:53:48.251734 140535430632896 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:53:48.252609 140535430632896 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:53:48.255374 140535430632896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:53:48.256283 140535430632896 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:53:48.257018 140535430632896 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:53:48.257149 140535430632896 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:53:48.675745 140535430632896 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:53:48.682384 140535430632896 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:53:48.686454 140535430632896 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:53:48.752960 140535430632896 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:53:48.753237 140535430632896 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:53:49.099504 140535430632896 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:53:49.151552 140535430632896 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:53:49.151830 140535430632896 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:53:49.450123 140535430632896 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd0ce952190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd0d0b31210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:53:49.450546 140535430632896 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:53:49.785953 140535430632896 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:53:49.788773: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:53:49.801498 140535430632896 tpu_system_metadata.py:148] Found TPU system:
I0814 19:53:49.801816 140535430632896 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:53:49.802331 140535430632896 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:53:49.802391 140535430632896 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:53:49.802444 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:53:49.802746 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:53:49.802809 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:53:49.802861 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:53:49.802908 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:53:49.802956 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:53:49.803003 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:53:49.803049 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:53:49.803095 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:53:49.803153 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:53:49.803221 140535430632896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:53:49.809237 140535430632896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:53:49.821549 140535430632896 estimator.py:1145] Calling model_fn.
W0814 19:53:49.822175 140535430632896 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:53:50.087012 140535430632896 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:53:50.756944 140535430632896 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:53:50.820029 140535430632896 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:53:50.825906 140535430632896 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:53:51.005064 140535430632896 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:53:51.019042 140535430632896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:53:51.031074 140535430632896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:53:51.032140 140535430632896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:53:51.039228 140535430632896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:53:51.044567 140535430632896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:53:51.044800 140535430632896 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 19:53:51.057423 140535430632896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:53:51.168329 140535430632896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:53:51.209814 140535430632896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:53:51.254837 140535430632896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:53:51.305871 140535430632896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:53:51.474551 140535430632896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:53:51.525005 140535430632896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:53:51.574479 140535430632896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:53:51.624787 140535430632896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:53:51.670099 140535430632896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:53:51.710561 140535430632896 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:53:51.726603 140535430632896 estimator.py:1147] Done calling model_fn.
I0814 19:53:55.321376 140535430632896 tpu_estimator.py:499] TPU job name worker
I0814 19:53:55.433465 140535430632896 monitored_session.py:240] Graph was finalized.
I0814 19:53:56.099106 140535430632896 session_manager.py:500] Running local_init_op.
I0814 19:53:56.162018 140535430632896 session_manager.py:502] Done running local_init_op.
I0814 19:53:58.779396 140535430632896 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:54:11.320499 140535430632896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:54:11.489186 140535430632896 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:54:11.489631 140535430632896 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:54:11.490019: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:54:11.495147 140535430632896 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:54:11.497375 140535430632896 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:54:11.501581 140535430632896 tpu_estimator.py:557] Init TPU system
I0814 19:54:52.061826 140535430632896 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 19:54:52.062731 140534534362880 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:54:52.063196 140534525970176 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:54:52.126486 140534517577472 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:54:52.128531 140535430632896 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:54:52.129688 140535430632896 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 19:54:52.601911 140534517577472 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:54:56.911505 140534525970176 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:55:01.397687 140535430632896 basic_session_run_hooks.py:262] loss = 0.5147737, step = 30
I0814 19:55:01.400084 140535430632896 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:55:15.617093 140535430632896 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:55:15.617433 140535430632896 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:55:15.617639 140534534362880 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:55:15.617734 140534534362880 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:55:15.617877 140535430632896 error_handling.py:96] infeed marked as finished
I0814 19:55:15.617979 140535430632896 tpu_estimator.py:602] Stop output thread controller
I0814 19:55:15.618038 140535430632896 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:55:15.618154 140534525970176 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:55:15.618226 140534525970176 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:55:15.618347 140535430632896 error_handling.py:96] outfeed marked as finished
I0814 19:55:15.618432 140535430632896 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:55:22.742088 140535430632896 estimator.py:368] Loss for final step: 0.5147737.
I0814 19:55:22.742932 140535430632896 error_handling.py:96] training_loop marked as finished
I0814 19:55:23.575217 140535430632896 estimator.py:1145] Calling model_fn.
E0814 19:55:24.287719 140535430632896 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:55:24.514278 140535430632896 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:55:24.536969 140535430632896 estimator.py:1147] Done calling model_fn.
I0814 19:55:24.553608 140535430632896 evaluation.py:255] Starting evaluation at 2019-08-14T19:55:24Z
I0814 19:55:24.553853 140535430632896 tpu_estimator.py:499] TPU job name worker
I0814 19:55:24.630469 140535430632896 monitored_session.py:240] Graph was finalized.
W0814 19:55:24.631246 140535430632896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:55:24.823970 140535430632896 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:55:27.597758 140535430632896 session_manager.py:500] Running local_init_op.
I0814 19:55:27.623635 140535430632896 session_manager.py:502] Done running local_init_op.
I0814 19:55:27.692873 140535430632896 tpu_estimator.py:557] Init TPU system
I0814 19:56:36.042932 140535430632896 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 19:56:36.044116 140534530692864 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:56:36.044859 140534522300160 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:56:36.113157 140535430632896 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:56:36.143389 140535430632896 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 19:56:36.143743 140535430632896 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 19:56:36.245018 140534508922624 transport.py:157] Attempting refresh to obtain initial access_token
W0814 19:56:36.493264 140534508922624 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:56:36.921695 140534522300160 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:56:37.351296 140535430632896 evaluation.py:167] Evaluation [10/10]
I0814 19:56:37.351643 140535430632896 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:56:37.351718 140535430632896 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:56:37.352054 140534530692864 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:56:37.352334 140534530692864 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:56:37.352634 140535430632896 error_handling.py:96] infeed marked as finished
I0814 19:56:37.352869 140535430632896 tpu_estimator.py:602] Stop output thread controller
I0814 19:56:37.352930 140535430632896 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:56:37.353091 140534522300160 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:56:37.353249 140534522300160 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:56:37.353398 140535430632896 error_handling.py:96] outfeed marked as finished
I0814 19:56:37.353528 140535430632896 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:57:06.563952 140535430632896 evaluation.py:275] Finished evaluation at 2019-08-14-19:57:06
I0814 19:57:06.564372 140535430632896 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8799, global_step = 30, loss = 0.48413977
I0814 19:57:11.141812 140535430632896 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 19:57:12.066555 140535430632896 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.48413977, 'global_step': 30, 'accuracy': 0.8799}

Removing gs://yangyou-mnist/log/#1565812433303094...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565812446186033...
Removing gs://yangyou-mnist/log/checkpoint#1565812512024039...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565812433.v3-8-tpu#1565812515314707...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565812445300050...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565812450802735...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565812438205116...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565812509793473...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565812508869139...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565812514234632...
Removing gs://yangyou-mnist/log/eval/#1565812628253137...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565812628.v3-8-tpu#1565812631758601...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 19:57:15.929869 140007964206528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 19:57:15.930665 140007964206528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 19:57:15.933374 140007964206528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 19:57:15.934214 140007964206528 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 19:57:15.934798 140007964206528 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 19:57:15.934936 140007964206528 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 19:57:16.350045 140007964206528 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 19:57:16.358073 140007964206528 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 19:57:16.362674 140007964206528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:57:16.427700 140007964206528 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:57:16.428004 140007964206528 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:57:16.631401 140007964206528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 19:57:16.686301 140007964206528 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 19:57:16.686580 140007964206528 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:57:16.976221 140007964206528 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f55ff223190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5601402210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 19:57:16.976645 140007964206528 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 19:57:17.305718 140007964206528 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 19:57:17.308897: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:57:17.322067 140007964206528 tpu_system_metadata.py:148] Found TPU system:
I0814 19:57:17.322330 140007964206528 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 19:57:17.322925 140007964206528 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 19:57:17.322990 140007964206528 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 19:57:17.323048 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 19:57:17.323364 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 19:57:17.323424 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 19:57:17.323487 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 19:57:17.323537 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 19:57:17.323584 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 19:57:17.323631 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 19:57:17.323677 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 19:57:17.323724 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 19:57:17.323777 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 19:57:17.323827 140007964206528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 19:57:17.329922 140007964206528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 19:57:17.342798 140007964206528 estimator.py:1145] Calling model_fn.
W0814 19:57:17.343409 140007964206528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 19:57:17.611324 140007964206528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 19:57:18.281528 140007964206528 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 19:57:18.342716 140007964206528 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 19:57:18.348714 140007964206528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:57:18.527292 140007964206528 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 19:57:18.541035 140007964206528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 19:57:18.553349 140007964206528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 19:57:18.554388 140007964206528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 19:57:18.561362 140007964206528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 19:57:18.566519 140007964206528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 19:57:18.566749 140007964206528 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 19:57:18.579179 140007964206528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 19:57:18.688313 140007964206528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 19:57:18.729115 140007964206528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:57:18.773854 140007964206528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:57:18.824182 140007964206528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:57:18.983200 140007964206528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:57:19.032232 140007964206528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:57:19.082057 140007964206528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:57:19.135209 140007964206528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:57:19.181587 140007964206528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 19:57:19.223718 140007964206528 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 19:57:19.240458 140007964206528 estimator.py:1147] Done calling model_fn.
I0814 19:57:22.840297 140007964206528 tpu_estimator.py:499] TPU job name worker
I0814 19:57:22.949282 140007964206528 monitored_session.py:240] Graph was finalized.
I0814 19:57:23.608648 140007964206528 session_manager.py:500] Running local_init_op.
I0814 19:57:23.659318 140007964206528 session_manager.py:502] Done running local_init_op.
I0814 19:57:26.502291 140007964206528 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 19:57:38.954843 140007964206528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 19:57:39.103943 140007964206528 util.py:98] Initialized dataset iterators in 0 seconds
I0814 19:57:39.104465 140007964206528 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 19:57:39.104912: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 19:57:39.110389 140007964206528 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 19:57:39.112483 140007964206528 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 19:57:39.116650 140007964206528 tpu_estimator.py:557] Init TPU system
I0814 19:58:20.080924 140007964206528 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 19:58:20.081962 140006932866816 tpu_estimator.py:514] Starting infeed thread controller.
I0814 19:58:20.082345 140006924474112 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 19:58:20.147869 140006916081408 transport.py:157] Attempting refresh to obtain initial access_token
I0814 19:58:20.149832 140007964206528 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 19:58:20.151002 140007964206528 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 19:58:20.416019 140006916081408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 19:58:25.076179 140006924474112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 19:58:29.532430 140007964206528 basic_session_run_hooks.py:262] loss = 0.26569268, step = 30
I0814 19:58:29.534735 140007964206528 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 19:58:43.639890 140007964206528 tpu_estimator.py:598] Stop infeed thread controller
I0814 19:58:43.640216 140007964206528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 19:58:43.641753 140006932866816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 19:58:43.642082 140006932866816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 19:58:43.642374 140007964206528 error_handling.py:96] infeed marked as finished
I0814 19:58:43.642630 140007964206528 tpu_estimator.py:602] Stop output thread controller
I0814 19:58:43.642689 140007964206528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 19:58:43.642925 140006924474112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 19:58:43.643101 140006924474112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 19:58:43.643301 140007964206528 error_handling.py:96] outfeed marked as finished
I0814 19:58:43.643501 140007964206528 tpu_estimator.py:606] Shutdown TPU system.
I0814 19:58:50.558284 140007964206528 estimator.py:368] Loss for final step: 0.26569268.
I0814 19:58:50.559041 140007964206528 error_handling.py:96] training_loop marked as finished
I0814 19:58:51.274921 140007964206528 estimator.py:1145] Calling model_fn.
E0814 19:58:51.976321 140007964206528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 19:58:52.201139 140007964206528 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 19:58:52.223639 140007964206528 estimator.py:1147] Done calling model_fn.
I0814 19:58:52.239881 140007964206528 evaluation.py:255] Starting evaluation at 2019-08-14T19:58:52Z
I0814 19:58:52.240123 140007964206528 tpu_estimator.py:499] TPU job name worker
I0814 19:58:52.318563 140007964206528 monitored_session.py:240] Graph was finalized.
W0814 19:58:52.319317 140007964206528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 19:58:52.511737 140007964206528 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 19:58:55.072833 140007964206528 session_manager.py:500] Running local_init_op.
I0814 19:58:55.097430 140007964206528 session_manager.py:502] Done running local_init_op.
I0814 19:58:55.154800 140007964206528 tpu_estimator.py:557] Init TPU system
I0814 20:00:04.093585 140007964206528 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:00:04.094674 140006929721088 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:00:04.095803 140006921328384 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:00:04.162882 140007964206528 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:00:04.193353 140007964206528 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:00:04.193712 140007964206528 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:00:04.233783 140006912935680 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:00:04.520450 140006912935680 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:00:04.973413 140006921328384 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:00:05.303037 140007964206528 evaluation.py:167] Evaluation [10/10]
I0814 20:00:05.303421 140007964206528 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:00:05.303499 140007964206528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:00:05.303797 140006929721088 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:00:05.304109 140006929721088 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:00:05.304311 140007964206528 error_handling.py:96] infeed marked as finished
I0814 20:00:05.304553 140007964206528 tpu_estimator.py:602] Stop output thread controller
I0814 20:00:05.304613 140007964206528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:00:05.304802 140006921328384 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:00:05.305001 140006921328384 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:00:05.305214 140007964206528 error_handling.py:96] outfeed marked as finished
I0814 20:00:05.305455 140007964206528 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:00:34.614974 140007964206528 evaluation.py:275] Finished evaluation at 2019-08-14-20:00:34
I0814 20:00:34.615360 140007964206528 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9344, global_step = 30, loss = 0.25927562
I0814 20:00:39.058975 140007964206528 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:00:39.893553 140007964206528 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.25927562, 'global_step': 30, 'accuracy': 0.9344}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565812653920002...
Removing gs://yangyou-mnist/log/#1565812640822456...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565812658403896...
Removing gs://yangyou-mnist/log/checkpoint#1565812720060114...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565812716678502...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565812717612206...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565812641.v3-8-tpu#1565812723331767...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565812645883905...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565812653003628...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565812722345606...
Removing gs://yangyou-mnist/log/eval/#1565812836363747...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565812836.v3-8-tpu#1565812839585047...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:00:43.796351 140094830699968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:00:43.797199 140094830699968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:00:43.799809 140094830699968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:00:43.800935 140094830699968 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:00:43.801595 140094830699968 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:00:43.801732 140094830699968 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:00:44.229542 140094830699968 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:00:44.238790 140094830699968 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:00:44.243586 140094830699968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:00:44.297916 140094830699968 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:00:44.298248 140094830699968 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:00:44.599332 140094830699968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:00:44.653639 140094830699968 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:00:44.653906 140094830699968 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:00:45.039973 140094830699968 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f6a38c7b1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f6a3ae5a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:00:45.040391 140094830699968 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:00:45.380305 140094830699968 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:00:45.383182: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:00:45.397017 140094830699968 tpu_system_metadata.py:148] Found TPU system:
I0814 20:00:45.397259 140094830699968 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:00:45.397732 140094830699968 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:00:45.397788 140094830699968 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:00:45.397839 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:00:45.398114 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:00:45.398180 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:00:45.398231 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:00:45.398278 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:00:45.398341 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:00:45.398389 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:00:45.398437 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:00:45.398483 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:00:45.398529 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:00:45.398575 140094830699968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:00:45.404532 140094830699968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:00:45.417117 140094830699968 estimator.py:1145] Calling model_fn.
W0814 20:00:45.417735 140094830699968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:00:45.685204 140094830699968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:00:46.103904 140094830699968 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:00:46.164109 140094830699968 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:00:46.170137 140094830699968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:00:46.349669 140094830699968 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:00:46.363899 140094830699968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:00:46.376499 140094830699968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:00:46.377602 140094830699968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:00:46.385142 140094830699968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:00:46.390383 140094830699968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:00:46.390588 140094830699968 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:00:46.402973 140094830699968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:00:46.511353 140094830699968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:00:46.552822 140094830699968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:00:46.597352 140094830699968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:00:46.647511 140094830699968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:00:46.814862 140094830699968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:00:46.864752 140094830699968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:00:46.912087 140094830699968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:00:46.961031 140094830699968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:00:47.005971 140094830699968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:00:47.047765 140094830699968 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:00:47.063848 140094830699968 estimator.py:1147] Done calling model_fn.
I0814 20:00:50.473825 140094830699968 tpu_estimator.py:499] TPU job name worker
I0814 20:00:50.583885 140094830699968 monitored_session.py:240] Graph was finalized.
I0814 20:00:51.254113 140094830699968 session_manager.py:500] Running local_init_op.
I0814 20:00:51.305464 140094830699968 session_manager.py:502] Done running local_init_op.
I0814 20:00:53.968139 140094830699968 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:01:06.468617 140094830699968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:01:06.628070 140094830699968 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:01:06.628566 140094830699968 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:01:06.628962: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:01:06.634049 140094830699968 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:01:06.636195 140094830699968 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:01:06.639981 140094830699968 tpu_estimator.py:557] Init TPU system
I0814 20:01:48.102714 140094830699968 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 20:01:48.103589 140094068729600 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:01:48.104070 140094060336896 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:01:48.171900 140094830699968 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:01:48.172764 140094830699968 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 20:01:48.219789 140093578802944 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:01:48.395884 140093578802944 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:01:53.006911 140094060336896 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:01:57.497498 140094830699968 basic_session_run_hooks.py:262] loss = 0.17354642, step = 30
I0814 20:01:57.500351 140094830699968 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:02:11.663007 140094830699968 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:02:11.663381 140094830699968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:02:11.664788 140094068729600 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:02:11.665056 140094068729600 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:02:11.665427 140094830699968 error_handling.py:96] infeed marked as finished
I0814 20:02:11.665798 140094830699968 tpu_estimator.py:602] Stop output thread controller
I0814 20:02:11.665872 140094830699968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:02:11.666193 140094060336896 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:02:11.666371 140094060336896 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:02:11.666615 140094830699968 error_handling.py:96] outfeed marked as finished
I0814 20:02:11.666800 140094830699968 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:02:18.541332 140094830699968 estimator.py:368] Loss for final step: 0.17354642.
I0814 20:02:18.542298 140094830699968 error_handling.py:96] training_loop marked as finished
I0814 20:02:19.268193 140094830699968 estimator.py:1145] Calling model_fn.
E0814 20:02:20.171817 140094830699968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:02:20.404016 140094830699968 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:02:20.426225 140094830699968 estimator.py:1147] Done calling model_fn.
I0814 20:02:20.442660 140094830699968 evaluation.py:255] Starting evaluation at 2019-08-14T20:02:20Z
I0814 20:02:20.442903 140094830699968 tpu_estimator.py:499] TPU job name worker
I0814 20:02:20.519581 140094830699968 monitored_session.py:240] Graph was finalized.
W0814 20:02:20.520322 140094830699968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:02:20.710517 140094830699968 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:02:23.523552 140094830699968 session_manager.py:500] Running local_init_op.
I0814 20:02:23.547683 140094830699968 session_manager.py:502] Done running local_init_op.
I0814 20:02:23.597664 140094830699968 tpu_estimator.py:557] Init TPU system
I0814 20:03:32.050982 140094830699968 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:03:32.051950 140094065059584 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:03:32.052622 140093578802944 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:03:32.121445 140094830699968 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:03:32.149415 140094830699968 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:03:32.149763 140094830699968 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:03:32.191431 140093570410240 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:03:32.408037 140093570410240 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:03:32.934480 140093578802944 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:03:33.382704 140094830699968 evaluation.py:167] Evaluation [10/10]
I0814 20:03:33.383054 140094830699968 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:03:33.383152 140094830699968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:03:33.383327 140094065059584 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:03:33.383416 140094065059584 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:03:33.383641 140094830699968 error_handling.py:96] infeed marked as finished
I0814 20:03:33.383744 140094830699968 tpu_estimator.py:602] Stop output thread controller
I0814 20:03:33.383793 140094830699968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:03:33.383904 140093578802944 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:03:33.383976 140093578802944 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:03:33.384099 140094830699968 error_handling.py:96] outfeed marked as finished
I0814 20:03:33.384177 140094830699968 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:04:02.509754 140094830699968 evaluation.py:275] Finished evaluation at 2019-08-14-20:04:02
I0814 20:04:02.510121 140094830699968 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9526, global_step = 30, loss = 0.16533431
I0814 20:04:07.789722 140094830699968 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:04:08.636945 140094830699968 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.16533431, 'global_step': 30, 'accuracy': 0.9526}

Removing gs://yangyou-mnist/log/#1565812848535080...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565812861500503...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565812865953575...
Removing gs://yangyou-mnist/log/checkpoint#1565812927795352...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565812924748460...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565812848.v3-8-tpu#1565812931355883...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565812925632769...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565812853389223...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565812860620325...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565812930337703...
Removing gs://yangyou-mnist/log/eval/#1565813044198628...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565813044.v3-8-tpu#1565813048325943...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:04:12.500669 140249144133056 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:04:12.501507 140249144133056 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:04:12.504127 140249144133056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:04:12.504996 140249144133056 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:04:12.505604 140249144133056 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:04:12.505728 140249144133056 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:04:12.920443 140249144133056 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:04:12.927917 140249144133056 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:04:12.931932 140249144133056 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:04:12.984114 140249144133056 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:04:12.984436 140249144133056 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:04:13.250236 140249144133056 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:04:13.304121 140249144133056 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:04:13.304469 140249144133056 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:04:13.596791 140249144133056 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8e26926250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8e28b1c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:04:13.597172 140249144133056 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:04:13.917664 140249144133056 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:04:13.920576: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:04:13.932215 140249144133056 tpu_system_metadata.py:148] Found TPU system:
I0814 20:04:13.932579 140249144133056 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:04:13.933111 140249144133056 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:04:13.933172 140249144133056 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:04:13.933228 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:04:13.933526 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:04:13.933584 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:04:13.933635 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:04:13.933685 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:04:13.933732 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:04:13.933778 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:04:13.933825 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:04:13.933871 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:04:13.933917 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:04:13.933969 140249144133056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:04:13.940133 140249144133056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:04:13.952615 140249144133056 estimator.py:1145] Calling model_fn.
W0814 20:04:13.953234 140249144133056 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:04:14.219531 140249144133056 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:04:14.999597 140249144133056 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:04:15.060775 140249144133056 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:04:15.066426 140249144133056 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:04:15.245418 140249144133056 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:04:15.259450 140249144133056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:04:15.271682 140249144133056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:04:15.272836 140249144133056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:04:15.279766 140249144133056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:04:15.284980 140249144133056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:04:15.285178 140249144133056 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:04:15.297346 140249144133056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:04:15.410586 140249144133056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:04:15.452366 140249144133056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:04:15.496875 140249144133056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:04:15.549446 140249144133056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:04:15.722014 140249144133056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:04:15.773185 140249144133056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:04:15.821733 140249144133056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:04:15.872101 140249144133056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:04:15.917639 140249144133056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:04:15.959654 140249144133056 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:04:15.976202 140249144133056 estimator.py:1147] Done calling model_fn.
I0814 20:04:19.516985 140249144133056 tpu_estimator.py:499] TPU job name worker
I0814 20:04:19.629393 140249144133056 monitored_session.py:240] Graph was finalized.
I0814 20:04:20.291424 140249144133056 session_manager.py:500] Running local_init_op.
I0814 20:04:20.352468 140249144133056 session_manager.py:502] Done running local_init_op.
I0814 20:04:23.191929 140249144133056 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:04:36.119235 140249144133056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:04:36.282459 140249144133056 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:04:36.282919 140249144133056 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:04:36.283328: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:04:36.287976 140249144133056 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:04:36.290237 140249144133056 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:04:36.295433 140249144133056 tpu_estimator.py:557] Init TPU system
I0814 20:05:16.108023 140249144133056 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 20:05:16.109167 140248239556352 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:05:16.110018 140248231163648 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:05:16.174249 140249144133056 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:05:16.175976 140249144133056 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 20:05:16.179975 140248222770944 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:05:16.489037 140248222770944 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 20:05:20.945415 140248231163648 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:05:25.251496 140249144133056 basic_session_run_hooks.py:262] loss = 0.12816067, step = 30
I0814 20:05:25.253966 140249144133056 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:05:41.329940 140249144133056 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:05:41.330238 140249144133056 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:05:41.330466 140248239556352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:05:41.330559 140248239556352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:05:41.330694 140249144133056 error_handling.py:96] infeed marked as finished
I0814 20:05:41.330787 140249144133056 tpu_estimator.py:602] Stop output thread controller
I0814 20:05:41.330842 140249144133056 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:05:41.330950 140248231163648 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:05:41.331031 140248231163648 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:05:41.331139 140249144133056 error_handling.py:96] outfeed marked as finished
I0814 20:05:41.331218 140249144133056 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:05:46.622585 140249144133056 estimator.py:368] Loss for final step: 0.12816067.
I0814 20:05:46.623363 140249144133056 error_handling.py:96] training_loop marked as finished
I0814 20:05:47.536933 140249144133056 estimator.py:1145] Calling model_fn.
E0814 20:05:48.255034 140249144133056 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:05:48.493802 140249144133056 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:05:48.516563 140249144133056 estimator.py:1147] Done calling model_fn.
I0814 20:05:48.534029 140249144133056 evaluation.py:255] Starting evaluation at 2019-08-14T20:05:48Z
I0814 20:05:48.534254 140249144133056 tpu_estimator.py:499] TPU job name worker
I0814 20:05:48.614623 140249144133056 monitored_session.py:240] Graph was finalized.
W0814 20:05:48.615374 140249144133056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:05:48.807105 140249144133056 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:05:51.794591 140249144133056 session_manager.py:500] Running local_init_op.
I0814 20:05:51.823955 140249144133056 session_manager.py:502] Done running local_init_op.
I0814 20:05:51.879771 140249144133056 tpu_estimator.py:557] Init TPU system
I0814 20:07:00.092350 140249144133056 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:07:00.093286 140248239556352 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:07:00.093780 140248231163648 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:07:00.160729 140249144133056 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:07:00.183854 140249144133056 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:07:00.184169 140249144133056 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:07:00.221981 140248222770944 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:07:00.587357 140248222770944 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:07:00.952841 140248231163648 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:07:01.378180 140249144133056 evaluation.py:167] Evaluation [10/10]
I0814 20:07:01.378519 140249144133056 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:07:01.378597 140249144133056 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:07:01.378782 140248239556352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:07:01.378880 140248239556352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:07:01.379014 140249144133056 error_handling.py:96] infeed marked as finished
I0814 20:07:01.379106 140249144133056 tpu_estimator.py:602] Stop output thread controller
I0814 20:07:01.379163 140249144133056 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:07:01.379281 140248231163648 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:07:01.379355 140248231163648 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:07:01.379470 140249144133056 error_handling.py:96] outfeed marked as finished
I0814 20:07:01.379547 140249144133056 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:07:30.686753 140249144133056 evaluation.py:275] Finished evaluation at 2019-08-14-20:07:30
I0814 20:07:30.687060 140249144133056 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9706, global_step = 30, loss = 0.103746474
I0814 20:07:35.335119 140249144133056 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:07:36.127670 140249144133056 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.103746474, 'global_step': 30, 'accuracy': 0.9706}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565813071244441...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565813075603240...
Removing gs://yangyou-mnist/log/#1565813057484934...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565813057.v3-8-tpu#1565813141015028...
Removing gs://yangyou-mnist/log/checkpoint#1565813135347710...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565813132263664...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565813133119264...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565813062586023...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565813070218167...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565813139997337...
Removing gs://yangyou-mnist/log/eval/#1565813252358652...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565813252.v3-8-tpu#1565813255816557...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:07:39.970531 139737442928064 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:07:39.971338 139737442928064 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:07:39.974082 139737442928064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:07:39.974942 139737442928064 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:07:39.975560 139737442928064 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:07:39.975693 139737442928064 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:07:40.402643 139737442928064 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:07:40.409832 139737442928064 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:07:40.413723 139737442928064 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:07:40.465121 139737442928064 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:07:40.465414 139737442928064 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:07:40.717430 139737442928064 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:07:40.770541 139737442928064 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:07:40.770814 139737442928064 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:07:41.033597 139737442928064 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1702cf11d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1704ed0210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:07:41.033962 139737442928064 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:07:41.360173 139737442928064 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:07:41.362927: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:07:41.376096 139737442928064 tpu_system_metadata.py:148] Found TPU system:
I0814 20:07:41.376378 139737442928064 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:07:41.376929 139737442928064 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:07:41.376991 139737442928064 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:07:41.377043 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:07:41.377338 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:07:41.377394 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:07:41.377444 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:07:41.377491 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:07:41.377538 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:07:41.377584 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:07:41.377634 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:07:41.377680 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:07:41.377732 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:07:41.377784 139737442928064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:07:41.383680 139737442928064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:07:41.395932 139737442928064 estimator.py:1145] Calling model_fn.
W0814 20:07:41.396565 139737442928064 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:07:41.668669 139737442928064 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:07:42.273570 139737442928064 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:07:42.334630 139737442928064 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:07:42.340760 139737442928064 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:07:42.520576 139737442928064 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:07:42.534149 139737442928064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:07:42.545969 139737442928064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:07:42.547019 139737442928064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:07:42.554306 139737442928064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:07:42.559550 139737442928064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:07:42.559768 139737442928064 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:07:42.572237 139737442928064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:07:42.681360 139737442928064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:07:42.722687 139737442928064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:07:42.766729 139737442928064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:07:42.817429 139737442928064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:07:42.983539 139737442928064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:07:43.033066 139737442928064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:07:43.080070 139737442928064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:07:43.129650 139737442928064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:07:43.173954 139737442928064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:07:43.214554 139737442928064 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:07:43.230545 139737442928064 estimator.py:1147] Done calling model_fn.
I0814 20:07:47.042510 139737442928064 tpu_estimator.py:499] TPU job name worker
I0814 20:07:47.154838 139737442928064 monitored_session.py:240] Graph was finalized.
I0814 20:07:47.869189 139737442928064 session_manager.py:500] Running local_init_op.
I0814 20:07:47.930201 139737442928064 session_manager.py:502] Done running local_init_op.
I0814 20:07:50.690928 139737442928064 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:08:03.412333 139737442928064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:08:03.557224 139737442928064 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:08:03.557671 139737442928064 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:08:03.558087: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:08:03.562944 139737442928064 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:08:03.565320 139737442928064 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:08:03.570426 139737442928064 tpu_estimator.py:557] Init TPU system
I0814 20:08:44.044843 139737442928064 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 20:08:44.045727 139736542861056 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:08:44.046207 139736534468352 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:08:44.109857 139736526075648 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:08:44.110521 139737442928064 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:08:44.111596 139737442928064 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 20:08:44.387322 139736526075648 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:08:48.947063 139736534468352 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:08:53.400770 139737442928064 basic_session_run_hooks.py:262] loss = 0.07904637, step = 30
I0814 20:08:53.403393 139737442928064 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:09:08.339015 139737442928064 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:09:08.339318 139737442928064 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:09:08.339514 139736542861056 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:09:08.339610 139736542861056 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:09:08.339756 139737442928064 error_handling.py:96] infeed marked as finished
I0814 20:09:08.339862 139737442928064 tpu_estimator.py:602] Stop output thread controller
I0814 20:09:08.339912 139737442928064 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:09:08.340043 139736534468352 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:09:08.340112 139736534468352 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:09:08.340229 139737442928064 error_handling.py:96] outfeed marked as finished
I0814 20:09:08.340301 139737442928064 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:09:14.523375 139737442928064 estimator.py:368] Loss for final step: 0.07904637.
I0814 20:09:14.524229 139737442928064 error_handling.py:96] training_loop marked as finished
I0814 20:09:15.295243 139737442928064 estimator.py:1145] Calling model_fn.
E0814 20:09:15.979882 139737442928064 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:09:16.204324 139737442928064 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:09:16.234457 139737442928064 estimator.py:1147] Done calling model_fn.
I0814 20:09:16.253724 139737442928064 evaluation.py:255] Starting evaluation at 2019-08-14T20:09:16Z
I0814 20:09:16.253961 139737442928064 tpu_estimator.py:499] TPU job name worker
I0814 20:09:16.331971 139737442928064 monitored_session.py:240] Graph was finalized.
W0814 20:09:16.332746 139737442928064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:09:16.528265 139737442928064 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:09:19.423141 139737442928064 session_manager.py:500] Running local_init_op.
I0814 20:09:19.448744 139737442928064 session_manager.py:502] Done running local_init_op.
I0814 20:09:19.499260 139737442928064 tpu_estimator.py:557] Init TPU system
I0814 20:10:28.080116 139737442928064 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:10:28.081345 139736542861056 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:10:28.082154 139736534468352 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:10:28.149666 139737442928064 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:10:28.175854 139737442928064 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:10:28.176240 139737442928064 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:10:28.212913 139736526075648 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:10:28.483258 139736526075648 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:10:28.972794 139736534468352 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:10:29.325546 139737442928064 evaluation.py:167] Evaluation [10/10]
I0814 20:10:29.325891 139737442928064 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:10:29.325970 139737442928064 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:10:29.326250 139736542861056 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:10:29.326529 139736542861056 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:10:29.326823 139737442928064 error_handling.py:96] infeed marked as finished
I0814 20:10:29.327042 139737442928064 tpu_estimator.py:602] Stop output thread controller
I0814 20:10:29.327102 139737442928064 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:10:29.327271 139736534468352 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:10:29.327428 139736534468352 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:10:29.327733 139737442928064 error_handling.py:96] outfeed marked as finished
I0814 20:10:29.327919 139737442928064 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:10:58.582938 139737442928064 evaluation.py:275] Finished evaluation at 2019-08-14-20:10:58
I0814 20:10:58.583301 139737442928064 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9766, global_step = 30, loss = 0.07573997
I0814 20:11:03.161508 139737442928064 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:11:04.062483 139737442928064 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07573997, 'global_step': 30, 'accuracy': 0.9766}

Removing gs://yangyou-mnist/log/#1565813264868548...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565813265.v3-8-tpu#1565813348034831...
Removing gs://yangyou-mnist/log/checkpoint#1565813343914529...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565813278375892...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565813270107670...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565813282898154...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565813277324824...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565813340563689...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565813341513070...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565813347085143...
Removing gs://yangyou-mnist/log/eval/#1565813460310361...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565813460.v3-8-tpu#1565813463735703...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:11:07.991108 140120922600896 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:11:07.991910 140120922600896 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:11:07.994560 140120922600896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:11:07.995403 140120922600896 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:11:07.995981 140120922600896 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:11:07.996113 140120922600896 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:11:08.413439 140120922600896 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:11:08.420057 140120922600896 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:11:08.423679 140120922600896 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:11:08.481368 140120922600896 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:11:08.481652 140120922600896 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:11:08.788587 140120922600896 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:11:08.844369 140120922600896 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:11:08.844732 140120922600896 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:11:09.119844 140120922600896 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f704bfa8190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f704e1871d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:11:09.120254 140120922600896 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:11:09.446146 140120922600896 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:11:09.449042: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:11:09.460515 140120922600896 tpu_system_metadata.py:148] Found TPU system:
I0814 20:11:09.460763 140120922600896 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:11:09.461265 140120922600896 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:11:09.461330 140120922600896 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:11:09.461384 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:11:09.461672 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:11:09.461729 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:11:09.461779 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:11:09.461842 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:11:09.461911 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:11:09.461957 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:11:09.462009 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:11:09.462057 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:11:09.462101 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:11:09.462151 140120922600896 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:11:09.468234 140120922600896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:11:09.480932 140120922600896 estimator.py:1145] Calling model_fn.
W0814 20:11:09.481532 140120922600896 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:11:09.750746 140120922600896 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:11:10.522494 140120922600896 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:11:10.586709 140120922600896 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:11:10.592881 140120922600896 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:11:10.776602 140120922600896 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:11:10.790210 140120922600896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:11:10.802294 140120922600896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:11:10.803330 140120922600896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:11:10.810312 140120922600896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:11:10.815510 140120922600896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:11:10.815723 140120922600896 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:11:10.828075 140120922600896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:11:10.937458 140120922600896 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:11:10.979150 140120922600896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:11:11.025022 140120922600896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:11:11.076350 140120922600896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:11:11.245973 140120922600896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:11:11.304352 140120922600896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:11:11.352869 140120922600896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:11:11.403822 140120922600896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:11:11.450309 140120922600896 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:11:11.491113 140120922600896 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:11:11.507339 140120922600896 estimator.py:1147] Done calling model_fn.
I0814 20:11:15.051788 140120922600896 tpu_estimator.py:499] TPU job name worker
I0814 20:11:15.172585 140120922600896 monitored_session.py:240] Graph was finalized.
I0814 20:11:15.880268 140120922600896 session_manager.py:500] Running local_init_op.
I0814 20:11:15.928168 140120922600896 session_manager.py:502] Done running local_init_op.
I0814 20:11:18.752988 140120922600896 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:11:31.174886 140120922600896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:11:31.317668 140120922600896 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:11:31.318167 140120922600896 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:11:31.318587: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:11:31.323625 140120922600896 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:11:31.326005 140120922600896 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:11:31.329884 140120922600896 tpu_estimator.py:557] Init TPU system
I0814 20:12:12.122123 140120922600896 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 20:12:12.123066 140119885477632 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:12:12.123557 140119877084928 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:12:12.185355 140119868692224 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:12:12.188996 140120922600896 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:12:12.190152 140120922600896 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 20:12:12.669353 140119868692224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 20:12:16.886059 140119877084928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:12:21.630619 140120922600896 basic_session_run_hooks.py:262] loss = 0.072505176, step = 30
I0814 20:12:21.633388 140120922600896 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:12:35.689402 140120922600896 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:12:35.689724 140120922600896 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:12:35.691457 140119885477632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:12:35.691904 140119885477632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:12:35.692255 140120922600896 error_handling.py:96] infeed marked as finished
I0814 20:12:35.692578 140120922600896 tpu_estimator.py:602] Stop output thread controller
I0814 20:12:35.692646 140120922600896 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:12:35.692852 140119877084928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:12:35.693070 140119877084928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:12:35.693298 140120922600896 error_handling.py:96] outfeed marked as finished
I0814 20:12:35.693500 140120922600896 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:12:42.811872 140120922600896 estimator.py:368] Loss for final step: 0.072505176.
I0814 20:12:42.813445 140120922600896 error_handling.py:96] training_loop marked as finished
I0814 20:12:43.554927 140120922600896 estimator.py:1145] Calling model_fn.
E0814 20:12:46.686070 140120922600896 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:12:46.909050 140120922600896 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:12:46.930886 140120922600896 estimator.py:1147] Done calling model_fn.
I0814 20:12:46.948309 140120922600896 evaluation.py:255] Starting evaluation at 2019-08-14T20:12:46Z
I0814 20:12:46.948596 140120922600896 tpu_estimator.py:499] TPU job name worker
I0814 20:12:47.027440 140120922600896 monitored_session.py:240] Graph was finalized.
W0814 20:12:47.028245 140120922600896 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:12:47.224697 140120922600896 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:12:50.044631 140120922600896 session_manager.py:500] Running local_init_op.
I0814 20:12:50.076281 140120922600896 session_manager.py:502] Done running local_init_op.
I0814 20:12:50.123971 140120922600896 tpu_estimator.py:557] Init TPU system
I0814 20:13:56.049840 140120922600896 tpu_estimator.py:566] Initialized TPU in 65 seconds
I0814 20:13:56.050844 140119885477632 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:13:56.051285 140119877084928 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:13:56.119338 140120922600896 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:13:56.143877 140120922600896 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:13:56.144243 140120922600896 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:13:56.182117 140119868692224 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:13:56.554382 140119868692224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:13:56.953032 140119877084928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:13:57.209230 140120922600896 evaluation.py:167] Evaluation [10/10]
I0814 20:13:57.209583 140120922600896 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:13:57.209660 140120922600896 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:13:57.209994 140119885477632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:13:57.210179 140119885477632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:13:57.210402 140120922600896 error_handling.py:96] infeed marked as finished
I0814 20:13:57.210501 140120922600896 tpu_estimator.py:602] Stop output thread controller
I0814 20:13:57.210551 140120922600896 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:13:57.210664 140119877084928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:13:57.210753 140119877084928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:13:57.210870 140120922600896 error_handling.py:96] outfeed marked as finished
I0814 20:13:57.210948 140120922600896 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:14:26.636313 140120922600896 evaluation.py:275] Finished evaluation at 2019-08-14-20:14:26
I0814 20:14:26.636689 140120922600896 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9805, global_step = 30, loss = 0.055549957
I0814 20:14:31.105707 140120922600896 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:14:31.919765 140120922600896 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.055549957, 'global_step': 30, 'accuracy': 0.9805}

Removing gs://yangyou-mnist/log/#1565813473044598...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565813486237351...
Removing gs://yangyou-mnist/log/checkpoint#1565813552057832...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565813490655120...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565813473.v3-8-tpu#1565813555381817...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565813478173720...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565813485357893...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565813548885988...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565813549775237...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565813554357191...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565813668326602...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565813668.v3-8-tpu#1565813671610573...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:14:35.826628 139988843525568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:14:35.827406 139988843525568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:14:35.830092 139988843525568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:14:35.830930 139988843525568 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:14:35.831509 139988843525568 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:14:35.831636 139988843525568 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:14:36.245728 139988843525568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:14:36.252057 139988843525568 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:14:36.255752 139988843525568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:14:36.370654 139988843525568 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:14:36.370927 139988843525568 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:14:36.866972 139988843525568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:14:36.920160 139988843525568 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:14:36.920512 139988843525568 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:14:37.281322 139988843525568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f518b73c110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f518d91b1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:14:37.281670 139988843525568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:14:37.602535 139988843525568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:14:37.605566: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:14:37.619829 139988843525568 tpu_system_metadata.py:148] Found TPU system:
I0814 20:14:37.620068 139988843525568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:14:37.620647 139988843525568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:14:37.620713 139988843525568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:14:37.620768 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:14:37.621114 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:14:37.621181 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:14:37.621239 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:14:37.621289 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:14:37.621336 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:14:37.621386 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:14:37.621433 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:14:37.621479 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:14:37.621524 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:14:37.621572 139988843525568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:14:37.627842 139988843525568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:14:37.640979 139988843525568 estimator.py:1145] Calling model_fn.
W0814 20:14:37.641602 139988843525568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:14:37.908780 139988843525568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:14:38.485553 139988843525568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:14:38.547924 139988843525568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:14:38.553939 139988843525568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:14:38.738635 139988843525568 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:14:38.752834 139988843525568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:14:38.765464 139988843525568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:14:38.766541 139988843525568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:14:38.774422 139988843525568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:14:38.780117 139988843525568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:14:38.780361 139988843525568 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:14:38.793879 139988843525568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:14:38.910290 139988843525568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:14:38.959350 139988843525568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:14:39.005937 139988843525568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:14:39.063127 139988843525568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:14:39.236824 139988843525568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:14:39.295914 139988843525568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:14:39.345644 139988843525568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:14:39.398047 139988843525568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:14:39.446417 139988843525568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:14:39.488625 139988843525568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:14:39.505419 139988843525568 estimator.py:1147] Done calling model_fn.
I0814 20:14:42.974009 139988843525568 tpu_estimator.py:499] TPU job name worker
I0814 20:14:43.095593 139988843525568 monitored_session.py:240] Graph was finalized.
I0814 20:14:43.785242 139988843525568 session_manager.py:500] Running local_init_op.
I0814 20:14:43.847503 139988843525568 session_manager.py:502] Done running local_init_op.
I0814 20:14:46.644340 139988843525568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:14:59.212878 139988843525568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:14:59.371978 139988843525568 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:14:59.372637 139988843525568 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:14:59.373097: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:14:59.377748 139988843525568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:14:59.379889 139988843525568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:14:59.383363 139988843525568 tpu_estimator.py:557] Init TPU system
I0814 20:15:40.104863 139988843525568 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 20:15:40.105983 139987806840576 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:15:40.106796 139987798447872 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:15:40.174168 139988843525568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:15:40.175745 139988843525568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 20:15:40.176382 139987790055168 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:15:40.385312 139987790055168 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 20:15:44.930217 139987798447872 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:15:49.482834 139988843525568 basic_session_run_hooks.py:262] loss = 1.3523884, step = 30
I0814 20:15:49.485384 139988843525568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:16:03.657248 139988843525568 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:16:03.657648 139988843525568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:16:03.659317 139987806840576 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:16:03.659456 139987806840576 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:16:03.659617 139988843525568 error_handling.py:96] infeed marked as finished
I0814 20:16:03.659759 139988843525568 tpu_estimator.py:602] Stop output thread controller
I0814 20:16:03.659836 139988843525568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:16:03.660026 139987798447872 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:16:03.660115 139987798447872 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:16:03.660233 139988843525568 error_handling.py:96] outfeed marked as finished
I0814 20:16:03.660332 139988843525568 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:16:10.533335 139988843525568 estimator.py:368] Loss for final step: 1.3523884.
I0814 20:16:10.534198 139988843525568 error_handling.py:96] training_loop marked as finished
I0814 20:16:11.269565 139988843525568 estimator.py:1145] Calling model_fn.
E0814 20:16:12.132110 139988843525568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:16:12.364811 139988843525568 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:16:12.387090 139988843525568 estimator.py:1147] Done calling model_fn.
I0814 20:16:12.403906 139988843525568 evaluation.py:255] Starting evaluation at 2019-08-14T20:16:12Z
I0814 20:16:12.404165 139988843525568 tpu_estimator.py:499] TPU job name worker
I0814 20:16:12.482065 139988843525568 monitored_session.py:240] Graph was finalized.
W0814 20:16:12.482827 139988843525568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:16:12.683670 139988843525568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:16:15.389341 139988843525568 session_manager.py:500] Running local_init_op.
I0814 20:16:15.417680 139988843525568 session_manager.py:502] Done running local_init_op.
I0814 20:16:15.478590 139988843525568 tpu_estimator.py:557] Init TPU system
I0814 20:17:24.113579 139988843525568 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:17:24.114425 139987806840576 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:17:24.114870 139987798447872 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:17:24.184864 139988843525568 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:17:24.212662 139988843525568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:17:24.212991 139988843525568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:17:24.305197 139987790055168 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:17:24.622220 139987790055168 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:17:25.004168 139987798447872 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:17:25.435208 139988843525568 evaluation.py:167] Evaluation [10/10]
I0814 20:17:25.435547 139988843525568 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:17:25.435614 139988843525568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:17:25.435875 139987806840576 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:17:25.435992 139987806840576 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:17:25.436131 139988843525568 error_handling.py:96] infeed marked as finished
I0814 20:17:25.436228 139988843525568 tpu_estimator.py:602] Stop output thread controller
I0814 20:17:25.436280 139988843525568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:17:25.436389 139987798447872 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:17:25.436649 139987798447872 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:17:25.436783 139988843525568 error_handling.py:96] outfeed marked as finished
I0814 20:17:25.436867 139988843525568 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:17:54.704171 139988843525568 evaluation.py:275] Finished evaluation at 2019-08-14-20:17:54
I0814 20:17:54.704557 139988843525568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7185, global_step = 30, loss = 1.0221089
I0814 20:17:59.350634 139988843525568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:18:00.271778 139988843525568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.0221089, 'global_step': 30, 'accuracy': 0.7185}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565813694063769...
Removing gs://yangyou-mnist/log/#1565813681049361...
Removing gs://yangyou-mnist/log/checkpoint#1565813759839198...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565813681.v3-8-tpu#1565813763276208...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565813698702517...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565813686066590...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565813756624994...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565813693080781...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565813757560459...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565813762233696...
Removing gs://yangyou-mnist/log/eval/#1565813876436783...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565813876.v3-8-tpu#1565813879945799...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:18:04.265872 139786922235328 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:18:04.266716 139786922235328 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:18:04.269452 139786922235328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:18:04.270301 139786922235328 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:18:04.270922 139786922235328 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:18:04.271060 139786922235328 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:18:04.703708 139786922235328 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:18:04.711049 139786922235328 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:18:04.715050 139786922235328 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:18:04.773467 139786922235328 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:18:04.773765 139786922235328 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:18:05.181760 139786922235328 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:18:05.287281 139786922235328 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:18:05.287647 139786922235328 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:18:05.535203 139786922235328 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f22880160d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f228a1f51d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:18:05.535604 139786922235328 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:18:05.872920 139786922235328 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:18:05.875888: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:18:05.887801 139786922235328 tpu_system_metadata.py:148] Found TPU system:
I0814 20:18:05.888082 139786922235328 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:18:05.888670 139786922235328 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:18:05.888731 139786922235328 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:18:05.888783 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:18:05.889092 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:18:05.889148 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:18:05.889199 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:18:05.889246 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:18:05.889300 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:18:05.889353 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:18:05.889400 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:18:05.889445 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:18:05.889491 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:18:05.889555 139786922235328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:18:05.895663 139786922235328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:18:05.908389 139786922235328 estimator.py:1145] Calling model_fn.
W0814 20:18:05.909106 139786922235328 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:18:06.188882 139786922235328 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:18:06.892847 139786922235328 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:18:06.955554 139786922235328 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:18:06.961718 139786922235328 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:18:07.143184 139786922235328 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:18:07.156960 139786922235328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:18:07.169572 139786922235328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:18:07.170677 139786922235328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:18:07.177732 139786922235328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:18:07.183060 139786922235328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:18:07.183295 139786922235328 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:18:07.196320 139786922235328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:18:07.316178 139786922235328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:18:07.358475 139786922235328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:18:07.403774 139786922235328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:18:07.456434 139786922235328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:18:07.637046 139786922235328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:18:07.688268 139786922235328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:18:07.737709 139786922235328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:18:07.788222 139786922235328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:18:07.833710 139786922235328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:18:07.875224 139786922235328 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:18:07.892154 139786922235328 estimator.py:1147] Done calling model_fn.
I0814 20:18:11.590462 139786922235328 tpu_estimator.py:499] TPU job name worker
I0814 20:18:11.703330 139786922235328 monitored_session.py:240] Graph was finalized.
I0814 20:18:12.395963 139786922235328 session_manager.py:500] Running local_init_op.
I0814 20:18:12.456795 139786922235328 session_manager.py:502] Done running local_init_op.
I0814 20:18:15.257977 139786922235328 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:18:28.158873 139786922235328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:18:28.324342 139786922235328 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:18:28.324867 139786922235328 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:18:28.325289: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:18:28.330077 139786922235328 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:18:28.332267 139786922235328 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:18:28.336482 139786922235328 tpu_estimator.py:557] Init TPU system
I0814 20:19:08.124083 139786922235328 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 20:19:08.125073 139785884661504 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:19:08.125552 139785876268800 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:19:08.192552 139785867876096 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:19:08.193279 139786922235328 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:19:08.194369 139786922235328 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 20:19:08.459831 139785867876096 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 20:19:12.962843 139785876268800 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:19:17.914586 139786922235328 basic_session_run_hooks.py:262] loss = 4.4624076, step = 30
I0814 20:19:17.916625 139786922235328 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:19:32.549863 139786922235328 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:19:32.550224 139786922235328 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:19:32.551712 139785884661504 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:19:32.551938 139785884661504 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:19:32.552146 139786922235328 error_handling.py:96] infeed marked as finished
I0814 20:19:32.552329 139786922235328 tpu_estimator.py:602] Stop output thread controller
I0814 20:19:32.552395 139786922235328 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:19:32.552571 139785876268800 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:19:32.552663 139785876268800 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:19:32.552886 139786922235328 error_handling.py:96] outfeed marked as finished
I0814 20:19:32.552990 139786922235328 tpu_estimator.py:606] Shutdown TPU system.
Removing gs://yangyou-mnist/log/#1565813889456270...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565813902078650...
Removing gs://yangyou-mnist/log/checkpoint#1565813968850947...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565813902973345...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565813894663111...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565813889.v3-8-tpu#1565813972229992...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565813966505061...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565813965479483...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565813971250682...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565813907635164...
/ [1/10 objects]  10% Done                                                      / [2/10 objects]  20% Done                                                      / [3/10 objects]  30% Done                                                      / [4/10 objects]  40% Done                                                      / [5/10 objects]  50% Done                                                      / [6/10 objects]  60% Done                                                      / [7/10 objects]  70% Done                                                      / [8/10 objects]  80% Done                                                      / [9/10 objects]  90% Done                                                      / [10/10 objects] 100% Done                                                     
Operation completed over 10 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:21:39.790488 140292210890176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:21:39.791538 140292210890176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:21:39.794122 140292210890176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:21:39.794930 140292210890176 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:21:39.795504 140292210890176 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:21:39.795629 140292210890176 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:21:40.207477 140292210890176 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:21:40.215604 140292210890176 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:21:40.219706 140292210890176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:21:40.276798 140292210890176 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:21:40.277111 140292210890176 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:21:40.480756 140292210890176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:21:40.534452 140292210890176 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:21:40.534739 140292210890176 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:21:40.808660 140292210890176 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f982d8e61d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f982fac5210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:21:40.809020 140292210890176 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:21:41.145098 140292210890176 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:21:41.147805: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:21:41.159589 140292210890176 tpu_system_metadata.py:148] Found TPU system:
I0814 20:21:41.159816 140292210890176 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:21:41.160293 140292210890176 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:21:41.160350 140292210890176 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:21:41.160444 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:21:41.160845 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:21:41.160912 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:21:41.160964 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:21:41.161012 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:21:41.161077 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:21:41.161133 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:21:41.161180 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:21:41.161226 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:21:41.161273 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:21:41.161319 140292210890176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:21:41.167150 140292210890176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:21:41.179768 140292210890176 estimator.py:1145] Calling model_fn.
W0814 20:21:41.180424 140292210890176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:21:41.449232 140292210890176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:21:42.196084 140292210890176 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:21:42.258246 140292210890176 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:21:42.264379 140292210890176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:21:42.441852 140292210890176 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:21:42.455687 140292210890176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:21:42.467578 140292210890176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:21:42.468647 140292210890176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:21:42.475516 140292210890176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:21:42.480680 140292210890176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:21:42.480884 140292210890176 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:21:42.493679 140292210890176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:21:42.602034 140292210890176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:21:42.644081 140292210890176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:21:42.687853 140292210890176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:21:42.739173 140292210890176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:21:42.900279 140292210890176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:21:42.950853 140292210890176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:21:42.998938 140292210890176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:21:43.049978 140292210890176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:21:43.096299 140292210890176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:21:43.138041 140292210890176 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:21:43.154833 140292210890176 estimator.py:1147] Done calling model_fn.
I0814 20:21:46.788192 140292210890176 tpu_estimator.py:499] TPU job name worker
I0814 20:21:46.896281 140292210890176 monitored_session.py:240] Graph was finalized.
I0814 20:21:48.543812 140292210890176 session_manager.py:500] Running local_init_op.
I0814 20:21:48.602839 140292210890176 session_manager.py:502] Done running local_init_op.
I0814 20:21:51.389292 140292210890176 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:22:04.672425 140292210890176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:22:04.814320 140292210890176 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:22:04.814851 140292210890176 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:22:04.815293: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:22:04.820157 140292210890176 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:22:04.822324 140292210890176 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:22:04.826085 140292210890176 tpu_estimator.py:557] Init TPU system
I0814 20:22:10.807851 140292210890176 tpu_estimator.py:566] Initialized TPU in 5 seconds
I0814 20:22:10.808738 140291314534144 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:22:10.809223 140291306141440 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:22:10.872956 140292210890176 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:22:10.873780 140292210890176 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 20:22:10.943475 140291297748736 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:22:11.247437 140291297748736 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:22:15.823575 140291306141440 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:22:20.384536 140292210890176 basic_session_run_hooks.py:262] loss = 0.071486905, step = 30
I0814 20:22:20.387578 140292210890176 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:22:34.654145 140292210890176 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:22:34.654510 140292210890176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:22:34.654881 140291314534144 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:22:34.655199 140291314534144 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:22:34.655428 140292210890176 error_handling.py:96] infeed marked as finished
I0814 20:22:34.655622 140292210890176 tpu_estimator.py:602] Stop output thread controller
I0814 20:22:34.655677 140292210890176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:22:34.655986 140291306141440 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:22:34.656199 140291306141440 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:22:34.656444 140292210890176 error_handling.py:96] outfeed marked as finished
I0814 20:22:34.656625 140292210890176 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:22:41.364058 140292210890176 estimator.py:368] Loss for final step: 0.071486905.
I0814 20:22:41.364964 140292210890176 error_handling.py:96] training_loop marked as finished
I0814 20:22:42.188720 140292210890176 estimator.py:1145] Calling model_fn.
E0814 20:22:42.894556 140292210890176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:22:43.122697 140292210890176 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:22:43.145730 140292210890176 estimator.py:1147] Done calling model_fn.
I0814 20:22:43.162889 140292210890176 evaluation.py:255] Starting evaluation at 2019-08-14T20:22:43Z
I0814 20:22:43.163146 140292210890176 tpu_estimator.py:499] TPU job name worker
I0814 20:22:43.245480 140292210890176 monitored_session.py:240] Graph was finalized.
W0814 20:22:43.246330 140292210890176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:22:43.448693 140292210890176 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:22:46.235136 140292210890176 session_manager.py:500] Running local_init_op.
I0814 20:22:46.260318 140292210890176 session_manager.py:502] Done running local_init_op.
I0814 20:22:46.310162 140292210890176 tpu_estimator.py:557] Init TPU system
I0814 20:22:55.252538 140292210890176 tpu_estimator.py:566] Initialized TPU in 8 seconds
I0814 20:22:55.253367 140291310864128 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:22:55.253736 140291302471424 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:22:55.329636 140292210890176 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:22:55.359786 140292210890176 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:22:55.360121 140292210890176 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:22:55.393239 140290945971968 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:22:55.665935 140290945971968 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:22:56.204308 140291302471424 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:22:56.390141 140292210890176 evaluation.py:167] Evaluation [10/10]
I0814 20:22:56.390523 140292210890176 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:22:56.390604 140292210890176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:22:56.390805 140291310864128 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:22:56.390897 140291310864128 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:22:56.391032 140292210890176 error_handling.py:96] infeed marked as finished
I0814 20:22:56.391132 140292210890176 tpu_estimator.py:602] Stop output thread controller
I0814 20:22:56.391181 140292210890176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:22:56.391294 140291302471424 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:22:56.391362 140291302471424 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:22:56.391478 140292210890176 error_handling.py:96] outfeed marked as finished
I0814 20:22:56.391571 140292210890176 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:23:25.776190 140292210890176 evaluation.py:275] Finished evaluation at 2019-08-14-20:23:25
I0814 20:23:25.776561 140292210890176 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9829, global_step = 30, loss = 0.051147856
I0814 20:23:30.500369 140292210890176 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:23:31.340480 140292210890176 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.051147856, 'global_step': 30, 'accuracy': 0.9829}

Removing gs://yangyou-mnist/log/#1565814104709429...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565814110807973...
Removing gs://yangyou-mnist/log/checkpoint#1565814151207599...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565814104.v3-8-tpu#1565814154317364...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565814118659023...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565814119567349...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565814148841898...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565814124116781...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565814147847784...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565814153370408...
Removing gs://yangyou-mnist/log/eval/#1565814207721402...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565814207.v3-8-tpu#1565814211034385...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:23:35.132328 140068986328512 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:23:35.133313 140068986328512 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:23:35.135962 140068986328512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:23:35.136843 140068986328512 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:23:35.137478 140068986328512 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:23:35.137603 140068986328512 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:23:35.566915 140068986328512 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:23:35.574877 140068986328512 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:23:35.579663 140068986328512 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:23:35.633223 140068986328512 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:23:35.633544 140068986328512 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:23:35.900470 140068986328512 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:23:35.958168 140068986328512 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:23:35.958472 140068986328512 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:23:36.098400 140068986328512 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f643455e190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f643673d210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:23:36.098768 140068986328512 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:23:36.434171 140068986328512 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:23:36.437517: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:23:36.451366 140068986328512 tpu_system_metadata.py:148] Found TPU system:
I0814 20:23:36.451658 140068986328512 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:23:36.452207 140068986328512 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:23:36.452263 140068986328512 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:23:36.452316 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:23:36.452744 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:23:36.452802 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:23:36.452853 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:23:36.452903 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:23:36.452956 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:23:36.453007 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:23:36.453054 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:23:36.453099 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:23:36.453145 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:23:36.453193 140068986328512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:23:36.459244 140068986328512 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:23:36.471923 140068986328512 estimator.py:1145] Calling model_fn.
W0814 20:23:36.472593 140068986328512 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:23:37.853514 140068986328512 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:23:38.287270 140068986328512 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:23:38.349827 140068986328512 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:23:38.355920 140068986328512 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:23:38.537184 140068986328512 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:23:38.551091 140068986328512 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:23:38.563508 140068986328512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:23:38.564678 140068986328512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:23:38.572221 140068986328512 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:23:38.577884 140068986328512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:23:38.578108 140068986328512 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:23:38.590825 140068986328512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:23:38.701061 140068986328512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:23:38.743279 140068986328512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:23:38.787960 140068986328512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:23:38.839534 140068986328512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:23:39.005484 140068986328512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:23:39.058518 140068986328512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:23:39.109695 140068986328512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:23:39.166373 140068986328512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:23:39.213625 140068986328512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:23:39.256586 140068986328512 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:23:39.273529 140068986328512 estimator.py:1147] Done calling model_fn.
I0814 20:23:42.897500 140068986328512 tpu_estimator.py:499] TPU job name worker
I0814 20:23:43.015608 140068986328512 monitored_session.py:240] Graph was finalized.
I0814 20:23:43.684680 140068986328512 session_manager.py:500] Running local_init_op.
I0814 20:23:43.736148 140068986328512 session_manager.py:502] Done running local_init_op.
I0814 20:23:46.608259 140068986328512 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:23:59.459438 140068986328512 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:23:59.634810 140068986328512 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:23:59.635293 140068986328512 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:23:59.635700: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:23:59.641872 140068986328512 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:23:59.644227 140068986328512 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:23:59.648128 140068986328512 tpu_estimator.py:557] Init TPU system
I0814 20:24:20.109424 140068986328512 tpu_estimator.py:566] Initialized TPU in 20 seconds
I0814 20:24:20.110964 140068291557120 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:24:20.113039 140067808999168 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:24:20.195965 140068986328512 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:24:20.197393 140068986328512 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 20:24:20.201586 140067800606464 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:24:20.543023 140067800606464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:24:25.013964 140067808999168 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:24:29.795584 140068986328512 basic_session_run_hooks.py:262] loss = 0.07470967, step = 30
I0814 20:24:29.798167 140068986328512 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:24:43.885015 140068986328512 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:24:43.885373 140068986328512 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:24:43.886790 140068291557120 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:24:43.886929 140068291557120 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:24:43.887098 140068986328512 error_handling.py:96] infeed marked as finished
I0814 20:24:43.887202 140068986328512 tpu_estimator.py:602] Stop output thread controller
I0814 20:24:43.887279 140068986328512 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:24:43.887440 140067808999168 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:24:43.887531 140067808999168 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:24:43.887650 140068986328512 error_handling.py:96] outfeed marked as finished
I0814 20:24:43.887739 140068986328512 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:24:50.685504 140068986328512 estimator.py:368] Loss for final step: 0.07470967.
I0814 20:24:50.686311 140068986328512 error_handling.py:96] training_loop marked as finished
I0814 20:24:51.395700 140068986328512 estimator.py:1145] Calling model_fn.
E0814 20:24:52.102065 140068986328512 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:24:52.324776 140068986328512 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:24:52.347413 140068986328512 estimator.py:1147] Done calling model_fn.
I0814 20:24:52.365005 140068986328512 evaluation.py:255] Starting evaluation at 2019-08-14T20:24:52Z
I0814 20:24:52.365252 140068986328512 tpu_estimator.py:499] TPU job name worker
I0814 20:24:52.445988 140068986328512 monitored_session.py:240] Graph was finalized.
W0814 20:24:52.446804 140068986328512 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:24:52.641412 140068986328512 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:24:55.814925 140068986328512 session_manager.py:500] Running local_init_op.
I0814 20:24:55.845451 140068986328512 session_manager.py:502] Done running local_init_op.
I0814 20:24:55.898679 140068986328512 tpu_estimator.py:557] Init TPU system
I0814 20:26:04.065979 140068986328512 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:26:04.066893 140067808999168 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:26:04.067445 140067800606464 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:26:04.132776 140068986328512 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:26:04.156272 140068986328512 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:26:04.156692 140068986328512 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:26:04.195940 140067792213760 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:26:04.429733 140067792213760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:26:04.936389 140067800606464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:26:05.357048 140068986328512 evaluation.py:167] Evaluation [10/10]
I0814 20:26:05.357453 140068986328512 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:26:05.357538 140068986328512 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:26:05.357733 140067808999168 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:26:05.357841 140067808999168 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:26:05.358004 140068986328512 error_handling.py:96] infeed marked as finished
I0814 20:26:05.358110 140068986328512 tpu_estimator.py:602] Stop output thread controller
I0814 20:26:05.358160 140068986328512 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:26:05.358288 140067800606464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:26:05.358370 140067800606464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:26:05.358525 140068986328512 error_handling.py:96] outfeed marked as finished
I0814 20:26:05.358611 140068986328512 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:26:34.526657 140068986328512 evaluation.py:275] Finished evaluation at 2019-08-14-20:26:34
I0814 20:26:34.527113 140068986328512 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9823, global_step = 30, loss = 0.0457249
I0814 20:26:39.735551 140068986328512 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:26:40.540596 140068986328512 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.0457249, 'global_step': 30, 'accuracy': 0.9823}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565814234348256...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565814238945858...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565814226017687...
Removing gs://yangyou-mnist/log/checkpoint#1565814280107204...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565814220.v3-8-tpu#1565814283559836...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565814276468006...
Removing gs://yangyou-mnist/log/#1565814220732740...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565814233467028...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565814277365641...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565814282323014...
Removing gs://yangyou-mnist/log/eval/#1565814396148385...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565814396.v3-8-tpu#1565814400223432...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:26:44.325113 140398499980736 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:26:44.325905 140398499980736 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:26:44.328562 140398499980736 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:26:44.329384 140398499980736 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:26:44.329982 140398499980736 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:26:44.330112 140398499980736 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:26:44.749232 140398499980736 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:26:44.758393 140398499980736 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:26:44.762351 140398499980736 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:26:44.815365 140398499980736 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:26:44.815669 140398499980736 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:26:45.094671 140398499980736 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:26:45.149130 140398499980736 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:26:45.149435 140398499980736 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:26:45.318162 140398499980736 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb0ece13190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb0eeff21d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:26:45.318591 140398499980736 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:26:45.641860 140398499980736 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:26:45.644920: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:26:45.658019 140398499980736 tpu_system_metadata.py:148] Found TPU system:
I0814 20:26:45.658282 140398499980736 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:26:45.658793 140398499980736 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:26:45.658850 140398499980736 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:26:45.658905 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:26:45.659337 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:26:45.659394 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:26:45.659446 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:26:45.659496 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:26:45.659543 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:26:45.659594 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:26:45.659643 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:26:45.659691 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:26:45.659739 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:26:45.659790 140398499980736 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:26:45.665744 140398499980736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:26:45.678031 140398499980736 estimator.py:1145] Calling model_fn.
W0814 20:26:45.678637 140398499980736 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:26:45.962201 140398499980736 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:26:46.477054 140398499980736 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:26:46.539086 140398499980736 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:26:46.545111 140398499980736 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:26:46.722273 140398499980736 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:26:46.736304 140398499980736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:26:46.748475 140398499980736 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:26:46.749587 140398499980736 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:26:46.756688 140398499980736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:26:46.762015 140398499980736 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:26:46.762211 140398499980736 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:26:46.775326 140398499980736 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:26:46.884483 140398499980736 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:26:46.925338 140398499980736 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:26:46.969429 140398499980736 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:26:47.019339 140398499980736 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:26:47.198442 140398499980736 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:26:47.248749 140398499980736 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:26:47.296802 140398499980736 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:26:47.347142 140398499980736 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:26:47.392013 140398499980736 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:26:47.434545 140398499980736 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:26:47.450872 140398499980736 estimator.py:1147] Done calling model_fn.
I0814 20:26:50.847321 140398499980736 tpu_estimator.py:499] TPU job name worker
I0814 20:26:50.959835 140398499980736 monitored_session.py:240] Graph was finalized.
I0814 20:26:51.690198 140398499980736 session_manager.py:500] Running local_init_op.
I0814 20:26:51.757868 140398499980736 session_manager.py:502] Done running local_init_op.
I0814 20:26:54.556788 140398499980736 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:27:07.205933 140398499980736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:27:07.374228 140398499980736 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:27:07.374650 140398499980736 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:27:07.375039: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:27:07.379812 140398499980736 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:27:07.382225 140398499980736 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:27:07.387329 140398499980736 tpu_estimator.py:557] Init TPU system
I0814 20:27:48.127480 140398499980736 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 20:27:48.128737 140397737912064 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:27:48.129586 140397729519360 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:27:48.197937 140398499980736 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:27:48.198851 140398499980736 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 20:27:48.256158 140397246412544 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:27:48.538717 140397246412544 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 20:27:52.984998 140397729519360 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:27:57.603178 140398499980736 basic_session_run_hooks.py:262] loss = 0.052400257, step = 30
I0814 20:27:57.606077 140398499980736 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:28:11.016088 140398499980736 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:28:11.016477 140398499980736 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:28:11.016752 140397737912064 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:28:11.016866 140397737912064 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:28:11.017046 140398499980736 error_handling.py:96] infeed marked as finished
I0814 20:28:11.017159 140398499980736 tpu_estimator.py:602] Stop output thread controller
I0814 20:28:11.017210 140398499980736 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:28:11.017386 140397729519360 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:28:11.017468 140397729519360 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:28:11.017612 140398499980736 error_handling.py:96] outfeed marked as finished
I0814 20:28:11.017703 140398499980736 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:28:18.656477 140398499980736 estimator.py:368] Loss for final step: 0.052400257.
I0814 20:28:18.657354 140398499980736 error_handling.py:96] training_loop marked as finished
I0814 20:28:19.466567 140398499980736 estimator.py:1145] Calling model_fn.
E0814 20:28:20.194350 140398499980736 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:28:20.426800 140398499980736 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:28:20.449963 140398499980736 estimator.py:1147] Done calling model_fn.
I0814 20:28:20.467253 140398499980736 evaluation.py:255] Starting evaluation at 2019-08-14T20:28:20Z
I0814 20:28:20.467498 140398499980736 tpu_estimator.py:499] TPU job name worker
I0814 20:28:20.547255 140398499980736 monitored_session.py:240] Graph was finalized.
W0814 20:28:20.547995 140398499980736 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:28:20.771141 140398499980736 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:28:23.594218 140398499980736 session_manager.py:500] Running local_init_op.
I0814 20:28:23.620318 140398499980736 session_manager.py:502] Done running local_init_op.
I0814 20:28:23.671355 140398499980736 tpu_estimator.py:557] Init TPU system
I0814 20:29:32.038153 140398499980736 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:29:32.039093 140397734242048 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:29:32.039505 140397246412544 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:29:32.110446 140398499980736 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:29:32.139292 140398499980736 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:29:32.139642 140398499980736 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:29:32.175494 140397238019840 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:29:32.347569 140397238019840 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 20:29:32.940031 140397246412544 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:29:33.260627 140398499980736 evaluation.py:167] Evaluation [10/10]
I0814 20:29:33.260955 140398499980736 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:29:33.261025 140398499980736 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:29:33.261261 140397734242048 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:29:33.261384 140397734242048 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:29:33.261531 140398499980736 error_handling.py:96] infeed marked as finished
I0814 20:29:33.261732 140398499980736 tpu_estimator.py:602] Stop output thread controller
I0814 20:29:33.261799 140398499980736 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:29:33.261919 140397246412544 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:29:33.261997 140397246412544 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:29:33.262111 140398499980736 error_handling.py:96] outfeed marked as finished
I0814 20:29:33.262206 140398499980736 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:30:02.443608 140398499980736 evaluation.py:275] Finished evaluation at 2019-08-14-20:30:02
I0814 20:30:02.444004 140398499980736 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9833, global_step = 30, loss = 0.05668937
I0814 20:30:07.159480 140398499980736 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:30:08.005207 140398499980736 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.05668937, 'global_step': 30, 'accuracy': 0.9833}

Removing gs://yangyou-mnist/log/#1565814408939929...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565814422257328...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565814426693565...
Removing gs://yangyou-mnist/log/checkpoint#1565814487525899...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565814484444045...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565814409.v3-8-tpu#1565814490711207...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565814485334640...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565814413976646...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565814421406761...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565814489761554...
Removing gs://yangyou-mnist/log/eval/#1565814604283411...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565814604.v3-8-tpu#1565814607690745...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:30:11.810817 140154524792256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:30:11.811603 140154524792256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:30:11.814155 140154524792256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:30:11.814960 140154524792256 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:30:11.815548 140154524792256 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:30:11.815681 140154524792256 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:30:12.229208 140154524792256 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:30:12.236093 140154524792256 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:30:12.240139 140154524792256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:30:12.291663 140154524792256 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:30:12.291928 140154524792256 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:30:12.549190 140154524792256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:30:12.665776 140154524792256 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:30:12.666063 140154524792256 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:30:12.977854 140154524792256 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f781ed34250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f7820f13210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:30:12.978198 140154524792256 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:30:13.307996 140154524792256 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:30:13.310824: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:30:13.323215 140154524792256 tpu_system_metadata.py:148] Found TPU system:
I0814 20:30:13.323450 140154524792256 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:30:13.324014 140154524792256 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:30:13.324090 140154524792256 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:30:13.324150 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:30:13.324532 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:30:13.324595 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:30:13.324655 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:30:13.324719 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:30:13.324769 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:30:13.324815 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:30:13.324872 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:30:13.324923 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:30:13.324969 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:30:13.325015 140154524792256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:30:13.330974 140154524792256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:30:13.343203 140154524792256 estimator.py:1145] Calling model_fn.
W0814 20:30:13.343821 140154524792256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:30:13.615631 140154524792256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:30:14.217348 140154524792256 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:30:14.287836 140154524792256 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:30:14.294003 140154524792256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:30:14.474020 140154524792256 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:30:14.487832 140154524792256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:30:14.499771 140154524792256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:30:14.500853 140154524792256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:30:14.507838 140154524792256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:30:14.513041 140154524792256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:30:14.513253 140154524792256 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:30:14.525938 140154524792256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:30:14.635032 140154524792256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:30:14.675754 140154524792256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:30:14.720601 140154524792256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:30:14.771735 140154524792256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:30:14.933199 140154524792256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:30:14.983386 140154524792256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:30:15.032325 140154524792256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:30:15.082926 140154524792256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:30:15.129450 140154524792256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:30:15.171103 140154524792256 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:30:15.187325 140154524792256 estimator.py:1147] Done calling model_fn.
I0814 20:30:18.648296 140154524792256 tpu_estimator.py:499] TPU job name worker
I0814 20:30:18.758481 140154524792256 monitored_session.py:240] Graph was finalized.
I0814 20:30:19.486083 140154524792256 session_manager.py:500] Running local_init_op.
I0814 20:30:19.549313 140154524792256 session_manager.py:502] Done running local_init_op.
I0814 20:30:22.282372 140154524792256 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:30:34.633053 140154524792256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:30:34.792587 140154524792256 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:30:34.793004 140154524792256 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:30:34.793406: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:30:34.799355 140154524792256 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:30:34.801456 140154524792256 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:30:34.805296 140154524792256 tpu_estimator.py:557] Init TPU system
I0814 20:31:16.128359 140154524792256 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 20:31:16.129291 140153624450816 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:31:16.129723 140153616058112 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:31:16.189867 140153607665408 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:31:16.197088 140154524792256 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:31:16.198110 140154524792256 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 20:31:16.633728 140153607665408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 20:31:21.021291 140153616058112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:31:25.616081 140154524792256 basic_session_run_hooks.py:262] loss = 0.07408956, step = 30
I0814 20:31:25.618812 140154524792256 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:31:39.643939 140154524792256 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:31:39.644270 140154524792256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:31:39.644673 140153624450816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:31:39.644999 140153624450816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:31:39.645277 140154524792256 error_handling.py:96] infeed marked as finished
I0814 20:31:39.645555 140154524792256 tpu_estimator.py:602] Stop output thread controller
I0814 20:31:39.645617 140154524792256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:31:39.645847 140153616058112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:31:39.646055 140153616058112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:31:39.646279 140154524792256 error_handling.py:96] outfeed marked as finished
I0814 20:31:39.646464 140154524792256 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:31:46.772967 140154524792256 estimator.py:368] Loss for final step: 0.07408956.
I0814 20:31:46.773752 140154524792256 error_handling.py:96] training_loop marked as finished
I0814 20:31:47.616429 140154524792256 estimator.py:1145] Calling model_fn.
E0814 20:31:48.373730 140154524792256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:31:48.603008 140154524792256 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:31:48.624161 140154524792256 estimator.py:1147] Done calling model_fn.
I0814 20:31:48.640773 140154524792256 evaluation.py:255] Starting evaluation at 2019-08-14T20:31:48Z
I0814 20:31:48.641006 140154524792256 tpu_estimator.py:499] TPU job name worker
I0814 20:31:48.719471 140154524792256 monitored_session.py:240] Graph was finalized.
W0814 20:31:48.720196 140154524792256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:31:48.887969 140154524792256 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:31:51.639957 140154524792256 session_manager.py:500] Running local_init_op.
I0814 20:31:51.665210 140154524792256 session_manager.py:502] Done running local_init_op.
I0814 20:31:51.714111 140154524792256 tpu_estimator.py:557] Init TPU system
I0814 20:33:00.063671 140154524792256 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:33:00.064743 140153624450816 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:33:00.065310 140153616058112 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:33:00.130939 140154524792256 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:33:00.160963 140154524792256 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:33:00.161359 140154524792256 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:33:00.192722 140153607665408 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:33:00.548887 140153607665408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 20:33:00.944849 140153616058112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:33:01.369761 140154524792256 evaluation.py:167] Evaluation [10/10]
I0814 20:33:01.370093 140154524792256 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:33:01.370168 140154524792256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:33:01.370378 140153624450816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:33:01.370482 140153624450816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:33:01.370624 140154524792256 error_handling.py:96] infeed marked as finished
I0814 20:33:01.370835 140154524792256 tpu_estimator.py:602] Stop output thread controller
I0814 20:33:01.370889 140154524792256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:33:01.371016 140153616058112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:33:01.371089 140153616058112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:33:01.371198 140154524792256 error_handling.py:96] outfeed marked as finished
I0814 20:33:01.371320 140154524792256 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:33:30.645961 140154524792256 evaluation.py:275] Finished evaluation at 2019-08-14-20:33:30
I0814 20:33:30.646280 140154524792256 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9828, global_step = 30, loss = 0.057118703
I0814 20:33:36.134073 140154524792256 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:33:36.943116 140154524792256 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.057118703, 'global_step': 30, 'accuracy': 0.9828}

Removing gs://yangyou-mnist/log/#1565814616757965...
Removing gs://yangyou-mnist/log/checkpoint#1565814696444735...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565814616.v3-8-tpu#1565814699338279...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565814621706855...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565814629798427...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565814628828446...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565814634119257...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565814692423872...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565814693336054...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565814698454895...
Removing gs://yangyou-mnist/log/eval/#1565814812347055...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565814812.v3-8-tpu#1565814816629409...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:33:40.731355 139708819080640 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:33:40.732163 139708819080640 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:33:40.734806 139708819080640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:33:40.735642 139708819080640 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:33:40.736243 139708819080640 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:33:40.736380 139708819080640 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:33:41.157646 139708819080640 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:33:41.165138 139708819080640 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:33:41.169267 139708819080640 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:33:41.223603 139708819080640 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:33:41.223903 139708819080640 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:33:41.474287 139708819080640 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:33:41.525027 139708819080640 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:33:41.525335 139708819080640 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:33:41.999449 139708819080640 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1058b1d210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f105acfc210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:33:41.999831 139708819080640 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:33:42.326524 139708819080640 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:33:42.329773: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:33:42.343452 139708819080640 tpu_system_metadata.py:148] Found TPU system:
I0814 20:33:42.343727 139708819080640 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:33:42.344335 139708819080640 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:33:42.344439 139708819080640 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:33:42.344501 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:33:42.344811 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:33:42.344868 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:33:42.344922 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:33:42.344970 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:33:42.345017 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:33:42.345063 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:33:42.345110 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:33:42.345156 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:33:42.345201 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:33:42.345249 139708819080640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:33:42.351557 139708819080640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:33:42.364248 139708819080640 estimator.py:1145] Calling model_fn.
W0814 20:33:42.364937 139708819080640 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:33:42.643116 139708819080640 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:33:43.364658 139708819080640 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:33:43.428392 139708819080640 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:33:43.434660 139708819080640 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:33:43.619927 139708819080640 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:33:43.634001 139708819080640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:33:43.646653 139708819080640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:33:43.647747 139708819080640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:33:43.654897 139708819080640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:33:43.660232 139708819080640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:33:43.660497 139708819080640 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:33:43.673270 139708819080640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:33:43.785141 139708819080640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:33:43.826678 139708819080640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:33:43.871848 139708819080640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:33:43.924591 139708819080640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:33:44.100130 139708819080640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:33:44.151541 139708819080640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:33:44.200822 139708819080640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:33:44.250999 139708819080640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:33:44.296583 139708819080640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:33:44.338164 139708819080640 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:33:44.355240 139708819080640 estimator.py:1147] Done calling model_fn.
I0814 20:33:47.844922 139708819080640 tpu_estimator.py:499] TPU job name worker
I0814 20:33:47.956341 139708819080640 monitored_session.py:240] Graph was finalized.
I0814 20:33:48.654589 139708819080640 session_manager.py:500] Running local_init_op.
I0814 20:33:48.705223 139708819080640 session_manager.py:502] Done running local_init_op.
I0814 20:33:51.434802 139708819080640 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:34:04.183700 139708819080640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:34:04.331837 139708819080640 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:34:04.332344 139708819080640 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:34:04.332780: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:34:04.337357 139708819080640 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:34:04.339988 139708819080640 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:34:04.343732 139708819080640 tpu_estimator.py:557] Init TPU system
I0814 20:34:44.138761 139708819080640 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 20:34:44.139842 139708056971008 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:34:44.140686 139708048578304 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:34:44.211576 139708819080640 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:34:44.212584 139708819080640 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 20:34:44.268359 139707568617216 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:34:44.714133 139707568617216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:34:49.102499 139708048578304 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:34:53.682039 139708819080640 basic_session_run_hooks.py:262] loss = 0.04176048, step = 30
I0814 20:34:53.684644 139708819080640 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:35:07.373877 139708819080640 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:35:07.374177 139708819080640 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:35:07.374392 139708056971008 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:35:07.374512 139708056971008 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:35:07.374646 139708819080640 error_handling.py:96] infeed marked as finished
I0814 20:35:07.374747 139708819080640 tpu_estimator.py:602] Stop output thread controller
I0814 20:35:07.374799 139708819080640 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:35:07.374911 139708048578304 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:35:07.374994 139708048578304 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:35:07.375104 139708819080640 error_handling.py:96] outfeed marked as finished
I0814 20:35:07.375185 139708819080640 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:35:14.851252 139708819080640 estimator.py:368] Loss for final step: 0.04176048.
I0814 20:35:14.852116 139708819080640 error_handling.py:96] training_loop marked as finished
I0814 20:35:15.607227 139708819080640 estimator.py:1145] Calling model_fn.
E0814 20:35:16.299452 139708819080640 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:35:16.527998 139708819080640 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:35:16.549371 139708819080640 estimator.py:1147] Done calling model_fn.
I0814 20:35:16.566401 139708819080640 evaluation.py:255] Starting evaluation at 2019-08-14T20:35:16Z
I0814 20:35:16.566641 139708819080640 tpu_estimator.py:499] TPU job name worker
I0814 20:35:16.646372 139708819080640 monitored_session.py:240] Graph was finalized.
W0814 20:35:16.647108 139708819080640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:35:16.844357 139708819080640 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:35:19.573854 139708819080640 session_manager.py:500] Running local_init_op.
I0814 20:35:19.603727 139708819080640 session_manager.py:502] Done running local_init_op.
I0814 20:35:19.653959 139708819080640 tpu_estimator.py:557] Init TPU system
I0814 20:36:28.068746 139708819080640 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:36:28.069813 139708053300992 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:36:28.070465 139707568617216 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:36:28.143836 139708819080640 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:36:28.170228 139708819080640 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:36:28.170609 139708819080640 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:36:28.213459 139707560224512 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:36:28.602011 139707560224512 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:36:29.007548 139707568617216 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:36:29.238379 139708819080640 evaluation.py:167] Evaluation [10/10]
I0814 20:36:29.238718 139708819080640 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:36:29.238805 139708819080640 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:36:29.239064 139708053300992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:36:29.239340 139708053300992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:36:29.239569 139708819080640 error_handling.py:96] infeed marked as finished
I0814 20:36:29.239876 139708819080640 tpu_estimator.py:602] Stop output thread controller
I0814 20:36:29.239962 139708819080640 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:36:29.240138 139707568617216 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:36:29.240288 139707568617216 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:36:29.240542 139708819080640 error_handling.py:96] outfeed marked as finished
I0814 20:36:29.240771 139708819080640 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:36:58.703733 139708819080640 evaluation.py:275] Finished evaluation at 2019-08-14-20:36:58
I0814 20:36:58.704134 139708819080640 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9854, global_step = 30, loss = 0.049225412
I0814 20:37:04.242244 139708819080640 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:37:05.095964 139708819080640 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.049225412, 'global_step': 30, 'accuracy': 0.9854}

Removing gs://yangyou-mnist/log/#1565814825888211...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565814826.v3-8-tpu#1565814907043290...
Removing gs://yangyou-mnist/log/checkpoint#1565814903836205...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565814839224047...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565814843668168...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565814900727346...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565814901631879...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565814830858023...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565814838154111...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565814906003038...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565815021478099...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565815021.v3-8-tpu#1565815024805168...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:37:08.742254 140340903691712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:37:08.743067 140340903691712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:37:08.745650 140340903691712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:37:08.746467 140340903691712 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:37:08.747062 140340903691712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:37:08.747184 140340903691712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:37:09.170980 140340903691712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:37:09.178664 140340903691712 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:37:09.182670 140340903691712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:37:09.242522 140340903691712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:37:09.242852 140340903691712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:37:09.503907 140340903691712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:37:09.555716 140340903691712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:37:09.556010 140340903691712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:37:09.920058 140340903691712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa383df9310>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa385fd8210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:37:09.920437 140340903691712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:37:10.248719 140340903691712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:37:10.251791: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:37:10.265351 140340903691712 tpu_system_metadata.py:148] Found TPU system:
I0814 20:37:10.265588 140340903691712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:37:10.266083 140340903691712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:37:10.266141 140340903691712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:37:10.266196 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:37:10.266489 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:37:10.266546 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:37:10.266596 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:37:10.266652 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:37:10.266700 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:37:10.266746 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:37:10.266793 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:37:10.266839 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:37:10.266885 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:37:10.266951 140340903691712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:37:10.273638 140340903691712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:37:10.286804 140340903691712 estimator.py:1145] Calling model_fn.
W0814 20:37:10.287427 140340903691712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:37:10.604748 140340903691712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:37:11.288557 140340903691712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:37:11.350809 140340903691712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:37:11.356749 140340903691712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:37:11.539012 140340903691712 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:37:11.553658 140340903691712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:37:11.565926 140340903691712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:37:11.567007 140340903691712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:37:11.574142 140340903691712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:37:11.579315 140340903691712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:37:11.579530 140340903691712 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:37:11.592040 140340903691712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:37:11.702065 140340903691712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:37:11.744837 140340903691712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:37:11.789944 140340903691712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:37:11.841250 140340903691712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:37:12.011426 140340903691712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:37:12.062664 140340903691712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:37:12.119636 140340903691712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:37:12.169874 140340903691712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:37:12.215964 140340903691712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:37:12.257500 140340903691712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:37:12.273756 140340903691712 estimator.py:1147] Done calling model_fn.
I0814 20:37:15.655121 140340903691712 tpu_estimator.py:499] TPU job name worker
I0814 20:37:15.766407 140340903691712 monitored_session.py:240] Graph was finalized.
I0814 20:37:16.460591 140340903691712 session_manager.py:500] Running local_init_op.
I0814 20:37:16.523190 140340903691712 session_manager.py:502] Done running local_init_op.
I0814 20:37:19.228610 140340903691712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:37:31.447559 140340903691712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:37:31.607918 140340903691712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:37:31.608460 140340903691712 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:37:31.608856: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:37:31.614250 140340903691712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:37:31.616214 140340903691712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:37:31.620435 140340903691712 tpu_estimator.py:557] Init TPU system
I0814 20:38:12.130646 140340903691712 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 20:38:12.131798 140339868333824 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:38:12.132584 140339859941120 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:38:12.201841 140339851548416 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:38:12.202542 140340903691712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:38:12.204081 140340903691712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 20:38:12.393141 140339851548416 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:38:16.994297 140339859941120 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:38:21.686459 140340903691712 basic_session_run_hooks.py:262] loss = 0.06069437, step = 30
I0814 20:38:21.689404 140340903691712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:38:35.287672 140340903691712 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:38:35.287993 140340903691712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:38:35.288234 140339868333824 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:38:35.288353 140339868333824 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:38:35.288654 140340903691712 error_handling.py:96] infeed marked as finished
I0814 20:38:35.288813 140340903691712 tpu_estimator.py:602] Stop output thread controller
I0814 20:38:35.288861 140340903691712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:38:35.288976 140339859941120 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:38:35.289047 140339859941120 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:38:35.289155 140340903691712 error_handling.py:96] outfeed marked as finished
I0814 20:38:35.289239 140340903691712 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:38:42.527220 140340903691712 estimator.py:368] Loss for final step: 0.06069437.
I0814 20:38:42.528013 140340903691712 error_handling.py:96] training_loop marked as finished
I0814 20:38:43.351665 140340903691712 estimator.py:1145] Calling model_fn.
E0814 20:38:44.054800 140340903691712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:38:44.295197 140340903691712 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:38:44.318789 140340903691712 estimator.py:1147] Done calling model_fn.
I0814 20:38:44.335969 140340903691712 evaluation.py:255] Starting evaluation at 2019-08-14T20:38:44Z
I0814 20:38:44.336194 140340903691712 tpu_estimator.py:499] TPU job name worker
I0814 20:38:44.417287 140340903691712 monitored_session.py:240] Graph was finalized.
W0814 20:38:44.418013 140340903691712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:38:44.618134 140340903691712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:38:47.218091 140340903691712 session_manager.py:500] Running local_init_op.
I0814 20:38:47.243338 140340903691712 session_manager.py:502] Done running local_init_op.
I0814 20:38:47.298655 140340903691712 tpu_estimator.py:557] Init TPU system
I0814 20:39:56.076069 140340903691712 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:39:56.077157 140339868333824 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:39:56.078423 140339859941120 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:39:56.145580 140340903691712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:39:56.177040 140340903691712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:39:56.177474 140340903691712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:39:56.210532 140339851548416 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:39:56.500709 140339851548416 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:39:56.995299 140339859941120 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:39:57.305288 140340903691712 evaluation.py:167] Evaluation [10/10]
I0814 20:39:57.305677 140340903691712 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:39:57.305756 140340903691712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:39:57.306008 140339868333824 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:39:57.306323 140339868333824 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:39:57.306591 140340903691712 error_handling.py:96] infeed marked as finished
I0814 20:39:57.306761 140340903691712 tpu_estimator.py:602] Stop output thread controller
I0814 20:39:57.306816 140340903691712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:39:57.306996 140339859941120 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:39:57.307141 140339859941120 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:39:57.307305 140340903691712 error_handling.py:96] outfeed marked as finished
I0814 20:39:57.307415 140340903691712 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:40:26.589983 140340903691712 evaluation.py:275] Finished evaluation at 2019-08-14-20:40:26
I0814 20:40:26.590363 140340903691712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9829, global_step = 30, loss = 0.06349106
I0814 20:40:31.175687 140340903691712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:40:32.407617 140340903691712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06349106, 'global_step': 30, 'accuracy': 0.9829}

Removing gs://yangyou-mnist/log/#1565815033731763...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565815046378529...
Removing gs://yangyou-mnist/log/checkpoint#1565815111773153...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565815050932198...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565815033.v3-8-tpu#1565815114981301...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565815109622731...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565815045471673...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565815038631148...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565815108706118...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565815114049021...
Removing gs://yangyou-mnist/log/eval/#1565815228309179...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565815228.v3-8-tpu#1565815232088349...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:40:36.285267 139971401893312 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:40:36.286060 139971401893312 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:40:36.289143 139971401893312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:40:36.290014 139971401893312 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:40:36.290682 139971401893312 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:40:36.290822 139971401893312 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:40:36.706000 139971401893312 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:40:36.712874 139971401893312 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:40:36.717231 139971401893312 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:40:36.980643 139971401893312 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:40:36.980951 139971401893312 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:40:37.292135 139971401893312 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:40:37.344815 139971401893312 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:40:37.345129 139971401893312 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:40:37.626871 139971401893312 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4d7bd99210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4d7df78210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:40:37.627315 139971401893312 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:40:37.994214 139971401893312 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:40:37.997837: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:40:38.011569 139971401893312 tpu_system_metadata.py:148] Found TPU system:
I0814 20:40:38.011853 139971401893312 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:40:38.012501 139971401893312 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:40:38.012563 139971401893312 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:40:38.012622 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:40:38.013077 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:40:38.013170 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:40:38.013226 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:40:38.013278 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:40:38.013326 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:40:38.013374 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:40:38.013421 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:40:38.013473 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:40:38.013520 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:40:38.013567 139971401893312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:40:38.019877 139971401893312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:40:38.032691 139971401893312 estimator.py:1145] Calling model_fn.
W0814 20:40:38.033313 139971401893312 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:40:38.341662 139971401893312 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:40:39.010282 139971401893312 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:40:39.074968 139971401893312 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:40:39.081206 139971401893312 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:40:39.264949 139971401893312 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:40:39.278434 139971401893312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:40:39.290843 139971401893312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:40:39.292001 139971401893312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:40:39.299242 139971401893312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:40:39.305565 139971401893312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:40:39.305816 139971401893312 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:40:39.320368 139971401893312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:40:39.430457 139971401893312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:40:39.471091 139971401893312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:40:39.514817 139971401893312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:40:39.565068 139971401893312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:40:39.737895 139971401893312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:40:39.787533 139971401893312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:40:39.834327 139971401893312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:40:39.883704 139971401893312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:40:39.929022 139971401893312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:40:39.970149 139971401893312 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:40:39.987217 139971401893312 estimator.py:1147] Done calling model_fn.
I0814 20:40:43.585783 139971401893312 tpu_estimator.py:499] TPU job name worker
I0814 20:40:43.691279 139971401893312 monitored_session.py:240] Graph was finalized.
I0814 20:40:44.360935 139971401893312 session_manager.py:500] Running local_init_op.
I0814 20:40:44.424117 139971401893312 session_manager.py:502] Done running local_init_op.
I0814 20:40:47.374228 139971401893312 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:41:00.387082 139971401893312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:41:00.562454 139971401893312 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:41:00.562942 139971401893312 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:41:00.563325: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:41:00.568603 139971401893312 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:41:00.570703 139971401893312 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:41:00.575758 139971401893312 tpu_estimator.py:557] Init TPU system
I0814 20:41:40.123442 139971401893312 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 20:41:40.126434 139970626971392 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:41:40.127000 139970618578688 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:41:40.183639 139970610185984 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:41:40.199495 139971401893312 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:41:40.200359 139971401893312 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 20:41:40.487150 139970610185984 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:41:44.975298 139970618578688 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:41:49.648638 139971401893312 basic_session_run_hooks.py:262] loss = 0.094252594, step = 30
I0814 20:41:49.651211 139971401893312 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:42:04.798212 139971401893312 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:42:04.798542 139971401893312 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:42:04.798810 139970626971392 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:42:04.798952 139970626971392 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:42:04.799141 139971401893312 error_handling.py:96] infeed marked as finished
I0814 20:42:04.799258 139971401893312 tpu_estimator.py:602] Stop output thread controller
I0814 20:42:04.799309 139971401893312 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:42:04.799462 139970618578688 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:42:04.799545 139970618578688 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:42:04.799686 139971401893312 error_handling.py:96] outfeed marked as finished
I0814 20:42:04.799782 139971401893312 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:42:10.620085 139971401893312 estimator.py:368] Loss for final step: 0.094252594.
I0814 20:42:10.621056 139971401893312 error_handling.py:96] training_loop marked as finished
I0814 20:42:11.400775 139971401893312 estimator.py:1145] Calling model_fn.
E0814 20:42:12.106652 139971401893312 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:42:12.333791 139971401893312 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:42:12.356352 139971401893312 estimator.py:1147] Done calling model_fn.
I0814 20:42:12.373105 139971401893312 evaluation.py:255] Starting evaluation at 2019-08-14T20:42:12Z
I0814 20:42:12.373356 139971401893312 tpu_estimator.py:499] TPU job name worker
I0814 20:42:12.451536 139971401893312 monitored_session.py:240] Graph was finalized.
W0814 20:42:12.452344 139971401893312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:42:12.648736 139971401893312 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:42:15.461194 139971401893312 session_manager.py:500] Running local_init_op.
I0814 20:42:15.495728 139971401893312 session_manager.py:502] Done running local_init_op.
I0814 20:42:15.553129 139971401893312 tpu_estimator.py:557] Init TPU system
I0814 20:43:24.073421 139971401893312 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:43:24.074345 139970635364096 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:43:24.074851 139970626971392 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:43:24.141973 139971401893312 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:43:24.166604 139971401893312 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:43:24.167037 139971401893312 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:43:24.203562 139970618578688 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:43:24.817548 139970618578688 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:43:24.953182 139970626971392 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:43:25.266453 139971401893312 evaluation.py:167] Evaluation [10/10]
I0814 20:43:25.266824 139971401893312 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:43:25.266905 139971401893312 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:43:25.267100 139970635364096 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:43:25.267204 139970635364096 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:43:25.267343 139971401893312 error_handling.py:96] infeed marked as finished
I0814 20:43:25.267452 139971401893312 tpu_estimator.py:602] Stop output thread controller
I0814 20:43:25.267501 139971401893312 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:43:25.267612 139970626971392 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:43:25.267683 139970626971392 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:43:25.267878 139971401893312 error_handling.py:96] outfeed marked as finished
I0814 20:43:25.267976 139971401893312 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:43:54.915047 139971401893312 evaluation.py:275] Finished evaluation at 2019-08-14-20:43:54
I0814 20:43:54.915404 139971401893312 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9824, global_step = 30, loss = 0.06200667
I0814 20:43:59.245349 139971401893312 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:44:00.150954 139971401893312 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06200667, 'global_step': 30, 'accuracy': 0.9824}

Removing gs://yangyou-mnist/log/#1565815241556385...
Removing gs://yangyou-mnist/log/checkpoint#1565815321029831...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565815241.v3-8-tpu#1565815324428652...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565815254707902...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565815246732935...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565815259875403...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565815316713890...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565815317672792...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565815253749619...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565815323358622...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565815436579378...
/ [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565815436.v3-8-tpu#1565815439828597...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:44:04.302216 140587296523712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:44:04.303275 140587296523712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:44:04.306025 140587296523712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:44:04.306920 140587296523712 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:44:04.307540 140587296523712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:44:04.307672 140587296523712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:44:04.758913 140587296523712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:44:04.764976 140587296523712 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:44:04.768790 140587296523712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:44:04.816303 140587296523712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:44:04.816611 140587296523712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:44:05.179414 140587296523712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:44:05.289608 140587296523712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:44:05.289902 140587296523712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:44:05.828556 140587296523712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fdce2066450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fdce425c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:44:05.828934 140587296523712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:44:06.149903 140587296523712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:44:06.153127: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:44:06.166817 140587296523712 tpu_system_metadata.py:148] Found TPU system:
I0814 20:44:06.167140 140587296523712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:44:06.167654 140587296523712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:44:06.167716 140587296523712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:44:06.167769 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:44:06.168051 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:44:06.168107 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:44:06.168164 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:44:06.168214 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:44:06.168262 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:44:06.168308 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:44:06.168354 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:44:06.168426 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:44:06.168494 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:44:06.168545 140587296523712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:44:06.174572 140587296523712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:44:06.187156 140587296523712 estimator.py:1145] Calling model_fn.
W0814 20:44:06.187761 140587296523712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:44:06.456819 140587296523712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:44:07.061337 140587296523712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:44:07.123766 140587296523712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:44:07.129761 140587296523712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:44:07.314181 140587296523712 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:44:07.327987 140587296523712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:44:07.340065 140587296523712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:44:07.341144 140587296523712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:44:07.348162 140587296523712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:44:07.353405 140587296523712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:44:07.353625 140587296523712 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:44:07.366046 140587296523712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:44:07.476970 140587296523712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:44:07.519160 140587296523712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:44:07.564490 140587296523712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:44:07.616857 140587296523712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:44:07.783317 140587296523712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:44:07.833600 140587296523712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:44:07.881704 140587296523712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:44:07.932076 140587296523712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:44:07.978064 140587296523712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:44:08.019560 140587296523712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:44:08.035953 140587296523712 estimator.py:1147] Done calling model_fn.
I0814 20:44:11.643203 140587296523712 tpu_estimator.py:499] TPU job name worker
I0814 20:44:11.755605 140587296523712 monitored_session.py:240] Graph was finalized.
I0814 20:44:12.443500 140587296523712 session_manager.py:500] Running local_init_op.
I0814 20:44:12.493217 140587296523712 session_manager.py:502] Done running local_init_op.
I0814 20:44:15.426774 140587296523712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:44:28.065851 140587296523712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:44:28.228919 140587296523712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:44:28.229343 140587296523712 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:44:28.229747: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:44:28.234744 140587296523712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:44:28.237123 140587296523712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:44:28.241792 140587296523712 tpu_estimator.py:557] Init TPU system
I0814 20:45:08.119316 140587296523712 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 20:45:08.120178 140586391947008 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:45:08.120709 140586383554304 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:45:08.180556 140586375161600 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:45:08.187978 140587296523712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:45:08.189198 140587296523712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 20:45:08.646276 140586375161600 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 20:45:13.020493 140586383554304 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:45:17.325803 140587296523712 basic_session_run_hooks.py:262] loss = 0.17682306, step = 30
I0814 20:45:17.328483 140587296523712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:45:31.332313 140587296523712 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:45:31.332724 140587296523712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:45:31.334362 140586391947008 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:45:31.334738 140586391947008 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:45:31.334985 140587296523712 error_handling.py:96] infeed marked as finished
I0814 20:45:31.335230 140587296523712 tpu_estimator.py:602] Stop output thread controller
I0814 20:45:31.335293 140587296523712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:45:31.335472 140586383554304 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:45:31.335710 140586383554304 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:45:31.335973 140587296523712 error_handling.py:96] outfeed marked as finished
I0814 20:45:31.336164 140587296523712 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:45:38.781871 140587296523712 estimator.py:368] Loss for final step: 0.17682306.
I0814 20:45:38.782771 140587296523712 error_handling.py:96] training_loop marked as finished
I0814 20:45:39.579657 140587296523712 estimator.py:1145] Calling model_fn.
E0814 20:45:40.292296 140587296523712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:45:40.522211 140587296523712 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:45:40.544853 140587296523712 estimator.py:1147] Done calling model_fn.
I0814 20:45:40.561916 140587296523712 evaluation.py:255] Starting evaluation at 2019-08-14T20:45:40Z
I0814 20:45:40.562164 140587296523712 tpu_estimator.py:499] TPU job name worker
I0814 20:45:40.640327 140587296523712 monitored_session.py:240] Graph was finalized.
W0814 20:45:40.641134 140587296523712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:45:40.871663 140587296523712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:45:43.673346 140587296523712 session_manager.py:500] Running local_init_op.
I0814 20:45:43.703422 140587296523712 session_manager.py:502] Done running local_init_op.
I0814 20:45:43.755284 140587296523712 tpu_estimator.py:557] Init TPU system
I0814 20:46:52.080569 140587296523712 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:46:52.081773 140586391947008 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:46:52.082640 140586383554304 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:46:52.150435 140587296523712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:46:52.180556 140587296523712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:46:52.180980 140587296523712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:46:52.213346 140586375161600 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:46:52.562748 140586375161600 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:46:52.973038 140586383554304 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:46:53.289066 140587296523712 evaluation.py:167] Evaluation [10/10]
I0814 20:46:53.289442 140587296523712 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:46:53.289536 140587296523712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:46:53.289871 140586391947008 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:46:53.290164 140586391947008 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:46:53.290404 140587296523712 error_handling.py:96] infeed marked as finished
I0814 20:46:53.290587 140587296523712 tpu_estimator.py:602] Stop output thread controller
I0814 20:46:53.290647 140587296523712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:46:53.290913 140586383554304 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:46:53.291090 140586383554304 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:46:53.291281 140587296523712 error_handling.py:96] outfeed marked as finished
I0814 20:46:53.291584 140587296523712 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:47:22.660907 140587296523712 evaluation.py:275] Finished evaluation at 2019-08-14-20:47:22
I0814 20:47:22.661251 140587296523712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9673, global_step = 30, loss = 0.14957742
I0814 20:47:26.963592 140587296523712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:47:27.864824 140587296523712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.14957742, 'global_step': 30, 'accuracy': 0.9673}

Removing gs://yangyou-mnist/log/#1565815449676371...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565815454845713...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565815449.v3-8-tpu#1565815530989429...
Removing gs://yangyou-mnist/log/checkpoint#1565815527733104...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565815462138942...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565815463021829...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565815467556201...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565815524514545...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565815525430915...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565815529966479...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565815644.v3-8-tpu#1565815647566729...
Removing gs://yangyou-mnist/log/eval/#1565815644348879...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:47:31.751209 140707754505664 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:47:31.752022 140707754505664 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:47:31.754632 140707754505664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:47:31.755464 140707754505664 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:47:31.756047 140707754505664 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:47:31.756176 140707754505664 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:47:32.176507 140707754505664 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:47:32.184158 140707754505664 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:47:32.188358 140707754505664 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:47:32.239847 140707754505664 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:47:32.240147 140707754505664 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:47:32.585323 140707754505664 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:47:32.706526 140707754505664 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:47:32.706816 140707754505664 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:47:32.886944 140707754505664 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff8ede2c1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff8f000b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:47:32.887384 140707754505664 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:47:33.204711 140707754505664 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:47:33.207831: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:47:33.226396 140707754505664 tpu_system_metadata.py:148] Found TPU system:
I0814 20:47:33.226655 140707754505664 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:47:33.227159 140707754505664 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:47:33.227220 140707754505664 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:47:33.227276 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:47:33.227586 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:47:33.227650 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:47:33.227703 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:47:33.227757 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:47:33.227804 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:47:33.227852 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:47:33.227897 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:47:33.227961 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:47:33.228008 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:47:33.228055 140707754505664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:47:33.234559 140707754505664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:47:33.247920 140707754505664 estimator.py:1145] Calling model_fn.
W0814 20:47:33.248608 140707754505664 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:47:33.513796 140707754505664 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:47:34.169778 140707754505664 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:47:34.233442 140707754505664 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:47:34.239558 140707754505664 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:47:34.433248 140707754505664 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:47:34.447546 140707754505664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:47:34.459965 140707754505664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:47:34.461080 140707754505664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:47:34.468468 140707754505664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:47:34.473846 140707754505664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:47:34.474066 140707754505664 optimization.py:36] ++++++ warmup starts at step 0, for 8 steps ++++++
W0814 20:47:34.486963 140707754505664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:47:34.600794 140707754505664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:47:34.644387 140707754505664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:47:34.689897 140707754505664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:47:34.743228 140707754505664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:47:34.913044 140707754505664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:47:34.963787 140707754505664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:47:35.013740 140707754505664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:47:35.065627 140707754505664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:47:35.120242 140707754505664 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:47:35.162400 140707754505664 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:47:35.179558 140707754505664 estimator.py:1147] Done calling model_fn.
I0814 20:47:38.561824 140707754505664 tpu_estimator.py:499] TPU job name worker
I0814 20:47:38.675020 140707754505664 monitored_session.py:240] Graph was finalized.
I0814 20:47:39.379250 140707754505664 session_manager.py:500] Running local_init_op.
I0814 20:47:39.440643 140707754505664 session_manager.py:502] Done running local_init_op.
I0814 20:47:42.166282 140707754505664 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:47:54.895586 140707754505664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:47:55.058003 140707754505664 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:47:55.058522 140707754505664 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:47:55.058948: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:47:55.063924 140707754505664 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:47:55.066165 140707754505664 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:47:55.069827 140707754505664 tpu_estimator.py:557] Init TPU system
I0814 20:48:36.011121 140707754505664 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 20:48:36.012255 140706858387200 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:48:36.013117 140706849994496 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:48:36.079029 140706841601792 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:48:36.081924 140707754505664 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:48:36.083779 140707754505664 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 20:48:36.237332 140706841601792 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:48:40.840867 140706849994496 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:48:45.489401 140707754505664 basic_session_run_hooks.py:262] loss = 0.15076992, step = 30
I0814 20:48:45.492042 140707754505664 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:48:59.262155 140707754505664 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:48:59.262438 140707754505664 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:48:59.262752 140706858387200 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:48:59.263046 140706858387200 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:48:59.263267 140707754505664 error_handling.py:96] infeed marked as finished
I0814 20:48:59.263478 140707754505664 tpu_estimator.py:602] Stop output thread controller
I0814 20:48:59.263533 140707754505664 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:48:59.263732 140706849994496 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:48:59.263907 140706849994496 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:48:59.264074 140707754505664 error_handling.py:96] outfeed marked as finished
I0814 20:48:59.264228 140707754505664 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:49:06.380563 140707754505664 estimator.py:368] Loss for final step: 0.15076992.
I0814 20:49:06.381360 140707754505664 error_handling.py:96] training_loop marked as finished
I0814 20:49:07.170217 140707754505664 estimator.py:1145] Calling model_fn.
E0814 20:49:07.887639 140707754505664 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:49:08.124965 140707754505664 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:49:08.149646 140707754505664 estimator.py:1147] Done calling model_fn.
I0814 20:49:08.167782 140707754505664 evaluation.py:255] Starting evaluation at 2019-08-14T20:49:08Z
I0814 20:49:08.168029 140707754505664 tpu_estimator.py:499] TPU job name worker
I0814 20:49:08.252823 140707754505664 monitored_session.py:240] Graph was finalized.
W0814 20:49:08.253535 140707754505664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:49:08.446717 140707754505664 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:49:11.335766 140707754505664 session_manager.py:500] Running local_init_op.
I0814 20:49:11.365791 140707754505664 session_manager.py:502] Done running local_init_op.
I0814 20:49:11.415532 140707754505664 tpu_estimator.py:557] Init TPU system
I0814 20:50:20.060547 140707754505664 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:50:20.061664 140706854717184 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:50:20.062361 140706846324480 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:50:20.129370 140707754505664 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:50:20.154387 140707754505664 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:50:20.154732 140707754505664 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:50:20.196198 140706832946944 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:50:20.355951 140706832946944 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:50:20.950349 140706846324480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:50:21.277760 140707754505664 evaluation.py:167] Evaluation [10/10]
I0814 20:50:21.278158 140707754505664 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:50:21.278233 140707754505664 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:50:21.278487 140706854717184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:50:21.278749 140706854717184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:50:21.278983 140707754505664 error_handling.py:96] infeed marked as finished
I0814 20:50:21.279164 140707754505664 tpu_estimator.py:602] Stop output thread controller
I0814 20:50:21.279222 140707754505664 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:50:21.279412 140706846324480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:50:21.279638 140706846324480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:50:21.279841 140707754505664 error_handling.py:96] outfeed marked as finished
I0814 20:50:21.280004 140707754505664 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:50:50.425729 140707754505664 evaluation.py:275] Finished evaluation at 2019-08-14-20:50:50
I0814 20:50:50.426042 140707754505664 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9676, global_step = 30, loss = 0.12302317
I0814 20:50:55.323194 140707754505664 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:50:56.241605 140707754505664 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12302317, 'global_step': 30, 'accuracy': 0.9676}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565815669526061...
Removing gs://yangyou-mnist/log/checkpoint#1565815735735912...
Removing gs://yangyou-mnist/log/#1565815656721334...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565815656.v3-8-tpu#1565815738938402...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565815661599210...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565815668633883...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565815732630207...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565815674353660...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565815733515854...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565815737955775...
Removing gs://yangyou-mnist/log/eval/#1565815852245943...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565815852.v3-8-tpu#1565815855926488...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:51:00.275837 139969130829248 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:51:00.276678 139969130829248 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:51:00.279413 139969130829248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:51:00.280227 139969130829248 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:51:00.281059 139969130829248 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:51:00.281196 139969130829248 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:51:00.697014 139969130829248 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:51:00.705009 139969130829248 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:51:00.709284 139969130829248 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:51:00.826560 139969130829248 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:51:00.826869 139969130829248 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:51:00.981369 139969130829248 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:51:01.032439 139969130829248 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:51:01.032742 139969130829248 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:51:01.295605 139969130829248 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4cf47be090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4cf699d210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:51:01.295975 139969130829248 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:51:01.615104 139969130829248 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:51:01.618211: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:51:01.631860 139969130829248 tpu_system_metadata.py:148] Found TPU system:
I0814 20:51:01.632117 139969130829248 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:51:01.632683 139969130829248 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:51:01.632750 139969130829248 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:51:01.632802 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:51:01.633111 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:51:01.633171 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:51:01.633222 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:51:01.633271 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:51:01.633328 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:51:01.633389 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:51:01.633438 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:51:01.633490 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:51:01.633537 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:51:01.633584 139969130829248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:51:01.639885 139969130829248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:51:01.652678 139969130829248 estimator.py:1145] Calling model_fn.
W0814 20:51:01.653284 139969130829248 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:51:01.929121 139969130829248 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:51:02.542733 139969130829248 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:51:02.605745 139969130829248 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:51:02.611803 139969130829248 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:51:02.794467 139969130829248 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:51:02.808163 139969130829248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:51:02.820368 139969130829248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:51:02.821484 139969130829248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:51:02.828547 139969130829248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:51:02.833894 139969130829248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:51:02.834111 139969130829248 optimization.py:36] ++++++ warmup starts at step 0, for 9 steps ++++++
W0814 20:51:02.846779 139969130829248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:51:02.957547 139969130829248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:51:02.999767 139969130829248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:51:03.045145 139969130829248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:51:03.098124 139969130829248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:51:03.273091 139969130829248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:51:03.322408 139969130829248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:51:03.370918 139969130829248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:51:03.421519 139969130829248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:51:03.467889 139969130829248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:51:03.509977 139969130829248 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:51:03.526268 139969130829248 estimator.py:1147] Done calling model_fn.
I0814 20:51:07.023099 139969130829248 tpu_estimator.py:499] TPU job name worker
I0814 20:51:07.134468 139969130829248 monitored_session.py:240] Graph was finalized.
I0814 20:51:07.848028 139969130829248 session_manager.py:500] Running local_init_op.
I0814 20:51:07.911658 139969130829248 session_manager.py:502] Done running local_init_op.
I0814 20:51:11.189852 139969130829248 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:51:24.163713 139969130829248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:51:24.308716 139969130829248 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:51:24.309212 139969130829248 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:51:24.309631: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:51:24.315099 139969130829248 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:51:24.317276 139969130829248 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:51:24.321059 139969130829248 tpu_estimator.py:557] Init TPU system
I0814 20:52:04.133341 139969130829248 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 20:52:04.134380 139968368846592 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:52:04.134886 139968018118400 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:52:04.198702 139969130829248 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:52:04.199640 139969130829248 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 20:52:04.263887 139968009725696 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:52:04.772078 139968009725696 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:52:08.944159 139968018118400 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:52:13.262495 139969130829248 basic_session_run_hooks.py:262] loss = 0.07989777, step = 30
I0814 20:52:13.265027 139969130829248 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:52:27.091876 139969130829248 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:52:27.092232 139969130829248 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:52:27.092513 139968368846592 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:52:27.092639 139968368846592 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:52:27.092822 139969130829248 error_handling.py:96] infeed marked as finished
I0814 20:52:27.092930 139969130829248 tpu_estimator.py:602] Stop output thread controller
I0814 20:52:27.092984 139969130829248 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:52:27.093136 139968018118400 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:52:27.093218 139968018118400 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:52:27.093379 139969130829248 error_handling.py:96] outfeed marked as finished
I0814 20:52:27.093472 139969130829248 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:52:34.909951 139969130829248 estimator.py:368] Loss for final step: 0.07989777.
I0814 20:52:34.910758 139969130829248 error_handling.py:96] training_loop marked as finished
I0814 20:52:35.629312 139969130829248 estimator.py:1145] Calling model_fn.
E0814 20:52:36.415204 139969130829248 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:52:36.653294 139969130829248 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:52:36.676258 139969130829248 estimator.py:1147] Done calling model_fn.
I0814 20:52:36.693238 139969130829248 evaluation.py:255] Starting evaluation at 2019-08-14T20:52:36Z
I0814 20:52:36.693480 139969130829248 tpu_estimator.py:499] TPU job name worker
I0814 20:52:36.773726 139969130829248 monitored_session.py:240] Graph was finalized.
W0814 20:52:36.774437 139969130829248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:52:36.980050 139969130829248 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:52:39.829952 139969130829248 session_manager.py:500] Running local_init_op.
I0814 20:52:39.856528 139969130829248 session_manager.py:502] Done running local_init_op.
I0814 20:52:39.906302 139969130829248 tpu_estimator.py:557] Init TPU system
I0814 20:53:48.058883 139969130829248 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:53:48.059863 139968018118400 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:53:48.060297 139968009725696 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:53:48.129993 139969130829248 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:53:48.153675 139969130829248 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:53:48.154037 139969130829248 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:53:48.192519 139968001332992 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:53:48.554431 139968001332992 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:53:48.983901 139968009725696 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:53:49.240050 139969130829248 evaluation.py:167] Evaluation [10/10]
I0814 20:53:49.240437 139969130829248 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:53:49.240533 139969130829248 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:53:49.240717 139968018118400 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:53:49.240813 139968018118400 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:53:49.240952 139969130829248 error_handling.py:96] infeed marked as finished
I0814 20:53:49.241130 139969130829248 tpu_estimator.py:602] Stop output thread controller
I0814 20:53:49.241180 139969130829248 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:53:49.241345 139968009725696 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:53:49.241417 139968009725696 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:53:49.241538 139969130829248 error_handling.py:96] outfeed marked as finished
I0814 20:53:49.241615 139969130829248 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:54:18.625099 139969130829248 evaluation.py:275] Finished evaluation at 2019-08-14-20:54:18
I0814 20:54:18.625474 139969130829248 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9807, global_step = 30, loss = 0.07366216
I0814 20:54:23.149380 139969130829248 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:54:23.978157 139969130829248 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07366216, 'global_step': 30, 'accuracy': 0.9807}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565815878880078...
Removing gs://yangyou-mnist/log/#1565815865165809...
Removing gs://yangyou-mnist/log/checkpoint#1565815943467524...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565815940322640...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565815865.v3-8-tpu#1565815946767755...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565815883650348...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565815870608185...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565815877862406...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565815941292823...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565815945772860...
Removing gs://yangyou-mnist/log/eval/#1565816060469975...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565816060.v3-8-tpu#1565816063671736...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:54:27.940114 140561863448000 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:54:27.940973 140561863448000 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:54:27.943598 140561863448000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:54:27.944580 140561863448000 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:54:27.945183 140561863448000 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:54:27.945329 140561863448000 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:54:28.365530 140561863448000 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:54:28.372617 140561863448000 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:54:28.376600 140561863448000 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:54:28.435344 140561863448000 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:54:28.435645 140561863448000 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:54:28.761571 140561863448000 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:54:28.819169 140561863448000 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:54:28.819439 140561863448000 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:54:29.091536 140561863448000 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd6f619e1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd6f837d210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:54:29.092005 140561863448000 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:54:29.428107 140561863448000 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:54:29.431010: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:54:29.445239 140561863448000 tpu_system_metadata.py:148] Found TPU system:
I0814 20:54:29.445483 140561863448000 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:54:29.446060 140561863448000 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:54:29.446120 140561863448000 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:54:29.446177 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:54:29.446458 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:54:29.446515 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:54:29.446566 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:54:29.446630 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:54:29.446679 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:54:29.446726 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:54:29.446773 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:54:29.446820 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:54:29.446866 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:54:29.446913 140561863448000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:54:29.453217 140561863448000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:54:29.466038 140561863448000 estimator.py:1145] Calling model_fn.
W0814 20:54:29.466659 140561863448000 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:54:29.735193 140561863448000 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:54:30.411427 140561863448000 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:54:30.474039 140561863448000 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:54:30.479985 140561863448000 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:54:30.664225 140561863448000 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:54:30.678370 140561863448000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:54:30.690356 140561863448000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:54:30.691454 140561863448000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:54:30.698767 140561863448000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:54:30.704020 140561863448000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:54:30.704232 140561863448000 optimization.py:36] ++++++ warmup starts at step 0, for 9 steps ++++++
W0814 20:54:30.716794 140561863448000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:54:30.828177 140561863448000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:54:30.870744 140561863448000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:54:30.915566 140561863448000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:54:30.967529 140561863448000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:54:31.133878 140561863448000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:54:31.184139 140561863448000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:54:31.233560 140561863448000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:54:31.291786 140561863448000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:54:31.337548 140561863448000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:54:31.379348 140561863448000 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:54:31.395725 140561863448000 estimator.py:1147] Done calling model_fn.
I0814 20:54:35.933109 140561863448000 tpu_estimator.py:499] TPU job name worker
I0814 20:54:36.045526 140561863448000 monitored_session.py:240] Graph was finalized.
I0814 20:54:36.732472 140561863448000 session_manager.py:500] Running local_init_op.
I0814 20:54:36.798347 140561863448000 session_manager.py:502] Done running local_init_op.
I0814 20:54:39.567485 140561863448000 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:54:52.103810 140561863448000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:54:52.257859 140561863448000 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:54:52.258268 140561863448000 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:54:52.258661: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:54:52.263494 140561863448000 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:54:52.265770 140561863448000 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:54:52.271210 140561863448000 tpu_estimator.py:557] Init TPU system
I0814 20:55:32.104480 140561863448000 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 20:55:32.105453 140560967128832 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:55:32.105995 140560958736128 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:55:32.166132 140560950343424 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:55:32.171561 140561863448000 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:55:32.172888 140561863448000 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 20:55:32.519973 140560950343424 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 20:55:37.377219 140560958736128 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:55:42.152112 140561863448000 basic_session_run_hooks.py:262] loss = 0.07024056, step = 30
I0814 20:55:42.154973 140561863448000 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:55:55.628674 140561863448000 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:55:55.628945 140561863448000 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:55:55.629128 140560967128832 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:55:55.629240 140560967128832 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:55:55.629369 140561863448000 error_handling.py:96] infeed marked as finished
I0814 20:55:55.629472 140561863448000 tpu_estimator.py:602] Stop output thread controller
I0814 20:55:55.629522 140561863448000 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:55:55.629638 140560958736128 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:55:55.629717 140560958736128 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:55:55.629826 140561863448000 error_handling.py:96] outfeed marked as finished
I0814 20:55:55.629914 140561863448000 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:56:02.659514 140561863448000 estimator.py:368] Loss for final step: 0.07024056.
I0814 20:56:02.660362 140561863448000 error_handling.py:96] training_loop marked as finished
I0814 20:56:03.517566 140561863448000 estimator.py:1145] Calling model_fn.
E0814 20:56:04.214708 140561863448000 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:56:04.444478 140561863448000 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:56:04.466659 140561863448000 estimator.py:1147] Done calling model_fn.
I0814 20:56:04.485755 140561863448000 evaluation.py:255] Starting evaluation at 2019-08-14T20:56:04Z
I0814 20:56:04.485997 140561863448000 tpu_estimator.py:499] TPU job name worker
I0814 20:56:04.572495 140561863448000 monitored_session.py:240] Graph was finalized.
W0814 20:56:04.573276 140561863448000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:56:04.776936 140561863448000 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:56:07.781672 140561863448000 session_manager.py:500] Running local_init_op.
I0814 20:56:07.807514 140561863448000 session_manager.py:502] Done running local_init_op.
I0814 20:56:07.866919 140561863448000 tpu_estimator.py:557] Init TPU system
I0814 20:57:16.105678 140561863448000 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 20:57:16.106852 140560963458816 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:57:16.107669 140560955066112 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:57:16.175232 140561863448000 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:57:16.200978 140561863448000 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 20:57:16.201396 140561863448000 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 20:57:16.240520 140560941688576 transport.py:157] Attempting refresh to obtain initial access_token
W0814 20:57:16.536346 140560941688576 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:57:16.975169 140560955066112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:57:17.365689 140561863448000 evaluation.py:167] Evaluation [10/10]
I0814 20:57:17.366074 140561863448000 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:57:17.366164 140561863448000 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:57:17.366447 140560963458816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:57:17.366817 140560963458816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:57:17.367048 140561863448000 error_handling.py:96] infeed marked as finished
I0814 20:57:17.367239 140561863448000 tpu_estimator.py:602] Stop output thread controller
I0814 20:57:17.367302 140561863448000 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:57:17.367542 140560955066112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:57:17.367732 140560955066112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:57:17.367896 140561863448000 error_handling.py:96] outfeed marked as finished
I0814 20:57:17.368030 140561863448000 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:57:46.631649 140561863448000 evaluation.py:275] Finished evaluation at 2019-08-14-20:57:46
I0814 20:57:46.632045 140561863448000 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9782, global_step = 30, loss = 0.061628867
I0814 20:57:51.135531 140561863448000 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 20:57:51.956861 140561863448000 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.061628867, 'global_step': 30, 'accuracy': 0.9782}

Removing gs://yangyou-mnist/log/#1565816073018138...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565816073.v3-8-tpu#1565816155324225...
Removing gs://yangyou-mnist/log/checkpoint#1565816151978470...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565816086903169...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565816091551681...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565816085983245...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565816149917194...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565816078980629...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565816148938762...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565816154391566...
Removing gs://yangyou-mnist/log/eval/#1565816268306620...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565816268.v3-8-tpu#1565816271652261...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 20:57:55.775564 140614895191488 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 20:57:55.776370 140614895191488 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 20:57:55.779082 140614895191488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 20:57:55.779880 140614895191488 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 20:57:55.780479 140614895191488 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 20:57:55.780644 140614895191488 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 20:57:56.194998 140614895191488 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 20:57:56.202054 140614895191488 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 20:57:56.206238 140614895191488 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:57:56.263535 140614895191488 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:57:56.263868 140614895191488 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:57:56.530626 140614895191488 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 20:57:56.584090 140614895191488 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 20:57:56.584425 140614895191488 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:57:56.853060 140614895191488 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe34f0a1290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe3512801d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 20:57:56.853446 140614895191488 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 20:57:57.178241 140614895191488 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 20:57:57.181712: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:57:57.193253 140614895191488 tpu_system_metadata.py:148] Found TPU system:
I0814 20:57:57.193605 140614895191488 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 20:57:57.194128 140614895191488 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 20:57:57.194205 140614895191488 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 20:57:57.194261 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 20:57:57.194571 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 20:57:57.194627 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 20:57:57.194677 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 20:57:57.194725 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 20:57:57.194772 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 20:57:57.194818 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 20:57:57.194880 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 20:57:57.194927 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 20:57:57.194977 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 20:57:57.195024 140614895191488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 20:57:57.201040 140614895191488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 20:57:57.213627 140614895191488 estimator.py:1145] Calling model_fn.
W0814 20:57:57.214236 140614895191488 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 20:57:57.484246 140614895191488 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 20:57:58.067593 140614895191488 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 20:57:58.130132 140614895191488 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 20:57:58.136178 140614895191488 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:57:58.316528 140614895191488 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 20:57:58.330137 140614895191488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 20:57:58.342024 140614895191488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 20:57:58.343158 140614895191488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 20:57:58.350087 140614895191488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 20:57:58.355221 140614895191488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 20:57:58.355441 140614895191488 optimization.py:36] ++++++ warmup starts at step 0, for 9 steps ++++++
W0814 20:57:58.367885 140614895191488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 20:57:58.476834 140614895191488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 20:57:58.518054 140614895191488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:57:58.562472 140614895191488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:57:58.613477 140614895191488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:57:58.779288 140614895191488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:57:58.831511 140614895191488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:57:58.880114 140614895191488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:57:58.929932 140614895191488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:57:58.974343 140614895191488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 20:57:59.015410 140614895191488 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 20:57:59.031840 140614895191488 estimator.py:1147] Done calling model_fn.
I0814 20:58:02.763611 140614895191488 tpu_estimator.py:499] TPU job name worker
I0814 20:58:02.877124 140614895191488 monitored_session.py:240] Graph was finalized.
I0814 20:58:04.614151 140614895191488 session_manager.py:500] Running local_init_op.
I0814 20:58:04.663911 140614895191488 session_manager.py:502] Done running local_init_op.
I0814 20:58:07.532835 140614895191488 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 20:58:20.142247 140614895191488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 20:58:20.302042 140614895191488 util.py:98] Initialized dataset iterators in 0 seconds
I0814 20:58:20.302589 140614895191488 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 20:58:20.302992: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 20:58:20.307748 140614895191488 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 20:58:20.309825 140614895191488 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 20:58:20.314017 140614895191488 tpu_estimator.py:557] Init TPU system
I0814 20:59:00.115097 140614895191488 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 20:59:00.116156 140613991257856 tpu_estimator.py:514] Starting infeed thread controller.
I0814 20:59:00.119007 140613982865152 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 20:59:00.189277 140613974472448 transport.py:157] Attempting refresh to obtain initial access_token
I0814 20:59:00.191227 140614895191488 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 20:59:00.192547 140614895191488 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 20:59:00.475774 140613974472448 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 20:59:05.019396 140613982865152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 20:59:09.810348 140614895191488 basic_session_run_hooks.py:262] loss = 0.0719922, step = 30
I0814 20:59:09.812947 140614895191488 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 20:59:22.909426 140614895191488 tpu_estimator.py:598] Stop infeed thread controller
I0814 20:59:22.909722 140614895191488 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 20:59:22.909940 140613991257856 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 20:59:22.910042 140613991257856 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 20:59:22.910171 140614895191488 error_handling.py:96] infeed marked as finished
I0814 20:59:22.910288 140614895191488 tpu_estimator.py:602] Stop output thread controller
I0814 20:59:22.910371 140614895191488 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 20:59:22.910484 140613982865152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 20:59:22.910554 140613982865152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 20:59:22.910664 140614895191488 error_handling.py:96] outfeed marked as finished
I0814 20:59:22.910742 140614895191488 tpu_estimator.py:606] Shutdown TPU system.
I0814 20:59:31.065131 140614895191488 estimator.py:368] Loss for final step: 0.0719922.
I0814 20:59:31.065936 140614895191488 error_handling.py:96] training_loop marked as finished
I0814 20:59:32.721904 140614895191488 estimator.py:1145] Calling model_fn.
E0814 20:59:33.485846 140614895191488 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 20:59:33.721831 140614895191488 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 20:59:33.744740 140614895191488 estimator.py:1147] Done calling model_fn.
I0814 20:59:33.762321 140614895191488 evaluation.py:255] Starting evaluation at 2019-08-14T20:59:33Z
I0814 20:59:33.762571 140614895191488 tpu_estimator.py:499] TPU job name worker
I0814 20:59:33.843102 140614895191488 monitored_session.py:240] Graph was finalized.
W0814 20:59:33.843925 140614895191488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 20:59:34.025957 140614895191488 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 20:59:36.980479 140614895191488 session_manager.py:500] Running local_init_op.
I0814 20:59:37.012109 140614895191488 session_manager.py:502] Done running local_init_op.
I0814 20:59:37.067876 140614895191488 tpu_estimator.py:557] Init TPU system
I0814 21:00:44.061038 140614895191488 tpu_estimator.py:566] Initialized TPU in 66 seconds
I0814 21:00:44.062109 140613991257856 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:00:44.062875 140613982865152 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:00:44.134372 140614895191488 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:00:44.163537 140614895191488 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:00:44.163978 140614895191488 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:00:44.204004 140613974472448 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:00:44.544327 140613974472448 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:00:44.980279 140613982865152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:00:45.284877 140614895191488 evaluation.py:167] Evaluation [10/10]
I0814 21:00:45.285271 140614895191488 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:00:45.285371 140614895191488 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:00:45.285651 140613991257856 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:00:45.286011 140613991257856 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:00:45.286256 140614895191488 error_handling.py:96] infeed marked as finished
I0814 21:00:45.286504 140614895191488 tpu_estimator.py:602] Stop output thread controller
I0814 21:00:45.286577 140614895191488 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:00:45.286842 140613982865152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:00:45.287020 140613982865152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:00:45.287190 140614895191488 error_handling.py:96] outfeed marked as finished
I0814 21:00:45.287323 140614895191488 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:01:14.644289 140614895191488 evaluation.py:275] Finished evaluation at 2019-08-14-21:01:14
I0814 21:01:14.644722 140614895191488 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9834, global_step = 30, loss = 0.05445028
I0814 21:01:19.066868 140614895191488 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:01:19.873388 140614895191488 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.05445028, 'global_step': 30, 'accuracy': 0.9834}

Removing gs://yangyou-mnist/log/#1565816280804332...
Removing gs://yangyou-mnist/log/checkpoint#1565816359503722...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565816295038656...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565816286943741...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565816299624262...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565816293999648...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565816281.v3-8-tpu#1565816362626500...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565816356655701...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565816357454288...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565816361704750...
Removing gs://yangyou-mnist/log/eval/#1565816476283506...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565816476.v3-8-tpu#1565816479565355...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:01:23.718419 140520222213568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:01:23.719238 140520222213568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:01:23.721949 140520222213568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:01:23.722834 140520222213568 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:01:23.723431 140520222213568 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:01:23.723568 140520222213568 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:01:24.140567 140520222213568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:01:24.147867 140520222213568 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:01:24.151843 140520222213568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:01:24.208235 140520222213568 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:01:24.208576 140520222213568 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:01:24.575634 140520222213568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:01:24.631886 140520222213568 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:01:24.632198 140520222213568 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:01:24.949686 140520222213568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fcd44171050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fcd46350210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:01:24.950110 140520222213568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:01:25.281075 140520222213568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:01:25.283973: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:01:25.300335 140520222213568 tpu_system_metadata.py:148] Found TPU system:
I0814 21:01:25.300631 140520222213568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:01:25.301229 140520222213568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:01:25.301290 140520222213568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:01:25.301345 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:01:25.301651 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:01:25.301708 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:01:25.301759 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:01:25.301809 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:01:25.301856 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:01:25.301906 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:01:25.301954 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:01:25.302011 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:01:25.302057 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:01:25.302107 140520222213568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:01:25.308226 140520222213568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:01:25.320564 140520222213568 estimator.py:1145] Calling model_fn.
W0814 21:01:25.321168 140520222213568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:01:25.583650 140520222213568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:01:26.169517 140520222213568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:01:26.232393 140520222213568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:01:26.245913 140520222213568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:01:26.428946 140520222213568 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:01:26.443284 140520222213568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:01:26.455909 140520222213568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:01:26.457031 140520222213568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:01:26.464158 140520222213568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:01:26.469482 140520222213568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:01:26.469717 140520222213568 optimization.py:36] ++++++ warmup starts at step 0, for 9 steps ++++++
W0814 21:01:26.482479 140520222213568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:01:26.593491 140520222213568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:01:26.636967 140520222213568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:01:26.682029 140520222213568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:01:26.734580 140520222213568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:01:26.903335 140520222213568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:01:26.954632 140520222213568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:01:27.005122 140520222213568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:01:27.055771 140520222213568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:01:27.102636 140520222213568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:01:27.145559 140520222213568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:01:27.162368 140520222213568 estimator.py:1147] Done calling model_fn.
I0814 21:01:30.683986 140520222213568 tpu_estimator.py:499] TPU job name worker
I0814 21:01:30.798619 140520222213568 monitored_session.py:240] Graph was finalized.
I0814 21:01:31.490293 140520222213568 session_manager.py:500] Running local_init_op.
I0814 21:01:31.540728 140520222213568 session_manager.py:502] Done running local_init_op.
I0814 21:01:34.248382 140520222213568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:01:46.490854 140520222213568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:01:46.661364 140520222213568 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:01:46.661880 140520222213568 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:01:46.662302: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:01:46.667293 140520222213568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:01:46.669799 140520222213568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:01:46.674163 140520222213568 tpu_estimator.py:557] Init TPU system
I0814 21:02:28.130733 140520222213568 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 21:02:28.131594 140519527442176 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:02:28.132074 140519049000704 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:02:28.195612 140519040608000 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:02:28.203321 140520222213568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:02:28.204277 140520222213568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:02:28.604485 140519040608000 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:02:32.986397 140519049000704 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:02:37.611757 140520222213568 basic_session_run_hooks.py:262] loss = 0.06873919, step = 30
I0814 21:02:37.613902 140520222213568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:02:50.857306 140520222213568 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:02:50.857604 140520222213568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:02:50.857961 140519527442176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:02:50.858282 140519527442176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:02:50.858685 140520222213568 error_handling.py:96] infeed marked as finished
I0814 21:02:50.858952 140520222213568 tpu_estimator.py:602] Stop output thread controller
I0814 21:02:50.859025 140520222213568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:02:50.859210 140519049000704 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:02:50.859386 140519049000704 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:02:50.859714 140520222213568 error_handling.py:96] outfeed marked as finished
I0814 21:02:50.859916 140520222213568 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:02:58.745663 140520222213568 estimator.py:368] Loss for final step: 0.06873919.
I0814 21:02:58.746570 140520222213568 error_handling.py:96] training_loop marked as finished
I0814 21:02:59.460952 140520222213568 estimator.py:1145] Calling model_fn.
E0814 21:03:00.241302 140520222213568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:03:00.468857 140520222213568 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:03:00.490892 140520222213568 estimator.py:1147] Done calling model_fn.
I0814 21:03:00.507704 140520222213568 evaluation.py:255] Starting evaluation at 2019-08-14T21:03:00Z
I0814 21:03:00.507939 140520222213568 tpu_estimator.py:499] TPU job name worker
I0814 21:03:00.586230 140520222213568 monitored_session.py:240] Graph was finalized.
W0814 21:03:00.586985 140520222213568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:03:00.779172 140520222213568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:03:03.456166 140520222213568 session_manager.py:500] Running local_init_op.
I0814 21:03:03.481148 140520222213568 session_manager.py:502] Done running local_init_op.
I0814 21:03:03.531553 140520222213568 tpu_estimator.py:557] Init TPU system
I0814 21:04:12.078999 140520222213568 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:04:12.079893 140519049000704 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:04:12.080311 140519040608000 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:04:12.147988 140520222213568 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:04:12.176714 140520222213568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:04:12.177062 140520222213568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:04:12.217689 140519032215296 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:04:12.358434 140519032215296 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:04:13.012922 140519040608000 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:04:13.286290 140520222213568 evaluation.py:167] Evaluation [10/10]
I0814 21:04:13.286623 140520222213568 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:04:13.286693 140520222213568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:04:13.286951 140519049000704 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:04:13.287056 140519049000704 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:04:13.287192 140520222213568 error_handling.py:96] infeed marked as finished
I0814 21:04:13.287283 140520222213568 tpu_estimator.py:602] Stop output thread controller
I0814 21:04:13.287333 140520222213568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:04:13.287451 140519040608000 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:04:13.287527 140519040608000 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:04:13.287642 140520222213568 error_handling.py:96] outfeed marked as finished
I0814 21:04:13.287719 140520222213568 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:04:42.456173 140520222213568 evaluation.py:275] Finished evaluation at 2019-08-14-21:04:42
I0814 21:04:42.456581 140520222213568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9798, global_step = 30, loss = 0.062051862
I0814 21:04:46.900245 140520222213568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:04:47.756468 140520222213568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.062051862, 'global_step': 30, 'accuracy': 0.9798}

Removing gs://yangyou-mnist/log/#1565816488692191...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565816501526142...
Removing gs://yangyou-mnist/log/checkpoint#1565816567479434...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565816488.v3-8-tpu#1565816570558601...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565816506015038...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565816564635004...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565816493719453...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565816500602339...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565816565425669...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565816569640877...
Removing gs://yangyou-mnist/log/eval/#1565816684140563...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565816684.v3-8-tpu#1565816687414314...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:04:51.624875 140115743708608 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:04:51.625689 140115743708608 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:04:51.628360 140115743708608 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:04:51.629244 140115743708608 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:04:51.629829 140115743708608 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:04:51.629968 140115743708608 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:04:52.050174 140115743708608 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:04:52.057002 140115743708608 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:04:52.061141 140115743708608 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:04:52.185014 140115743708608 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:04:52.185306 140115743708608 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:04:52.570218 140115743708608 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:04:53.341556 140115743708608 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:04:53.341885 140115743708608 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:04:53.595549 140115743708608 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f6f174ae190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f6f1968d210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:04:53.595920 140115743708608 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:04:53.920993 140115743708608 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:04:53.923931: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:04:53.937174 140115743708608 tpu_system_metadata.py:148] Found TPU system:
I0814 21:04:53.937406 140115743708608 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:04:53.937891 140115743708608 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:04:53.937947 140115743708608 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:04:53.938002 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:04:53.938405 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:04:53.938478 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:04:53.938534 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:04:53.938581 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:04:53.938627 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:04:53.938679 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:04:53.938726 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:04:53.938776 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:04:53.938822 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:04:53.938869 140115743708608 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:04:53.945317 140115743708608 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:04:53.958210 140115743708608 estimator.py:1145] Calling model_fn.
W0814 21:04:53.958832 140115743708608 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:04:54.227574 140115743708608 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:04:54.804727 140115743708608 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:04:54.867048 140115743708608 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:04:54.873162 140115743708608 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:04:55.056968 140115743708608 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:04:55.070707 140115743708608 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:04:55.089978 140115743708608 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:04:55.091399 140115743708608 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:04:55.098893 140115743708608 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:04:55.104306 140115743708608 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:04:55.104578 140115743708608 optimization.py:36] ++++++ warmup starts at step 0, for 9 steps ++++++
W0814 21:04:55.117270 140115743708608 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:04:55.228246 140115743708608 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:04:55.270642 140115743708608 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:04:55.315267 140115743708608 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:04:55.367909 140115743708608 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:04:55.537561 140115743708608 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:04:55.588228 140115743708608 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:04:55.637708 140115743708608 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:04:55.689547 140115743708608 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:04:55.736361 140115743708608 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:04:55.778512 140115743708608 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:04:55.795152 140115743708608 estimator.py:1147] Done calling model_fn.
I0814 21:04:59.297698 140115743708608 tpu_estimator.py:499] TPU job name worker
I0814 21:04:59.410895 140115743708608 monitored_session.py:240] Graph was finalized.
I0814 21:05:00.098113 140115743708608 session_manager.py:500] Running local_init_op.
I0814 21:05:00.147156 140115743708608 session_manager.py:502] Done running local_init_op.
I0814 21:05:02.920953 140115743708608 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:05:15.308814 140115743708608 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:05:15.478158 140115743708608 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:05:15.478578 140115743708608 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:05:15.478968: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:05:15.484041 140115743708608 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:05:15.486115 140115743708608 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:05:15.489953 140115743708608 tpu_estimator.py:557] Init TPU system
I0814 21:05:56.109962 140115743708608 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 21:05:56.110883 140114709702400 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:05:56.111340 140114701309696 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:05:56.175760 140115743708608 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:05:56.177232 140114692916992 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:05:56.177412 140115743708608 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:05:56.511528 140114692916992 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:06:00.965471 140114701309696 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:06:05.501446 140115743708608 basic_session_run_hooks.py:262] loss = 0.074573785, step = 30
I0814 21:06:05.503891 140115743708608 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:06:19.446618 140115743708608 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:06:19.446930 140115743708608 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:06:19.447134 140114709702400 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:06:19.447258 140114709702400 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:06:19.447407 140115743708608 error_handling.py:96] infeed marked as finished
I0814 21:06:19.447510 140115743708608 tpu_estimator.py:602] Stop output thread controller
I0814 21:06:19.447565 140115743708608 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:06:19.447704 140114701309696 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:06:19.447787 140114701309696 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:06:19.447920 140115743708608 error_handling.py:96] outfeed marked as finished
I0814 21:06:19.448023 140115743708608 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:06:26.630117 140115743708608 estimator.py:368] Loss for final step: 0.074573785.
I0814 21:06:26.630945 140115743708608 error_handling.py:96] training_loop marked as finished
I0814 21:06:27.419179 140115743708608 estimator.py:1145] Calling model_fn.
E0814 21:06:28.162245 140115743708608 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:06:28.404155 140115743708608 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:06:28.426934 140115743708608 estimator.py:1147] Done calling model_fn.
I0814 21:06:28.443747 140115743708608 evaluation.py:255] Starting evaluation at 2019-08-14T21:06:28Z
I0814 21:06:28.443979 140115743708608 tpu_estimator.py:499] TPU job name worker
I0814 21:06:28.526747 140115743708608 monitored_session.py:240] Graph was finalized.
W0814 21:06:28.527489 140115743708608 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:06:28.725888 140115743708608 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:06:31.716166 140115743708608 session_manager.py:500] Running local_init_op.
I0814 21:06:31.749594 140115743708608 session_manager.py:502] Done running local_init_op.
I0814 21:06:31.806210 140115743708608 tpu_estimator.py:557] Init TPU system
I0814 21:07:40.043132 140115743708608 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:07:40.043972 140114709440256 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:07:40.044444 140114701047552 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:07:40.111237 140115743708608 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:07:40.153414 140115743708608 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:07:40.153918 140115743708608 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:07:40.190269 140114692654848 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:07:40.524893 140114692654848 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:07:40.921426 140114701047552 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:07:41.392582 140115743708608 evaluation.py:167] Evaluation [10/10]
I0814 21:07:41.392908 140115743708608 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:07:41.392982 140115743708608 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:07:41.393177 140114709440256 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:07:41.393299 140114709440256 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:07:41.393439 140115743708608 error_handling.py:96] infeed marked as finished
I0814 21:07:41.393536 140115743708608 tpu_estimator.py:602] Stop output thread controller
I0814 21:07:41.393589 140115743708608 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:07:41.393717 140114701047552 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:07:41.393800 140114701047552 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:07:41.393970 140115743708608 error_handling.py:96] outfeed marked as finished
I0814 21:07:41.394059 140115743708608 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:08:10.614607 140115743708608 evaluation.py:275] Finished evaluation at 2019-08-14-21:08:10
I0814 21:08:10.614978 140115743708608 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9808, global_step = 30, loss = 0.061575245
I0814 21:08:15.018982 140115743708608 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:08:15.874404 140115743708608 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.061575245, 'global_step': 30, 'accuracy': 0.9808}

Removing gs://yangyou-mnist/log/checkpoint#1565816775894895...
Removing gs://yangyou-mnist/log/#1565816697341552...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565816697.v3-8-tpu#1565816779135748...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565816709240612...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565816702329151...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565816714714580...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565816710086434...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565816773624541...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565816772555629...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565816778158287...
Removing gs://yangyou-mnist/log/eval/#1565816892295333...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565816892.v3-8-tpu#1565816895571996...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:08:19.629451 139965533062592 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:08:19.630206 139965533062592 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:08:19.632855 139965533062592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:08:19.633703 139965533062592 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:08:19.634288 139965533062592 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:08:19.634416 139965533062592 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:08:20.036190 139965533062592 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:08:20.044342 139965533062592 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:08:20.048815 139965533062592 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:08:20.107647 139965533062592 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:08:20.107934 139965533062592 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:08:20.523988 139965533062592 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:08:20.576014 139965533062592 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:08:20.576294 139965533062592 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:08:20.980355 139965533062592 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4c1e08e350>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4c20284210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:08:20.980802 139965533062592 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:08:21.318197 139965533062592 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:08:21.321030: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:08:21.333873 139965533062592 tpu_system_metadata.py:148] Found TPU system:
I0814 21:08:21.334146 139965533062592 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:08:21.334758 139965533062592 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:08:21.334830 139965533062592 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:08:21.334891 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:08:21.335232 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:08:21.335299 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:08:21.335357 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:08:21.335413 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:08:21.335467 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:08:21.335536 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:08:21.335589 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:08:21.335642 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:08:21.335695 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:08:21.335755 139965533062592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:08:21.342161 139965533062592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:08:21.355604 139965533062592 estimator.py:1145] Calling model_fn.
W0814 21:08:21.356250 139965533062592 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:08:21.651774 139965533062592 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:08:22.057606 139965533062592 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:08:22.119087 139965533062592 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:08:22.124869 139965533062592 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:08:22.302789 139965533062592 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:08:22.316829 139965533062592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:08:22.329394 139965533062592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:08:22.330456 139965533062592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:08:22.337361 139965533062592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:08:22.342636 139965533062592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:08:22.342816 139965533062592 optimization.py:36] ++++++ warmup starts at step 0, for 9 steps ++++++
W0814 21:08:22.355014 139965533062592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:08:22.462534 139965533062592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:08:22.503793 139965533062592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:08:22.547652 139965533062592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:08:22.598751 139965533062592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:08:22.770839 139965533062592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:08:22.819775 139965533062592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:08:22.867139 139965533062592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:08:22.915343 139965533062592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:08:22.959520 139965533062592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:08:23.001195 139965533062592 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:08:23.017887 139965533062592 estimator.py:1147] Done calling model_fn.
I0814 21:08:26.584048 139965533062592 tpu_estimator.py:499] TPU job name worker
I0814 21:08:26.694519 139965533062592 monitored_session.py:240] Graph was finalized.
I0814 21:08:27.396437 139965533062592 session_manager.py:500] Running local_init_op.
I0814 21:08:27.444989 139965533062592 session_manager.py:502] Done running local_init_op.
I0814 21:08:30.166491 139965533062592 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:08:43.635796 139965533062592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:08:43.802253 139965533062592 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:08:43.802778 139965533062592 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:08:43.804444: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:08:43.809703 139965533062592 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:08:43.811885 139965533062592 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:08:43.816243 139965533062592 tpu_estimator.py:557] Init TPU system
I0814 21:09:24.110439 139965533062592 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 21:09:24.111516 139964636714752 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:09:24.112284 139964628322048 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:09:24.180866 139964619929344 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:09:24.182351 139965533062592 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:09:24.183593 139965533062592 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:09:24.454739 139964619929344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:09:29.051867 139964628322048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:09:33.415268 139965533062592 basic_session_run_hooks.py:262] loss = 0.0890469, step = 30
I0814 21:09:33.417618 139965533062592 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:09:46.976985 139965533062592 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:09:46.977276 139965533062592 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:09:46.977462 139964636714752 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:09:46.977556 139964636714752 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:09:46.977691 139965533062592 error_handling.py:96] infeed marked as finished
I0814 21:09:46.977785 139965533062592 tpu_estimator.py:602] Stop output thread controller
I0814 21:09:46.977843 139965533062592 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:09:46.977955 139964628322048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:09:46.978024 139964628322048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:09:46.978135 139965533062592 error_handling.py:96] outfeed marked as finished
I0814 21:09:46.978214 139965533062592 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:09:54.566087 139965533062592 estimator.py:368] Loss for final step: 0.0890469.
I0814 21:09:54.566905 139965533062592 error_handling.py:96] training_loop marked as finished
I0814 21:09:55.368340 139965533062592 estimator.py:1145] Calling model_fn.
E0814 21:09:56.076389 139965533062592 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:09:56.314574 139965533062592 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:09:56.339498 139965533062592 estimator.py:1147] Done calling model_fn.
I0814 21:09:56.359288 139965533062592 evaluation.py:255] Starting evaluation at 2019-08-14T21:09:56Z
I0814 21:09:56.359554 139965533062592 tpu_estimator.py:499] TPU job name worker
I0814 21:09:56.445720 139965533062592 monitored_session.py:240] Graph was finalized.
W0814 21:09:56.446522 139965533062592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:09:56.645329 139965533062592 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:09:59.448023 139965533062592 session_manager.py:500] Running local_init_op.
I0814 21:09:59.473263 139965533062592 session_manager.py:502] Done running local_init_op.
I0814 21:09:59.521948 139965533062592 tpu_estimator.py:557] Init TPU system
I0814 21:11:08.041335 139965533062592 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:11:08.042215 139964633044736 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:11:08.042709 139964624652032 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:11:08.112481 139965533062592 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:11:08.137698 139965533062592 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:11:08.138072 139965533062592 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:11:08.239626 139964611274496 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:11:08.527941 139964611274496 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:11:08.961402 139964624652032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:11:09.233607 139965533062592 evaluation.py:167] Evaluation [10/10]
I0814 21:11:09.234030 139965533062592 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:11:09.234126 139965533062592 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:11:09.234308 139964633044736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:11:09.234400 139964633044736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:11:09.234566 139965533062592 error_handling.py:96] infeed marked as finished
I0814 21:11:09.234662 139965533062592 tpu_estimator.py:602] Stop output thread controller
I0814 21:11:09.234709 139965533062592 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:11:09.234817 139964624652032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:11:09.234896 139964624652032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:11:09.235009 139965533062592 error_handling.py:96] outfeed marked as finished
I0814 21:11:09.235094 139965533062592 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:11:38.618380 139965533062592 evaluation.py:275] Finished evaluation at 2019-08-14-21:11:38
I0814 21:11:38.618818 139965533062592 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9767, global_step = 30, loss = 0.069356516
I0814 21:11:42.982105 139965533062592 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:11:43.756745 139965533062592 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.069356516, 'global_step': 30, 'accuracy': 0.9767}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565816917790243...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565816923127325...
Removing gs://yangyou-mnist/log/checkpoint#1565816983413142...
Removing gs://yangyou-mnist/log/#1565816904556185...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565816904.v3-8-tpu#1565816986671188...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565816981215642...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565816916955366...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565816980369402...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565816909598154...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565816985723224...
Removing gs://yangyou-mnist/log/eval/#1565817100230858...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565817100.v3-8-tpu#1565817103454784...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:11:47.511179 139937786136000 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:11:47.511971 139937786136000 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:11:47.515106 139937786136000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:11:47.515919 139937786136000 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:11:47.516532 139937786136000 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:11:47.516666 139937786136000 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:11:47.924877 139937786136000 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:11:47.933028 139937786136000 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:11:47.937617 139937786136000 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:11:47.990458 139937786136000 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:11:47.990746 139937786136000 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:11:48.173579 139937786136000 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:11:48.217231 139937786136000 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:11:48.217499 139937786136000 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:11:48.433403 139937786136000 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f45a831d190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f45aa4fc210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:11:48.433768 139937786136000 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:11:48.759140 139937786136000 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:11:48.762221: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:11:48.777358 139937786136000 tpu_system_metadata.py:148] Found TPU system:
I0814 21:11:48.777590 139937786136000 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:11:48.778074 139937786136000 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:11:48.778135 139937786136000 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:11:48.778188 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:11:48.778465 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:11:48.778527 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:11:48.778578 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:11:48.778647 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:11:48.778697 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:11:48.778744 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:11:48.778790 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:11:48.778836 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:11:48.778887 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:11:48.778935 139937786136000 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:11:48.785152 139937786136000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:11:48.798186 139937786136000 estimator.py:1145] Calling model_fn.
W0814 21:11:48.798854 139937786136000 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:11:49.066591 139937786136000 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:11:49.491199 139937786136000 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:11:49.554122 139937786136000 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:11:49.560161 139937786136000 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:11:49.742957 139937786136000 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:11:49.757004 139937786136000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:11:49.769345 139937786136000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:11:49.770410 139937786136000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:11:49.777424 139937786136000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:11:49.782636 139937786136000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:11:49.782847 139937786136000 optimization.py:36] ++++++ warmup starts at step 0, for 9 steps ++++++
W0814 21:11:49.795294 139937786136000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:11:49.904469 139937786136000 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:11:49.946254 139937786136000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:11:49.991365 139937786136000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:11:50.042136 139937786136000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:11:50.209490 139937786136000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:11:50.260873 139937786136000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:11:50.310537 139937786136000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:11:50.361044 139937786136000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:11:50.407068 139937786136000 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:11:50.448703 139937786136000 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:11:50.465198 139937786136000 estimator.py:1147] Done calling model_fn.
I0814 21:11:53.947945 139937786136000 tpu_estimator.py:499] TPU job name worker
I0814 21:11:54.059310 139937786136000 monitored_session.py:240] Graph was finalized.
I0814 21:11:54.805581 139937786136000 session_manager.py:500] Running local_init_op.
I0814 21:11:54.866713 139937786136000 session_manager.py:502] Done running local_init_op.
I0814 21:11:57.608133 139937786136000 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:12:09.829835 139937786136000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:12:09.976963 139937786136000 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:12:09.977458 139937786136000 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:12:09.977882: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:12:09.983720 139937786136000 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:12:09.985800 139937786136000 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:12:09.989442 139937786136000 tpu_estimator.py:557] Init TPU system
I0814 21:12:52.109337 139937786136000 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 21:12:52.110296 139937091364608 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:12:52.110809 139936611170048 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:12:52.180845 139937786136000 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:12:52.181601 139937786136000 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 21:12:52.227740 139936602777344 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:12:52.518722 139936602777344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:12:57.012978 139936611170048 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:13:01.450959 139937786136000 basic_session_run_hooks.py:262] loss = 0.061767094, step = 30
I0814 21:13:01.453424 139937786136000 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:13:15.765391 139937786136000 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:13:15.765719 139937786136000 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:13:15.767429 139937091364608 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:13:15.767590 139937091364608 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:13:15.767735 139937786136000 error_handling.py:96] infeed marked as finished
I0814 21:13:15.767846 139937786136000 tpu_estimator.py:602] Stop output thread controller
I0814 21:13:15.767898 139937786136000 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:13:15.768059 139936611170048 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:13:15.768285 139936611170048 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:13:15.768491 139937786136000 error_handling.py:96] outfeed marked as finished
I0814 21:13:15.768604 139937786136000 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:13:22.654603 139937786136000 estimator.py:368] Loss for final step: 0.061767094.
I0814 21:13:22.655337 139937786136000 error_handling.py:96] training_loop marked as finished
I0814 21:13:23.486548 139937786136000 estimator.py:1145] Calling model_fn.
E0814 21:13:24.210601 139937786136000 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:13:24.438002 139937786136000 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:13:24.460107 139937786136000 estimator.py:1147] Done calling model_fn.
I0814 21:13:24.476587 139937786136000 evaluation.py:255] Starting evaluation at 2019-08-14T21:13:24Z
I0814 21:13:24.476824 139937786136000 tpu_estimator.py:499] TPU job name worker
I0814 21:13:24.553858 139937786136000 monitored_session.py:240] Graph was finalized.
W0814 21:13:24.554605 139937786136000 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:13:24.744882 139937786136000 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:13:27.704685 139937786136000 session_manager.py:500] Running local_init_op.
I0814 21:13:27.735572 139937786136000 session_manager.py:502] Done running local_init_op.
I0814 21:13:27.795201 139937786136000 tpu_estimator.py:557] Init TPU system
I0814 21:14:36.133644 139937786136000 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:14:36.134634 139936611170048 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:14:36.135061 139936602777344 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:14:36.202980 139937786136000 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:14:36.229551 139937786136000 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:14:36.229914 139937786136000 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:14:36.318790 139936594384640 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:14:36.636054 139936594384640 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:14:37.023088 139936602777344 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:14:37.437293 139937786136000 evaluation.py:167] Evaluation [10/10]
I0814 21:14:37.437666 139937786136000 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:14:37.437741 139937786136000 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:14:37.437918 139936611170048 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:14:37.438040 139936611170048 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:14:37.438173 139937786136000 error_handling.py:96] infeed marked as finished
I0814 21:14:37.438271 139937786136000 tpu_estimator.py:602] Stop output thread controller
I0814 21:14:37.438319 139937786136000 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:14:37.438429 139936602777344 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:14:37.438499 139936602777344 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:14:37.438647 139937786136000 error_handling.py:96] outfeed marked as finished
I0814 21:14:37.438733 139937786136000 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:15:06.737862 139937786136000 evaluation.py:275] Finished evaluation at 2019-08-14-21:15:06
I0814 21:15:06.738260 139937786136000 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9827, global_step = 30, loss = 0.06059296
I0814 21:15:11.210844 139937786136000 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:15:12.070579 139937786136000 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06059296, 'global_step': 30, 'accuracy': 0.9827}

Removing gs://yangyou-mnist/log/#1565817112029086...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565817129338150...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565817125190152...
Removing gs://yangyou-mnist/log/checkpoint#1565817192135271...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565817112.v3-8-tpu#1565817195457029...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565817188752457...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565817189694449...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565817117033124...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565817124314725...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565817194494822...
Removing gs://yangyou-mnist/log/eval/#1565817308386720...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565817308.v3-8-tpu#1565817311761832...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:15:15.973025 139803360970176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:15:15.973854 139803360970176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:15:15.976627 139803360970176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:15:15.977540 139803360970176 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:15:15.978209 139803360970176 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:15:15.978346 139803360970176 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:15:16.427018 139803360970176 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:15:16.435225 139803360970176 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:15:16.439728 139803360970176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:15:16.498783 139803360970176 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:15:16.499087 139803360970176 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:15:16.860054 139803360970176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:15:16.913944 139803360970176 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:15:16.914238 139803360970176 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:15:17.196297 139803360970176 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f265bd49090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f265df28210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:15:17.197019 139803360970176 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:15:17.514060 139803360970176 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:15:17.516915: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:15:17.529352 139803360970176 tpu_system_metadata.py:148] Found TPU system:
I0814 21:15:17.529583 139803360970176 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:15:17.530049 139803360970176 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:15:17.530117 139803360970176 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:15:17.530174 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:15:17.530472 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:15:17.530528 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:15:17.530577 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:15:17.530628 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:15:17.530675 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:15:17.530721 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:15:17.530767 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:15:17.530816 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:15:17.530862 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:15:17.530909 139803360970176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:15:17.537019 139803360970176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:15:17.549849 139803360970176 estimator.py:1145] Calling model_fn.
W0814 21:15:17.550478 139803360970176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:15:17.822695 139803360970176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:15:19.167412 139803360970176 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:15:19.228524 139803360970176 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:15:19.234436 139803360970176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:15:19.413440 139803360970176 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:15:19.427026 139803360970176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:15:19.439203 139803360970176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:15:19.440325 139803360970176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:15:19.447336 139803360970176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:15:19.452565 139803360970176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:15:19.452783 139803360970176 optimization.py:36] ++++++ warmup starts at step 0, for 9 steps ++++++
W0814 21:15:19.465148 139803360970176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:15:19.575644 139803360970176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:15:19.617374 139803360970176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:15:19.662008 139803360970176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:15:19.713777 139803360970176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:15:19.882165 139803360970176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:15:19.932528 139803360970176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:15:19.980966 139803360970176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:15:20.031774 139803360970176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:15:20.077342 139803360970176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:15:20.119158 139803360970176 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:15:20.141859 139803360970176 estimator.py:1147] Done calling model_fn.
I0814 21:15:24.698926 139803360970176 tpu_estimator.py:499] TPU job name worker
I0814 21:15:24.811410 139803360970176 monitored_session.py:240] Graph was finalized.
I0814 21:15:25.517343 139803360970176 session_manager.py:500] Running local_init_op.
I0814 21:15:25.569458 139803360970176 session_manager.py:502] Done running local_init_op.
I0814 21:15:28.422914 139803360970176 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:15:41.071062 139803360970176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:15:41.240866 139803360970176 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:15:41.241322 139803360970176 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:15:41.241731: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:15:41.246359 139803360970176 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:15:41.248531 139803360970176 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:15:41.253004 139803360970176 tpu_estimator.py:557] Init TPU system
I0814 21:16:20.017172 139803360970176 tpu_estimator.py:566] Initialized TPU in 38 seconds
I0814 21:16:20.018264 139802326333184 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:16:20.018819 139802317940480 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:16:20.084491 139803360970176 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:16:20.085398 139803360970176 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 21:16:20.146528 139802309547776 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:16:20.425160 139802309547776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:16:24.899493 139802317940480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:16:29.546336 139803360970176 basic_session_run_hooks.py:262] loss = 0.08045785, step = 30
I0814 21:16:29.548880 139803360970176 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:16:43.367046 139803360970176 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:16:43.367417 139803360970176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:16:43.368856 139802326333184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:16:43.368997 139802326333184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:16:43.369160 139803360970176 error_handling.py:96] infeed marked as finished
I0814 21:16:43.369280 139803360970176 tpu_estimator.py:602] Stop output thread controller
I0814 21:16:43.369347 139803360970176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:16:43.369482 139802317940480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:16:43.369715 139802317940480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:16:43.370296 139803360970176 error_handling.py:96] outfeed marked as finished
I0814 21:16:43.370506 139803360970176 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:16:50.562896 139803360970176 estimator.py:368] Loss for final step: 0.08045785.
I0814 21:16:50.563739 139803360970176 error_handling.py:96] training_loop marked as finished
I0814 21:16:51.359215 139803360970176 estimator.py:1145] Calling model_fn.
E0814 21:16:52.090778 139803360970176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:16:52.313735 139803360970176 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:16:52.335135 139803360970176 estimator.py:1147] Done calling model_fn.
I0814 21:16:52.350994 139803360970176 evaluation.py:255] Starting evaluation at 2019-08-14T21:16:52Z
I0814 21:16:52.351222 139803360970176 tpu_estimator.py:499] TPU job name worker
I0814 21:16:52.427072 139803360970176 monitored_session.py:240] Graph was finalized.
W0814 21:16:52.427814 139803360970176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:16:52.624634 139803360970176 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:16:55.389308 139803360970176 session_manager.py:500] Running local_init_op.
I0814 21:16:55.414825 139803360970176 session_manager.py:502] Done running local_init_op.
I0814 21:16:55.462932 139803360970176 tpu_estimator.py:557] Init TPU system
I0814 21:18:04.082833 139803360970176 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:18:04.083853 139802326333184 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:18:04.092772 139802317940480 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:18:04.161474 139803360970176 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:18:04.186458 139803360970176 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:18:04.186814 139803360970176 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:18:04.229608 139802309547776 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:18:04.515940 139802309547776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:18:04.980298 139802317940480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:18:05.443293 139803360970176 evaluation.py:167] Evaluation [10/10]
I0814 21:18:05.443612 139803360970176 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:18:05.443689 139803360970176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:18:05.443878 139802326333184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:18:05.443979 139802326333184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:18:05.444123 139803360970176 error_handling.py:96] infeed marked as finished
I0814 21:18:05.444226 139803360970176 tpu_estimator.py:602] Stop output thread controller
I0814 21:18:05.444279 139803360970176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:18:05.444395 139802317940480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:18:05.444518 139802317940480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:18:05.444631 139803360970176 error_handling.py:96] outfeed marked as finished
I0814 21:18:05.444808 139803360970176 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:18:34.613185 139803360970176 evaluation.py:275] Finished evaluation at 2019-08-14-21:18:34
I0814 21:18:34.613545 139803360970176 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9807, global_step = 30, loss = 0.067721054
I0814 21:18:38.968592 139803360970176 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:18:39.786328 139803360970176 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.067721054, 'global_step': 30, 'accuracy': 0.9807}

Removing gs://yangyou-mnist/log/#1565817321739672...
Removing gs://yangyou-mnist/log/checkpoint#1565817399664386...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565817321.v3-8-tpu#1565817403059254...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565817340561010...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565817327835319...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565817335015141...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565817397457236...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565817396554071...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565817335980870...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565817402040022...
Removing gs://yangyou-mnist/log/eval/#1565817516294994...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565817516.v3-8-tpu#1565817519478562...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:18:43.618078 139976819131840 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:18:43.618875 139976819131840 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:18:43.622001 139976819131840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:18:43.622832 139976819131840 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:18:43.623441 139976819131840 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:18:43.623569 139976819131840 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:18:44.051527 139976819131840 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:18:44.061464 139976819131840 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:18:44.066273 139976819131840 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:18:44.123028 139976819131840 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:18:44.123300 139976819131840 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:18:44.338586 139976819131840 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:18:44.393866 139976819131840 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:18:44.394138 139976819131840 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:18:44.674690 139976819131840 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4ebebe1190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4ec0dc0210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:18:44.675040 139976819131840 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:18:45.046987 139976819131840 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:18:45.050088: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:18:45.062311 139976819131840 tpu_system_metadata.py:148] Found TPU system:
I0814 21:18:45.062568 139976819131840 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:18:45.063240 139976819131840 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:18:45.063314 139976819131840 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:18:45.063370 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:18:45.063775 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:18:45.063843 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:18:45.063894 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:18:45.063960 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:18:45.064008 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:18:45.064055 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:18:45.064102 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:18:45.064157 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:18:45.064203 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:18:45.064251 139976819131840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:18:45.070823 139976819131840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:18:45.083465 139976819131840 estimator.py:1145] Calling model_fn.
W0814 21:18:45.084078 139976819131840 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:18:45.366754 139976819131840 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:18:45.779383 139976819131840 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:18:45.840384 139976819131840 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:18:45.846481 139976819131840 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:18:46.027940 139976819131840 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:18:46.041800 139976819131840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:18:46.053792 139976819131840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:18:46.054845 139976819131840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:18:46.061944 139976819131840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:18:46.067230 139976819131840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:18:46.067441 139976819131840 optimization.py:36] ++++++ warmup starts at step 0, for 9 steps ++++++
W0814 21:18:46.079911 139976819131840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:18:46.191421 139976819131840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:18:46.234668 139976819131840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:18:46.280209 139976819131840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:18:46.331186 139976819131840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:18:46.498455 139976819131840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:18:46.549568 139976819131840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:18:46.599412 139976819131840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:18:46.650187 139976819131840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:18:46.696439 139976819131840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:18:46.739459 139976819131840 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:18:46.756349 139976819131840 estimator.py:1147] Done calling model_fn.
I0814 21:18:50.264975 139976819131840 tpu_estimator.py:499] TPU job name worker
I0814 21:18:50.379137 139976819131840 monitored_session.py:240] Graph was finalized.
I0814 21:18:51.089718 139976819131840 session_manager.py:500] Running local_init_op.
I0814 21:18:51.152339 139976819131840 session_manager.py:502] Done running local_init_op.
I0814 21:18:53.841888 139976819131840 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:19:06.167301 139976819131840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:19:06.335175 139976819131840 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:19:06.335594 139976819131840 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:19:06.335980: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:19:06.341217 139976819131840 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:19:06.343216 139976819131840 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:19:06.347086 139976819131840 tpu_estimator.py:557] Init TPU system
I0814 21:19:48.112502 139976819131840 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 21:19:48.113405 139975911786240 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:19:48.114011 139975903393536 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:19:48.174675 139975895000832 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:19:48.181600 139976819131840 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:19:48.182648 139976819131840 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:19:48.476494 139975895000832 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:19:53.060715 139975903393536 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:19:57.592103 139976819131840 basic_session_run_hooks.py:262] loss = 0.124388255, step = 30
I0814 21:19:57.594327 139976819131840 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:20:11.166152 139976819131840 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:20:11.166428 139976819131840 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:20:11.166625 139975911786240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:20:11.166729 139975911786240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:20:11.166868 139976819131840 error_handling.py:96] infeed marked as finished
I0814 21:20:11.166980 139976819131840 tpu_estimator.py:602] Stop output thread controller
I0814 21:20:11.167027 139976819131840 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:20:11.167145 139975903393536 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:20:11.167217 139975903393536 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:20:11.167334 139976819131840 error_handling.py:96] outfeed marked as finished
I0814 21:20:11.167411 139976819131840 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:20:18.618796 139976819131840 estimator.py:368] Loss for final step: 0.124388255.
I0814 21:20:18.619555 139976819131840 error_handling.py:96] training_loop marked as finished
I0814 21:20:19.312798 139976819131840 estimator.py:1145] Calling model_fn.
E0814 21:20:20.009612 139976819131840 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:20:20.260921 139976819131840 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:20:20.284518 139976819131840 estimator.py:1147] Done calling model_fn.
I0814 21:20:20.302090 139976819131840 evaluation.py:255] Starting evaluation at 2019-08-14T21:20:20Z
I0814 21:20:20.302326 139976819131840 tpu_estimator.py:499] TPU job name worker
I0814 21:20:20.381091 139976819131840 monitored_session.py:240] Graph was finalized.
W0814 21:20:20.381820 139976819131840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:20:20.573685 139976819131840 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:20:23.236115 139976819131840 session_manager.py:500] Running local_init_op.
I0814 21:20:23.260787 139976819131840 session_manager.py:502] Done running local_init_op.
I0814 21:20:23.318840 139976819131840 tpu_estimator.py:557] Init TPU system
I0814 21:21:32.050362 139976819131840 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:21:32.051357 139975911786240 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:21:32.051821 139975903393536 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:21:32.119002 139976819131840 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:21:32.147218 139976819131840 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:21:32.147572 139976819131840 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:21:32.183372 139975895000832 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:21:32.561024 139975895000832 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:21:32.961003 139975903393536 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:21:33.252068 139976819131840 evaluation.py:167] Evaluation [10/10]
I0814 21:21:33.252590 139976819131840 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:21:33.252703 139976819131840 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:21:33.253000 139975911786240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:21:33.253329 139975911786240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:21:33.253542 139976819131840 error_handling.py:96] infeed marked as finished
I0814 21:21:33.253721 139976819131840 tpu_estimator.py:602] Stop output thread controller
I0814 21:21:33.253776 139976819131840 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:21:33.253931 139975903393536 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:21:33.254091 139975903393536 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:21:33.254295 139976819131840 error_handling.py:96] outfeed marked as finished
I0814 21:21:33.254492 139976819131840 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:22:02.661007 139976819131840 evaluation.py:275] Finished evaluation at 2019-08-14-21:22:02
I0814 21:22:02.661375 139976819131840 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9657, global_step = 30, loss = 0.10562731
I0814 21:22:07.258171 139976819131840 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:22:08.038016 139976819131840 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10562731, 'global_step': 30, 'accuracy': 0.9657}

Removing gs://yangyou-mnist/log/checkpoint#1565817607581574...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565817541262889...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565817545659652...
Removing gs://yangyou-mnist/log/#1565817528248849...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565817528.v3-8-tpu#1565817610861561...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565817533270756...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565817604510296...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565817605343359...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565817540248698...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565817609916659...
Removing gs://yangyou-mnist/log/eval/#1565817724337795...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565817724.v3-8-tpu#1565817727729911...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:22:11.917018 140191127557568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:22:11.917854 140191127557568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:22:11.920497 140191127557568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:22:11.921335 140191127557568 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:22:11.921941 140191127557568 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:22:11.922071 140191127557568 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:22:12.346817 140191127557568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:22:12.356019 140191127557568 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:22:12.360240 140191127557568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:22:12.415807 140191127557568 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:22:12.416080 140191127557568 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:22:12.711668 140191127557568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:22:12.765697 140191127557568 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:22:12.766004 140191127557568 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:22:12.978892 140191127557568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f80a483b250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f80a6a31210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:22:12.979281 140191127557568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:22:13.305339 140191127557568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:22:13.308654: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:22:13.322654 140191127557568 tpu_system_metadata.py:148] Found TPU system:
I0814 21:22:13.322921 140191127557568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:22:13.323446 140191127557568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:22:13.323513 140191127557568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:22:13.323573 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:22:13.323859 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:22:13.323916 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:22:13.323971 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:22:13.324028 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:22:13.324075 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:22:13.324121 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:22:13.324167 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:22:13.324220 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:22:13.324266 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:22:13.324314 140191127557568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:22:13.330562 140191127557568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:22:13.343343 140191127557568 estimator.py:1145] Calling model_fn.
W0814 21:22:13.343990 140191127557568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:22:13.612634 140191127557568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:22:14.249550 140191127557568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:22:14.313740 140191127557568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:22:14.319802 140191127557568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:22:14.498275 140191127557568 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:22:14.511606 140191127557568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:22:14.524514 140191127557568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:22:14.525613 140191127557568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:22:14.532742 140191127557568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:22:14.538012 140191127557568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:22:14.538222 140191127557568 optimization.py:36] ++++++ warmup starts at step 0, for 10 steps ++++++
W0814 21:22:14.550803 140191127557568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:22:14.660125 140191127557568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:22:14.700552 140191127557568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:22:14.744335 140191127557568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:22:14.794806 140191127557568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:22:14.957664 140191127557568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:22:15.008038 140191127557568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:22:15.057593 140191127557568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:22:15.108395 140191127557568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:22:15.153280 140191127557568 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:22:15.195075 140191127557568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:22:15.212879 140191127557568 estimator.py:1147] Done calling model_fn.
I0814 21:22:18.793728 140191127557568 tpu_estimator.py:499] TPU job name worker
I0814 21:22:18.903166 140191127557568 monitored_session.py:240] Graph was finalized.
I0814 21:22:19.571507 140191127557568 session_manager.py:500] Running local_init_op.
I0814 21:22:19.619782 140191127557568 session_manager.py:502] Done running local_init_op.
I0814 21:22:22.411535 140191127557568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:22:34.881532 140191127557568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:22:35.047447 140191127557568 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:22:35.047943 140191127557568 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:22:35.048485: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:22:35.053379 140191127557568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:22:35.055705 140191127557568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:22:35.060236 140191127557568 tpu_estimator.py:557] Init TPU system
I0814 21:23:16.118124 140191127557568 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 21:23:16.119045 140190365492992 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:23:16.119643 140190014240512 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:23:16.190531 140191127557568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:23:16.191442 140191127557568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 21:23:16.251782 140190005847808 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:23:16.660561 140190005847808 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:23:20.982666 140190014240512 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:23:25.531222 140191127557568 basic_session_run_hooks.py:262] loss = 0.095761925, step = 30
I0814 21:23:25.534110 140191127557568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:23:39.117714 140191127557568 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:23:39.118030 140191127557568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:23:39.118355 140190365492992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:23:39.118668 140190365492992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:23:39.118890 140191127557568 error_handling.py:96] infeed marked as finished
I0814 21:23:39.119106 140191127557568 tpu_estimator.py:602] Stop output thread controller
I0814 21:23:39.119179 140191127557568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:23:39.119529 140190014240512 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:23:39.119702 140190014240512 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:23:39.119901 140191127557568 error_handling.py:96] outfeed marked as finished
I0814 21:23:39.120078 140191127557568 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:23:46.799355 140191127557568 estimator.py:368] Loss for final step: 0.095761925.
I0814 21:23:46.800173 140191127557568 error_handling.py:96] training_loop marked as finished
I0814 21:23:47.604439 140191127557568 estimator.py:1145] Calling model_fn.
E0814 21:23:48.299746 140191127557568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:23:48.524190 140191127557568 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:23:48.546812 140191127557568 estimator.py:1147] Done calling model_fn.
I0814 21:23:48.563720 140191127557568 evaluation.py:255] Starting evaluation at 2019-08-14T21:23:48Z
I0814 21:23:48.563982 140191127557568 tpu_estimator.py:499] TPU job name worker
I0814 21:23:48.642235 140191127557568 monitored_session.py:240] Graph was finalized.
W0814 21:23:48.642976 140191127557568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:23:48.830209 140191127557568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:23:51.719737 140191127557568 session_manager.py:500] Running local_init_op.
I0814 21:23:51.748877 140191127557568 session_manager.py:502] Done running local_init_op.
I0814 21:23:51.799345 140191127557568 tpu_estimator.py:557] Init TPU system
I0814 21:25:00.125472 140191127557568 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:25:00.126673 140190014240512 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:25:00.127151 140190005847808 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:25:00.200963 140191127557568 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:25:00.227523 140191127557568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:25:00.227874 140191127557568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:25:00.267587 140189997455104 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:25:00.553608 140189997455104 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:25:01.023797 140190005847808 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:25:01.402642 140191127557568 evaluation.py:167] Evaluation [10/10]
I0814 21:25:01.402971 140191127557568 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:25:01.403048 140191127557568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:25:01.403240 140190014240512 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:25:01.403346 140190014240512 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:25:01.403482 140191127557568 error_handling.py:96] infeed marked as finished
I0814 21:25:01.403572 140191127557568 tpu_estimator.py:602] Stop output thread controller
I0814 21:25:01.403620 140191127557568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:25:01.403738 140190005847808 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:25:01.403824 140190005847808 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:25:01.403976 140191127557568 error_handling.py:96] outfeed marked as finished
I0814 21:25:01.404055 140191127557568 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:25:30.624480 140191127557568 evaluation.py:275] Finished evaluation at 2019-08-14-21:25:30
I0814 21:25:30.624804 140191127557568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9756, global_step = 30, loss = 0.08167443
I0814 21:25:34.975878 140191127557568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:25:35.822067 140191127557568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08167443, 'global_step': 30, 'accuracy': 0.9756}

Removing gs://yangyou-mnist/log/#1565817736696865...
Removing gs://yangyou-mnist/log/checkpoint#1565817815621534...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565817749818388...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565817736.v3-8-tpu#1565817818810697...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565817741819255...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565817748900505...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565817754370422...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565817812452790...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565817813379368...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565817817835173...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565817932356378...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565817932.v3-8-tpu#1565817935508634...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:25:39.800533 140470024615360 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:25:39.801315 140470024615360 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:25:39.803941 140470024615360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:25:39.804852 140470024615360 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:25:39.805458 140470024615360 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:25:39.805591 140470024615360 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:25:40.244379 140470024615360 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:25:40.255175 140470024615360 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:25:40.260210 140470024615360 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:25:40.323084 140470024615360 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:25:40.323390 140470024615360 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:25:40.529654 140470024615360 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:25:40.583467 140470024615360 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:25:40.583811 140470024615360 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:25:40.986691 140470024615360 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc194148290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc196327210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:25:40.987152 140470024615360 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:25:41.321265 140470024615360 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:25:41.324394: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:25:41.337344 140470024615360 tpu_system_metadata.py:148] Found TPU system:
I0814 21:25:41.337594 140470024615360 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:25:41.338088 140470024615360 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:25:41.338243 140470024615360 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:25:41.338303 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:25:41.338634 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:25:41.338701 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:25:41.338752 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:25:41.338800 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:25:41.338849 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:25:41.338896 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:25:41.338941 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:25:41.338987 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:25:41.339031 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:25:41.339096 140470024615360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:25:41.345441 140470024615360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:25:41.358495 140470024615360 estimator.py:1145] Calling model_fn.
W0814 21:25:41.359149 140470024615360 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:25:41.632760 140470024615360 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:25:42.042244 140470024615360 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:25:42.111043 140470024615360 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:25:42.117021 140470024615360 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:25:42.300784 140470024615360 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:25:42.314635 140470024615360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:25:42.326874 140470024615360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:25:42.327933 140470024615360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:25:42.335017 140470024615360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:25:42.340312 140470024615360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:25:42.340549 140470024615360 optimization.py:36] ++++++ warmup starts at step 0, for 10 steps ++++++
W0814 21:25:42.353163 140470024615360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:25:42.464692 140470024615360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:25:42.507356 140470024615360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:25:42.553170 140470024615360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:25:42.605689 140470024615360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:25:42.769725 140470024615360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:25:42.820034 140470024615360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:25:42.869204 140470024615360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:25:42.920120 140470024615360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:25:42.965883 140470024615360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:25:43.008255 140470024615360 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:25:43.025213 140470024615360 estimator.py:1147] Done calling model_fn.
I0814 21:25:47.454304 140470024615360 tpu_estimator.py:499] TPU job name worker
I0814 21:25:47.563107 140470024615360 monitored_session.py:240] Graph was finalized.
I0814 21:25:48.269107 140470024615360 session_manager.py:500] Running local_init_op.
I0814 21:25:48.321059 140470024615360 session_manager.py:502] Done running local_init_op.
I0814 21:25:51.211905 140470024615360 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:26:03.806003 140470024615360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:26:03.970072 140470024615360 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:26:03.970536 140470024615360 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:26:03.971006: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:26:03.975657 140470024615360 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:26:03.977807 140470024615360 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:26:03.981276 140470024615360 tpu_estimator.py:557] Init TPU system
I0814 21:26:44.126893 140470024615360 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 21:26:44.127948 140469329843968 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:26:44.128926 140468851570432 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:26:44.194119 140468843177728 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:26:44.195549 140470024615360 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:26:44.196949 140470024615360 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:26:44.596237 140468843177728 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:26:49.063802 140468851570432 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:26:53.707844 140470024615360 basic_session_run_hooks.py:262] loss = 0.075063586, step = 30
I0814 21:26:53.710592 140470024615360 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:27:07.353638 140470024615360 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:27:07.353939 140470024615360 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:27:07.354167 140469329843968 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:27:07.354269 140469329843968 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:27:07.354439 140470024615360 error_handling.py:96] infeed marked as finished
I0814 21:27:07.354537 140470024615360 tpu_estimator.py:602] Stop output thread controller
I0814 21:27:07.354585 140470024615360 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:27:07.354696 140468851570432 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:27:07.354769 140468851570432 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:27:07.354891 140470024615360 error_handling.py:96] outfeed marked as finished
I0814 21:27:07.354974 140470024615360 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:27:14.727211 140470024615360 estimator.py:368] Loss for final step: 0.075063586.
I0814 21:27:14.727988 140470024615360 error_handling.py:96] training_loop marked as finished
I0814 21:27:15.456619 140470024615360 estimator.py:1145] Calling model_fn.
E0814 21:27:16.142421 140470024615360 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:27:16.374779 140470024615360 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:27:16.396902 140470024615360 estimator.py:1147] Done calling model_fn.
I0814 21:27:16.413387 140470024615360 evaluation.py:255] Starting evaluation at 2019-08-14T21:27:16Z
I0814 21:27:16.413642 140470024615360 tpu_estimator.py:499] TPU job name worker
I0814 21:27:16.491091 140470024615360 monitored_session.py:240] Graph was finalized.
W0814 21:27:16.491856 140470024615360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:27:16.686079 140470024615360 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:27:19.204086 140470024615360 session_manager.py:500] Running local_init_op.
I0814 21:27:19.229434 140470024615360 session_manager.py:502] Done running local_init_op.
I0814 21:27:19.280049 140470024615360 tpu_estimator.py:557] Init TPU system
I0814 21:28:28.078094 140470024615360 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:28:28.079119 140468851570432 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:28:28.079961 140468843177728 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:28:28.153186 140470024615360 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:28:28.181756 140470024615360 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:28:28.182143 140470024615360 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:28:28.218133 140468834522880 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:28:28.482815 140468834522880 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:28:28.970058 140468843177728 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:28:29.278074 140470024615360 evaluation.py:167] Evaluation [10/10]
I0814 21:28:29.278418 140470024615360 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:28:29.278505 140470024615360 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:28:29.278742 140468851570432 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:28:29.279007 140468851570432 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:28:29.279239 140470024615360 error_handling.py:96] infeed marked as finished
I0814 21:28:29.279444 140470024615360 tpu_estimator.py:602] Stop output thread controller
I0814 21:28:29.279508 140470024615360 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:28:29.279673 140468843177728 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:28:29.279834 140468843177728 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:28:29.280028 140470024615360 error_handling.py:96] outfeed marked as finished
I0814 21:28:29.280191 140470024615360 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:28:58.585231 140470024615360 evaluation.py:275] Finished evaluation at 2019-08-14-21:28:58
I0814 21:28:58.585675 140470024615360 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9803, global_step = 30, loss = 0.06211741
I0814 21:29:03.088958 140470024615360 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:29:03.871387 140470024615360 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06211741, 'global_step': 30, 'accuracy': 0.9803}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565817958664246...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565817963290286...
Removing gs://yangyou-mnist/log/#1565817945485877...
Removing gs://yangyou-mnist/log/checkpoint#1565818023807703...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565818020778456...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565817957781190...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565817945.v3-8-tpu#1565818027044236...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565817950577748...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565818021656455...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565818026053734...
Removing gs://yangyou-mnist/log/eval/#1565818140245771...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565818140.v3-8-tpu#1565818143541248...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:29:07.691936 139920193656256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:29:07.692907 139920193656256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:29:07.695473 139920193656256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:29:07.696285 139920193656256 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:29:07.696902 139920193656256 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:29:07.697032 139920193656256 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:29:08.126508 139920193656256 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:29:08.134695 139920193656256 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:29:08.138859 139920193656256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:29:08.195369 139920193656256 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:29:08.195648 139920193656256 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:29:08.367289 139920193656256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:29:08.426436 139920193656256 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:29:08.426745 139920193656256 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:29:08.701091 139920193656256 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f418f99e250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4191b7d1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:29:08.701426 139920193656256 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:29:09.026568 139920193656256 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:29:09.029588: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:29:09.043371 139920193656256 tpu_system_metadata.py:148] Found TPU system:
I0814 21:29:09.043613 139920193656256 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:29:09.044096 139920193656256 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:29:09.044166 139920193656256 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:29:09.044218 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:29:09.044603 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:29:09.044667 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:29:09.044734 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:29:09.044785 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:29:09.044831 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:29:09.044878 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:29:09.044924 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:29:09.044970 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:29:09.045016 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:29:09.045062 139920193656256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:29:09.051155 139920193656256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:29:09.064033 139920193656256 estimator.py:1145] Calling model_fn.
W0814 21:29:09.064718 139920193656256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:29:09.332077 139920193656256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:29:09.863440 139920193656256 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:29:09.926846 139920193656256 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:29:09.932996 139920193656256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:29:10.118455 139920193656256 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:29:10.132476 139920193656256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:29:10.145351 139920193656256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:29:10.146456 139920193656256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:29:10.153578 139920193656256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:29:10.158835 139920193656256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:29:10.159046 139920193656256 optimization.py:36] ++++++ warmup starts at step 0, for 10 steps ++++++
W0814 21:29:10.171854 139920193656256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:29:10.288285 139920193656256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:29:10.331157 139920193656256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:29:10.376580 139920193656256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:29:10.429028 139920193656256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:29:10.600501 139920193656256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:29:10.652007 139920193656256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:29:10.701658 139920193656256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:29:10.754019 139920193656256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:29:10.801151 139920193656256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:29:10.844192 139920193656256 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:29:10.860707 139920193656256 estimator.py:1147] Done calling model_fn.
I0814 21:29:14.492031 139920193656256 tpu_estimator.py:499] TPU job name worker
I0814 21:29:14.603837 139920193656256 monitored_session.py:240] Graph was finalized.
I0814 21:29:15.300798 139920193656256 session_manager.py:500] Running local_init_op.
I0814 21:29:15.351294 139920193656256 session_manager.py:502] Done running local_init_op.
I0814 21:29:18.531574 139920193656256 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:29:30.682358 139920193656256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:29:30.847487 139920193656256 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:29:30.847976 139920193656256 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:29:30.848387: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:29:30.854341 139920193656256 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:29:30.856673 139920193656256 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:29:30.861434 139920193656256 tpu_estimator.py:557] Init TPU system
I0814 21:30:12.098186 139920193656256 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 21:30:12.099080 139919162865408 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:30:12.099558 139919154472704 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:30:12.166727 139919146080000 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:30:12.168108 139920193656256 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:30:12.168876 139920193656256 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:30:12.453408 139919146080000 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 21:30:16.954303 139919154472704 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:30:21.698417 139920193656256 basic_session_run_hooks.py:262] loss = 0.08384078, step = 30
I0814 21:30:21.700865 139920193656256 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:30:35.618616 139920193656256 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:30:35.619000 139920193656256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:30:35.620557 139919162865408 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:30:35.620724 139919162865408 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:30:35.620883 139920193656256 error_handling.py:96] infeed marked as finished
I0814 21:30:35.621062 139920193656256 tpu_estimator.py:602] Stop output thread controller
I0814 21:30:35.621146 139920193656256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:30:35.621284 139919154472704 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:30:35.621364 139919154472704 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:30:35.621577 139920193656256 error_handling.py:96] outfeed marked as finished
I0814 21:30:35.621689 139920193656256 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:30:42.573347 139920193656256 estimator.py:368] Loss for final step: 0.08384078.
I0814 21:30:42.574217 139920193656256 error_handling.py:96] training_loop marked as finished
I0814 21:30:43.386940 139920193656256 estimator.py:1145] Calling model_fn.
E0814 21:30:44.163410 139920193656256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:30:44.394726 139920193656256 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:30:44.418685 139920193656256 estimator.py:1147] Done calling model_fn.
I0814 21:30:44.435647 139920193656256 evaluation.py:255] Starting evaluation at 2019-08-14T21:30:44Z
I0814 21:30:44.435897 139920193656256 tpu_estimator.py:499] TPU job name worker
I0814 21:30:44.514323 139920193656256 monitored_session.py:240] Graph was finalized.
W0814 21:30:44.515151 139920193656256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:30:44.717490 139920193656256 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:30:47.595427 139920193656256 session_manager.py:500] Running local_init_op.
I0814 21:30:47.625844 139920193656256 session_manager.py:502] Done running local_init_op.
I0814 21:30:47.678962 139920193656256 tpu_estimator.py:557] Init TPU system
I0814 21:31:56.082091 139920193656256 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:31:56.083045 139919159195392 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:31:56.083548 139919150802688 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:31:56.152475 139920193656256 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:31:56.180386 139920193656256 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:31:56.180880 139920193656256 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:31:56.220238 139919142409984 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:31:56.460125 139919142409984 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:31:56.983315 139919150802688 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:31:57.376765 139920193656256 evaluation.py:167] Evaluation [10/10]
I0814 21:31:57.377132 139920193656256 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:31:57.377204 139920193656256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:31:57.377386 139919159195392 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:31:57.377486 139919159195392 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:31:57.377635 139920193656256 error_handling.py:96] infeed marked as finished
I0814 21:31:57.377727 139920193656256 tpu_estimator.py:602] Stop output thread controller
I0814 21:31:57.377777 139920193656256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:31:57.377886 139919150802688 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:31:57.377959 139919150802688 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:31:57.378072 139920193656256 error_handling.py:96] outfeed marked as finished
I0814 21:31:57.378149 139920193656256 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:32:26.559489 139920193656256 evaluation.py:275] Finished evaluation at 2019-08-14-21:32:26
I0814 21:32:26.559946 139920193656256 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9764, global_step = 30, loss = 0.07235321
I0814 21:32:30.918111 139920193656256 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:32:31.769845 139920193656256 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07235321, 'global_step': 30, 'accuracy': 0.9764}

Removing gs://yangyou-mnist/log/#1565818152400412...
Removing gs://yangyou-mnist/log/checkpoint#1565818231970779...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565818165406447...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565818152.v3-8-tpu#1565818235316183...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565818228835523...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565818157716277...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565818170167782...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565818229680178...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565818164524897...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565818234341869...
Removing gs://yangyou-mnist/log/eval/#1565818348259554...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565818348.v3-8-tpu#1565818351458867...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:32:35.797458 140643100947904 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:32:35.798243 140643100947904 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:32:35.800930 140643100947904 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:32:35.801737 140643100947904 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:32:35.802321 140643100947904 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:32:35.802453 140643100947904 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:32:36.222541 140643100947904 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:32:36.229737 140643100947904 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:32:36.233778 140643100947904 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:32:36.285219 140643100947904 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:32:36.285808 140643100947904 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:32:36.846930 140643100947904 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:32:36.899229 140643100947904 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:32:36.899538 140643100947904 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:32:37.214409 140643100947904 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe9e03bc190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe9e259b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:32:37.214808 140643100947904 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:32:37.567168 140643100947904 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:32:37.570274: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:32:37.583386 140643100947904 tpu_system_metadata.py:148] Found TPU system:
I0814 21:32:37.583636 140643100947904 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:32:37.584146 140643100947904 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:32:37.584203 140643100947904 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:32:37.584276 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:32:37.584711 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:32:37.584770 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:32:37.584822 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:32:37.584872 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:32:37.584928 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:32:37.584979 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:32:37.585026 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:32:37.585072 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:32:37.585119 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:32:37.585166 140643100947904 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:32:37.591176 140643100947904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:32:37.603581 140643100947904 estimator.py:1145] Calling model_fn.
W0814 21:32:37.604202 140643100947904 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:32:37.871313 140643100947904 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:32:38.502966 140643100947904 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:32:38.563699 140643100947904 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:32:38.569711 140643100947904 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:32:38.747983 140643100947904 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:32:38.761979 140643100947904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:32:38.774945 140643100947904 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:32:38.776035 140643100947904 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:32:38.783211 140643100947904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:32:38.788527 140643100947904 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:32:38.788738 140643100947904 optimization.py:36] ++++++ warmup starts at step 0, for 10 steps ++++++
W0814 21:32:38.801301 140643100947904 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:32:38.910177 140643100947904 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:32:38.951561 140643100947904 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:32:38.995630 140643100947904 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:32:39.046123 140643100947904 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:32:39.221400 140643100947904 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:32:39.271601 140643100947904 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:32:39.320161 140643100947904 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:32:39.370268 140643100947904 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:32:39.415687 140643100947904 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:32:39.457578 140643100947904 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:32:39.474180 140643100947904 estimator.py:1147] Done calling model_fn.
I0814 21:32:42.974617 140643100947904 tpu_estimator.py:499] TPU job name worker
I0814 21:32:43.080652 140643100947904 monitored_session.py:240] Graph was finalized.
I0814 21:32:43.757882 140643100947904 session_manager.py:500] Running local_init_op.
I0814 21:32:43.824002 140643100947904 session_manager.py:502] Done running local_init_op.
I0814 21:32:46.736526 140643100947904 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:32:59.523417 140643100947904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:32:59.690082 140643100947904 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:32:59.690567 140643100947904 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:32:59.690971: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:32:59.695996 140643100947904 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:32:59.698180 140643100947904 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:32:59.702861 140643100947904 tpu_estimator.py:557] Init TPU system
I0814 21:33:40.134474 140643100947904 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 21:33:40.135421 140642406176512 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:33:40.135958 140641925330688 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:33:40.200536 140643100947904 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:33:40.202485 140643100947904 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 21:33:40.209678 140641916937984 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:33:40.338901 140641916937984 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 21:33:45.084450 140641925330688 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:33:49.728440 140643100947904 basic_session_run_hooks.py:262] loss = 0.06907647, step = 30
I0814 21:33:49.731985 140643100947904 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:34:03.669521 140643100947904 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:34:03.669823 140643100947904 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:34:03.670058 140642406176512 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:34:03.670167 140642406176512 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:34:03.670330 140643100947904 error_handling.py:96] infeed marked as finished
I0814 21:34:03.670432 140643100947904 tpu_estimator.py:602] Stop output thread controller
I0814 21:34:03.670510 140643100947904 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:34:03.670622 140641925330688 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:34:03.670696 140641925330688 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:34:03.670813 140643100947904 error_handling.py:96] outfeed marked as finished
I0814 21:34:03.670892 140643100947904 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:34:10.480725 140643100947904 estimator.py:368] Loss for final step: 0.06907647.
I0814 21:34:10.481616 140643100947904 error_handling.py:96] training_loop marked as finished
I0814 21:34:11.316884 140643100947904 estimator.py:1145] Calling model_fn.
E0814 21:34:12.012844 140643100947904 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:34:12.247836 140643100947904 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:34:12.270827 140643100947904 estimator.py:1147] Done calling model_fn.
I0814 21:34:12.287441 140643100947904 evaluation.py:255] Starting evaluation at 2019-08-14T21:34:12Z
I0814 21:34:12.287671 140643100947904 tpu_estimator.py:499] TPU job name worker
I0814 21:34:12.365448 140643100947904 monitored_session.py:240] Graph was finalized.
W0814 21:34:12.366173 140643100947904 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:34:12.567589 140643100947904 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:34:15.420274 140643100947904 session_manager.py:500] Running local_init_op.
I0814 21:34:15.445311 140643100947904 session_manager.py:502] Done running local_init_op.
I0814 21:34:15.501893 140643100947904 tpu_estimator.py:557] Init TPU system
I0814 21:35:24.077780 140643100947904 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:35:24.078589 140641925330688 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:35:24.079045 140641916937984 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:35:24.149493 140643100947904 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:35:24.177265 140643100947904 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:35:24.177582 140643100947904 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:35:24.214405 140641908545280 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:35:24.558837 140641908545280 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:35:25.007685 140641916937984 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:35:25.332356 140643100947904 evaluation.py:167] Evaluation [10/10]
I0814 21:35:25.332715 140643100947904 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:35:25.332803 140643100947904 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:35:25.333008 140641925330688 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:35:25.333117 140641925330688 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:35:25.333374 140643100947904 error_handling.py:96] infeed marked as finished
I0814 21:35:25.333508 140643100947904 tpu_estimator.py:602] Stop output thread controller
I0814 21:35:25.333568 140643100947904 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:35:25.333693 140641916937984 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:35:25.333791 140641916937984 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:35:25.333933 140643100947904 error_handling.py:96] outfeed marked as finished
I0814 21:35:25.334033 140643100947904 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:35:54.656351 140643100947904 evaluation.py:275] Finished evaluation at 2019-08-14-21:35:54
I0814 21:35:54.656738 140643100947904 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9808, global_step = 30, loss = 0.054604303
I0814 21:35:59.203615 140643100947904 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:35:59.989872 140643100947904 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.054604303, 'global_step': 30, 'accuracy': 0.9808}

Removing gs://yangyou-mnist/log/#1565818361075825...
Removing gs://yangyou-mnist/log/checkpoint#1565818440122546...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565818361.v3-8-tpu#1565818443366404...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565818366140423...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565818373530469...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565818379006391...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565818374433352...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565818437851969...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565818436857133...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565818442447689...
Removing gs://yangyou-mnist/log/eval/#1565818556415532...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565818556.v3-8-tpu#1565818559672510...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:36:04.037182 139958836348352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:36:04.038033 139958836348352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:36:04.041651 139958836348352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:36:04.042541 139958836348352 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:36:04.043203 139958836348352 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:36:04.043359 139958836348352 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:36:04.475439 139958836348352 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:36:04.484162 139958836348352 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:36:04.488720 139958836348352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:36:04.545903 139958836348352 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:36:04.546222 139958836348352 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:36:04.998519 139958836348352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:36:05.117594 139958836348352 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:36:05.117901 139958836348352 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:36:05.413249 139958836348352 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4a8ee29090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4a91008210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:36:05.413635 139958836348352 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:36:05.750911 139958836348352 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:36:05.754062: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:36:05.767323 139958836348352 tpu_system_metadata.py:148] Found TPU system:
I0814 21:36:05.767577 139958836348352 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:36:05.768172 139958836348352 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:36:05.768232 139958836348352 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:36:05.768285 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:36:05.768702 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:36:05.768764 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:36:05.768816 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:36:05.768866 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:36:05.768913 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:36:05.768959 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:36:05.769006 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:36:05.769062 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:36:05.769134 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:36:05.769182 139958836348352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:36:05.775715 139958836348352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:36:05.788583 139958836348352 estimator.py:1145] Calling model_fn.
W0814 21:36:05.789186 139958836348352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:36:06.107594 139958836348352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:36:06.547992 139958836348352 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:36:06.610389 139958836348352 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:36:06.616498 139958836348352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:36:06.801517 139958836348352 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:36:06.815455 139958836348352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:36:06.827457 139958836348352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:36:06.828546 139958836348352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:36:06.835805 139958836348352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:36:06.841101 139958836348352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:36:06.841334 139958836348352 optimization.py:36] ++++++ warmup starts at step 0, for 10 steps ++++++
W0814 21:36:06.853962 139958836348352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:36:06.966062 139958836348352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:36:07.008673 139958836348352 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:36:07.053530 139958836348352 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:36:07.105963 139958836348352 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:36:07.283535 139958836348352 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:36:07.333833 139958836348352 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:36:07.381824 139958836348352 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:36:07.433325 139958836348352 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:36:07.479845 139958836348352 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:36:07.523154 139958836348352 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:36:07.539437 139958836348352 estimator.py:1147] Done calling model_fn.
I0814 21:36:10.917033 139958836348352 tpu_estimator.py:499] TPU job name worker
I0814 21:36:11.024117 139958836348352 monitored_session.py:240] Graph was finalized.
I0814 21:36:12.692831 139958836348352 session_manager.py:500] Running local_init_op.
I0814 21:36:12.747582 139958836348352 session_manager.py:502] Done running local_init_op.
I0814 21:36:15.420566 139958836348352 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:36:27.791049 139958836348352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:36:27.960902 139958836348352 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:36:27.961328 139958836348352 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:36:27.961735: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:36:27.968128 139958836348352 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:36:27.970174 139958836348352 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:36:27.974374 139958836348352 tpu_estimator.py:557] Init TPU system
I0814 21:37:08.110618 139958836348352 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 21:37:08.111579 139958069221120 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:37:08.112082 139958060828416 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:37:08.175523 139958052435712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:37:08.183546 139958836348352 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:37:08.184428 139958836348352 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:37:08.477895 139958052435712 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:37:12.992044 139958060828416 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:37:17.587361 139958836348352 basic_session_run_hooks.py:262] loss = 0.06939118, step = 30
I0814 21:37:17.590153 139958836348352 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:37:30.917659 139958836348352 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:37:30.917975 139958836348352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:37:30.918214 139958069221120 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:37:30.918327 139958069221120 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:37:30.918472 139958836348352 error_handling.py:96] infeed marked as finished
I0814 21:37:30.918587 139958836348352 tpu_estimator.py:602] Stop output thread controller
I0814 21:37:30.918641 139958836348352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:37:30.918788 139958060828416 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:37:30.918936 139958060828416 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:37:30.919146 139958836348352 error_handling.py:96] outfeed marked as finished
I0814 21:37:30.919236 139958836348352 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:37:38.613666 139958836348352 estimator.py:368] Loss for final step: 0.06939118.
I0814 21:37:38.614494 139958836348352 error_handling.py:96] training_loop marked as finished
I0814 21:37:39.406003 139958836348352 estimator.py:1145] Calling model_fn.
E0814 21:37:40.127480 139958836348352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:37:40.357038 139958836348352 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:37:40.379854 139958836348352 estimator.py:1147] Done calling model_fn.
I0814 21:37:40.396719 139958836348352 evaluation.py:255] Starting evaluation at 2019-08-14T21:37:40Z
I0814 21:37:40.396955 139958836348352 tpu_estimator.py:499] TPU job name worker
I0814 21:37:40.475702 139958836348352 monitored_session.py:240] Graph was finalized.
W0814 21:37:40.476475 139958836348352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:37:40.659661 139958836348352 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:37:43.446532 139958836348352 session_manager.py:500] Running local_init_op.
I0814 21:37:43.472331 139958836348352 session_manager.py:502] Done running local_init_op.
I0814 21:37:43.529995 139958836348352 tpu_estimator.py:557] Init TPU system
I0814 21:38:52.066068 139958836348352 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:38:52.067013 139958069221120 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:38:52.067733 139958060828416 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:38:52.135453 139958836348352 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:38:52.158586 139958836348352 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:38:52.159037 139958836348352 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:38:52.263989 139958052435712 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:38:52.641706 139958052435712 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:38:52.998944 139958060828416 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:38:53.323214 139958836348352 evaluation.py:167] Evaluation [10/10]
I0814 21:38:53.323616 139958836348352 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:38:53.323692 139958836348352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:38:53.323939 139958069221120 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:38:53.324078 139958069221120 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:38:53.324220 139958836348352 error_handling.py:96] infeed marked as finished
I0814 21:38:53.324467 139958836348352 tpu_estimator.py:602] Stop output thread controller
I0814 21:38:53.324542 139958836348352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:38:53.324662 139958060828416 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:38:53.324737 139958060828416 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:38:53.324867 139958836348352 error_handling.py:96] outfeed marked as finished
I0814 21:38:53.324954 139958836348352 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:39:22.741364 139958836348352 evaluation.py:275] Finished evaluation at 2019-08-14-21:39:22
I0814 21:39:22.741683 139958836348352 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9816, global_step = 30, loss = 0.04913953
I0814 21:39:27.679631 139958836348352 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:39:28.509426 139958836348352 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.04913953, 'global_step': 30, 'accuracy': 0.9816}

Removing gs://yangyou-mnist/log/#1565818569021049...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565818582897521...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565818587325726...
Removing gs://yangyou-mnist/log/checkpoint#1565818647567393...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565818569.v3-8-tpu#1565818650628497...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565818645450568...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565818644618391...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565818582043084...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565818574892329...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565818649755805...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565818764436042...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565818764.v3-8-tpu#1565818768202095...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:39:32.392446 140360073827776 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:39:32.393261 140360073827776 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:39:32.395888 140360073827776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:39:32.396929 140360073827776 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:39:32.397561 140360073827776 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:39:32.397711 140360073827776 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:39:32.826067 140360073827776 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:39:32.833204 140360073827776 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:39:32.837394 140360073827776 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:39:33.585174 140360073827776 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:39:33.585504 140360073827776 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:39:33.989049 140360073827776 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:39:34.935043 140360073827776 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:39:34.935321 140360073827776 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:39:35.133872 140360073827776 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa7fa80a050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa7fc9e9210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:39:35.134226 140360073827776 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:39:35.460616 140360073827776 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:39:35.463430: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:39:35.475725 140360073827776 tpu_system_metadata.py:148] Found TPU system:
I0814 21:39:35.475965 140360073827776 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:39:35.476659 140360073827776 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:39:35.476746 140360073827776 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:39:35.476803 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:39:35.477160 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:39:35.477219 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:39:35.477268 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:39:35.477324 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:39:35.477372 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:39:35.477418 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:39:35.477464 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:39:35.477510 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:39:35.477555 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:39:35.477612 140360073827776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:39:35.483691 140360073827776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:39:35.496263 140360073827776 estimator.py:1145] Calling model_fn.
W0814 21:39:35.496938 140360073827776 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:39:35.787197 140360073827776 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:39:36.194556 140360073827776 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:39:36.258872 140360073827776 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:39:36.265266 140360073827776 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:39:36.453521 140360073827776 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:39:36.467870 140360073827776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:39:36.480634 140360073827776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:39:36.481796 140360073827776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:39:36.489038 140360073827776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:39:36.494328 140360073827776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:39:36.494544 140360073827776 optimization.py:36] ++++++ warmup starts at step 0, for 10 steps ++++++
W0814 21:39:36.507277 140360073827776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:39:36.619986 140360073827776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:39:36.662209 140360073827776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:39:36.708091 140360073827776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:39:36.761559 140360073827776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:39:36.932602 140360073827776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:39:36.982625 140360073827776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:39:37.032197 140360073827776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:39:37.082664 140360073827776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:39:37.128381 140360073827776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:39:37.177238 140360073827776 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:39:37.193515 140360073827776 estimator.py:1147] Done calling model_fn.
I0814 21:39:41.054166 140360073827776 tpu_estimator.py:499] TPU job name worker
I0814 21:39:41.166045 140360073827776 monitored_session.py:240] Graph was finalized.
I0814 21:39:41.839194 140360073827776 session_manager.py:500] Running local_init_op.
I0814 21:39:41.901470 140360073827776 session_manager.py:502] Done running local_init_op.
I0814 21:39:44.610078 140360073827776 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:39:57.195842 140360073827776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:39:57.355667 140360073827776 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:39:57.356158 140360073827776 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:39:57.356620: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:39:57.362261 140360073827776 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:39:57.364615 140360073827776 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:39:57.369292 140360073827776 tpu_estimator.py:557] Init TPU system
I0814 21:40:36.117307 140360073827776 tpu_estimator.py:566] Initialized TPU in 38 seconds
I0814 21:40:36.118415 140359177590528 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:40:36.120889 140359169197824 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:40:36.197115 140359160805120 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:40:36.197664 140360073827776 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:40:36.200536 140360073827776 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:40:36.360213 140359160805120 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:40:41.032713 140359169197824 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:40:45.622487 140360073827776 basic_session_run_hooks.py:262] loss = 0.06896093, step = 30
I0814 21:40:45.624949 140360073827776 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:40:59.189759 140360073827776 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:40:59.190047 140360073827776 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:40:59.190431 140359177590528 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:40:59.190707 140359177590528 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:40:59.190951 140360073827776 error_handling.py:96] infeed marked as finished
I0814 21:40:59.191188 140360073827776 tpu_estimator.py:602] Stop output thread controller
I0814 21:40:59.191263 140360073827776 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:40:59.191499 140359169197824 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:40:59.191656 140359169197824 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:40:59.191867 140360073827776 error_handling.py:96] outfeed marked as finished
I0814 21:40:59.192028 140360073827776 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:41:06.499020 140360073827776 estimator.py:368] Loss for final step: 0.06896093.
I0814 21:41:06.499883 140360073827776 error_handling.py:96] training_loop marked as finished
I0814 21:41:07.224668 140360073827776 estimator.py:1145] Calling model_fn.
E0814 21:41:07.911108 140360073827776 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:41:08.150818 140360073827776 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:41:08.173819 140360073827776 estimator.py:1147] Done calling model_fn.
I0814 21:41:08.190795 140360073827776 evaluation.py:255] Starting evaluation at 2019-08-14T21:41:08Z
I0814 21:41:08.191056 140360073827776 tpu_estimator.py:499] TPU job name worker
I0814 21:41:08.273092 140360073827776 monitored_session.py:240] Graph was finalized.
W0814 21:41:08.273964 140360073827776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:41:08.478583 140360073827776 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:41:11.269052 140360073827776 session_manager.py:500] Running local_init_op.
I0814 21:41:11.293950 140360073827776 session_manager.py:502] Done running local_init_op.
I0814 21:41:11.342855 140360073827776 tpu_estimator.py:557] Init TPU system
I0814 21:42:20.033878 140360073827776 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:42:20.034954 140359173920512 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:42:20.035624 140359165527808 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:42:20.102906 140360073827776 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:42:20.129272 140360073827776 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:42:20.129633 140360073827776 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:42:20.158441 140359152150272 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:42:20.444709 140359152150272 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:42:20.915630 140359165527808 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:42:21.361119 140360073827776 evaluation.py:167] Evaluation [10/10]
I0814 21:42:21.361479 140360073827776 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:42:21.361557 140360073827776 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:42:21.361838 140359173920512 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:42:21.362121 140359173920512 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:42:21.362360 140360073827776 error_handling.py:96] infeed marked as finished
I0814 21:42:21.362581 140360073827776 tpu_estimator.py:602] Stop output thread controller
I0814 21:42:21.362644 140360073827776 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:42:21.362828 140359165527808 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:42:21.363024 140359165527808 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:42:21.363210 140360073827776 error_handling.py:96] outfeed marked as finished
I0814 21:42:21.363365 140360073827776 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:42:50.543839 140360073827776 evaluation.py:275] Finished evaluation at 2019-08-14-21:42:50
I0814 21:42:50.544179 140360073827776 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9827, global_step = 30, loss = 0.059216928
I0814 21:42:55.774487 140360073827776 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:42:56.575042 140360073827776 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.059216928, 'global_step': 30, 'accuracy': 0.9827}

Removing gs://yangyou-mnist/log/#1565818778745972...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565818792262242...
Removing gs://yangyou-mnist/log/checkpoint#1565818855636855...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565818796677833...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565818784027184...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565818778.v3-8-tpu#1565818858884346...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565818852557335...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565818853530088...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565818791377998...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565818857871676...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565818972264983...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565818972.v3-8-tpu#1565818976264173...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:43:00.513448 139773884749248 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:43:00.514238 139773884749248 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:43:00.516967 139773884749248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:43:00.517877 139773884749248 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:43:00.518485 139773884749248 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:43:00.518623 139773884749248 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:43:00.941422 139773884749248 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:43:00.948705 139773884749248 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:43:00.952569 139773884749248 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:43:01.001442 139773884749248 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:43:01.001718 139773884749248 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:43:01.330187 139773884749248 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:43:01.375756 139773884749248 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:43:01.376039 139773884749248 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:43:01.718683 139773884749248 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1f7ee921d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1f81071210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:43:01.719055 139773884749248 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:43:02.048830 139773884749248 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:43:02.051801: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:43:02.066240 139773884749248 tpu_system_metadata.py:148] Found TPU system:
I0814 21:43:02.066479 139773884749248 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:43:02.067027 139773884749248 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:43:02.067091 139773884749248 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:43:02.067146 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:43:02.067435 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:43:02.067495 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:43:02.067553 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:43:02.067604 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:43:02.067651 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:43:02.067698 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:43:02.067743 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:43:02.067789 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:43:02.067836 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:43:02.067884 139773884749248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:43:02.074027 139773884749248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:43:02.086680 139773884749248 estimator.py:1145] Calling model_fn.
W0814 21:43:02.087300 139773884749248 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:43:02.364684 139773884749248 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:43:02.772912 139773884749248 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:43:02.835863 139773884749248 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:43:02.841984 139773884749248 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:43:03.027023 139773884749248 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:43:03.040893 139773884749248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:43:03.053030 139773884749248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:43:03.054088 139773884749248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:43:03.061192 139773884749248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:43:03.066498 139773884749248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:43:03.066716 139773884749248 optimization.py:36] ++++++ warmup starts at step 0, for 10 steps ++++++
W0814 21:43:03.079597 139773884749248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:43:03.190969 139773884749248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:43:03.233650 139773884749248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:43:03.287965 139773884749248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:43:03.339622 139773884749248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:43:03.503426 139773884749248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:43:03.554682 139773884749248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:43:03.604568 139773884749248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:43:03.656541 139773884749248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:43:03.703032 139773884749248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:43:03.744623 139773884749248 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:43:03.760832 139773884749248 estimator.py:1147] Done calling model_fn.
I0814 21:43:07.207827 139773884749248 tpu_estimator.py:499] TPU job name worker
I0814 21:43:07.326157 139773884749248 monitored_session.py:240] Graph was finalized.
I0814 21:43:08.048291 139773884749248 session_manager.py:500] Running local_init_op.
I0814 21:43:08.110380 139773884749248 session_manager.py:502] Done running local_init_op.
I0814 21:43:10.896270 139773884749248 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:43:23.422704 139773884749248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:43:23.587749 139773884749248 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:43:23.588238 139773884749248 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:43:23.588663: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:43:23.593877 139773884749248 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:43:23.596098 139773884749248 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:43:23.600461 139773884749248 tpu_estimator.py:557] Init TPU system
I0814 21:44:04.133656 139773884749248 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 21:44:04.134676 139772982974208 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:44:04.136116 139772974581504 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:44:04.196907 139772966188800 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:44:04.206670 139773884749248 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:44:04.207571 139773884749248 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:44:04.511666 139772966188800 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 21:44:09.103044 139772974581504 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:44:13.808814 139773884749248 basic_session_run_hooks.py:262] loss = 0.111443676, step = 30
I0814 21:44:13.811758 139773884749248 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:44:27.735034 139773884749248 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:44:27.735366 139773884749248 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:44:27.735690 139772982974208 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:44:27.736071 139772982974208 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:44:27.736259 139773884749248 error_handling.py:96] infeed marked as finished
I0814 21:44:27.736530 139773884749248 tpu_estimator.py:602] Stop output thread controller
I0814 21:44:27.736591 139773884749248 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:44:27.736777 139772974581504 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:44:27.736984 139772974581504 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:44:27.737219 139773884749248 error_handling.py:96] outfeed marked as finished
I0814 21:44:27.737456 139773884749248 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:44:34.627006 139773884749248 estimator.py:368] Loss for final step: 0.111443676.
I0814 21:44:34.627814 139773884749248 error_handling.py:96] training_loop marked as finished
I0814 21:44:35.370145 139773884749248 estimator.py:1145] Calling model_fn.
E0814 21:44:36.075143 139773884749248 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:44:36.303739 139773884749248 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:44:36.326369 139773884749248 estimator.py:1147] Done calling model_fn.
I0814 21:44:36.342928 139773884749248 evaluation.py:255] Starting evaluation at 2019-08-14T21:44:36Z
I0814 21:44:36.343180 139773884749248 tpu_estimator.py:499] TPU job name worker
I0814 21:44:36.420183 139773884749248 monitored_session.py:240] Graph was finalized.
W0814 21:44:36.421060 139773884749248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:44:36.631294 139773884749248 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:44:39.146189 139773884749248 session_manager.py:500] Running local_init_op.
I0814 21:44:39.171621 139773884749248 session_manager.py:502] Done running local_init_op.
I0814 21:44:39.231302 139773884749248 tpu_estimator.py:557] Init TPU system
I0814 21:45:48.039843 139773884749248 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:45:48.040868 139772982974208 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:45:48.041754 139772974581504 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:45:48.108998 139773884749248 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:45:48.138912 139773884749248 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:45:48.139286 139773884749248 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:45:48.241496 139772966188800 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:45:48.410902 139772966188800 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:45:48.962810 139772974581504 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:45:49.289604 139773884749248 evaluation.py:167] Evaluation [10/10]
I0814 21:45:49.289994 139773884749248 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:45:49.290085 139773884749248 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:45:49.290384 139772982974208 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:45:49.290738 139772982974208 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:45:49.291129 139773884749248 error_handling.py:96] infeed marked as finished
I0814 21:45:49.291311 139773884749248 tpu_estimator.py:602] Stop output thread controller
I0814 21:45:49.291378 139773884749248 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:45:49.291538 139772974581504 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:45:49.291623 139772974581504 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:45:49.291750 139773884749248 error_handling.py:96] outfeed marked as finished
I0814 21:45:49.291842 139773884749248 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:46:18.511699 139773884749248 evaluation.py:275] Finished evaluation at 2019-08-14-21:46:18
I0814 21:46:18.512023 139773884749248 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9842, global_step = 30, loss = 0.05141138
I0814 21:46:23.071062 139773884749248 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:46:23.927139 139773884749248 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.05141138, 'global_step': 30, 'accuracy': 0.9842}

Removing gs://yangyou-mnist/log/#1565818985316502...
Removing gs://yangyou-mnist/log/checkpoint#1565819064163756...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565818985.v3-8-tpu#1565819067387749...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565818990314207...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565818997421171...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565819002906185...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565819061050983...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565819061969581...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565818998334398...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565819066419929...
Removing gs://yangyou-mnist/log/eval/#1565819180300692...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565819180.v3-8-tpu#1565819183607560...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:46:27.982168 140246758360512 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:46:27.982989 140246758360512 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:46:27.985809 140246758360512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:46:27.986644 140246758360512 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:46:27.987225 140246758360512 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:46:27.987361 140246758360512 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:46:28.439627 140246758360512 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:46:28.450434 140246758360512 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:46:28.455069 140246758360512 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:46:28.514739 140246758360512 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:46:28.515065 140246758360512 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:46:28.914588 140246758360512 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:46:28.972042 140246758360512 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:46:28.972366 140246758360512 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:46:29.132523 140246758360512 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8d985fd250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8d9a7dc210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:46:29.132898 140246758360512 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:46:29.464051 140246758360512 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:46:29.467382: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:46:29.480498 140246758360512 tpu_system_metadata.py:148] Found TPU system:
I0814 21:46:29.480751 140246758360512 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:46:29.481245 140246758360512 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:46:29.481307 140246758360512 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:46:29.481362 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:46:29.481640 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:46:29.481702 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:46:29.481756 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:46:29.481806 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:46:29.481853 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:46:29.481899 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:46:29.481969 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:46:29.482016 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:46:29.482063 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:46:29.482117 140246758360512 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:46:29.488605 140246758360512 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:46:29.502010 140246758360512 estimator.py:1145] Calling model_fn.
W0814 21:46:29.502654 140246758360512 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:46:29.779294 140246758360512 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:46:30.303287 140246758360512 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:46:30.368470 140246758360512 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:46:30.375353 140246758360512 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:46:30.570602 140246758360512 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:46:30.585695 140246758360512 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:46:30.598676 140246758360512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:46:30.599800 140246758360512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:46:30.607424 140246758360512 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:46:30.613125 140246758360512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:46:30.613363 140246758360512 optimization.py:36] ++++++ warmup starts at step 0, for 10 steps ++++++
W0814 21:46:30.626368 140246758360512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:46:30.743355 140246758360512 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:46:30.787977 140246758360512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:46:30.835040 140246758360512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:46:30.889272 140246758360512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:46:31.061939 140246758360512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:46:31.114433 140246758360512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:46:31.166629 140246758360512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:46:31.220581 140246758360512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:46:31.268294 140246758360512 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:46:31.311826 140246758360512 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:46:31.328577 140246758360512 estimator.py:1147] Done calling model_fn.
I0814 21:46:36.175373 140246758360512 tpu_estimator.py:499] TPU job name worker
I0814 21:46:36.299578 140246758360512 monitored_session.py:240] Graph was finalized.
I0814 21:46:36.977768 140246758360512 session_manager.py:500] Running local_init_op.
I0814 21:46:37.041836 140246758360512 session_manager.py:502] Done running local_init_op.
I0814 21:46:40.841367 140246758360512 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:46:53.177510 140246758360512 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:46:53.324292 140246758360512 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:46:53.324748 140246758360512 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:46:53.325149: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:46:53.330262 140246758360512 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:46:53.332284 140246758360512 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:46:53.336568 140246758360512 tpu_estimator.py:557] Init TPU system
I0814 21:47:32.102472 140246758360512 tpu_estimator.py:566] Initialized TPU in 38 seconds
I0814 21:47:32.103264 140246063589120 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:47:32.103779 140245983033088 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:47:32.167663 140245974640384 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:47:32.171443 140246758360512 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:47:32.172883 140246758360512 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:47:32.537478 140245974640384 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:47:36.996478 140245983033088 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:47:41.650974 140246758360512 basic_session_run_hooks.py:262] loss = 0.09078428, step = 30
I0814 21:47:41.653306 140246758360512 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:47:55.692944 140246758360512 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:47:55.693279 140246758360512 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:47:55.694792 140246063589120 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:47:55.695084 140246063589120 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:47:55.695314 140246758360512 error_handling.py:96] infeed marked as finished
I0814 21:47:55.695609 140246758360512 tpu_estimator.py:602] Stop output thread controller
I0814 21:47:55.695686 140246758360512 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:47:55.695858 140245983033088 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:47:55.696043 140245983033088 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:47:55.696228 140246758360512 error_handling.py:96] outfeed marked as finished
I0814 21:47:55.696480 140246758360512 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:48:02.676976 140246758360512 estimator.py:368] Loss for final step: 0.09078428.
I0814 21:48:02.677933 140246758360512 error_handling.py:96] training_loop marked as finished
I0814 21:48:03.370244 140246758360512 estimator.py:1145] Calling model_fn.
E0814 21:48:04.059806 140246758360512 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:48:04.290618 140246758360512 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:48:04.312927 140246758360512 estimator.py:1147] Done calling model_fn.
I0814 21:48:04.330459 140246758360512 evaluation.py:255] Starting evaluation at 2019-08-14T21:48:04Z
I0814 21:48:04.330703 140246758360512 tpu_estimator.py:499] TPU job name worker
I0814 21:48:04.413439 140246758360512 monitored_session.py:240] Graph was finalized.
W0814 21:48:04.414171 140246758360512 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:48:04.612190 140246758360512 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:48:07.381055 140246758360512 session_manager.py:500] Running local_init_op.
I0814 21:48:07.405144 140246758360512 session_manager.py:502] Done running local_init_op.
I0814 21:48:07.454113 140246758360512 tpu_estimator.py:557] Init TPU system
I0814 21:49:16.053750 140246758360512 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:49:16.055183 140245983033088 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:49:16.055761 140245974640384 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:49:16.125519 140246758360512 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:49:16.152240 140246758360512 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:49:16.152741 140246758360512 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:49:16.195547 140245966247680 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:49:16.582779 140245966247680 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:49:16.911950 140245974640384 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:49:17.377733 140246758360512 evaluation.py:167] Evaluation [10/10]
I0814 21:49:17.378129 140246758360512 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:49:17.378206 140246758360512 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:49:17.378701 140245983033088 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:49:17.379000 140245983033088 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:49:17.379261 140246758360512 error_handling.py:96] infeed marked as finished
I0814 21:49:17.379543 140246758360512 tpu_estimator.py:602] Stop output thread controller
I0814 21:49:17.379618 140246758360512 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:49:17.380142 140245974640384 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:49:17.380388 140245974640384 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:49:17.380618 140246758360512 error_handling.py:96] outfeed marked as finished
I0814 21:49:17.380794 140246758360512 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:49:46.682094 140246758360512 evaluation.py:275] Finished evaluation at 2019-08-14-21:49:46
I0814 21:49:46.682449 140246758360512 estimator.py:2039] Saving dict for global step 30: accuracy = 0.977, global_step = 30, loss = 0.10619314
I0814 21:49:51.421271 140246758360512 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:49:52.276773 140246758360512 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10619314, 'global_step': 30, 'accuracy': 0.977}

Removing gs://yangyou-mnist/log/events.out.tfevents.1565819194.v3-8-tpu#1565819275381385...
Removing gs://yangyou-mnist/log/#1565819193956959...
Removing gs://yangyou-mnist/log/checkpoint#1565819272052558...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565819200264202...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565819268796391...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565819207226729...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565819269725127...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565819208192333...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565819212661629...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565819274346326...
Removing gs://yangyou-mnist/log/eval/#1565819388504056...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565819388.v3-8-tpu#1565819391942331...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:49:56.093564 139942728947136 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:49:56.094352 139942728947136 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:49:56.096937 139942728947136 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:49:56.097765 139942728947136 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:49:56.098335 139942728947136 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:49:56.098459 139942728947136 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:49:56.523721 139942728947136 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:49:56.531807 139942728947136 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:49:56.535995 139942728947136 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:49:56.589492 139942728947136 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:49:56.589786 139942728947136 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:49:56.887646 139942728947136 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:49:57.008948 139942728947136 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:49:57.009228 139942728947136 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:49:57.302896 139942728947136 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f46cecf20d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f46d0ed1210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:49:57.303308 139942728947136 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:49:57.628560 139942728947136 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:49:57.631437: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:49:57.644521 139942728947136 tpu_system_metadata.py:148] Found TPU system:
I0814 21:49:57.644787 139942728947136 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:49:57.645286 139942728947136 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:49:57.645358 139942728947136 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:49:57.645411 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:49:57.645697 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:49:57.645752 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:49:57.645803 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:49:57.645853 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:49:57.645900 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:49:57.645947 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:49:57.645996 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:49:57.646043 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:49:57.646089 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:49:57.646147 139942728947136 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:49:57.652218 139942728947136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:49:57.664922 139942728947136 estimator.py:1145] Calling model_fn.
W0814 21:49:57.665530 139942728947136 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:49:57.957271 139942728947136 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:49:58.482522 139942728947136 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:49:58.544538 139942728947136 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:49:58.550470 139942728947136 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:49:58.733459 139942728947136 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:49:58.747579 139942728947136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:49:58.760036 139942728947136 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:49:58.761178 139942728947136 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:49:58.768506 139942728947136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:49:58.774274 139942728947136 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:49:58.774492 139942728947136 optimization.py:36] ++++++ warmup starts at step 0, for 10 steps ++++++
W0814 21:49:58.787110 139942728947136 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:49:58.897244 139942728947136 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:49:58.939656 139942728947136 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:49:58.985126 139942728947136 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:49:59.036812 139942728947136 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:49:59.205265 139942728947136 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:49:59.264990 139942728947136 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:49:59.315579 139942728947136 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:49:59.368282 139942728947136 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:49:59.415182 139942728947136 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:49:59.457256 139942728947136 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:49:59.473670 139942728947136 estimator.py:1147] Done calling model_fn.
I0814 21:50:03.694546 139942728947136 tpu_estimator.py:499] TPU job name worker
I0814 21:50:03.806798 139942728947136 monitored_session.py:240] Graph was finalized.
I0814 21:50:04.531650 139942728947136 session_manager.py:500] Running local_init_op.
I0814 21:50:04.581780 139942728947136 session_manager.py:502] Done running local_init_op.
I0814 21:50:07.309598 139942728947136 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:50:20.047440 139942728947136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:50:20.214513 139942728947136 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:50:20.215013 139942728947136 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:50:20.215426: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:50:20.220889 139942728947136 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:50:20.222948 139942728947136 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:50:20.228072 139942728947136 tpu_estimator.py:557] Init TPU system
I0814 21:51:00.128055 139942728947136 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 21:51:00.129070 139941828876032 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:51:00.129935 139941820483328 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:51:00.197129 139941812090624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:51:00.198124 139942728947136 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:51:00.199491 139942728947136 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:51:00.600713 139941812090624 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:51:05.084135 139941820483328 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:51:09.854809 139942728947136 basic_session_run_hooks.py:262] loss = 0.10908241, step = 30
I0814 21:51:09.856832 139942728947136 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:51:23.730664 139942728947136 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:51:23.730987 139942728947136 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:51:23.731282 139941828876032 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:51:23.731580 139941828876032 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:51:23.731869 139942728947136 error_handling.py:96] infeed marked as finished
I0814 21:51:23.732072 139942728947136 tpu_estimator.py:602] Stop output thread controller
I0814 21:51:23.732129 139942728947136 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:51:23.732312 139941820483328 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:51:23.732532 139941820483328 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:51:23.732779 139942728947136 error_handling.py:96] outfeed marked as finished
I0814 21:51:23.732918 139942728947136 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:51:30.743855 139942728947136 estimator.py:368] Loss for final step: 0.10908241.
I0814 21:51:30.744677 139942728947136 error_handling.py:96] training_loop marked as finished
I0814 21:51:31.572360 139942728947136 estimator.py:1145] Calling model_fn.
E0814 21:51:32.369631 139942728947136 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:51:32.602478 139942728947136 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:51:32.625304 139942728947136 estimator.py:1147] Done calling model_fn.
I0814 21:51:32.643542 139942728947136 evaluation.py:255] Starting evaluation at 2019-08-14T21:51:32Z
I0814 21:51:32.643771 139942728947136 tpu_estimator.py:499] TPU job name worker
I0814 21:51:32.726182 139942728947136 monitored_session.py:240] Graph was finalized.
W0814 21:51:32.726912 139942728947136 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:51:32.930423 139942728947136 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:51:35.702886 139942728947136 session_manager.py:500] Running local_init_op.
I0814 21:51:35.728387 139942728947136 session_manager.py:502] Done running local_init_op.
I0814 21:51:35.781758 139942728947136 tpu_estimator.py:557] Init TPU system
I0814 21:52:44.023751 139942728947136 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:52:44.024857 139941828876032 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:52:44.025656 139941820483328 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:52:44.092391 139942728947136 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:52:44.117887 139942728947136 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:52:44.118230 139942728947136 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:52:44.156198 139941812090624 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:52:44.430839 139941812090624 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:52:44.934142 139941820483328 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:52:45.234353 139942728947136 evaluation.py:167] Evaluation [10/10]
I0814 21:52:45.234663 139942728947136 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:52:45.234731 139942728947136 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:52:45.235060 139941828876032 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:52:45.235342 139941828876032 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:52:45.235575 139942728947136 error_handling.py:96] infeed marked as finished
I0814 21:52:45.235764 139942728947136 tpu_estimator.py:602] Stop output thread controller
I0814 21:52:45.235918 139942728947136 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:52:45.236092 139941820483328 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:52:45.236243 139941820483328 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:52:45.236438 139942728947136 error_handling.py:96] outfeed marked as finished
I0814 21:52:45.236582 139942728947136 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:53:14.523663 139942728947136 evaluation.py:275] Finished evaluation at 2019-08-14-21:53:14
I0814 21:53:14.524030 139942728947136 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9746, global_step = 30, loss = 0.084680565
I0814 21:53:18.779881 139942728947136 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:53:19.593945 139942728947136 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.084680565, 'global_step': 30, 'accuracy': 0.9746}

Removing gs://yangyou-mnist/log/#1565819400996765...
Removing gs://yangyou-mnist/log/checkpoint#1565819480233005...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565819477068681...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565819414973574...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565819401.v3-8-tpu#1565819483422431...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565819419531753...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565819413823106...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565819406726238...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565819477985474...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565819482432612...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565819596.v3-8-tpu#1565819599291201...
Removing gs://yangyou-mnist/log/eval/#1565819596217696...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:53:23.465250 139890991781312 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:53:23.466088 139890991781312 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:53:23.468810 139890991781312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:53:23.469710 139890991781312 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:53:23.470347 139890991781312 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:53:23.470487 139890991781312 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:53:23.886029 139890991781312 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:53:23.894143 139890991781312 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:53:23.898753 139890991781312 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:53:24.018585 139890991781312 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:53:24.018881 139890991781312 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:53:24.280778 139890991781312 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:53:24.330899 139890991781312 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:53:24.331178 139890991781312 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:53:24.498961 139890991781312 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3ac308a190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3ac5269210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:53:24.499367 139890991781312 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:53:24.834378 139890991781312 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:53:24.837275: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:53:24.849771 139890991781312 tpu_system_metadata.py:148] Found TPU system:
I0814 21:53:24.850013 139890991781312 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:53:24.850532 139890991781312 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:53:24.850589 139890991781312 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:53:24.850742 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:53:24.851090 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:53:24.851150 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:53:24.851201 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:53:24.851253 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:53:24.851310 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:53:24.851357 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:53:24.851411 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:53:24.851460 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:53:24.851507 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:53:24.851576 139890991781312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:53:24.857884 139890991781312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:53:24.871067 139890991781312 estimator.py:1145] Calling model_fn.
W0814 21:53:24.871766 139890991781312 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:53:25.148279 139890991781312 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:53:25.565630 139890991781312 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:53:25.630583 139890991781312 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:53:25.636871 139890991781312 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:53:25.822292 139890991781312 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:53:25.836615 139890991781312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:53:25.849005 139890991781312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:53:25.850069 139890991781312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:53:25.857268 139890991781312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:53:25.862560 139890991781312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:53:25.862799 139890991781312 optimization.py:36] ++++++ warmup starts at step 0, for 11 steps ++++++
W0814 21:53:25.875967 139890991781312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:53:25.987428 139890991781312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:53:26.030452 139890991781312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:53:26.075536 139890991781312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:53:26.132976 139890991781312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:53:26.298082 139890991781312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:53:26.349530 139890991781312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:53:26.398718 139890991781312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:53:26.449440 139890991781312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:53:26.495971 139890991781312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:53:26.538559 139890991781312 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:53:26.555254 139890991781312 estimator.py:1147] Done calling model_fn.
I0814 21:53:30.179584 139890991781312 tpu_estimator.py:499] TPU job name worker
I0814 21:53:30.292098 139890991781312 monitored_session.py:240] Graph was finalized.
I0814 21:53:30.968703 139890991781312 session_manager.py:500] Running local_init_op.
I0814 21:53:31.021223 139890991781312 session_manager.py:502] Done running local_init_op.
I0814 21:53:33.887418 139890991781312 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:53:46.339471 139890991781312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:53:46.486953 139890991781312 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:53:46.487390 139890991781312 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:53:46.487890: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:53:46.492911 139890991781312 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:53:46.495183 139890991781312 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:53:46.498984 139890991781312 tpu_estimator.py:557] Init TPU system
I0814 21:54:28.122343 139890991781312 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 21:54:28.123298 139890079549184 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:54:28.124054 139890071156480 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:54:28.190032 139890062763776 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:54:28.192874 139890991781312 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:54:28.194271 139890991781312 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:54:28.416013 139890062763776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:54:33.014204 139890071156480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:54:37.314331 139890991781312 basic_session_run_hooks.py:262] loss = 0.08801818, step = 30
I0814 21:54:37.317327 139890991781312 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:54:50.984812 139890991781312 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:54:50.985096 139890991781312 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:54:50.985285 139890079549184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:54:50.985383 139890079549184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:54:50.985521 139890991781312 error_handling.py:96] infeed marked as finished
I0814 21:54:50.985614 139890991781312 tpu_estimator.py:602] Stop output thread controller
I0814 21:54:50.985661 139890991781312 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:54:50.985780 139890071156480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:54:50.985850 139890071156480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:54:50.985975 139890991781312 error_handling.py:96] outfeed marked as finished
I0814 21:54:50.986052 139890991781312 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:54:58.555085 139890991781312 estimator.py:368] Loss for final step: 0.08801818.
I0814 21:54:58.555814 139890991781312 error_handling.py:96] training_loop marked as finished
I0814 21:54:59.265311 139890991781312 estimator.py:1145] Calling model_fn.
E0814 21:54:59.951934 139890991781312 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:55:00.175426 139890991781312 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:55:00.197417 139890991781312 estimator.py:1147] Done calling model_fn.
I0814 21:55:00.214344 139890991781312 evaluation.py:255] Starting evaluation at 2019-08-14T21:55:00Z
I0814 21:55:00.214611 139890991781312 tpu_estimator.py:499] TPU job name worker
I0814 21:55:00.292757 139890991781312 monitored_session.py:240] Graph was finalized.
W0814 21:55:00.293596 139890991781312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:55:00.494518 139890991781312 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:55:03.172770 139890991781312 session_manager.py:500] Running local_init_op.
I0814 21:55:03.197392 139890991781312 session_manager.py:502] Done running local_init_op.
I0814 21:55:03.244539 139890991781312 tpu_estimator.py:557] Init TPU system
I0814 21:56:12.108366 139890991781312 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:56:12.109563 139890087941888 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:56:12.110235 139890079549184 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:56:12.179290 139890991781312 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:56:12.204716 139890991781312 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:56:12.205087 139890991781312 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:56:12.250351 139890071156480 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:56:12.505357 139890071156480 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:56:13.028599 139890079549184 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:56:13.335443 139890991781312 evaluation.py:167] Evaluation [10/10]
I0814 21:56:13.335796 139890991781312 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:56:13.335869 139890991781312 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:56:13.336117 139890087941888 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:56:13.336383 139890087941888 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:56:13.336689 139890991781312 error_handling.py:96] infeed marked as finished
I0814 21:56:13.336888 139890991781312 tpu_estimator.py:602] Stop output thread controller
I0814 21:56:13.336942 139890991781312 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:56:13.337100 139890079549184 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:56:13.337244 139890079549184 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:56:13.337392 139890991781312 error_handling.py:96] outfeed marked as finished
I0814 21:56:13.337516 139890991781312 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:56:42.586554 139890991781312 evaluation.py:275] Finished evaluation at 2019-08-14-21:56:42
I0814 21:56:42.587001 139890991781312 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9773, global_step = 30, loss = 0.066667184
I0814 21:56:47.818475 139890991781312 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 21:56:48.669487 139890991781312 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.066667184, 'global_step': 30, 'accuracy': 0.9773}

Removing gs://yangyou-mnist/log/#1565819608080868...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565819621473010...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565819625830259...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565819684284273...
Removing gs://yangyou-mnist/log/checkpoint#1565819687444800...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565819608.v3-8-tpu#1565819690677880...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565819685182409...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565819613300365...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565819620498424...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565819689702706...
Removing gs://yangyou-mnist/log/eval/#1565819804359214...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565819804.v3-8-tpu#1565819808366006...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 21:56:52.681992 140178412295616 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 21:56:52.682763 140178412295616 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 21:56:52.685426 140178412295616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 21:56:52.686239 140178412295616 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 21:56:52.686805 140178412295616 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 21:56:52.686933 140178412295616 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 21:56:53.095949 140178412295616 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 21:56:53.105134 140178412295616 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 21:56:53.110197 140178412295616 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:56:53.165592 140178412295616 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:56:53.165878 140178412295616 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:56:53.446511 140178412295616 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 21:56:53.504365 140178412295616 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 21:56:53.504754 140178412295616 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:56:53.801407 140178412295616 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f7daea03310>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f7db0bf9210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 21:56:53.801743 140178412295616 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 21:56:54.125766 140178412295616 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 21:56:54.129330: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:56:54.144313 140178412295616 tpu_system_metadata.py:148] Found TPU system:
I0814 21:56:54.144735 140178412295616 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 21:56:54.145301 140178412295616 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 21:56:54.145371 140178412295616 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 21:56:54.145437 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 21:56:54.145762 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 21:56:54.145827 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 21:56:54.145890 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 21:56:54.145946 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 21:56:54.146007 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 21:56:54.146083 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 21:56:54.146136 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 21:56:54.146188 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 21:56:54.146240 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 21:56:54.146294 140178412295616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 21:56:54.153465 140178412295616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 21:56:54.167258 140178412295616 estimator.py:1145] Calling model_fn.
W0814 21:56:54.167959 140178412295616 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 21:56:54.440591 140178412295616 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 21:56:54.882972 140178412295616 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 21:56:54.948476 140178412295616 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 21:56:54.954673 140178412295616 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:56:55.146522 140178412295616 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 21:56:55.161514 140178412295616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 21:56:55.174356 140178412295616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 21:56:55.175523 140178412295616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 21:56:55.182847 140178412295616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 21:56:55.188231 140178412295616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 21:56:55.188663 140178412295616 optimization.py:36] ++++++ warmup starts at step 0, for 11 steps ++++++
W0814 21:56:55.202083 140178412295616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 21:56:55.327043 140178412295616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 21:56:55.370870 140178412295616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:56:55.415905 140178412295616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:56:55.472290 140178412295616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:56:55.649126 140178412295616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:56:55.699990 140178412295616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:56:55.749914 140178412295616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:56:55.799967 140178412295616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:56:55.846688 140178412295616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 21:56:55.888148 140178412295616 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 21:56:55.905121 140178412295616 estimator.py:1147] Done calling model_fn.
I0814 21:57:00.419855 140178412295616 tpu_estimator.py:499] TPU job name worker
I0814 21:57:00.533804 140178412295616 monitored_session.py:240] Graph was finalized.
I0814 21:57:01.189515 140178412295616 session_manager.py:500] Running local_init_op.
I0814 21:57:01.237775 140178412295616 session_manager.py:502] Done running local_init_op.
I0814 21:57:03.926050 140178412295616 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 21:57:16.332525 140178412295616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 21:57:16.508727 140178412295616 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:57:16.509149 140178412295616 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 21:57:16.509609: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 21:57:16.515399 140178412295616 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 21:57:16.517586 140178412295616 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 21:57:16.521780 140178412295616 tpu_estimator.py:557] Init TPU system
I0814 21:57:56.107239 140178412295616 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 21:57:56.108184 140177641031424 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:57:56.108692 140177632638720 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:57:56.172983 140177624246016 transport.py:157] Attempting refresh to obtain initial access_token
I0814 21:57:56.174895 140178412295616 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 21:57:56.176141 140178412295616 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 21:57:56.473706 140177624246016 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:58:00.934489 140177632638720 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:58:05.767498 140178412295616 basic_session_run_hooks.py:262] loss = 0.087171, step = 30
I0814 21:58:05.770344 140178412295616 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 21:58:19.706026 140178412295616 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:58:19.706330 140178412295616 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:58:19.706528 140177641031424 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:58:19.706629 140177641031424 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:58:19.706760 140178412295616 error_handling.py:96] infeed marked as finished
I0814 21:58:19.706856 140178412295616 tpu_estimator.py:602] Stop output thread controller
I0814 21:58:19.706904 140178412295616 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:58:19.707020 140177632638720 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:58:19.707091 140177632638720 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:58:19.707200 140178412295616 error_handling.py:96] outfeed marked as finished
I0814 21:58:19.707293 140178412295616 tpu_estimator.py:606] Shutdown TPU system.
I0814 21:58:26.618839 140178412295616 estimator.py:368] Loss for final step: 0.087171.
I0814 21:58:26.619581 140178412295616 error_handling.py:96] training_loop marked as finished
I0814 21:58:27.417359 140178412295616 estimator.py:1145] Calling model_fn.
E0814 21:58:28.115288 140178412295616 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 21:58:28.344685 140178412295616 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 21:58:28.366311 140178412295616 estimator.py:1147] Done calling model_fn.
I0814 21:58:28.383470 140178412295616 evaluation.py:255] Starting evaluation at 2019-08-14T21:58:28Z
I0814 21:58:28.383703 140178412295616 tpu_estimator.py:499] TPU job name worker
I0814 21:58:28.460998 140178412295616 monitored_session.py:240] Graph was finalized.
W0814 21:58:28.461724 140178412295616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 21:58:28.661300 140178412295616 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 21:58:31.665644 140178412295616 session_manager.py:500] Running local_init_op.
I0814 21:58:31.695122 140178412295616 session_manager.py:502] Done running local_init_op.
I0814 21:58:31.753086 140178412295616 tpu_estimator.py:557] Init TPU system
I0814 21:59:40.099176 140178412295616 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 21:59:40.100061 140177646278400 tpu_estimator.py:514] Starting infeed thread controller.
I0814 21:59:40.101016 140177637885696 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 21:59:40.170155 140178412295616 util.py:98] Initialized dataset iterators in 0 seconds
I0814 21:59:40.198779 140178412295616 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 21:59:40.199120 140178412295616 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 21:59:40.235707 140177629492992 transport.py:157] Attempting refresh to obtain initial access_token
W0814 21:59:40.632142 140177629492992 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 21:59:40.994441 140177637885696 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 21:59:41.470932 140178412295616 evaluation.py:167] Evaluation [10/10]
I0814 21:59:41.471292 140178412295616 tpu_estimator.py:598] Stop infeed thread controller
I0814 21:59:41.471385 140178412295616 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 21:59:41.471579 140177646278400 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 21:59:41.471688 140177646278400 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 21:59:41.471874 140178412295616 error_handling.py:96] infeed marked as finished
I0814 21:59:41.471983 140178412295616 tpu_estimator.py:602] Stop output thread controller
I0814 21:59:41.472034 140178412295616 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 21:59:41.472155 140177637885696 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 21:59:41.472239 140177637885696 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 21:59:41.472361 140178412295616 error_handling.py:96] outfeed marked as finished
I0814 21:59:41.472484 140178412295616 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:00:10.730340 140178412295616 evaluation.py:275] Finished evaluation at 2019-08-14-22:00:10
I0814 22:00:10.730654 140178412295616 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9771, global_step = 30, loss = 0.074435525
I0814 22:00:15.110816 140178412295616 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:00:15.983566 140178412295616 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.074435525, 'global_step': 30, 'accuracy': 0.9771}

Removing gs://yangyou-mnist/log/#1565819818289392...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565819818.v3-8-tpu#1565819899394871...
Removing gs://yangyou-mnist/log/checkpoint#1565819896097620...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565819823347881...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565819830464670...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565819892921679...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565819831324259...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565819835809475...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565819893862588...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565819898436941...
Removing gs://yangyou-mnist/log/eval/#1565820012516603...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565820012.v3-8-tpu#1565820015675025...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:00:19.893512 139744181806528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:00:19.894787 139744181806528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:00:19.897629 139744181806528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:00:19.898474 139744181806528 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:00:19.899070 139744181806528 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:00:19.899199 139744181806528 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:00:20.332045 139744181806528 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:00:20.340517 139744181806528 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:00:20.344850 139744181806528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:00:20.401745 139744181806528 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:00:20.402050 139744181806528 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:00:20.652638 139744181806528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:00:20.769268 139744181806528 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:00:20.769795 139744181806528 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:00:21.023123 139744181806528 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f18947a3090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f18969821d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:00:21.023564 139744181806528 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:00:21.382304 139744181806528 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:00:21.385130: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:00:21.397218 139744181806528 tpu_system_metadata.py:148] Found TPU system:
I0814 22:00:21.397465 139744181806528 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:00:21.398061 139744181806528 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:00:21.398123 139744181806528 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:00:21.398180 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:00:21.398466 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:00:21.398521 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:00:21.398592 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:00:21.398653 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:00:21.398701 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:00:21.398749 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:00:21.398794 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:00:21.398847 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:00:21.398894 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:00:21.398941 139744181806528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:00:21.405206 139744181806528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:00:21.417876 139744181806528 estimator.py:1145] Calling model_fn.
W0814 22:00:21.418478 139744181806528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:00:21.692188 139744181806528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:00:22.105431 139744181806528 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:00:22.167567 139744181806528 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:00:22.173592 139744181806528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:00:22.358432 139744181806528 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:00:22.372494 139744181806528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:00:22.384757 139744181806528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:00:22.385869 139744181806528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:00:22.393013 139744181806528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:00:22.398320 139744181806528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:00:22.398534 139744181806528 optimization.py:36] ++++++ warmup starts at step 0, for 11 steps ++++++
W0814 22:00:22.411151 139744181806528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:00:22.522676 139744181806528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:00:22.565326 139744181806528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:00:22.609958 139744181806528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:00:22.662190 139744181806528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:00:22.831372 139744181806528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:00:22.882613 139744181806528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:00:22.931813 139744181806528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:00:22.981995 139744181806528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:00:23.028244 139744181806528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:00:23.070884 139744181806528 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:00:23.087575 139744181806528 estimator.py:1147] Done calling model_fn.
I0814 22:00:26.626615 139744181806528 tpu_estimator.py:499] TPU job name worker
I0814 22:00:26.738831 139744181806528 monitored_session.py:240] Graph was finalized.
I0814 22:00:27.437740 139744181806528 session_manager.py:500] Running local_init_op.
I0814 22:00:27.492654 139744181806528 session_manager.py:502] Done running local_init_op.
I0814 22:00:30.341954 139744181806528 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:00:42.931891 139744181806528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:00:43.104393 139744181806528 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:00:43.104912 139744181806528 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:00:43.105334: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:00:43.110574 139744181806528 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:00:43.112792 139744181806528 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:00:43.117356 139744181806528 tpu_estimator.py:557] Init TPU system
I0814 22:01:24.129833 139744181806528 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 22:01:24.130975 139743419672320 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:01:24.131650 139743069206272 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:01:24.198090 139744181806528 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:01:24.199053 139744181806528 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 22:01:24.262078 139743060813568 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:01:24.408344 139743060813568 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 22:01:29.059027 139743069206272 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:01:33.628237 139744181806528 basic_session_run_hooks.py:262] loss = 0.09988697, step = 30
I0814 22:01:33.631308 139744181806528 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:01:47.069601 139744181806528 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:01:47.069927 139744181806528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:01:47.071472 139743419672320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:01:47.071691 139743419672320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:01:47.071890 139744181806528 error_handling.py:96] infeed marked as finished
I0814 22:01:47.072051 139744181806528 tpu_estimator.py:602] Stop output thread controller
I0814 22:01:47.072113 139744181806528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:01:47.072294 139743069206272 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:01:47.072429 139743069206272 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:01:47.072572 139744181806528 error_handling.py:96] outfeed marked as finished
I0814 22:01:47.072664 139744181806528 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:01:54.545924 139744181806528 estimator.py:368] Loss for final step: 0.09988697.
I0814 22:01:54.546787 139744181806528 error_handling.py:96] training_loop marked as finished
I0814 22:01:55.342689 139744181806528 estimator.py:1145] Calling model_fn.
E0814 22:01:56.040083 139744181806528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:01:56.282021 139744181806528 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:01:56.303998 139744181806528 estimator.py:1147] Done calling model_fn.
I0814 22:01:56.321474 139744181806528 evaluation.py:255] Starting evaluation at 2019-08-14T22:01:56Z
I0814 22:01:56.321706 139744181806528 tpu_estimator.py:499] TPU job name worker
I0814 22:01:56.401683 139744181806528 monitored_session.py:240] Graph was finalized.
W0814 22:01:56.402420 139744181806528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:01:56.606029 139744181806528 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:01:59.256548 139744181806528 session_manager.py:500] Running local_init_op.
I0814 22:01:59.287204 139744181806528 session_manager.py:502] Done running local_init_op.
I0814 22:01:59.340914 139744181806528 tpu_estimator.py:557] Init TPU system
I0814 22:03:08.075021 139744181806528 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:03:08.076214 139743069206272 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:03:08.077054 139743060813568 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:03:08.146183 139744181806528 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:03:08.174479 139744181806528 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:03:08.174928 139744181806528 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:03:08.213969 139743052420864 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:03:08.457400 139743052420864 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:03:08.965372 139743060813568 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:03:09.294450 139744181806528 evaluation.py:167] Evaluation [10/10]
I0814 22:03:09.294822 139744181806528 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:03:09.294907 139744181806528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:03:09.295188 139743069206272 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:03:09.295497 139743069206272 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:03:09.295840 139744181806528 error_handling.py:96] infeed marked as finished
I0814 22:03:09.296087 139744181806528 tpu_estimator.py:602] Stop output thread controller
I0814 22:03:09.296158 139744181806528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:03:09.296345 139743060813568 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:03:09.296592 139743060813568 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:03:09.296793 139744181806528 error_handling.py:96] outfeed marked as finished
I0814 22:03:09.296967 139744181806528 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:03:38.545090 139744181806528 evaluation.py:275] Finished evaluation at 2019-08-14-22:03:38
I0814 22:03:38.545442 139744181806528 estimator.py:2039] Saving dict for global step 30: accuracy = 0.978, global_step = 30, loss = 0.078672335
I0814 22:03:43.098572 139744181806528 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:03:43.929456 139744181806528 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.078672335, 'global_step': 30, 'accuracy': 0.978}

Removing gs://yangyou-mnist/log/#1565820024734482...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565820029759776...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565820042421261...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565820024.v3-8-tpu#1565820106768657...
Removing gs://yangyou-mnist/log/checkpoint#1565820103549145...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565820037816878...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565820100253659...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565820036932538...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565820101093370...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565820105736717...
Removing gs://yangyou-mnist/log/eval/#1565820220276189...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565820220.v3-8-tpu#1565820223626424...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:03:47.896728 140664346199488 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:03:47.897485 140664346199488 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:03:47.900165 140664346199488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:03:47.901201 140664346199488 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:03:47.901787 140664346199488 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:03:47.901916 140664346199488 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:03:48.336088 140664346199488 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:03:48.345699 140664346199488 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:03:48.349566 140664346199488 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:03:48.405337 140664346199488 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:03:48.405608 140664346199488 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:03:48.611692 140664346199488 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:03:48.666204 140664346199488 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:03:48.666480 140664346199488 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:03:48.952599 140664346199488 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7feed28c9210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7feed4aa8210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:03:48.953032 140664346199488 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:03:49.276176 140664346199488 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:03:49.279259: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:03:49.296761 140664346199488 tpu_system_metadata.py:148] Found TPU system:
I0814 22:03:49.297003 140664346199488 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:03:49.297509 140664346199488 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:03:49.297568 140664346199488 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:03:49.297627 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:03:49.297925 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:03:49.297983 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:03:49.298038 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:03:49.298088 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:03:49.298217 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:03:49.298276 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:03:49.298324 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:03:49.298369 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:03:49.298417 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:03:49.298465 140664346199488 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:03:49.304280 140664346199488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:03:49.317230 140664346199488 estimator.py:1145] Calling model_fn.
W0814 22:03:49.317859 140664346199488 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:03:49.582672 140664346199488 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:03:49.985130 140664346199488 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:03:50.048063 140664346199488 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:03:50.054250 140664346199488 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:03:50.240127 140664346199488 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:03:50.262350 140664346199488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:03:50.274987 140664346199488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:03:50.276096 140664346199488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:03:50.283390 140664346199488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:03:50.288669 140664346199488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:03:50.288897 140664346199488 optimization.py:36] ++++++ warmup starts at step 0, for 11 steps ++++++
W0814 22:03:50.301987 140664346199488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:03:50.415484 140664346199488 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:03:50.458086 140664346199488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:03:50.503243 140664346199488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:03:50.555691 140664346199488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:03:50.716912 140664346199488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:03:50.767777 140664346199488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:03:50.817564 140664346199488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:03:50.868619 140664346199488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:03:50.914896 140664346199488 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:03:50.956602 140664346199488 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:03:50.973041 140664346199488 estimator.py:1147] Done calling model_fn.
I0814 22:03:54.508497 140664346199488 tpu_estimator.py:499] TPU job name worker
I0814 22:03:54.622869 140664346199488 monitored_session.py:240] Graph was finalized.
I0814 22:03:55.295028 140664346199488 session_manager.py:500] Running local_init_op.
I0814 22:03:55.342178 140664346199488 session_manager.py:502] Done running local_init_op.
I0814 22:03:58.508476 140664346199488 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:04:12.145566 140664346199488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:04:12.305099 140664346199488 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:04:12.305542 140664346199488 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:04:12.305946: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:04:12.310755 140664346199488 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:04:12.312972 140664346199488 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:04:12.318217 140664346199488 tpu_estimator.py:557] Init TPU system
I0814 22:04:52.128914 140664346199488 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 22:04:52.129800 140663449966336 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:04:52.130273 140663441573632 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:04:52.193656 140663433180928 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:04:52.195010 140664346199488 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:04:52.196681 140664346199488 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:04:52.492095 140663433180928 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:04:56.976701 140663441573632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:05:01.736428 140664346199488 basic_session_run_hooks.py:262] loss = 0.08108841, step = 30
I0814 22:05:01.738631 140664346199488 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:05:15.552936 140664346199488 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:05:15.553257 140664346199488 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:05:15.553467 140663449966336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:05:15.553586 140663449966336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:05:15.553735 140664346199488 error_handling.py:96] infeed marked as finished
I0814 22:05:15.553833 140664346199488 tpu_estimator.py:602] Stop output thread controller
I0814 22:05:15.553894 140664346199488 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:05:15.554013 140663441573632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:05:15.554106 140663441573632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:05:15.554224 140664346199488 error_handling.py:96] outfeed marked as finished
I0814 22:05:15.554322 140664346199488 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:05:22.629034 140664346199488 estimator.py:368] Loss for final step: 0.08108841.
I0814 22:05:22.629894 140664346199488 error_handling.py:96] training_loop marked as finished
I0814 22:05:23.363035 140664346199488 estimator.py:1145] Calling model_fn.
E0814 22:05:24.098352 140664346199488 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:05:24.334381 140664346199488 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:05:24.356502 140664346199488 estimator.py:1147] Done calling model_fn.
I0814 22:05:24.373558 140664346199488 evaluation.py:255] Starting evaluation at 2019-08-14T22:05:24Z
I0814 22:05:24.373807 140664346199488 tpu_estimator.py:499] TPU job name worker
I0814 22:05:24.452622 140664346199488 monitored_session.py:240] Graph was finalized.
W0814 22:05:24.453350 140664346199488 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:05:24.653315 140664346199488 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:05:27.213593 140664346199488 session_manager.py:500] Running local_init_op.
I0814 22:05:27.243998 140664346199488 session_manager.py:502] Done running local_init_op.
I0814 22:05:27.302762 140664346199488 tpu_estimator.py:557] Init TPU system
I0814 22:06:36.034756 140664346199488 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:06:36.035713 140663446296320 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:06:36.036176 140663437903616 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:06:36.128640 140664346199488 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:06:36.158096 140664346199488 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:06:36.158447 140664346199488 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:06:36.254280 140663424526080 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:06:36.532660 140663424526080 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:06:36.973165 140663437903616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:06:37.213612 140664346199488 evaluation.py:167] Evaluation [10/10]
I0814 22:06:37.214025 140664346199488 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:06:37.214097 140664346199488 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:06:37.214323 140663446296320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:06:37.214448 140663446296320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:06:37.214586 140664346199488 error_handling.py:96] infeed marked as finished
I0814 22:06:37.214703 140664346199488 tpu_estimator.py:602] Stop output thread controller
I0814 22:06:37.214751 140664346199488 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:06:37.214868 140663437903616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:06:37.214941 140663437903616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:06:37.215055 140664346199488 error_handling.py:96] outfeed marked as finished
I0814 22:06:37.215141 140664346199488 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:07:06.637320 140664346199488 evaluation.py:275] Finished evaluation at 2019-08-14-22:07:06
I0814 22:07:06.637624 140664346199488 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9809, global_step = 30, loss = 0.06747402
I0814 22:07:10.962086 140664346199488 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:07:11.888233 140664346199488 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06747402, 'global_step': 30, 'accuracy': 0.9809}

Removing gs://yangyou-mnist/log/#1565820232553409...
Removing gs://yangyou-mnist/log/checkpoint#1565820312072034...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565820246125142...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565820232.v3-8-tpu#1565820315230345...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565820251642475...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565820245229822...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565820237925739...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565820308798105...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565820309818621...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565820314247133...
Removing gs://yangyou-mnist/log/eval/#1565820428314218...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565820428.v3-8-tpu#1565820431549712...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:07:15.841672 139953022260672 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:07:15.842511 139953022260672 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:07:15.845474 139953022260672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:07:15.846395 139953022260672 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:07:15.847022 139953022260672 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:07:15.847170 139953022260672 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:07:16.277374 139953022260672 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:07:16.285497 139953022260672 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:07:16.289835 139953022260672 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:07:16.346966 139953022260672 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:07:16.347248 139953022260672 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:07:16.598597 139953022260672 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:07:16.722289 139953022260672 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:07:16.722594 139953022260672 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:07:16.928464 139953022260672 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f493456a150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4936749210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:07:16.928930 139953022260672 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:07:17.317121 139953022260672 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:07:17.320348: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:07:17.334372 139953022260672 tpu_system_metadata.py:148] Found TPU system:
I0814 22:07:17.334650 139953022260672 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:07:17.335206 139953022260672 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:07:17.335270 139953022260672 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:07:17.335328 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:07:17.335642 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:07:17.335704 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:07:17.335761 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:07:17.335832 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:07:17.335901 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:07:17.335954 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:07:17.336015 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:07:17.336071 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:07:17.336126 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:07:17.336189 139953022260672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:07:17.342879 139953022260672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:07:17.357214 139953022260672 estimator.py:1145] Calling model_fn.
W0814 22:07:17.357882 139953022260672 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:07:17.623872 139953022260672 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:07:18.055900 139953022260672 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:07:18.122468 139953022260672 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:07:18.128598 139953022260672 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:07:18.319941 139953022260672 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:07:18.334954 139953022260672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:07:18.347364 139953022260672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:07:18.348448 139953022260672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:07:18.355838 139953022260672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:07:18.361289 139953022260672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:07:18.361525 139953022260672 optimization.py:36] ++++++ warmup starts at step 0, for 11 steps ++++++
W0814 22:07:18.374623 139953022260672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:07:18.488246 139953022260672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:07:18.532037 139953022260672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:07:18.578927 139953022260672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:07:18.633645 139953022260672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:07:18.800968 139953022260672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:07:18.853238 139953022260672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:07:18.902698 139953022260672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:07:18.954217 139953022260672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:07:19.000889 139953022260672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:07:19.044127 139953022260672 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:07:19.061444 139953022260672 estimator.py:1147] Done calling model_fn.
I0814 22:07:22.603408 139953022260672 tpu_estimator.py:499] TPU job name worker
I0814 22:07:22.716448 139953022260672 monitored_session.py:240] Graph was finalized.
I0814 22:07:23.407130 139953022260672 session_manager.py:500] Running local_init_op.
I0814 22:07:23.455940 139953022260672 session_manager.py:502] Done running local_init_op.
I0814 22:07:26.332158 139953022260672 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:07:38.824682 139953022260672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:07:38.991075 139953022260672 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:07:38.991511 139953022260672 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:07:38.991899: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:07:38.997539 139953022260672 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:07:38.999629 139953022260672 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:07:39.003952 139953022260672 tpu_estimator.py:557] Init TPU system
I0814 22:08:20.094377 139953022260672 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 22:08:20.095380 139952327489280 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:08:20.096363 139951844882176 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:08:20.162420 139953022260672 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:08:20.163733 139953022260672 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 22:08:20.173985 139951836489472 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:08:20.474041 139951836489472 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:08:25.031742 139951844882176 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:08:29.726557 139953022260672 basic_session_run_hooks.py:262] loss = 0.08238197, step = 30
I0814 22:08:29.729336 139953022260672 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:08:43.063990 139953022260672 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:08:43.064327 139953022260672 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:08:43.064589 139952327489280 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:08:43.064702 139952327489280 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:08:43.064862 139953022260672 error_handling.py:96] infeed marked as finished
I0814 22:08:43.064970 139953022260672 tpu_estimator.py:602] Stop output thread controller
I0814 22:08:43.065022 139953022260672 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:08:43.065141 139951844882176 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:08:43.065215 139951844882176 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:08:43.065334 139953022260672 error_handling.py:96] outfeed marked as finished
I0814 22:08:43.065424 139953022260672 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:08:50.590029 139953022260672 estimator.py:368] Loss for final step: 0.08238197.
I0814 22:08:50.590867 139953022260672 error_handling.py:96] training_loop marked as finished
I0814 22:08:51.293513 139953022260672 estimator.py:1145] Calling model_fn.
E0814 22:08:51.987763 139953022260672 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:08:52.207659 139953022260672 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:08:52.229342 139953022260672 estimator.py:1147] Done calling model_fn.
I0814 22:08:52.245043 139953022260672 evaluation.py:255] Starting evaluation at 2019-08-14T22:08:52Z
I0814 22:08:52.245290 139953022260672 tpu_estimator.py:499] TPU job name worker
I0814 22:08:52.323049 139953022260672 monitored_session.py:240] Graph was finalized.
W0814 22:08:52.323844 139953022260672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:08:52.522219 139953022260672 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:08:55.312447 139953022260672 session_manager.py:500] Running local_init_op.
I0814 22:08:55.343183 139953022260672 session_manager.py:502] Done running local_init_op.
I0814 22:08:55.397167 139953022260672 tpu_estimator.py:557] Init TPU system
I0814 22:10:04.091918 139953022260672 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:10:04.092824 139951844882176 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:10:04.093339 139951836489472 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:10:04.162416 139953022260672 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:10:04.186876 139953022260672 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:10:04.187228 139953022260672 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:10:04.284282 139951828096768 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:10:04.615170 139951828096768 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:10:04.969384 139951836489472 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:10:05.302273 139953022260672 evaluation.py:167] Evaluation [10/10]
I0814 22:10:05.303064 139953022260672 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:10:05.303183 139953022260672 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:10:05.303366 139951844882176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:10:05.303457 139951844882176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:10:05.303590 139953022260672 error_handling.py:96] infeed marked as finished
I0814 22:10:05.303683 139953022260672 tpu_estimator.py:602] Stop output thread controller
I0814 22:10:05.303733 139953022260672 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:10:05.303837 139951836489472 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:10:05.303904 139951836489472 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:10:05.304013 139953022260672 error_handling.py:96] outfeed marked as finished
I0814 22:10:05.304101 139953022260672 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:10:34.691214 139953022260672 evaluation.py:275] Finished evaluation at 2019-08-14-22:10:34
I0814 22:10:34.691611 139953022260672 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9793, global_step = 30, loss = 0.061838407
I0814 22:10:38.933844 139953022260672 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:10:39.855320 139953022260672 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.061838407, 'global_step': 30, 'accuracy': 0.9793}

Removing gs://yangyou-mnist/log/#1565820440595741...
Removing gs://yangyou-mnist/log/checkpoint#1565820519528428...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565820440.v3-8-tpu#1565820522744859...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565820445723574...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565820453754146...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565820452903223...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565820516351963...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565820517239051...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565820458291821...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565820521635386...
Removing gs://yangyou-mnist/log/eval/#1565820636356325...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565820636.v3-8-tpu#1565820639543279...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:10:43.792644 140566736700864 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:10:43.793445 140566736700864 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:10:43.796013 140566736700864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:10:43.796895 140566736700864 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:10:43.797497 140566736700864 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:10:43.797626 140566736700864 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:10:44.213465 140566736700864 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:10:44.220971 140566736700864 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:10:44.225183 140566736700864 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:10:44.268913 140566736700864 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:10:44.269193 140566736700864 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:10:44.635783 140566736700864 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:10:44.679390 140566736700864 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:10:44.679689 140566736700864 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:10:45.017407 140566736700864 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd81891d090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd81aafc210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:10:45.017837 140566736700864 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:10:45.386126 140566736700864 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:10:45.389189: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:10:45.404787 140566736700864 tpu_system_metadata.py:148] Found TPU system:
I0814 22:10:45.405034 140566736700864 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:10:45.405545 140566736700864 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:10:45.405612 140566736700864 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:10:45.405680 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:10:45.406018 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:10:45.406080 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:10:45.406137 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:10:45.406194 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:10:45.406248 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:10:45.406301 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:10:45.406362 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:10:45.406414 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:10:45.406466 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:10:45.406519 140566736700864 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:10:45.413506 140566736700864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:10:45.427592 140566736700864 estimator.py:1145] Calling model_fn.
W0814 22:10:45.428258 140566736700864 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:10:45.700864 140566736700864 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:10:46.132596 140566736700864 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:10:46.195123 140566736700864 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:10:46.201344 140566736700864 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:10:46.385946 140566736700864 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:10:46.399672 140566736700864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:10:46.411972 140566736700864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:10:46.413065 140566736700864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:10:46.419996 140566736700864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:10:46.425291 140566736700864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:10:46.425509 140566736700864 optimization.py:36] ++++++ warmup starts at step 0, for 11 steps ++++++
W0814 22:10:46.438256 140566736700864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:10:46.549707 140566736700864 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:10:46.592811 140566736700864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:10:46.638036 140566736700864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:10:46.689794 140566736700864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:10:46.851790 140566736700864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:10:46.903146 140566736700864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:10:46.952991 140566736700864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:10:47.004686 140566736700864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:10:47.051100 140566736700864 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:10:47.092796 140566736700864 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:10:47.109483 140566736700864 estimator.py:1147] Done calling model_fn.
I0814 22:10:50.702954 140566736700864 tpu_estimator.py:499] TPU job name worker
I0814 22:10:50.813834 140566736700864 monitored_session.py:240] Graph was finalized.
I0814 22:10:51.493489 140566736700864 session_manager.py:500] Running local_init_op.
I0814 22:10:51.554008 140566736700864 session_manager.py:502] Done running local_init_op.
I0814 22:10:54.330467 140566736700864 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:11:07.207479 140566736700864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:11:07.369832 140566736700864 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:11:07.370300 140566736700864 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:11:07.370755: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:11:07.375248 140566736700864 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:11:07.377651 140566736700864 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:11:07.381604 140566736700864 tpu_estimator.py:557] Init TPU system
I0814 22:11:48.129924 140566736700864 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 22:11:48.130825 140565974591232 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:11:48.131319 140565622552320 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:11:48.190934 140565614159616 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:11:48.198537 140566736700864 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:11:48.199340 140566736700864 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:11:48.538075 140565614159616 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:11:52.980839 140565622552320 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:11:57.754259 140566736700864 basic_session_run_hooks.py:262] loss = 0.088233404, step = 30
I0814 22:11:57.756650 140566736700864 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:12:11.253637 140566736700864 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:12:11.253910 140566736700864 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:12:11.254133 140565974591232 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:12:11.254247 140565974591232 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:12:11.254385 140566736700864 error_handling.py:96] infeed marked as finished
I0814 22:12:11.254482 140566736700864 tpu_estimator.py:602] Stop output thread controller
I0814 22:12:11.254533 140566736700864 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:12:11.254643 140565622552320 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:12:11.254715 140565622552320 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:12:11.254831 140566736700864 error_handling.py:96] outfeed marked as finished
I0814 22:12:11.254915 140566736700864 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:12:18.661130 140566736700864 estimator.py:368] Loss for final step: 0.088233404.
I0814 22:12:18.662012 140566736700864 error_handling.py:96] training_loop marked as finished
I0814 22:12:19.411750 140566736700864 estimator.py:1145] Calling model_fn.
E0814 22:12:20.191205 140566736700864 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:12:20.421758 140566736700864 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:12:20.443032 140566736700864 estimator.py:1147] Done calling model_fn.
I0814 22:12:20.459623 140566736700864 evaluation.py:255] Starting evaluation at 2019-08-14T22:12:20Z
I0814 22:12:20.459858 140566736700864 tpu_estimator.py:499] TPU job name worker
I0814 22:12:20.538095 140566736700864 monitored_session.py:240] Graph was finalized.
W0814 22:12:20.538830 140566736700864 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:12:20.723704 140566736700864 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:12:23.523438 140566736700864 session_manager.py:500] Running local_init_op.
I0814 22:12:23.554821 140566736700864 session_manager.py:502] Done running local_init_op.
I0814 22:12:23.611157 140566736700864 tpu_estimator.py:557] Init TPU system
I0814 22:13:32.043416 140566736700864 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:13:32.044239 140565622552320 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:13:32.044660 140565614159616 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:13:32.113452 140566736700864 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:13:32.143054 140566736700864 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:13:32.143481 140566736700864 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:13:32.168610 140565605766912 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:13:32.449265 140565605766912 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:13:32.916335 140565614159616 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:13:33.395473 140566736700864 evaluation.py:167] Evaluation [10/10]
I0814 22:13:33.395803 140566736700864 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:13:33.395879 140566736700864 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:13:33.396078 140565622552320 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:13:33.396183 140565622552320 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:13:33.396333 140566736700864 error_handling.py:96] infeed marked as finished
I0814 22:13:33.396471 140566736700864 tpu_estimator.py:602] Stop output thread controller
I0814 22:13:33.396529 140566736700864 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:13:33.396640 140565614159616 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:13:33.396714 140565614159616 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:13:33.396935 140566736700864 error_handling.py:96] outfeed marked as finished
I0814 22:13:33.397046 140566736700864 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:14:02.527498 140566736700864 evaluation.py:275] Finished evaluation at 2019-08-14-22:14:02
I0814 22:14:02.527950 140566736700864 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9801, global_step = 30, loss = 0.08017316
I0814 22:14:07.347497 140566736700864 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:14:08.209777 140566736700864 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08017316, 'global_step': 30, 'accuracy': 0.9801}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565820661983271...
Removing gs://yangyou-mnist/log/checkpoint#1565820727773708...
Removing gs://yangyou-mnist/log/#1565820648659988...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565820653736197...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565820666625168...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565820648.v3-8-tpu#1565820730967031...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565820724892738...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565820661060867...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565820725689284...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565820729973483...
Removing gs://yangyou-mnist/log/eval/#1565820844338220...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565820844.v3-8-tpu#1565820847899873...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:14:12.110754 140367524861376 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:14:12.111531 140367524861376 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:14:12.114437 140367524861376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:14:12.115242 140367524861376 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:14:12.115792 140367524861376 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:14:12.115916 140367524861376 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:14:12.529787 140367524861376 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:14:12.537405 140367524861376 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:14:12.541359 140367524861376 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:14:12.586272 140367524861376 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:14:12.586554 140367524861376 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:14:12.861512 140367524861376 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:14:12.967130 140367524861376 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:14:12.967406 140367524861376 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:14:13.113332 140367524861376 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa9b69cf290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa9b8bc5210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:14:13.113728 140367524861376 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:14:13.433955 140367524861376 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:14:13.436759: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:14:13.450150 140367524861376 tpu_system_metadata.py:148] Found TPU system:
I0814 22:14:13.450429 140367524861376 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:14:13.451056 140367524861376 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:14:13.451119 140367524861376 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:14:13.451174 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:14:13.451502 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:14:13.451560 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:14:13.451611 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:14:13.451666 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:14:13.451714 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:14:13.451771 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:14:13.451817 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:14:13.451864 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:14:13.451910 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:14:13.451958 140367524861376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:14:13.458149 140367524861376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:14:13.470717 140367524861376 estimator.py:1145] Calling model_fn.
W0814 22:14:13.471327 140367524861376 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:14:13.740752 140367524861376 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:14:14.153898 140367524861376 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:14:14.216758 140367524861376 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:14:14.222961 140367524861376 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:14:14.412957 140367524861376 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:14:14.426775 140367524861376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:14:14.439042 140367524861376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:14:14.440092 140367524861376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:14:14.447181 140367524861376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:14:14.452474 140367524861376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:14:14.452704 140367524861376 optimization.py:36] ++++++ warmup starts at step 0, for 11 steps ++++++
W0814 22:14:14.465219 140367524861376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:14:14.577089 140367524861376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:14:14.619174 140367524861376 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:14:14.664091 140367524861376 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:14:14.716392 140367524861376 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:14:14.877229 140367524861376 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:14:14.928332 140367524861376 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:14:14.977679 140367524861376 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:14:15.029004 140367524861376 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:14:15.076941 140367524861376 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:14:15.136674 140367524861376 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:14:15.153573 140367524861376 estimator.py:1147] Done calling model_fn.
I0814 22:14:18.807141 140367524861376 tpu_estimator.py:499] TPU job name worker
I0814 22:14:18.921482 140367524861376 monitored_session.py:240] Graph was finalized.
I0814 22:14:19.596470 140367524861376 session_manager.py:500] Running local_init_op.
I0814 22:14:19.647408 140367524861376 session_manager.py:502] Done running local_init_op.
I0814 22:14:22.412307 140367524861376 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:14:34.772581 140367524861376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:14:34.924873 140367524861376 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:14:34.925335 140367524861376 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:14:34.925803: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:14:34.931050 140367524861376 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:14:34.933319 140367524861376 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:14:34.938116 140367524861376 tpu_estimator.py:557] Init TPU system
I0814 22:15:16.071351 140367524861376 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 22:15:16.072495 140366627985152 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:15:16.073367 140366619592448 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:15:16.126094 140366611199744 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:15:16.143426 140367524861376 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:15:16.144288 140367524861376 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:15:16.397644 140366611199744 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:15:21.044466 140366619592448 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:15:25.522397 140367524861376 basic_session_run_hooks.py:262] loss = 0.084320955, step = 30
I0814 22:15:25.525355 140367524861376 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:15:39.991058 140367524861376 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:15:39.991359 140367524861376 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:15:39.991753 140366627985152 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:15:39.992043 140366627985152 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:15:39.992295 140367524861376 error_handling.py:96] infeed marked as finished
I0814 22:15:39.992577 140367524861376 tpu_estimator.py:602] Stop output thread controller
I0814 22:15:39.992635 140367524861376 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:15:39.992810 140366619592448 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:15:39.993010 140366619592448 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:15:39.993206 140367524861376 error_handling.py:96] outfeed marked as finished
I0814 22:15:39.993415 140367524861376 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:15:46.537019 140367524861376 estimator.py:368] Loss for final step: 0.084320955.
I0814 22:15:46.537961 140367524861376 error_handling.py:96] training_loop marked as finished
I0814 22:15:47.391249 140367524861376 estimator.py:1145] Calling model_fn.
E0814 22:15:48.102646 140367524861376 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:15:48.324876 140367524861376 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:15:48.346992 140367524861376 estimator.py:1147] Done calling model_fn.
I0814 22:15:48.363765 140367524861376 evaluation.py:255] Starting evaluation at 2019-08-14T22:15:48Z
I0814 22:15:48.364010 140367524861376 tpu_estimator.py:499] TPU job name worker
I0814 22:15:48.444298 140367524861376 monitored_session.py:240] Graph was finalized.
W0814 22:15:48.445156 140367524861376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:15:48.649996 140367524861376 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:15:51.310847 140367524861376 session_manager.py:500] Running local_init_op.
I0814 22:15:51.336786 140367524861376 session_manager.py:502] Done running local_init_op.
I0814 22:15:51.397284 140367524861376 tpu_estimator.py:557] Init TPU system
I0814 22:17:00.074318 140367524861376 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:17:00.075350 140366624577280 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:17:00.075886 140366616184576 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:17:00.148705 140367524861376 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:17:00.174357 140367524861376 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:17:00.174700 140367524861376 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:17:00.211338 140366607791872 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:17:00.526005 140366607791872 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 22:17:00.918740 140366616184576 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:17:01.387659 140367524861376 evaluation.py:167] Evaluation [10/10]
I0814 22:17:01.388092 140367524861376 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:17:01.388166 140367524861376 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:17:01.388370 140366624577280 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:17:01.388498 140366624577280 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:17:01.388644 140367524861376 error_handling.py:96] infeed marked as finished
I0814 22:17:01.388734 140367524861376 tpu_estimator.py:602] Stop output thread controller
I0814 22:17:01.388792 140367524861376 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:17:01.388904 140366616184576 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:17:01.388998 140366616184576 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:17:01.389113 140367524861376 error_handling.py:96] outfeed marked as finished
I0814 22:17:01.389193 140367524861376 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:17:30.613951 140367524861376 evaluation.py:275] Finished evaluation at 2019-08-14-22:17:30
I0814 22:17:30.614263 140367524861376 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9786, global_step = 30, loss = 0.07485737
I0814 22:17:35.203989 140367524861376 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:17:36.125957 140367524861376 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07485737, 'global_step': 30, 'accuracy': 0.9786}

Removing gs://yangyou-mnist/log/#1565820856758704...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565820869697282...
Removing gs://yangyou-mnist/log/checkpoint#1565820936507665...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565820856.v3-8-tpu#1565820939683567...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565820874252006...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565820861834229...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565820933376501...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565820868830045...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565820934319527...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565820938747454...
Removing gs://yangyou-mnist/log/eval/#1565821052294048...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565821052.v3-8-tpu#1565821055812295...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:17:40.157079 140242566047168 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:17:40.158034 140242566047168 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:17:40.160793 140242566047168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:17:40.161614 140242566047168 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:17:40.162199 140242566047168 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:17:40.162326 140242566047168 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:17:40.582170 140242566047168 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:17:40.597264 140242566047168 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:17:40.602375 140242566047168 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:17:40.651729 140242566047168 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:17:40.652002 140242566047168 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:17:41.036206 140242566047168 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:17:41.081353 140242566047168 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:17:41.081653 140242566047168 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:17:41.346693 140242566047168 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8c9e7e3150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8ca09c2210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:17:41.347126 140242566047168 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:17:41.674410 140242566047168 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:17:41.677725: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:17:41.692707 140242566047168 tpu_system_metadata.py:148] Found TPU system:
I0814 22:17:41.692969 140242566047168 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:17:41.693489 140242566047168 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:17:41.693553 140242566047168 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:17:41.693614 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:17:41.693928 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:17:41.693990 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:17:41.694063 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:17:41.694122 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:17:41.694175 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:17:41.694242 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:17:41.694294 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:17:41.694346 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:17:41.694399 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:17:41.694456 140242566047168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:17:41.701174 140242566047168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:17:41.715667 140242566047168 estimator.py:1145] Calling model_fn.
W0814 22:17:41.716331 140242566047168 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:17:41.980659 140242566047168 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:17:42.499460 140242566047168 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:17:42.564539 140242566047168 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:17:42.570880 140242566047168 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:17:42.761151 140242566047168 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:17:42.777167 140242566047168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:17:42.791330 140242566047168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:17:42.792620 140242566047168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:17:42.801212 140242566047168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:17:42.807363 140242566047168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:17:42.807604 140242566047168 optimization.py:36] ++++++ warmup starts at step 0, for 11 steps ++++++
W0814 22:17:42.822117 140242566047168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:17:42.937562 140242566047168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:17:42.981151 140242566047168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:17:43.027832 140242566047168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:17:43.083838 140242566047168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:17:43.252543 140242566047168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:17:43.305814 140242566047168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:17:43.358293 140242566047168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:17:43.411797 140242566047168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:17:43.460601 140242566047168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:17:43.504482 140242566047168 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:17:43.521873 140242566047168 estimator.py:1147] Done calling model_fn.
I0814 22:17:47.083653 140242566047168 tpu_estimator.py:499] TPU job name worker
I0814 22:17:47.196000 140242566047168 monitored_session.py:240] Graph was finalized.
I0814 22:17:47.882426 140242566047168 session_manager.py:500] Running local_init_op.
I0814 22:17:47.934891 140242566047168 session_manager.py:502] Done running local_init_op.
I0814 22:17:50.620807 140242566047168 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:18:03.139424 140242566047168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:18:03.288116 140242566047168 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:18:03.288610 140242566047168 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:18:03.289164: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:18:03.295193 140242566047168 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:18:03.297439 140242566047168 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:18:03.301604 140242566047168 tpu_estimator.py:557] Init TPU system
I0814 22:18:44.130527 140242566047168 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 22:18:44.132430 140241669707520 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:18:44.133040 140241661314816 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:18:44.190665 140241652922112 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:18:44.201195 140242566047168 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:18:44.202517 140242566047168 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:18:44.637727 140241652922112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:18:48.913779 140241661314816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:18:53.579374 140242566047168 basic_session_run_hooks.py:262] loss = 0.083833925, step = 30
I0814 22:18:53.582936 140242566047168 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:19:07.924861 140242566047168 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:19:07.925142 140242566047168 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:19:07.925365 140241669707520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:19:07.925482 140241669707520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:19:07.925631 140242566047168 error_handling.py:96] infeed marked as finished
I0814 22:19:07.925746 140242566047168 tpu_estimator.py:602] Stop output thread controller
I0814 22:19:07.925810 140242566047168 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:19:07.925935 140241661314816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:19:07.926017 140241661314816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:19:07.926342 140242566047168 error_handling.py:96] outfeed marked as finished
I0814 22:19:07.926511 140242566047168 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:19:14.773753 140242566047168 estimator.py:368] Loss for final step: 0.083833925.
I0814 22:19:14.774579 140242566047168 error_handling.py:96] training_loop marked as finished
I0814 22:19:15.563718 140242566047168 estimator.py:1145] Calling model_fn.
E0814 22:19:16.295319 140242566047168 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:19:16.527918 140242566047168 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:19:16.551373 140242566047168 estimator.py:1147] Done calling model_fn.
I0814 22:19:16.569961 140242566047168 evaluation.py:255] Starting evaluation at 2019-08-14T22:19:16Z
I0814 22:19:16.570202 140242566047168 tpu_estimator.py:499] TPU job name worker
I0814 22:19:16.654763 140242566047168 monitored_session.py:240] Graph was finalized.
W0814 22:19:16.655528 140242566047168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:19:16.858782 140242566047168 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:19:19.569879 140242566047168 session_manager.py:500] Running local_init_op.
I0814 22:19:19.594482 140242566047168 session_manager.py:502] Done running local_init_op.
I0814 22:19:19.653930 140242566047168 tpu_estimator.py:557] Init TPU system
I0814 22:20:28.048104 140242566047168 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:20:28.049315 140241666037504 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:20:28.050151 140241657644800 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:20:28.121064 140242566047168 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:20:28.153151 140242566047168 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:20:28.153614 140242566047168 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:20:28.236829 140241644267264 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:20:28.520879 140241644267264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:20:28.934871 140241657644800 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:20:29.441507 140242566047168 evaluation.py:167] Evaluation [10/10]
I0814 22:20:29.441870 140242566047168 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:20:29.441975 140242566047168 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:20:29.442235 140241666037504 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:20:29.442557 140241666037504 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:20:29.442792 140242566047168 error_handling.py:96] infeed marked as finished
I0814 22:20:29.443022 140242566047168 tpu_estimator.py:602] Stop output thread controller
I0814 22:20:29.443085 140242566047168 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:20:29.443257 140241657644800 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:20:29.443460 140241657644800 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:20:29.443672 140242566047168 error_handling.py:96] outfeed marked as finished
I0814 22:20:29.443846 140242566047168 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:20:58.588253 140242566047168 evaluation.py:275] Finished evaluation at 2019-08-14-22:20:58
I0814 22:20:58.588645 140242566047168 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9815, global_step = 30, loss = 0.070288405
I0814 22:21:03.094880 140242566047168 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:21:03.965780 140242566047168 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.070288405, 'global_step': 30, 'accuracy': 0.9815}

Removing gs://yangyou-mnist/log/#1565821065129601...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565821065.v3-8-tpu#1565821147615009...
Removing gs://yangyou-mnist/log/checkpoint#1565821144435977...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565821070036906...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565821078064682...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565821077117895...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565821082616427...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565821141176046...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565821142087067...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565821146604685...
Removing gs://yangyou-mnist/log/eval/#1565821260401865...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565821260.v3-8-tpu#1565821263640541...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:21:08.238152 140642764494272 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:21:08.238960 140642764494272 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:21:08.241750 140642764494272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:21:08.242621 140642764494272 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:21:08.243216 140642764494272 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:21:08.243367 140642764494272 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:21:08.655421 140642764494272 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:21:08.664287 140642764494272 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:21:08.668699 140642764494272 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:21:08.715404 140642764494272 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:21:08.715684 140642764494272 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:21:09.017168 140642764494272 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:21:09.159960 140642764494272 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:21:09.160267 140642764494272 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:21:09.529051 140642764494272 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe9cc2de250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe9ce4bd210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:21:09.529436 140642764494272 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:21:09.858694 140642764494272 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:21:09.861708: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:21:09.876719 140642764494272 tpu_system_metadata.py:148] Found TPU system:
I0814 22:21:09.876961 140642764494272 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:21:09.877448 140642764494272 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:21:09.877506 140642764494272 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:21:09.877561 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:21:09.877856 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:21:09.877912 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:21:09.877969 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:21:09.878019 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:21:09.878065 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:21:09.878110 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:21:09.878159 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:21:09.878206 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:21:09.878252 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:21:09.878300 140642764494272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:21:09.884361 140642764494272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:21:09.897030 140642764494272 estimator.py:1145] Calling model_fn.
W0814 22:21:09.897686 140642764494272 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:21:10.164210 140642764494272 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:21:10.688271 140642764494272 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:21:10.751308 140642764494272 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:21:10.757339 140642764494272 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:21:10.947228 140642764494272 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:21:10.961440 140642764494272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:21:10.973884 140642764494272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:21:10.974965 140642764494272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:21:10.982374 140642764494272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:21:10.987849 140642764494272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:21:10.988070 140642764494272 optimization.py:36] ++++++ warmup starts at step 0, for 11 steps ++++++
W0814 22:21:11.000843 140642764494272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:21:11.114525 140642764494272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:21:11.156984 140642764494272 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:21:11.204231 140642764494272 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:21:11.257266 140642764494272 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:21:11.421188 140642764494272 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:21:11.473285 140642764494272 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:21:11.526563 140642764494272 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:21:11.578274 140642764494272 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:21:11.625514 140642764494272 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:21:11.668757 140642764494272 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:21:11.685902 140642764494272 estimator.py:1147] Done calling model_fn.
I0814 22:21:15.102559 140642764494272 tpu_estimator.py:499] TPU job name worker
I0814 22:21:15.218297 140642764494272 monitored_session.py:240] Graph was finalized.
I0814 22:21:15.884217 140642764494272 session_manager.py:500] Running local_init_op.
I0814 22:21:15.935729 140642764494272 session_manager.py:502] Done running local_init_op.
I0814 22:21:18.781115 140642764494272 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:21:31.219625 140642764494272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:21:31.382951 140642764494272 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:21:31.383431 140642764494272 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:21:31.383850: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:21:31.388711 140642764494272 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:21:31.390901 140642764494272 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:21:31.395101 140642764494272 tpu_estimator.py:557] Init TPU system
I0814 22:22:12.115780 140642764494272 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 22:22:12.116709 140642069722880 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:22:12.117733 140641589786368 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:22:12.184159 140642764494272 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:22:12.185012 140642764494272 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 22:22:12.246984 140641581393664 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:22:12.497312 140641581393664 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:22:16.931210 140641589786368 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:22:21.956630 140642764494272 basic_session_run_hooks.py:262] loss = 0.14050661, step = 30
I0814 22:22:21.959059 140642764494272 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:22:37.006076 140642764494272 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:22:37.006606 140642764494272 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:22:37.006989 140642069722880 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:22:37.007133 140642069722880 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:22:37.007361 140642764494272 error_handling.py:96] infeed marked as finished
I0814 22:22:37.007477 140642764494272 tpu_estimator.py:602] Stop output thread controller
I0814 22:22:37.007535 140642764494272 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:22:37.007656 140641589786368 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:22:37.007733 140641589786368 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:22:37.007865 140642764494272 error_handling.py:96] outfeed marked as finished
I0814 22:22:37.007960 140642764494272 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:22:42.629667 140642764494272 estimator.py:368] Loss for final step: 0.14050661.
I0814 22:22:42.630548 140642764494272 error_handling.py:96] training_loop marked as finished
I0814 22:22:43.428771 140642764494272 estimator.py:1145] Calling model_fn.
E0814 22:22:44.154150 140642764494272 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:22:44.389334 140642764494272 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:22:44.411535 140642764494272 estimator.py:1147] Done calling model_fn.
I0814 22:22:44.431190 140642764494272 evaluation.py:255] Starting evaluation at 2019-08-14T22:22:44Z
I0814 22:22:44.431427 140642764494272 tpu_estimator.py:499] TPU job name worker
I0814 22:22:44.509804 140642764494272 monitored_session.py:240] Graph was finalized.
W0814 22:22:44.510565 140642764494272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:22:44.720603 140642764494272 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:22:47.372667 140642764494272 session_manager.py:500] Running local_init_op.
I0814 22:22:47.397674 140642764494272 session_manager.py:502] Done running local_init_op.
I0814 22:22:47.457871 140642764494272 tpu_estimator.py:557] Init TPU system
I0814 22:23:56.067008 140642764494272 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:23:56.067886 140641589786368 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:23:56.068692 140641581393664 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:23:56.139025 140642764494272 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:23:56.164053 140642764494272 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:23:56.164880 140642764494272 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:23:56.204354 140641573000960 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:23:56.658200 140641573000960 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:23:56.985155 140641581393664 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:23:57.275883 140642764494272 evaluation.py:167] Evaluation [10/10]
I0814 22:23:57.276222 140642764494272 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:23:57.276304 140642764494272 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:23:57.276576 140641589786368 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:23:57.276691 140641589786368 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:23:57.276947 140642764494272 error_handling.py:96] infeed marked as finished
I0814 22:23:57.277060 140642764494272 tpu_estimator.py:602] Stop output thread controller
I0814 22:23:57.277107 140642764494272 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:23:57.277228 140641581393664 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:23:57.277307 140641581393664 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:23:57.277427 140642764494272 error_handling.py:96] outfeed marked as finished
I0814 22:23:57.277503 140642764494272 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:24:26.764194 140642764494272 evaluation.py:275] Finished evaluation at 2019-08-14-22:24:26
I0814 22:24:26.764595 140642764494272 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9749, global_step = 30, loss = 0.09240447
I0814 22:24:31.286572 140642764494272 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:24:32.199740 140642764494272 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09240447, 'global_step': 30, 'accuracy': 0.9749}

Removing gs://yangyou-mnist/log/#1565821273248741...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565821273.v3-8-tpu#1565821356693135...
Removing gs://yangyou-mnist/log/checkpoint#1565821352669565...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565821286284718...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565821278195974...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565821290694174...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565821349498469...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565821350346657...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565821285389806...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565821354906010...
Removing gs://yangyou-mnist/log/eval/#1565821468494819...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565821468.v3-8-tpu#1565821471894296...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:24:36.064127 139874020394432 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:24:36.065068 139874020394432 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:24:36.067614 139874020394432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:24:36.068449 139874020394432 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:24:36.069042 139874020394432 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:24:36.069170 139874020394432 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:24:36.481197 139874020394432 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:24:36.488874 139874020394432 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:24:36.492847 139874020394432 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:24:36.550507 139874020394432 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:24:36.550789 139874020394432 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:24:36.877206 139874020394432 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:24:36.933900 139874020394432 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:24:36.934186 139874020394432 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:24:37.293150 139874020394432 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f36cf7463d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f36d193c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:24:37.293560 139874020394432 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:24:38.513035 139874020394432 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:24:38.516587: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:24:38.529939 139874020394432 tpu_system_metadata.py:148] Found TPU system:
I0814 22:24:38.530181 139874020394432 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:24:38.530826 139874020394432 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:24:38.530894 139874020394432 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:24:38.530951 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:24:38.531270 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:24:38.531328 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:24:38.531382 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:24:38.531435 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:24:38.531482 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:24:38.531529 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:24:38.531577 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:24:38.531621 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:24:38.531687 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:24:38.531739 139874020394432 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:24:38.538211 139874020394432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:24:38.551490 139874020394432 estimator.py:1145] Calling model_fn.
W0814 22:24:38.552129 139874020394432 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:24:38.835577 139874020394432 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:24:39.450731 139874020394432 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:24:39.512960 139874020394432 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:24:39.519112 139874020394432 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:24:39.704761 139874020394432 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:24:39.718858 139874020394432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:24:39.731692 139874020394432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:24:39.732815 139874020394432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:24:39.740045 139874020394432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:24:39.745369 139874020394432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:24:39.745587 139874020394432 optimization.py:36] ++++++ warmup starts at step 0, for 12 steps ++++++
W0814 22:24:39.758312 139874020394432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:24:39.872441 139874020394432 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:24:39.916388 139874020394432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:24:39.962621 139874020394432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:24:40.016931 139874020394432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:24:40.205271 139874020394432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:24:40.263273 139874020394432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:24:40.314666 139874020394432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:24:40.367904 139874020394432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:24:40.415833 139874020394432 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:24:40.458405 139874020394432 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:24:40.475020 139874020394432 estimator.py:1147] Done calling model_fn.
I0814 22:24:44.026530 139874020394432 tpu_estimator.py:499] TPU job name worker
I0814 22:24:44.137744 139874020394432 monitored_session.py:240] Graph was finalized.
I0814 22:24:44.800122 139874020394432 session_manager.py:500] Running local_init_op.
I0814 22:24:44.864695 139874020394432 session_manager.py:502] Done running local_init_op.
I0814 22:24:47.588665 139874020394432 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:24:59.937661 139874020394432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:25:00.081226 139874020394432 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:25:00.081669 139874020394432 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:25:00.082091: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:25:00.086909 139874020394432 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:25:00.089070 139874020394432 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:25:00.093882 139874020394432 tpu_estimator.py:557] Init TPU system
I0814 22:25:40.133232 139874020394432 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 22:25:40.134099 139873252009728 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:25:40.134582 139873243617024 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:25:40.201955 139873235224320 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:25:40.202578 139874020394432 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:25:40.203727 139874020394432 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:25:40.441696 139873235224320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:25:44.856724 139873243617024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:25:49.808075 139874020394432 basic_session_run_hooks.py:262] loss = 0.10072169, step = 30
I0814 22:25:49.810736 139874020394432 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:26:03.724637 139874020394432 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:26:03.724924 139874020394432 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:26:03.725131 139873252009728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:26:03.725240 139873252009728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:26:03.725378 139874020394432 error_handling.py:96] infeed marked as finished
I0814 22:26:03.725475 139874020394432 tpu_estimator.py:602] Stop output thread controller
I0814 22:26:03.725522 139874020394432 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:26:03.725637 139873243617024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:26:03.725719 139873243617024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:26:03.725842 139874020394432 error_handling.py:96] outfeed marked as finished
I0814 22:26:03.725922 139874020394432 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:26:10.583161 139874020394432 estimator.py:368] Loss for final step: 0.10072169.
I0814 22:26:10.583950 139874020394432 error_handling.py:96] training_loop marked as finished
I0814 22:26:11.285677 139874020394432 estimator.py:1145] Calling model_fn.
E0814 22:26:11.983374 139874020394432 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:26:12.216748 139874020394432 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:26:12.247307 139874020394432 estimator.py:1147] Done calling model_fn.
I0814 22:26:12.265114 139874020394432 evaluation.py:255] Starting evaluation at 2019-08-14T22:26:12Z
I0814 22:26:12.265341 139874020394432 tpu_estimator.py:499] TPU job name worker
I0814 22:26:12.345567 139874020394432 monitored_session.py:240] Graph was finalized.
W0814 22:26:12.346309 139874020394432 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:26:12.539319 139874020394432 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:26:15.540841 139874020394432 session_manager.py:500] Running local_init_op.
I0814 22:26:15.566407 139874020394432 session_manager.py:502] Done running local_init_op.
I0814 22:26:15.620812 139874020394432 tpu_estimator.py:557] Init TPU system
I0814 22:27:24.130398 139874020394432 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:27:24.131165 139873252009728 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:27:24.131669 139873243617024 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:27:24.202095 139874020394432 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:27:24.233374 139874020394432 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:27:24.233815 139874020394432 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:27:24.265376 139873235224320 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:27:24.657985 139873235224320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:27:25.082588 139873243617024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:27:25.518862 139874020394432 evaluation.py:167] Evaluation [10/10]
I0814 22:27:25.519206 139874020394432 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:27:25.519284 139874020394432 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:27:25.519495 139873252009728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:27:25.519604 139873252009728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:27:25.519759 139874020394432 error_handling.py:96] infeed marked as finished
I0814 22:27:25.519877 139874020394432 tpu_estimator.py:602] Stop output thread controller
I0814 22:27:25.519952 139874020394432 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:27:25.520081 139873243617024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:27:25.520258 139873243617024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:27:25.520441 139874020394432 error_handling.py:96] outfeed marked as finished
I0814 22:27:25.520544 139874020394432 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:27:54.757272 139874020394432 evaluation.py:275] Finished evaluation at 2019-08-14-22:27:54
I0814 22:27:54.757613 139874020394432 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9737, global_step = 30, loss = 0.09052138
I0814 22:27:59.588167 139874020394432 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:28:00.477579 139874020394432 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09052138, 'global_step': 30, 'accuracy': 0.9737}

Removing gs://yangyou-mnist/log/checkpoint#1565821560091943...
Removing gs://yangyou-mnist/log/#1565821482101833...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565821482.v3-8-tpu#1565821563413496...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565821495114317...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565821487023743...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565821494245180...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565821499411467...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565821556961618...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565821557908573...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565821562365644...
Removing gs://yangyou-mnist/log/eval/#1565821676543751...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565821676.v3-8-tpu#1565821680165449...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:28:04.490051 139643607389632 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:28:04.491012 139643607389632 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:28:04.493810 139643607389632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:28:04.494669 139643607389632 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:28:04.495270 139643607389632 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:28:04.495434 139643607389632 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:28:04.934663 139643607389632 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:28:04.943758 139643607389632 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:28:04.948544 139643607389632 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:28:05.007905 139643607389632 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:28:05.008232 139643607389632 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:28:05.382647 139643607389632 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:28:05.504339 139643607389632 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:28:05.504781 139643607389632 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:28:05.718379 139643607389632 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0129c662d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f012be45210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:28:05.718739 139643607389632 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:28:06.045500 139643607389632 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:28:06.048365: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:28:06.061460 139643607389632 tpu_system_metadata.py:148] Found TPU system:
I0814 22:28:06.061696 139643607389632 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:28:06.062185 139643607389632 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:28:06.062242 139643607389632 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:28:06.062295 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:28:06.062582 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:28:06.062663 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:28:06.062716 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:28:06.062763 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:28:06.062812 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:28:06.062859 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:28:06.062905 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:28:06.062951 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:28:06.063007 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:28:06.063055 139643607389632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:28:06.069444 139643607389632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:28:06.082922 139643607389632 estimator.py:1145] Calling model_fn.
W0814 22:28:06.083556 139643607389632 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:28:06.363791 139643607389632 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:28:06.878307 139643607389632 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:28:06.943129 139643607389632 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:28:06.949485 139643607389632 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:28:07.138062 139643607389632 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:28:07.152374 139643607389632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:28:07.164766 139643607389632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:28:07.165867 139643607389632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:28:07.173413 139643607389632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:28:07.178745 139643607389632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:28:07.178961 139643607389632 optimization.py:36] ++++++ warmup starts at step 0, for 12 steps ++++++
W0814 22:28:07.192243 139643607389632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:28:07.315244 139643607389632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:28:07.359235 139643607389632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:28:07.405905 139643607389632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:28:07.459140 139643607389632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:28:07.633584 139643607389632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:28:07.687140 139643607389632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:28:07.738039 139643607389632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:28:07.790879 139643607389632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:28:07.838260 139643607389632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:28:07.882592 139643607389632 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:28:07.899544 139643607389632 estimator.py:1147] Done calling model_fn.
I0814 22:28:11.586366 139643607389632 tpu_estimator.py:499] TPU job name worker
I0814 22:28:11.699172 139643607389632 monitored_session.py:240] Graph was finalized.
I0814 22:28:12.413012 139643607389632 session_manager.py:500] Running local_init_op.
I0814 22:28:12.465363 139643607389632 session_manager.py:502] Done running local_init_op.
I0814 22:28:15.086030 139643607389632 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:28:27.810296 139643607389632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:28:27.974324 139643607389632 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:28:27.974740 139643607389632 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:28:27.975118: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:28:27.981509 139643607389632 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:28:27.983803 139643607389632 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:28:27.988568 139643607389632 tpu_estimator.py:557] Init TPU system
I0814 22:29:08.141119 139643607389632 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 22:29:08.141995 139642836858624 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:29:08.142548 139642828465920 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:29:08.211924 139643607389632 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:29:08.212826 139643607389632 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 22:29:08.271641 139642820073216 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:29:08.628926 139642820073216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:29:13.137068 139642828465920 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:29:18.042547 139643607389632 basic_session_run_hooks.py:262] loss = 0.093038276, step = 30
I0814 22:29:18.045650 139643607389632 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:29:32.285260 139643607389632 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:29:32.285587 139643607389632 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:29:32.285849 139642836858624 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:29:32.285965 139642836858624 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:29:32.286108 139643607389632 error_handling.py:96] infeed marked as finished
I0814 22:29:32.286207 139643607389632 tpu_estimator.py:602] Stop output thread controller
I0814 22:29:32.286257 139643607389632 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:29:32.286386 139642828465920 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:29:32.286479 139642828465920 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:29:32.286597 139643607389632 error_handling.py:96] outfeed marked as finished
I0814 22:29:32.286678 139643607389632 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:29:38.780559 139643607389632 estimator.py:368] Loss for final step: 0.093038276.
I0814 22:29:38.781372 139643607389632 error_handling.py:96] training_loop marked as finished
I0814 22:29:39.574193 139643607389632 estimator.py:1145] Calling model_fn.
E0814 22:29:40.910233 139643607389632 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:29:41.140445 139643607389632 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:29:41.162609 139643607389632 estimator.py:1147] Done calling model_fn.
I0814 22:29:41.182744 139643607389632 evaluation.py:255] Starting evaluation at 2019-08-14T22:29:41Z
I0814 22:29:41.182986 139643607389632 tpu_estimator.py:499] TPU job name worker
I0814 22:29:41.269470 139643607389632 monitored_session.py:240] Graph was finalized.
W0814 22:29:41.270378 139643607389632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:29:41.471133 139643607389632 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:29:44.110512 139643607389632 session_manager.py:500] Running local_init_op.
I0814 22:29:44.141590 139643607389632 session_manager.py:502] Done running local_init_op.
I0814 22:29:44.196831 139643607389632 tpu_estimator.py:557] Init TPU system
I0814 22:30:52.040074 139643607389632 tpu_estimator.py:566] Initialized TPU in 67 seconds
I0814 22:30:52.041050 139642836858624 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:30:52.041507 139642828465920 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:30:52.110786 139643607389632 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:30:52.135025 139643607389632 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:30:52.135427 139643607389632 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:30:52.173100 139642820073216 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:30:52.339355 139642820073216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:30:52.962207 139642828465920 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:30:53.279896 139643607389632 evaluation.py:167] Evaluation [10/10]
I0814 22:30:53.280227 139643607389632 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:30:53.280322 139643607389632 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:30:53.280534 139642836858624 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:30:53.280633 139642836858624 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:30:53.280771 139643607389632 error_handling.py:96] infeed marked as finished
I0814 22:30:53.280867 139643607389632 tpu_estimator.py:602] Stop output thread controller
I0814 22:30:53.280915 139643607389632 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:30:53.281023 139642828465920 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:30:53.281092 139642828465920 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:30:53.281203 139643607389632 error_handling.py:96] outfeed marked as finished
I0814 22:30:53.281286 139643607389632 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:31:22.438508 139643607389632 evaluation.py:275] Finished evaluation at 2019-08-14-22:31:22
I0814 22:31:22.438848 139643607389632 estimator.py:2039] Saving dict for global step 30: accuracy = 0.977, global_step = 30, loss = 0.07025856
I0814 22:31:26.966058 139643607389632 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:31:27.902359 139643607389632 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07025856, 'global_step': 30, 'accuracy': 0.977}

Removing gs://yangyou-mnist/log/#1565821689554047...
Removing gs://yangyou-mnist/log/checkpoint#1565821768656164...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565821689.v3-8-tpu#1565821771976893...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565821694511982...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565821702542129...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565821701672433...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565821707230006...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565821765062793...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565821765997926...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565821770866884...
Removing gs://yangyou-mnist/log/eval/#1565821884143295...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565821884.v3-8-tpu#1565821887592314...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:31:31.686920 139663450875328 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:31:31.687735 139663450875328 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:31:31.690597 139663450875328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:31:31.691452 139663450875328 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:31:31.692030 139663450875328 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:31:31.692167 139663450875328 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:31:32.101900 139663450875328 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:31:32.108562 139663450875328 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:31:32.112176 139663450875328 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:31:32.167445 139663450875328 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:31:32.167714 139663450875328 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:31:32.331217 139663450875328 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:31:32.383405 139663450875328 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:31:32.383677 139663450875328 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:31:32.625312 139663450875328 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f05c889f050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f05caa7e1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:31:32.625654 139663450875328 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:31:32.966799 139663450875328 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:31:32.969953: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:31:32.982496 139663450875328 tpu_system_metadata.py:148] Found TPU system:
I0814 22:31:32.982738 139663450875328 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:31:32.983237 139663450875328 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:31:32.983297 139663450875328 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:31:32.983357 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:31:32.983661 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:31:32.983720 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:31:32.983772 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:31:32.983822 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:31:32.983869 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:31:32.983916 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:31:32.983962 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:31:32.984009 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:31:32.984055 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:31:32.984102 139663450875328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:31:32.990149 139663450875328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:31:33.002666 139663450875328 estimator.py:1145] Calling model_fn.
W0814 22:31:33.003288 139663450875328 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:31:33.278078 139663450875328 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:31:33.695334 139663450875328 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:31:33.757802 139663450875328 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:31:33.763689 139663450875328 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:31:33.946265 139663450875328 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:31:33.960005 139663450875328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:31:33.972484 139663450875328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:31:33.973537 139663450875328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:31:33.980504 139663450875328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:31:33.985755 139663450875328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:31:33.985976 139663450875328 optimization.py:36] ++++++ warmup starts at step 0, for 12 steps ++++++
W0814 22:31:33.998816 139663450875328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:31:34.109302 139663450875328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:31:34.151273 139663450875328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:31:34.195594 139663450875328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:31:34.247225 139663450875328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:31:34.409111 139663450875328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:31:34.459557 139663450875328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:31:34.509093 139663450875328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:31:34.559973 139663450875328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:31:34.606353 139663450875328 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:31:34.647491 139663450875328 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:31:34.663630 139663450875328 estimator.py:1147] Done calling model_fn.
I0814 22:31:38.510188 139663450875328 tpu_estimator.py:499] TPU job name worker
I0814 22:31:38.622010 139663450875328 monitored_session.py:240] Graph was finalized.
I0814 22:31:39.332252 139663450875328 session_manager.py:500] Running local_init_op.
I0814 22:31:39.396049 139663450875328 session_manager.py:502] Done running local_init_op.
I0814 22:31:42.104286 139663450875328 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:31:54.910929 139663450875328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:31:55.081311 139663450875328 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:31:55.081727 139663450875328 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:31:55.082119: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:31:55.087644 139663450875328 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:31:55.089983 139663450875328 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:31:55.094563 139663450875328 tpu_estimator.py:557] Init TPU system
I0814 22:32:36.108470 139663450875328 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 22:32:36.109347 139662688757504 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:32:36.109782 139662337242880 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:32:36.188818 139662328850176 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:32:36.193528 139663450875328 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:32:36.194684 139663450875328 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:32:36.374749 139662328850176 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:32:41.147556 139662337242880 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:32:45.920793 139663450875328 basic_session_run_hooks.py:262] loss = 0.08688195, step = 30
I0814 22:32:45.923748 139663450875328 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:32:59.545614 139663450875328 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:32:59.545965 139663450875328 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:32:59.547370 139662688757504 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:32:59.547554 139662688757504 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:32:59.547748 139663450875328 error_handling.py:96] infeed marked as finished
I0814 22:32:59.548093 139663450875328 tpu_estimator.py:602] Stop output thread controller
I0814 22:32:59.548213 139663450875328 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:32:59.548444 139662337242880 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:32:59.548542 139662337242880 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:32:59.548670 139663450875328 error_handling.py:96] outfeed marked as finished
I0814 22:32:59.548773 139663450875328 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:33:06.513283 139663450875328 estimator.py:368] Loss for final step: 0.08688195.
I0814 22:33:06.514111 139663450875328 error_handling.py:96] training_loop marked as finished
I0814 22:33:07.199800 139663450875328 estimator.py:1145] Calling model_fn.
E0814 22:33:07.899328 139663450875328 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:33:08.131007 139663450875328 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:33:08.153665 139663450875328 estimator.py:1147] Done calling model_fn.
I0814 22:33:08.170538 139663450875328 evaluation.py:255] Starting evaluation at 2019-08-14T22:33:08Z
I0814 22:33:08.170780 139663450875328 tpu_estimator.py:499] TPU job name worker
I0814 22:33:08.251416 139663450875328 monitored_session.py:240] Graph was finalized.
W0814 22:33:08.252188 139663450875328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:33:08.453471 139663450875328 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:33:11.285396 139663450875328 session_manager.py:500] Running local_init_op.
I0814 22:33:11.310564 139663450875328 session_manager.py:502] Done running local_init_op.
I0814 22:33:11.360500 139663450875328 tpu_estimator.py:557] Init TPU system
I0814 22:34:20.050110 139663450875328 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:34:20.051019 139662337242880 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:34:20.051877 139662328850176 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:34:20.120634 139663450875328 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:34:20.157892 139663450875328 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:34:20.158235 139663450875328 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:34:20.255323 139662320457472 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:34:20.425554 139662320457472 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:34:20.964514 139662328850176 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:34:21.247515 139663450875328 evaluation.py:167] Evaluation [10/10]
I0814 22:34:21.247867 139663450875328 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:34:21.247940 139663450875328 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:34:21.248121 139662337242880 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:34:21.248230 139662337242880 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:34:21.248380 139663450875328 error_handling.py:96] infeed marked as finished
I0814 22:34:21.248512 139663450875328 tpu_estimator.py:602] Stop output thread controller
I0814 22:34:21.248563 139663450875328 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:34:21.248698 139662328850176 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:34:21.248826 139662328850176 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:34:21.249044 139663450875328 error_handling.py:96] outfeed marked as finished
I0814 22:34:21.249155 139663450875328 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:34:50.519572 139663450875328 evaluation.py:275] Finished evaluation at 2019-08-14-22:34:50
I0814 22:34:50.519994 139663450875328 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9778, global_step = 30, loss = 0.07439743
I0814 22:34:54.930422 139663450875328 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:34:55.922285 139663450875328 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07439743, 'global_step': 30, 'accuracy': 0.9778}

Removing gs://yangyou-mnist/log/#1565821896549198...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565821896.v3-8-tpu#1565821979235440...
Removing gs://yangyou-mnist/log/checkpoint#1565821975930077...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565821908976243...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565821901523759...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565821909885608...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565821914395013...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565821973545000...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565821972617468...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565821978204717...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565822092231022...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565822092.v3-8-tpu#1565822095476719...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:34:59.711977 139682874926528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:34:59.712897 139682874926528 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:34:59.715502 139682874926528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:34:59.716322 139682874926528 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:34:59.717097 139682874926528 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:34:59.717233 139682874926528 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:35:00.136054 139682874926528 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:35:00.142975 139682874926528 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:35:00.146858 139682874926528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:35:00.272305 139682874926528 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:35:00.272627 139682874926528 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:35:00.703994 139682874926528 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:35:00.757988 139682874926528 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:35:00.758311 139682874926528 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:35:01.034264 139682874926528 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0a4e4d7190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0a506b6210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:35:01.034707 139682874926528 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:35:01.373795 139682874926528 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:35:01.376693: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:35:01.391453 139682874926528 tpu_system_metadata.py:148] Found TPU system:
I0814 22:35:01.391694 139682874926528 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:35:01.392198 139682874926528 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:35:01.392263 139682874926528 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:35:01.392324 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:35:01.392712 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:35:01.392781 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:35:01.392834 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:35:01.392884 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:35:01.392930 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:35:01.392977 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:35:01.393023 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:35:01.393088 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:35:01.393135 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:35:01.393183 139682874926528 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:35:01.399388 139682874926528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:35:01.412861 139682874926528 estimator.py:1145] Calling model_fn.
W0814 22:35:01.413501 139682874926528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:35:01.685096 139682874926528 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:35:02.104448 139682874926528 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:35:02.167597 139682874926528 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:35:02.173736 139682874926528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:35:02.361284 139682874926528 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:35:02.375287 139682874926528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:35:02.387646 139682874926528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:35:02.388794 139682874926528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:35:02.396065 139682874926528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:35:02.401426 139682874926528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:35:02.401658 139682874926528 optimization.py:36] ++++++ warmup starts at step 0, for 12 steps ++++++
W0814 22:35:02.414632 139682874926528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:35:02.525729 139682874926528 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:35:02.568387 139682874926528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:35:02.613814 139682874926528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:35:02.664896 139682874926528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:35:02.839998 139682874926528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:35:02.891125 139682874926528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:35:02.940120 139682874926528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:35:02.991193 139682874926528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:35:03.037110 139682874926528 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:35:03.078336 139682874926528 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:35:03.094851 139682874926528 estimator.py:1147] Done calling model_fn.
I0814 22:35:06.584897 139682874926528 tpu_estimator.py:499] TPU job name worker
I0814 22:35:06.698261 139682874926528 monitored_session.py:240] Graph was finalized.
I0814 22:35:07.390433 139682874926528 session_manager.py:500] Running local_init_op.
I0814 22:35:07.451915 139682874926528 session_manager.py:502] Done running local_init_op.
I0814 22:35:10.202399 139682874926528 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:35:22.498565 139682874926528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:35:22.671273 139682874926528 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:35:22.671709 139682874926528 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:35:22.672103: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:35:22.677958 139682874926528 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:35:22.680138 139682874926528 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:35:22.684206 139682874926528 tpu_estimator.py:557] Init TPU system
I0814 22:36:04.013024 139682874926528 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 22:36:04.014082 139681978636032 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:36:04.014672 139681970243328 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:36:04.076611 139681961850624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:36:04.082442 139682874926528 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:36:04.083312 139682874926528 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:36:04.356584 139681961850624 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:36:08.878669 139681970243328 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:36:13.542284 139682874926528 basic_session_run_hooks.py:262] loss = 0.09183978, step = 30
I0814 22:36:13.544933 139682874926528 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:36:27.362920 139682874926528 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:36:27.363228 139682874926528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:36:27.363496 139681978636032 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:36:27.363684 139681978636032 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:36:27.363872 139682874926528 error_handling.py:96] infeed marked as finished
I0814 22:36:27.364003 139682874926528 tpu_estimator.py:602] Stop output thread controller
I0814 22:36:27.364072 139682874926528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:36:27.364223 139681970243328 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:36:27.364320 139681970243328 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:36:27.364499 139682874926528 error_handling.py:96] outfeed marked as finished
I0814 22:36:27.364607 139682874926528 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:36:34.496068 139682874926528 estimator.py:368] Loss for final step: 0.09183978.
I0814 22:36:34.496931 139682874926528 error_handling.py:96] training_loop marked as finished
I0814 22:36:35.216444 139682874926528 estimator.py:1145] Calling model_fn.
E0814 22:36:36.004080 139682874926528 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:36:36.235630 139682874926528 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:36:36.257993 139682874926528 estimator.py:1147] Done calling model_fn.
I0814 22:36:36.274987 139682874926528 evaluation.py:255] Starting evaluation at 2019-08-14T22:36:36Z
I0814 22:36:36.275228 139682874926528 tpu_estimator.py:499] TPU job name worker
I0814 22:36:36.353372 139682874926528 monitored_session.py:240] Graph was finalized.
W0814 22:36:36.354090 139682874926528 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:36:36.538589 139682874926528 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:36:39.194710 139682874926528 session_manager.py:500] Running local_init_op.
I0814 22:36:39.225024 139682874926528 session_manager.py:502] Done running local_init_op.
I0814 22:36:39.297683 139682874926528 tpu_estimator.py:557] Init TPU system
I0814 22:37:48.043526 139682874926528 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:37:48.044540 139681974966016 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:37:48.045000 139681966573312 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:37:48.112788 139682874926528 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:37:48.137208 139682874926528 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:37:48.137566 139682874926528 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:37:48.183064 139681953195776 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:37:48.590729 139681953195776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:37:48.948128 139681966573312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:37:49.239959 139682874926528 evaluation.py:167] Evaluation [10/10]
I0814 22:37:49.240302 139682874926528 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:37:49.240372 139682874926528 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:37:49.240638 139681974966016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:37:49.240773 139681974966016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:37:49.240926 139682874926528 error_handling.py:96] infeed marked as finished
I0814 22:37:49.241036 139682874926528 tpu_estimator.py:602] Stop output thread controller
I0814 22:37:49.241086 139682874926528 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:37:49.241291 139681966573312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:37:49.241389 139681966573312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:37:49.241525 139682874926528 error_handling.py:96] outfeed marked as finished
I0814 22:37:49.241605 139682874926528 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:38:18.662828 139682874926528 evaluation.py:275] Finished evaluation at 2019-08-14-22:38:18
I0814 22:38:18.663208 139682874926528 estimator.py:2039] Saving dict for global step 30: accuracy = 0.978, global_step = 30, loss = 0.069266744
I0814 22:38:23.218899 139682874926528 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:38:24.036452 139682874926528 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.069266744, 'global_step': 30, 'accuracy': 0.978}

Removing gs://yangyou-mnist/log/#1565822104630148...
Removing gs://yangyou-mnist/log/checkpoint#1565822183670193...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565822104.v3-8-tpu#1565822187040171...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565822117572581...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565822109637718...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565822121978704...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565822116648026...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565822181421213...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565822180340347...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565822186033727...
Removing gs://yangyou-mnist/log/eval/#1565822300383198...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565822300.v3-8-tpu#1565822303722410...
/ [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:38:27.989998 140287653557696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:38:27.990947 140287653557696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:38:27.993882 140287653557696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:38:27.994752 140287653557696 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:38:27.995385 140287653557696 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:38:27.995524 140287653557696 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:38:28.429277 140287653557696 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:38:28.438143 140287653557696 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:38:28.442867 140287653557696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:38:28.502254 140287653557696 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:38:28.502528 140287653557696 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:38:28.661195 140287653557696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:38:28.778018 140287653557696 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:38:28.778321 140287653557696 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:38:29.175133 140287653557696 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f971deb01d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f972008f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:38:29.175589 140287653557696 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:38:29.524087 140287653557696 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:38:29.527245: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:38:29.542670 140287653557696 tpu_system_metadata.py:148] Found TPU system:
I0814 22:38:29.542922 140287653557696 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:38:29.543622 140287653557696 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:38:29.543690 140287653557696 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:38:29.543767 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:38:29.544114 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:38:29.544178 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:38:29.544235 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:38:29.544301 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:38:29.544356 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:38:29.544470 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:38:29.544572 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:38:29.544634 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:38:29.544687 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:38:29.544743 140287653557696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:38:29.552025 140287653557696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:38:29.566551 140287653557696 estimator.py:1145] Calling model_fn.
W0814 22:38:29.567229 140287653557696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:38:29.850205 140287653557696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:38:30.273442 140287653557696 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:38:30.337233 140287653557696 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:38:30.343391 140287653557696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:38:30.533958 140287653557696 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:38:30.548366 140287653557696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:38:30.561228 140287653557696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:38:30.562366 140287653557696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:38:30.569703 140287653557696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:38:30.575330 140287653557696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:38:30.575551 140287653557696 optimization.py:36] ++++++ warmup starts at step 0, for 12 steps ++++++
W0814 22:38:30.588232 140287653557696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:38:30.704499 140287653557696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:38:30.749449 140287653557696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:38:30.796390 140287653557696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:38:30.850121 140287653557696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:38:31.015631 140287653557696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:38:31.068118 140287653557696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:38:31.119517 140287653557696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:38:31.171910 140287653557696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:38:31.221120 140287653557696 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:38:31.265080 140287653557696 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:38:31.282805 140287653557696 estimator.py:1147] Done calling model_fn.
I0814 22:38:34.759053 140287653557696 tpu_estimator.py:499] TPU job name worker
I0814 22:38:34.876755 140287653557696 monitored_session.py:240] Graph was finalized.
I0814 22:38:35.548604 140287653557696 session_manager.py:500] Running local_init_op.
I0814 22:38:35.597619 140287653557696 session_manager.py:502] Done running local_init_op.
I0814 22:38:39.168875 140287653557696 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:38:51.693263 140287653557696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:38:51.855226 140287653557696 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:38:51.855660 140287653557696 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:38:51.856074: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:38:51.861175 140287653557696 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:38:51.863394 140287653557696 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:38:51.867602 140287653557696 tpu_estimator.py:557] Init TPU system
I0814 22:39:32.129220 140287653557696 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 22:39:32.130134 140286891640576 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:39:32.130611 140286883247872 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:39:32.196177 140286874855168 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:39:32.198179 140287653557696 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:39:32.199523 140287653557696 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:39:32.640620 140286874855168 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:39:37.097691 140286883247872 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:39:42.039280 140287653557696 basic_session_run_hooks.py:262] loss = 0.075356446, step = 30
I0814 22:39:42.042370 140287653557696 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:39:56.051341 140287653557696 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:39:56.051681 140287653557696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:39:56.053162 140286891640576 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:39:56.053417 140286891640576 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:39:56.053582 140287653557696 error_handling.py:96] infeed marked as finished
I0814 22:39:56.053708 140287653557696 tpu_estimator.py:602] Stop output thread controller
I0814 22:39:56.053774 140287653557696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:39:56.053900 140286883247872 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:39:56.053996 140286883247872 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:39:56.054138 140287653557696 error_handling.py:96] outfeed marked as finished
I0814 22:39:56.054235 140287653557696 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:40:02.784739 140287653557696 estimator.py:368] Loss for final step: 0.075356446.
I0814 22:40:02.785571 140287653557696 error_handling.py:96] training_loop marked as finished
I0814 22:40:03.591404 140287653557696 estimator.py:1145] Calling model_fn.
E0814 22:40:04.389705 140287653557696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:40:04.621275 140287653557696 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:40:04.643886 140287653557696 estimator.py:1147] Done calling model_fn.
I0814 22:40:04.661909 140287653557696 evaluation.py:255] Starting evaluation at 2019-08-14T22:40:04Z
I0814 22:40:04.662161 140287653557696 tpu_estimator.py:499] TPU job name worker
I0814 22:40:04.747081 140287653557696 monitored_session.py:240] Graph was finalized.
W0814 22:40:04.747891 140287653557696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:40:04.950012 140287653557696 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:40:07.777657 140287653557696 session_manager.py:500] Running local_init_op.
I0814 22:40:07.804214 140287653557696 session_manager.py:502] Done running local_init_op.
I0814 22:40:07.864207 140287653557696 tpu_estimator.py:557] Init TPU system
I0814 22:41:16.052531 140287653557696 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:41:16.053364 140286887970560 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:41:16.053950 140286879577856 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:41:16.125478 140287653557696 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:41:16.155093 140287653557696 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:41:16.155445 140287653557696 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:41:16.191893 140286866200320 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:41:16.483666 140286866200320 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:41:16.968512 140286879577856 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:41:17.186012 140287653557696 evaluation.py:167] Evaluation [10/10]
I0814 22:41:17.186382 140287653557696 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:41:17.186469 140287653557696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:41:17.186686 140286887970560 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:41:17.186805 140286887970560 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:41:17.186954 140287653557696 error_handling.py:96] infeed marked as finished
I0814 22:41:17.187066 140287653557696 tpu_estimator.py:602] Stop output thread controller
I0814 22:41:17.187120 140287653557696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:41:17.187253 140286879577856 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:41:17.187331 140286879577856 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:41:17.187455 140287653557696 error_handling.py:96] outfeed marked as finished
I0814 22:41:17.187556 140287653557696 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:41:46.584103 140287653557696 evaluation.py:275] Finished evaluation at 2019-08-14-22:41:46
I0814 22:41:46.584486 140287653557696 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9817, global_step = 30, loss = 0.04484029
I0814 22:41:50.960457 140287653557696 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:41:51.776258 140287653557696 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.04484029, 'global_step': 30, 'accuracy': 0.9817}

Removing gs://yangyou-mnist/log/#1565822312817525...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565822326589684...
Removing gs://yangyou-mnist/log/checkpoint#1565822392053381...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565822313.v3-8-tpu#1565822395746227...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565822318594514...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565822325718790...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565822331182766...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565822388893666...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565822389757827...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565822394422858...
Removing gs://yangyou-mnist/log/eval/#1565822508245729...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565822508.v3-8-tpu#1565822511468624...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:41:55.667882 140361383048640 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:41:55.668705 140361383048640 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:41:55.671344 140361383048640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:41:55.672188 140361383048640 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:41:55.672955 140361383048640 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:41:55.673094 140361383048640 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:41:56.094563 140361383048640 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:41:56.101674 140361383048640 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:41:56.105626 140361383048640 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:41:56.165376 140361383048640 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:41:56.165680 140361383048640 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:41:56.509635 140361383048640 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:41:56.562957 140361383048640 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:41:56.563262 140361383048640 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:41:56.840317 140361383048640 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa84889c250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa84aa7b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:41:56.840816 140361383048640 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:41:57.155153 140361383048640 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:41:57.158054: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:41:57.172559 140361383048640 tpu_system_metadata.py:148] Found TPU system:
I0814 22:41:57.172833 140361383048640 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:41:57.173346 140361383048640 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:41:57.173412 140361383048640 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:41:57.173465 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:41:57.173747 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:41:57.173803 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:41:57.173852 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:41:57.173899 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:41:57.173947 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:41:57.173993 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:41:57.174037 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:41:57.174082 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:41:57.174141 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:41:57.174190 140361383048640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:41:57.180469 140361383048640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:41:57.193705 140361383048640 estimator.py:1145] Calling model_fn.
W0814 22:41:57.194363 140361383048640 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:41:57.469240 140361383048640 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:41:57.894467 140361383048640 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:41:57.957936 140361383048640 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:41:57.964529 140361383048640 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:41:58.150693 140361383048640 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:41:58.164710 140361383048640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:41:58.177076 140361383048640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:41:58.178204 140361383048640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:41:58.185328 140361383048640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:41:58.190638 140361383048640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:41:58.190850 140361383048640 optimization.py:36] ++++++ warmup starts at step 0, for 12 steps ++++++
W0814 22:41:58.203414 140361383048640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:41:58.315377 140361383048640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:41:58.357631 140361383048640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:41:58.412513 140361383048640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:41:58.464662 140361383048640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:41:58.627619 140361383048640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:41:58.679409 140361383048640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:41:58.729782 140361383048640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:41:58.781816 140361383048640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:41:58.829160 140361383048640 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:41:58.871018 140361383048640 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:41:58.887352 140361383048640 estimator.py:1147] Done calling model_fn.
I0814 22:42:02.443794 140361383048640 tpu_estimator.py:499] TPU job name worker
I0814 22:42:02.558029 140361383048640 monitored_session.py:240] Graph was finalized.
I0814 22:42:03.228177 140361383048640 session_manager.py:500] Running local_init_op.
I0814 22:42:03.278340 140361383048640 session_manager.py:502] Done running local_init_op.
I0814 22:42:06.098787 140361383048640 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:42:19.542454 140361383048640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:42:19.714421 140361383048640 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:42:19.714862 140361383048640 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:42:19.715275: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:42:19.721287 140361383048640 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:42:19.723521 140361383048640 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:42:19.728044 140361383048640 tpu_estimator.py:557] Init TPU system
I0814 22:43:00.113152 140361383048640 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 22:43:00.114070 140360620943104 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:43:00.114573 140360269428480 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:43:00.176284 140360261035776 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:43:00.184056 140361383048640 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:43:00.184876 140361383048640 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:43:00.525741 140360261035776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:43:05.027326 140360269428480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:43:09.734548 140361383048640 basic_session_run_hooks.py:262] loss = 0.061840132, step = 30
I0814 22:43:09.737111 140361383048640 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:43:23.610342 140361383048640 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:43:23.610688 140361383048640 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:43:23.611069 140360620943104 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:43:23.611397 140360620943104 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:43:23.611599 140361383048640 error_handling.py:96] infeed marked as finished
I0814 22:43:23.611824 140361383048640 tpu_estimator.py:602] Stop output thread controller
I0814 22:43:23.611886 140361383048640 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:43:23.612073 140360269428480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:43:23.612273 140360269428480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:43:23.612560 140361383048640 error_handling.py:96] outfeed marked as finished
I0814 22:43:23.612732 140361383048640 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:43:30.641036 140361383048640 estimator.py:368] Loss for final step: 0.061840132.
I0814 22:43:30.641907 140361383048640 error_handling.py:96] training_loop marked as finished
I0814 22:43:31.430394 140361383048640 estimator.py:1145] Calling model_fn.
E0814 22:43:32.119040 140361383048640 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:43:32.349524 140361383048640 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:43:32.372044 140361383048640 estimator.py:1147] Done calling model_fn.
I0814 22:43:32.390038 140361383048640 evaluation.py:255] Starting evaluation at 2019-08-14T22:43:32Z
I0814 22:43:32.390275 140361383048640 tpu_estimator.py:499] TPU job name worker
I0814 22:43:32.475101 140361383048640 monitored_session.py:240] Graph was finalized.
W0814 22:43:32.475867 140361383048640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:43:32.659296 140361383048640 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:43:35.622605 140361383048640 session_manager.py:500] Running local_init_op.
I0814 22:43:35.649332 140361383048640 session_manager.py:502] Done running local_init_op.
I0814 22:43:35.700512 140361383048640 tpu_estimator.py:557] Init TPU system
I0814 22:44:44.072499 140361383048640 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:44:44.073601 140360269428480 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:44:44.074352 140360261035776 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:44:44.151391 140361383048640 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:44:44.178062 140361383048640 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:44:44.178415 140361383048640 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:44:44.216481 140360252643072 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:44:44.583285 140360252643072 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:44:44.964207 140360261035776 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:44:45.371157 140361383048640 evaluation.py:167] Evaluation [10/10]
I0814 22:44:45.371592 140361383048640 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:44:45.371681 140361383048640 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:44:45.372112 140360269428480 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:44:45.372473 140360269428480 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:44:45.372708 140361383048640 error_handling.py:96] infeed marked as finished
I0814 22:44:45.372889 140361383048640 tpu_estimator.py:602] Stop output thread controller
I0814 22:44:45.372965 140361383048640 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:44:45.373162 140360261035776 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:44:45.373373 140360261035776 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:44:45.373572 140361383048640 error_handling.py:96] outfeed marked as finished
I0814 22:44:45.373815 140361383048640 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:45:14.681816 140361383048640 evaluation.py:275] Finished evaluation at 2019-08-14-22:45:14
I0814 22:45:14.682178 140361383048640 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9839, global_step = 30, loss = 0.05056972
I0814 22:45:19.153311 140361383048640 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:45:19.984213 140361383048640 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.05056972, 'global_step': 30, 'accuracy': 0.9839}

Removing gs://yangyou-mnist/log/#1565822520541486...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565822520.v3-8-tpu#1565822603302889...
Removing gs://yangyou-mnist/log/checkpoint#1565822600131661...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565822525512000...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565822533383470...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565822534246410...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565822539027210...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565822596851962...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565822597825512...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565822602378804...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565822716.v3-8-tpu#1565822719679717...
Removing gs://yangyou-mnist/log/eval/#1565822716365149...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:45:23.895288 140693105477056 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:45:23.896054 140693105477056 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:45:23.898700 140693105477056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:45:23.899535 140693105477056 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:45:23.900104 140693105477056 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:45:23.900233 140693105477056 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:45:24.305344 140693105477056 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:45:24.312026 140693105477056 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:45:24.315732 140693105477056 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:45:24.371656 140693105477056 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:45:24.371927 140693105477056 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:45:24.554513 140693105477056 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:45:24.672024 140693105477056 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:45:24.672292 140693105477056 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:45:24.840821 140693105477056 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff584bc5210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff586da4210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:45:24.841156 140693105477056 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:45:25.189062 140693105477056 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:45:25.192112: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:45:25.204369 140693105477056 tpu_system_metadata.py:148] Found TPU system:
I0814 22:45:25.204770 140693105477056 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:45:25.205370 140693105477056 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:45:25.205491 140693105477056 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:45:25.205566 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:45:25.205951 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:45:25.206016 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:45:25.206096 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:45:25.206162 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:45:25.206237 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:45:25.206305 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:45:25.206362 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:45:25.206429 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:45:25.206475 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:45:25.206528 140693105477056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:45:25.212820 140693105477056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:45:25.225522 140693105477056 estimator.py:1145] Calling model_fn.
W0814 22:45:25.226164 140693105477056 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:45:25.495106 140693105477056 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:45:25.944200 140693105477056 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:45:26.006010 140693105477056 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:45:26.012130 140693105477056 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:45:26.192099 140693105477056 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:45:26.206228 140693105477056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:45:26.219000 140693105477056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:45:26.220113 140693105477056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:45:26.227308 140693105477056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:45:26.232665 140693105477056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:45:26.232913 140693105477056 optimization.py:36] ++++++ warmup starts at step 0, for 12 steps ++++++
W0814 22:45:26.245412 140693105477056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:45:26.355793 140693105477056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:45:26.397458 140693105477056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:45:26.442516 140693105477056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:45:26.495465 140693105477056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:45:26.656843 140693105477056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:45:26.707076 140693105477056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:45:26.757118 140693105477056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:45:26.809076 140693105477056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:45:26.855551 140693105477056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:45:26.895787 140693105477056 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:45:26.911741 140693105477056 estimator.py:1147] Done calling model_fn.
I0814 22:45:31.248800 140693105477056 tpu_estimator.py:499] TPU job name worker
I0814 22:45:31.364945 140693105477056 monitored_session.py:240] Graph was finalized.
I0814 22:45:32.095865 140693105477056 session_manager.py:500] Running local_init_op.
I0814 22:45:32.158725 140693105477056 session_manager.py:502] Done running local_init_op.
I0814 22:45:35.265412 140693105477056 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:46:00.327918 140693105477056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:46:00.489528 140693105477056 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:46:00.490075 140693105477056 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:46:00.490480: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:46:00.496026 140693105477056 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:46:00.498207 140693105477056 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:46:00.502412 140693105477056 tpu_estimator.py:557] Init TPU system
I0814 22:46:28.113172 140693105477056 tpu_estimator.py:566] Initialized TPU in 27 seconds
I0814 22:46:28.114172 140692343465728 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:46:28.115048 140692335073024 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:46:28.181328 140693105477056 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:46:28.182188 140693105477056 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 22:46:28.244893 140691854325504 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:46:28.650600 140691854325504 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:46:32.990452 140692335073024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:46:37.745085 140693105477056 basic_session_run_hooks.py:262] loss = 0.07840491, step = 30
I0814 22:46:37.747447 140693105477056 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:46:51.501785 140693105477056 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:46:51.502074 140693105477056 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:46:51.502397 140692343465728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:46:51.502682 140692343465728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:46:51.502944 140693105477056 error_handling.py:96] infeed marked as finished
I0814 22:46:51.503227 140693105477056 tpu_estimator.py:602] Stop output thread controller
I0814 22:46:51.503297 140693105477056 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:46:51.503528 140692335073024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:46:51.503679 140692335073024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:46:51.503882 140693105477056 error_handling.py:96] outfeed marked as finished
I0814 22:46:51.504292 140693105477056 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:46:58.793745 140693105477056 estimator.py:368] Loss for final step: 0.07840491.
I0814 22:46:58.794593 140693105477056 error_handling.py:96] training_loop marked as finished
I0814 22:46:59.618777 140693105477056 estimator.py:1145] Calling model_fn.
E0814 22:47:00.386399 140693105477056 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:47:00.604067 140693105477056 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:47:00.625021 140693105477056 estimator.py:1147] Done calling model_fn.
I0814 22:47:00.640623 140693105477056 evaluation.py:255] Starting evaluation at 2019-08-14T22:47:00Z
I0814 22:47:00.640866 140693105477056 tpu_estimator.py:499] TPU job name worker
I0814 22:47:00.715948 140693105477056 monitored_session.py:240] Graph was finalized.
W0814 22:47:00.716716 140693105477056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:47:00.923661 140693105477056 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:47:03.510935 140693105477056 session_manager.py:500] Running local_init_op.
I0814 22:47:03.541891 140693105477056 session_manager.py:502] Done running local_init_op.
I0814 22:47:03.590769 140693105477056 tpu_estimator.py:557] Init TPU system
I0814 22:48:12.054234 140693105477056 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:48:12.055233 140692339795712 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:48:12.055740 140691854325504 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:48:12.124296 140693105477056 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:48:12.149914 140693105477056 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:48:12.150266 140693105477056 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:48:12.248684 140691845932800 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:48:12.530884 140691845932800 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:48:12.879477 140691854325504 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:48:13.381970 140693105477056 evaluation.py:167] Evaluation [10/10]
I0814 22:48:13.382347 140693105477056 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:48:13.382436 140693105477056 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:48:13.382806 140692339795712 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:48:13.383079 140692339795712 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:48:13.383255 140693105477056 error_handling.py:96] infeed marked as finished
I0814 22:48:13.383397 140693105477056 tpu_estimator.py:602] Stop output thread controller
I0814 22:48:13.383465 140693105477056 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:48:13.383614 140691854325504 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:48:13.383712 140691854325504 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:48:13.383852 140693105477056 error_handling.py:96] outfeed marked as finished
I0814 22:48:13.383946 140693105477056 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:48:42.615371 140693105477056 evaluation.py:275] Finished evaluation at 2019-08-14-22:48:42
I0814 22:48:42.616040 140693105477056 estimator.py:2039] Saving dict for global step 30: accuracy = 0.984, global_step = 30, loss = 0.047623534
I0814 22:48:46.945904 140693105477056 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:48:47.811914 140693105477056 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.047623534, 'global_step': 30, 'accuracy': 0.984}

Removing gs://yangyou-mnist/log/#1565822728567458...
Removing gs://yangyou-mnist/log/checkpoint#1565822808012781...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565822734560265...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565822755321952...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565822728.v3-8-tpu#1565822811197473...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565822759802390...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565822754355875...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565822804776139...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565822805671896...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565822810237998...
Removing gs://yangyou-mnist/log/eval/#1565822924276158...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565822924.v3-8-tpu#1565822927500540...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:48:51.717555 140095980242368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:48:51.718355 140095980242368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:48:51.721338 140095980242368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:48:51.722203 140095980242368 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:48:51.722798 140095980242368 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:48:51.722933 140095980242368 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:48:52.139410 140095980242368 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:48:52.148292 140095980242368 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:48:52.152981 140095980242368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:48:52.211201 140095980242368 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:48:52.211476 140095980242368 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:48:52.567138 140095980242368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:48:52.689990 140095980242368 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:48:52.690270 140095980242368 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:48:53.022604 140095980242368 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f6a7d4c5090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f6a7f6a4210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:48:53.023096 140095980242368 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:48:53.357530 140095980242368 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:48:53.360915: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:48:53.374306 140095980242368 tpu_system_metadata.py:148] Found TPU system:
I0814 22:48:53.374567 140095980242368 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:48:53.375058 140095980242368 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:48:53.375128 140095980242368 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:48:53.375181 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:48:53.375462 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:48:53.375518 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:48:53.375569 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:48:53.375624 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:48:53.375674 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:48:53.375720 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:48:53.375766 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:48:53.375813 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:48:53.375860 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:48:53.375914 140095980242368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:48:53.382086 140095980242368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:48:53.395864 140095980242368 estimator.py:1145] Calling model_fn.
W0814 22:48:53.396533 140095980242368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:48:53.676305 140095980242368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:48:54.093844 140095980242368 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:48:54.157895 140095980242368 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:48:54.164263 140095980242368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:48:54.358926 140095980242368 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:48:54.373142 140095980242368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:48:54.385633 140095980242368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:48:54.386770 140095980242368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:48:54.394217 140095980242368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:48:54.399555 140095980242368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:48:54.399786 140095980242368 optimization.py:36] ++++++ warmup starts at step 0, for 12 steps ++++++
W0814 22:48:54.412813 140095980242368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:48:54.526279 140095980242368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:48:54.570924 140095980242368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:48:54.617115 140095980242368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:48:54.670795 140095980242368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:48:54.835045 140095980242368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:48:54.887538 140095980242368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:48:54.938338 140095980242368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:48:54.990030 140095980242368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:48:55.038073 140095980242368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:48:55.083690 140095980242368 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:48:55.101370 140095980242368 estimator.py:1147] Done calling model_fn.
I0814 22:48:58.537058 140095980242368 tpu_estimator.py:499] TPU job name worker
I0814 22:48:58.651871 140095980242368 monitored_session.py:240] Graph was finalized.
I0814 22:48:59.340938 140095980242368 session_manager.py:500] Running local_init_op.
I0814 22:48:59.390775 140095980242368 session_manager.py:502] Done running local_init_op.
I0814 22:49:02.271996 140095980242368 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:49:14.535780 140095980242368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:49:14.702426 140095980242368 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:49:14.702864 140095980242368 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:49:14.703275: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:49:14.708884 140095980242368 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:49:14.710968 140095980242368 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:49:14.715004 140095980242368 tpu_estimator.py:557] Init TPU system
I0814 22:49:56.120090 140095980242368 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 22:49:56.121170 140095218235136 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:49:56.122008 140095209842432 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:49:56.184734 140095201449728 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:49:56.190500 140095980242368 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:49:56.191775 140095980242368 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:49:56.458318 140095201449728 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 22:50:01.046658 140095209842432 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:50:05.743302 140095980242368 basic_session_run_hooks.py:262] loss = 0.12081549, step = 30
I0814 22:50:05.745744 140095980242368 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:50:19.382179 140095980242368 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:50:19.382461 140095980242368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:50:19.382776 140095218235136 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:50:19.383068 140095218235136 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:50:19.383299 140095980242368 error_handling.py:96] infeed marked as finished
I0814 22:50:19.383514 140095980242368 tpu_estimator.py:602] Stop output thread controller
I0814 22:50:19.383594 140095980242368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:50:19.383932 140095209842432 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:50:19.384088 140095209842432 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:50:19.384299 140095980242368 error_handling.py:96] outfeed marked as finished
I0814 22:50:19.384640 140095980242368 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:50:26.601881 140095980242368 estimator.py:368] Loss for final step: 0.12081549.
I0814 22:50:26.602680 140095980242368 error_handling.py:96] training_loop marked as finished
I0814 22:50:27.455512 140095980242368 estimator.py:1145] Calling model_fn.
E0814 22:50:28.180007 140095980242368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:50:28.400192 140095980242368 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:50:28.422195 140095980242368 estimator.py:1147] Done calling model_fn.
I0814 22:50:28.437874 140095980242368 evaluation.py:255] Starting evaluation at 2019-08-14T22:50:28Z
I0814 22:50:28.438127 140095980242368 tpu_estimator.py:499] TPU job name worker
I0814 22:50:28.513919 140095980242368 monitored_session.py:240] Graph was finalized.
W0814 22:50:28.514759 140095980242368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:50:28.722826 140095980242368 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:50:31.409490 140095980242368 session_manager.py:500] Running local_init_op.
I0814 22:50:31.433803 140095980242368 session_manager.py:502] Done running local_init_op.
I0814 22:50:31.484263 140095980242368 tpu_estimator.py:557] Init TPU system
I0814 22:51:40.068857 140095980242368 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:51:40.069962 140095214565120 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:51:40.070741 140095206172416 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:51:40.141204 140095980242368 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:51:40.166883 140095980242368 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:51:40.167227 140095980242368 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:51:40.206592 140094719653632 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:51:40.563910 140094719653632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:51:40.958837 140095206172416 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:51:41.415087 140095980242368 evaluation.py:167] Evaluation [10/10]
I0814 22:51:41.415442 140095980242368 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:51:41.415597 140095980242368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:51:41.415951 140095214565120 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:51:41.416241 140095214565120 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:51:41.416584 140095980242368 error_handling.py:96] infeed marked as finished
I0814 22:51:41.416771 140095980242368 tpu_estimator.py:602] Stop output thread controller
I0814 22:51:41.416835 140095980242368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:51:41.417032 140095206172416 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:51:41.417220 140095206172416 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:51:41.417437 140095980242368 error_handling.py:96] outfeed marked as finished
I0814 22:51:41.417658 140095980242368 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:52:10.660947 140095980242368 evaluation.py:275] Finished evaluation at 2019-08-14-22:52:10
I0814 22:52:10.661267 140095980242368 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9768, global_step = 30, loss = 0.0705771
I0814 22:52:15.191660 140095980242368 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:52:16.027075 140095980242368 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.0705771, 'global_step': 30, 'accuracy': 0.9768}

Removing gs://yangyou-mnist/log/checkpoint#1565823015750676...
Removing gs://yangyou-mnist/log/#1565822936640868...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565822949408089...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565822936.v3-8-tpu#1565823019018512...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565822954023757...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565822941692334...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565822948529637...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565823012687845...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565823013557566...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565823017994769...
Removing gs://yangyou-mnist/log/eval/#1565823132401031...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565823132.v3-8-tpu#1565823135712839...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:52:19.893286 140607052338624 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:52:19.894047 140607052338624 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:52:19.896689 140607052338624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:52:19.897485 140607052338624 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:52:19.898056 140607052338624 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:52:19.898197 140607052338624 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:52:20.314119 140607052338624 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:52:20.321118 140607052338624 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:52:20.325453 140607052338624 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:52:20.383239 140607052338624 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:52:20.383544 140607052338624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:52:20.770189 140607052338624 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:52:20.885766 140607052338624 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:52:20.886048 140607052338624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:52:21.307399 140607052338624 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe17b91a310>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe17daf9210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:52:21.307817 140607052338624 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:52:21.637449 140607052338624 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:52:21.640132: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:52:21.652718 140607052338624 tpu_system_metadata.py:148] Found TPU system:
I0814 22:52:21.652940 140607052338624 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:52:21.653414 140607052338624 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:52:21.653471 140607052338624 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:52:21.653525 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:52:21.653812 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:52:21.653872 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:52:21.653923 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:52:21.653970 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:52:21.654019 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:52:21.654067 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:52:21.654128 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:52:21.654174 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:52:21.654221 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:52:21.654269 140607052338624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:52:21.660110 140607052338624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:52:21.672673 140607052338624 estimator.py:1145] Calling model_fn.
W0814 22:52:21.673302 140607052338624 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:52:21.949266 140607052338624 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:52:22.457031 140607052338624 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:52:22.519640 140607052338624 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:52:22.525605 140607052338624 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:52:22.705523 140607052338624 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:52:22.719238 140607052338624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:52:22.731398 140607052338624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:52:22.732477 140607052338624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:52:22.739569 140607052338624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:52:22.744836 140607052338624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:52:22.745042 140607052338624 optimization.py:36] ++++++ warmup starts at step 0, for 12 steps ++++++
W0814 22:52:22.757518 140607052338624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:52:22.867680 140607052338624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:52:22.910279 140607052338624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:52:22.955326 140607052338624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:52:23.006448 140607052338624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:52:23.167526 140607052338624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:52:23.218786 140607052338624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:52:23.275747 140607052338624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:52:23.326821 140607052338624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:52:23.373287 140607052338624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:52:23.414963 140607052338624 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:52:23.431261 140607052338624 estimator.py:1147] Done calling model_fn.
I0814 22:52:26.963130 140607052338624 tpu_estimator.py:499] TPU job name worker
I0814 22:52:27.076105 140607052338624 monitored_session.py:240] Graph was finalized.
I0814 22:52:27.803800 140607052338624 session_manager.py:500] Running local_init_op.
I0814 22:52:27.854036 140607052338624 session_manager.py:502] Done running local_init_op.
I0814 22:52:30.959498 140607052338624 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:52:43.558150 140607052338624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:52:43.702132 140607052338624 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:52:43.702527 140607052338624 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:52:43.703032: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:52:43.708026 140607052338624 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:52:43.710283 140607052338624 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:52:43.714610 140607052338624 tpu_estimator.py:557] Init TPU system
I0814 22:53:24.098763 140607052338624 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 22:53:24.099586 140606021826304 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:53:24.100056 140606013433600 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:53:24.163974 140606005040896 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:53:24.165462 140607052338624 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:53:24.166316 140607052338624 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 22:53:24.550400 140606005040896 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:53:29.092705 140606013433600 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:53:33.923962 140607052338624 basic_session_run_hooks.py:262] loss = 0.09570955, step = 30
I0814 22:53:33.926301 140607052338624 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:53:47.866864 140607052338624 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:53:47.867182 140607052338624 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:53:47.868851 140606021826304 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:53:47.869057 140606021826304 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:53:47.869376 140607052338624 error_handling.py:96] infeed marked as finished
I0814 22:53:47.869616 140607052338624 tpu_estimator.py:602] Stop output thread controller
I0814 22:53:47.869698 140607052338624 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:53:47.869884 140606013433600 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:53:47.869985 140606013433600 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:53:47.870271 140607052338624 error_handling.py:96] outfeed marked as finished
I0814 22:53:47.870419 140607052338624 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:53:54.694030 140607052338624 estimator.py:368] Loss for final step: 0.09570955.
I0814 22:53:54.694772 140607052338624 error_handling.py:96] training_loop marked as finished
I0814 22:53:55.518632 140607052338624 estimator.py:1145] Calling model_fn.
E0814 22:53:56.220558 140607052338624 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:53:56.453526 140607052338624 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:53:56.475337 140607052338624 estimator.py:1147] Done calling model_fn.
I0814 22:53:56.494079 140607052338624 evaluation.py:255] Starting evaluation at 2019-08-14T22:53:56Z
I0814 22:53:56.494323 140607052338624 tpu_estimator.py:499] TPU job name worker
I0814 22:53:56.574923 140607052338624 monitored_session.py:240] Graph was finalized.
W0814 22:53:56.575702 140607052338624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:53:56.778726 140607052338624 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:53:59.390945 140607052338624 session_manager.py:500] Running local_init_op.
I0814 22:53:59.416970 140607052338624 session_manager.py:502] Done running local_init_op.
I0814 22:53:59.466310 140607052338624 tpu_estimator.py:557] Init TPU system
I0814 22:55:08.844129 140607052338624 tpu_estimator.py:566] Initialized TPU in 69 seconds
I0814 22:55:08.845469 140606018156288 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:55:08.846467 140606009763584 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:55:08.912169 140607052338624 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:55:08.949156 140607052338624 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:55:08.949496 140607052338624 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:55:09.047688 140605996386048 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:55:09.288954 140605996386048 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:55:09.698340 140606009763584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:55:10.191349 140607052338624 evaluation.py:167] Evaluation [10/10]
I0814 22:55:10.192032 140607052338624 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:55:10.192164 140607052338624 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:55:10.192370 140606018156288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:55:10.192532 140606018156288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:55:10.192679 140607052338624 error_handling.py:96] infeed marked as finished
I0814 22:55:10.192796 140607052338624 tpu_estimator.py:602] Stop output thread controller
I0814 22:55:10.192881 140607052338624 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:55:10.193016 140606009763584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:55:10.193099 140606009763584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:55:10.193217 140607052338624 error_handling.py:96] outfeed marked as finished
I0814 22:55:10.193386 140607052338624 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:55:39.383476 140607052338624 evaluation.py:275] Finished evaluation at 2019-08-14-22:55:39
I0814 22:55:39.383811 140607052338624 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9763, global_step = 30, loss = 0.10041012
I0814 22:55:43.740236 140607052338624 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:55:44.572489 140607052338624 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10041012, 'global_step': 30, 'accuracy': 0.9763}

Removing gs://yangyou-mnist/log/#1565823145048020...
Removing gs://yangyou-mnist/log/checkpoint#1565823224246546...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565823145.v3-8-tpu#1565823227561762...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565823158616651...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565823157760951...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565823163042727...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565823221023015...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565823221894901...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565823150381760...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565823226537459...
Removing gs://yangyou-mnist/log/eval/#1565823341058724...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565823341.v3-8-tpu#1565823344263217...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:55:48.465926 140703801189824 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:55:48.466717 140703801189824 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:55:48.469336 140703801189824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:55:48.470139 140703801189824 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:55:48.470880 140703801189824 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:55:48.471007 140703801189824 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:55:48.882090 140703801189824 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:55:48.889791 140703801189824 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:55:48.894145 140703801189824 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:55:48.951025 140703801189824 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:55:48.951304 140703801189824 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:55:49.395793 140703801189824 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:55:49.446435 140703801189824 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:55:49.446733 140703801189824 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:55:49.598947 140703801189824 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff8023ff1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff8045de210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:55:49.599358 140703801189824 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:55:49.918282 140703801189824 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:55:49.921359: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:55:49.936031 140703801189824 tpu_system_metadata.py:148] Found TPU system:
I0814 22:55:49.936291 140703801189824 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:55:49.936857 140703801189824 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:55:49.936923 140703801189824 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:55:49.936976 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:55:49.937263 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:55:49.937319 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:55:49.937375 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:55:49.937426 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:55:49.937499 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:55:49.937546 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:55:49.937599 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:55:49.937645 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:55:49.937691 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:55:49.937738 140703801189824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:55:49.943726 140703801189824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:55:49.956604 140703801189824 estimator.py:1145] Calling model_fn.
W0814 22:55:49.957237 140703801189824 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:55:50.223053 140703801189824 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:55:50.687802 140703801189824 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:55:50.750988 140703801189824 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:55:50.756949 140703801189824 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:55:50.939662 140703801189824 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:55:50.953936 140703801189824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:55:50.966461 140703801189824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:55:50.967540 140703801189824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:55:50.974854 140703801189824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:55:50.980171 140703801189824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:55:50.980376 140703801189824 optimization.py:36] ++++++ warmup starts at step 0, for 13 steps ++++++
W0814 22:55:50.992958 140703801189824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:55:51.105459 140703801189824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:55:51.148140 140703801189824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:55:51.193770 140703801189824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:55:51.246618 140703801189824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:55:51.408849 140703801189824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:55:51.461488 140703801189824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:55:51.511780 140703801189824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:55:51.563621 140703801189824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:55:51.610255 140703801189824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:55:51.652292 140703801189824 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:55:51.668716 140703801189824 estimator.py:1147] Done calling model_fn.
I0814 22:55:55.032644 140703801189824 tpu_estimator.py:499] TPU job name worker
I0814 22:55:55.147785 140703801189824 monitored_session.py:240] Graph was finalized.
I0814 22:55:55.812612 140703801189824 session_manager.py:500] Running local_init_op.
I0814 22:55:55.864208 140703801189824 session_manager.py:502] Done running local_init_op.
I0814 22:55:58.571728 140703801189824 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:56:11.225025 140703801189824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:56:11.384900 140703801189824 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:56:11.385303 140703801189824 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:56:11.385674: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:56:11.391345 140703801189824 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:56:11.393450 140703801189824 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:56:11.398015 140703801189824 tpu_estimator.py:557] Init TPU system
I0814 22:56:52.095096 140703801189824 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 22:56:52.096014 140702904997632 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:56:52.096519 140702896604928 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:56:52.165937 140703801189824 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 22:56:52.166793 140703801189824 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 22:56:52.228697 140702888212224 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:56:52.606295 140702888212224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:56:56.983925 140702896604928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:57:01.600647 140703801189824 basic_session_run_hooks.py:262] loss = 0.095557705, step = 30
I0814 22:57:01.603864 140703801189824 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 22:57:15.664211 140703801189824 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:57:15.664572 140703801189824 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:57:15.664771 140702904997632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:57:15.664866 140702904997632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:57:15.665004 140703801189824 error_handling.py:96] infeed marked as finished
I0814 22:57:15.665102 140703801189824 tpu_estimator.py:602] Stop output thread controller
I0814 22:57:15.665160 140703801189824 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:57:15.665280 140702896604928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:57:15.665350 140702896604928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:57:15.665463 140703801189824 error_handling.py:96] outfeed marked as finished
I0814 22:57:15.665544 140703801189824 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:57:22.741076 140703801189824 estimator.py:368] Loss for final step: 0.095557705.
I0814 22:57:22.741869 140703801189824 error_handling.py:96] training_loop marked as finished
I0814 22:57:23.440804 140703801189824 estimator.py:1145] Calling model_fn.
E0814 22:57:24.143183 140703801189824 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:57:24.378737 140703801189824 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 22:57:24.400504 140703801189824 estimator.py:1147] Done calling model_fn.
I0814 22:57:24.418168 140703801189824 evaluation.py:255] Starting evaluation at 2019-08-14T22:57:24Z
I0814 22:57:24.418397 140703801189824 tpu_estimator.py:499] TPU job name worker
I0814 22:57:24.497109 140703801189824 monitored_session.py:240] Graph was finalized.
W0814 22:57:24.497848 140703801189824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 22:57:24.694987 140703801189824 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 22:57:27.366183 140703801189824 session_manager.py:500] Running local_init_op.
I0814 22:57:27.394061 140703801189824 session_manager.py:502] Done running local_init_op.
I0814 22:57:27.441149 140703801189824 tpu_estimator.py:557] Init TPU system
I0814 22:58:36.066056 140703801189824 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 22:58:36.066904 140702901327616 tpu_estimator.py:514] Starting infeed thread controller.
I0814 22:58:36.067389 140702892934912 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 22:58:36.133275 140703801189824 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:58:36.165698 140703801189824 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 22:58:36.166110 140703801189824 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 22:58:36.263724 140702879557376 transport.py:157] Attempting refresh to obtain initial access_token
W0814 22:58:36.558113 140702879557376 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 22:58:36.973356 140702892934912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 22:58:37.443701 140703801189824 evaluation.py:167] Evaluation [10/10]
I0814 22:58:37.444123 140703801189824 tpu_estimator.py:598] Stop infeed thread controller
I0814 22:58:37.444225 140703801189824 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 22:58:37.444464 140702901327616 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 22:58:37.444578 140702901327616 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 22:58:37.444717 140703801189824 error_handling.py:96] infeed marked as finished
I0814 22:58:37.444819 140703801189824 tpu_estimator.py:602] Stop output thread controller
I0814 22:58:37.444869 140703801189824 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 22:58:37.444986 140702892934912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 22:58:37.445060 140702892934912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 22:58:37.445173 140703801189824 error_handling.py:96] outfeed marked as finished
I0814 22:58:37.445259 140703801189824 tpu_estimator.py:606] Shutdown TPU system.
I0814 22:59:06.655812 140703801189824 evaluation.py:275] Finished evaluation at 2019-08-14-22:59:06
I0814 22:59:06.656128 140703801189824 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9748, global_step = 30, loss = 0.08368221
I0814 22:59:11.164707 140703801189824 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 22:59:12.014781 140703801189824 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08368221, 'global_step': 30, 'accuracy': 0.9748}

Removing gs://yangyou-mnist/log/#1565823353177328...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565823365922598...
Removing gs://yangyou-mnist/log/checkpoint#1565823432075707...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565823370714963...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565823353.v3-8-tpu#1565823435345739...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565823357992792...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565823429826253...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565823364953769...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565823428920349...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565823434337310...
Removing gs://yangyou-mnist/log/eval/#1565823548358489...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565823548.v3-8-tpu#1565823551702792...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 22:59:15.827780 140221163550144 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 22:59:15.828665 140221163550144 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 22:59:15.831389 140221163550144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 22:59:15.832190 140221163550144 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 22:59:15.832957 140221163550144 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 22:59:15.833106 140221163550144 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 22:59:16.264997 140221163550144 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 22:59:16.274152 140221163550144 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 22:59:16.278835 140221163550144 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:59:16.399240 140221163550144 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:59:16.399528 140221163550144 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:59:16.737109 140221163550144 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 22:59:16.794646 140221163550144 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 22:59:16.794958 140221163550144 transport.py:157] Attempting refresh to obtain initial access_token
I0814 22:59:17.185691 140221163550144 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f87a2ce0210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f87a4ebf210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 22:59:17.186058 140221163550144 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 22:59:17.556328 140221163550144 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 22:59:17.559652: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:59:17.575411 140221163550144 tpu_system_metadata.py:148] Found TPU system:
I0814 22:59:17.575664 140221163550144 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 22:59:17.576247 140221163550144 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 22:59:17.576320 140221163550144 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 22:59:17.576375 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 22:59:17.576734 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 22:59:17.576795 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 22:59:17.576847 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 22:59:17.576895 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 22:59:17.576944 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 22:59:17.576992 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 22:59:17.577038 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 22:59:17.577083 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 22:59:17.577128 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 22:59:17.577176 140221163550144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 22:59:17.583580 140221163550144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 22:59:17.596877 140221163550144 estimator.py:1145] Calling model_fn.
W0814 22:59:17.597536 140221163550144 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 22:59:17.879450 140221163550144 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 22:59:18.308273 140221163550144 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 22:59:18.372148 140221163550144 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 22:59:18.378412 140221163550144 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 22:59:18.579713 140221163550144 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 22:59:18.595422 140221163550144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 22:59:18.609612 140221163550144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 22:59:18.610903 140221163550144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 22:59:18.618769 140221163550144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 22:59:18.624634 140221163550144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 22:59:18.624872 140221163550144 optimization.py:36] ++++++ warmup starts at step 0, for 13 steps ++++++
W0814 22:59:18.640062 140221163550144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 22:59:18.765608 140221163550144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 22:59:18.811638 140221163550144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:59:18.859555 140221163550144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:59:18.913614 140221163550144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:59:19.085191 140221163550144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:59:19.138003 140221163550144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:59:19.189593 140221163550144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:59:19.244122 140221163550144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:59:19.292509 140221163550144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 22:59:19.339159 140221163550144 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 22:59:19.356280 140221163550144 estimator.py:1147] Done calling model_fn.
I0814 22:59:22.872756 140221163550144 tpu_estimator.py:499] TPU job name worker
I0814 22:59:22.987113 140221163550144 monitored_session.py:240] Graph was finalized.
I0814 22:59:23.704720 140221163550144 session_manager.py:500] Running local_init_op.
I0814 22:59:23.764448 140221163550144 session_manager.py:502] Done running local_init_op.
I0814 22:59:26.563215 140221163550144 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 22:59:39.851139 140221163550144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 22:59:40.013804 140221163550144 util.py:98] Initialized dataset iterators in 0 seconds
I0814 22:59:40.014241 140221163550144 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 22:59:40.014755: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 22:59:40.020668 140221163550144 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 22:59:40.022891 140221163550144 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 22:59:40.027110 140221163550144 tpu_estimator.py:557] Init TPU system
I0814 23:00:20.105138 140221163550144 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 23:00:20.106115 140220263552768 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:00:20.106584 140220255160064 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:00:20.175573 140221163550144 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:00:20.176522 140221163550144 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:00:20.207155 140220246767360 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:00:20.429766 140220246767360 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:00:24.954204 140220255160064 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:00:29.908042 140221163550144 basic_session_run_hooks.py:262] loss = 0.11267722, step = 30
I0814 23:00:29.910875 140221163550144 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:00:43.742963 140221163550144 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:00:43.743262 140221163550144 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:00:43.743516 140220263552768 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:00:43.743633 140220263552768 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:00:43.743772 140221163550144 error_handling.py:96] infeed marked as finished
I0814 23:00:43.743864 140221163550144 tpu_estimator.py:602] Stop output thread controller
I0814 23:00:43.743912 140221163550144 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:00:43.744021 140220255160064 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:00:43.744093 140220255160064 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:00:43.744203 140221163550144 error_handling.py:96] outfeed marked as finished
I0814 23:00:43.744288 140221163550144 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:00:50.571939 140221163550144 estimator.py:368] Loss for final step: 0.11267722.
I0814 23:00:50.572730 140221163550144 error_handling.py:96] training_loop marked as finished
I0814 23:00:51.317662 140221163550144 estimator.py:1145] Calling model_fn.
E0814 23:00:52.112366 140221163550144 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:00:52.348344 140221163550144 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:00:52.371645 140221163550144 estimator.py:1147] Done calling model_fn.
I0814 23:00:52.389503 140221163550144 evaluation.py:255] Starting evaluation at 2019-08-14T23:00:52Z
I0814 23:00:52.389750 140221163550144 tpu_estimator.py:499] TPU job name worker
I0814 23:00:52.470300 140221163550144 monitored_session.py:240] Graph was finalized.
W0814 23:00:52.471055 140221163550144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:00:52.691785 140221163550144 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:00:55.335740 140221163550144 session_manager.py:500] Running local_init_op.
I0814 23:00:55.365556 140221163550144 session_manager.py:502] Done running local_init_op.
I0814 23:00:55.425602 140221163550144 tpu_estimator.py:557] Init TPU system
I0814 23:02:04.051497 140221163550144 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:02:04.052439 140220263290624 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:02:04.052794 140220254897920 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:02:04.124188 140221163550144 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:02:04.154915 140221163550144 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:02:04.155282 140221163550144 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:02:04.260292 140220246505216 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:02:04.599922 140220246505216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:02:04.971373 140220254897920 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:02:05.279268 140221163550144 evaluation.py:167] Evaluation [10/10]
I0814 23:02:05.279583 140221163550144 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:02:05.279654 140221163550144 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:02:05.279824 140220263290624 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:02:05.279927 140220263290624 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:02:05.280057 140221163550144 error_handling.py:96] infeed marked as finished
I0814 23:02:05.280155 140221163550144 tpu_estimator.py:602] Stop output thread controller
I0814 23:02:05.280213 140221163550144 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:02:05.280330 140220254897920 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:02:05.280442 140220254897920 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:02:05.280586 140221163550144 error_handling.py:96] outfeed marked as finished
I0814 23:02:05.280675 140221163550144 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:02:34.691421 140221163550144 evaluation.py:275] Finished evaluation at 2019-08-14-23:02:34
I0814 23:02:34.691740 140221163550144 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9749, global_step = 30, loss = 0.08877613
I0814 23:02:39.092299 140221163550144 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:02:39.959109 140221163550144 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08877613, 'global_step': 30, 'accuracy': 0.9749}

Removing gs://yangyou-mnist/log/#1565823560906823...
Removing gs://yangyou-mnist/log/checkpoint#1565823640092538...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565823574828001...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565823561.v3-8-tpu#1565823643431762...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565823565980857...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565823579334829...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565823637055834...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565823637982791...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565823573636834...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565823642320274...
Removing gs://yangyou-mnist/log/eval/#1565823756454838...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565823756.v3-8-tpu#1565823759650332...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:02:43.773384 139881199642048 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:02:43.774161 139881199642048 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:02:43.776782 139881199642048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:02:43.777615 139881199642048 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:02:43.778198 139881199642048 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:02:43.778327 139881199642048 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:02:44.187663 139881199642048 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:02:44.195594 139881199642048 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:02:44.199716 139881199642048 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:02:44.323575 139881199642048 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:02:44.323844 139881199642048 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:02:44.585468 139881199642048 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:02:44.640218 139881199642048 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:02:44.640571 139881199642048 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:02:44.882422 139881199642048 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f387b607210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f387d7e61d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:02:44.882767 139881199642048 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:02:45.240329 139881199642048 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:02:45.243354: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:02:45.257424 139881199642048 tpu_system_metadata.py:148] Found TPU system:
I0814 23:02:45.257667 139881199642048 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:02:45.258131 139881199642048 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:02:45.258188 139881199642048 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:02:45.258240 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:02:45.258529 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:02:45.258589 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:02:45.258641 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:02:45.258690 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:02:45.258738 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:02:45.258830 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:02:45.258924 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:02:45.258972 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:02:45.259018 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:02:45.259066 139881199642048 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:02:45.265189 139881199642048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:02:45.278014 139881199642048 estimator.py:1145] Calling model_fn.
W0814 23:02:45.278619 139881199642048 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:02:45.542465 139881199642048 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:02:45.959389 139881199642048 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:02:46.021642 139881199642048 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:02:46.027650 139881199642048 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:02:46.214257 139881199642048 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:02:46.228215 139881199642048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:02:46.240300 139881199642048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:02:46.241416 139881199642048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:02:46.248595 139881199642048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:02:46.254173 139881199642048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:02:46.254404 139881199642048 optimization.py:36] ++++++ warmup starts at step 0, for 13 steps ++++++
W0814 23:02:46.267182 139881199642048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:02:46.377315 139881199642048 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:02:46.419095 139881199642048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:02:46.465027 139881199642048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:02:46.517101 139881199642048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:02:46.677655 139881199642048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:02:46.728302 139881199642048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:02:46.778168 139881199642048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:02:46.828217 139881199642048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:02:46.874512 139881199642048 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:02:46.916837 139881199642048 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:02:46.933459 139881199642048 estimator.py:1147] Done calling model_fn.
I0814 23:02:50.533479 139881199642048 tpu_estimator.py:499] TPU job name worker
I0814 23:02:50.645847 139881199642048 monitored_session.py:240] Graph was finalized.
I0814 23:02:51.314649 139881199642048 session_manager.py:500] Running local_init_op.
I0814 23:02:51.376676 139881199642048 session_manager.py:502] Done running local_init_op.
I0814 23:02:54.543179 139881199642048 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:03:07.133560 139881199642048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:03:07.278480 139881199642048 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:03:07.279035 139881199642048 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:03:07.279422: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:03:07.284122 139881199642048 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:03:07.286271 139881199642048 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:03:07.290900 139881199642048 tpu_estimator.py:557] Init TPU system
I0814 23:03:48.119115 139881199642048 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 23:03:48.120189 139880164222720 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:03:48.120769 139880155830016 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:03:48.186575 139881199642048 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:03:48.187470 139881199642048 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:03:48.309829 139880147437312 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:03:48.541136 139880147437312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 23:03:53.035602 139880155830016 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:03:57.892613 139881199642048 basic_session_run_hooks.py:262] loss = 0.082998805, step = 30
I0814 23:03:57.896594 139881199642048 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:04:11.401176 139881199642048 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:04:11.401484 139881199642048 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:04:11.401734 139880164222720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:04:11.401853 139880164222720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:04:11.401992 139881199642048 error_handling.py:96] infeed marked as finished
I0814 23:04:11.402097 139881199642048 tpu_estimator.py:602] Stop output thread controller
I0814 23:04:11.402167 139881199642048 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:04:11.402281 139880155830016 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:04:11.402357 139880155830016 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:04:11.402467 139881199642048 error_handling.py:96] outfeed marked as finished
I0814 23:04:11.402548 139881199642048 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:04:18.664629 139881199642048 estimator.py:368] Loss for final step: 0.082998805.
I0814 23:04:18.665405 139881199642048 error_handling.py:96] training_loop marked as finished
I0814 23:04:19.492770 139881199642048 estimator.py:1145] Calling model_fn.
E0814 23:04:20.292465 139881199642048 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:04:20.521878 139881199642048 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:04:20.543086 139881199642048 estimator.py:1147] Done calling model_fn.
I0814 23:04:20.560138 139881199642048 evaluation.py:255] Starting evaluation at 2019-08-14T23:04:20Z
I0814 23:04:20.560395 139881199642048 tpu_estimator.py:499] TPU job name worker
I0814 23:04:20.639703 139881199642048 monitored_session.py:240] Graph was finalized.
W0814 23:04:20.640460 139881199642048 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:04:20.848762 139881199642048 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:04:23.600259 139881199642048 session_manager.py:500] Running local_init_op.
I0814 23:04:23.626091 139881199642048 session_manager.py:502] Done running local_init_op.
I0814 23:04:23.680541 139881199642048 tpu_estimator.py:557] Init TPU system
I0814 23:05:32.048048 139881199642048 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:05:32.048949 139880164222720 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:05:32.050005 139880155830016 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:05:32.121012 139881199642048 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:05:32.148550 139881199642048 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:05:32.148905 139881199642048 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:05:32.183487 139880147437312 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:05:32.574600 139880147437312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:05:32.938739 139880155830016 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:05:33.369863 139881199642048 evaluation.py:167] Evaluation [10/10]
I0814 23:05:33.370213 139881199642048 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:05:33.370316 139881199642048 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:05:33.370491 139880164222720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:05:33.370625 139880164222720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:05:33.370785 139881199642048 error_handling.py:96] infeed marked as finished
I0814 23:05:33.370893 139881199642048 tpu_estimator.py:602] Stop output thread controller
I0814 23:05:33.370956 139881199642048 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:05:33.371077 139880155830016 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:05:33.371151 139880155830016 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:05:33.371295 139881199642048 error_handling.py:96] outfeed marked as finished
I0814 23:05:33.371400 139881199642048 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:06:02.671792 139881199642048 evaluation.py:275] Finished evaluation at 2019-08-14-23:06:02
I0814 23:06:02.672118 139881199642048 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9768, global_step = 30, loss = 0.07078959
I0814 23:06:07.207128 139881199642048 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:06:08.041836 139881199642048 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07078959, 'global_step': 30, 'accuracy': 0.9768}

Removing gs://yangyou-mnist/log/#1565823768557987...
Removing gs://yangyou-mnist/log/checkpoint#1565823847906702...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565823844865970...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565823781982011...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565823768.v3-8-tpu#1565823851095229...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565823786622968...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565823773963229...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565823845730854...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565823781017155...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565823850144965...
Removing gs://yangyou-mnist/log/eval/#1565823964341778...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565823964.v3-8-tpu#1565823967732933...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:06:11.922650 140449024902592 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:06:11.923453 140449024902592 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:06:11.926111 140449024902592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:06:11.926951 140449024902592 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:06:11.927530 140449024902592 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:06:11.927663 140449024902592 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:06:12.338238 140449024902592 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:06:12.344732 140449024902592 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:06:12.348578 140449024902592 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:06:12.470427 140449024902592 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:06:12.470716 140449024902592 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:06:12.626498 140449024902592 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:06:12.745501 140449024902592 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:06:12.745795 140449024902592 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:06:12.959753 140449024902592 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fbcb0665190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fbcb2844210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:06:12.960097 140449024902592 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:06:13.292881 140449024902592 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:06:13.295706: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:06:13.309518 140449024902592 tpu_system_metadata.py:148] Found TPU system:
I0814 23:06:13.309779 140449024902592 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:06:13.310322 140449024902592 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:06:13.310388 140449024902592 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:06:13.310453 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:06:13.310797 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:06:13.310870 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:06:13.310946 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:06:13.311002 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:06:13.311055 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:06:13.311108 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:06:13.311162 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:06:13.311214 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:06:13.311268 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:06:13.311321 140449024902592 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:06:13.318167 140449024902592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:06:13.332185 140449024902592 estimator.py:1145] Calling model_fn.
W0814 23:06:13.332921 140449024902592 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:06:13.613411 140449024902592 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:06:14.029444 140449024902592 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:06:14.094085 140449024902592 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:06:14.099955 140449024902592 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:06:14.284929 140449024902592 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:06:14.298794 140449024902592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:06:14.311177 140449024902592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:06:14.312304 140449024902592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:06:14.319683 140449024902592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:06:14.324982 140449024902592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:06:14.325215 140449024902592 optimization.py:36] ++++++ warmup starts at step 0, for 13 steps ++++++
W0814 23:06:14.337641 140449024902592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:06:14.452080 140449024902592 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:06:14.495080 140449024902592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:06:14.541450 140449024902592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:06:14.594383 140449024902592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:06:14.757344 140449024902592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:06:14.808667 140449024902592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:06:14.857028 140449024902592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:06:14.907252 140449024902592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:06:14.952691 140449024902592 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:06:14.993819 140449024902592 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:06:15.010214 140449024902592 estimator.py:1147] Done calling model_fn.
I0814 23:06:18.637061 140449024902592 tpu_estimator.py:499] TPU job name worker
I0814 23:06:18.749340 140449024902592 monitored_session.py:240] Graph was finalized.
I0814 23:06:19.407485 140449024902592 session_manager.py:500] Running local_init_op.
I0814 23:06:19.469297 140449024902592 session_manager.py:502] Done running local_init_op.
I0814 23:06:22.156630 140449024902592 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:06:34.930078 140449024902592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:06:35.090514 140449024902592 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:06:35.090979 140449024902592 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:06:35.091359: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:06:35.096899 140449024902592 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:06:35.098937 140449024902592 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:06:35.103696 140449024902592 tpu_estimator.py:557] Init TPU system
I0814 23:07:16.076770 140449024902592 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 23:07:16.077716 140448330131200 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:07:16.078455 140447846496000 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:07:16.141452 140447838103296 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:07:16.149637 140449024902592 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:07:16.150582 140449024902592 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 23:07:16.378288 140447838103296 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:07:21.018640 140447846496000 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:07:25.821099 140449024902592 basic_session_run_hooks.py:262] loss = 0.0765563, step = 30
I0814 23:07:25.823962 140449024902592 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:07:40.289273 140449024902592 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:07:40.289598 140449024902592 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:07:40.291351 140448330131200 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:07:40.291635 140448330131200 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:07:40.291858 140449024902592 error_handling.py:96] infeed marked as finished
I0814 23:07:40.292202 140449024902592 tpu_estimator.py:602] Stop output thread controller
I0814 23:07:40.292279 140449024902592 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:07:40.292495 140447846496000 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:07:40.292704 140447846496000 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:07:40.292889 140449024902592 error_handling.py:96] outfeed marked as finished
I0814 23:07:40.293055 140449024902592 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:07:46.502717 140449024902592 estimator.py:368] Loss for final step: 0.0765563.
I0814 23:07:46.503592 140449024902592 error_handling.py:96] training_loop marked as finished
I0814 23:07:47.320771 140449024902592 estimator.py:1145] Calling model_fn.
E0814 23:07:48.027918 140449024902592 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:07:48.247209 140449024902592 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:07:48.269279 140449024902592 estimator.py:1147] Done calling model_fn.
I0814 23:07:48.286072 140449024902592 evaluation.py:255] Starting evaluation at 2019-08-14T23:07:48Z
I0814 23:07:48.286318 140449024902592 tpu_estimator.py:499] TPU job name worker
I0814 23:07:48.362067 140449024902592 monitored_session.py:240] Graph was finalized.
W0814 23:07:48.362807 140449024902592 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:07:48.567059 140449024902592 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:07:51.494199 140449024902592 session_manager.py:500] Running local_init_op.
I0814 23:07:51.520256 140449024902592 session_manager.py:502] Done running local_init_op.
I0814 23:07:51.578140 140449024902592 tpu_estimator.py:557] Init TPU system
I0814 23:09:00.025837 140449024902592 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:09:00.027014 140447846496000 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:09:00.027739 140447838103296 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:09:00.095331 140449024902592 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:09:00.127535 140449024902592 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:09:00.127906 140449024902592 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:09:00.174958 140447829710592 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:09:00.452193 140447829710592 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:09:00.878607 140447838103296 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:09:01.397093 140449024902592 evaluation.py:167] Evaluation [10/10]
I0814 23:09:01.397453 140449024902592 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:09:01.397525 140449024902592 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:09:01.397723 140447846496000 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:09:01.397788 140447846496000 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:09:01.398026 140449024902592 error_handling.py:96] infeed marked as finished
I0814 23:09:01.398423 140449024902592 tpu_estimator.py:602] Stop output thread controller
I0814 23:09:01.398485 140449024902592 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:09:01.398658 140447838103296 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:09:01.398818 140447838103296 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:09:01.399025 140449024902592 error_handling.py:96] outfeed marked as finished
I0814 23:09:01.399240 140449024902592 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:09:30.548518 140449024902592 evaluation.py:275] Finished evaluation at 2019-08-14-23:09:30
I0814 23:09:30.548901 140449024902592 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9796, global_step = 30, loss = 0.05654701
I0814 23:09:35.354510 140449024902592 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:09:36.165313 140449024902592 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.05654701, 'global_step': 30, 'accuracy': 0.9796}

Removing gs://yangyou-mnist/log/#1565823976625243...
Removing gs://yangyou-mnist/log/checkpoint#1565824056691438...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565823976.v3-8-tpu#1565824059975576...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565823989734738...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565823981597226...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565824053322369...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565823988832373...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565823994422225...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565824054237416...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565824058984923...
Removing gs://yangyou-mnist/log/eval/#1565824172337862...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565824172.v3-8-tpu#1565824175859543...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:09:40.032210 140615907149248 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:09:40.033154 140615907149248 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:09:40.035763 140615907149248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:09:40.036669 140615907149248 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:09:40.037288 140615907149248 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:09:40.037420 140615907149248 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:09:40.450862 140615907149248 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:09:40.457535 140615907149248 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:09:40.465229 140615907149248 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:09:40.518944 140615907149248 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:09:40.519229 140615907149248 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:09:40.836065 140615907149248 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:09:40.892092 140615907149248 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:09:40.892368 140615907149248 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:09:41.214016 140615907149248 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe38b59e450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe38d794210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:09:41.214401 140615907149248 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:09:41.543575 140615907149248 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:09:41.546694: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:09:41.562679 140615907149248 tpu_system_metadata.py:148] Found TPU system:
I0814 23:09:41.562922 140615907149248 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:09:41.563396 140615907149248 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:09:41.563453 140615907149248 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:09:41.563513 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:09:41.563817 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:09:41.563874 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:09:41.563927 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:09:41.563977 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:09:41.564023 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:09:41.564070 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:09:41.564129 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:09:41.564176 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:09:41.564222 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:09:41.564270 140615907149248 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:09:41.570863 140615907149248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:09:41.584001 140615907149248 estimator.py:1145] Calling model_fn.
W0814 23:09:41.584681 140615907149248 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:09:41.886126 140615907149248 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:09:42.324029 140615907149248 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:09:42.388314 140615907149248 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:09:42.394685 140615907149248 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:09:42.586601 140615907149248 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:09:42.600872 140615907149248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:09:42.613121 140615907149248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:09:42.614200 140615907149248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:09:42.621486 140615907149248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:09:42.626950 140615907149248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:09:42.627190 140615907149248 optimization.py:36] ++++++ warmup starts at step 0, for 13 steps ++++++
W0814 23:09:42.640501 140615907149248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:09:42.754816 140615907149248 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:09:42.797873 140615907149248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:09:42.843996 140615907149248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:09:42.897234 140615907149248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:09:43.060199 140615907149248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:09:43.113883 140615907149248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:09:43.164587 140615907149248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:09:43.217659 140615907149248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:09:43.266299 140615907149248 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:09:43.311692 140615907149248 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:09:43.328651 140615907149248 estimator.py:1147] Done calling model_fn.
I0814 23:09:46.985023 140615907149248 tpu_estimator.py:499] TPU job name worker
I0814 23:09:47.101193 140615907149248 monitored_session.py:240] Graph was finalized.
I0814 23:09:47.805556 140615907149248 session_manager.py:500] Running local_init_op.
I0814 23:09:47.860135 140615907149248 session_manager.py:502] Done running local_init_op.
I0814 23:09:50.767972 140615907149248 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:10:03.433717 140615907149248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:10:03.598198 140615907149248 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:10:03.598613 140615907149248 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:10:03.599121: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:10:03.604549 140615907149248 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:10:03.606750 140615907149248 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:10:03.610761 140615907149248 tpu_estimator.py:557] Init TPU system
I0814 23:10:44.085387 140615907149248 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 23:10:44.086642 140615006283520 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:10:44.087343 140614997890816 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:10:44.156960 140615907149248 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:10:44.157773 140615907149248 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:10:44.218013 140614989498112 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:10:44.567694 140614989498112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 23:10:48.957118 140614997890816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:10:53.660742 140615907149248 basic_session_run_hooks.py:262] loss = 0.08429571, step = 30
I0814 23:10:53.663053 140615907149248 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:11:07.614422 140615907149248 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:11:07.614748 140615907149248 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:11:07.616641 140615006283520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:11:07.616908 140615006283520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:11:07.617082 140615907149248 error_handling.py:96] infeed marked as finished
I0814 23:11:07.617207 140615907149248 tpu_estimator.py:602] Stop output thread controller
I0814 23:11:07.617299 140615907149248 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:11:07.617475 140614997890816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:11:07.617604 140614997890816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:11:07.617763 140615907149248 error_handling.py:96] outfeed marked as finished
I0814 23:11:07.617861 140615907149248 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:11:14.709548 140615907149248 estimator.py:368] Loss for final step: 0.08429571.
I0814 23:11:14.710481 140615907149248 error_handling.py:96] training_loop marked as finished
I0814 23:11:15.536437 140615907149248 estimator.py:1145] Calling model_fn.
E0814 23:11:16.260528 140615907149248 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:11:16.487612 140615907149248 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:11:16.508968 140615907149248 estimator.py:1147] Done calling model_fn.
I0814 23:11:16.526793 140615907149248 evaluation.py:255] Starting evaluation at 2019-08-14T23:11:16Z
I0814 23:11:16.527036 140615907149248 tpu_estimator.py:499] TPU job name worker
I0814 23:11:16.606210 140615907149248 monitored_session.py:240] Graph was finalized.
W0814 23:11:16.606930 140615907149248 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:11:16.810733 140615907149248 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:11:19.659559 140615907149248 session_manager.py:500] Running local_init_op.
I0814 23:11:19.686045 140615907149248 session_manager.py:502] Done running local_init_op.
I0814 23:11:19.733424 140615907149248 tpu_estimator.py:557] Init TPU system
I0814 23:12:28.029356 140615907149248 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:12:28.030329 140615006283520 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:12:28.031383 140614997890816 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:12:28.099584 140615907149248 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:12:28.131135 140615907149248 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:12:28.131483 140615907149248 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:12:28.228943 140614989498112 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:12:28.470730 140614989498112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:12:28.889475 140614997890816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:12:29.359306 140615907149248 evaluation.py:167] Evaluation [10/10]
I0814 23:12:29.359767 140615907149248 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:12:29.359869 140615907149248 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:12:29.360091 140615006283520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:12:29.360198 140615006283520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:12:29.360343 140615907149248 error_handling.py:96] infeed marked as finished
I0814 23:12:29.360500 140615907149248 tpu_estimator.py:602] Stop output thread controller
I0814 23:12:29.360565 140615907149248 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:12:29.360690 140614997890816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:12:29.360811 140614997890816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:12:29.360941 140615907149248 error_handling.py:96] outfeed marked as finished
I0814 23:12:29.361032 140615907149248 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:12:58.565943 140615907149248 evaluation.py:275] Finished evaluation at 2019-08-14-23:12:58
I0814 23:12:58.566282 140615907149248 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9775, global_step = 30, loss = 0.064234294
I0814 23:13:03.198077 140615907149248 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:13:04.114335 140615907149248 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.064234294, 'global_step': 30, 'accuracy': 0.9775}

Removing gs://yangyou-mnist/log/#1565824184952825...
Removing gs://yangyou-mnist/log/checkpoint#1565824264072285...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565824185.v3-8-tpu#1565824267308804...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565824260827808...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565824190179405...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565824202912434...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565824261728135...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565824198026210...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565824197100240...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565824266342844...
Removing gs://yangyou-mnist/log/eval/#1565824380310545...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565824380.v3-8-tpu#1565824383794625...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:13:07.956788 139840118846912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:13:07.957575 139840118846912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:13:07.960206 139840118846912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:13:07.961232 139840118846912 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:13:07.961839 139840118846912 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:13:07.961982 139840118846912 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:13:08.378482 139840118846912 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:13:08.386192 139840118846912 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:13:08.390533 139840118846912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:13:08.447376 139840118846912 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:13:08.447647 139840118846912 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:13:08.617552 139840118846912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:13:08.673959 139840118846912 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:13:08.674268 139840118846912 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:13:08.971750 139840118846912 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2eeac541d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2eece33210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:13:08.972224 139840118846912 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:13:09.311799 139840118846912 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:13:09.314728: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:13:09.327539 139840118846912 tpu_system_metadata.py:148] Found TPU system:
I0814 23:13:09.327790 139840118846912 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:13:09.328284 139840118846912 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:13:09.328341 139840118846912 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:13:09.328392 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:13:09.328763 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:13:09.328824 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:13:09.328875 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:13:09.328927 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:13:09.328974 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:13:09.329021 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:13:09.329067 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:13:09.329123 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:13:09.329170 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:13:09.329236 139840118846912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:13:09.335050 139840118846912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:13:09.347645 139840118846912 estimator.py:1145] Calling model_fn.
W0814 23:13:09.348262 139840118846912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:13:09.622086 139840118846912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:13:10.029781 139840118846912 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:13:10.094762 139840118846912 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:13:10.100903 139840118846912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:13:10.312311 139840118846912 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:13:10.326478 139840118846912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:13:10.338922 139840118846912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:13:10.340013 139840118846912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:13:10.347183 139840118846912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:13:10.352593 139840118846912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:13:10.352824 139840118846912 optimization.py:36] ++++++ warmup starts at step 0, for 13 steps ++++++
W0814 23:13:10.365354 139840118846912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:13:10.478230 139840118846912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:13:10.519953 139840118846912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:13:10.564491 139840118846912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:13:10.616038 139840118846912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:13:10.775898 139840118846912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:13:10.825999 139840118846912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:13:10.875216 139840118846912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:13:10.925177 139840118846912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:13:10.971141 139840118846912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:13:11.013524 139840118846912 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:13:11.030452 139840118846912 estimator.py:1147] Done calling model_fn.
I0814 23:13:14.477627 139840118846912 tpu_estimator.py:499] TPU job name worker
I0814 23:13:14.589178 139840118846912 monitored_session.py:240] Graph was finalized.
I0814 23:13:15.271843 139840118846912 session_manager.py:500] Running local_init_op.
I0814 23:13:15.324562 139840118846912 session_manager.py:502] Done running local_init_op.
I0814 23:13:18.140805 139840118846912 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:13:30.505779 139840118846912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:13:30.650115 139840118846912 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:13:30.650568 139840118846912 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:13:30.651040: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:13:30.656151 139840118846912 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:13:30.658483 139840118846912 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:13:30.662616 139840118846912 tpu_estimator.py:557] Init TPU system
I0814 23:14:12.122174 139840118846912 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 23:14:12.123073 139839219422976 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:14:12.123759 139839211030272 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:14:12.191735 139840118846912 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:14:12.192645 139840118846912 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:14:12.250974 139839202637568 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:14:12.521231 139839202637568 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:14:17.040477 139839211030272 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:14:22.016230 139840118846912 basic_session_run_hooks.py:262] loss = 0.08663972, step = 30
I0814 23:14:22.019303 139840118846912 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:14:35.443830 139840118846912 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:14:35.444128 139840118846912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:14:35.444329 139839219422976 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:14:35.444503 139839219422976 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:14:35.444674 139840118846912 error_handling.py:96] infeed marked as finished
I0814 23:14:35.444773 139840118846912 tpu_estimator.py:602] Stop output thread controller
I0814 23:14:35.444823 139840118846912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:14:35.444936 139839211030272 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:14:35.445012 139839211030272 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:14:35.445137 139840118846912 error_handling.py:96] outfeed marked as finished
I0814 23:14:35.445225 139840118846912 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:14:42.654135 139840118846912 estimator.py:368] Loss for final step: 0.08663972.
I0814 23:14:42.654896 139840118846912 error_handling.py:96] training_loop marked as finished
I0814 23:14:43.490535 139840118846912 estimator.py:1145] Calling model_fn.
E0814 23:14:44.189474 139840118846912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:14:44.427664 139840118846912 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:14:44.450570 139840118846912 estimator.py:1147] Done calling model_fn.
I0814 23:14:44.467412 139840118846912 evaluation.py:255] Starting evaluation at 2019-08-14T23:14:44Z
I0814 23:14:44.467648 139840118846912 tpu_estimator.py:499] TPU job name worker
I0814 23:14:44.546809 139840118846912 monitored_session.py:240] Graph was finalized.
W0814 23:14:44.547538 139840118846912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:14:44.749048 139840118846912 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:14:47.612011 139840118846912 session_manager.py:500] Running local_init_op.
I0814 23:14:47.638358 139840118846912 session_manager.py:502] Done running local_init_op.
I0814 23:14:47.684674 139840118846912 tpu_estimator.py:557] Init TPU system
I0814 23:15:56.107244 139840118846912 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:15:56.108187 139839218636544 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:15:56.108670 139839210243840 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:15:56.174393 139840118846912 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:15:56.204060 139840118846912 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:15:56.204464 139840118846912 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:15:56.238801 139839201851136 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:15:56.511734 139839201851136 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:15:57.007392 139839210243840 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:15:57.286227 139840118846912 evaluation.py:167] Evaluation [10/10]
I0814 23:15:57.286556 139840118846912 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:15:57.286704 139840118846912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:15:57.286885 139839218636544 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:15:57.286981 139839218636544 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:15:57.287122 139840118846912 error_handling.py:96] infeed marked as finished
I0814 23:15:57.287214 139840118846912 tpu_estimator.py:602] Stop output thread controller
I0814 23:15:57.287281 139840118846912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:15:57.287391 139839210243840 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:15:57.287466 139839210243840 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:15:57.287659 139840118846912 error_handling.py:96] outfeed marked as finished
I0814 23:15:57.287748 139840118846912 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:16:26.587194 139840118846912 evaluation.py:275] Finished evaluation at 2019-08-14-23:16:26
I0814 23:16:26.587526 139840118846912 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9788, global_step = 30, loss = 0.070716724
I0814 23:16:31.006171 139840118846912 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:16:31.973166 139840118846912 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.070716724, 'global_step': 30, 'accuracy': 0.9788}

Removing gs://yangyou-mnist/log/#1565824392614964...
Removing gs://yangyou-mnist/log/checkpoint#1565824471983049...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565824405475542...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565824392.v3-8-tpu#1565824475137928...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565824409987973...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565824397515856...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565824468787288...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565824469706708...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565824404441368...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565824474150526...
Removing gs://yangyou-mnist/log/eval/#1565824588367863...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565824588.v3-8-tpu#1565824591679878...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:16:36.029458 139976130983360 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:16:36.030255 139976130983360 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:16:36.032939 139976130983360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:16:36.033766 139976130983360 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:16:36.034339 139976130983360 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:16:36.034470 139976130983360 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:16:36.442179 139976130983360 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:16:36.451412 139976130983360 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:16:36.455914 139976130983360 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:16:36.503724 139976130983360 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:16:36.503978 139976130983360 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:16:36.841924 139976130983360 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:16:36.899317 139976130983360 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:16:36.899585 139976130983360 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:16:37.226452 139976130983360 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4e95b9c090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4e97d7b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:16:37.226990 139976130983360 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:16:37.538079 139976130983360 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:16:37.540936: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:16:37.554282 139976130983360 tpu_system_metadata.py:148] Found TPU system:
I0814 23:16:37.554526 139976130983360 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:16:37.555054 139976130983360 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:16:37.555130 139976130983360 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:16:37.555185 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:16:37.555471 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:16:37.555546 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:16:37.555597 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:16:37.555648 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:16:37.555694 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:16:37.555742 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:16:37.555788 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:16:37.555835 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:16:37.555900 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:16:37.555962 139976130983360 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:16:37.562026 139976130983360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:16:37.574554 139976130983360 estimator.py:1145] Calling model_fn.
W0814 23:16:37.575160 139976130983360 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:16:37.864584 139976130983360 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:16:38.470515 139976130983360 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:16:38.533081 139976130983360 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:16:38.538981 139976130983360 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:16:38.721266 139976130983360 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:16:38.735330 139976130983360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:16:38.747699 139976130983360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:16:38.748780 139976130983360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:16:38.755773 139976130983360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:16:38.761178 139976130983360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:16:38.761396 139976130983360 optimization.py:36] ++++++ warmup starts at step 0, for 13 steps ++++++
W0814 23:16:38.774729 139976130983360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:16:38.886214 139976130983360 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:16:38.928853 139976130983360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:16:38.973876 139976130983360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:16:39.026554 139976130983360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:16:39.189100 139976130983360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:16:39.240268 139976130983360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:16:39.296730 139976130983360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:16:39.348490 139976130983360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:16:39.395113 139976130983360 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:16:39.437494 139976130983360 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:16:39.453994 139976130983360 estimator.py:1147] Done calling model_fn.
I0814 23:16:43.019659 139976130983360 tpu_estimator.py:499] TPU job name worker
I0814 23:16:43.131941 139976130983360 monitored_session.py:240] Graph was finalized.
I0814 23:16:43.808079 139976130983360 session_manager.py:500] Running local_init_op.
I0814 23:16:43.872208 139976130983360 session_manager.py:502] Done running local_init_op.
I0814 23:16:46.675314 139976130983360 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:16:58.810540 139976130983360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:16:58.971045 139976130983360 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:16:58.971440 139976130983360 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:16:58.971988: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:16:58.977540 139976130983360 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:16:58.979582 139976130983360 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:16:58.983786 139976130983360 tpu_estimator.py:557] Init TPU system
I0814 23:17:40.116442 139976130983360 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 23:17:40.117377 139975234668288 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:17:40.117913 139975226275584 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:17:40.187715 139976130983360 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:17:40.188710 139976130983360 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:17:40.237637 139975217882880 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:17:40.536824 139975217882880 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 23:17:44.915256 139975226275584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:17:49.609952 139976130983360 basic_session_run_hooks.py:262] loss = 0.08719758, step = 30
I0814 23:17:49.612778 139976130983360 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:18:04.182929 139976130983360 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:18:04.183222 139976130983360 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:18:04.183419 139975234668288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:18:04.183520 139975234668288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:18:04.183655 139976130983360 error_handling.py:96] infeed marked as finished
I0814 23:18:04.183763 139976130983360 tpu_estimator.py:602] Stop output thread controller
I0814 23:18:04.183813 139976130983360 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:18:04.183924 139975226275584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:18:04.183996 139975226275584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:18:04.184118 139976130983360 error_handling.py:96] outfeed marked as finished
I0814 23:18:04.184209 139976130983360 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:18:10.682168 139976130983360 estimator.py:368] Loss for final step: 0.08719758.
I0814 23:18:10.682902 139976130983360 error_handling.py:96] training_loop marked as finished
I0814 23:18:11.490047 139976130983360 estimator.py:1145] Calling model_fn.
E0814 23:18:12.207192 139976130983360 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:18:12.432648 139976130983360 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:18:12.454926 139976130983360 estimator.py:1147] Done calling model_fn.
I0814 23:18:12.471260 139976130983360 evaluation.py:255] Starting evaluation at 2019-08-14T23:18:12Z
I0814 23:18:12.471529 139976130983360 tpu_estimator.py:499] TPU job name worker
I0814 23:18:12.549484 139976130983360 monitored_session.py:240] Graph was finalized.
W0814 23:18:12.550277 139976130983360 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:18:12.760864 139976130983360 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:18:15.615562 139976130983360 session_manager.py:500] Running local_init_op.
I0814 23:18:15.641052 139976130983360 session_manager.py:502] Done running local_init_op.
I0814 23:18:15.697320 139976130983360 tpu_estimator.py:557] Init TPU system
I0814 23:19:24.044747 139976130983360 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:19:24.045773 139975230998272 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:19:24.046580 139975222605568 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:19:24.126962 139976130983360 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:19:24.155807 139976130983360 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:19:24.156223 139976130983360 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:19:24.190192 139975209228032 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:19:24.364511 139975209228032 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:19:24.964112 139975222605568 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:19:25.269551 139976130983360 evaluation.py:167] Evaluation [10/10]
I0814 23:19:25.269922 139976130983360 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:19:25.270018 139976130983360 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:19:25.270327 139975230998272 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:19:25.270632 139975230998272 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:19:25.270833 139976130983360 error_handling.py:96] infeed marked as finished
I0814 23:19:25.271008 139976130983360 tpu_estimator.py:602] Stop output thread controller
I0814 23:19:25.271068 139976130983360 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:19:25.271251 139975222605568 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:19:25.271480 139975222605568 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:19:25.271661 139976130983360 error_handling.py:96] outfeed marked as finished
I0814 23:19:25.271790 139976130983360 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:19:54.461849 139976130983360 evaluation.py:275] Finished evaluation at 2019-08-14-23:19:54
I0814 23:19:54.462229 139976130983360 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9792, global_step = 30, loss = 0.05830971
I0814 23:19:59.776211 139976130983360 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:20:00.655572 139976130983360 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.05830971, 'global_step': 30, 'accuracy': 0.9792}

Removing gs://yangyou-mnist/log/#1565824600951255...
Removing gs://yangyou-mnist/log/checkpoint#1565824680571893...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565824614194515...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565824618336773...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565824601.v3-8-tpu#1565824683881228...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565824676825554...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565824606146602...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565824677817899...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565824613362391...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565824682873845...
Removing gs://yangyou-mnist/log/eval/#1565824796179525...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565824796.v3-8-tpu#1565824800340529...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:20:04.676242 139848907171264 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:20:04.677284 139848907171264 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:20:04.679929 139848907171264 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:20:04.680811 139848907171264 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:20:04.681410 139848907171264 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:20:04.681541 139848907171264 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:20:05.098297 139848907171264 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:20:05.107336 139848907171264 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:20:05.111495 139848907171264 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:20:05.166251 139848907171264 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:20:05.166520 139848907171264 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:20:05.433207 139848907171264 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:20:05.550651 139848907171264 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:20:05.550944 139848907171264 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:20:05.935025 139848907171264 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f30f6987190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f30f8b66210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:20:05.935386 139848907171264 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:20:06.263797 139848907171264 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:20:06.266819: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:20:06.281955 139848907171264 tpu_system_metadata.py:148] Found TPU system:
I0814 23:20:06.282269 139848907171264 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:20:06.282875 139848907171264 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:20:06.282932 139848907171264 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:20:06.282989 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:20:06.283292 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:20:06.283366 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:20:06.283426 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:20:06.283473 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:20:06.283520 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:20:06.283567 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:20:06.283622 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:20:06.283669 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:20:06.283716 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:20:06.283773 139848907171264 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:20:06.290141 139848907171264 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:20:06.303817 139848907171264 estimator.py:1145] Calling model_fn.
W0814 23:20:06.304466 139848907171264 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:20:06.593934 139848907171264 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:20:07.020749 139848907171264 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:20:07.086232 139848907171264 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:20:07.092757 139848907171264 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:20:07.288042 139848907171264 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:20:07.302891 139848907171264 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:20:07.315937 139848907171264 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:20:07.317084 139848907171264 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:20:07.324254 139848907171264 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:20:07.329653 139848907171264 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:20:07.329876 139848907171264 optimization.py:36] ++++++ warmup starts at step 0, for 13 steps ++++++
W0814 23:20:07.342871 139848907171264 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:20:07.460432 139848907171264 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:20:07.503762 139848907171264 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:20:07.553009 139848907171264 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:20:07.607542 139848907171264 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:20:07.773083 139848907171264 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:20:07.825546 139848907171264 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:20:07.876507 139848907171264 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:20:07.928807 139848907171264 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:20:07.976655 139848907171264 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:20:08.022032 139848907171264 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:20:08.039000 139848907171264 estimator.py:1147] Done calling model_fn.
I0814 23:20:11.469261 139848907171264 tpu_estimator.py:499] TPU job name worker
I0814 23:20:11.585549 139848907171264 monitored_session.py:240] Graph was finalized.
I0814 23:20:12.259884 139848907171264 session_manager.py:500] Running local_init_op.
I0814 23:20:12.309007 139848907171264 session_manager.py:502] Done running local_init_op.
I0814 23:20:15.210757 139848907171264 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:20:28.024725 139848907171264 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:20:28.176826 139848907171264 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:20:28.177330 139848907171264 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:20:28.177814: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:20:28.183159 139848907171264 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:20:28.185461 139848907171264 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:20:28.189600 139848907171264 tpu_estimator.py:557] Init TPU system
I0814 23:21:08.114950 139848907171264 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 23:21:08.116069 139848144901888 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:21:08.116905 139848136509184 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:21:08.198589 139848907171264 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:21:08.200212 139848128116480 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:21:08.200547 139848907171264 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 23:21:08.591236 139848128116480 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 23:21:13.010588 139848136509184 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:21:17.547069 139848907171264 basic_session_run_hooks.py:262] loss = 0.08231152, step = 30
I0814 23:21:17.549324 139848907171264 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:21:31.147468 139848907171264 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:21:31.147789 139848907171264 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:21:31.148130 139848144901888 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:21:31.148463 139848144901888 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:21:31.148735 139848907171264 error_handling.py:96] infeed marked as finished
I0814 23:21:31.148933 139848907171264 tpu_estimator.py:602] Stop output thread controller
I0814 23:21:31.149004 139848907171264 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:21:31.149203 139848136509184 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:21:31.149399 139848136509184 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:21:31.149615 139848907171264 error_handling.py:96] outfeed marked as finished
I0814 23:21:31.149758 139848907171264 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:21:38.734086 139848907171264 estimator.py:368] Loss for final step: 0.08231152.
I0814 23:21:38.734960 139848907171264 error_handling.py:96] training_loop marked as finished
I0814 23:21:39.530505 139848907171264 estimator.py:1145] Calling model_fn.
E0814 23:21:40.248605 139848907171264 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:21:40.482242 139848907171264 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:21:40.504692 139848907171264 estimator.py:1147] Done calling model_fn.
I0814 23:21:40.521971 139848907171264 evaluation.py:255] Starting evaluation at 2019-08-14T23:21:40Z
I0814 23:21:40.522207 139848907171264 tpu_estimator.py:499] TPU job name worker
I0814 23:21:40.601174 139848907171264 monitored_session.py:240] Graph was finalized.
W0814 23:21:40.601908 139848907171264 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:21:40.809748 139848907171264 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:21:43.619714 139848907171264 session_manager.py:500] Running local_init_op.
I0814 23:21:43.649554 139848907171264 session_manager.py:502] Done running local_init_op.
I0814 23:21:43.703221 139848907171264 tpu_estimator.py:557] Init TPU system
I0814 23:22:52.081666 139848907171264 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:22:52.082568 139848141231872 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:22:52.083339 139848132839168 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:22:52.150096 139848907171264 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:22:52.179708 139848907171264 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:22:52.180032 139848907171264 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:22:52.274795 139848124446464 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:22:52.617321 139848124446464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:22:52.958916 139848132839168 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:22:53.375483 139848907171264 evaluation.py:167] Evaluation [10/10]
I0814 23:22:53.375920 139848907171264 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:22:53.376000 139848907171264 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:22:53.376203 139848141231872 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:22:53.376307 139848141231872 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:22:53.376488 139848907171264 error_handling.py:96] infeed marked as finished
I0814 23:22:53.376590 139848907171264 tpu_estimator.py:602] Stop output thread controller
I0814 23:22:53.376637 139848907171264 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:22:53.376764 139848132839168 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:22:53.376837 139848132839168 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:22:53.376954 139848907171264 error_handling.py:96] outfeed marked as finished
I0814 23:22:53.377048 139848907171264 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:23:22.708652 139848907171264 evaluation.py:275] Finished evaluation at 2019-08-14-23:23:22
I0814 23:23:22.708966 139848907171264 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9807, global_step = 30, loss = 0.06502314
I0814 23:23:27.358572 139848907171264 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:23:28.221946 139848907171264 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06502314, 'global_step': 30, 'accuracy': 0.9807}

Removing gs://yangyou-mnist/log/#1565824809641857...
Removing gs://yangyou-mnist/log/checkpoint#1565824887592710...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565824809.v3-8-tpu#1565824890834376...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565824884433286...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565824822584311...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565824827505092...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565824885383393...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565824821692527...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565824814603849...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565824889900940...
Removing gs://yangyou-mnist/log/eval/#1565825004527816...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565825004.v3-8-tpu#1565825007908800...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:23:32.081531 140369396786624 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:23:32.082314 140369396786624 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:23:32.084964 140369396786624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:23:32.085995 140369396786624 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:23:32.086584 140369396786624 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:23:32.086713 140369396786624 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:23:32.505872 140369396786624 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:23:32.513222 140369396786624 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:23:32.517364 140369396786624 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:23:32.635803 140369396786624 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:23:32.636113 140369396786624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:23:32.894289 140369396786624 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:23:33.011842 140369396786624 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:23:33.012132 140369396786624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:23:33.332935 140369396786624 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7faa2631b090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7faa284fa210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:23:33.333378 140369396786624 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:23:33.677951 140369396786624 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:23:33.680870: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:23:33.694365 140369396786624 tpu_system_metadata.py:148] Found TPU system:
I0814 23:23:33.694608 140369396786624 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:23:33.695090 140369396786624 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:23:33.695156 140369396786624 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:23:33.695209 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:23:33.695497 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:23:33.695554 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:23:33.695606 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:23:33.695657 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:23:33.695704 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:23:33.695751 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:23:33.695797 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:23:33.695862 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:23:33.695909 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:23:33.695957 140369396786624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:23:33.702637 140369396786624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:23:33.715934 140369396786624 estimator.py:1145] Calling model_fn.
W0814 23:23:33.716626 140369396786624 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:23:33.990566 140369396786624 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:23:34.897630 140369396786624 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:23:34.963114 140369396786624 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:23:34.969336 140369396786624 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:23:35.155674 140369396786624 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:23:35.170166 140369396786624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:23:35.182410 140369396786624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:23:35.183504 140369396786624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:23:35.190794 140369396786624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:23:35.196439 140369396786624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:23:35.196679 140369396786624 optimization.py:36] ++++++ warmup starts at step 0, for 13 steps ++++++
W0814 23:23:35.209501 140369396786624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:23:35.321516 140369396786624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:23:35.364202 140369396786624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:23:35.410031 140369396786624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:23:35.462738 140369396786624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:23:35.631679 140369396786624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:23:35.682921 140369396786624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:23:35.732574 140369396786624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:23:35.783889 140369396786624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:23:35.830704 140369396786624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:23:35.875631 140369396786624 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:23:35.892302 140369396786624 estimator.py:1147] Done calling model_fn.
I0814 23:23:39.623882 140369396786624 tpu_estimator.py:499] TPU job name worker
I0814 23:23:39.733553 140369396786624 monitored_session.py:240] Graph was finalized.
I0814 23:23:40.423526 140369396786624 session_manager.py:500] Running local_init_op.
I0814 23:23:40.485630 140369396786624 session_manager.py:502] Done running local_init_op.
I0814 23:23:43.321644 140369396786624 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:23:56.302946 140369396786624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:23:56.450172 140369396786624 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:23:56.450768 140369396786624 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:23:56.451364: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:23:56.456338 140369396786624 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:23:56.458492 140369396786624 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:23:56.462711 140369396786624 tpu_estimator.py:557] Init TPU system
I0814 23:24:36.103918 140369396786624 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 23:24:36.104825 140368500479744 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:24:36.105299 140368492087040 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:24:36.173898 140369396786624 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:24:36.174732 140369396786624 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:24:36.229425 140368483694336 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:24:36.518861 140368483694336 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:24:41.001101 140368492087040 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:24:45.614927 140369396786624 basic_session_run_hooks.py:262] loss = 0.083925016, step = 30
I0814 23:24:45.617640 140369396786624 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:24:59.474632 140369396786624 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:24:59.474940 140369396786624 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:24:59.475152 140368500479744 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:24:59.475260 140368500479744 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:24:59.475394 140369396786624 error_handling.py:96] infeed marked as finished
I0814 23:24:59.475485 140369396786624 tpu_estimator.py:602] Stop output thread controller
I0814 23:24:59.475533 140369396786624 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:24:59.475651 140368492087040 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:24:59.475723 140368492087040 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:24:59.475830 140369396786624 error_handling.py:96] outfeed marked as finished
I0814 23:24:59.475912 140369396786624 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:25:06.661931 140369396786624 estimator.py:368] Loss for final step: 0.083925016.
I0814 23:25:06.662720 140369396786624 error_handling.py:96] training_loop marked as finished
I0814 23:25:07.460160 140369396786624 estimator.py:1145] Calling model_fn.
E0814 23:25:08.156939 140369396786624 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:25:08.397305 140369396786624 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:25:08.419910 140369396786624 estimator.py:1147] Done calling model_fn.
I0814 23:25:08.437367 140369396786624 evaluation.py:255] Starting evaluation at 2019-08-14T23:25:08Z
I0814 23:25:08.437604 140369396786624 tpu_estimator.py:499] TPU job name worker
I0814 23:25:08.517561 140369396786624 monitored_session.py:240] Graph was finalized.
W0814 23:25:08.518301 140369396786624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:25:08.723117 140369396786624 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:25:11.520359 140369396786624 session_manager.py:500] Running local_init_op.
I0814 23:25:11.548789 140369396786624 session_manager.py:502] Done running local_init_op.
I0814 23:25:11.605267 140369396786624 tpu_estimator.py:557] Init TPU system
I0814 23:26:20.047719 140369396786624 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:26:20.048603 140368496809728 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:26:20.049372 140368488417024 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:26:20.119597 140369396786624 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:26:20.150001 140369396786624 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:26:20.150440 140369396786624 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:26:20.248071 140368475039488 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:26:20.620908 140368475039488 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:26:20.922193 140368488417024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:26:21.407542 140369396786624 evaluation.py:167] Evaluation [10/10]
I0814 23:26:21.407991 140369396786624 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:26:21.408078 140369396786624 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:26:21.408293 140368496809728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:26:21.408446 140368496809728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:26:21.408598 140369396786624 error_handling.py:96] infeed marked as finished
I0814 23:26:21.408725 140369396786624 tpu_estimator.py:602] Stop output thread controller
I0814 23:26:21.408776 140369396786624 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:26:21.408891 140368488417024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:26:21.408968 140368488417024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:26:21.409085 140369396786624 error_handling.py:96] outfeed marked as finished
I0814 23:26:21.409162 140369396786624 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:26:50.716430 140369396786624 evaluation.py:275] Finished evaluation at 2019-08-14-23:26:50
I0814 23:26:50.716779 140369396786624 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9755, global_step = 30, loss = 0.09516518
I0814 23:26:55.966849 140369396786624 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:26:56.823148 140369396786624 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09516518, 'global_step': 30, 'accuracy': 0.9755}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565825031337392...
Removing gs://yangyou-mnist/log/checkpoint#1565825095980208...
Removing gs://yangyou-mnist/log/#1565825017660763...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565825035786330...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565825017.v3-8-tpu#1565825099166858...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565825092748111...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565825022724339...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565825030444009...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565825093665760...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565825098221118...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565825212960838...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565825213.v3-8-tpu#1565825216513865...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:27:00.804656 140589098411456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:27:00.805459 140589098411456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:27:00.808058 140589098411456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:27:00.809088 140589098411456 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:27:00.809735 140589098411456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:27:00.809871 140589098411456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:27:01.228302 140589098411456 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:27:01.238318 140589098411456 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:27:01.243232 140589098411456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:27:01.300210 140589098411456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:27:01.300535 140589098411456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:27:01.509768 140589098411456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:27:01.561106 140589098411456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:27:01.561377 140589098411456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:27:01.832076 140589098411456 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fdd4d6e7190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fdd4f8c6210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:27:01.832496 140589098411456 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:27:02.171216 140589098411456 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:27:02.174178: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:27:02.188844 140589098411456 tpu_system_metadata.py:148] Found TPU system:
I0814 23:27:02.189084 140589098411456 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:27:02.189552 140589098411456 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:27:02.189620 140589098411456 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:27:02.189698 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:27:02.190002 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:27:02.190058 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:27:02.190110 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:27:02.190156 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:27:02.190203 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:27:02.190251 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:27:02.190315 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:27:02.190363 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:27:02.190417 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:27:02.190464 140589098411456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:27:02.197010 140589098411456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:27:02.210071 140589098411456 estimator.py:1145] Calling model_fn.
W0814 23:27:02.210762 140589098411456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:27:02.482305 140589098411456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:27:02.882169 140589098411456 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:27:02.945430 140589098411456 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:27:02.951525 140589098411456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:27:03.137109 140589098411456 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:27:03.151070 140589098411456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:27:03.163006 140589098411456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:27:03.164110 140589098411456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:27:03.171475 140589098411456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:27:03.176839 140589098411456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:27:03.177052 140589098411456 optimization.py:36] ++++++ warmup starts at step 0, for 14 steps ++++++
W0814 23:27:03.189871 140589098411456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:27:03.311954 140589098411456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:27:03.355195 140589098411456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:27:03.400764 140589098411456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:27:03.454092 140589098411456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:27:03.615576 140589098411456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:27:03.666697 140589098411456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:27:03.715972 140589098411456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:27:03.767503 140589098411456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:27:03.813682 140589098411456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:27:03.854840 140589098411456 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:27:03.871032 140589098411456 estimator.py:1147] Done calling model_fn.
I0814 23:27:07.375572 140589098411456 tpu_estimator.py:499] TPU job name worker
I0814 23:27:07.485347 140589098411456 monitored_session.py:240] Graph was finalized.
I0814 23:27:08.188805 140589098411456 session_manager.py:500] Running local_init_op.
I0814 23:27:08.238266 140589098411456 session_manager.py:502] Done running local_init_op.
I0814 23:27:11.008249 140589098411456 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:27:23.941540 140589098411456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:27:24.086054 140589098411456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:27:24.086554 140589098411456 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:27:24.086980: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:27:24.091885 140589098411456 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:27:24.094038 140589098411456 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:27:24.099769 140589098411456 tpu_estimator.py:557] Init TPU system
I0814 23:28:04.098484 140589098411456 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 23:28:04.099435 140588336527104 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:28:04.099929 140588328134400 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:28:04.161396 140588319741696 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:28:04.170375 140589098411456 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:28:04.171514 140589098411456 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 23:28:04.454603 140588319741696 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:28:08.972089 140588328134400 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:28:13.876338 140589098411456 basic_session_run_hooks.py:262] loss = 0.10673811, step = 30
I0814 23:28:13.878592 140589098411456 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:28:27.755012 140589098411456 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:28:27.755342 140589098411456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:28:27.756691 140588336527104 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:28:27.756947 140588336527104 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:28:27.757117 140589098411456 error_handling.py:96] infeed marked as finished
I0814 23:28:27.757240 140589098411456 tpu_estimator.py:602] Stop output thread controller
I0814 23:28:27.757394 140589098411456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:28:27.757531 140588328134400 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:28:27.757620 140588328134400 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:28:27.757761 140589098411456 error_handling.py:96] outfeed marked as finished
I0814 23:28:27.757853 140589098411456 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:28:34.589744 140589098411456 estimator.py:368] Loss for final step: 0.10673811.
I0814 23:28:34.590634 140589098411456 error_handling.py:96] training_loop marked as finished
I0814 23:28:35.382756 140589098411456 estimator.py:1145] Calling model_fn.
E0814 23:28:36.192131 140589098411456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:28:36.426265 140589098411456 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:28:36.449285 140589098411456 estimator.py:1147] Done calling model_fn.
I0814 23:28:36.466782 140589098411456 evaluation.py:255] Starting evaluation at 2019-08-14T23:28:36Z
I0814 23:28:36.467011 140589098411456 tpu_estimator.py:499] TPU job name worker
I0814 23:28:36.548175 140589098411456 monitored_session.py:240] Graph was finalized.
W0814 23:28:36.548959 140589098411456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:28:36.765240 140589098411456 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:28:39.679379 140589098411456 session_manager.py:500] Running local_init_op.
I0814 23:28:39.709276 140589098411456 session_manager.py:502] Done running local_init_op.
I0814 23:28:39.770457 140589098411456 tpu_estimator.py:557] Init TPU system
I0814 23:29:48.085819 140589098411456 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:29:48.086636 140588332857088 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:29:48.087042 140588324464384 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:29:48.156874 140589098411456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:29:48.185424 140589098411456 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:29:48.185765 140589098411456 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:29:48.219912 140587835586304 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:29:48.624809 140587835586304 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 23:29:48.971065 140588324464384 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:29:49.419344 140589098411456 evaluation.py:167] Evaluation [10/10]
I0814 23:29:49.419739 140589098411456 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:29:49.419827 140589098411456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:29:49.420020 140588332857088 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:29:49.420134 140588332857088 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:29:49.420273 140589098411456 error_handling.py:96] infeed marked as finished
I0814 23:29:49.420367 140589098411456 tpu_estimator.py:602] Stop output thread controller
I0814 23:29:49.420453 140589098411456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:29:49.420576 140588324464384 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:29:49.420666 140588324464384 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:29:49.420789 140589098411456 error_handling.py:96] outfeed marked as finished
I0814 23:29:49.420866 140589098411456 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:30:18.722151 140589098411456 evaluation.py:275] Finished evaluation at 2019-08-14-23:30:18
I0814 23:30:18.722470 140589098411456 estimator.py:2039] Saving dict for global step 30: accuracy = 0.974, global_step = 30, loss = 0.08402558
I0814 23:30:23.381077 140589098411456 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:30:24.270643 140589098411456 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08402558, 'global_step': 30, 'accuracy': 0.974}

Removing gs://yangyou-mnist/log/#1565825225379782...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565825238300904...
Removing gs://yangyou-mnist/log/checkpoint#1565825304098442...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565825243423822...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565825225.v3-8-tpu#1565825307444584...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565825300646279...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565825301654543...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565825230425004...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565825237397296...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565825306492221...
Removing gs://yangyou-mnist/log/eval/#1565825420446125...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565825420.v3-8-tpu#1565825423962379...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:30:28.078515 140449802606016 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:30:28.079303 140449802606016 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:30:28.082092 140449802606016 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:30:28.082957 140449802606016 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:30:28.083540 140449802606016 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:30:28.083674 140449802606016 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:30:28.504277 140449802606016 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:30:28.511862 140449802606016 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:30:28.515866 140449802606016 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:30:28.570571 140449802606016 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:30:28.570856 140449802606016 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:30:29.039465 140449802606016 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:30:29.094213 140449802606016 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:30:29.094494 140449802606016 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:30:29.366008 140449802606016 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fbcdec12190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fbce0df1210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:30:29.366440 140449802606016 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:30:29.711509 140449802606016 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:30:29.714674: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:30:29.730060 140449802606016 tpu_system_metadata.py:148] Found TPU system:
I0814 23:30:29.730345 140449802606016 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:30:29.730993 140449802606016 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:30:29.731059 140449802606016 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:30:29.731125 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:30:29.731448 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:30:29.731514 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:30:29.731583 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:30:29.731651 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:30:29.731705 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:30:29.731765 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:30:29.731820 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:30:29.731873 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:30:29.731928 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:30:29.731981 140449802606016 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:30:29.738548 140449802606016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:30:29.753662 140449802606016 estimator.py:1145] Calling model_fn.
W0814 23:30:29.754298 140449802606016 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:30:30.037305 140449802606016 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:30:30.464688 140449802606016 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:30:30.526732 140449802606016 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:30:30.532787 140449802606016 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:30:30.714432 140449802606016 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:30:30.728626 140449802606016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:30:30.741112 140449802606016 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:30:30.742165 140449802606016 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:30:30.749315 140449802606016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:30:30.754750 140449802606016 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:30:30.754970 140449802606016 optimization.py:36] ++++++ warmup starts at step 0, for 14 steps ++++++
W0814 23:30:30.767864 140449802606016 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:30:30.878226 140449802606016 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:30:30.920593 140449802606016 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:30:30.965034 140449802606016 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:30:31.017036 140449802606016 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:30:31.179438 140449802606016 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:30:31.230515 140449802606016 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:30:31.279772 140449802606016 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:30:31.330776 140449802606016 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:30:31.376765 140449802606016 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:30:31.418800 140449802606016 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:30:31.435013 140449802606016 estimator.py:1147] Done calling model_fn.
I0814 23:30:35.996309 140449802606016 tpu_estimator.py:499] TPU job name worker
I0814 23:30:36.118479 140449802606016 monitored_session.py:240] Graph was finalized.
I0814 23:30:36.829659 140449802606016 session_manager.py:500] Running local_init_op.
I0814 23:30:36.880728 140449802606016 session_manager.py:502] Done running local_init_op.
I0814 23:30:39.611840 140449802606016 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:30:52.533869 140449802606016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:30:52.705610 140449802606016 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:30:52.706123 140449802606016 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:30:52.706517: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:30:52.712040 140449802606016 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:30:52.714200 140449802606016 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:30:52.718249 140449802606016 tpu_estimator.py:557] Init TPU system
I0814 23:31:32.121603 140449802606016 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 23:31:32.122488 140448903452416 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:31:32.122963 140448895059712 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:31:32.189326 140449802606016 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:31:32.190896 140449802606016 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:31:32.193104 140448886667008 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:31:32.493119 140448886667008 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:31:37.048683 140448895059712 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:31:41.926307 140449802606016 basic_session_run_hooks.py:262] loss = 0.09340343, step = 30
I0814 23:31:41.929193 140449802606016 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:31:56.304888 140449802606016 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:31:56.305202 140449802606016 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:31:56.305398 140448903452416 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:31:56.305491 140448903452416 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:31:56.305629 140449802606016 error_handling.py:96] infeed marked as finished
I0814 23:31:56.305733 140449802606016 tpu_estimator.py:602] Stop output thread controller
I0814 23:31:56.305783 140449802606016 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:31:56.305902 140448895059712 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:31:56.305970 140448895059712 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:31:56.306077 140449802606016 error_handling.py:96] outfeed marked as finished
I0814 23:31:56.306155 140449802606016 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:32:02.634979 140449802606016 estimator.py:368] Loss for final step: 0.09340343.
I0814 23:32:02.638247 140449802606016 error_handling.py:96] training_loop marked as finished
I0814 23:32:03.407305 140449802606016 estimator.py:1145] Calling model_fn.
E0814 23:32:04.137073 140449802606016 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:32:04.371112 140449802606016 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:32:04.393629 140449802606016 estimator.py:1147] Done calling model_fn.
I0814 23:32:04.410324 140449802606016 evaluation.py:255] Starting evaluation at 2019-08-14T23:32:04Z
I0814 23:32:04.410548 140449802606016 tpu_estimator.py:499] TPU job name worker
I0814 23:32:04.489151 140449802606016 monitored_session.py:240] Graph was finalized.
W0814 23:32:04.489876 140449802606016 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:32:04.698683 140449802606016 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:32:07.490751 140449802606016 session_manager.py:500] Running local_init_op.
I0814 23:32:07.516016 140449802606016 session_manager.py:502] Done running local_init_op.
I0814 23:32:07.575719 140449802606016 tpu_estimator.py:557] Init TPU system
I0814 23:33:16.039783 140449802606016 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:33:16.040863 140448902403840 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:33:16.041456 140448894011136 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:33:16.110702 140449802606016 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:33:16.145200 140449802606016 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:33:16.145538 140449802606016 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:33:16.188371 140448885618432 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:33:16.456396 140448885618432 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:33:16.907008 140448894011136 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:33:17.328587 140449802606016 evaluation.py:167] Evaluation [10/10]
I0814 23:33:17.328993 140449802606016 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:33:17.329094 140449802606016 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:33:17.329291 140448902403840 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:33:17.329387 140448902403840 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:33:17.329524 140449802606016 error_handling.py:96] infeed marked as finished
I0814 23:33:17.329623 140449802606016 tpu_estimator.py:602] Stop output thread controller
I0814 23:33:17.329679 140449802606016 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:33:17.329792 140448894011136 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:33:17.329864 140448894011136 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:33:17.329981 140449802606016 error_handling.py:96] outfeed marked as finished
I0814 23:33:17.330071 140449802606016 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:33:46.553844 140449802606016 evaluation.py:275] Finished evaluation at 2019-08-14-23:33:46
I0814 23:33:46.554178 140449802606016 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9766, global_step = 30, loss = 0.076026335
I0814 23:33:51.009260 140449802606016 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:33:51.889374 140449802606016 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.076026335, 'global_step': 30, 'accuracy': 0.9766}

Removing gs://yangyou-mnist/log/#1565825434026951...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565825447353486...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565825509219439...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565825439008563...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565825434.v3-8-tpu#1565825515970233...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565825452015493...
Removing gs://yangyou-mnist/log/checkpoint#1565825512669948...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565825446400784...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565825510185869...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565825514902983...
Removing gs://yangyou-mnist/log/eval/#1565825628223751...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565825628.v3-8-tpu#1565825631581979...
/ [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:33:55.800355 139637432673728 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:33:55.801198 139637432673728 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:33:55.803818 139637432673728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:33:55.804711 139637432673728 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:33:55.805294 139637432673728 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:33:55.805422 139637432673728 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:33:56.220463 139637432673728 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:33:56.228756 139637432673728 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:33:56.233134 139637432673728 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:33:56.288944 139637432673728 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:33:56.289213 139637432673728 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:33:56.621565 139637432673728 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:33:56.744041 139637432673728 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:33:56.744366 139637432673728 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:33:56.986377 139637432673728 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7effb9bbb210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7effbbd9a1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:33:56.986836 139637432673728 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:33:57.331290 139637432673728 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:33:57.334077: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:33:57.345999 139637432673728 tpu_system_metadata.py:148] Found TPU system:
I0814 23:33:57.346322 139637432673728 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:33:57.346878 139637432673728 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:33:57.346939 139637432673728 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:33:57.346996 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:33:57.347326 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:33:57.347383 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:33:57.347439 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:33:57.347487 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:33:57.347536 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:33:57.347585 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:33:57.347651 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:33:57.347700 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:33:57.347747 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:33:57.347795 139637432673728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:33:57.354281 139637432673728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:33:57.367120 139637432673728 estimator.py:1145] Calling model_fn.
W0814 23:33:57.367736 139637432673728 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:33:57.638479 139637432673728 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:33:58.042227 139637432673728 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:33:58.108099 139637432673728 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:33:58.114454 139637432673728 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:33:58.304455 139637432673728 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:33:58.318517 139637432673728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:33:58.331273 139637432673728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:33:58.332442 139637432673728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:33:58.339745 139637432673728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:33:58.345150 139637432673728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:33:58.345382 139637432673728 optimization.py:36] ++++++ warmup starts at step 0, for 14 steps ++++++
W0814 23:33:58.357862 139637432673728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:33:58.470498 139637432673728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:33:58.513020 139637432673728 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:33:58.559340 139637432673728 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:33:58.612606 139637432673728 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:33:58.776602 139637432673728 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:33:58.827883 139637432673728 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:33:58.877911 139637432673728 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:33:58.930028 139637432673728 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:33:58.977133 139637432673728 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:33:59.020564 139637432673728 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:33:59.037807 139637432673728 estimator.py:1147] Done calling model_fn.
I0814 23:34:02.617922 139637432673728 tpu_estimator.py:499] TPU job name worker
I0814 23:34:02.729736 139637432673728 monitored_session.py:240] Graph was finalized.
I0814 23:34:03.428143 139637432673728 session_manager.py:500] Running local_init_op.
I0814 23:34:03.478892 139637432673728 session_manager.py:502] Done running local_init_op.
I0814 23:34:06.360691 139637432673728 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:34:18.952934 139637432673728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:34:19.125503 139637432673728 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:34:19.125930 139637432673728 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:34:19.126312: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:34:19.131006 139637432673728 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:34:19.133128 139637432673728 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:34:19.137793 139637432673728 tpu_estimator.py:557] Init TPU system
I0814 23:35:00.119627 139637432673728 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 23:35:00.120517 139636536493824 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:35:00.121011 139636528101120 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:35:00.201741 139637432673728 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:35:00.202539 139637432673728 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:35:00.263060 139636519708416 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:35:00.585949 139636519708416 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:35:05.073446 139636528101120 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:35:09.859864 139637432673728 basic_session_run_hooks.py:262] loss = 0.095162205, step = 30
I0814 23:35:09.862597 139637432673728 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:35:23.878700 139637432673728 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:35:23.879049 139637432673728 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:35:23.880872 139636536493824 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:35:23.881156 139636536493824 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:35:23.881346 139637432673728 error_handling.py:96] infeed marked as finished
I0814 23:35:23.881474 139637432673728 tpu_estimator.py:602] Stop output thread controller
I0814 23:35:23.881550 139637432673728 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:35:23.881690 139636528101120 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:35:23.881783 139636528101120 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:35:23.881907 139637432673728 error_handling.py:96] outfeed marked as finished
I0814 23:35:23.881998 139637432673728 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:35:30.723542 139637432673728 estimator.py:368] Loss for final step: 0.095162205.
I0814 23:35:30.724360 139637432673728 error_handling.py:96] training_loop marked as finished
I0814 23:35:31.543349 139637432673728 estimator.py:1145] Calling model_fn.
E0814 23:35:32.306323 139637432673728 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:35:32.543225 139637432673728 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:35:32.565591 139637432673728 estimator.py:1147] Done calling model_fn.
I0814 23:35:32.583003 139637432673728 evaluation.py:255] Starting evaluation at 2019-08-14T23:35:32Z
I0814 23:35:32.583235 139637432673728 tpu_estimator.py:499] TPU job name worker
I0814 23:35:32.661458 139637432673728 monitored_session.py:240] Graph was finalized.
W0814 23:35:32.662200 139637432673728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:35:32.868633 139637432673728 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:35:35.890182 139637432673728 session_manager.py:500] Running local_init_op.
I0814 23:35:35.916501 139637432673728 session_manager.py:502] Done running local_init_op.
I0814 23:35:35.967856 139637432673728 tpu_estimator.py:557] Init TPU system
I0814 23:36:44.115916 139637432673728 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:36:44.116894 139636532823808 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:36:44.117419 139636524431104 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:36:44.185506 139637432673728 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:36:44.215711 139637432673728 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:36:44.216140 139637432673728 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:36:44.249342 139636511053568 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:36:44.550846 139636511053568 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:36:45.040659 139636524431104 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:36:45.341552 139637432673728 evaluation.py:167] Evaluation [10/10]
I0814 23:36:45.341981 139637432673728 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:36:45.342067 139637432673728 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:36:45.342257 139636532823808 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:36:45.342382 139636532823808 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:36:45.342632 139637432673728 error_handling.py:96] infeed marked as finished
I0814 23:36:45.342946 139637432673728 tpu_estimator.py:602] Stop output thread controller
I0814 23:36:45.343015 139637432673728 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:36:45.343158 139636524431104 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:36:45.343341 139636524431104 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:36:45.343492 139637432673728 error_handling.py:96] outfeed marked as finished
I0814 23:36:45.343580 139637432673728 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:37:14.651782 139637432673728 evaluation.py:275] Finished evaluation at 2019-08-14-23:37:14
I0814 23:37:14.652153 139637432673728 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9778, global_step = 30, loss = 0.078470774
I0814 23:37:19.480012 139637432673728 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:37:20.389759 139637432673728 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.078470774, 'global_step': 30, 'accuracy': 0.9778}

Removing gs://yangyou-mnist/log/#1565825640619060...
Removing gs://yangyou-mnist/log/checkpoint#1565825720166932...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565825640.v3-8-tpu#1565825723574577...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565825645773645...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565825653794709...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565825658415480...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565825716885733...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565825717824743...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565825652872597...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565825722517588...
Removing gs://yangyou-mnist/log/eval/#1565825836363085...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565825836.v3-8-tpu#1565825840081337...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:37:24.265286 140017669055936 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:37:24.266104 140017669055936 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:37:24.269025 140017669055936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:37:24.269958 140017669055936 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:37:24.270565 140017669055936 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:37:24.270699 140017669055936 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:37:24.685055 140017669055936 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:37:24.694303 140017669055936 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:37:24.699635 140017669055936 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:37:24.756510 140017669055936 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:37:24.756779 140017669055936 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:37:25.129946 140017669055936 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:37:25.248007 140017669055936 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:37:25.248282 140017669055936 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:37:25.433996 140017669055936 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f58419671d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5843b46210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:37:25.434427 140017669055936 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:37:25.764003 140017669055936 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:37:25.766971: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:37:25.779887 140017669055936 tpu_system_metadata.py:148] Found TPU system:
I0814 23:37:25.780139 140017669055936 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:37:25.780720 140017669055936 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:37:25.780782 140017669055936 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:37:25.780838 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:37:25.781128 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:37:25.781194 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:37:25.781246 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:37:25.781296 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:37:25.781344 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:37:25.781393 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:37:25.781439 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:37:25.781485 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:37:25.781531 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:37:25.781579 140017669055936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:37:25.787755 140017669055936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:37:25.800592 140017669055936 estimator.py:1145] Calling model_fn.
W0814 23:37:25.801203 140017669055936 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:37:26.077491 140017669055936 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:37:26.502861 140017669055936 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:37:26.565696 140017669055936 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:37:26.571743 140017669055936 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:37:26.754389 140017669055936 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:37:26.768126 140017669055936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:37:26.780791 140017669055936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:37:26.782047 140017669055936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:37:26.789180 140017669055936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:37:26.794469 140017669055936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:37:26.794683 140017669055936 optimization.py:36] ++++++ warmup starts at step 0, for 14 steps ++++++
W0814 23:37:26.807190 140017669055936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:37:26.919799 140017669055936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:37:26.962045 140017669055936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:37:27.007069 140017669055936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:37:27.058875 140017669055936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:37:27.225280 140017669055936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:37:27.277089 140017669055936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:37:27.326905 140017669055936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:37:27.377500 140017669055936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:37:27.424689 140017669055936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:37:27.468661 140017669055936 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:37:27.486367 140017669055936 estimator.py:1147] Done calling model_fn.
I0814 23:37:31.308676 140017669055936 tpu_estimator.py:499] TPU job name worker
I0814 23:37:31.421760 140017669055936 monitored_session.py:240] Graph was finalized.
I0814 23:37:32.086611 140017669055936 session_manager.py:500] Running local_init_op.
I0814 23:37:32.135154 140017669055936 session_manager.py:502] Done running local_init_op.
I0814 23:37:34.975403 140017669055936 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:37:47.925328 140017669055936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:37:48.086998 140017669055936 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:37:48.087466 140017669055936 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:37:48.087964: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:37:48.093833 140017669055936 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:37:48.096071 140017669055936 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:37:48.100193 140017669055936 tpu_estimator.py:557] Init TPU system
I0814 23:38:28.129842 140017669055936 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 23:38:28.130712 140016772957952 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:38:28.131203 140016764565248 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:38:28.192693 140016756172544 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:38:28.202446 140017669055936 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:38:28.204665 140017669055936 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 23:38:28.411773 140016756172544 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 23:38:33.028872 140016764565248 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:38:37.859695 140017669055936 basic_session_run_hooks.py:262] loss = 0.09151955, step = 30
I0814 23:38:37.862298 140017669055936 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:38:51.565097 140017669055936 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:38:51.565370 140017669055936 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:38:51.565567 140016772957952 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:38:51.565670 140016772957952 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:38:51.565807 140017669055936 error_handling.py:96] infeed marked as finished
I0814 23:38:51.565902 140017669055936 tpu_estimator.py:602] Stop output thread controller
I0814 23:38:51.565953 140017669055936 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:38:51.566068 140016764565248 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:38:51.566140 140016764565248 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:38:51.566262 140017669055936 error_handling.py:96] outfeed marked as finished
I0814 23:38:51.566346 140017669055936 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:38:58.558871 140017669055936 estimator.py:368] Loss for final step: 0.09151955.
I0814 23:38:58.559648 140017669055936 error_handling.py:96] training_loop marked as finished
I0814 23:38:59.383776 140017669055936 estimator.py:1145] Calling model_fn.
E0814 23:39:00.098474 140017669055936 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:39:00.331466 140017669055936 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:39:00.353733 140017669055936 estimator.py:1147] Done calling model_fn.
I0814 23:39:00.371215 140017669055936 evaluation.py:255] Starting evaluation at 2019-08-14T23:39:00Z
I0814 23:39:00.371460 140017669055936 tpu_estimator.py:499] TPU job name worker
I0814 23:39:00.453015 140017669055936 monitored_session.py:240] Graph was finalized.
W0814 23:39:00.453769 140017669055936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:39:00.657735 140017669055936 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:39:03.209930 140017669055936 session_manager.py:500] Running local_init_op.
I0814 23:39:03.235007 140017669055936 session_manager.py:502] Done running local_init_op.
I0814 23:39:03.291155 140017669055936 tpu_estimator.py:557] Init TPU system
I0814 23:40:12.045598 140017669055936 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:40:12.046758 140016769287936 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:40:12.047547 140016760895232 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:40:12.114521 140017669055936 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:40:12.143187 140017669055936 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:40:12.143655 140017669055936 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:40:12.180208 140016403609344 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:40:12.555531 140016403609344 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:40:12.940325 140016760895232 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:40:13.283936 140017669055936 evaluation.py:167] Evaluation [10/10]
I0814 23:40:13.284256 140017669055936 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:40:13.284327 140017669055936 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:40:13.284636 140016769287936 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:40:13.284939 140016769287936 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:40:13.285228 140017669055936 error_handling.py:96] infeed marked as finished
I0814 23:40:13.285450 140017669055936 tpu_estimator.py:602] Stop output thread controller
I0814 23:40:13.285511 140017669055936 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:40:13.285698 140016760895232 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:40:13.285871 140016760895232 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:40:13.286072 140017669055936 error_handling.py:96] outfeed marked as finished
I0814 23:40:13.286226 140017669055936 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:40:42.655900 140017669055936 evaluation.py:275] Finished evaluation at 2019-08-14-23:40:42
I0814 23:40:42.656279 140017669055936 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9794, global_step = 30, loss = 0.059190564
I0814 23:40:47.258510 140017669055936 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:40:48.101527 140017669055936 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.059190564, 'global_step': 30, 'accuracy': 0.9794}

Removing gs://yangyou-mnist/log/#1565825849027148...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565825862721823...
Removing gs://yangyou-mnist/log/checkpoint#1565825928042841...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565825849.v3-8-tpu#1565825931255673...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565825854394356...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565825924829819...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565825867410818...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565825861678034...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565825925742414...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565825930262832...
Removing gs://yangyou-mnist/log/eval/#1565826044406196...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565826044.v3-8-tpu#1565826047793028...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:40:52.017380 140553076241856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:40:52.018177 140553076241856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:40:52.020788 140553076241856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:40:52.021622 140553076241856 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:40:52.022223 140553076241856 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:40:52.022365 140553076241856 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:40:52.453557 140553076241856 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:40:52.461929 140553076241856 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:40:52.466295 140553076241856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:40:52.520888 140553076241856 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:40:52.521195 140553076241856 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:40:52.930762 140553076241856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:40:52.989269 140553076241856 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:40:52.989541 140553076241856 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:40:53.237452 140553076241856 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd4ea57c210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd4ec75b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:40:53.237901 140553076241856 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:40:53.557044 140553076241856 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:40:53.560000: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:40:53.573606 140553076241856 tpu_system_metadata.py:148] Found TPU system:
I0814 23:40:53.573849 140553076241856 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:40:53.574320 140553076241856 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:40:53.574384 140553076241856 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:40:53.574438 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:40:53.574731 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:40:53.574788 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:40:53.574837 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:40:53.574894 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:40:53.574942 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:40:53.574987 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:40:53.575037 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:40:53.575084 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:40:53.575134 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:40:53.575181 140553076241856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:40:53.581576 140553076241856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:40:53.594377 140553076241856 estimator.py:1145] Calling model_fn.
W0814 23:40:53.594993 140553076241856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:40:53.873317 140553076241856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:40:54.318705 140553076241856 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:40:54.381455 140553076241856 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:40:54.387885 140553076241856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:40:54.570991 140553076241856 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:40:54.585239 140553076241856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:40:54.597847 140553076241856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:40:54.598948 140553076241856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:40:54.606009 140553076241856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:40:54.611252 140553076241856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:40:54.611470 140553076241856 optimization.py:36] ++++++ warmup starts at step 0, for 14 steps ++++++
W0814 23:40:54.624046 140553076241856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:40:54.734445 140553076241856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:40:54.776731 140553076241856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:40:54.821469 140553076241856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:40:54.873930 140553076241856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:40:55.043517 140553076241856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:40:55.095237 140553076241856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:40:55.144264 140553076241856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:40:55.194298 140553076241856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:40:55.240037 140553076241856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:40:55.281656 140553076241856 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:40:55.298017 140553076241856 estimator.py:1147] Done calling model_fn.
I0814 23:40:58.900218 140553076241856 tpu_estimator.py:499] TPU job name worker
I0814 23:40:59.015223 140553076241856 monitored_session.py:240] Graph was finalized.
I0814 23:40:59.766954 140553076241856 session_manager.py:500] Running local_init_op.
I0814 23:40:59.822587 140553076241856 session_manager.py:502] Done running local_init_op.
I0814 23:41:02.619573 140553076241856 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:41:14.763394 140553076241856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:41:14.929425 140553076241856 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:41:14.929960 140553076241856 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:41:14.930399: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:41:14.935157 140553076241856 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:41:14.937442 140553076241856 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:41:14.941493 140553076241856 tpu_estimator.py:557] Init TPU system
I0814 23:41:56.113770 140553076241856 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 23:41:56.114639 140552180061952 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:41:56.115128 140552171669248 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:41:56.189502 140553076241856 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:41:56.190361 140553076241856 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:41:56.207627 140552163276544 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:41:56.570597 140552163276544 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:42:01.145651 140552171669248 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:42:06.047988 140553076241856 basic_session_run_hooks.py:262] loss = 0.08026331, step = 30
I0814 23:42:06.051187 140553076241856 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:42:20.126683 140553076241856 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:42:20.127021 140553076241856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:42:20.132349 140552180061952 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:42:20.132605 140552180061952 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:42:20.132826 140553076241856 error_handling.py:96] infeed marked as finished
I0814 23:42:20.132961 140553076241856 tpu_estimator.py:602] Stop output thread controller
I0814 23:42:20.133029 140553076241856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:42:20.133207 140552171669248 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:42:20.133295 140552171669248 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:42:20.133438 140553076241856 error_handling.py:96] outfeed marked as finished
I0814 23:42:20.133606 140553076241856 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:42:26.717772 140553076241856 estimator.py:368] Loss for final step: 0.08026331.
I0814 23:42:26.718641 140553076241856 error_handling.py:96] training_loop marked as finished
I0814 23:42:27.527968 140553076241856 estimator.py:1145] Calling model_fn.
E0814 23:42:28.245196 140553076241856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:42:28.475763 140553076241856 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:42:28.498825 140553076241856 estimator.py:1147] Done calling model_fn.
I0814 23:42:28.515862 140553076241856 evaluation.py:255] Starting evaluation at 2019-08-14T23:42:28Z
I0814 23:42:28.516102 140553076241856 tpu_estimator.py:499] TPU job name worker
I0814 23:42:28.611032 140553076241856 monitored_session.py:240] Graph was finalized.
W0814 23:42:28.611762 140553076241856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:42:28.824685 140553076241856 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:42:32.117623 140553076241856 session_manager.py:500] Running local_init_op.
I0814 23:42:32.148988 140553076241856 session_manager.py:502] Done running local_init_op.
I0814 23:42:32.206759 140553076241856 tpu_estimator.py:557] Init TPU system
I0814 23:43:40.096868 140553076241856 tpu_estimator.py:566] Initialized TPU in 67 seconds
I0814 23:43:40.097691 140552176391936 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:43:40.098186 140552167999232 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:43:40.166652 140553076241856 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:43:40.197715 140553076241856 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:43:40.198081 140553076241856 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:43:40.298294 140552154621696 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:43:40.565748 140552154621696 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:43:41.000941 140552167999232 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:43:41.432430 140553076241856 evaluation.py:167] Evaluation [10/10]
I0814 23:43:41.432849 140553076241856 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:43:41.432960 140553076241856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:43:41.433161 140552176391936 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:43:41.433279 140552176391936 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:43:41.433429 140553076241856 error_handling.py:96] infeed marked as finished
I0814 23:43:41.433545 140553076241856 tpu_estimator.py:602] Stop output thread controller
I0814 23:43:41.433593 140553076241856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:43:41.433712 140552167999232 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:43:41.433788 140552167999232 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:43:41.433902 140553076241856 error_handling.py:96] outfeed marked as finished
I0814 23:43:41.433980 140553076241856 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:44:10.657234 140553076241856 evaluation.py:275] Finished evaluation at 2019-08-14-23:44:10
I0814 23:44:10.657548 140553076241856 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9799, global_step = 30, loss = 0.06239597
I0814 23:44:15.107732 140553076241856 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:44:16.011282 140553076241856 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06239597, 'global_step': 30, 'accuracy': 0.9799}

Removing gs://yangyou-mnist/log/checkpoint#1565826136264144...
Removing gs://yangyou-mnist/log/#1565826056879237...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565826069787420...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565826057.v3-8-tpu#1565826139796330...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565826074205281...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565826062025250...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565826132976452...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565826133935192...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565826068905252...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565826138822148...
Removing gs://yangyou-mnist/log/eval/#1565826252335488...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565826252.v3-8-tpu#1565826255701604...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:44:19.967802 139867457652160 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:44:19.968651 139867457652160 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:44:19.971358 139867457652160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:44:19.972203 139867457652160 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:44:19.972884 139867457652160 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:44:19.973032 139867457652160 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:44:20.400082 139867457652160 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:44:20.407737 139867457652160 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:44:20.411993 139867457652160 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:44:20.535756 139867457652160 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:44:20.536037 139867457652160 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:44:20.863583 139867457652160 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:44:20.984178 139867457652160 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:44:20.984491 139867457652160 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:44:21.337213 139867457652160 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f35484a5050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f354a684210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:44:21.337595 139867457652160 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:44:21.659552 139867457652160 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:44:21.662496: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:44:21.675981 139867457652160 tpu_system_metadata.py:148] Found TPU system:
I0814 23:44:21.676232 139867457652160 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:44:21.676795 139867457652160 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:44:21.676855 139867457652160 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:44:21.676907 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:44:21.677201 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:44:21.677254 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:44:21.677304 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:44:21.677356 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:44:21.677418 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:44:21.677468 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:44:21.677515 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:44:21.677561 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:44:21.677613 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:44:21.677694 139867457652160 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:44:21.683886 139867457652160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:44:21.696743 139867457652160 estimator.py:1145] Calling model_fn.
W0814 23:44:21.697371 139867457652160 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:44:21.965431 139867457652160 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:44:22.415992 139867457652160 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:44:22.480807 139867457652160 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:44:22.487235 139867457652160 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:44:22.682449 139867457652160 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:44:22.697208 139867457652160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:44:22.710355 139867457652160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:44:22.711395 139867457652160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:44:22.718600 139867457652160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:44:22.724798 139867457652160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:44:22.725020 139867457652160 optimization.py:36] ++++++ warmup starts at step 0, for 14 steps ++++++
W0814 23:44:22.739336 139867457652160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:44:22.854720 139867457652160 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:44:22.898041 139867457652160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:44:22.945816 139867457652160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:44:22.999125 139867457652160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:44:23.168977 139867457652160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:44:23.222419 139867457652160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:44:23.273866 139867457652160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:44:23.326491 139867457652160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:44:23.374468 139867457652160 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:44:23.419697 139867457652160 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:44:23.436958 139867457652160 estimator.py:1147] Done calling model_fn.
I0814 23:44:27.091974 139867457652160 tpu_estimator.py:499] TPU job name worker
I0814 23:44:27.209389 139867457652160 monitored_session.py:240] Graph was finalized.
I0814 23:44:27.920773 139867457652160 session_manager.py:500] Running local_init_op.
I0814 23:44:27.970079 139867457652160 session_manager.py:502] Done running local_init_op.
I0814 23:44:30.931735 139867457652160 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:44:43.386873 139867457652160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:44:43.535924 139867457652160 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:44:43.536365 139867457652160 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:44:43.536799: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:44:43.541695 139867457652160 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:44:43.543828 139867457652160 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:44:43.548094 139867457652160 tpu_estimator.py:557] Init TPU system
I0814 23:45:24.028348 139867457652160 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 23:45:24.029185 139866762880768 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:45:24.029747 139866281080576 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:45:24.091325 139866272687872 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:45:24.100212 139867457652160 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:45:24.101694 139867457652160 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 23:45:24.398577 139866272687872 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:45:28.981651 139866281080576 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:45:33.306528 139867457652160 basic_session_run_hooks.py:262] loss = 0.08097915, step = 30
I0814 23:45:33.309329 139867457652160 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:45:46.812077 139867457652160 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:45:46.812501 139867457652160 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:45:46.814378 139866762880768 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:45:46.814573 139866762880768 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:45:46.814721 139867457652160 error_handling.py:96] infeed marked as finished
I0814 23:45:46.814920 139867457652160 tpu_estimator.py:602] Stop output thread controller
I0814 23:45:46.814990 139867457652160 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:45:46.815112 139866281080576 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:45:46.815191 139866281080576 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:45:46.815315 139867457652160 error_handling.py:96] outfeed marked as finished
I0814 23:45:46.815434 139867457652160 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:45:54.540868 139867457652160 estimator.py:368] Loss for final step: 0.08097915.
I0814 23:45:54.541630 139867457652160 error_handling.py:96] training_loop marked as finished
I0814 23:45:55.253120 139867457652160 estimator.py:1145] Calling model_fn.
E0814 23:45:55.951023 139867457652160 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:45:56.187248 139867457652160 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:45:56.210258 139867457652160 estimator.py:1147] Done calling model_fn.
I0814 23:45:56.228688 139867457652160 evaluation.py:255] Starting evaluation at 2019-08-14T23:45:56Z
I0814 23:45:56.228941 139867457652160 tpu_estimator.py:499] TPU job name worker
I0814 23:45:56.311424 139867457652160 monitored_session.py:240] Graph was finalized.
W0814 23:45:56.312199 139867457652160 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:45:56.522088 139867457652160 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:45:59.294069 139867457652160 session_manager.py:500] Running local_init_op.
I0814 23:45:59.319617 139867457652160 session_manager.py:502] Done running local_init_op.
I0814 23:45:59.376480 139867457652160 tpu_estimator.py:557] Init TPU system
I0814 23:47:08.015583 139867457652160 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:47:08.016541 139866281080576 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:47:08.017151 139866272687872 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:47:08.126229 139867457652160 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:47:08.156107 139867457652160 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:47:08.156492 139867457652160 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:47:08.249160 139866264295168 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:47:08.611737 139866264295168 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:47:08.970366 139866272687872 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:47:09.149759 139867457652160 evaluation.py:167] Evaluation [10/10]
I0814 23:47:09.150099 139867457652160 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:47:09.150170 139867457652160 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:47:09.150536 139866281080576 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:47:09.150743 139866281080576 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:47:09.150948 139867457652160 error_handling.py:96] infeed marked as finished
I0814 23:47:09.151058 139867457652160 tpu_estimator.py:602] Stop output thread controller
I0814 23:47:09.151129 139867457652160 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:47:09.151312 139866272687872 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:47:09.151408 139866272687872 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:47:09.151534 139867457652160 error_handling.py:96] outfeed marked as finished
I0814 23:47:09.151618 139867457652160 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:47:38.712815 139867457652160 evaluation.py:275] Finished evaluation at 2019-08-14-23:47:38
I0814 23:47:38.713219 139867457652160 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9812, global_step = 30, loss = 0.047376417
I0814 23:47:43.246771 139867457652160 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:47:44.068535 139867457652160 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.047376417, 'global_step': 30, 'accuracy': 0.9812}

Removing gs://yangyou-mnist/log/checkpoint#1565826343148703...
Removing gs://yangyou-mnist/log/#1565826265136401...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565826265.v3-8-tpu#1565826346483247...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565826278193424...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565826270346166...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565826282842069...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565826340007209...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565826277283438...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565826340840249...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565826345480847...
Removing gs://yangyou-mnist/log/eval/#1565826460467607...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565826460.v3-8-tpu#1565826463762434...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:47:47.974478 139789828126144 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:47:47.975485 139789828126144 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:47:47.978276 139789828126144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:47:47.979094 139789828126144 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:47:47.979656 139789828126144 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:47:47.979785 139789828126144 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:47:48.395045 139789828126144 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:47:48.402164 139789828126144 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:47:48.406409 139789828126144 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:47:48.457099 139789828126144 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:47:48.457386 139789828126144 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:47:48.793590 139789828126144 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:47:48.910768 139789828126144 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:47:48.911036 139789828126144 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:47:49.252289 139789828126144 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f233535c2d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f233753b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:47:49.252986 139789828126144 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:47:49.582241 139789828126144 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:47:49.585212: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:47:49.598294 139789828126144 tpu_system_metadata.py:148] Found TPU system:
I0814 23:47:49.598565 139789828126144 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:47:49.599076 139789828126144 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:47:49.599144 139789828126144 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:47:49.599199 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:47:49.599504 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:47:49.599571 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:47:49.599627 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:47:49.599677 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:47:49.599809 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:47:49.599870 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:47:49.599917 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:47:49.599965 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:47:49.600013 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:47:49.600061 139789828126144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:47:49.606523 139789828126144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:47:49.619496 139789828126144 estimator.py:1145] Calling model_fn.
W0814 23:47:49.620122 139789828126144 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:47:49.894331 139789828126144 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:47:50.360047 139789828126144 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:47:50.424120 139789828126144 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:47:50.430448 139789828126144 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:47:50.623274 139789828126144 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:47:50.637447 139789828126144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:47:50.649754 139789828126144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:47:50.650868 139789828126144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:47:50.658292 139789828126144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:47:50.663839 139789828126144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:47:50.664056 139789828126144 optimization.py:36] ++++++ warmup starts at step 0, for 14 steps ++++++
W0814 23:47:50.676641 139789828126144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:47:50.789647 139789828126144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:47:50.831916 139789828126144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:47:50.877243 139789828126144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:47:50.930016 139789828126144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:47:51.095504 139789828126144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:47:51.148977 139789828126144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:47:51.197921 139789828126144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:47:51.249999 139789828126144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:47:51.297173 139789828126144 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:47:51.340370 139789828126144 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:47:51.358077 139789828126144 estimator.py:1147] Done calling model_fn.
I0814 23:47:54.882353 139789828126144 tpu_estimator.py:499] TPU job name worker
I0814 23:47:54.994239 139789828126144 monitored_session.py:240] Graph was finalized.
I0814 23:47:55.672096 139789828126144 session_manager.py:500] Running local_init_op.
I0814 23:47:55.722822 139789828126144 session_manager.py:502] Done running local_init_op.
I0814 23:47:58.574923 139789828126144 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:48:10.825792 139789828126144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:48:10.989516 139789828126144 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:48:10.989928 139789828126144 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:48:10.990324: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:48:10.994997 139789828126144 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:48:10.997122 139789828126144 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:48:11.000550 139789828126144 tpu_estimator.py:557] Init TPU system
I0814 23:48:52.109919 139789828126144 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 23:48:52.111001 139789066024704 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:48:52.111651 139789057632000 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:48:52.197103 139789828126144 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:48:52.197968 139789828126144 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:48:52.276967 139789049239296 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:48:52.635582 139789049239296 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:48:57.061363 139789057632000 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:49:02.025110 139789828126144 basic_session_run_hooks.py:262] loss = 0.085934676, step = 30
I0814 23:49:02.027502 139789828126144 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:49:16.172669 139789828126144 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:49:16.172974 139789828126144 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:49:16.174377 139789066024704 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:49:16.174737 139789066024704 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:49:16.174952 139789828126144 error_handling.py:96] infeed marked as finished
I0814 23:49:16.175095 139789828126144 tpu_estimator.py:602] Stop output thread controller
I0814 23:49:16.175154 139789828126144 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:49:16.175287 139789057632000 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:49:16.175391 139789057632000 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:49:16.175542 139789828126144 error_handling.py:96] outfeed marked as finished
I0814 23:49:16.175637 139789828126144 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:49:22.781280 139789828126144 estimator.py:368] Loss for final step: 0.085934676.
I0814 23:49:22.782082 139789828126144 error_handling.py:96] training_loop marked as finished
I0814 23:49:23.605863 139789828126144 estimator.py:1145] Calling model_fn.
E0814 23:49:24.300800 139789828126144 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:49:24.525935 139789828126144 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:49:24.549017 139789828126144 estimator.py:1147] Done calling model_fn.
I0814 23:49:24.566740 139789828126144 evaluation.py:255] Starting evaluation at 2019-08-14T23:49:24Z
I0814 23:49:24.566970 139789828126144 tpu_estimator.py:499] TPU job name worker
I0814 23:49:24.647564 139789828126144 monitored_session.py:240] Graph was finalized.
W0814 23:49:24.648300 139789828126144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:49:24.850239 139789828126144 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:49:27.795145 139789828126144 session_manager.py:500] Running local_init_op.
I0814 23:49:27.820636 139789828126144 session_manager.py:502] Done running local_init_op.
I0814 23:49:27.880976 139789828126144 tpu_estimator.py:557] Init TPU system
I0814 23:50:36.104882 139789828126144 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:50:36.105849 139789062354688 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:50:36.106334 139789053961984 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:50:36.176202 139789828126144 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:50:36.205647 139789828126144 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:50:36.206057 139789828126144 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:50:36.246231 139788569016064 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:50:36.530214 139788569016064 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:50:37.004333 139789053961984 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:50:37.308062 139789828126144 evaluation.py:167] Evaluation [10/10]
I0814 23:50:37.308370 139789828126144 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:50:37.308485 139789828126144 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:50:37.308676 139789062354688 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:50:37.308783 139789062354688 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:50:37.308954 139789828126144 error_handling.py:96] infeed marked as finished
I0814 23:50:37.309065 139789828126144 tpu_estimator.py:602] Stop output thread controller
I0814 23:50:37.309118 139789828126144 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:50:37.309231 139789053961984 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:50:37.309407 139789053961984 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:50:37.309530 139789828126144 error_handling.py:96] outfeed marked as finished
I0814 23:50:37.309607 139789828126144 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:51:06.620102 139789828126144 evaluation.py:275] Finished evaluation at 2019-08-14-23:51:06
I0814 23:51:06.620461 139789828126144 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9797, global_step = 30, loss = 0.066890195
I0814 23:51:11.453609 139789828126144 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:51:12.321451 139789828126144 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.066890195, 'global_step': 30, 'accuracy': 0.9797}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565826485788711...
Removing gs://yangyou-mnist/log/checkpoint#1565826552404472...
Removing gs://yangyou-mnist/log/#1565826472861590...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565826490304607...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565826473.v3-8-tpu#1565826555864994...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565826477975996...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565826484891495...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565826550073177...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565826549159456...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565826554813490...
Removing gs://yangyou-mnist/log/eval/#1565826668343234...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565826668.v3-8-tpu#1565826672016808...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:51:16.251399 139971612218816 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:51:16.252198 139971612218816 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:51:16.254913 139971612218816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:51:16.255762 139971612218816 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:51:16.256381 139971612218816 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:51:16.256544 139971612218816 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:51:16.680221 139971612218816 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:51:16.687798 139971612218816 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:51:16.691889 139971612218816 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:51:16.812452 139971612218816 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:51:16.812762 139971612218816 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:51:17.229084 139971612218816 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:51:17.281621 139971612218816 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:51:17.281893 139971612218816 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:51:17.563486 139971612218816 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4d8862e190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4d8a80d210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:51:17.563945 139971612218816 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:51:17.898641 139971612218816 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:51:17.901473: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:51:17.918299 139971612218816 tpu_system_metadata.py:148] Found TPU system:
I0814 23:51:17.918591 139971612218816 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:51:17.919076 139971612218816 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:51:17.919137 139971612218816 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:51:17.919190 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:51:17.919469 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:51:17.919524 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:51:17.919574 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:51:17.919647 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:51:17.919697 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:51:17.919744 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:51:17.919790 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:51:17.919836 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:51:17.919883 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:51:17.919931 139971612218816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:51:17.926456 139971612218816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:51:17.939404 139971612218816 estimator.py:1145] Calling model_fn.
W0814 23:51:17.940054 139971612218816 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:51:18.251648 139971612218816 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:51:18.646867 139971612218816 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:51:18.709481 139971612218816 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:51:18.715493 139971612218816 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:51:18.899097 139971612218816 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:51:18.912890 139971612218816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:51:18.925789 139971612218816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:51:18.926899 139971612218816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:51:18.934082 139971612218816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:51:18.939392 139971612218816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:51:18.939605 139971612218816 optimization.py:36] ++++++ warmup starts at step 0, for 14 steps ++++++
W0814 23:51:18.952313 139971612218816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:51:19.065215 139971612218816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:51:19.108316 139971612218816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:51:19.158168 139971612218816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:51:19.209403 139971612218816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:51:19.383161 139971612218816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:51:19.434139 139971612218816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:51:19.482669 139971612218816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:51:19.533601 139971612218816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:51:19.579495 139971612218816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:51:19.620733 139971612218816 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:51:19.637033 139971612218816 estimator.py:1147] Done calling model_fn.
I0814 23:51:23.182955 139971612218816 tpu_estimator.py:499] TPU job name worker
I0814 23:51:23.300017 139971612218816 monitored_session.py:240] Graph was finalized.
I0814 23:51:23.967966 139971612218816 session_manager.py:500] Running local_init_op.
I0814 23:51:24.029983 139971612218816 session_manager.py:502] Done running local_init_op.
I0814 23:51:26.771393 139971612218816 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:51:38.992361 139971612218816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:51:39.163259 139971612218816 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:51:39.163763 139971612218816 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:51:39.164181: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:51:39.169481 139971612218816 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:51:39.171566 139971612218816 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:51:39.176048 139971612218816 tpu_estimator.py:557] Init TPU system
I0814 23:52:20.092392 139971612218816 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 23:52:20.093293 139970917447424 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:52:20.093868 139970434037504 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:52:20.157299 139970425644800 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:52:20.163918 139971612218816 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:52:20.164839 139971612218816 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 23:52:20.497870 139970425644800 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 23:52:25.010149 139970434037504 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:52:30.070307 139971612218816 basic_session_run_hooks.py:262] loss = 0.08474326, step = 30
I0814 23:52:30.073239 139971612218816 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:52:43.793176 139971612218816 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:52:43.793486 139971612218816 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:52:43.793720 139970917447424 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:52:43.793827 139970917447424 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:52:43.793972 139971612218816 error_handling.py:96] infeed marked as finished
I0814 23:52:43.794065 139971612218816 tpu_estimator.py:602] Stop output thread controller
I0814 23:52:43.794131 139971612218816 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:52:43.794250 139970434037504 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:52:43.794334 139970434037504 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:52:43.794450 139971612218816 error_handling.py:96] outfeed marked as finished
I0814 23:52:43.794536 139971612218816 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:52:50.627710 139971612218816 estimator.py:368] Loss for final step: 0.08474326.
I0814 23:52:50.628496 139971612218816 error_handling.py:96] training_loop marked as finished
I0814 23:52:51.330256 139971612218816 estimator.py:1145] Calling model_fn.
E0814 23:52:52.013386 139971612218816 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:52:52.254836 139971612218816 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:52:52.278445 139971612218816 estimator.py:1147] Done calling model_fn.
I0814 23:52:52.297535 139971612218816 evaluation.py:255] Starting evaluation at 2019-08-14T23:52:52Z
I0814 23:52:52.297763 139971612218816 tpu_estimator.py:499] TPU job name worker
I0814 23:52:52.382088 139971612218816 monitored_session.py:240] Graph was finalized.
W0814 23:52:52.382947 139971612218816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:52:52.630208 139971612218816 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:52:55.592008 139971612218816 session_manager.py:500] Running local_init_op.
I0814 23:52:55.623018 139971612218816 session_manager.py:502] Done running local_init_op.
I0814 23:52:55.678251 139971612218816 tpu_estimator.py:557] Init TPU system
I0814 23:54:04.064595 139971612218816 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:54:04.065495 139970434037504 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:54:04.065902 139970425644800 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:54:04.136085 139971612218816 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:54:04.162147 139971612218816 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:54:04.162573 139971612218816 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:54:04.196738 139970417252096 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:54:04.467983 139970417252096 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:54:04.969378 139970425644800 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:54:05.432677 139971612218816 evaluation.py:167] Evaluation [10/10]
I0814 23:54:05.433115 139971612218816 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:54:05.433199 139971612218816 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:54:05.433398 139970434037504 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:54:05.433497 139970434037504 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:54:05.433641 139971612218816 error_handling.py:96] infeed marked as finished
I0814 23:54:05.433753 139971612218816 tpu_estimator.py:602] Stop output thread controller
I0814 23:54:05.433804 139971612218816 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:54:05.433917 139970425644800 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:54:05.434010 139970425644800 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:54:05.434155 139971612218816 error_handling.py:96] outfeed marked as finished
I0814 23:54:05.434235 139971612218816 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:54:35.509732 139971612218816 evaluation.py:275] Finished evaluation at 2019-08-14-23:54:35
I0814 23:54:35.510092 139971612218816 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9799, global_step = 30, loss = 0.06480744
I0814 23:54:40.242994 139971612218816 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:54:41.078259 139971612218816 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06480744, 'global_step': 30, 'accuracy': 0.9799}

Removing gs://yangyou-mnist/log/#1565826681248713...
Removing gs://yangyou-mnist/log/checkpoint#1565826760196188...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565826681.v3-8-tpu#1565826763485326...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565826694164176...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565826686188952...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565826757160654...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565826698477783...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565826693114754...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565826758119092...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565826762469682...
Removing gs://yangyou-mnist/log/eval/#1565826877227494...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565826877.v3-8-tpu#1565826880756731...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:54:44.935517 140309420144064 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:54:44.936311 140309420144064 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:54:44.939043 140309420144064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:54:44.939888 140309420144064 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:54:44.940638 140309420144064 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:54:44.940794 140309420144064 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:54:45.367949 140309420144064 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:54:45.375650 140309420144064 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:54:45.380536 140309420144064 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:54:45.503963 140309420144064 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:54:45.504251 140309420144064 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:54:45.860915 140309420144064 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:54:45.912091 140309420144064 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:54:45.912373 140309420144064 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:54:46.164253 140309420144064 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f9c2f4eb0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f9c316cb210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:54:46.164757 140309420144064 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:54:46.500618 140309420144064 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:54:46.503466: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:54:46.516640 140309420144064 tpu_system_metadata.py:148] Found TPU system:
I0814 23:54:46.516895 140309420144064 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:54:46.517573 140309420144064 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:54:46.517637 140309420144064 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:54:46.517690 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:54:46.518003 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:54:46.518062 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:54:46.518124 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:54:46.518188 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:54:46.518244 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:54:46.518292 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:54:46.518338 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:54:46.518383 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:54:46.518429 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:54:46.518476 140309420144064 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:54:46.524563 140309420144064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:54:46.538052 140309420144064 estimator.py:1145] Calling model_fn.
W0814 23:54:46.538739 140309420144064 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:54:46.811858 140309420144064 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:54:47.225308 140309420144064 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:54:47.288024 140309420144064 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:54:47.293979 140309420144064 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:54:47.481611 140309420144064 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:54:47.496104 140309420144064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:54:47.508752 140309420144064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:54:47.509876 140309420144064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:54:47.517525 140309420144064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:54:47.523109 140309420144064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:54:47.523343 140309420144064 optimization.py:36] ++++++ warmup starts at step 0, for 14 steps ++++++
W0814 23:54:47.536478 140309420144064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:54:47.651767 140309420144064 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:54:47.694938 140309420144064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:54:47.741153 140309420144064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:54:47.793543 140309420144064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:54:47.958370 140309420144064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:54:48.011723 140309420144064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:54:48.062557 140309420144064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:54:48.124248 140309420144064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:54:48.173238 140309420144064 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:54:48.218043 140309420144064 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:54:48.235064 140309420144064 estimator.py:1147] Done calling model_fn.
I0814 23:54:51.830558 140309420144064 tpu_estimator.py:499] TPU job name worker
I0814 23:54:51.944211 140309420144064 monitored_session.py:240] Graph was finalized.
I0814 23:54:52.650238 140309420144064 session_manager.py:500] Running local_init_op.
I0814 23:54:52.712774 140309420144064 session_manager.py:502] Done running local_init_op.
I0814 23:54:55.449872 140309420144064 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:55:07.858530 140309420144064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:55:08.029041 140309420144064 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:55:08.029467 140309420144064 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:55:08.029872: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:55:08.035254 140309420144064 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:55:08.037389 140309420144064 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:55:08.041161 140309420144064 tpu_estimator.py:557] Init TPU system
I0814 23:55:48.132380 140309420144064 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 23:55:48.133519 140308385883904 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:55:48.134073 140308377491200 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:55:48.200886 140308369098496 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:55:48.205152 140309420144064 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:55:48.206048 140309420144064 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 23:55:48.432348 140308369098496 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:55:53.046142 140308377491200 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:55:57.977658 140309420144064 basic_session_run_hooks.py:262] loss = 0.08387905, step = 30
I0814 23:55:57.979964 140309420144064 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:56:11.562393 140309420144064 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:56:11.562690 140309420144064 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:56:11.562901 140308385883904 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:56:11.563000 140308385883904 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:56:11.563138 140309420144064 error_handling.py:96] infeed marked as finished
I0814 23:56:11.563240 140309420144064 tpu_estimator.py:602] Stop output thread controller
I0814 23:56:11.563297 140309420144064 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:56:11.563410 140308377491200 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:56:11.563498 140308377491200 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:56:11.563608 140309420144064 error_handling.py:96] outfeed marked as finished
I0814 23:56:11.563704 140309420144064 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:56:18.571671 140309420144064 estimator.py:368] Loss for final step: 0.08387905.
I0814 23:56:18.572572 140309420144064 error_handling.py:96] training_loop marked as finished
I0814 23:56:19.384752 140309420144064 estimator.py:1145] Calling model_fn.
E0814 23:56:20.064553 140309420144064 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:56:20.298304 140309420144064 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:56:20.320288 140309420144064 estimator.py:1147] Done calling model_fn.
I0814 23:56:20.337860 140309420144064 evaluation.py:255] Starting evaluation at 2019-08-14T23:56:20Z
I0814 23:56:20.338092 140309420144064 tpu_estimator.py:499] TPU job name worker
I0814 23:56:20.417589 140309420144064 monitored_session.py:240] Graph was finalized.
W0814 23:56:20.418324 140309420144064 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:56:20.622745 140309420144064 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:56:23.353996 140309420144064 session_manager.py:500] Running local_init_op.
I0814 23:56:23.385178 140309420144064 session_manager.py:502] Done running local_init_op.
I0814 23:56:23.439680 140309420144064 tpu_estimator.py:557] Init TPU system
I0814 23:57:32.067682 140309420144064 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 23:57:32.068511 140308385883904 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:57:32.069010 140308377491200 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:57:32.135613 140309420144064 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:57:32.164783 140309420144064 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 23:57:32.165160 140309420144064 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 23:57:32.202744 140308369098496 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:57:32.468202 140308369098496 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:57:32.963793 140308377491200 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:57:33.292865 140309420144064 evaluation.py:167] Evaluation [10/10]
I0814 23:57:33.293215 140309420144064 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:57:33.293303 140309420144064 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:57:33.293495 140308385883904 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:57:33.293601 140308385883904 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:57:33.293783 140309420144064 error_handling.py:96] infeed marked as finished
I0814 23:57:33.293880 140309420144064 tpu_estimator.py:602] Stop output thread controller
I0814 23:57:33.293927 140309420144064 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:57:33.294048 140308377491200 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:57:33.294131 140308377491200 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:57:33.294258 140309420144064 error_handling.py:96] outfeed marked as finished
I0814 23:57:33.294332 140309420144064 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:58:02.567831 140309420144064 evaluation.py:275] Finished evaluation at 2019-08-14-23:58:02
I0814 23:58:02.568151 140309420144064 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9788, global_step = 30, loss = 0.06687545
I0814 23:58:07.090142 140309420144064 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 23:58:08.022681 140309420144064 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06687545, 'global_step': 30, 'accuracy': 0.9788}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565826903032228...
Removing gs://yangyou-mnist/log/#1565826889837118...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565826907343416...
Removing gs://yangyou-mnist/log/checkpoint#1565826967967661...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565826964873186...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565826890.v3-8-tpu#1565826971244716...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565826894868355...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565826965775630...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565826902001295...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565826970187131...
Removing gs://yangyou-mnist/log/eval/#1565827084374929...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565827084.v3-8-tpu#1565827087716493...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 23:58:11.869858 139742142154176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 23:58:11.870676 139742142154176 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 23:58:11.873321 139742142154176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 23:58:11.874145 139742142154176 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 23:58:11.874692 139742142154176 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 23:58:11.874826 139742142154176 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 23:58:12.289110 139742142154176 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 23:58:12.299516 139742142154176 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 23:58:12.304591 139742142154176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:58:12.362263 139742142154176 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:58:12.362560 139742142154176 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:58:12.507944 139742142154176 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 23:58:12.627326 139742142154176 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 23:58:12.627603 139742142154176 transport.py:157] Attempting refresh to obtain initial access_token
I0814 23:58:13.085987 139742142154176 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f181ae78290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f181d058210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 23:58:13.086457 139742142154176 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 23:58:13.422456 139742142154176 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 23:58:13.425220: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:58:13.437591 139742142154176 tpu_system_metadata.py:148] Found TPU system:
I0814 23:58:13.437834 139742142154176 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 23:58:13.438304 139742142154176 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 23:58:13.438363 139742142154176 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 23:58:13.438416 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 23:58:13.438714 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 23:58:13.438770 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 23:58:13.438819 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 23:58:13.438868 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 23:58:13.438915 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 23:58:13.438962 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 23:58:13.439008 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 23:58:13.439054 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 23:58:13.439101 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 23:58:13.439153 139742142154176 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 23:58:13.445425 139742142154176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 23:58:13.458425 139742142154176 estimator.py:1145] Calling model_fn.
W0814 23:58:13.459038 139742142154176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 23:58:13.747535 139742142154176 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 23:58:14.203347 139742142154176 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 23:58:14.265855 139742142154176 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 23:58:14.272066 139742142154176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:58:14.454154 139742142154176 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 23:58:14.468267 139742142154176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 23:58:14.480525 139742142154176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 23:58:14.481595 139742142154176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 23:58:14.488651 139742142154176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 23:58:14.493910 139742142154176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 23:58:14.494121 139742142154176 optimization.py:36] ++++++ warmup starts at step 0, for 15 steps ++++++
W0814 23:58:14.506486 139742142154176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 23:58:14.616704 139742142154176 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 23:58:14.657958 139742142154176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:58:14.702739 139742142154176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:58:14.754924 139742142154176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:58:14.915550 139742142154176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:58:14.965955 139742142154176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:58:15.014648 139742142154176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:58:15.064733 139742142154176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:58:15.111572 139742142154176 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 23:58:15.153645 139742142154176 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 23:58:15.169737 139742142154176 estimator.py:1147] Done calling model_fn.
I0814 23:58:18.697979 139742142154176 tpu_estimator.py:499] TPU job name worker
I0814 23:58:18.812859 139742142154176 monitored_session.py:240] Graph was finalized.
I0814 23:58:19.513256 139742142154176 session_manager.py:500] Running local_init_op.
I0814 23:58:19.574448 139742142154176 session_manager.py:502] Done running local_init_op.
I0814 23:58:23.127996 139742142154176 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 23:58:35.572182 139742142154176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 23:58:35.724571 139742142154176 util.py:98] Initialized dataset iterators in 0 seconds
I0814 23:58:35.725008 139742142154176 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 23:58:35.725422: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 23:58:35.731470 139742142154176 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 23:58:35.733939 139742142154176 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 23:58:35.738172 139742142154176 tpu_estimator.py:557] Init TPU system
I0814 23:59:16.118244 139742142154176 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0814 23:59:16.119060 139741240481536 tpu_estimator.py:514] Starting infeed thread controller.
I0814 23:59:16.119570 139741232088832 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 23:59:16.185539 139742142154176 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 23:59:16.187061 139742142154176 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 23:59:16.189672 139741223696128 transport.py:157] Attempting refresh to obtain initial access_token
W0814 23:59:16.466181 139741223696128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 23:59:21.042570 139741232088832 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 23:59:25.683373 139742142154176 basic_session_run_hooks.py:262] loss = 0.09899815, step = 30
I0814 23:59:25.687199 139742142154176 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 23:59:39.397161 139742142154176 tpu_estimator.py:598] Stop infeed thread controller
I0814 23:59:39.397516 139742142154176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 23:59:39.397836 139741240481536 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 23:59:39.398176 139741240481536 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 23:59:39.398504 139742142154176 error_handling.py:96] infeed marked as finished
I0814 23:59:39.398737 139742142154176 tpu_estimator.py:602] Stop output thread controller
I0814 23:59:39.398807 139742142154176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 23:59:39.399025 139741232088832 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 23:59:39.399271 139741232088832 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 23:59:39.399497 139742142154176 error_handling.py:96] outfeed marked as finished
I0814 23:59:39.399645 139742142154176 tpu_estimator.py:606] Shutdown TPU system.
I0814 23:59:46.612452 139742142154176 estimator.py:368] Loss for final step: 0.09899815.
I0814 23:59:46.613399 139742142154176 error_handling.py:96] training_loop marked as finished
I0814 23:59:47.443763 139742142154176 estimator.py:1145] Calling model_fn.
E0814 23:59:48.194724 139742142154176 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 23:59:48.424734 139742142154176 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 23:59:48.447088 139742142154176 estimator.py:1147] Done calling model_fn.
I0814 23:59:48.465867 139742142154176 evaluation.py:255] Starting evaluation at 2019-08-14T23:59:48Z
I0814 23:59:48.466108 139742142154176 tpu_estimator.py:499] TPU job name worker
I0814 23:59:48.543802 139742142154176 monitored_session.py:240] Graph was finalized.
W0814 23:59:48.544536 139742142154176 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 23:59:48.753318 139742142154176 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 23:59:51.964946 139742142154176 session_manager.py:500] Running local_init_op.
I0814 23:59:51.990622 139742142154176 session_manager.py:502] Done running local_init_op.
I0814 23:59:52.041066 139742142154176 tpu_estimator.py:557] Init TPU system
I0815 00:01:00.101932 139742142154176 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:01:00.102819 139741240481536 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:01:00.103367 139741232088832 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:01:00.170854 139742142154176 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:01:00.196093 139742142154176 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:01:00.196487 139742142154176 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:01:00.301358 139741223696128 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:01:00.792849 139741223696128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:01:00.978590 139741232088832 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:01:01.402981 139742142154176 evaluation.py:167] Evaluation [10/10]
I0815 00:01:01.403422 139742142154176 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:01:01.403512 139742142154176 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:01:01.403788 139741240481536 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:01:01.403898 139741240481536 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:01:01.404051 139742142154176 error_handling.py:96] infeed marked as finished
I0815 00:01:01.404164 139742142154176 tpu_estimator.py:602] Stop output thread controller
I0815 00:01:01.404217 139742142154176 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:01:01.404337 139741232088832 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:01:01.404483 139741232088832 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:01:01.404613 139742142154176 error_handling.py:96] outfeed marked as finished
I0815 00:01:01.404705 139742142154176 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:01:30.892538 139742142154176 evaluation.py:275] Finished evaluation at 2019-08-15-00:01:30
I0815 00:01:30.892851 139742142154176 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9725, global_step = 30, loss = 0.09153467
I0815 00:01:35.199018 139742142154176 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:01:36.038990 139742142154176 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09153467, 'global_step': 30, 'accuracy': 0.9725}

Removing gs://yangyou-mnist/log/#1565827096748207...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565827173542489...
Removing gs://yangyou-mnist/log/checkpoint#1565827175914808...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565827110554199...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565827115053022...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565827172694680...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565827102545124...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565827096.v3-8-tpu#1565827179079972...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565827109557666...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565827178120860...
Removing gs://yangyou-mnist/log/eval/#1565827292556697...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565827292.v3-8-tpu#1565827295720041...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:01:39.902029 139935586231744 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:01:39.902823 139935586231744 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:01:39.905487 139935586231744 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:01:39.906322 139935586231744 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:01:39.906905 139935586231744 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:01:39.907037 139935586231744 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:01:40.324666 139935586231744 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:01:40.333967 139935586231744 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:01:40.338370 139935586231744 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:01:40.453784 139935586231744 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:01:40.454060 139935586231744 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:01:40.780390 139935586231744 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:01:40.902148 139935586231744 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:01:40.902453 139935586231744 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:01:41.246174 139935586231744 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f452511f150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f45272fe210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:01:41.246668 139935586231744 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:01:41.602464 139935586231744 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:01:41.605772: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:01:41.618796 139935586231744 tpu_system_metadata.py:148] Found TPU system:
I0815 00:01:41.619050 139935586231744 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:01:41.619631 139935586231744 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:01:41.619689 139935586231744 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:01:41.619743 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:01:41.620028 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:01:41.620085 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:01:41.620142 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:01:41.620189 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:01:41.620235 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:01:41.620282 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:01:41.620328 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:01:41.620373 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:01:41.620477 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:01:41.620553 139935586231744 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:01:41.626499 139935586231744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:01:41.639209 139935586231744 estimator.py:1145] Calling model_fn.
W0815 00:01:41.639823 139935586231744 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:01:41.913192 139935586231744 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:01:42.330240 139935586231744 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:01:42.395997 139935586231744 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:01:42.402544 139935586231744 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:01:42.588474 139935586231744 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:01:42.602499 139935586231744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:01:42.615226 139935586231744 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:01:42.616363 139935586231744 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:01:42.623859 139935586231744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:01:42.629419 139935586231744 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:01:42.629654 139935586231744 optimization.py:36] ++++++ warmup starts at step 0, for 15 steps ++++++
W0815 00:01:42.642256 139935586231744 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:01:42.752676 139935586231744 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:01:42.795593 139935586231744 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:01:42.840955 139935586231744 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:01:42.893146 139935586231744 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:01:43.056832 139935586231744 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:01:43.114547 139935586231744 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:01:43.164851 139935586231744 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:01:43.217700 139935586231744 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:01:43.266077 139935586231744 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:01:43.311062 139935586231744 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:01:43.328449 139935586231744 estimator.py:1147] Done calling model_fn.
I0815 00:01:46.940043 139935586231744 tpu_estimator.py:499] TPU job name worker
I0815 00:01:47.053289 139935586231744 monitored_session.py:240] Graph was finalized.
I0815 00:01:47.740639 139935586231744 session_manager.py:500] Running local_init_op.
I0815 00:01:47.810882 139935586231744 session_manager.py:502] Done running local_init_op.
I0815 00:01:50.587400 139935586231744 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:02:03.789918 139935586231744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:02:03.948190 139935586231744 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:02:03.948710 139935586231744 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:02:03.950419: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:02:03.955569 139935586231744 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:02:03.957813 139935586231744 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:02:03.962136 139935586231744 tpu_estimator.py:557] Init TPU system
I0815 00:02:44.076302 139935586231744 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 00:02:44.077353 139934824118016 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:02:44.077868 139934815725312 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:02:44.145347 139935586231744 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:02:44.146194 139935586231744 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 00:02:44.207214 139934329468672 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:02:44.530498 139934329468672 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0815 00:02:48.996679 139934815725312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:02:53.713027 139935586231744 basic_session_run_hooks.py:262] loss = 0.0947193, step = 30
I0815 00:02:53.715652 139935586231744 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:03:07.633622 139935586231744 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:03:07.633922 139935586231744 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:03:07.634151 139934824118016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:03:07.634289 139934824118016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:03:07.634438 139935586231744 error_handling.py:96] infeed marked as finished
I0815 00:03:07.634537 139935586231744 tpu_estimator.py:602] Stop output thread controller
I0815 00:03:07.634586 139935586231744 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:03:07.634701 139934815725312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:03:07.634778 139934815725312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:03:07.634893 139935586231744 error_handling.py:96] outfeed marked as finished
I0815 00:03:07.634979 139935586231744 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:03:14.674484 139935586231744 estimator.py:368] Loss for final step: 0.0947193.
I0815 00:03:14.675256 139935586231744 error_handling.py:96] training_loop marked as finished
I0815 00:03:15.483881 139935586231744 estimator.py:1145] Calling model_fn.
E0815 00:03:16.168299 139935586231744 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:03:16.407913 139935586231744 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:03:16.431062 139935586231744 estimator.py:1147] Done calling model_fn.
I0815 00:03:16.448290 139935586231744 evaluation.py:255] Starting evaluation at 2019-08-15T00:03:16Z
I0815 00:03:16.448586 139935586231744 tpu_estimator.py:499] TPU job name worker
I0815 00:03:16.527512 139935586231744 monitored_session.py:240] Graph was finalized.
W0815 00:03:16.528270 139935586231744 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:03:16.728667 139935586231744 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:03:19.490247 139935586231744 session_manager.py:500] Running local_init_op.
I0815 00:03:19.516745 139935586231744 session_manager.py:502] Done running local_init_op.
I0815 00:03:19.576205 139935586231744 tpu_estimator.py:557] Init TPU system
I0815 00:04:28.043201 139935586231744 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:04:28.044183 139934820448000 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:04:28.044723 139934329468672 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:04:28.113506 139935586231744 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:04:28.140990 139935586231744 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:04:28.141341 139935586231744 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:04:28.181643 139934321075968 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:04:28.382448 139934321075968 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:04:28.931097 139934329468672 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:04:29.270792 139935586231744 evaluation.py:167] Evaluation [10/10]
I0815 00:04:29.271114 139935586231744 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:04:29.271212 139935586231744 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:04:29.271389 139934820448000 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:04:29.271482 139934820448000 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:04:29.271720 139935586231744 error_handling.py:96] infeed marked as finished
I0815 00:04:29.271841 139935586231744 tpu_estimator.py:602] Stop output thread controller
I0815 00:04:29.271893 139935586231744 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:04:29.272030 139934329468672 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:04:29.272104 139934329468672 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:04:29.272228 139935586231744 error_handling.py:96] outfeed marked as finished
I0815 00:04:29.272309 139935586231744 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:04:58.483422 139935586231744 evaluation.py:275] Finished evaluation at 2019-08-15-00:04:58
I0815 00:04:58.483761 139935586231744 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9772, global_step = 30, loss = 0.07147947
I0815 00:05:03.081214 139935586231744 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:05:03.894537 139935586231744 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07147947, 'global_step': 30, 'accuracy': 0.9772}

Removing gs://yangyou-mnist/log/checkpoint#1565827383960231...
Removing gs://yangyou-mnist/log/#1565827304915512...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565827305.v3-8-tpu#1565827387325988...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565827310000832...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565827317127608...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565827318029687...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565827323278084...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565827380843293...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565827381787617...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565827386302056...
Removing gs://yangyou-mnist/log/eval/#1565827500213401...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565827500.v3-8-tpu#1565827503581148...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:05:07.734900 140695833556416 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:05:07.735688 140695833556416 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:05:07.738360 140695833556416 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:05:07.739197 140695833556416 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:05:07.739779 140695833556416 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:05:07.739907 140695833556416 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:05:08.153095 140695833556416 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:05:08.161283 140695833556416 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:05:08.165623 140695833556416 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:05:08.222014 140695833556416 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:05:08.222299 140695833556416 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:05:08.701411 140695833556416 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:05:08.821065 140695833556416 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:05:08.821357 140695833556416 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:05:09.004604 140695833556416 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff627561510>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff6297571d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:05:09.004961 140695833556416 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:05:09.338088 140695833556416 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:05:09.341200: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:05:09.355629 140695833556416 tpu_system_metadata.py:148] Found TPU system:
I0815 00:05:09.355900 140695833556416 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:05:09.356654 140695833556416 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:05:09.356746 140695833556416 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:05:09.356806 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:05:09.357193 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:05:09.357276 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:05:09.357335 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:05:09.357398 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:05:09.357450 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:05:09.357502 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:05:09.357563 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:05:09.357624 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:05:09.357676 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:05:09.357732 140695833556416 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:05:09.364162 140695833556416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:05:09.377842 140695833556416 estimator.py:1145] Calling model_fn.
W0815 00:05:09.378467 140695833556416 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:05:09.655951 140695833556416 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:05:10.087129 140695833556416 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:05:10.149804 140695833556416 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:05:10.155865 140695833556416 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:05:10.340955 140695833556416 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:05:10.354846 140695833556416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:05:10.366772 140695833556416 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:05:10.367821 140695833556416 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:05:10.375214 140695833556416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:05:10.380382 140695833556416 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:05:10.380659 140695833556416 optimization.py:36] ++++++ warmup starts at step 0, for 15 steps ++++++
W0815 00:05:10.393189 140695833556416 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:05:10.502378 140695833556416 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:05:10.544092 140695833556416 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:05:10.588709 140695833556416 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:05:10.639687 140695833556416 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:05:10.798989 140695833556416 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:05:10.849268 140695833556416 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:05:10.897916 140695833556416 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:05:10.947547 140695833556416 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:05:10.992336 140695833556416 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:05:11.033838 140695833556416 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:05:11.050332 140695833556416 estimator.py:1147] Done calling model_fn.
I0815 00:05:14.634700 140695833556416 tpu_estimator.py:499] TPU job name worker
I0815 00:05:14.747421 140695833556416 monitored_session.py:240] Graph was finalized.
I0815 00:05:15.439703 140695833556416 session_manager.py:500] Running local_init_op.
I0815 00:05:15.493267 140695833556416 session_manager.py:502] Done running local_init_op.
I0815 00:05:18.240681 140695833556416 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:05:30.636918 140695833556416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:05:30.830683 140695833556416 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:05:30.831104 140695833556416 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:05:30.831503: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:05:30.836433 140695833556416 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:05:30.838617 140695833556416 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:05:30.843485 140695833556416 tpu_estimator.py:557] Init TPU system
I0815 00:06:12.133208 140695833556416 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0815 00:06:12.134109 140694798722816 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:06:12.134668 140694790330112 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:06:12.205355 140695833556416 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:06:12.207658 140695833556416 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 00:06:12.211844 140694781937408 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:06:12.429435 140694781937408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:06:17.006768 140694790330112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:06:21.342189 140695833556416 basic_session_run_hooks.py:262] loss = 0.07081814, step = 30
I0815 00:06:21.344357 140695833556416 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:06:35.592334 140695833556416 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:06:35.592703 140695833556416 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:06:35.594039 140694798722816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:06:35.594285 140694798722816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:06:35.594440 140695833556416 error_handling.py:96] infeed marked as finished
I0815 00:06:35.594615 140695833556416 tpu_estimator.py:602] Stop output thread controller
I0815 00:06:35.594804 140695833556416 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:06:35.594940 140694790330112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:06:35.595019 140694790330112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:06:35.595139 140695833556416 error_handling.py:96] outfeed marked as finished
I0815 00:06:35.595221 140695833556416 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:06:42.571654 140695833556416 estimator.py:368] Loss for final step: 0.07081814.
I0815 00:06:42.572465 140695833556416 error_handling.py:96] training_loop marked as finished
I0815 00:06:43.387684 140695833556416 estimator.py:1145] Calling model_fn.
E0815 00:06:44.078879 140695833556416 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:06:44.308468 140695833556416 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:06:44.329888 140695833556416 estimator.py:1147] Done calling model_fn.
I0815 00:06:44.346038 140695833556416 evaluation.py:255] Starting evaluation at 2019-08-15T00:06:44Z
I0815 00:06:44.346282 140695833556416 tpu_estimator.py:499] TPU job name worker
I0815 00:06:44.423814 140695833556416 monitored_session.py:240] Graph was finalized.
W0815 00:06:44.424598 140695833556416 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:06:44.624651 140695833556416 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:06:47.633074 140695833556416 session_manager.py:500] Running local_init_op.
I0815 00:06:47.663547 140695833556416 session_manager.py:502] Done running local_init_op.
I0815 00:06:47.718910 140695833556416 tpu_estimator.py:557] Init TPU system
I0815 00:07:56.081113 140695833556416 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:07:56.082304 140694798722816 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:07:56.083339 140694790330112 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:07:56.153639 140695833556416 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:07:56.184287 140695833556416 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:07:56.184698 140695833556416 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:07:56.284254 140694781937408 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:07:56.611955 140694781937408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:07:57.011032 140694790330112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:07:57.357654 140695833556416 evaluation.py:167] Evaluation [10/10]
I0815 00:07:57.358010 140695833556416 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:07:57.358078 140695833556416 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:07:57.358376 140694798722816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:07:57.358659 140694798722816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:07:57.358902 140695833556416 error_handling.py:96] infeed marked as finished
I0815 00:07:57.359112 140695833556416 tpu_estimator.py:602] Stop output thread controller
I0815 00:07:57.359180 140695833556416 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:07:57.359369 140694790330112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:07:57.359572 140694790330112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:07:57.359760 140695833556416 error_handling.py:96] outfeed marked as finished
I0815 00:07:57.359936 140695833556416 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:08:26.709449 140695833556416 evaluation.py:275] Finished evaluation at 2019-08-15-00:08:26
I0815 00:08:26.709795 140695833556416 estimator.py:2039] Saving dict for global step 30: accuracy = 0.982, global_step = 30, loss = 0.056797795
I0815 00:08:30.959810 140695833556416 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:08:31.770358 140695833556416 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.056797795, 'global_step': 30, 'accuracy': 0.982}

Removing gs://yangyou-mnist/log/#1565827512646093...
Removing gs://yangyou-mnist/log/checkpoint#1565827591937559...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565827512.v3-8-tpu#1565827595287785...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565827517649521...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565827525541150...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565827524682878...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565827530115360...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565827588633542...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565827589615696...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565827594154758...
Removing gs://yangyou-mnist/log/eval/#1565827708413010...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565827708.v3-8-tpu#1565827711480694...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:08:35.458686 139659599259072 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:08:35.459487 139659599259072 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:08:35.462039 139659599259072 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:08:35.462847 139659599259072 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:08:35.463419 139659599259072 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:08:35.463553 139659599259072 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:08:35.876971 139659599259072 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:08:35.885247 139659599259072 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:08:35.889636 139659599259072 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:08:35.943224 139659599259072 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:08:35.943492 139659599259072 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:08:36.136255 139659599259072 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:08:36.192528 139659599259072 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:08:36.192823 139659599259072 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:08:36.491679 139659599259072 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f04e2f6f050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f04e514e210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:08:36.492052 139659599259072 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:08:36.798599 139659599259072 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:08:36.801523: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:08:36.814707 139659599259072 tpu_system_metadata.py:148] Found TPU system:
I0815 00:08:36.814977 139659599259072 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:08:36.815470 139659599259072 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:08:36.815530 139659599259072 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:08:36.815583 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:08:36.815902 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:08:36.815962 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:08:36.816013 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:08:36.816061 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:08:36.816112 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:08:36.816164 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:08:36.816210 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:08:36.816354 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:08:36.816462 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:08:36.816515 139659599259072 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:08:36.822752 139659599259072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:08:36.836097 139659599259072 estimator.py:1145] Calling model_fn.
W0815 00:08:36.836774 139659599259072 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:08:37.179132 139659599259072 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:08:37.602777 139659599259072 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:08:37.667026 139659599259072 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:08:37.673181 139659599259072 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:08:37.858146 139659599259072 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:08:37.872081 139659599259072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:08:37.884438 139659599259072 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:08:37.885608 139659599259072 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:08:37.893291 139659599259072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:08:37.898585 139659599259072 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:08:37.898802 139659599259072 optimization.py:36] ++++++ warmup starts at step 0, for 15 steps ++++++
W0815 00:08:37.911986 139659599259072 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:08:38.023623 139659599259072 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:08:38.066929 139659599259072 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:08:38.113038 139659599259072 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:08:38.166517 139659599259072 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:08:38.338079 139659599259072 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:08:38.390198 139659599259072 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:08:38.440784 139659599259072 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:08:38.491930 139659599259072 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:08:38.539026 139659599259072 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:08:38.581412 139659599259072 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:08:38.597811 139659599259072 estimator.py:1147] Done calling model_fn.
I0815 00:08:42.015423 139659599259072 tpu_estimator.py:499] TPU job name worker
I0815 00:08:42.132267 139659599259072 monitored_session.py:240] Graph was finalized.
I0815 00:08:42.787564 139659599259072 session_manager.py:500] Running local_init_op.
I0815 00:08:42.851381 139659599259072 session_manager.py:502] Done running local_init_op.
I0815 00:08:45.712862 139659599259072 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:08:57.526607 139659599259072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:08:57.694983 139659599259072 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:08:57.695431 139659599259072 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:08:57.695838: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:08:57.700037 139659599259072 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:08:57.702101 139659599259072 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:08:57.705566 139659599259072 tpu_estimator.py:557] Init TPU system
I0815 00:09:40.116017 139659599259072 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0815 00:09:40.117214 139658696578816 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:09:40.118184 139658688186112 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:09:40.201142 139659599259072 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:09:40.201980 139659599259072 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 00:09:40.261110 139658679793408 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:09:40.668389 139658679793408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:09:45.010545 139658688186112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:09:49.746526 139659599259072 basic_session_run_hooks.py:262] loss = 0.079164185, step = 30
I0815 00:09:49.749239 139659599259072 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:10:03.963978 139659599259072 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:10:03.964323 139659599259072 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:10:03.964636 139658696578816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:10:03.965043 139658696578816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:10:03.965390 139659599259072 error_handling.py:96] infeed marked as finished
I0815 00:10:03.965584 139659599259072 tpu_estimator.py:602] Stop output thread controller
I0815 00:10:03.965646 139659599259072 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:10:03.965889 139658688186112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:10:03.966089 139658688186112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:10:03.966254 139659599259072 error_handling.py:96] outfeed marked as finished
I0815 00:10:03.966440 139659599259072 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:10:10.810493 139659599259072 estimator.py:368] Loss for final step: 0.079164185.
I0815 00:10:10.811372 139659599259072 error_handling.py:96] training_loop marked as finished
I0815 00:10:11.622773 139659599259072 estimator.py:1145] Calling model_fn.
E0815 00:10:12.313472 139659599259072 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:10:12.531800 139659599259072 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:10:12.552963 139659599259072 estimator.py:1147] Done calling model_fn.
I0815 00:10:12.569597 139659599259072 evaluation.py:255] Starting evaluation at 2019-08-15T00:10:12Z
I0815 00:10:12.569847 139659599259072 tpu_estimator.py:499] TPU job name worker
I0815 00:10:12.645956 139659599259072 monitored_session.py:240] Graph was finalized.
W0815 00:10:12.646711 139659599259072 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:10:12.851728 139659599259072 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:10:15.780338 139659599259072 session_manager.py:500] Running local_init_op.
I0815 00:10:15.811917 139659599259072 session_manager.py:502] Done running local_init_op.
I0815 00:10:15.868689 139659599259072 tpu_estimator.py:557] Init TPU system
I0815 00:11:24.053874 139659599259072 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:11:24.054929 139658696578816 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:11:24.055694 139658688186112 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:11:24.124424 139659599259072 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:11:24.155071 139659599259072 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:11:24.155474 139659599259072 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:11:24.191149 139658679793408 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:11:24.669373 139658679793408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:11:24.909852 139658688186112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:11:25.401328 139659599259072 evaluation.py:167] Evaluation [10/10]
I0815 00:11:25.401659 139659599259072 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:11:25.401737 139659599259072 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:11:25.401940 139658696578816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:11:25.402034 139658696578816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:11:25.402194 139659599259072 error_handling.py:96] infeed marked as finished
I0815 00:11:25.402298 139659599259072 tpu_estimator.py:602] Stop output thread controller
I0815 00:11:25.402348 139659599259072 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:11:25.402481 139658688186112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:11:25.402556 139658688186112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:11:25.402764 139659599259072 error_handling.py:96] outfeed marked as finished
I0815 00:11:25.402858 139659599259072 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:11:54.774930 139659599259072 evaluation.py:275] Finished evaluation at 2019-08-15-00:11:54
I0815 00:11:54.775289 139659599259072 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9815, global_step = 30, loss = 0.046163436
I0815 00:11:59.410831 139659599259072 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:12:00.241143 139659599259072 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.046163436, 'global_step': 30, 'accuracy': 0.9815}

Removing gs://yangyou-mnist/log/#1565827720102379...
Removing gs://yangyou-mnist/log/checkpoint#1565827800214433...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565827720.v3-8-tpu#1565827803570193...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565827732072248...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565827737070078...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565827725178397...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565827732829321...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565827797981801...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565827796933638...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565827802566552...
Removing gs://yangyou-mnist/log/eval/#1565827916489444...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565827916.v3-8-tpu#1565827919926460...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:12:04.124056 139713532540352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:12:04.124991 139713532540352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:12:04.127547 139713532540352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:12:04.128356 139713532540352 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:12:04.128993 139713532540352 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:12:04.129122 139713532540352 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:12:04.548063 139713532540352 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:12:04.555160 139713532540352 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:12:04.559099 139713532540352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:12:04.616358 139713532540352 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:12:04.616702 139713532540352 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:12:05.004633 139713532540352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:12:05.119643 139713532540352 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:12:05.119972 139713532540352 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:12:05.467478 139713532540352 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1171a38190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1173c17210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:12:05.467818 139713532540352 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:12:05.800734 139713532540352 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:12:05.803524: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:12:05.817461 139713532540352 tpu_system_metadata.py:148] Found TPU system:
I0815 00:12:05.817694 139713532540352 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:12:05.818183 139713532540352 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:12:05.818252 139713532540352 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:12:05.818305 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:12:05.818694 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:12:05.818758 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:12:05.818808 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:12:05.818857 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:12:05.818906 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:12:05.818953 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:12:05.819000 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:12:05.819065 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:12:05.819117 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:12:05.819173 139713532540352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:12:05.825395 139713532540352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:12:05.838253 139713532540352 estimator.py:1145] Calling model_fn.
W0815 00:12:05.838880 139713532540352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:12:06.108263 139713532540352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:12:06.541605 139713532540352 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:12:06.603856 139713532540352 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:12:06.609909 139713532540352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:12:06.790962 139713532540352 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:12:06.804894 139713532540352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:12:06.817120 139713532540352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:12:06.818259 139713532540352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:12:06.825510 139713532540352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:12:06.830904 139713532540352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:12:06.831146 139713532540352 optimization.py:36] ++++++ warmup starts at step 0, for 15 steps ++++++
W0815 00:12:06.843975 139713532540352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:12:06.954896 139713532540352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:12:06.997132 139713532540352 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:12:07.041666 139713532540352 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:12:07.093558 139713532540352 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:12:07.267637 139713532540352 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:12:07.319917 139713532540352 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:12:07.370088 139713532540352 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:12:07.421907 139713532540352 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:12:07.469408 139713532540352 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:12:07.510902 139713532540352 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:12:07.527127 139713532540352 estimator.py:1147] Done calling model_fn.
I0815 00:12:11.151794 139713532540352 tpu_estimator.py:499] TPU job name worker
I0815 00:12:11.268750 139713532540352 monitored_session.py:240] Graph was finalized.
I0815 00:12:11.939661 139713532540352 session_manager.py:500] Running local_init_op.
I0815 00:12:11.991727 139713532540352 session_manager.py:502] Done running local_init_op.
I0815 00:12:14.705284 139713532540352 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:12:27.092797 139713532540352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:12:27.237135 139713532540352 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:12:27.237546 139713532540352 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:12:27.237931: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:12:27.243156 139713532540352 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:12:27.245480 139713532540352 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:12:27.250082 139713532540352 tpu_estimator.py:557] Init TPU system
I0815 00:13:08.084081 139713532540352 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 00:13:08.085067 139712636372736 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:13:08.085544 139712627980032 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:13:08.154320 139713532540352 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:13:08.155164 139713532540352 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 00:13:08.208673 139712619587328 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:13:08.475361 139712619587328 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:13:13.010325 139712627980032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:13:18.015285 139713532540352 basic_session_run_hooks.py:262] loss = 0.082278155, step = 30
I0815 00:13:18.017354 139713532540352 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:13:34.271977 139713532540352 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:13:34.272284 139713532540352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:13:34.272610 139712636372736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:13:34.272932 139712636372736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:13:34.273181 139713532540352 error_handling.py:96] infeed marked as finished
I0815 00:13:34.273451 139713532540352 tpu_estimator.py:602] Stop output thread controller
I0815 00:13:34.273514 139713532540352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:13:34.273689 139712627980032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:13:34.273870 139712627980032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:13:34.274045 139713532540352 error_handling.py:96] outfeed marked as finished
I0815 00:13:34.274183 139713532540352 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:13:38.617625 139713532540352 estimator.py:368] Loss for final step: 0.082278155.
I0815 00:13:38.618396 139713532540352 error_handling.py:96] training_loop marked as finished
I0815 00:13:39.537862 139713532540352 estimator.py:1145] Calling model_fn.
E0815 00:13:40.238487 139713532540352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:13:40.467941 139713532540352 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:13:40.489634 139713532540352 estimator.py:1147] Done calling model_fn.
I0815 00:13:40.506737 139713532540352 evaluation.py:255] Starting evaluation at 2019-08-15T00:13:40Z
I0815 00:13:40.506961 139713532540352 tpu_estimator.py:499] TPU job name worker
I0815 00:13:40.589199 139713532540352 monitored_session.py:240] Graph was finalized.
W0815 00:13:40.589916 139713532540352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:13:40.799351 139713532540352 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:13:43.558406 139713532540352 session_manager.py:500] Running local_init_op.
I0815 00:13:43.583523 139713532540352 session_manager.py:502] Done running local_init_op.
I0815 00:13:43.640104 139713532540352 tpu_estimator.py:557] Init TPU system
I0815 00:14:52.104274 139713532540352 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:14:52.105118 139712632702720 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:14:52.105561 139712624310016 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:14:52.171350 139713532540352 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:14:52.195797 139713532540352 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:14:52.196228 139713532540352 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:14:52.234003 139712610932480 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:14:52.478384 139712610932480 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:14:52.970393 139712624310016 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:14:53.426080 139713532540352 evaluation.py:167] Evaluation [10/10]
I0815 00:14:53.426448 139713532540352 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:14:53.426527 139713532540352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:14:53.426706 139712632702720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:14:53.426824 139712632702720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:14:53.426992 139713532540352 error_handling.py:96] infeed marked as finished
I0815 00:14:53.427089 139713532540352 tpu_estimator.py:602] Stop output thread controller
I0815 00:14:53.427136 139713532540352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:14:53.427263 139712624310016 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:14:53.427333 139712624310016 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:14:53.427442 139713532540352 error_handling.py:96] outfeed marked as finished
I0815 00:14:53.427516 139713532540352 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:15:22.576673 139713532540352 evaluation.py:275] Finished evaluation at 2019-08-15-00:15:22
I0815 00:15:22.576994 139713532540352 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9773, global_step = 30, loss = 0.079178646
I0815 00:15:26.975802 139713532540352 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:15:27.789949 139713532540352 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.079178646, 'global_step': 30, 'accuracy': 0.9773}

Removing gs://yangyou-mnist/log/#1565827929090942...
Removing gs://yangyou-mnist/log/checkpoint#1565828010685428...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565827929.v3-8-tpu#1565828013964117...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565827934121956...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565827941122519...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565827942101842...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565827946579339...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565828005403550...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565828006424758...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565828012953998...
Removing gs://yangyou-mnist/log/eval/#1565828124219793...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565828124.v3-8-tpu#1565828127480290...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:15:31.667337 140545507988928 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:15:31.668113 140545507988928 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:15:31.670779 140545507988928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:15:31.671633 140545507988928 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:15:31.672230 140545507988928 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:15:31.672362 140545507988928 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:15:32.081296 140545507988928 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:15:32.089628 140545507988928 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:15:32.093832 140545507988928 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:15:32.213485 140545507988928 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:15:32.213771 140545507988928 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:15:32.397846 140545507988928 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:15:32.517060 140545507988928 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:15:32.517343 140545507988928 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:15:32.907994 140545507988928 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd3273d6190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd3295b5210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:15:32.908452 140545507988928 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:15:33.222392 140545507988928 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:15:33.225181: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:15:33.237605 140545507988928 tpu_system_metadata.py:148] Found TPU system:
I0815 00:15:33.237854 140545507988928 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:15:33.238440 140545507988928 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:15:33.238497 140545507988928 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:15:33.238550 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:15:33.238862 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:15:33.238919 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:15:33.238970 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:15:33.239020 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:15:33.239067 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:15:33.239124 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:15:33.239170 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:15:33.239217 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:15:33.239264 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:15:33.239311 140545507988928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:15:33.245311 140545507988928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:15:33.257818 140545507988928 estimator.py:1145] Calling model_fn.
W0815 00:15:33.258430 140545507988928 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:15:33.539494 140545507988928 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:15:33.942456 140545507988928 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:15:34.005430 140545507988928 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:15:34.011544 140545507988928 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:15:34.199110 140545507988928 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:15:34.213129 140545507988928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:15:34.225125 140545507988928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:15:34.226216 140545507988928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:15:34.233393 140545507988928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:15:34.238639 140545507988928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:15:34.238856 140545507988928 optimization.py:36] ++++++ warmup starts at step 0, for 15 steps ++++++
W0815 00:15:34.251507 140545507988928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:15:34.362221 140545507988928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:15:34.405030 140545507988928 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:15:34.450251 140545507988928 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:15:34.502584 140545507988928 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:15:34.664380 140545507988928 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:15:34.715007 140545507988928 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:15:34.764252 140545507988928 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:15:34.815357 140545507988928 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:15:34.861251 140545507988928 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:15:34.903829 140545507988928 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:15:34.920249 140545507988928 estimator.py:1147] Done calling model_fn.
I0815 00:15:38.436459 140545507988928 tpu_estimator.py:499] TPU job name worker
I0815 00:15:38.547776 140545507988928 monitored_session.py:240] Graph was finalized.
I0815 00:15:39.246793 140545507988928 session_manager.py:500] Running local_init_op.
I0815 00:15:39.296057 140545507988928 session_manager.py:502] Done running local_init_op.
I0815 00:15:42.139369 140545507988928 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:15:55.108164 140545507988928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:15:55.267365 140545507988928 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:15:55.267786 140545507988928 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:15:55.268191: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:15:55.273766 140545507988928 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:15:55.275901 140545507988928 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:15:55.280761 140545507988928 tpu_estimator.py:557] Init TPU system
I0815 00:16:36.029678 140545507988928 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 00:16:36.030661 140544474867456 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:16:36.031148 140544466474752 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:16:36.098261 140545507988928 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:16:36.099031 140545507988928 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 00:16:36.160465 140544458082048 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:16:36.395438 140544458082048 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0815 00:16:40.887658 140544466474752 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:16:45.896312 140545507988928 basic_session_run_hooks.py:262] loss = 0.06690515, step = 30
I0815 00:16:45.898870 140545507988928 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:16:59.884036 140545507988928 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:16:59.884397 140545507988928 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:16:59.886013 140544474867456 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:16:59.886193 140544474867456 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:16:59.886364 140545507988928 error_handling.py:96] infeed marked as finished
I0815 00:16:59.886498 140545507988928 tpu_estimator.py:602] Stop output thread controller
I0815 00:16:59.886559 140545507988928 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:16:59.887281 140544466474752 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:16:59.887447 140544466474752 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:16:59.887602 140545507988928 error_handling.py:96] outfeed marked as finished
I0815 00:16:59.887711 140545507988928 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:17:06.536020 140545507988928 estimator.py:368] Loss for final step: 0.06690515.
I0815 00:17:06.536864 140545507988928 error_handling.py:96] training_loop marked as finished
I0815 00:17:07.328623 140545507988928 estimator.py:1145] Calling model_fn.
E0815 00:17:08.023478 140545507988928 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:17:08.251815 140545507988928 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:17:08.274147 140545507988928 estimator.py:1147] Done calling model_fn.
I0815 00:17:08.291301 140545507988928 evaluation.py:255] Starting evaluation at 2019-08-15T00:17:08Z
I0815 00:17:08.291529 140545507988928 tpu_estimator.py:499] TPU job name worker
I0815 00:17:08.370666 140545507988928 monitored_session.py:240] Graph was finalized.
W0815 00:17:08.371387 140545507988928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:17:08.583417 140545507988928 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:17:11.426943 140545507988928 session_manager.py:500] Running local_init_op.
I0815 00:17:11.457637 140545507988928 session_manager.py:502] Done running local_init_op.
I0815 00:17:11.511594 140545507988928 tpu_estimator.py:557] Init TPU system
I0815 00:18:20.114320 140545507988928 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:18:20.115272 140544473556736 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:18:20.115734 140544465164032 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:18:20.183334 140545507988928 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:18:20.212969 140545507988928 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:18:20.213313 140545507988928 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:18:20.251069 140544456771328 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:18:20.583327 140544456771328 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:18:20.998626 140544465164032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:18:21.436489 140545507988928 evaluation.py:167] Evaluation [10/10]
I0815 00:18:21.436815 140545507988928 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:18:21.436885 140545507988928 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:18:21.437175 140544473556736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:18:21.437314 140544473556736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:18:21.437469 140545507988928 error_handling.py:96] infeed marked as finished
I0815 00:18:21.437561 140545507988928 tpu_estimator.py:602] Stop output thread controller
I0815 00:18:21.437706 140545507988928 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:18:21.437832 140544465164032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:18:21.437916 140544465164032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:18:21.438029 140545507988928 error_handling.py:96] outfeed marked as finished
I0815 00:18:21.438111 140545507988928 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:18:50.679802 140545507988928 evaluation.py:275] Finished evaluation at 2019-08-15-00:18:50
I0815 00:18:50.680134 140545507988928 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9795, global_step = 30, loss = 0.06124426
I0815 00:18:55.115752 140545507988928 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:18:55.923681 140545507988928 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06124426, 'global_step': 30, 'accuracy': 0.9795}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565828149723565...
Removing gs://yangyou-mnist/log/#1565828136536856...
Removing gs://yangyou-mnist/log/checkpoint#1565828215945848...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565828141553370...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565828213644955...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565828154593966...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565828136.v3-8-tpu#1565828219576067...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565828212777691...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565828148804553...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565828218166151...
Removing gs://yangyou-mnist/log/eval/#1565828332338943...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565828332.v3-8-tpu#1565828335629090...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:18:59.649867 139658053227968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:18:59.650650 139658053227968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:18:59.653292 139658053227968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:18:59.654107 139658053227968 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:18:59.654663 139658053227968 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:18:59.654800 139658053227968 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:19:00.061000 139658053227968 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:19:00.080955 139658053227968 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:19:00.085280 139658053227968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:19:00.135668 139658053227968 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:19:00.135948 139658053227968 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:19:00.431652 139658053227968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:19:00.487976 139658053227968 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:19:00.488246 139658053227968 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:19:00.815022 139658053227968 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0486cef3d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0488ee5210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:19:00.815424 139658053227968 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:19:01.126086 139658053227968 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:19:01.129031: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:19:01.143632 139658053227968 tpu_system_metadata.py:148] Found TPU system:
I0815 00:19:01.143862 139658053227968 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:19:01.144354 139658053227968 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:19:01.144455 139658053227968 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:19:01.144520 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:19:01.144952 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:19:01.145011 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:19:01.145064 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:19:01.145122 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:19:01.145169 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:19:01.145217 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:19:01.145283 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:19:01.145332 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:19:01.145378 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:19:01.145428 139658053227968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:19:01.151513 139658053227968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:19:01.164278 139658053227968 estimator.py:1145] Calling model_fn.
W0815 00:19:01.164961 139658053227968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:19:01.458897 139658053227968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:19:01.928132 139658053227968 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:19:01.991010 139658053227968 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:19:01.997158 139658053227968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:19:02.183067 139658053227968 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:19:02.197578 139658053227968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:19:02.210124 139658053227968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:19:02.211225 139658053227968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:19:02.218494 139658053227968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:19:02.223810 139658053227968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:19:02.224030 139658053227968 optimization.py:36] ++++++ warmup starts at step 0, for 15 steps ++++++
W0815 00:19:02.237004 139658053227968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:19:02.351804 139658053227968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:19:02.395175 139658053227968 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:19:02.441179 139658053227968 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:19:02.493311 139658053227968 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:19:02.654370 139658053227968 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:19:02.705393 139658053227968 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:19:02.757282 139658053227968 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:19:02.808463 139658053227968 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:19:02.854928 139658053227968 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:19:02.897618 139658053227968 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:19:02.914216 139658053227968 estimator.py:1147] Done calling model_fn.
I0815 00:19:07.283087 139658053227968 tpu_estimator.py:499] TPU job name worker
I0815 00:19:07.399995 139658053227968 monitored_session.py:240] Graph was finalized.
I0815 00:19:08.100450 139658053227968 session_manager.py:500] Running local_init_op.
I0815 00:19:08.149080 139658053227968 session_manager.py:502] Done running local_init_op.
I0815 00:19:10.912470 139658053227968 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:19:22.582514 139658053227968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:19:22.735223 139658053227968 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:19:22.735637 139658053227968 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:19:22.736120: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:19:22.740995 139658053227968 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:19:22.743186 139658053227968 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:19:22.747503 139658053227968 tpu_estimator.py:557] Init TPU system
I0815 00:20:04.125201 139658053227968 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0815 00:20:04.126091 139657153074944 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:20:04.126548 139657144682240 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:20:04.188220 139657136289536 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:20:04.190917 139658053227968 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:20:04.192085 139658053227968 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 00:20:04.639166 139657136289536 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0815 00:20:08.933324 139657144682240 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:20:13.784476 139658053227968 basic_session_run_hooks.py:262] loss = 0.1065869, step = 30
I0815 00:20:13.786638 139658053227968 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:20:27.296870 139658053227968 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:20:27.297158 139658053227968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:20:27.297365 139657153074944 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:20:27.297468 139657153074944 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:20:27.297600 139658053227968 error_handling.py:96] infeed marked as finished
I0815 00:20:27.297696 139658053227968 tpu_estimator.py:602] Stop output thread controller
I0815 00:20:27.297755 139658053227968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:20:27.297868 139657144682240 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:20:27.297938 139657144682240 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:20:27.298047 139658053227968 error_handling.py:96] outfeed marked as finished
I0815 00:20:27.298130 139658053227968 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:20:34.784554 139658053227968 estimator.py:368] Loss for final step: 0.1065869.
I0815 00:20:34.785402 139658053227968 error_handling.py:96] training_loop marked as finished
I0815 00:20:35.703579 139658053227968 estimator.py:1145] Calling model_fn.
E0815 00:20:36.415824 139658053227968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:20:36.649238 139658053227968 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:20:36.671147 139658053227968 estimator.py:1147] Done calling model_fn.
I0815 00:20:36.687618 139658053227968 evaluation.py:255] Starting evaluation at 2019-08-15T00:20:36Z
I0815 00:20:36.687853 139658053227968 tpu_estimator.py:499] TPU job name worker
I0815 00:20:36.766490 139658053227968 monitored_session.py:240] Graph was finalized.
W0815 00:20:36.767251 139658053227968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:20:36.986474 139658053227968 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:20:39.649993 139658053227968 session_manager.py:500] Running local_init_op.
I0815 00:20:39.680666 139658053227968 session_manager.py:502] Done running local_init_op.
I0815 00:20:39.730560 139658053227968 tpu_estimator.py:557] Init TPU system
I0815 00:21:48.050873 139658053227968 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:21:48.051887 139657153074944 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:21:48.052341 139657144682240 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:21:48.124747 139658053227968 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:21:48.153302 139658053227968 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:21:48.153776 139658053227968 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:21:48.247755 139657136289536 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:21:48.603488 139657136289536 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:21:48.987036 139657144682240 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:21:49.192329 139658053227968 evaluation.py:167] Evaluation [10/10]
I0815 00:21:49.192675 139658053227968 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:21:49.192747 139658053227968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:21:49.192924 139657153074944 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:21:49.193025 139657153074944 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:21:49.193162 139658053227968 error_handling.py:96] infeed marked as finished
I0815 00:21:49.193347 139658053227968 tpu_estimator.py:602] Stop output thread controller
I0815 00:21:49.193406 139658053227968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:21:49.193531 139657144682240 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:21:49.193604 139657144682240 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:21:49.193722 139658053227968 error_handling.py:96] outfeed marked as finished
I0815 00:21:49.193798 139658053227968 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:22:18.704566 139658053227968 evaluation.py:275] Finished evaluation at 2019-08-15-00:22:18
I0815 00:22:18.704998 139658053227968 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9787, global_step = 30, loss = 0.062468946
I0815 00:22:23.529963 139658053227968 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:22:24.382958 139658053227968 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.062468946, 'global_step': 30, 'accuracy': 0.9787}

Removing gs://yangyou-mnist/log/#1565828345339894...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565828358021355...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565828345.v3-8-tpu#1565828426989386...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565828350381603...
Removing gs://yangyou-mnist/log/checkpoint#1565828423703999...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565828362116909...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565828357108996...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565828420820304...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565828421734402...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565828425907278...
Removing gs://yangyou-mnist/log/eval/#1565828540471609...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565828540.v3-8-tpu#1565828544056861...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:22:28.258543 140545640801728 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:22:28.259332 140545640801728 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:22:28.262021 140545640801728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:22:28.262847 140545640801728 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:22:28.263425 140545640801728 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:22:28.263555 140545640801728 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:22:28.673295 140545640801728 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:22:28.680088 140545640801728 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:22:28.684216 140545640801728 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:22:28.739180 140545640801728 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:22:28.739464 140545640801728 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:22:29.023077 140545640801728 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:22:29.139978 140545640801728 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:22:29.140254 140545640801728 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:22:29.646975 140545640801728 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd32f27f090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd33145e210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:22:29.647393 140545640801728 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:22:29.972709 140545640801728 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:22:29.975748: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:22:29.988794 140545640801728 tpu_system_metadata.py:148] Found TPU system:
I0815 00:22:29.989026 140545640801728 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:22:29.989506 140545640801728 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:22:29.989564 140545640801728 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:22:29.989620 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:22:29.989896 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:22:29.989952 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:22:29.990003 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:22:29.990051 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:22:29.990107 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:22:29.990154 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:22:29.990216 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:22:29.990263 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:22:29.990329 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:22:29.990381 140545640801728 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:22:29.996171 140545640801728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:22:30.008590 140545640801728 estimator.py:1145] Calling model_fn.
W0815 00:22:30.009205 140545640801728 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:22:30.276170 140545640801728 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:22:30.890853 140545640801728 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:22:30.953752 140545640801728 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:22:30.959682 140545640801728 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:22:31.141376 140545640801728 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:22:31.155139 140545640801728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:22:31.167334 140545640801728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:22:31.168452 140545640801728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:22:31.175750 140545640801728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:22:31.181010 140545640801728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:22:31.181257 140545640801728 optimization.py:36] ++++++ warmup starts at step 0, for 15 steps ++++++
W0815 00:22:31.194175 140545640801728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:22:31.304758 140545640801728 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:22:31.346410 140545640801728 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:22:31.391278 140545640801728 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:22:31.443181 140545640801728 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:22:31.603879 140545640801728 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:22:31.654648 140545640801728 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:22:31.703566 140545640801728 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:22:31.754535 140545640801728 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:22:31.800698 140545640801728 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:22:31.842029 140545640801728 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:22:31.857960 140545640801728 estimator.py:1147] Done calling model_fn.
I0815 00:22:36.408514 140545640801728 tpu_estimator.py:499] TPU job name worker
I0815 00:22:36.519165 140545640801728 monitored_session.py:240] Graph was finalized.
I0815 00:22:37.201955 140545640801728 session_manager.py:500] Running local_init_op.
I0815 00:22:37.251321 140545640801728 session_manager.py:502] Done running local_init_op.
I0815 00:22:40.117060 140545640801728 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:22:53.997709 140545640801728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:22:54.141573 140545640801728 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:22:54.142085 140545640801728 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:22:54.142505: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:22:54.147358 140545640801728 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:22:54.149569 140545640801728 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:22:54.153543 140545640801728 tpu_estimator.py:557] Init TPU system
I0815 00:23:32.152131 140545640801728 tpu_estimator.py:566] Initialized TPU in 37 seconds
I0815 00:23:32.153038 140544877520640 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:23:32.153493 140544869127936 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:23:32.223285 140545640801728 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:23:32.224172 140545640801728 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 00:23:32.283519 140544860735232 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:23:32.611110 140544860735232 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:23:37.029587 140544869127936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:23:41.579113 140545640801728 basic_session_run_hooks.py:262] loss = 0.07208066, step = 30
I0815 00:23:41.581712 140545640801728 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:23:55.124648 140545640801728 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:23:55.124968 140545640801728 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:23:55.125197 140544877520640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:23:55.125310 140544877520640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:23:55.125478 140545640801728 error_handling.py:96] infeed marked as finished
I0815 00:23:55.125579 140545640801728 tpu_estimator.py:602] Stop output thread controller
I0815 00:23:55.125634 140545640801728 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:23:55.125768 140544869127936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:23:55.125855 140544869127936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:23:55.125986 140545640801728 error_handling.py:96] outfeed marked as finished
I0815 00:23:55.126070 140545640801728 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:24:02.756947 140545640801728 estimator.py:368] Loss for final step: 0.07208066.
I0815 00:24:02.757838 140545640801728 error_handling.py:96] training_loop marked as finished
I0815 00:24:03.594763 140545640801728 estimator.py:1145] Calling model_fn.
E0815 00:24:04.294486 140545640801728 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:24:04.522527 140545640801728 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:24:04.544449 140545640801728 estimator.py:1147] Done calling model_fn.
I0815 00:24:04.561934 140545640801728 evaluation.py:255] Starting evaluation at 2019-08-15T00:24:04Z
I0815 00:24:04.562172 140545640801728 tpu_estimator.py:499] TPU job name worker
I0815 00:24:04.641355 140545640801728 monitored_session.py:240] Graph was finalized.
W0815 00:24:04.642110 140545640801728 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:24:04.866964 140545640801728 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:24:07.946285 140545640801728 session_manager.py:500] Running local_init_op.
I0815 00:24:07.974147 140545640801728 session_manager.py:502] Done running local_init_op.
I0815 00:24:08.033207 140545640801728 tpu_estimator.py:557] Init TPU system
I0815 00:25:16.121859 140545640801728 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:25:16.122682 140544874899200 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:25:16.123805 140544866506496 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:25:16.195914 140545640801728 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:25:16.223942 140545640801728 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:25:16.224294 140545640801728 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:25:16.261898 140544858113792 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:25:16.573864 140544858113792 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:25:17.030036 140544866506496 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:25:17.473328 140545640801728 evaluation.py:167] Evaluation [10/10]
I0815 00:25:17.473642 140545640801728 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:25:17.473740 140545640801728 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:25:17.473932 140544874899200 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:25:17.474030 140544874899200 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:25:17.474167 140545640801728 error_handling.py:96] infeed marked as finished
I0815 00:25:17.474272 140545640801728 tpu_estimator.py:602] Stop output thread controller
I0815 00:25:17.474329 140545640801728 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:25:17.474450 140544866506496 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:25:17.474519 140544866506496 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:25:17.474642 140545640801728 error_handling.py:96] outfeed marked as finished
I0815 00:25:17.474716 140545640801728 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:25:46.646054 140545640801728 evaluation.py:275] Finished evaluation at 2019-08-15-00:25:46
I0815 00:25:46.646435 140545640801728 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9829, global_step = 30, loss = 0.05137498
I0815 00:25:51.178615 140545640801728 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:25:51.962889 140545640801728 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.05137498, 'global_step': 30, 'accuracy': 0.9829}

Removing gs://yangyou-mnist/log/#1565828554323751...
Removing gs://yangyou-mnist/log/checkpoint#1565828631481276...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565828559541708...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565828568948371...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565828554.v3-8-tpu#1565828634817367...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565828573490941...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565828628417953...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565828568097801...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565828629316894...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565828633741268...
Removing gs://yangyou-mnist/log/eval/#1565828748368193...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565828748.v3-8-tpu#1565828751653148...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:25:55.788064 140498105644480 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:25:55.788853 140498105644480 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:25:55.791426 140498105644480 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:25:55.792252 140498105644480 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:25:55.793329 140498105644480 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:25:55.793592 140498105644480 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:25:56.205904 140498105644480 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:25:56.212891 140498105644480 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:25:56.216928 140498105644480 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:25:56.271215 140498105644480 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:25:56.271516 140498105644480 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:25:56.632778 140498105644480 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:25:56.684020 140498105644480 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:25:56.684303 140498105644480 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:25:56.839152 140498105644480 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc81dd70190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc81ff4f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:25:56.839517 140498105644480 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:25:57.166387 140498105644480 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:25:57.169381: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:25:57.181907 140498105644480 tpu_system_metadata.py:148] Found TPU system:
I0815 00:25:57.182153 140498105644480 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:25:57.182631 140498105644480 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:25:57.182691 140498105644480 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:25:57.182743 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:25:57.183032 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:25:57.183087 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:25:57.183140 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:25:57.183193 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:25:57.183240 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:25:57.183286 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:25:57.183343 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:25:57.183393 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:25:57.183439 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:25:57.183492 140498105644480 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:25:57.189870 140498105644480 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:25:57.202934 140498105644480 estimator.py:1145] Calling model_fn.
W0815 00:25:57.203557 140498105644480 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:25:57.485852 140498105644480 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:25:57.924288 140498105644480 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:25:57.987782 140498105644480 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:25:57.993937 140498105644480 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:25:58.179533 140498105644480 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:25:58.193512 140498105644480 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:25:58.205933 140498105644480 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:25:58.207058 140498105644480 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:25:58.214272 140498105644480 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:25:58.219615 140498105644480 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:25:58.219841 140498105644480 optimization.py:36] ++++++ warmup starts at step 0, for 15 steps ++++++
W0815 00:25:58.232665 140498105644480 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:25:58.344808 140498105644480 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:25:58.387192 140498105644480 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:25:58.431579 140498105644480 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:25:58.483884 140498105644480 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:25:58.651398 140498105644480 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:25:58.702225 140498105644480 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:25:58.751518 140498105644480 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:25:58.802851 140498105644480 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:25:58.848742 140498105644480 optimization.py:160] *********** I'm using LAMB correction ***********
I0815 00:25:58.890839 140498105644480 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:25:58.907282 140498105644480 estimator.py:1147] Done calling model_fn.
I0815 00:26:02.468956 140498105644480 tpu_estimator.py:499] TPU job name worker
I0815 00:26:02.580637 140498105644480 monitored_session.py:240] Graph was finalized.
I0815 00:26:03.231570 140498105644480 session_manager.py:500] Running local_init_op.
I0815 00:26:03.292912 140498105644480 session_manager.py:502] Done running local_init_op.
I0815 00:26:05.929569 140498105644480 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:26:19.812612 140498105644480 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:26:19.976021 140498105644480 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:26:19.976507 140498105644480 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:26:19.976983: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:26:19.981564 140498105644480 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:26:19.983866 140498105644480 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:26:19.988581 140498105644480 tpu_estimator.py:557] Init TPU system
I0815 00:27:00.089695 140498105644480 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 00:27:00.090590 140497209509632 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:27:00.091089 140497201116928 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:27:00.157387 140497192724224 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:27:00.160362 140498105644480 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:27:00.161554 140498105644480 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 00:27:00.549634 140497192724224 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:27:04.927902 140497201116928 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:27:09.711611 140498105644480 basic_session_run_hooks.py:262] loss = 0.08832602, step = 30
I0815 00:27:09.714274 140498105644480 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:27:24.179183 140498105644480 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:27:24.179471 140498105644480 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:27:24.179712 140497209509632 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:27:24.179816 140497209509632 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:27:24.179949 140498105644480 error_handling.py:96] infeed marked as finished
I0815 00:27:24.180058 140498105644480 tpu_estimator.py:602] Stop output thread controller
I0815 00:27:24.180109 140498105644480 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:27:24.180227 140497201116928 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:27:24.180301 140497201116928 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:27:24.180438 140498105644480 error_handling.py:96] outfeed marked as finished
I0815 00:27:24.180524 140498105644480 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:27:30.689908 140498105644480 estimator.py:368] Loss for final step: 0.08832602.
I0815 00:27:30.690653 140498105644480 error_handling.py:96] training_loop marked as finished
I0815 00:27:31.417089 140498105644480 estimator.py:1145] Calling model_fn.
E0815 00:27:32.141211 140498105644480 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:27:32.373126 140498105644480 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:27:32.395136 140498105644480 estimator.py:1147] Done calling model_fn.
I0815 00:27:32.411140 140498105644480 evaluation.py:255] Starting evaluation at 2019-08-15T00:27:32Z
I0815 00:27:32.411391 140498105644480 tpu_estimator.py:499] TPU job name worker
I0815 00:27:32.488217 140498105644480 monitored_session.py:240] Graph was finalized.
W0815 00:27:32.488991 140498105644480 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:27:32.696078 140498105644480 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:27:35.434530 140498105644480 session_manager.py:500] Running local_init_op.
I0815 00:27:35.459626 140498105644480 session_manager.py:502] Done running local_init_op.
I0815 00:27:35.516350 140498105644480 tpu_estimator.py:557] Init TPU system
I0815 00:28:44.124530 140498105644480 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:28:44.125642 140497205839616 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:28:44.126524 140497197446912 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:28:44.192137 140498105644480 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:28:44.217327 140498105644480 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:28:44.217704 140498105644480 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:28:44.260123 140497184069376 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:28:44.691044 140497184069376 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:28:45.030975 140497197446912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:28:45.346963 140498105644480 evaluation.py:167] Evaluation [10/10]
I0815 00:28:45.347333 140498105644480 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:28:45.347402 140498105644480 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:28:45.347722 140497205839616 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:28:45.347994 140497205839616 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:28:45.348189 140498105644480 error_handling.py:96] infeed marked as finished
I0815 00:28:45.348349 140498105644480 tpu_estimator.py:602] Stop output thread controller
I0815 00:28:45.348438 140498105644480 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:28:45.348740 140497197446912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:28:45.348932 140497197446912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:28:45.349169 140498105644480 error_handling.py:96] outfeed marked as finished
I0815 00:28:45.349302 140498105644480 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:29:14.796777 140498105644480 evaluation.py:275] Finished evaluation at 2019-08-15-00:29:14
I0815 00:29:14.797131 140498105644480 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9793, global_step = 30, loss = 0.075973526
I0815 00:29:19.377892 140498105644480 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:29:20.243520 140498105644480 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.075973526, 'global_step': 30, 'accuracy': 0.9793}

