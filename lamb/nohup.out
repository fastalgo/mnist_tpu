Removing gs://yangyou-mnist/log/#1565747431497859...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565747431.v3-8-tpu#1565747433046929...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565747436176301...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565747444599666...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565747443746059...
/ [1/5 objects]  20% Done                                                       / [2/5 objects]  40% Done                                                       / [3/5 objects]  60% Done                                                       / [4/5 objects]  80% Done                                                       / [5/5 objects] 100% Done                                                       
Operation completed over 5 objects.                                              
WARNING: Logging before flag parsing goes to stderr.
W0814 16:21:16.328510 140211081029056 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:21:16.330463 140211081029056 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:21:16.342953 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:21:16.343923 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:21:16.344624 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:21:16.344773 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:21:18.333892 140211081029056 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:21:18.344458 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:21:18.353378 140211081029056 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:21:18.417675 140211081029056 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:21:18.417979 140211081029056 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:21:18.669539 140211081029056 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:21:18.731004 140211081029056 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:21:18.731329 140211081029056 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:21:18.916857 140211081029056 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8549d70110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f854bf4f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:21:18.917301 140211081029056 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:21:19.288325 140211081029056 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:21:19.308071: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:21:19.321408 140211081029056 tpu_system_metadata.py:148] Found TPU system:
I0814 16:21:19.321713 140211081029056 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:21:19.322419 140211081029056 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:21:19.322485 140211081029056 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:21:19.322540 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:21:19.322851 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:21:19.322911 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:21:19.322961 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:21:19.323009 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:21:19.323056 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:21:19.323103 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:21:19.323149 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:21:19.323195 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:21:19.323241 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:21:19.323288 140211081029056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:21:19.339828 140211081029056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:21:19.354680 140211081029056 estimator.py:1145] Calling model_fn.
W0814 16:21:19.355335 140211081029056 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:21:19.641606 140211081029056 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:21:20.274996 140211081029056 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:21:20.341911 140211081029056 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:21:20.348236 140211081029056 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:21:20.573867 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:21:20.591885 140211081029056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:21:20.604278 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:21:20.605405 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:21:20.612384 140211081029056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:21:20.617819 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:21:20.618037 140211081029056 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:21:20.630409 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:21:20.738734 140211081029056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:21:20.780198 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:20.823405 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:20.874546 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.050498 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.100583 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.148684 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.203104 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.252923 140211081029056 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:21:21.295394 140211081029056 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:21:21.312391 140211081029056 estimator.py:1147] Done calling model_fn.
I0814 16:21:26.230050 140211081029056 tpu_estimator.py:499] TPU job name worker
I0814 16:21:26.354476 140211081029056 monitored_session.py:240] Graph was finalized.
I0814 16:21:27.047481 140211081029056 session_manager.py:500] Running local_init_op.
I0814 16:21:27.093094 140211081029056 session_manager.py:502] Done running local_init_op.
I0814 16:21:29.956681 140211081029056 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:21:42.272557 140211081029056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:21:42.408632 140211081029056 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:21:42.409096 140211081029056 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:21:42.409499: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:21:42.415148 140211081029056 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:21:42.417566 140211081029056 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:21:42.422240 140211081029056 tpu_estimator.py:557] Init TPU system
I0814 16:21:48.262099 140211081029056 tpu_estimator.py:566] Initialized TPU in 5 seconds
I0814 16:21:48.263189 140210176505600 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:21:48.264127 140210168112896 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:21:48.329732 140211081029056 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:21:48.332658 140211081029056 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:21:48.338917 140210159720192 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:21:48.476588 140210159720192 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:21:52.993062 140210168112896 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:21:57.696084 140211081029056 basic_session_run_hooks.py:262] loss = 2.0994298, step = 30
I0814 16:21:57.699053 140211081029056 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:22:12.271256 140211081029056 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:22:12.271593 140211081029056 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:22:12.271929 140210176505600 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:22:12.272243 140210176505600 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:22:12.272525 140211081029056 error_handling.py:96] infeed marked as finished
I0814 16:22:12.272713 140211081029056 tpu_estimator.py:602] Stop output thread controller
I0814 16:22:12.272784 140211081029056 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:22:12.272963 140210168112896 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:22:12.273215 140210168112896 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:22:12.273392 140211081029056 error_handling.py:96] outfeed marked as finished
I0814 16:22:12.273540 140211081029056 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:22:18.620368 140211081029056 estimator.py:368] Loss for final step: 2.0994298.
I0814 16:22:18.621273 140211081029056 error_handling.py:96] training_loop marked as finished
I0814 16:22:19.412905 140211081029056 estimator.py:1145] Calling model_fn.
E0814 16:22:20.384497 140211081029056 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:22:20.611768 140211081029056 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:22:20.634953 140211081029056 estimator.py:1147] Done calling model_fn.
I0814 16:22:20.652703 140211081029056 evaluation.py:255] Starting evaluation at 2019-08-14T16:22:20Z
I0814 16:22:20.652945 140211081029056 tpu_estimator.py:499] TPU job name worker
I0814 16:22:20.730618 140211081029056 monitored_session.py:240] Graph was finalized.
W0814 16:22:20.731425 140211081029056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:22:20.962727 140211081029056 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:22:23.611254 140211081029056 session_manager.py:500] Running local_init_op.
I0814 16:22:23.640927 140211081029056 session_manager.py:502] Done running local_init_op.
I0814 16:22:23.694312 140211081029056 tpu_estimator.py:557] Init TPU system
I0814 16:22:32.737191 140211081029056 tpu_estimator.py:566] Initialized TPU in 9 seconds
I0814 16:22:32.737979 140210176505600 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:22:32.738413 140210168112896 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:22:32.805556 140211081029056 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:22:32.831245 140211081029056 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:22:32.831579 140211081029056 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:22:32.869374 140210159720192 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:22:32.994386 140210159720192 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:22:33.610512 140210168112896 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:22:33.914004 140211081029056 evaluation.py:167] Evaluation [10/10]
I0814 16:22:33.914349 140211081029056 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:22:33.914439 140211081029056 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:22:33.914747 140210176505600 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:22:33.914916 140210176505600 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:22:33.915102 140211081029056 error_handling.py:96] infeed marked as finished
I0814 16:22:33.915225 140211081029056 tpu_estimator.py:602] Stop output thread controller
I0814 16:22:33.915283 140211081029056 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:22:33.915422 140210168112896 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:22:33.915529 140210168112896 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:22:33.915654 140211081029056 error_handling.py:96] outfeed marked as finished
I0814 16:22:33.915745 140211081029056 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:23:03.090492 140211081029056 evaluation.py:275] Finished evaluation at 2019-08-14-16:23:03
I0814 16:23:03.090833 140211081029056 estimator.py:2039] Saving dict for global step 30: accuracy = 0.6976, global_step = 30, loss = 2.090587
I0814 16:23:07.908184 140211081029056 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:23:08.815372 140211081029056 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.090587, 'global_step': 30, 'accuracy': 0.6976}

Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565799701757555...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565799697127410...
Removing gs://yangyou-mnist/log/checkpoint#1565799728504061...
Removing gs://yangyou-mnist/log/#1565799684267172...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565799725115782...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565799684.v3-8-tpu#1565799731958635...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565799696229888...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565799689377634...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565799725997740...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565799730865336...
Removing gs://yangyou-mnist/log/eval/#1565799784808512...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565799785.v3-8-tpu#1565799788503416...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:23:12.647447 139807187346880 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:23:12.648221 139807187346880 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:23:12.651030 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:23:12.651894 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:23:12.652546 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:23:12.652697 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:23:13.067591 139807187346880 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:23:13.076519 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:23:13.081130 139807187346880 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:23:13.139605 139807187346880 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:23:13.139899 139807187346880 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:23:13.247442 139807187346880 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:23:13.366307 139807187346880 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:23:13.366605 139807187346880 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:23:13.483253 139807187346880 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f273fe67210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2742046210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:23:13.483594 139807187346880 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:23:13.816725 139807187346880 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:23:13.819667: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:23:13.832494 139807187346880 tpu_system_metadata.py:148] Found TPU system:
I0814 16:23:13.832746 139807187346880 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:23:13.833214 139807187346880 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:23:13.833273 139807187346880 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:23:13.833327 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:23:13.833610 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:23:13.833669 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:23:13.833720 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:23:13.833769 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:23:13.833816 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:23:13.833875 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:23:13.833925 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:23:13.833980 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:23:13.834027 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:23:13.834074 139807187346880 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:23:13.840368 139807187346880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:23:13.853189 139807187346880 estimator.py:1145] Calling model_fn.
W0814 16:23:13.853810 139807187346880 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:23:14.125209 139807187346880 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:23:14.530884 139807187346880 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:23:14.594314 139807187346880 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:23:14.600307 139807187346880 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:23:14.796947 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:23:14.811242 139807187346880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:23:14.823664 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:23:14.824769 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:23:14.832216 139807187346880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:23:14.837873 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:23:14.838090 139807187346880 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:23:14.851197 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:23:14.964210 139807187346880 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:23:15.006942 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.053287 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.106261 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.277242 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.330473 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.380485 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.433027 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.479639 139807187346880 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:23:15.522533 139807187346880 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:23:15.538980 139807187346880 estimator.py:1147] Done calling model_fn.
I0814 16:23:18.903049 139807187346880 tpu_estimator.py:499] TPU job name worker
I0814 16:23:19.016777 139807187346880 monitored_session.py:240] Graph was finalized.
I0814 16:23:19.682920 139807187346880 session_manager.py:500] Running local_init_op.
I0814 16:23:19.736210 139807187346880 session_manager.py:502] Done running local_init_op.
I0814 16:23:22.544645 139807187346880 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:23:34.908052 139807187346880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:23:35.046561 139807187346880 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:23:35.047032 139807187346880 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:23:35.047518: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:23:35.052654 139807187346880 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:23:35.054928 139807187346880 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:23:35.059647 139807187346880 tpu_estimator.py:557] Init TPU system
I0814 16:23:47.304795 139807187346880 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:23:47.305816 139806151538432 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:23:47.306737 139806143145728 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:23:47.371077 139807187346880 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:23:47.372040 139807187346880 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:23:47.435630 139806134753024 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:23:47.586621 139806134753024 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:23:52.072916 139806143145728 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:23:56.452114 139807187346880 basic_session_run_hooks.py:262] loss = 1.8751954, step = 30
I0814 16:23:56.454574 139807187346880 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:24:09.960062 139807187346880 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:24:09.960397 139807187346880 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:24:09.962105 139806151538432 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:24:09.962471 139806151538432 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:24:09.963345 139807187346880 error_handling.py:96] infeed marked as finished
I0814 16:24:09.963591 139807187346880 tpu_estimator.py:602] Stop output thread controller
I0814 16:24:09.963722 139807187346880 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:24:09.963915 139806143145728 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:24:09.964078 139806143145728 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:24:09.964245 139807187346880 error_handling.py:96] outfeed marked as finished
I0814 16:24:09.964376 139807187346880 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:24:17.724968 139807187346880 estimator.py:368] Loss for final step: 1.8751954.
I0814 16:24:17.725887 139807187346880 error_handling.py:96] training_loop marked as finished
I0814 16:24:18.440507 139807187346880 estimator.py:1145] Calling model_fn.
E0814 16:24:19.138159 139807187346880 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:24:19.369590 139807187346880 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:24:19.392792 139807187346880 estimator.py:1147] Done calling model_fn.
I0814 16:24:19.410521 139807187346880 evaluation.py:255] Starting evaluation at 2019-08-14T16:24:19Z
I0814 16:24:19.410769 139807187346880 tpu_estimator.py:499] TPU job name worker
I0814 16:24:19.491384 139807187346880 monitored_session.py:240] Graph was finalized.
W0814 16:24:19.492119 139807187346880 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:24:19.681451 139807187346880 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:24:22.244780 139807187346880 session_manager.py:500] Running local_init_op.
I0814 16:24:22.269366 139807187346880 session_manager.py:502] Done running local_init_op.
I0814 16:24:22.323884 139807187346880 tpu_estimator.py:557] Init TPU system
I0814 16:24:33.651722 139807187346880 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:24:33.652686 139806151538432 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:24:33.653898 139806143145728 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:24:33.719922 139807187346880 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:24:33.753943 139807187346880 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:24:33.754312 139807187346880 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:24:33.785062 139806134753024 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:24:33.908734 139806134753024 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:24:34.544770 139806143145728 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:24:34.846565 139807187346880 evaluation.py:167] Evaluation [10/10]
I0814 16:24:34.846895 139807187346880 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:24:34.846966 139807187346880 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:24:34.847208 139806151538432 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:24:34.847548 139806151538432 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:24:34.847733 139807187346880 error_handling.py:96] infeed marked as finished
I0814 16:24:34.847913 139807187346880 tpu_estimator.py:602] Stop output thread controller
I0814 16:24:34.847975 139807187346880 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:24:34.848125 139806143145728 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:24:34.848340 139806143145728 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:24:34.848661 139807187346880 error_handling.py:96] outfeed marked as finished
I0814 16:24:34.848850 139807187346880 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:25:04.011712 139807187346880 evaluation.py:275] Finished evaluation at 2019-08-14-16:25:04
I0814 16:25:04.012082 139807187346880 estimator.py:2039] Saving dict for global step 30: accuracy = 0.77, global_step = 30, loss = 1.8550341
I0814 16:25:08.654653 139807187346880 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:25:09.439197 139807187346880 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.8550341, 'global_step': 30, 'accuracy': 0.77}

Removing gs://yangyou-mnist/log/#1565799797086525...
Removing gs://yangyou-mnist/log/checkpoint#1565799846345839...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565799797.v3-8-tpu#1565799849645343...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565799808887892...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565799801956367...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565799843212672...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565799814383428...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565799809729058...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565799844117019...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565799848567204...
Removing gs://yangyou-mnist/log/eval/#1565799905844286...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565799906.v3-8-tpu#1565799909109359...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:25:13.342401 139797176632768 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:25:13.343194 139797176632768 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:25:13.345860 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:25:13.346698 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:25:13.347285 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:25:13.347414 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:25:13.757306 139797176632768 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:25:13.766930 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:25:13.771492 139797176632768 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:25:13.817085 139797176632768 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:25:13.817357 139797176632768 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:25:13.923451 139797176632768 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:25:13.982201 139797176632768 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:25:13.982489 139797176632768 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:25:14.085519 139797176632768 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f24eb35a2d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f24ed550210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:25:14.085885 139797176632768 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:25:14.458529 139797176632768 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:25:14.461741: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:25:14.473936 139797176632768 tpu_system_metadata.py:148] Found TPU system:
I0814 16:25:14.474267 139797176632768 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:25:14.474808 139797176632768 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:25:14.474867 139797176632768 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:25:14.474920 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:25:14.475223 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:25:14.475280 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:25:14.475331 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:25:14.475378 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:25:14.475425 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:25:14.475471 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:25:14.475517 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:25:14.475568 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:25:14.475615 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:25:14.475662 139797176632768 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:25:14.481645 139797176632768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:25:14.494385 139797176632768 estimator.py:1145] Calling model_fn.
W0814 16:25:14.494991 139797176632768 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:25:14.785408 139797176632768 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:25:15.336189 139797176632768 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:25:15.399009 139797176632768 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:25:15.405078 139797176632768 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:25:15.586766 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:25:15.600539 139797176632768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:25:15.612584 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:25:15.613652 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:25:15.621166 139797176632768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:25:15.626580 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:25:15.626796 139797176632768 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:25:15.639492 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:25:15.749501 139797176632768 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:25:15.791241 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:15.836585 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:15.889090 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.054248 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.105439 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.154901 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.207192 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.254262 139797176632768 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:25:16.297322 139797176632768 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:25:16.314104 139797176632768 estimator.py:1147] Done calling model_fn.
I0814 16:25:19.948261 139797176632768 tpu_estimator.py:499] TPU job name worker
I0814 16:25:20.061204 139797176632768 monitored_session.py:240] Graph was finalized.
I0814 16:25:20.734277 139797176632768 session_manager.py:500] Running local_init_op.
I0814 16:25:20.795780 139797176632768 session_manager.py:502] Done running local_init_op.
I0814 16:25:23.464164 139797176632768 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:25:35.775620 139797176632768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:25:35.931417 139797176632768 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:25:35.931852 139797176632768 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:25:35.932259: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:25:35.937156 139797176632768 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:25:35.939476 139797176632768 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:25:35.943749 139797176632768 tpu_estimator.py:557] Init TPU system
I0814 16:25:47.385360 139797176632768 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:25:47.386169 139796143924992 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:25:47.386626 139796135532288 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:25:47.442461 139796127139584 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:25:47.449800 139797176632768 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:25:47.452008 139797176632768 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:25:47.556119 139796127139584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:25:52.140136 139796135532288 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:25:56.742628 139797176632768 basic_session_run_hooks.py:262] loss = 1.285434, step = 30
I0814 16:25:56.745057 139797176632768 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:26:10.794018 139797176632768 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:26:10.794317 139797176632768 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:26:10.794532 139796143924992 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:26:10.794646 139796143924992 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:26:10.794785 139797176632768 error_handling.py:96] infeed marked as finished
I0814 16:26:10.794895 139797176632768 tpu_estimator.py:602] Stop output thread controller
I0814 16:26:10.794945 139797176632768 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:26:10.795054 139796135532288 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:26:10.795135 139796135532288 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:26:10.795242 139797176632768 error_handling.py:96] outfeed marked as finished
I0814 16:26:10.795316 139797176632768 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:26:17.671432 139797176632768 estimator.py:368] Loss for final step: 1.285434.
I0814 16:26:17.672239 139797176632768 error_handling.py:96] training_loop marked as finished
I0814 16:26:18.507708 139797176632768 estimator.py:1145] Calling model_fn.
E0814 16:26:19.225023 139797176632768 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:26:19.455071 139797176632768 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:26:19.477771 139797176632768 estimator.py:1147] Done calling model_fn.
I0814 16:26:19.496800 139797176632768 evaluation.py:255] Starting evaluation at 2019-08-14T16:26:19Z
I0814 16:26:19.497050 139797176632768 tpu_estimator.py:499] TPU job name worker
I0814 16:26:19.579277 139797176632768 monitored_session.py:240] Graph was finalized.
W0814 16:26:19.580044 139797176632768 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:26:19.771220 139797176632768 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:26:22.290710 139797176632768 session_manager.py:500] Running local_init_op.
I0814 16:26:22.322113 139797176632768 session_manager.py:502] Done running local_init_op.
I0814 16:26:22.373693 139797176632768 tpu_estimator.py:557] Init TPU system
I0814 16:26:33.866260 139797176632768 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:26:33.867074 139796142352128 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:26:33.867548 139796133959424 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:26:33.932017 139797176632768 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:26:33.961030 139797176632768 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:26:33.961395 139797176632768 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:26:33.996833 139796125566720 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:26:34.203754 139796125566720 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:26:34.718810 139796133959424 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:26:35.236888 139797176632768 evaluation.py:167] Evaluation [10/10]
I0814 16:26:35.237211 139797176632768 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:26:35.237313 139797176632768 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:26:35.237504 139796142352128 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:26:35.237605 139796142352128 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:26:35.237843 139797176632768 error_handling.py:96] infeed marked as finished
I0814 16:26:35.238035 139797176632768 tpu_estimator.py:602] Stop output thread controller
I0814 16:26:35.238097 139797176632768 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:26:35.238245 139796133959424 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:26:35.238334 139796133959424 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:26:35.238466 139797176632768 error_handling.py:96] outfeed marked as finished
I0814 16:26:35.238554 139797176632768 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:27:04.299556 139797176632768 evaluation.py:275] Finished evaluation at 2019-08-14-16:27:04
I0814 16:27:04.299880 139797176632768 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8083, global_step = 30, loss = 1.240481
I0814 16:27:08.868134 139797176632768 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:27:09.696660 139797176632768 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.240481, 'global_step': 30, 'accuracy': 0.8083}

Removing gs://yangyou-mnist/log/#1565799917814623...
Removing gs://yangyou-mnist/log/checkpoint#1565799967202028...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565799930778848...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565799935257674...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565799918.v3-8-tpu#1565799970488868...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565799964068370...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565799964920734...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565799929874147...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565799922878754...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565799969427109...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800026.v3-8-tpu#1565800029387205...
Removing gs://yangyou-mnist/log/eval/#1565800025992759...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:27:13.514928 139863409300928 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:27:13.515726 139863409300928 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:27:13.518907 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:27:13.519782 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:27:13.520586 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:27:13.520733 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:27:13.932854 139863409300928 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:27:13.941929 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:27:13.946146 139863409300928 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:27:14.000932 139863409300928 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:27:14.001226 139863409300928 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:27:14.101975 139863409300928 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:27:14.146533 139863409300928 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:27:14.146812 139863409300928 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:27:14.253304 139863409300928 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3456fd6250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f34591b5210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:27:14.253681 139863409300928 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:27:14.582792 139863409300928 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:27:14.585812: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:27:14.598027 139863409300928 tpu_system_metadata.py:148] Found TPU system:
I0814 16:27:14.598278 139863409300928 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:27:14.598752 139863409300928 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:27:14.598815 139863409300928 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:27:14.598870 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:27:14.599159 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:27:14.599216 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:27:14.599267 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:27:14.599317 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:27:14.599364 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:27:14.599412 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:27:14.599459 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:27:14.599505 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:27:14.599631 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:27:14.599694 139863409300928 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:27:14.605755 139863409300928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:27:14.618480 139863409300928 estimator.py:1145] Calling model_fn.
W0814 16:27:14.619106 139863409300928 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:27:14.885938 139863409300928 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:27:15.312357 139863409300928 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:27:15.373940 139863409300928 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:27:15.379707 139863409300928 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:27:15.557609 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:27:15.571078 139863409300928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:27:15.583098 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:27:15.584157 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:27:15.591056 139863409300928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:27:15.596204 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:27:15.596424 139863409300928 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:27:15.608553 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:27:15.717794 139863409300928 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:27:15.758781 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:15.802947 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:15.854752 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.016655 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.066838 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.122915 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.172369 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.218342 139863409300928 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:27:16.260091 139863409300928 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:27:16.276106 139863409300928 estimator.py:1147] Done calling model_fn.
I0814 16:27:19.684200 139863409300928 tpu_estimator.py:499] TPU job name worker
I0814 16:27:19.796919 139863409300928 monitored_session.py:240] Graph was finalized.
I0814 16:27:20.458379 139863409300928 session_manager.py:500] Running local_init_op.
I0814 16:27:20.507018 139863409300928 session_manager.py:502] Done running local_init_op.
I0814 16:27:23.252034 139863409300928 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:27:35.185417 139863409300928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:27:35.353055 139863409300928 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:27:35.353529 139863409300928 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:27:35.354003: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:27:35.358756 139863409300928 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:27:35.360805 139863409300928 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:27:35.365250 139863409300928 tpu_estimator.py:557] Init TPU system
I0814 16:27:47.120641 139863409300928 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:27:47.121643 139862506198784 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:27:47.122114 139862497806080 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:27:47.184914 139863409300928 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:27:47.185775 139863409300928 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:27:47.254121 139862489413376 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:27:47.370362 139862489413376 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:27:52.074119 139862497806080 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:27:56.806979 139863409300928 basic_session_run_hooks.py:262] loss = 0.89347833, step = 30
I0814 16:27:56.809161 139863409300928 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:28:10.460455 139863409300928 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:28:10.460747 139863409300928 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:28:10.460928 139862506198784 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:28:10.461028 139862506198784 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:28:10.461179 139863409300928 error_handling.py:96] infeed marked as finished
I0814 16:28:10.461277 139863409300928 tpu_estimator.py:602] Stop output thread controller
I0814 16:28:10.461325 139863409300928 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:28:10.461436 139862497806080 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:28:10.461519 139862497806080 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:28:10.461647 139863409300928 error_handling.py:96] outfeed marked as finished
I0814 16:28:10.461724 139863409300928 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:28:17.512025 139863409300928 estimator.py:368] Loss for final step: 0.89347833.
I0814 16:28:17.512924 139863409300928 error_handling.py:96] training_loop marked as finished
I0814 16:28:18.208734 139863409300928 estimator.py:1145] Calling model_fn.
E0814 16:28:18.940510 139863409300928 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:28:19.169138 139863409300928 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:28:19.190582 139863409300928 estimator.py:1147] Done calling model_fn.
I0814 16:28:19.208070 139863409300928 evaluation.py:255] Starting evaluation at 2019-08-14T16:28:19Z
I0814 16:28:19.208308 139863409300928 tpu_estimator.py:499] TPU job name worker
I0814 16:28:19.290648 139863409300928 monitored_session.py:240] Graph was finalized.
W0814 16:28:19.291419 139863409300928 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:28:19.490663 139863409300928 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:28:22.044178 139863409300928 session_manager.py:500] Running local_init_op.
I0814 16:28:22.074238 139863409300928 session_manager.py:502] Done running local_init_op.
I0814 16:28:22.124716 139863409300928 tpu_estimator.py:557] Init TPU system
I0814 16:28:33.867239 139863409300928 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:28:33.868105 139862506198784 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:28:33.868624 139862497806080 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:28:33.937299 139863409300928 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:28:33.962013 139863409300928 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:28:33.962363 139863409300928 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:28:34.063404 139862489413376 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:28:34.448915 139862489413376 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:28:34.719919 139862497806080 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:28:35.186980 139863409300928 evaluation.py:167] Evaluation [10/10]
I0814 16:28:35.187324 139863409300928 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:28:35.187402 139863409300928 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:28:35.187594 139862506198784 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:28:35.187700 139862506198784 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:28:35.187839 139863409300928 error_handling.py:96] infeed marked as finished
I0814 16:28:35.187937 139863409300928 tpu_estimator.py:602] Stop output thread controller
I0814 16:28:35.187984 139863409300928 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:28:35.188097 139862497806080 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:28:35.188174 139862497806080 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:28:35.188287 139863409300928 error_handling.py:96] outfeed marked as finished
I0814 16:28:35.188374 139863409300928 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:29:04.539004 139863409300928 evaluation.py:275] Finished evaluation at 2019-08-14-16:29:04
I0814 16:29:04.539325 139863409300928 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8351, global_step = 30, loss = 0.82463825
I0814 16:29:08.901562 139863409300928 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:29:10.019752 139863409300928 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.82463825, 'global_step': 30, 'accuracy': 0.8351}

Removing gs://yangyou-mnist/log/#1565800037735668...
Removing gs://yangyou-mnist/log/checkpoint#1565800087020468...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800042673839...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800037.v3-8-tpu#1565800090150395...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800083816314...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800049180680...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800050081791...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800054633646...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800084778481...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800089181928...
Removing gs://yangyou-mnist/log/eval/#1565800146226157...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800146.v3-8-tpu#1565800149679967...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:29:13.751085 139919165904320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:29:13.751854 139919165904320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:29:13.754523 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:29:13.755351 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:29:13.755934 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:29:13.756066 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:29:14.163357 139919165904320 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:29:14.170110 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:29:14.174045 139919165904320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:29:14.215631 139919165904320 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:29:14.215928 139919165904320 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:29:14.463635 139919165904320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:29:14.579571 139919165904320 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:29:14.579881 139919165904320 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:29:14.744282 139919165904320 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f41525791d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4154759210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:29:14.744693 139919165904320 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:29:15.060477 139919165904320 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:29:15.063464: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:29:15.075593 139919165904320 tpu_system_metadata.py:148] Found TPU system:
I0814 16:29:15.075865 139919165904320 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:29:15.076383 139919165904320 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:29:15.076505 139919165904320 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:29:15.076564 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:29:15.077068 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:29:15.077136 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:29:15.077195 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:29:15.077261 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:29:15.077316 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:29:15.077363 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:29:15.077409 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:29:15.077455 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:29:15.077502 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:29:15.077549 139919165904320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:29:15.083570 139919165904320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:29:15.095772 139919165904320 estimator.py:1145] Calling model_fn.
W0814 16:29:15.096376 139919165904320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:29:15.366575 139919165904320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:29:15.788001 139919165904320 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:29:15.849550 139919165904320 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:29:15.855531 139919165904320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:29:16.033031 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:29:16.046855 139919165904320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:29:16.058958 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:29:16.059997 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:29:16.067120 139919165904320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:29:16.072308 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:29:16.072590 139919165904320 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:29:16.085186 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:29:16.200999 139919165904320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:29:16.242353 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.286418 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.337553 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.506757 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.556305 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.604576 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.653918 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.698441 139919165904320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:29:16.739311 139919165904320 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:29:16.755374 139919165904320 estimator.py:1147] Done calling model_fn.
I0814 16:29:20.046132 139919165904320 tpu_estimator.py:499] TPU job name worker
I0814 16:29:20.159032 139919165904320 monitored_session.py:240] Graph was finalized.
I0814 16:29:20.850455 139919165904320 session_manager.py:500] Running local_init_op.
I0814 16:29:20.897564 139919165904320 session_manager.py:502] Done running local_init_op.
I0814 16:29:23.605987 139919165904320 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:29:35.936510 139919165904320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:29:36.091989 139919165904320 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:29:36.092470 139919165904320 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:29:36.092922: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:29:36.098172 139919165904320 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:29:36.101109 139919165904320 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:29:36.105887 139919165904320 tpu_estimator.py:557] Init TPU system
I0814 16:29:47.800626 139919165904320 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:29:47.801723 139918269732608 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:29:47.802401 139918261339904 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:29:47.865531 139918252947200 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:29:47.865885 139919165904320 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:29:47.867577 139919165904320 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:29:47.988045 139918252947200 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:29:52.590040 139918261339904 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:29:57.213753 139919165904320 basic_session_run_hooks.py:262] loss = 0.5619462, step = 30
I0814 16:29:57.215807 139919165904320 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:30:10.833870 139919165904320 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:30:10.834161 139919165904320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:30:10.834359 139918269732608 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:30:10.834465 139918269732608 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:30:10.834597 139919165904320 error_handling.py:96] infeed marked as finished
I0814 16:30:10.834714 139919165904320 tpu_estimator.py:602] Stop output thread controller
I0814 16:30:10.834767 139919165904320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:30:10.834881 139918261339904 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:30:10.834950 139918261339904 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:30:10.835058 139919165904320 error_handling.py:96] outfeed marked as finished
I0814 16:30:10.835143 139919165904320 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:30:18.125354 139919165904320 estimator.py:368] Loss for final step: 0.5619462.
I0814 16:30:18.126120 139919165904320 error_handling.py:96] training_loop marked as finished
I0814 16:30:18.900769 139919165904320 estimator.py:1145] Calling model_fn.
E0814 16:30:19.690303 139919165904320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:30:19.920068 139919165904320 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:30:19.943411 139919165904320 estimator.py:1147] Done calling model_fn.
I0814 16:30:19.961319 139919165904320 evaluation.py:255] Starting evaluation at 2019-08-14T16:30:19Z
I0814 16:30:19.961560 139919165904320 tpu_estimator.py:499] TPU job name worker
I0814 16:30:20.045784 139919165904320 monitored_session.py:240] Graph was finalized.
W0814 16:30:20.046540 139919165904320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:30:20.233067 139919165904320 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:30:22.964025 139919165904320 session_manager.py:500] Running local_init_op.
I0814 16:30:22.988190 139919165904320 session_manager.py:502] Done running local_init_op.
I0814 16:30:23.041363 139919165904320 tpu_estimator.py:557] Init TPU system
I0814 16:30:34.872327 139919165904320 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:30:34.873256 139918266062592 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:30:34.873740 139918257669888 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:30:34.939445 139919165904320 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:30:34.964272 139919165904320 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:30:34.964663 139919165904320 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:30:34.996090 139918244292352 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:30:35.102171 139918244292352 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:30:35.754863 139918257669888 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:30:36.116168 139919165904320 evaluation.py:167] Evaluation [10/10]
I0814 16:30:36.116553 139919165904320 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:30:36.116648 139919165904320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:30:36.116856 139918266062592 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:30:36.116964 139918266062592 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:30:36.117109 139919165904320 error_handling.py:96] infeed marked as finished
I0814 16:30:36.117223 139919165904320 tpu_estimator.py:602] Stop output thread controller
I0814 16:30:36.117284 139919165904320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:30:36.117407 139918257669888 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:30:36.117486 139918257669888 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:30:36.117610 139919165904320 error_handling.py:96] outfeed marked as finished
I0814 16:30:36.117795 139919165904320 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:31:05.195046 139919165904320 evaluation.py:275] Finished evaluation at 2019-08-14-16:31:05
I0814 16:31:05.195369 139919165904320 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8787, global_step = 30, loss = 0.50310624
I0814 16:31:09.493438 139919165904320 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:31:10.264098 139919165904320 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.50310624, 'global_step': 30, 'accuracy': 0.8787}

Removing gs://yangyou-mnist/log/checkpoint#1565800207188151...
Removing gs://yangyou-mnist/log/#1565800158229956...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800158.v3-8-tpu#1565800210528694...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800163030270...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800170061944...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800204161974...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800175422914...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800205027612...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800171012423...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800209548094...
Removing gs://yangyou-mnist/log/eval/#1565800266838283...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800267.v3-8-tpu#1565800269959780...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:31:14.024374 140062906897856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:31:14.025208 140062906897856 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:31:14.027760 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:31:14.028645 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:31:14.029244 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:31:14.029373 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:31:14.444479 140062906897856 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:31:14.451646 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:31:14.455707 140062906897856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:31:14.501713 140062906897856 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:31:14.501981 140062906897856 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:31:14.636269 140062906897856 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:31:14.678530 140062906897856 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:31:14.678805 140062906897856 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:31:14.797434 140062906897856 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f62c9f91190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f62cc171210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:31:14.797781 140062906897856 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:31:15.120814 140062906897856 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:31:15.123677: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:31:15.137260 140062906897856 tpu_system_metadata.py:148] Found TPU system:
I0814 16:31:15.137511 140062906897856 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:31:15.138012 140062906897856 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:31:15.138072 140062906897856 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:31:15.138124 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:31:15.138415 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:31:15.138469 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:31:15.138519 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:31:15.138572 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:31:15.138618 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:31:15.138665 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:31:15.138710 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:31:15.138756 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:31:15.138801 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:31:15.138848 140062906897856 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:31:15.145133 140062906897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:31:15.157897 140062906897856 estimator.py:1145] Calling model_fn.
W0814 16:31:15.158514 140062906897856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:31:15.428519 140062906897856 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:31:15.837637 140062906897856 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:31:15.899926 140062906897856 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:31:15.905955 140062906897856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:31:16.091157 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:31:16.105309 140062906897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:31:16.117628 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:31:16.118705 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:31:16.125861 140062906897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:31:16.131227 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:31:16.131439 140062906897856 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:31:16.144054 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:31:16.254796 140062906897856 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:31:16.296818 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.342339 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.394807 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.560595 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.611654 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.661609 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.712795 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.760462 140062906897856 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:31:16.802309 140062906897856 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:31:16.818576 140062906897856 estimator.py:1147] Done calling model_fn.
I0814 16:31:20.175715 140062906897856 tpu_estimator.py:499] TPU job name worker
I0814 16:31:20.285017 140062906897856 monitored_session.py:240] Graph was finalized.
I0814 16:31:20.998323 140062906897856 session_manager.py:500] Running local_init_op.
I0814 16:31:21.047856 140062906897856 session_manager.py:502] Done running local_init_op.
I0814 16:31:23.716692 140062906897856 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:31:35.820139 140062906897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:31:35.961509 140062906897856 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:31:35.962006 140062906897856 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:31:35.962422: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:31:35.966890 140062906897856 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:31:35.969096 140062906897856 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:31:35.973082 140062906897856 tpu_estimator.py:557] Init TPU system
I0814 16:31:47.792615 140062906897856 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:31:47.793548 140062010627840 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:31:47.794019 140062002235136 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:31:47.856390 140061993842432 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:31:47.858033 140062906897856 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:31:47.859759 140062906897856 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:31:48.073841 140061993842432 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:31:52.637478 140062002235136 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:31:57.282218 140062906897856 basic_session_run_hooks.py:262] loss = 0.4177891, step = 30
I0814 16:31:57.284706 140062906897856 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:32:10.631211 140062906897856 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:32:10.631535 140062906897856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:32:10.631772 140062010627840 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:32:10.631877 140062010627840 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:32:10.632019 140062906897856 error_handling.py:96] infeed marked as finished
I0814 16:32:10.632114 140062906897856 tpu_estimator.py:602] Stop output thread controller
I0814 16:32:10.632165 140062906897856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:32:10.632282 140062002235136 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:32:10.632359 140062002235136 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:32:10.632572 140062906897856 error_handling.py:96] outfeed marked as finished
I0814 16:32:10.632683 140062906897856 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:32:18.212265 140062906897856 estimator.py:368] Loss for final step: 0.4177891.
I0814 16:32:18.213206 140062906897856 error_handling.py:96] training_loop marked as finished
I0814 16:32:19.002778 140062906897856 estimator.py:1145] Calling model_fn.
E0814 16:32:19.747783 140062906897856 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:32:19.976105 140062906897856 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:32:19.998132 140062906897856 estimator.py:1147] Done calling model_fn.
I0814 16:32:20.015768 140062906897856 evaluation.py:255] Starting evaluation at 2019-08-14T16:32:20Z
I0814 16:32:20.016005 140062906897856 tpu_estimator.py:499] TPU job name worker
I0814 16:32:20.097974 140062906897856 monitored_session.py:240] Graph was finalized.
W0814 16:32:20.098685 140062906897856 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:32:20.284238 140062906897856 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:32:22.968063 140062906897856 session_manager.py:500] Running local_init_op.
I0814 16:32:22.998986 140062906897856 session_manager.py:502] Done running local_init_op.
I0814 16:32:23.055191 140062906897856 tpu_estimator.py:557] Init TPU system
I0814 16:32:35.319789 140062906897856 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:32:35.320883 140062006957824 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:32:35.321729 140061998565120 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:32:35.388091 140062906897856 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:32:35.412913 140062906897856 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:32:35.413280 140062906897856 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:32:35.450551 140061985187584 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:32:35.561211 140061985187584 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:32:36.185601 140061998565120 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:32:36.651011 140062906897856 evaluation.py:167] Evaluation [10/10]
I0814 16:32:36.651341 140062906897856 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:32:36.651422 140062906897856 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:32:36.651669 140062006957824 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:32:36.651943 140062006957824 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:32:36.652151 140062906897856 error_handling.py:96] infeed marked as finished
I0814 16:32:36.652359 140062906897856 tpu_estimator.py:602] Stop output thread controller
I0814 16:32:36.652445 140062906897856 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:32:36.652657 140061998565120 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:32:36.652847 140061998565120 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:32:36.653062 140062906897856 error_handling.py:96] outfeed marked as finished
I0814 16:32:36.653254 140062906897856 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:33:05.660665 140062906897856 evaluation.py:275] Finished evaluation at 2019-08-14-16:33:05
I0814 16:33:05.661017 140062906897856 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8982, global_step = 30, loss = 0.40788308
I0814 16:33:10.308789 140062906897856 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:33:11.104204 140062906897856 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.40788308, 'global_step': 30, 'accuracy': 0.8982}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800290838697...
Removing gs://yangyou-mnist/log/checkpoint#1565800327233001...
Removing gs://yangyou-mnist/log/#1565800278408821...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800278.v3-8-tpu#1565800330329659...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800295307837...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800283130370...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800324312036...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800325105690...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800289879665...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800329420184...
Removing gs://yangyou-mnist/log/eval/#1565800387317035...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800387.v3-8-tpu#1565800390796523...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:33:14.841559 139957271160256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:33:14.842329 139957271160256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:33:14.844969 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:33:14.845791 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:33:14.846373 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:33:14.846501 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:33:15.259291 139957271160256 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:33:15.266771 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:33:15.270701 139957271160256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:33:15.330071 139957271160256 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:33:15.330368 139957271160256 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:33:15.463334 139957271160256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:33:15.525108 139957271160256 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:33:15.525399 139957271160256 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:33:15.610764 139957271160256 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4a3197b290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4a33b5a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:33:15.611121 139957271160256 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:33:15.938179 139957271160256 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:33:15.941496: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:33:15.954339 139957271160256 tpu_system_metadata.py:148] Found TPU system:
I0814 16:33:15.954579 139957271160256 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:33:15.955075 139957271160256 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:33:15.955132 139957271160256 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:33:15.955183 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:33:15.955466 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:33:15.955521 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:33:15.955576 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:33:15.955625 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:33:15.955672 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:33:15.955723 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:33:15.955776 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:33:15.955823 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:33:15.955871 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:33:15.955919 139957271160256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:33:15.962053 139957271160256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:33:15.974766 139957271160256 estimator.py:1145] Calling model_fn.
W0814 16:33:15.975394 139957271160256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:33:16.249557 139957271160256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:33:16.666893 139957271160256 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:33:16.728636 139957271160256 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:33:16.734591 139957271160256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:33:16.917298 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:33:16.930983 139957271160256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:33:16.943216 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:33:16.944282 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:33:16.951355 139957271160256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:33:16.956618 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:33:16.956828 139957271160256 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:33:16.969428 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:33:17.080559 139957271160256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:33:17.123264 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.168704 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.221080 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.389868 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.440973 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.489742 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.539900 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.586704 139957271160256 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:33:17.627759 139957271160256 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:33:17.643933 139957271160256 estimator.py:1147] Done calling model_fn.
I0814 16:33:20.927438 139957271160256 tpu_estimator.py:499] TPU job name worker
I0814 16:33:21.040571 139957271160256 monitored_session.py:240] Graph was finalized.
I0814 16:33:21.752650 139957271160256 session_manager.py:500] Running local_init_op.
I0814 16:33:21.803766 139957271160256 session_manager.py:502] Done running local_init_op.
I0814 16:33:24.397095 139957271160256 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:33:37.444529 139957271160256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:33:37.611129 139957271160256 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:33:37.611807 139957271160256 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:33:37.613442: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:33:37.618383 139957271160256 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:33:37.620598 139957271160256 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:33:37.624492 139957271160256 tpu_estimator.py:557] Init TPU system
I0814 16:33:49.128107 139957271160256 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:33:49.129020 139956374980352 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:33:49.129390 139956366587648 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:33:49.191324 139956358194944 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:33:49.192987 139957271160256 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:33:49.194171 139957271160256 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:33:49.435729 139956358194944 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:33:53.854691 139956366587648 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:33:58.520600 139957271160256 basic_session_run_hooks.py:262] loss = 0.24504378, step = 30
I0814 16:33:58.523442 139957271160256 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:34:11.668962 139957271160256 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:34:11.669303 139957271160256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:34:11.669547 139956374980352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:34:11.669687 139956374980352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:34:11.669832 139957271160256 error_handling.py:96] infeed marked as finished
I0814 16:34:11.669948 139957271160256 tpu_estimator.py:602] Stop output thread controller
I0814 16:34:11.670000 139957271160256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:34:11.670115 139956366587648 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:34:11.670192 139956366587648 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:34:11.670325 139957271160256 error_handling.py:96] outfeed marked as finished
I0814 16:34:11.670402 139957271160256 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:34:19.577327 139957271160256 estimator.py:368] Loss for final step: 0.24504378.
I0814 16:34:19.578193 139957271160256 error_handling.py:96] training_loop marked as finished
I0814 16:34:20.269753 139957271160256 estimator.py:1145] Calling model_fn.
E0814 16:34:20.959471 139957271160256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:34:21.191406 139957271160256 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:34:21.213403 139957271160256 estimator.py:1147] Done calling model_fn.
I0814 16:34:21.229789 139957271160256 evaluation.py:255] Starting evaluation at 2019-08-14T16:34:21Z
I0814 16:34:21.230036 139957271160256 tpu_estimator.py:499] TPU job name worker
I0814 16:34:21.308046 139957271160256 monitored_session.py:240] Graph was finalized.
W0814 16:34:21.308881 139957271160256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:34:21.492996 139957271160256 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:34:24.875518 139957271160256 session_manager.py:500] Running local_init_op.
I0814 16:34:24.900290 139957271160256 session_manager.py:502] Done running local_init_op.
I0814 16:34:24.953341 139957271160256 tpu_estimator.py:557] Init TPU system
I0814 16:34:36.417017 139957271160256 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:34:36.418025 139956371310336 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:34:36.418858 139956362917632 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:34:36.484708 139957271160256 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:34:36.512917 139957271160256 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:34:36.513293 139957271160256 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:34:36.611262 139956005631744 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:34:36.713479 139956005631744 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:34:37.304500 139956362917632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:34:37.613789 139957271160256 evaluation.py:167] Evaluation [10/10]
I0814 16:34:37.614175 139957271160256 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:34:37.614250 139957271160256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:34:37.614531 139956371310336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:34:37.614821 139956371310336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:34:37.615014 139957271160256 error_handling.py:96] infeed marked as finished
I0814 16:34:37.615185 139957271160256 tpu_estimator.py:602] Stop output thread controller
I0814 16:34:37.615236 139957271160256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:34:37.615539 139956362917632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:34:37.615742 139956362917632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:34:37.615910 139957271160256 error_handling.py:96] outfeed marked as finished
I0814 16:34:37.616039 139957271160256 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:35:06.812582 139957271160256 evaluation.py:275] Finished evaluation at 2019-08-14-16:35:06
I0814 16:35:06.812913 139957271160256 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9357, global_step = 30, loss = 0.23616552
I0814 16:35:11.589915 139957271160256 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:35:12.437944 139957271160256 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.23616552, 'global_step': 30, 'accuracy': 0.9357}

Removing gs://yangyou-mnist/log/#1565800399128432...
Removing gs://yangyou-mnist/log/checkpoint#1565800448119420...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800399.v3-8-tpu#1565800451362048...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800403810195...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800410678361...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800444948475...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800416930070...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800411610812...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800445884107...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800450345949...
Removing gs://yangyou-mnist/log/eval/#1565800508742590...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800508.v3-8-tpu#1565800512132652...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:35:17.343458 140291257906624 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:35:17.344250 140291257906624 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:35:17.346837 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:35:17.347646 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:35:17.348213 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:35:17.348335 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:35:17.764842 140291257906624 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:35:17.771919 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:35:17.776097 140291257906624 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:35:17.831631 140291257906624 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:35:17.831932 140291257906624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:35:17.943519 140291257906624 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:35:18.064387 140291257906624 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:35:18.064762 140291257906624 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:35:18.155823 140291257906624 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f97f4c10190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f97f6def210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:35:18.156188 140291257906624 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:35:18.475754 140291257906624 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:35:18.478685: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:35:18.490978 140291257906624 tpu_system_metadata.py:148] Found TPU system:
I0814 16:35:18.491293 140291257906624 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:35:18.492039 140291257906624 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:35:18.492163 140291257906624 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:35:18.492257 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:35:18.492877 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:35:18.492959 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:35:18.493031 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:35:18.493086 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:35:18.493134 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:35:18.493180 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:35:18.493227 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:35:18.493273 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:35:18.493338 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:35:18.493387 140291257906624 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:35:18.499747 140291257906624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:35:18.512140 140291257906624 estimator.py:1145] Calling model_fn.
W0814 16:35:18.512813 140291257906624 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:35:18.830687 140291257906624 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:35:19.350553 140291257906624 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:35:19.412497 140291257906624 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:35:19.418570 140291257906624 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:35:19.599117 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:35:19.612762 140291257906624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:35:19.624860 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:35:19.625943 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:35:19.633061 140291257906624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:35:19.638272 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:35:19.638493 140291257906624 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:35:19.650871 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:35:19.759995 140291257906624 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:35:19.800887 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:19.845340 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:19.895821 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.063416 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.113212 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.162009 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.212369 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.259166 140291257906624 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:35:20.300532 140291257906624 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:35:20.316612 140291257906624 estimator.py:1147] Done calling model_fn.
I0814 16:35:23.694284 140291257906624 tpu_estimator.py:499] TPU job name worker
I0814 16:35:23.804678 140291257906624 monitored_session.py:240] Graph was finalized.
I0814 16:35:24.511368 140291257906624 session_manager.py:500] Running local_init_op.
I0814 16:35:24.561284 140291257906624 session_manager.py:502] Done running local_init_op.
I0814 16:35:27.342081 140291257906624 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:35:39.870667 140291257906624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:35:40.038300 140291257906624 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:35:40.038737 140291257906624 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:35:40.039100: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:35:40.044153 140291257906624 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:35:40.046268 140291257906624 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:35:40.050107 140291257906624 tpu_estimator.py:557] Init TPU system
I0814 16:35:50.952131 140291257906624 tpu_estimator.py:566] Initialized TPU in 10 seconds
I0814 16:35:50.953016 140290495850240 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:35:50.953484 140290487457536 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:35:51.016660 140290006447872 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:35:51.017426 140291257906624 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:35:51.018661 140291257906624 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:35:51.105914 140290006447872 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:35:55.716172 140290487457536 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:36:00.326618 140291257906624 basic_session_run_hooks.py:262] loss = 0.1457841, step = 30
I0814 16:36:00.329220 140291257906624 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:36:13.583126 140291257906624 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:36:13.583457 140291257906624 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:36:13.583698 140290495850240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:36:13.583808 140290495850240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:36:13.583950 140291257906624 error_handling.py:96] infeed marked as finished
I0814 16:36:13.584038 140291257906624 tpu_estimator.py:602] Stop output thread controller
I0814 16:36:13.584086 140291257906624 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:36:13.584206 140290487457536 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:36:13.584278 140290487457536 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:36:13.584393 140291257906624 error_handling.py:96] outfeed marked as finished
I0814 16:36:13.584523 140291257906624 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:36:21.249121 140291257906624 estimator.py:368] Loss for final step: 0.1457841.
I0814 16:36:21.249953 140291257906624 error_handling.py:96] training_loop marked as finished
I0814 16:36:22.044281 140291257906624 estimator.py:1145] Calling model_fn.
E0814 16:36:22.782507 140291257906624 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:36:23.010406 140291257906624 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:36:23.035718 140291257906624 estimator.py:1147] Done calling model_fn.
I0814 16:36:23.052053 140291257906624 evaluation.py:255] Starting evaluation at 2019-08-14T16:36:23Z
I0814 16:36:23.052304 140291257906624 tpu_estimator.py:499] TPU job name worker
I0814 16:36:23.128056 140291257906624 monitored_session.py:240] Graph was finalized.
W0814 16:36:23.128909 140291257906624 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:36:23.321285 140291257906624 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:36:25.988981 140291257906624 session_manager.py:500] Running local_init_op.
I0814 16:36:26.019553 140291257906624 session_manager.py:502] Done running local_init_op.
I0814 16:36:26.078659 140291257906624 tpu_estimator.py:557] Init TPU system
I0814 16:36:37.691621 140291257906624 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:36:37.692703 140290492180224 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:36:37.693528 140290006447872 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:36:37.761662 140291257906624 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:36:37.787470 140291257906624 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:36:37.787921 140291257906624 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:36:37.825781 140289998055168 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:36:38.003818 140289998055168 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:36:38.554018 140290006447872 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:36:39.081974 140291257906624 evaluation.py:167] Evaluation [10/10]
I0814 16:36:39.082333 140291257906624 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:36:39.082413 140291257906624 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:36:39.082653 140290492180224 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:36:39.082946 140290492180224 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:36:39.083153 140291257906624 error_handling.py:96] infeed marked as finished
I0814 16:36:39.083403 140291257906624 tpu_estimator.py:602] Stop output thread controller
I0814 16:36:39.083471 140291257906624 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:36:39.083671 140290006447872 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:36:39.083863 140290006447872 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:36:39.084048 140291257906624 error_handling.py:96] outfeed marked as finished
I0814 16:36:39.084193 140291257906624 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:37:08.100241 140291257906624 evaluation.py:275] Finished evaluation at 2019-08-14-16:37:08
I0814 16:37:08.100698 140291257906624 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9644, global_step = 30, loss = 0.12450703
I0814 16:37:12.245843 140291257906624 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:37:13.031465 140291257906624 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.12450703, 'global_step': 30, 'accuracy': 0.9644}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800534808773...
Removing gs://yangyou-mnist/log/#1565800521866088...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800539345160...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800566935545...
Removing gs://yangyou-mnist/log/checkpoint#1565800569981751...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800522.v3-8-tpu#1565800573278411...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800526746376...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800567804005...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800533853470...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800572194988...
Removing gs://yangyou-mnist/log/eval/#1565800629743711...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800629.v3-8-tpu#1565800632720658...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:37:16.814965 139906964026816 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:37:16.816098 139906964026816 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:37:16.818686 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:37:16.819489 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:37:16.820080 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:37:16.820209 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:37:17.236471 139906964026816 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:37:17.244129 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:37:17.248647 139906964026816 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:37:17.370218 139906964026816 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:37:17.370526 139906964026816 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:37:17.524817 139906964026816 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:37:17.575846 139906964026816 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:37:17.576133 139906964026816 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:37:17.731390 139906964026816 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3e7b0dc110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3e7d2bb210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:37:17.731782 139906964026816 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:37:18.069947 139906964026816 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:37:18.072888: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:37:18.085201 139906964026816 tpu_system_metadata.py:148] Found TPU system:
I0814 16:37:18.085438 139906964026816 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:37:18.085921 139906964026816 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:37:18.085977 139906964026816 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:37:18.086029 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:37:18.086467 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:37:18.086524 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:37:18.086580 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:37:18.086627 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:37:18.086673 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:37:18.086719 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:37:18.086769 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:37:18.086813 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:37:18.086858 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:37:18.086905 139906964026816 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:37:18.093007 139906964026816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:37:18.105701 139906964026816 estimator.py:1145] Calling model_fn.
W0814 16:37:18.106333 139906964026816 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:37:18.377254 139906964026816 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:37:19.006583 139906964026816 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:37:19.069361 139906964026816 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:37:19.075459 139906964026816 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:37:19.274034 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:37:19.288217 139906964026816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:37:19.300596 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:37:19.301687 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:37:19.308967 139906964026816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:37:19.314690 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:37:19.314912 139906964026816 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:37:19.327955 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:37:19.441229 139906964026816 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:37:19.483655 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.529257 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.581258 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.750492 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.801631 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.851561 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.902739 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.950047 139906964026816 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:37:19.991780 139906964026816 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:37:20.007767 139906964026816 estimator.py:1147] Done calling model_fn.
I0814 16:37:23.411695 139906964026816 tpu_estimator.py:499] TPU job name worker
I0814 16:37:23.518867 139906964026816 monitored_session.py:240] Graph was finalized.
I0814 16:37:24.176702 139906964026816 session_manager.py:500] Running local_init_op.
I0814 16:37:24.223767 139906964026816 session_manager.py:502] Done running local_init_op.
I0814 16:37:26.975837 139906964026816 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:37:39.429331 139906964026816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:37:39.593708 139906964026816 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:37:39.594137 139906964026816 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:37:39.594610: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:37:39.599384 139906964026816 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:37:39.601583 139906964026816 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:37:39.605633 139906964026816 tpu_estimator.py:557] Init TPU system
I0814 16:37:51.610738 139906964026816 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:37:51.611557 139906059851520 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:37:51.612054 139906051458816 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:37:51.675384 139906964026816 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:37:51.677242 139906964026816 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:37:51.683280 139906043066112 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:37:51.796824 139906043066112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:37:56.373105 139906051458816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:38:00.804056 139906964026816 basic_session_run_hooks.py:262] loss = 0.21638884, step = 30
I0814 16:38:00.806601 139906964026816 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:38:13.907135 139906964026816 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:38:13.907493 139906964026816 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:38:13.907733 139906059851520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:38:13.907840 139906059851520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:38:13.908003 139906964026816 error_handling.py:96] infeed marked as finished
I0814 16:38:13.908103 139906964026816 tpu_estimator.py:602] Stop output thread controller
I0814 16:38:13.908153 139906964026816 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:38:13.908276 139906051458816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:38:13.908349 139906051458816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:38:13.908504 139906964026816 error_handling.py:96] outfeed marked as finished
I0814 16:38:13.908593 139906964026816 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:38:21.942331 139906964026816 estimator.py:368] Loss for final step: 0.21638884.
I0814 16:38:21.943106 139906964026816 error_handling.py:96] training_loop marked as finished
I0814 16:38:22.639136 139906964026816 estimator.py:1145] Calling model_fn.
E0814 16:38:23.362131 139906964026816 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:38:23.586662 139906964026816 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:38:23.607678 139906964026816 estimator.py:1147] Done calling model_fn.
I0814 16:38:23.624541 139906964026816 evaluation.py:255] Starting evaluation at 2019-08-14T16:38:23Z
I0814 16:38:23.624794 139906964026816 tpu_estimator.py:499] TPU job name worker
I0814 16:38:23.703768 139906964026816 monitored_session.py:240] Graph was finalized.
W0814 16:38:23.704539 139906964026816 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:38:23.888813 139906964026816 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:38:26.749784 139906964026816 session_manager.py:500] Running local_init_op.
I0814 16:38:26.777087 139906964026816 session_manager.py:502] Done running local_init_op.
I0814 16:38:26.836671 139906964026816 tpu_estimator.py:557] Init TPU system
I0814 16:38:38.515608 139906964026816 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:38:38.516845 139906059851520 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:38:38.517904 139906051458816 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:38:38.586823 139906964026816 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:38:38.612456 139906964026816 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:38:38.612823 139906964026816 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:38:38.652776 139906043066112 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:38:38.782982 139906043066112 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:38:39.368088 139906051458816 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:38:39.868568 139906964026816 evaluation.py:167] Evaluation [10/10]
I0814 16:38:39.868973 139906964026816 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:38:39.869045 139906964026816 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:38:39.869335 139906059851520 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:38:39.869616 139906059851520 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:38:39.869818 139906964026816 error_handling.py:96] infeed marked as finished
I0814 16:38:39.870008 139906964026816 tpu_estimator.py:602] Stop output thread controller
I0814 16:38:39.870059 139906964026816 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:38:39.870227 139906051458816 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:38:39.870605 139906051458816 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:38:39.870843 139906964026816 error_handling.py:96] outfeed marked as finished
I0814 16:38:39.871048 139906964026816 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:39:08.878767 139906964026816 evaluation.py:275] Finished evaluation at 2019-08-14-16:39:08
I0814 16:39:08.879141 139906964026816 estimator.py:2039] Saving dict for global step 30: accuracy = 0.948, global_step = 30, loss = 0.1803973
I0814 16:39:13.188888 139906964026816 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:39:14.045236 139906964026816 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.1803973, 'global_step': 30, 'accuracy': 0.948}

Removing gs://yangyou-mnist/log/#1565800641596782...
Removing gs://yangyou-mnist/log/checkpoint#1565800690546869...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800641.v3-8-tpu#1565800693607267...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800687392836...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800654447141...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800658924843...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800646402803...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800688345114...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800653602498...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800692706114...
Removing gs://yangyou-mnist/log/eval/#1565800750598159...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800750.v3-8-tpu#1565800753736196...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:39:17.947360 139989440460224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:39:17.948159 139989440460224 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:39:17.950838 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:39:17.951669 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:39:17.952258 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:39:17.952384 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:39:18.371953 139989440460224 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:39:18.378926 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:39:18.382849 139989440460224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:39:18.439532 139989440460224 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:39:18.439845 139989440460224 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:39:18.621057 139989440460224 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:39:18.678905 139989440460224 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:39:18.679202 139989440460224 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:39:18.783895 139989440460224 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f51af084290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f51b1263210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:39:18.784271 139989440460224 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:39:19.118506 139989440460224 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:39:19.121568: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:39:19.134013 139989440460224 tpu_system_metadata.py:148] Found TPU system:
I0814 16:39:19.134287 139989440460224 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:39:19.134790 139989440460224 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:39:19.134848 139989440460224 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:39:19.134901 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:39:19.135185 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:39:19.135241 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:39:19.135291 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:39:19.135339 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:39:19.135385 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:39:19.135432 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:39:19.135478 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:39:19.135524 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:39:19.135596 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:39:19.135646 139989440460224 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:39:19.141917 139989440460224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:39:19.154628 139989440460224 estimator.py:1145] Calling model_fn.
W0814 16:39:19.155239 139989440460224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:39:19.427932 139989440460224 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:39:19.845011 139989440460224 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:39:19.906332 139989440460224 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:39:19.912447 139989440460224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:39:20.093874 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:39:20.107609 139989440460224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:39:20.119739 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:39:20.120840 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:39:20.127813 139989440460224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:39:20.133027 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:39:20.133239 139989440460224 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:39:20.145615 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:39:20.256217 139989440460224 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:39:20.298455 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.344008 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.396711 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.565512 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.616430 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.664926 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.714432 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.760171 139989440460224 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:39:20.801548 139989440460224 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:39:20.817823 139989440460224 estimator.py:1147] Done calling model_fn.
I0814 16:39:24.364638 139989440460224 tpu_estimator.py:499] TPU job name worker
I0814 16:39:24.476725 139989440460224 monitored_session.py:240] Graph was finalized.
I0814 16:39:25.180274 139989440460224 session_manager.py:500] Running local_init_op.
I0814 16:39:25.228243 139989440460224 session_manager.py:502] Done running local_init_op.
I0814 16:39:28.135675 139989440460224 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:39:40.479521 139989440460224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:39:40.624885 139989440460224 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:39:40.625341 139989440460224 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:39:40.625761: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:39:40.630987 139989440460224 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:39:40.633409 139989440460224 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:39:40.637629 139989440460224 tpu_estimator.py:557] Init TPU system
I0814 16:39:52.320724 139989440460224 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:39:52.321647 139988528252672 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:39:52.322191 139988519859968 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:39:52.386051 139988511467264 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:39:52.386698 139989440460224 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:39:52.387830 139989440460224 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:39:52.703769 139988511467264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:39:57.118777 139988519859968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:40:01.706190 139989440460224 basic_session_run_hooks.py:262] loss = 0.21905355, step = 30
I0814 16:40:01.708394 139989440460224 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:40:15.046529 139989440460224 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:40:15.046885 139989440460224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:40:15.047255 139988528252672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:40:15.047566 139988528252672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:40:15.047821 139989440460224 error_handling.py:96] infeed marked as finished
I0814 16:40:15.048053 139989440460224 tpu_estimator.py:602] Stop output thread controller
I0814 16:40:15.048131 139989440460224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:40:15.048356 139988519859968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:40:15.048801 139988519859968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:40:15.049042 139989440460224 error_handling.py:96] outfeed marked as finished
I0814 16:40:15.049243 139989440460224 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:40:22.847697 139989440460224 estimator.py:368] Loss for final step: 0.21905355.
I0814 16:40:22.848542 139989440460224 error_handling.py:96] training_loop marked as finished
I0814 16:40:23.630080 139989440460224 estimator.py:1145] Calling model_fn.
E0814 16:40:24.335448 139989440460224 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:40:24.566750 139989440460224 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:40:24.588481 139989440460224 estimator.py:1147] Done calling model_fn.
I0814 16:40:24.607625 139989440460224 evaluation.py:255] Starting evaluation at 2019-08-14T16:40:24Z
I0814 16:40:24.607867 139989440460224 tpu_estimator.py:499] TPU job name worker
I0814 16:40:24.686202 139989440460224 monitored_session.py:240] Graph was finalized.
W0814 16:40:24.686939 139989440460224 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:40:24.861737 139989440460224 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:40:27.433790 139989440460224 session_manager.py:500] Running local_init_op.
I0814 16:40:27.463653 139989440460224 session_manager.py:502] Done running local_init_op.
I0814 16:40:27.516678 139989440460224 tpu_estimator.py:557] Init TPU system
I0814 16:40:39.427920 139989440460224 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:40:39.428843 139988536645376 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:40:39.429327 139988528252672 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:40:39.496721 139989440460224 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:40:39.525317 139989440460224 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:40:39.525741 139989440460224 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:40:39.563008 139988519859968 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:40:39.807420 139988519859968 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:40:40.323262 139988528252672 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:40:40.645251 139989440460224 evaluation.py:167] Evaluation [10/10]
I0814 16:40:40.645606 139989440460224 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:40:40.645709 139989440460224 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:40:40.645956 139988536645376 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:40:40.646059 139988536645376 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:40:40.646233 139989440460224 error_handling.py:96] infeed marked as finished
I0814 16:40:40.646333 139989440460224 tpu_estimator.py:602] Stop output thread controller
I0814 16:40:40.646406 139989440460224 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:40:40.646528 139988528252672 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:40:40.646616 139988528252672 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:40:40.646740 139989440460224 error_handling.py:96] outfeed marked as finished
I0814 16:40:40.646837 139989440460224 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:41:09.907979 139989440460224 evaluation.py:275] Finished evaluation at 2019-08-14-16:41:09
I0814 16:41:09.908310 139989440460224 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9431, global_step = 30, loss = 0.20919731
I0814 16:41:14.202033 139989440460224 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:41:15.065156 139989440460224 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.20919731, 'global_step': 30, 'accuracy': 0.9431}

Removing gs://yangyou-mnist/log/#1565800762361162...
Removing gs://yangyou-mnist/log/checkpoint#1565800811551691...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800767431908...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800775426201...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800762.v3-8-tpu#1565800814739245...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800774540362...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800779966589...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800808459920...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800809335348...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800813822148...
Removing gs://yangyou-mnist/log/eval/#1565800871623944...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800871.v3-8-tpu#1565800874758021...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:41:18.887661 140148895217088 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:41:18.888591 140148895217088 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:41:18.891172 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:41:18.891985 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:41:18.892612 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:41:18.892755 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:41:19.307646 140148895217088 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:41:19.314842 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:41:19.318705 140148895217088 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:41:19.372314 140148895217088 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:41:19.372638 140148895217088 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:41:19.509579 140148895217088 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:41:19.624089 140148895217088 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:41:19.624382 140148895217088 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:41:19.737571 140148895217088 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f76cf46c090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f76d164b1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:41:19.737950 140148895217088 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:41:20.069498 140148895217088 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:41:20.072904: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:41:20.087330 140148895217088 tpu_system_metadata.py:148] Found TPU system:
I0814 16:41:20.087591 140148895217088 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:41:20.088155 140148895217088 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:41:20.088238 140148895217088 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:41:20.088296 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:41:20.088669 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:41:20.088839 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:41:20.088897 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:41:20.088949 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:41:20.088998 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:41:20.089045 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:41:20.089092 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:41:20.089138 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:41:20.089186 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:41:20.089235 140148895217088 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:41:20.095540 140148895217088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:41:20.108114 140148895217088 estimator.py:1145] Calling model_fn.
W0814 16:41:20.108779 140148895217088 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:41:20.384980 140148895217088 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:41:20.786030 140148895217088 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:41:20.845607 140148895217088 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:41:20.851167 140148895217088 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:41:21.023781 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:41:21.037074 140148895217088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:41:21.048816 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:41:21.049866 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:41:21.056740 140148895217088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:41:21.062021 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:41:21.062213 140148895217088 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:41:21.074348 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:41:21.188270 140148895217088 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:41:21.229257 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.273463 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.324645 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.489168 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.537904 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.585218 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.634099 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.678731 140148895217088 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:41:21.719417 140148895217088 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:41:21.735800 140148895217088 estimator.py:1147] Done calling model_fn.
I0814 16:41:25.300800 140148895217088 tpu_estimator.py:499] TPU job name worker
I0814 16:41:25.414066 140148895217088 monitored_session.py:240] Graph was finalized.
I0814 16:41:26.084491 140148895217088 session_manager.py:500] Running local_init_op.
I0814 16:41:26.131705 140148895217088 session_manager.py:502] Done running local_init_op.
I0814 16:41:28.806469 140148895217088 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:41:40.879371 140148895217088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:41:41.028065 140148895217088 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:41:41.028537 140148895217088 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:41:41.029002: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:41:41.034383 140148895217088 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:41:41.036907 140148895217088 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:41:41.041162 140148895217088 tpu_estimator.py:557] Init TPU system
I0814 16:41:53.173396 140148895217088 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:41:53.174328 140147853088512 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:41:53.174822 140147844695808 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:41:53.235894 140148895217088 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:41:53.237756 140148895217088 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:41:53.244303 140147836303104 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:41:53.449064 140147836303104 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:41:57.940253 140147844695808 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:42:02.672560 140148895217088 basic_session_run_hooks.py:262] loss = 2.3166442, step = 30
I0814 16:42:02.674905 140148895217088 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:42:16.249541 140148895217088 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:42:16.249871 140148895217088 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:42:16.250087 140147853088512 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:42:16.250194 140147853088512 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:42:16.250343 140148895217088 error_handling.py:96] infeed marked as finished
I0814 16:42:16.250451 140148895217088 tpu_estimator.py:602] Stop output thread controller
I0814 16:42:16.250499 140148895217088 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:42:16.250612 140147844695808 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:42:16.250689 140147844695808 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:42:16.250799 140148895217088 error_handling.py:96] outfeed marked as finished
I0814 16:42:16.250888 140148895217088 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:42:23.584991 140148895217088 estimator.py:368] Loss for final step: 2.3166442.
I0814 16:42:23.585819 140148895217088 error_handling.py:96] training_loop marked as finished
I0814 16:42:24.397262 140148895217088 estimator.py:1145] Calling model_fn.
E0814 16:42:25.096049 140148895217088 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:42:25.316292 140148895217088 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:42:25.337553 140148895217088 estimator.py:1147] Done calling model_fn.
I0814 16:42:25.353954 140148895217088 evaluation.py:255] Starting evaluation at 2019-08-14T16:42:25Z
I0814 16:42:25.354197 140148895217088 tpu_estimator.py:499] TPU job name worker
I0814 16:42:25.431045 140148895217088 monitored_session.py:240] Graph was finalized.
W0814 16:42:25.431823 140148895217088 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:42:25.617810 140148895217088 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:42:28.179415 140148895217088 session_manager.py:500] Running local_init_op.
I0814 16:42:28.209088 140148895217088 session_manager.py:502] Done running local_init_op.
I0814 16:42:28.261264 140148895217088 tpu_estimator.py:557] Init TPU system
I0814 16:42:40.319976 140148895217088 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:42:40.320960 140147860956928 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:42:40.321554 140147852564224 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:42:40.399771 140148895217088 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:42:40.424065 140148895217088 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:42:40.424524 140148895217088 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:42:40.464627 140147844171520 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:42:40.579420 140147844171520 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:42:41.199297 140147852564224 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:42:41.630342 140148895217088 evaluation.py:167] Evaluation [10/10]
I0814 16:42:41.630702 140148895217088 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:42:41.630770 140148895217088 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:42:41.631093 140147860956928 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:42:41.631400 140147860956928 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:42:41.631628 140148895217088 error_handling.py:96] infeed marked as finished
I0814 16:42:41.631789 140148895217088 tpu_estimator.py:602] Stop output thread controller
I0814 16:42:41.631851 140148895217088 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:42:41.632066 140147852564224 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:42:41.632262 140147852564224 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:42:41.632486 140148895217088 error_handling.py:96] outfeed marked as finished
I0814 16:42:41.632669 140148895217088 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:43:10.678519 140148895217088 evaluation.py:275] Finished evaluation at 2019-08-14-16:43:10
I0814 16:43:10.678930 140148895217088 estimator.py:2039] Saving dict for global step 30: accuracy = 0.101, global_step = 30, loss = 2.299601
I0814 16:43:14.950356 140148895217088 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:43:15.851397 140148895217088 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.299601, 'global_step': 30, 'accuracy': 0.101}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565800895920799...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565800900364905...
Removing gs://yangyou-mnist/log/checkpoint#1565800932812306...
Removing gs://yangyou-mnist/log/#1565800883360708...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565800930490254...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565800883.v3-8-tpu#1565800935942105...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565800929648474...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565800895111838...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565800888216733...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565800934972211...
Removing gs://yangyou-mnist/log/eval/#1565800992378294...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565800992.v3-8-tpu#1565800995541697...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:43:19.628268 139705891243456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:43:19.629231 139705891243456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:43:19.631954 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:43:19.632824 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:43:19.633445 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:43:19.633577 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:43:20.049814 139705891243456 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:43:20.056802 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:43:20.060458 139705891243456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:43:20.115866 139705891243456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:43:20.116157 139705891243456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:43:20.239794 139705891243456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:43:20.363864 139705891243456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:43:20.364155 139705891243456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:43:20.534954 139705891243456 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0faa2e9110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0fac4c81d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:43:20.535307 139705891243456 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:43:20.864000 139705891243456 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:43:20.867062: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:43:20.878998 139705891243456 tpu_system_metadata.py:148] Found TPU system:
I0814 16:43:20.879265 139705891243456 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:43:20.879746 139705891243456 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:43:20.879802 139705891243456 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:43:20.879862 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:43:20.880150 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:43:20.880208 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:43:20.880258 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:43:20.880306 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:43:20.880353 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:43:20.880444 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:43:20.880515 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:43:20.880570 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:43:20.880619 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:43:20.880667 139705891243456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:43:20.886511 139705891243456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:43:20.899009 139705891243456 estimator.py:1145] Calling model_fn.
W0814 16:43:20.899629 139705891243456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:43:21.173182 139705891243456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:43:21.683298 139705891243456 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:43:21.744720 139705891243456 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:43:21.750649 139705891243456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:43:21.927547 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:43:21.941212 139705891243456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:43:21.953532 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:43:21.954590 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:43:21.961750 139705891243456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:43:21.966965 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:43:21.967199 139705891243456 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:43:21.979739 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:43:22.089863 139705891243456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:43:22.130743 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.174202 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.225193 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.387980 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.438760 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.487613 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.537817 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.583772 139705891243456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:43:22.625823 139705891243456 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:43:22.641999 139705891243456 estimator.py:1147] Done calling model_fn.
I0814 16:43:26.008063 139705891243456 tpu_estimator.py:499] TPU job name worker
I0814 16:43:26.119736 139705891243456 monitored_session.py:240] Graph was finalized.
I0814 16:43:26.814243 139705891243456 session_manager.py:500] Running local_init_op.
I0814 16:43:26.861532 139705891243456 session_manager.py:502] Done running local_init_op.
I0814 16:43:29.502362 139705891243456 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:43:41.782440 139705891243456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:43:41.923603 139705891243456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:43:41.924158 139705891243456 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:43:41.924618: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:43:41.929882 139705891243456 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:43:41.932172 139705891243456 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:43:41.935883 139705891243456 tpu_estimator.py:557] Init TPU system
I0814 16:43:53.683883 139705891243456 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:43:53.684912 139704995141376 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:43:53.685307 139704986748672 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:43:53.755774 139705891243456 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:43:53.757323 139705891243456 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:43:53.759375 139704978355968 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:43:53.953646 139704978355968 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:43:58.466970 139704986748672 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:44:03.232526 139705891243456 basic_session_run_hooks.py:262] loss = 38844.582, step = 30
I0814 16:44:03.235419 139705891243456 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:44:16.623104 139705891243456 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:44:16.623418 139705891243456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:44:16.623739 139704995141376 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:44:16.623877 139704995141376 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:44:16.624056 139705891243456 error_handling.py:96] infeed marked as finished
I0814 16:44:16.624175 139705891243456 tpu_estimator.py:602] Stop output thread controller
I0814 16:44:16.624233 139705891243456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:44:16.624387 139704986748672 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:44:16.624527 139704986748672 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:44:16.624675 139705891243456 error_handling.py:96] outfeed marked as finished
I0814 16:44:16.624779 139705891243456 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:44:24.070473 139705891243456 estimator.py:368] Loss for final step: 38844.582.
I0814 16:44:24.071274 139705891243456 error_handling.py:96] training_loop marked as finished
I0814 16:44:24.773125 139705891243456 estimator.py:1145] Calling model_fn.
E0814 16:44:25.523696 139705891243456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:44:25.763849 139705891243456 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:44:25.787168 139705891243456 estimator.py:1147] Done calling model_fn.
I0814 16:44:25.804284 139705891243456 evaluation.py:255] Starting evaluation at 2019-08-14T16:44:25Z
I0814 16:44:25.804549 139705891243456 tpu_estimator.py:499] TPU job name worker
I0814 16:44:25.886648 139705891243456 monitored_session.py:240] Graph was finalized.
W0814 16:44:25.887420 139705891243456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:44:26.075992 139705891243456 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:44:28.691868 139705891243456 session_manager.py:500] Running local_init_op.
I0814 16:44:28.722311 139705891243456 session_manager.py:502] Done running local_init_op.
I0814 16:44:28.775171 139705891243456 tpu_estimator.py:557] Init TPU system
I0814 16:44:40.681623 139705891243456 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:44:40.682447 139704983078656 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:44:40.682874 139704969701120 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:44:40.757157 139705891243456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:44:40.787599 139705891243456 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:44:40.787988 139705891243456 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:44:40.829078 139704961308416 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:44:40.935726 139704961308416 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:44:41.569370 139704969701120 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:44:42.027090 139705891243456 evaluation.py:167] Evaluation [10/10]
I0814 16:44:42.027543 139705891243456 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:44:42.028748 139705891243456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:44:42.029007 139704983078656 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:44:42.029190 139704983078656 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:44:42.029391 139705891243456 error_handling.py:96] infeed marked as finished
I0814 16:44:42.029496 139705891243456 tpu_estimator.py:602] Stop output thread controller
I0814 16:44:42.029722 139705891243456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:44:42.029977 139704969701120 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:44:42.030147 139704969701120 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:44:42.030488 139705891243456 error_handling.py:96] outfeed marked as finished
I0814 16:44:42.030600 139705891243456 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:45:11.033981 139705891243456 evaluation.py:275] Finished evaluation at 2019-08-14-16:45:11
I0814 16:45:11.034557 139705891243456 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0958, global_step = 30, loss = 1003.3215
I0814 16:45:16.056474 139705891243456 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:45:16.843075 139705891243456 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1003.3215, 'global_step': 30, 'accuracy': 0.0958}

Removing gs://yangyou-mnist/log/#1565801004177449...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801016792767...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801021267926...
Removing gs://yangyou-mnist/log/checkpoint#1565801052990671...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801004.v3-8-tpu#1565801056306089...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801008898602...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801015953455...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801050770879...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801049866940...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801055352442...
Removing gs://yangyou-mnist/log/eval/#1565801113382150...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801113.v3-8-tpu#1565801116531807...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:45:20.634767 140140622910912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:45:20.635545 140140622910912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:45:20.638154 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:45:20.638987 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:45:20.639559 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:45:20.639691 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:45:21.047993 140140622910912 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:45:21.056382 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:45:21.060476 140140622910912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:45:21.114886 140140622910912 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:45:21.115176 140140622910912 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:45:21.314317 140140622910912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:45:21.371978 140140622910912 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:45:21.372277 140140622910912 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:45:21.490618 140140622910912 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f74e2356050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f74e45351d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:45:21.490958 140140622910912 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:45:21.820153 140140622910912 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:45:21.822969: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:45:21.836097 140140622910912 tpu_system_metadata.py:148] Found TPU system:
I0814 16:45:21.836354 140140622910912 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:45:21.836918 140140622910912 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:45:21.836977 140140622910912 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:45:21.837042 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:45:21.837333 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:45:21.837389 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:45:21.837440 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:45:21.837487 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:45:21.837534 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:45:21.837590 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:45:21.837637 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:45:21.837701 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:45:21.837759 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:45:21.837807 140140622910912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:45:21.843924 140140622910912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:45:21.856614 140140622910912 estimator.py:1145] Calling model_fn.
W0814 16:45:21.857217 140140622910912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:45:22.133596 140140622910912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:45:22.600014 140140622910912 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:45:22.662786 140140622910912 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:45:22.668826 140140622910912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:45:22.854351 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:45:22.868269 140140622910912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:45:22.880778 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:45:22.881920 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:45:22.889414 140140622910912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:45:22.894723 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:45:22.894942 140140622910912 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:45:22.907798 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:45:23.019262 140140622910912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:45:23.061780 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.115325 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.167144 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.337740 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.388324 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.438462 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.489842 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.536333 140140622910912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:45:23.578120 140140622910912 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:45:23.594384 140140622910912 estimator.py:1147] Done calling model_fn.
I0814 16:45:26.991699 140140622910912 tpu_estimator.py:499] TPU job name worker
I0814 16:45:27.114047 140140622910912 monitored_session.py:240] Graph was finalized.
I0814 16:45:27.833199 140140622910912 session_manager.py:500] Running local_init_op.
I0814 16:45:27.894649 140140622910912 session_manager.py:502] Done running local_init_op.
I0814 16:45:30.806354 140140622910912 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:45:43.222059 140140622910912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:45:43.362984 140140622910912 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:45:43.363414 140140622910912 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:45:43.363806: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:45:43.368901 140140622910912 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:45:43.371057 140140622910912 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:45:43.375472 140140622910912 tpu_estimator.py:557] Init TPU system
I0814 16:45:55.314527 140140622910912 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:45:55.315499 140139718231808 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:45:55.316385 140139709839104 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:45:55.381546 140139701446400 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:45:55.384866 140140622910912 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:45:55.386045 140140622910912 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:45:55.498373 140139701446400 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:46:00.147661 140139709839104 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:46:04.722394 140140622910912 basic_session_run_hooks.py:262] loss = 83.401024, step = 30
I0814 16:46:04.724811 140140622910912 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:46:17.928092 140140622910912 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:46:17.928455 140140622910912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:46:17.928674 140139718231808 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:46:17.928775 140139718231808 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:46:17.928913 140140622910912 error_handling.py:96] infeed marked as finished
I0814 16:46:17.929003 140140622910912 tpu_estimator.py:602] Stop output thread controller
I0814 16:46:17.929059 140140622910912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:46:17.929172 140139709839104 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:46:17.929244 140139709839104 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:46:17.929357 140140622910912 error_handling.py:96] outfeed marked as finished
I0814 16:46:17.929438 140140622910912 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:46:25.646167 140140622910912 estimator.py:368] Loss for final step: 83.401024.
I0814 16:46:25.646915 140140622910912 error_handling.py:96] training_loop marked as finished
I0814 16:46:26.506934 140140622910912 estimator.py:1145] Calling model_fn.
E0814 16:46:27.241230 140140622910912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:46:27.472292 140140622910912 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:46:27.494394 140140622910912 estimator.py:1147] Done calling model_fn.
I0814 16:46:27.511538 140140622910912 evaluation.py:255] Starting evaluation at 2019-08-14T16:46:27Z
I0814 16:46:27.511789 140140622910912 tpu_estimator.py:499] TPU job name worker
I0814 16:46:27.594044 140140622910912 monitored_session.py:240] Graph was finalized.
W0814 16:46:27.594811 140140622910912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:46:27.765079 140140622910912 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:46:30.423245 140140622910912 session_manager.py:500] Running local_init_op.
I0814 16:46:30.448335 140140622910912 session_manager.py:502] Done running local_init_op.
I0814 16:46:30.496579 140140622910912 tpu_estimator.py:557] Init TPU system
I0814 16:46:42.049717 140140622910912 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:46:42.050632 140139718231808 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:46:42.051845 140139709839104 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:46:42.119071 140140622910912 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:46:42.144720 140140622910912 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:46:42.145068 140140622910912 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:46:42.184927 140139701446400 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:46:42.292392 140139701446400 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:46:42.936268 140139709839104 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:46:43.247150 140140622910912 evaluation.py:167] Evaluation [10/10]
I0814 16:46:43.247512 140140622910912 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:46:43.247590 140140622910912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:46:43.247787 140139718231808 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:46:43.247916 140139718231808 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:46:43.248076 140140622910912 error_handling.py:96] infeed marked as finished
I0814 16:46:43.248172 140140622910912 tpu_estimator.py:602] Stop output thread controller
I0814 16:46:43.248224 140140622910912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:46:43.248339 140139709839104 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:46:43.248476 140139709839104 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:46:43.248613 140140622910912 error_handling.py:96] outfeed marked as finished
I0814 16:46:43.248697 140140622910912 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:47:12.389045 140140622910912 evaluation.py:275] Finished evaluation at 2019-08-14-16:47:12
I0814 16:47:12.389410 140140622910912 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 71.01515
I0814 16:47:16.807614 140140622910912 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:47:17.575392 140140622910912 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 71.01515, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801138273982...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801125.v3-8-tpu#1565801177639355...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801142763992...
Removing gs://yangyou-mnist/log/#1565801125142314...
Removing gs://yangyou-mnist/log/checkpoint#1565801174396616...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801130202481...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801171524374...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801172321649...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801137394592...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801176725668...
Removing gs://yangyou-mnist/log/eval/#1565801234110445...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801234.v3-8-tpu#1565801237269013...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:47:21.446849 140400706733504 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:47:21.447644 140400706733504 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:47:21.450293 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:47:21.451142 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:47:21.451766 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:47:21.451898 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:47:21.872173 140400706733504 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:47:21.880351 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:47:21.884835 140400706733504 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:47:21.938730 140400706733504 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:47:21.939018 140400706733504 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:47:22.048970 140400706733504 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:47:22.103183 140400706733504 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:47:22.103485 140400706733504 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:47:22.234117 140400706733504 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb170682290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb1728781d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:47:22.234482 140400706733504 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:47:22.572779 140400706733504 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:47:22.575905: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:47:22.588345 140400706733504 tpu_system_metadata.py:148] Found TPU system:
I0814 16:47:22.588630 140400706733504 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:47:22.589150 140400706733504 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:47:22.589207 140400706733504 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:47:22.589291 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:47:22.589593 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:47:22.589652 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:47:22.589701 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:47:22.589759 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:47:22.589806 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:47:22.589853 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:47:22.589899 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:47:22.589945 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:47:22.589989 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:47:22.590037 140400706733504 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:47:22.596298 140400706733504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:47:22.609194 140400706733504 estimator.py:1145] Calling model_fn.
W0814 16:47:22.609838 140400706733504 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:47:22.889158 140400706733504 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:47:23.435411 140400706733504 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:47:23.498176 140400706733504 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:47:23.504200 140400706733504 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:47:23.690145 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:47:23.704240 140400706733504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:47:23.716883 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:47:23.717978 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:47:23.725122 140400706733504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:47:23.730449 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:47:23.730686 140400706733504 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:47:23.743386 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:47:23.857454 140400706733504 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:47:23.900722 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:23.946355 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:23.998684 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.176690 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.228859 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.280040 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.331511 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.378695 140400706733504 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:47:24.421471 140400706733504 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:47:24.437975 140400706733504 estimator.py:1147] Done calling model_fn.
I0814 16:47:27.896281 140400706733504 tpu_estimator.py:499] TPU job name worker
I0814 16:47:28.011476 140400706733504 monitored_session.py:240] Graph was finalized.
I0814 16:47:28.686532 140400706733504 session_manager.py:500] Running local_init_op.
I0814 16:47:28.734508 140400706733504 session_manager.py:502] Done running local_init_op.
I0814 16:47:31.297661 140400706733504 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:47:43.536839 140400706733504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:47:43.697454 140400706733504 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:47:43.697885 140400706733504 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:47:43.698273: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:47:43.703655 140400706733504 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:47:43.705969 140400706733504 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:47:43.710517 140400706733504 tpu_estimator.py:557] Init TPU system
I0814 16:47:55.823875 140400706733504 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0814 16:47:55.824899 140400011962112 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:47:55.825813 140399528113920 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:47:55.891305 140400706733504 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:47:55.892766 140400706733504 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:47:55.899529 140399519721216 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:47:56.104876 140399519721216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:48:00.687114 140399528113920 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:48:05.230817 140400706733504 basic_session_run_hooks.py:262] loss = 1676.7081, step = 30
I0814 16:48:05.233562 140400706733504 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:48:18.733438 140400706733504 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:48:18.733776 140400706733504 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:48:18.734122 140400011962112 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:48:18.734441 140400011962112 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:48:18.734666 140400706733504 error_handling.py:96] infeed marked as finished
I0814 16:48:18.734858 140400706733504 tpu_estimator.py:602] Stop output thread controller
I0814 16:48:18.734947 140400706733504 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:48:18.735166 140399528113920 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:48:18.735358 140399528113920 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:48:18.735547 140400706733504 error_handling.py:96] outfeed marked as finished
I0814 16:48:18.735721 140400706733504 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:48:26.239108 140400706733504 estimator.py:368] Loss for final step: 1676.7081.
I0814 16:48:26.240005 140400706733504 error_handling.py:96] training_loop marked as finished
I0814 16:48:26.936870 140400706733504 estimator.py:1145] Calling model_fn.
E0814 16:48:27.624489 140400706733504 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:48:27.850240 140400706733504 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:48:27.872267 140400706733504 estimator.py:1147] Done calling model_fn.
I0814 16:48:27.889286 140400706733504 evaluation.py:255] Starting evaluation at 2019-08-14T16:48:27Z
I0814 16:48:27.889523 140400706733504 tpu_estimator.py:499] TPU job name worker
I0814 16:48:27.968146 140400706733504 monitored_session.py:240] Graph was finalized.
W0814 16:48:27.968899 140400706733504 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:48:28.155097 140400706733504 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:48:30.714253 140400706733504 session_manager.py:500] Running local_init_op.
I0814 16:48:30.746159 140400706733504 session_manager.py:502] Done running local_init_op.
I0814 16:48:30.798259 140400706733504 tpu_estimator.py:557] Init TPU system
I0814 16:48:42.630115 140400706733504 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:48:42.631551 140399528113920 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:48:42.632345 140399519721216 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:48:42.699493 140400706733504 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:48:42.725150 140400706733504 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:48:42.725483 140400706733504 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:48:42.763618 140399511328512 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:48:42.880242 140399511328512 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:48:43.464993 140399519721216 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:48:43.919456 140400706733504 evaluation.py:167] Evaluation [10/10]
I0814 16:48:43.919846 140400706733504 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:48:43.919948 140400706733504 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:48:43.920197 140399528113920 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:48:43.920495 140399528113920 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:48:43.920686 140400706733504 error_handling.py:96] infeed marked as finished
I0814 16:48:43.920850 140400706733504 tpu_estimator.py:602] Stop output thread controller
I0814 16:48:43.920908 140400706733504 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:48:43.921101 140399519721216 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:48:43.921288 140399519721216 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:48:43.921495 140400706733504 error_handling.py:96] outfeed marked as finished
I0814 16:48:43.921672 140400706733504 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:49:12.967879 140400706733504 evaluation.py:275] Finished evaluation at 2019-08-14-16:49:12
I0814 16:49:12.968224 140400706733504 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0892, global_step = 30, loss = 2227.2463
I0814 16:49:17.368952 140400706733504 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:49:18.164891 140400706733504 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2227.2463, 'global_step': 30, 'accuracy': 0.0892}

Removing gs://yangyou-mnist/log/#1565801246050298...
Removing gs://yangyou-mnist/log/checkpoint#1565801295200749...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801246.v3-8-tpu#1565801298416839...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801250718012...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801257881912...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801258690221...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801263020570...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801292072847...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801292927519...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801297464479...
Removing gs://yangyou-mnist/log/eval/#1565801354667752...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801354.v3-8-tpu#1565801357858989...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:49:22.041059 140052065547712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:49:22.041853 140052065547712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:49:22.044485 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:49:22.045381 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:49:22.046025 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:49:22.046158 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:49:22.478959 140052065547712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:49:22.488785 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:49:22.493418 140052065547712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:49:22.550146 140052065547712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:49:22.550580 140052065547712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:49:22.692751 140052065547712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:49:22.746792 140052065547712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:49:22.747081 140052065547712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:49:22.870920 140052065547712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f6043c74190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f6045e531d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:49:22.871357 140052065547712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:49:23.212240 140052065547712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:49:23.215587: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:49:23.229629 140052065547712 tpu_system_metadata.py:148] Found TPU system:
I0814 16:49:23.229902 140052065547712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:49:23.230521 140052065547712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:49:23.230581 140052065547712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:49:23.230642 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:49:23.230956 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:49:23.231015 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:49:23.231066 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:49:23.231115 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:49:23.231162 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:49:23.231209 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:49:23.231254 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:49:23.231301 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:49:23.231347 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:49:23.231396 140052065547712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:49:23.237807 140052065547712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:49:23.251187 140052065547712 estimator.py:1145] Calling model_fn.
W0814 16:49:23.251857 140052065547712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:49:23.522481 140052065547712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:49:23.953263 140052065547712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:49:24.018369 140052065547712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:49:24.024627 140052065547712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:49:24.215303 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:49:24.229455 140052065547712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:49:24.242117 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:49:24.243211 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:49:24.250597 140052065547712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:49:24.255928 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:49:24.256141 140052065547712 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:49:24.268811 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:49:24.381058 140052065547712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:49:24.422956 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.467631 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.520093 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.688766 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.739775 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.788378 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.839504 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.886657 140052065547712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:49:24.930689 140052065547712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:49:24.947844 140052065547712 estimator.py:1147] Done calling model_fn.
I0814 16:49:28.391633 140052065547712 tpu_estimator.py:499] TPU job name worker
I0814 16:49:28.502816 140052065547712 monitored_session.py:240] Graph was finalized.
I0814 16:49:29.158584 140052065547712 session_manager.py:500] Running local_init_op.
I0814 16:49:29.203386 140052065547712 session_manager.py:502] Done running local_init_op.
I0814 16:49:31.904994 140052065547712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:49:44.994255 140052065547712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:49:45.138523 140052065547712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:49:45.139044 140052065547712 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:49:45.139467: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:49:45.145153 140052065547712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:49:45.147469 140052065547712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:49:45.151516 140052065547712 tpu_estimator.py:557] Init TPU system
I0814 16:49:56.852452 140052065547712 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:49:56.853602 140051031783168 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:49:56.854446 140051023390464 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:49:56.915435 140051014997760 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:49:56.918128 140052065547712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:49:56.919404 140052065547712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 16:49:57.006973 140051014997760 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:50:01.693600 140051023390464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:50:06.321156 140052065547712 basic_session_run_hooks.py:262] loss = 71237.4, step = 30
I0814 16:50:06.323703 140052065547712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:50:19.749134 140052065547712 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:50:19.749448 140052065547712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:50:19.749752 140051031783168 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:50:19.750036 140051031783168 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:50:19.750293 140052065547712 error_handling.py:96] infeed marked as finished
I0814 16:50:19.750505 140052065547712 tpu_estimator.py:602] Stop output thread controller
I0814 16:50:19.750566 140052065547712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:50:19.750849 140051023390464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:50:19.751049 140051023390464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:50:19.751240 140052065547712 error_handling.py:96] outfeed marked as finished
I0814 16:50:19.751414 140052065547712 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:50:27.152544 140052065547712 estimator.py:368] Loss for final step: 71237.4.
I0814 16:50:27.153422 140052065547712 error_handling.py:96] training_loop marked as finished
I0814 16:50:27.923320 140052065547712 estimator.py:1145] Calling model_fn.
E0814 16:50:28.633466 140052065547712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:50:28.860601 140052065547712 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:50:28.882051 140052065547712 estimator.py:1147] Done calling model_fn.
I0814 16:50:28.899363 140052065547712 evaluation.py:255] Starting evaluation at 2019-08-14T16:50:28Z
I0814 16:50:28.899585 140052065547712 tpu_estimator.py:499] TPU job name worker
I0814 16:50:28.979566 140052065547712 monitored_session.py:240] Graph was finalized.
W0814 16:50:28.980276 140052065547712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:50:29.166491 140052065547712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:50:31.933495 140052065547712 session_manager.py:500] Running local_init_op.
I0814 16:50:31.958470 140052065547712 session_manager.py:502] Done running local_init_op.
I0814 16:50:32.017311 140052065547712 tpu_estimator.py:557] Init TPU system
I0814 16:50:43.525819 140052065547712 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:50:43.526933 140051031258880 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:50:43.527808 140051022866176 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:50:43.596682 140052065547712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:50:43.626560 140052065547712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:50:43.626930 140052065547712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:50:43.664582 140051014473472 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:50:43.851767 140051014473472 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:50:44.451097 140051022866176 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:50:44.710196 140052065547712 evaluation.py:167] Evaluation [10/10]
I0814 16:50:44.710635 140052065547712 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:50:44.710710 140052065547712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:50:44.710916 140051031258880 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:50:44.711020 140051031258880 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:50:44.711153 140052065547712 error_handling.py:96] infeed marked as finished
I0814 16:50:44.711257 140052065547712 tpu_estimator.py:602] Stop output thread controller
I0814 16:50:44.711311 140052065547712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:50:44.711421 140051022866176 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:50:44.711492 140051022866176 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:50:44.711611 140052065547712 error_handling.py:96] outfeed marked as finished
I0814 16:50:44.711689 140052065547712 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:51:13.939280 140052065547712 evaluation.py:275] Finished evaluation at 2019-08-14-16:51:13
I0814 16:51:13.939657 140052065547712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0974, global_step = 30, loss = 53146.273
I0814 16:51:18.510503 140052065547712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:51:19.463485 140052065547712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 53146.273, 'global_step': 30, 'accuracy': 0.0974}

Removing gs://yangyou-mnist/log/#1565801366411383...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801379000433...
Removing gs://yangyou-mnist/log/checkpoint#1565801416138470...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801366.v3-8-tpu#1565801419443914...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801384483363...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801413071860...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801371317570...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801413967296...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801378129419...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801418456558...
Removing gs://yangyou-mnist/log/eval/#1565801475634603...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801475.v3-8-tpu#1565801479035049...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:51:23.305118 140568902079936 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:51:23.305926 140568902079936 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:51:23.308563 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:51:23.309401 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:51:23.310002 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:51:23.310132 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:51:23.730638 140568902079936 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:51:23.738105 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:51:23.742372 140568902079936 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:51:23.864466 140568902079936 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:51:23.864799 140568902079936 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:51:23.988291 140568902079936 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:51:24.105911 140568902079936 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:51:24.106199 140568902079936 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:51:24.277194 140568902079936 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd899a2e110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd89bc0d1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:51:24.277535 140568902079936 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:51:24.603656 140568902079936 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:51:24.606646: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:51:24.620310 140568902079936 tpu_system_metadata.py:148] Found TPU system:
I0814 16:51:24.620600 140568902079936 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:51:24.621093 140568902079936 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:51:24.621153 140568902079936 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:51:24.621211 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:51:24.621510 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:51:24.621572 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:51:24.621623 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:51:24.621671 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:51:24.621718 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:51:24.621766 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:51:24.621828 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:51:24.621875 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:51:24.621922 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:51:24.621968 140568902079936 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:51:24.628211 140568902079936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:51:24.641472 140568902079936 estimator.py:1145] Calling model_fn.
W0814 16:51:24.642101 140568902079936 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:51:24.911665 140568902079936 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:51:25.334816 140568902079936 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:51:25.397965 140568902079936 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:51:25.404077 140568902079936 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:51:25.591293 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:51:25.605961 140568902079936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:51:25.618725 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:51:25.619817 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:51:25.627027 140568902079936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:51:25.632390 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:51:25.632661 140568902079936 optimization.py:36] ++++++ warmup starts at step 0, for 1 steps ++++++
W0814 16:51:25.645661 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:51:25.758272 140568902079936 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:51:25.800616 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:25.846633 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:25.899514 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.066577 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.117929 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.167510 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.219607 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.267512 140568902079936 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:51:26.310194 140568902079936 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:51:26.326852 140568902079936 estimator.py:1147] Done calling model_fn.
I0814 16:51:29.855087 140568902079936 tpu_estimator.py:499] TPU job name worker
I0814 16:51:29.969283 140568902079936 monitored_session.py:240] Graph was finalized.
I0814 16:51:30.621442 140568902079936 session_manager.py:500] Running local_init_op.
I0814 16:51:30.669084 140568902079936 session_manager.py:502] Done running local_init_op.
I0814 16:51:33.289458 140568902079936 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:51:45.769840 140568902079936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:51:45.926323 140568902079936 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:51:45.926745 140568902079936 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:51:45.927171: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:51:45.931972 140568902079936 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:51:45.934077 140568902079936 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:51:45.938735 140568902079936 tpu_estimator.py:557] Init TPU system
I0814 16:51:57.803494 140568902079936 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:51:57.804647 140568005953280 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:51:57.805548 140567997560576 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:51:57.871166 140568902079936 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:51:57.872046 140568902079936 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:51:57.945234 140567989167872 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:51:58.082292 140567989167872 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:52:02.749183 140567997560576 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:52:07.047986 140568902079936 basic_session_run_hooks.py:262] loss = 115351.086, step = 30
I0814 16:52:07.050539 140568902079936 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:52:20.841732 140568902079936 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:52:20.842089 140568902079936 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:52:20.843718 140568005953280 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:52:20.844016 140568005953280 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:52:20.844305 140568902079936 error_handling.py:96] infeed marked as finished
I0814 16:52:20.844604 140568902079936 tpu_estimator.py:602] Stop output thread controller
I0814 16:52:20.844675 140568902079936 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:52:20.844974 140567997560576 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:52:20.845175 140567997560576 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:52:20.845428 140568902079936 error_handling.py:96] outfeed marked as finished
I0814 16:52:20.845598 140568902079936 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:52:28.194668 140568902079936 estimator.py:368] Loss for final step: 115351.086.
I0814 16:52:28.195555 140568902079936 error_handling.py:96] training_loop marked as finished
I0814 16:52:28.990849 140568902079936 estimator.py:1145] Calling model_fn.
E0814 16:52:29.728632 140568902079936 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:52:29.958528 140568902079936 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:52:29.981347 140568902079936 estimator.py:1147] Done calling model_fn.
I0814 16:52:29.997829 140568902079936 evaluation.py:255] Starting evaluation at 2019-08-14T16:52:29Z
I0814 16:52:29.998064 140568902079936 tpu_estimator.py:499] TPU job name worker
I0814 16:52:30.078340 140568902079936 monitored_session.py:240] Graph was finalized.
W0814 16:52:30.079128 140568902079936 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:52:30.265877 140568902079936 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:52:33.868067 140568902079936 session_manager.py:500] Running local_init_op.
I0814 16:52:33.892703 140568902079936 session_manager.py:502] Done running local_init_op.
I0814 16:52:33.947941 140568902079936 tpu_estimator.py:557] Init TPU system
I0814 16:52:45.235804 140568902079936 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:52:45.236763 140568002283264 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:52:45.237185 140567993890560 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:52:45.303673 140568902079936 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:52:45.329890 140568902079936 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:52:45.330248 140568902079936 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:52:45.366317 140567980513024 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:52:45.473627 140567980513024 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:52:46.115431 140567993890560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:52:46.509476 140568902079936 evaluation.py:167] Evaluation [10/10]
I0814 16:52:46.509896 140568902079936 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:52:46.509991 140568902079936 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:52:46.510194 140568002283264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:52:46.510298 140568002283264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:52:46.510521 140568902079936 error_handling.py:96] infeed marked as finished
I0814 16:52:46.510631 140568902079936 tpu_estimator.py:602] Stop output thread controller
I0814 16:52:46.510689 140568902079936 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:52:46.510798 140567993890560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:52:46.510879 140567993890560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:52:46.510993 140568902079936 error_handling.py:96] outfeed marked as finished
I0814 16:52:46.511070 140568902079936 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:53:15.573955 140568902079936 evaluation.py:275] Finished evaluation at 2019-08-14-16:53:15
I0814 16:53:15.574290 140568902079936 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 83268.73
I0814 16:53:19.947120 140568902079936 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:53:20.887361 140568902079936 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 83268.73, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/#1565801487870351...
Removing gs://yangyou-mnist/log/checkpoint#1565801537023451...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801533878837...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801500843641...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801488.v3-8-tpu#1565801540531939...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801505256668...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801492709271...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801534721530...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801499885608...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801539519351...
Removing gs://yangyou-mnist/log/eval/#1565801597244462...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801597.v3-8-tpu#1565801600571704...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:53:24.792735 140383681017280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:53:24.793535 140383681017280 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:53:24.796118 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:53:24.796993 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:53:24.797601 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:53:24.797729 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:53:25.231339 140383681017280 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:53:25.239212 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:53:25.243405 140383681017280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:53:25.298985 140383681017280 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:53:25.299252 140383681017280 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:53:25.407341 140383681017280 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:53:25.460679 140383681017280 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:53:25.460958 140383681017280 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:53:25.637618 140383681017280 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fad7999c090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fad7bb7b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:53:25.638005 140383681017280 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:53:25.969739 140383681017280 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:53:25.972976: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:53:25.987462 140383681017280 tpu_system_metadata.py:148] Found TPU system:
I0814 16:53:25.987709 140383681017280 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:53:25.988286 140383681017280 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:53:25.988346 140383681017280 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:53:25.988425 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:53:25.988821 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:53:25.988878 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:53:25.988930 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:53:25.988979 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:53:25.989026 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:53:25.989084 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:53:25.989131 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:53:25.989181 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:53:25.989229 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:53:25.989278 140383681017280 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:53:25.995400 140383681017280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:53:26.008057 140383681017280 estimator.py:1145] Calling model_fn.
W0814 16:53:26.008728 140383681017280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:53:26.296308 140383681017280 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:53:26.712488 140383681017280 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:53:26.774641 140383681017280 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:53:26.780786 140383681017280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:53:26.963501 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:53:26.977211 140383681017280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:53:26.989408 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:53:26.990480 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:53:26.997420 140383681017280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:53:27.002621 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:53:27.002837 140383681017280 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 16:53:27.015346 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:53:27.125145 140383681017280 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:53:27.166362 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.210587 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.263556 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.431863 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.482589 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.531342 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.581677 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.627548 140383681017280 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:53:27.668843 140383681017280 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:53:27.685125 140383681017280 estimator.py:1147] Done calling model_fn.
I0814 16:53:31.157177 140383681017280 tpu_estimator.py:499] TPU job name worker
I0814 16:53:31.277435 140383681017280 monitored_session.py:240] Graph was finalized.
I0814 16:53:31.998920 140383681017280 session_manager.py:500] Running local_init_op.
I0814 16:53:32.049212 140383681017280 session_manager.py:502] Done running local_init_op.
I0814 16:53:35.118681 140383681017280 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:53:47.365119 140383681017280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:53:47.523297 140383681017280 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:53:47.523813 140383681017280 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:53:47.524233: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:53:47.529285 140383681017280 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:53:47.531625 140383681017280 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:53:47.535634 140383681017280 tpu_estimator.py:557] Init TPU system
I0814 16:53:59.166289 140383681017280 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:53:59.167201 140382776309504 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:53:59.167690 140382767916800 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:53:59.232702 140383681017280 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:53:59.234074 140383681017280 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:53:59.239451 140382759524096 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:53:59.344911 140382759524096 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:54:03.897690 140382767916800 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:54:08.592922 140383681017280 basic_session_run_hooks.py:262] loss = 2.1402035, step = 30
I0814 16:54:08.595289 140383681017280 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:54:21.942013 140383681017280 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:54:21.942305 140383681017280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:54:21.942542 140382776309504 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:54:21.942646 140382776309504 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:54:21.942780 140383681017280 error_handling.py:96] infeed marked as finished
I0814 16:54:21.942873 140383681017280 tpu_estimator.py:602] Stop output thread controller
I0814 16:54:21.942920 140383681017280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:54:21.943032 140382767916800 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:54:21.943105 140382767916800 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:54:21.943217 140383681017280 error_handling.py:96] outfeed marked as finished
I0814 16:54:21.943296 140383681017280 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:54:29.482610 140383681017280 estimator.py:368] Loss for final step: 2.1402035.
I0814 16:54:29.483401 140383681017280 error_handling.py:96] training_loop marked as finished
I0814 16:54:30.275368 140383681017280 estimator.py:1145] Calling model_fn.
E0814 16:54:31.088979 140383681017280 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:54:31.320925 140383681017280 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:54:31.343482 140383681017280 estimator.py:1147] Done calling model_fn.
I0814 16:54:31.361084 140383681017280 evaluation.py:255] Starting evaluation at 2019-08-14T16:54:31Z
I0814 16:54:31.361341 140383681017280 tpu_estimator.py:499] TPU job name worker
I0814 16:54:31.442481 140383681017280 monitored_session.py:240] Graph was finalized.
W0814 16:54:31.443310 140383681017280 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:54:31.649800 140383681017280 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:54:34.122704 140383681017280 session_manager.py:500] Running local_init_op.
I0814 16:54:34.148262 140383681017280 session_manager.py:502] Done running local_init_op.
I0814 16:54:34.203835 140383681017280 tpu_estimator.py:557] Init TPU system
I0814 16:54:46.080667 140383681017280 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:54:46.081928 140382776309504 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:54:46.082820 140382767916800 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:54:46.151648 140383681017280 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:54:46.180332 140383681017280 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:54:46.180813 140383681017280 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:54:46.288304 140382759524096 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:54:46.412986 140382759524096 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:54:46.976988 140382767916800 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:54:47.259898 140383681017280 evaluation.py:167] Evaluation [10/10]
I0814 16:54:47.260288 140383681017280 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:54:47.260379 140383681017280 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:54:47.260715 140382776309504 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:54:47.261001 140382776309504 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:54:47.261245 140383681017280 error_handling.py:96] infeed marked as finished
I0814 16:54:47.261441 140383681017280 tpu_estimator.py:602] Stop output thread controller
I0814 16:54:47.261584 140383681017280 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:54:47.261816 140382767916800 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:54:47.262017 140382767916800 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:54:47.262233 140383681017280 error_handling.py:96] outfeed marked as finished
I0814 16:54:47.262398 140383681017280 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:55:16.513804 140383681017280 evaluation.py:275] Finished evaluation at 2019-08-14-16:55:16
I0814 16:55:16.514162 140383681017280 estimator.py:2039] Saving dict for global step 30: accuracy = 0.5956, global_step = 30, loss = 2.1365159
I0814 16:55:20.765882 140383681017280 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:55:21.588284 140383681017280 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.1365159, 'global_step': 30, 'accuracy': 0.5956}

Removing gs://yangyou-mnist/log/#1565801609232262...
Removing gs://yangyou-mnist/log/checkpoint#1565801658520534...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801622477398...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801614533350...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801626818555...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801609.v3-8-tpu#1565801661625348...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801656410862...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801621586022...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801655602201...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801660696702...
Removing gs://yangyou-mnist/log/eval/#1565801718146289...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801718.v3-8-tpu#1565801721280430...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:55:25.441209 140497872299456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:55:25.441989 140497872299456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:55:25.444520 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:55:25.445312 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:55:25.445864 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:55:25.445987 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:55:25.861330 140497872299456 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:55:25.868091 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:55:25.871810 140497872299456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:55:25.926321 140497872299456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:55:25.926592 140497872299456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:55:26.041368 140497872299456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:55:26.097101 140497872299456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:55:26.097366 140497872299456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:55:26.204292 140497872299456 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc80fed0450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc8120c6210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:55:26.204715 140497872299456 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:55:26.525854 140497872299456 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:55:26.528646: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:55:26.540793 140497872299456 tpu_system_metadata.py:148] Found TPU system:
I0814 16:55:26.541030 140497872299456 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:55:26.541520 140497872299456 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:55:26.541579 140497872299456 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:55:26.541630 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:55:26.541934 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:55:26.541990 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:55:26.542047 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:55:26.542098 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:55:26.542145 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:55:26.542191 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:55:26.542237 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:55:26.542282 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:55:26.542326 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:55:26.542372 140497872299456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:55:26.548168 140497872299456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:55:26.560355 140497872299456 estimator.py:1145] Calling model_fn.
W0814 16:55:26.561012 140497872299456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:55:26.834249 140497872299456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:55:27.281938 140497872299456 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:55:27.343012 140497872299456 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:55:27.349045 140497872299456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:55:27.527225 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:55:27.541107 140497872299456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:55:27.553246 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:55:27.554317 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:55:27.561564 140497872299456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:55:27.566898 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:55:27.567127 140497872299456 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 16:55:27.579988 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:55:27.690454 140497872299456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:55:27.731286 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:27.775486 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:27.826077 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:27.986923 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:28.037307 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:28.085103 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:28.136224 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:28.181442 140497872299456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:55:28.222723 140497872299456 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:55:28.238986 140497872299456 estimator.py:1147] Done calling model_fn.
I0814 16:55:31.620394 140497872299456 tpu_estimator.py:499] TPU job name worker
I0814 16:55:31.728564 140497872299456 monitored_session.py:240] Graph was finalized.
I0814 16:55:32.376312 140497872299456 session_manager.py:500] Running local_init_op.
I0814 16:55:32.423013 140497872299456 session_manager.py:502] Done running local_init_op.
I0814 16:55:35.967885 140497872299456 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:55:48.200680 140497872299456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:55:48.344666 140497872299456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:55:48.345124 140497872299456 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:55:48.345510: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:55:48.350439 140497872299456 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:55:48.352467 140497872299456 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:55:48.357286 140497872299456 tpu_estimator.py:557] Init TPU system
I0814 16:56:00.076384 140497872299456 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:56:00.077239 140496827574016 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:56:00.077718 140496819181312 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:56:00.142261 140497872299456 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:56:00.143748 140497872299456 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:56:00.145162 140496810788608 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:56:00.328438 140496810788608 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:56:04.860644 140496819181312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:56:09.152607 140497872299456 basic_session_run_hooks.py:262] loss = 1.9048946, step = 30
I0814 16:56:09.155145 140497872299456 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:56:22.171336 140497872299456 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:56:22.171622 140497872299456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:56:22.171840 140496827574016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:56:22.171952 140496827574016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:56:22.172092 140497872299456 error_handling.py:96] infeed marked as finished
I0814 16:56:22.172190 140497872299456 tpu_estimator.py:602] Stop output thread controller
I0814 16:56:22.172239 140497872299456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:56:22.172350 140496819181312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:56:22.172475 140496819181312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:56:22.172621 140497872299456 error_handling.py:96] outfeed marked as finished
I0814 16:56:22.172712 140497872299456 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:56:30.465734 140497872299456 estimator.py:368] Loss for final step: 1.9048946.
I0814 16:56:30.466665 140497872299456 error_handling.py:96] training_loop marked as finished
I0814 16:56:31.257411 140497872299456 estimator.py:1145] Calling model_fn.
E0814 16:56:31.972181 140497872299456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:56:32.203732 140497872299456 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:56:32.226886 140497872299456 estimator.py:1147] Done calling model_fn.
I0814 16:56:32.244384 140497872299456 evaluation.py:255] Starting evaluation at 2019-08-14T16:56:32Z
I0814 16:56:32.244754 140497872299456 tpu_estimator.py:499] TPU job name worker
I0814 16:56:32.323998 140497872299456 monitored_session.py:240] Graph was finalized.
W0814 16:56:32.324769 140497872299456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:56:32.505785 140497872299456 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:56:35.165374 140497872299456 session_manager.py:500] Running local_init_op.
I0814 16:56:35.195203 140497872299456 session_manager.py:502] Done running local_init_op.
I0814 16:56:35.240972 140497872299456 tpu_estimator.py:557] Init TPU system
I0814 16:56:47.052746 140497872299456 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0814 16:56:47.053613 140496835966720 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:56:47.054152 140496827574016 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:56:47.122179 140497872299456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:56:47.147422 140497872299456 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:56:47.147749 140497872299456 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:56:47.177381 140496819181312 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:56:47.299253 140496819181312 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:56:47.925409 140496827574016 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:56:48.256516 140497872299456 evaluation.py:167] Evaluation [10/10]
I0814 16:56:48.256922 140497872299456 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:56:48.257013 140497872299456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:56:48.257188 140496835966720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:56:48.257294 140496835966720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:56:48.257431 140497872299456 error_handling.py:96] infeed marked as finished
I0814 16:56:48.257522 140497872299456 tpu_estimator.py:602] Stop output thread controller
I0814 16:56:48.257575 140497872299456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:56:48.257760 140496827574016 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:56:48.257879 140496827574016 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:56:48.258004 140497872299456 error_handling.py:96] outfeed marked as finished
I0814 16:56:48.258086 140497872299456 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:57:17.394304 140497872299456 evaluation.py:275] Finished evaluation at 2019-08-14-16:57:17
I0814 16:57:17.394622 140497872299456 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7467, global_step = 30, loss = 1.8920475
I0814 16:57:21.677419 140497872299456 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 16:57:22.481165 140497872299456 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.8920475, 'global_step': 30, 'accuracy': 0.7467}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801742988981...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801747657072...
Removing gs://yangyou-mnist/log/#1565801729788850...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801729.v3-8-tpu#1565801781866687...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801775736444...
Removing gs://yangyou-mnist/log/checkpoint#1565801778760464...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801735373129...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801776534370...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801742119012...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801780923077...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565801839.v3-8-tpu#1565801842173506...
Removing gs://yangyou-mnist/log/eval/#1565801839071875...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 16:57:27.256669 140688732861888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 16:57:27.257462 140688732861888 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 16:57:27.260024 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 16:57:27.261316 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 16:57:27.261939 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 16:57:27.262079 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 16:57:27.682370 140688732861888 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 16:57:27.689810 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 16:57:27.694470 140688732861888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:57:27.752513 140688732861888 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:57:27.752815 140688732861888 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:57:27.942851 140688732861888 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 16:57:27.985528 140688732861888 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 16:57:27.985837 140688732861888 transport.py:157] Attempting refresh to obtain initial access_token
I0814 16:57:28.165596 140688732861888 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff4801a1610>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff482397210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 16:57:28.165982 140688732861888 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 16:57:28.500958 140688732861888 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 16:57:28.503962: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:57:28.517429 140688732861888 tpu_system_metadata.py:148] Found TPU system:
I0814 16:57:28.517671 140688732861888 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 16:57:28.518171 140688732861888 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 16:57:28.518234 140688732861888 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 16:57:28.518287 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 16:57:28.518575 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 16:57:28.518634 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 16:57:28.518683 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 16:57:28.518733 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 16:57:28.518796 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 16:57:28.518845 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 16:57:28.518891 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 16:57:28.518937 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 16:57:28.518984 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 16:57:28.519035 140688732861888 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 16:57:28.525238 140688732861888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 16:57:28.537921 140688732861888 estimator.py:1145] Calling model_fn.
W0814 16:57:28.538559 140688732861888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 16:57:28.817848 140688732861888 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 16:57:29.238322 140688732861888 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 16:57:29.309422 140688732861888 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 16:57:29.315984 140688732861888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:57:29.501334 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 16:57:29.515331 140688732861888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 16:57:29.527865 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 16:57:29.529004 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 16:57:29.536173 140688732861888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 16:57:29.541567 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 16:57:29.541790 140688732861888 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 16:57:29.554687 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 16:57:29.665421 140688732861888 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 16:57:29.708652 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:29.753668 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:29.805094 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:29.972825 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:30.023889 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:30.072846 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:30.124386 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:30.171264 140688732861888 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 16:57:30.213650 140688732861888 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 16:57:30.230349 140688732861888 estimator.py:1147] Done calling model_fn.
I0814 16:57:33.493230 140688732861888 tpu_estimator.py:499] TPU job name worker
I0814 16:57:33.603982 140688732861888 monitored_session.py:240] Graph was finalized.
I0814 16:57:34.284243 140688732861888 session_manager.py:500] Running local_init_op.
I0814 16:57:34.342863 140688732861888 session_manager.py:502] Done running local_init_op.
I0814 16:57:37.035337 140688732861888 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 16:57:49.373789 140688732861888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 16:57:49.516052 140688732861888 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:57:49.516551 140688732861888 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 16:57:49.517095: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 16:57:49.523619 140688732861888 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 16:57:49.525955 140688732861888 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 16:57:49.530544 140688732861888 tpu_estimator.py:557] Init TPU system
I0814 16:58:04.080674 140688732861888 tpu_estimator.py:566] Initialized TPU in 14 seconds
I0814 16:58:04.081846 140687559358208 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:58:04.082631 140687550965504 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:58:04.148163 140688732861888 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 16:58:04.149142 140688732861888 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 16:58:04.198874 140687542572800 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:58:04.316035 140687542572800 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:58:08.854008 140687550965504 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:58:13.568273 140688732861888 basic_session_run_hooks.py:262] loss = 1.4816271, step = 30
I0814 16:58:13.571105 140688732861888 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 16:58:27.128334 140688732861888 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:58:27.128705 140688732861888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:58:27.128890 140687559358208 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:58:27.128992 140687559358208 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:58:27.129127 140688732861888 error_handling.py:96] infeed marked as finished
I0814 16:58:27.129216 140688732861888 tpu_estimator.py:602] Stop output thread controller
I0814 16:58:27.129266 140688732861888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:58:27.129375 140687550965504 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:58:27.129456 140687550965504 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:58:27.129565 140688732861888 error_handling.py:96] outfeed marked as finished
I0814 16:58:27.129647 140688732861888 tpu_estimator.py:606] Shutdown TPU system.
I0814 16:58:34.466296 140688732861888 estimator.py:368] Loss for final step: 1.4816271.
I0814 16:58:34.467139 140688732861888 error_handling.py:96] training_loop marked as finished
I0814 16:58:35.255705 140688732861888 estimator.py:1145] Calling model_fn.
E0814 16:58:35.951736 140688732861888 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 16:58:36.187741 140688732861888 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 16:58:36.210247 140688732861888 estimator.py:1147] Done calling model_fn.
I0814 16:58:36.229177 140688732861888 evaluation.py:255] Starting evaluation at 2019-08-14T16:58:36Z
I0814 16:58:36.229424 140688732861888 tpu_estimator.py:499] TPU job name worker
I0814 16:58:36.313575 140688732861888 monitored_session.py:240] Graph was finalized.
W0814 16:58:36.314326 140688732861888 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 16:58:36.498368 140688732861888 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 16:58:39.240654 140688732861888 session_manager.py:500] Running local_init_op.
I0814 16:58:39.270512 140688732861888 session_manager.py:502] Done running local_init_op.
I0814 16:58:39.324062 140688732861888 tpu_estimator.py:557] Init TPU system
I0814 16:59:47.981028 140688732861888 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 16:59:47.982064 140687559358208 tpu_estimator.py:514] Starting infeed thread controller.
I0814 16:59:47.982799 140687550965504 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 16:59:48.082578 140688732861888 util.py:98] Initialized dataset iterators in 0 seconds
I0814 16:59:48.107841 140688732861888 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 16:59:48.108196 140688732861888 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 16:59:48.148453 140687542572800 transport.py:157] Attempting refresh to obtain initial access_token
W0814 16:59:48.264777 140687542572800 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 16:59:48.928708 140687550965504 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 16:59:49.226898 140688732861888 evaluation.py:167] Evaluation [10/10]
I0814 16:59:49.227255 140688732861888 tpu_estimator.py:598] Stop infeed thread controller
I0814 16:59:49.227339 140688732861888 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 16:59:49.227624 140687559358208 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 16:59:49.227888 140687559358208 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 16:59:49.228178 140688732861888 error_handling.py:96] infeed marked as finished
I0814 16:59:49.228395 140688732861888 tpu_estimator.py:602] Stop output thread controller
I0814 16:59:49.228492 140688732861888 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 16:59:49.228682 140687550965504 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 16:59:49.228854 140687550965504 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 16:59:49.229074 140688732861888 error_handling.py:96] outfeed marked as finished
I0814 16:59:49.229244 140688732861888 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:00:18.361289 140688732861888 evaluation.py:275] Finished evaluation at 2019-08-14-17:00:18
I0814 17:00:18.361634 140688732861888 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7944, global_step = 30, loss = 1.4608225
I0814 17:00:22.713048 140688732861888 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:00:23.563783 140688732861888 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.4608225, 'global_step': 30, 'accuracy': 0.7944}

Removing gs://yangyou-mnist/log/#1565801851728881...
Removing gs://yangyou-mnist/log/checkpoint#1565801903597955...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565801868862849...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565801864604249...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565801900321554...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565801901161813...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565801863750373...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565801856456065...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565801851.v3-8-tpu#1565801906827004...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565801905876283...
Removing gs://yangyou-mnist/log/eval/#1565802020054190...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565802020.v3-8-tpu#1565802023197607...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:00:27.485354 139730227578304 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:00:27.486133 139730227578304 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:00:27.488804 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:00:27.489609 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:00:27.490174 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:00:27.490324 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:00:27.893548 139730227578304 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:00:27.900793 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:00:27.904776 139730227578304 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:00:27.960580 139730227578304 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:00:27.960856 139730227578304 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:00:28.065984 139730227578304 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:00:28.184269 139730227578304 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:00:28.184619 139730227578304 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:00:28.289793 139730227578304 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1554bd9150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1556db8210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:00:28.290142 139730227578304 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:00:28.609668 139730227578304 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:00:28.612664: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:00:28.625729 139730227578304 tpu_system_metadata.py:148] Found TPU system:
I0814 17:00:28.625955 139730227578304 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:00:28.626435 139730227578304 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:00:28.626497 139730227578304 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:00:28.626557 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:00:28.626867 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:00:28.626923 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:00:28.626972 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:00:28.627021 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:00:28.627070 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:00:28.627119 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:00:28.627166 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:00:28.627212 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:00:28.627258 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:00:28.627305 139730227578304 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:00:28.633212 139730227578304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:00:28.645472 139730227578304 estimator.py:1145] Calling model_fn.
W0814 17:00:28.646074 139730227578304 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:00:28.932342 139730227578304 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:00:29.347901 139730227578304 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:00:29.409866 139730227578304 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:00:29.416018 139730227578304 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:00:29.595463 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:00:29.609081 139730227578304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:00:29.621572 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:00:29.622606 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:00:29.629640 139730227578304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:00:29.634944 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:00:29.635160 139730227578304 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:00:29.647564 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:00:29.758445 139730227578304 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:00:29.799897 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:29.844110 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:29.896178 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.059950 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.110775 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.159548 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.210134 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.256114 139730227578304 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:00:30.300466 139730227578304 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:00:30.317451 139730227578304 estimator.py:1147] Done calling model_fn.
I0814 17:00:33.758816 139730227578304 tpu_estimator.py:499] TPU job name worker
I0814 17:00:33.871294 139730227578304 monitored_session.py:240] Graph was finalized.
I0814 17:00:34.537677 139730227578304 session_manager.py:500] Running local_init_op.
I0814 17:00:34.584908 139730227578304 session_manager.py:502] Done running local_init_op.
I0814 17:00:37.320750 139730227578304 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:00:50.027010 139730227578304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:00:50.167099 139730227578304 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:00:50.167577 139730227578304 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:00:50.168024: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:00:50.173830 139730227578304 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:00:50.176042 139730227578304 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:00:50.180038 139730227578304 tpu_estimator.py:557] Init TPU system
I0814 17:01:33.223598 139730227578304 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0814 17:01:33.224564 139729457092352 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:01:33.225179 139728976344832 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:01:33.298728 139730227578304 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:01:33.299906 139730227578304 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:01:33.310403 139728967952128 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:01:33.455982 139728967952128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:01:38.186568 139728976344832 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:01:42.918932 139730227578304 basic_session_run_hooks.py:262] loss = 0.96408373, step = 30
I0814 17:01:42.921492 139730227578304 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:01:56.401477 139730227578304 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:01:56.401834 139730227578304 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:01:56.403254 139729457092352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:01:56.403557 139729457092352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:01:56.403772 139730227578304 error_handling.py:96] infeed marked as finished
I0814 17:01:56.404007 139730227578304 tpu_estimator.py:602] Stop output thread controller
I0814 17:01:56.404073 139730227578304 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:01:56.404359 139728976344832 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:01:56.404570 139728976344832 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:01:56.404838 139730227578304 error_handling.py:96] outfeed marked as finished
I0814 17:01:56.405010 139730227578304 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:02:03.598409 139730227578304 estimator.py:368] Loss for final step: 0.96408373.
I0814 17:02:03.599303 139730227578304 error_handling.py:96] training_loop marked as finished
I0814 17:02:04.324347 139730227578304 estimator.py:1145] Calling model_fn.
E0814 17:02:05.014734 139730227578304 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:02:05.253493 139730227578304 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:02:05.275886 139730227578304 estimator.py:1147] Done calling model_fn.
I0814 17:02:05.292884 139730227578304 evaluation.py:255] Starting evaluation at 2019-08-14T17:02:05Z
I0814 17:02:05.293133 139730227578304 tpu_estimator.py:499] TPU job name worker
I0814 17:02:05.372026 139730227578304 monitored_session.py:240] Graph was finalized.
W0814 17:02:05.372868 139730227578304 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:02:05.564785 139730227578304 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:02:08.143923 139730227578304 session_manager.py:500] Running local_init_op.
I0814 17:02:08.168703 139730227578304 session_manager.py:502] Done running local_init_op.
I0814 17:02:08.223021 139730227578304 tpu_estimator.py:557] Init TPU system
I0814 17:03:16.037003 139730227578304 tpu_estimator.py:566] Initialized TPU in 67 seconds
I0814 17:03:16.038110 139729457092352 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:03:16.039012 139728976344832 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:03:16.107378 139730227578304 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:03:16.132991 139730227578304 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:03:16.133368 139730227578304 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:03:16.162393 139728967952128 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:03:16.477562 139728967952128 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:03:16.916219 139728976344832 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:03:17.300679 139730227578304 evaluation.py:167] Evaluation [10/10]
I0814 17:03:17.301084 139730227578304 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:03:17.301157 139730227578304 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:03:17.301461 139729457092352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:03:17.301745 139729457092352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:03:17.301955 139730227578304 error_handling.py:96] infeed marked as finished
I0814 17:03:17.302141 139730227578304 tpu_estimator.py:602] Stop output thread controller
I0814 17:03:17.302195 139730227578304 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:03:17.302366 139728976344832 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:03:17.302582 139728976344832 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:03:17.302764 139730227578304 error_handling.py:96] outfeed marked as finished
I0814 17:03:17.302908 139730227578304 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:03:46.561806 139730227578304 evaluation.py:275] Finished evaluation at 2019-08-14-17:03:46
I0814 17:03:46.562170 139730227578304 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8287, global_step = 30, loss = 0.9207134
I0814 17:03:50.825258 139730227578304 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:03:51.641634 139730227578304 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.9207134, 'global_step': 30, 'accuracy': 0.8287}

Removing gs://yangyou-mnist/log/#1565802031872169...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565802109487606...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565802045046721...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565802049484094...
Removing gs://yangyou-mnist/log/checkpoint#1565802112664688...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565802110377585...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565802032.v3-8-tpu#1565802116094728...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565802044199953...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565802036742222...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565802115150786...
Removing gs://yangyou-mnist/log/eval/#1565802228216932...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565802228.v3-8-tpu#1565802231326634...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:03:55.403925 140421252306368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:03:55.404772 140421252306368 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:03:55.407396 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:03:55.408246 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:03:55.409033 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:03:55.409173 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:03:55.821697 140421252306368 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:03:55.830332 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:03:55.834440 140421252306368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:03:55.891433 140421252306368 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:03:55.891710 140421252306368 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:03:56.024672 140421252306368 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:03:56.078352 140421252306368 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:03:56.078646 140421252306368 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:03:56.287662 140421252306368 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb6390622d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb63b241210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:03:56.288028 140421252306368 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:03:56.614146 140421252306368 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:03:56.617024: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:03:56.630192 140421252306368 tpu_system_metadata.py:148] Found TPU system:
I0814 17:03:56.630451 140421252306368 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:03:56.631031 140421252306368 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:03:56.631093 140421252306368 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:03:56.631148 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:03:56.631448 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:03:56.631505 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:03:56.631556 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:03:56.631613 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:03:56.631663 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:03:56.631710 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:03:56.631757 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:03:56.631804 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:03:56.631851 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:03:56.631900 140421252306368 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:03:56.638060 140421252306368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:03:56.650621 140421252306368 estimator.py:1145] Calling model_fn.
W0814 17:03:56.651279 140421252306368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:03:56.948177 140421252306368 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:03:57.365710 140421252306368 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:03:57.428471 140421252306368 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:03:57.434562 140421252306368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:03:57.618441 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:03:57.632473 140421252306368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:03:57.645068 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:03:57.646167 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:03:57.653125 140421252306368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:03:57.658535 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:03:57.658760 140421252306368 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:03:57.671188 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:03:57.782726 140421252306368 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:03:57.825066 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:57.870121 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:57.922240 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.086350 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.138400 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.187479 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.238455 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.285469 140421252306368 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:03:58.327696 140421252306368 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:03:58.344228 140421252306368 estimator.py:1147] Done calling model_fn.
I0814 17:04:01.855125 140421252306368 tpu_estimator.py:499] TPU job name worker
I0814 17:04:01.970343 140421252306368 monitored_session.py:240] Graph was finalized.
I0814 17:04:02.704987 140421252306368 session_manager.py:500] Running local_init_op.
I0814 17:04:02.754853 140421252306368 session_manager.py:502] Done running local_init_op.
I0814 17:04:05.492604 140421252306368 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:04:18.040093 140421252306368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:04:18.181133 140421252306368 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:04:18.181612 140421252306368 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:04:18.182086: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:04:18.187202 140421252306368 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:04:18.189388 140421252306368 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:04:18.193540 140421252306368 tpu_estimator.py:557] Init TPU system
I0814 17:05:00.110631 140421252306368 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:05:00.111574 140420490180352 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:05:00.112056 140420481787648 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:05:00.172090 140419996317440 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:05:00.172837 140421252306368 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:05:00.174499 140421252306368 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:05:00.350337 140419996317440 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:05:04.993839 140420481787648 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:05:09.857790 140421252306368 basic_session_run_hooks.py:262] loss = 0.54357857, step = 30
I0814 17:05:09.860562 140421252306368 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:05:25.197037 140421252306368 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:05:25.197367 140421252306368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:05:25.197586 140420490180352 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:05:25.197695 140420490180352 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:05:25.197846 140421252306368 error_handling.py:96] infeed marked as finished
I0814 17:05:25.197953 140421252306368 tpu_estimator.py:602] Stop output thread controller
I0814 17:05:25.198013 140421252306368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:05:25.198148 140420481787648 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:05:25.198223 140420481787648 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:05:25.198338 140421252306368 error_handling.py:96] outfeed marked as finished
I0814 17:05:25.198417 140421252306368 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:05:30.482148 140421252306368 estimator.py:368] Loss for final step: 0.54357857.
I0814 17:05:30.483124 140421252306368 error_handling.py:96] training_loop marked as finished
I0814 17:05:31.260086 140421252306368 estimator.py:1145] Calling model_fn.
E0814 17:05:31.978066 140421252306368 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:05:32.204037 140421252306368 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:05:32.225652 140421252306368 estimator.py:1147] Done calling model_fn.
I0814 17:05:32.241986 140421252306368 evaluation.py:255] Starting evaluation at 2019-08-14T17:05:32Z
I0814 17:05:32.242239 140421252306368 tpu_estimator.py:499] TPU job name worker
I0814 17:05:32.321507 140421252306368 monitored_session.py:240] Graph was finalized.
W0814 17:05:32.322299 140421252306368 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:05:32.528239 140421252306368 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:05:35.279114 140421252306368 session_manager.py:500] Running local_init_op.
I0814 17:05:35.305438 140421252306368 session_manager.py:502] Done running local_init_op.
I0814 17:05:35.355272 140421252306368 tpu_estimator.py:557] Init TPU system
I0814 17:06:44.103483 140421252306368 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:06:44.104599 140420486510336 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:06:44.105086 140419996317440 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:06:44.173052 140421252306368 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:06:44.197448 140421252306368 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:06:44.197803 140421252306368 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:06:44.291934 140419987924736 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:06:44.520493 140419987924736 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:06:45.014193 140419996317440 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:06:45.329207 140421252306368 evaluation.py:167] Evaluation [10/10]
I0814 17:06:45.329540 140421252306368 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:06:45.329617 140421252306368 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:06:45.329885 140420486510336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:06:45.329982 140420486510336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:06:45.330118 140421252306368 error_handling.py:96] infeed marked as finished
I0814 17:06:45.330214 140421252306368 tpu_estimator.py:602] Stop output thread controller
I0814 17:06:45.330280 140421252306368 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:06:45.330393 140419996317440 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:06:45.330466 140419996317440 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:06:45.330583 140421252306368 error_handling.py:96] outfeed marked as finished
I0814 17:06:45.330696 140421252306368 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:07:14.611813 140421252306368 evaluation.py:275] Finished evaluation at 2019-08-14-17:07:14
I0814 17:07:14.612198 140421252306368 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8801, global_step = 30, loss = 0.50370854
I0814 17:07:18.826595 140421252306368 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:07:19.622123 140421252306368 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.50370854, 'global_step': 30, 'accuracy': 0.8801}

Removing gs://yangyou-mnist/log/#1565802239882846...
Removing gs://yangyou-mnist/log/checkpoint#1565802321748570...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565802240.v3-8-tpu#1565802324889175...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565802244920817...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565802252086855...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565802253013290...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565802257500034...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565802318242281...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565802319322193...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565802323913691...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565802436240474...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565802436.v3-8-tpu#1565802439324785...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:07:23.228228 139907471205824 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:07:23.229142 139907471205824 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:07:23.231734 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:07:23.232644 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:07:23.233261 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:07:23.233392 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:07:23.636337 139907471205824 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:07:23.643655 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:07:23.647737 139907471205824 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:07:23.767204 139907471205824 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:07:23.767487 139907471205824 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:07:23.883797 139907471205824 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:07:23.934264 139907471205824 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:07:23.934531 139907471205824 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:07:24.105953 139907471205824 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3e9948b150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3e9b66a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:07:24.106302 139907471205824 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:07:24.449430 139907471205824 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:07:24.452194: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:07:24.464282 139907471205824 tpu_system_metadata.py:148] Found TPU system:
I0814 17:07:24.464566 139907471205824 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:07:24.465035 139907471205824 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:07:24.465095 139907471205824 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:07:24.465147 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:07:24.465439 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:07:24.465493 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:07:24.465543 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:07:24.465619 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:07:24.465667 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:07:24.465723 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:07:24.465774 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:07:24.465820 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:07:24.465864 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:07:24.465912 139907471205824 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:07:24.471935 139907471205824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:07:24.483845 139907471205824 estimator.py:1145] Calling model_fn.
W0814 17:07:24.484464 139907471205824 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:07:24.750294 139907471205824 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:07:25.182238 139907471205824 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:07:25.244240 139907471205824 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:07:25.250242 139907471205824 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:07:25.432744 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:07:25.447144 139907471205824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:07:25.459486 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:07:25.460655 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:07:25.467861 139907471205824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:07:25.473211 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:07:25.473429 139907471205824 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:07:25.486049 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:07:25.595742 139907471205824 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:07:25.637257 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:25.681436 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:25.734714 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:25.895971 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:25.945431 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:25.993575 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:26.043243 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:26.088239 139907471205824 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:07:26.129601 139907471205824 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:07:26.145492 139907471205824 estimator.py:1147] Done calling model_fn.
I0814 17:07:29.567348 139907471205824 tpu_estimator.py:499] TPU job name worker
I0814 17:07:29.677918 139907471205824 monitored_session.py:240] Graph was finalized.
I0814 17:07:30.391627 139907471205824 session_manager.py:500] Running local_init_op.
I0814 17:07:30.452620 139907471205824 session_manager.py:502] Done running local_init_op.
I0814 17:07:33.835506 139907471205824 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:07:45.980592 139907471205824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:07:46.144332 139907471205824 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:07:46.144819 139907471205824 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:07:46.145234: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:07:46.150208 139907471205824 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:07:46.152875 139907471205824 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:07:46.157758 139907471205824 tpu_estimator.py:557] Init TPU system
I0814 17:08:28.121145 139907471205824 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:08:28.122042 139906709174016 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:08:28.122617 139906700781312 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:08:28.187484 139907471205824 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:08:28.188371 139907471205824 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:08:28.249284 139906692388608 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:08:28.432378 139906692388608 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:08:32.893049 139906700781312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:08:37.568593 139907471205824 basic_session_run_hooks.py:262] loss = 0.37476906, step = 30
I0814 17:08:37.571242 139907471205824 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:08:50.674580 139907471205824 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:08:50.674880 139907471205824 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:08:50.675086 139906709174016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:08:50.675194 139906709174016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:08:50.675338 139907471205824 error_handling.py:96] infeed marked as finished
I0814 17:08:50.675434 139907471205824 tpu_estimator.py:602] Stop output thread controller
I0814 17:08:50.675482 139907471205824 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:08:50.675590 139906700781312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:08:50.675673 139906700781312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:08:50.675796 139907471205824 error_handling.py:96] outfeed marked as finished
I0814 17:08:50.675873 139907471205824 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:08:58.570708 139907471205824 estimator.py:368] Loss for final step: 0.37476906.
I0814 17:08:58.571482 139907471205824 error_handling.py:96] training_loop marked as finished
I0814 17:08:59.243391 139907471205824 estimator.py:1145] Calling model_fn.
E0814 17:09:00.022573 139907471205824 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:09:00.260787 139907471205824 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:09:00.283252 139907471205824 estimator.py:1147] Done calling model_fn.
I0814 17:09:00.299886 139907471205824 evaluation.py:255] Starting evaluation at 2019-08-14T17:09:00Z
I0814 17:09:00.300138 139907471205824 tpu_estimator.py:499] TPU job name worker
I0814 17:09:00.382225 139907471205824 monitored_session.py:240] Graph was finalized.
W0814 17:09:00.383070 139907471205824 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:09:00.568502 139907471205824 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:09:03.070804 139907471205824 session_manager.py:500] Running local_init_op.
I0814 17:09:03.095596 139907471205824 session_manager.py:502] Done running local_init_op.
I0814 17:09:03.143382 139907471205824 tpu_estimator.py:557] Init TPU system
I0814 17:10:12.115389 139907471205824 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:10:12.116533 139906705504000 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:10:12.117227 139906697111296 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:10:12.184189 139907471205824 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:10:12.209330 139907471205824 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:10:12.209762 139907471205824 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:10:12.250123 139906210854656 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:10:12.379838 139906210854656 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:10:13.000591 139906697111296 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:10:13.415128 139907471205824 evaluation.py:167] Evaluation [10/10]
I0814 17:10:13.415494 139907471205824 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:10:13.415568 139907471205824 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:10:13.415844 139906705504000 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:10:13.416115 139906705504000 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:10:13.416311 139907471205824 error_handling.py:96] infeed marked as finished
I0814 17:10:13.416559 139907471205824 tpu_estimator.py:602] Stop output thread controller
I0814 17:10:13.416618 139907471205824 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:10:13.416860 139906697111296 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:10:13.417017 139906697111296 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:10:13.417172 139907471205824 error_handling.py:96] outfeed marked as finished
I0814 17:10:13.417299 139907471205824 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:10:42.477709 139907471205824 evaluation.py:275] Finished evaluation at 2019-08-14-17:10:42
I0814 17:10:42.478072 139907471205824 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9088, global_step = 30, loss = 0.37200645
I0814 17:10:46.748213 139907471205824 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:10:47.544186 139907471205824 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.37200645, 'global_step': 30, 'accuracy': 0.9088}

Removing gs://yangyou-mnist/log/#1565802447659884...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565802447.v3-8-tpu#1565802530351993...
Removing gs://yangyou-mnist/log/checkpoint#1565802527155461...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565802453254472...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565802460279662...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565802461122412...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565802465462788...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565802524070018...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565802525021546...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565802529366401...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565802644.v3-8-tpu#1565802647235359...
Removing gs://yangyou-mnist/log/eval/#1565802644126283...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:10:51.334945 140189494261184 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:10:51.335779 140189494261184 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:10:51.338423 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:10:51.339251 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:10:51.339842 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:10:51.339970 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:10:51.744563 140189494261184 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:10:51.751255 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:10:51.755044 140189494261184 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:10:51.873960 140189494261184 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:10:51.874249 140189494261184 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:10:52.121611 140189494261184 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:10:52.176079 140189494261184 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:10:52.176376 140189494261184 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:10:52.311567 140189494261184 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f80432b0190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f804548f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:10:52.311950 140189494261184 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:10:52.666759 140189494261184 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:10:52.669893: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:10:52.682809 140189494261184 tpu_system_metadata.py:148] Found TPU system:
I0814 17:10:52.683043 140189494261184 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:10:52.683573 140189494261184 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:10:52.683640 140189494261184 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:10:52.683715 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:10:52.684022 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:10:52.684079 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:10:52.684133 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:10:52.684181 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:10:52.684230 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:10:52.684276 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:10:52.684323 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:10:52.684375 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:10:52.684478 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:10:52.684531 140189494261184 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:10:52.690610 140189494261184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:10:52.703402 140189494261184 estimator.py:1145] Calling model_fn.
W0814 17:10:52.703999 140189494261184 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:10:52.986718 140189494261184 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:10:53.430234 140189494261184 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:10:53.492274 140189494261184 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:10:53.498337 140189494261184 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:10:53.676189 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:10:53.690160 140189494261184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:10:53.702636 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:10:53.703756 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:10:53.710989 140189494261184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:10:53.716280 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:10:53.716536 140189494261184 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:10:53.729455 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:10:53.840665 140189494261184 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:10:53.881413 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:53.925611 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:53.976840 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.142777 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.192395 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.240817 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.291270 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.337512 140189494261184 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:10:54.378870 140189494261184 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:10:54.394983 140189494261184 estimator.py:1147] Done calling model_fn.
I0814 17:10:57.737667 140189494261184 tpu_estimator.py:499] TPU job name worker
I0814 17:10:57.847577 140189494261184 monitored_session.py:240] Graph was finalized.
I0814 17:10:58.546145 140189494261184 session_manager.py:500] Running local_init_op.
I0814 17:10:58.595479 140189494261184 session_manager.py:502] Done running local_init_op.
I0814 17:11:01.856662 140189494261184 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:11:13.846587 140189494261184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:11:14.003103 140189494261184 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:11:14.003530 140189494261184 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:11:14.003939: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:11:14.008977 140189494261184 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:11:14.011054 140189494261184 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:11:14.015108 140189494261184 tpu_estimator.py:557] Init TPU system
I0814 17:11:56.109111 140189494261184 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:11:56.110011 140188462343936 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:11:56.110538 140188453951232 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:11:56.170119 140188445558528 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:11:56.172060 140189494261184 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:11:56.173787 140189494261184 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:11:56.289376 140188445558528 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:12:00.871341 140188453951232 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:12:05.483587 140189494261184 basic_session_run_hooks.py:262] loss = 0.21683587, step = 30
I0814 17:12:05.485830 140189494261184 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:12:18.601636 140189494261184 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:12:18.601929 140189494261184 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:12:18.602184 140188462343936 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:12:18.602302 140188462343936 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:12:18.602443 140189494261184 error_handling.py:96] infeed marked as finished
I0814 17:12:18.602541 140189494261184 tpu_estimator.py:602] Stop output thread controller
I0814 17:12:18.602590 140189494261184 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:12:18.602703 140188453951232 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:12:18.602777 140188453951232 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:12:18.602899 140189494261184 error_handling.py:96] outfeed marked as finished
I0814 17:12:18.602986 140189494261184 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:12:26.432842 140189494261184 estimator.py:368] Loss for final step: 0.21683587.
I0814 17:12:26.433574 140189494261184 error_handling.py:96] training_loop marked as finished
I0814 17:12:27.124049 140189494261184 estimator.py:1145] Calling model_fn.
E0814 17:12:27.832734 140189494261184 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:12:28.062586 140189494261184 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:12:28.085311 140189494261184 estimator.py:1147] Done calling model_fn.
I0814 17:12:28.102283 140189494261184 evaluation.py:255] Starting evaluation at 2019-08-14T17:12:28Z
I0814 17:12:28.102534 140189494261184 tpu_estimator.py:499] TPU job name worker
I0814 17:12:28.181107 140189494261184 monitored_session.py:240] Graph was finalized.
W0814 17:12:28.181852 140189494261184 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:12:28.366477 140189494261184 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:12:30.979939 140189494261184 session_manager.py:500] Running local_init_op.
I0814 17:12:31.004121 140189494261184 session_manager.py:502] Done running local_init_op.
I0814 17:12:31.057851 140189494261184 tpu_estimator.py:557] Init TPU system
I0814 17:13:40.052680 140189494261184 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:13:40.053525 140188459984640 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:13:40.053967 140188451591936 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:13:40.121182 140189494261184 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:13:40.145060 140189494261184 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:13:40.145441 140189494261184 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:13:40.184334 140188443199232 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:13:40.305330 140188443199232 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:13:40.887716 140188451591936 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:13:41.347642 140189494261184 evaluation.py:167] Evaluation [10/10]
I0814 17:13:41.347971 140189494261184 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:13:41.348042 140189494261184 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:13:41.348315 140188459984640 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:13:41.348479 140188459984640 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:13:41.348630 140189494261184 error_handling.py:96] infeed marked as finished
I0814 17:13:41.348823 140189494261184 tpu_estimator.py:602] Stop output thread controller
I0814 17:13:41.348877 140189494261184 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:13:41.348995 140188451591936 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:13:41.349070 140188451591936 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:13:41.349185 140189494261184 error_handling.py:96] outfeed marked as finished
I0814 17:13:41.349270 140189494261184 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:14:10.403114 140189494261184 evaluation.py:275] Finished evaluation at 2019-08-14-17:14:10
I0814 17:14:10.403493 140189494261184 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9418, global_step = 30, loss = 0.21141449
I0814 17:14:14.914391 140189494261184 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:14:15.679527 140189494261184 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.21141449, 'global_step': 30, 'accuracy': 0.9418}

Removing gs://yangyou-mnist/log/#1565802655905811...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565802656.v3-8-tpu#1565802738298396...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565802673339509...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565802661284561...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565802732153624...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565802668902773...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565802668062398...
Removing gs://yangyou-mnist/log/checkpoint#1565802735144248...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565802732978317...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565802737333029...
Removing gs://yangyou-mnist/log/eval/#1565802852097700...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565802852.v3-8-tpu#1565802855372425...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:14:19.436542 140407842235840 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:14:19.437350 140407842235840 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:14:19.439929 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:14:19.440948 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:14:19.441572 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:14:19.441700 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:14:19.859945 140407842235840 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:14:19.867502 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:14:19.871437 140407842235840 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:14:19.925327 140407842235840 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:14:19.925865 140407842235840 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:14:20.105287 140407842235840 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:14:20.161925 140407842235840 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:14:20.162213 140407842235840 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:14:20.259083 140407842235840 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fb319b74450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fb31bd6a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:14:20.259435 140407842235840 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:14:20.585019 140407842235840 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:14:20.587924: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:14:20.600759 140407842235840 tpu_system_metadata.py:148] Found TPU system:
I0814 17:14:20.600999 140407842235840 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:14:20.601598 140407842235840 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:14:20.601660 140407842235840 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:14:20.601712 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:14:20.602001 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:14:20.602065 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:14:20.602125 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:14:20.602183 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:14:20.602230 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:14:20.602277 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:14:20.602323 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:14:20.602369 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:14:20.602417 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:14:20.602488 140407842235840 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:14:20.608571 140407842235840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:14:20.621129 140407842235840 estimator.py:1145] Calling model_fn.
W0814 17:14:20.621742 140407842235840 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:14:20.902228 140407842235840 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:14:21.342475 140407842235840 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:14:21.405261 140407842235840 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:14:21.411982 140407842235840 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:14:21.596045 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:14:21.610172 140407842235840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:14:21.622477 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:14:21.623557 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:14:21.630666 140407842235840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:14:21.635894 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:14:21.636113 140407842235840 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:14:21.648729 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:14:21.760164 140407842235840 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:14:21.802424 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:21.847819 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:21.900794 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.073051 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.122967 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.170690 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.220571 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.266180 140407842235840 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:14:22.307877 140407842235840 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:14:22.325164 140407842235840 estimator.py:1147] Done calling model_fn.
I0814 17:14:25.598550 140407842235840 tpu_estimator.py:499] TPU job name worker
I0814 17:14:25.707123 140407842235840 monitored_session.py:240] Graph was finalized.
I0814 17:14:26.391334 140407842235840 session_manager.py:500] Running local_init_op.
I0814 17:14:26.441165 140407842235840 session_manager.py:502] Done running local_init_op.
I0814 17:14:29.218322 140407842235840 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:14:41.224329 140407842235840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:14:41.382015 140407842235840 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:14:41.382545 140407842235840 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:14:41.382948: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:14:41.388192 140407842235840 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:14:41.390467 140407842235840 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:14:41.394869 140407842235840 tpu_estimator.py:557] Init TPU system
I0814 17:15:24.120263 140407842235840 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:15:24.121314 140406945990400 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:15:24.122018 140406937597696 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:15:24.186737 140406929204992 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:15:24.187576 140407842235840 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:15:24.189277 140407842235840 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:15:24.344846 140406929204992 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:15:28.874751 140406937597696 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:15:33.488372 140407842235840 basic_session_run_hooks.py:262] loss = 0.10975443, step = 30
I0814 17:15:33.491353 140407842235840 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:15:46.813872 140407842235840 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:15:46.814202 140407842235840 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:15:46.815644 140406945990400 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:15:46.815839 140406945990400 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:15:46.816009 140407842235840 error_handling.py:96] infeed marked as finished
I0814 17:15:46.816178 140407842235840 tpu_estimator.py:602] Stop output thread controller
I0814 17:15:46.816268 140407842235840 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:15:46.816394 140406937597696 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:15:46.816517 140406937597696 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:15:46.816725 140407842235840 error_handling.py:96] outfeed marked as finished
I0814 17:15:46.816823 140407842235840 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:15:54.490744 140407842235840 estimator.py:368] Loss for final step: 0.10975443.
I0814 17:15:54.491540 140407842235840 error_handling.py:96] training_loop marked as finished
I0814 17:15:55.180500 140407842235840 estimator.py:1145] Calling model_fn.
E0814 17:15:55.879117 140407842235840 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:15:56.109141 140407842235840 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:15:56.152113 140407842235840 estimator.py:1147] Done calling model_fn.
I0814 17:15:56.169094 140407842235840 evaluation.py:255] Starting evaluation at 2019-08-14T17:15:56Z
I0814 17:15:56.169327 140407842235840 tpu_estimator.py:499] TPU job name worker
I0814 17:15:56.250543 140407842235840 monitored_session.py:240] Graph was finalized.
W0814 17:15:56.251352 140407842235840 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:15:56.441175 140407842235840 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:15:59.043204 140407842235840 session_manager.py:500] Running local_init_op.
I0814 17:15:59.072448 140407842235840 session_manager.py:502] Done running local_init_op.
I0814 17:15:59.124161 140407842235840 tpu_estimator.py:557] Init TPU system
I0814 17:17:08.112818 140407842235840 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:17:08.113816 140406942320384 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:17:08.114638 140406933927680 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:17:08.181438 140407842235840 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:17:08.207313 140407842235840 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:17:08.207741 140407842235840 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:17:08.242055 140406920550144 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:17:08.411058 140406920550144 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:17:08.960098 140406933927680 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:17:09.405545 140407842235840 evaluation.py:167] Evaluation [10/10]
I0814 17:17:09.405993 140407842235840 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:17:09.406073 140407842235840 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:17:09.406321 140406942320384 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:17:09.406595 140406942320384 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:17:09.406830 140407842235840 error_handling.py:96] infeed marked as finished
I0814 17:17:09.407043 140407842235840 tpu_estimator.py:602] Stop output thread controller
I0814 17:17:09.407129 140407842235840 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:17:09.407322 140406933927680 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:17:09.407565 140406933927680 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:17:09.407814 140407842235840 error_handling.py:96] outfeed marked as finished
I0814 17:17:09.407973 140407842235840 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:17:38.508783 140407842235840 evaluation.py:275] Finished evaluation at 2019-08-14-17:17:38
I0814 17:17:38.509157 140407842235840 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9725, global_step = 30, loss = 0.10025153
I0814 17:17:42.926175 140407842235840 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:17:43.780653 140407842235840 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10025153, 'global_step': 30, 'accuracy': 0.9725}

Removing gs://yangyou-mnist/log/#1565802863761507...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565802876423844...
Removing gs://yangyou-mnist/log/checkpoint#1565802943154624...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565802940012441...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565802880715634...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565802863.v3-8-tpu#1565802946497760...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565802875592601...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565802940923693...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565802868639882...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565802945514896...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565803060.v3-8-tpu#1565803063476382...
Removing gs://yangyou-mnist/log/eval/#1565803060159138...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:17:47.587202 139911418979776 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:17:47.587963 139911418979776 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:17:47.590615 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:17:47.591449 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:17:47.592012 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:17:47.592143 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:17:48.007909 139911418979776 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:17:48.016633 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:17:48.020818 139911418979776 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:17:48.139282 139911418979776 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:17:48.139564 139911418979776 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:17:48.310364 139911418979776 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:17:48.359534 139911418979776 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:17:48.359823 139911418979776 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:17:48.471416 139911418979776 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3f8496f190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3f86b4e210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:17:48.471764 139911418979776 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:17:48.790879 139911418979776 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:17:48.794044: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:17:48.806884 139911418979776 tpu_system_metadata.py:148] Found TPU system:
I0814 17:17:48.807152 139911418979776 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:17:48.807672 139911418979776 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:17:48.807743 139911418979776 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:17:48.807801 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:17:48.808120 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:17:48.808185 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:17:48.808258 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:17:48.808312 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:17:48.808368 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:17:48.808474 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:17:48.808538 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:17:48.808593 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:17:48.808646 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:17:48.808698 139911418979776 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:17:48.815267 139911418979776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:17:48.829163 139911418979776 estimator.py:1145] Calling model_fn.
W0814 17:17:48.829849 139911418979776 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:17:49.104752 139911418979776 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:17:49.519284 139911418979776 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:17:49.582398 139911418979776 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:17:49.588445 139911418979776 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:17:49.768627 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:17:49.782217 139911418979776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:17:49.794435 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:17:49.795512 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:17:49.802510 139911418979776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:17:49.807682 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:17:49.807894 139911418979776 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:17:49.820363 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:17:49.930461 139911418979776 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:17:49.972115 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.017396 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.068759 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.231494 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.282835 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.331923 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.383028 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.428487 139911418979776 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:17:50.469935 139911418979776 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:17:50.485830 139911418979776 estimator.py:1147] Done calling model_fn.
I0814 17:17:53.991230 139911418979776 tpu_estimator.py:499] TPU job name worker
I0814 17:17:54.103838 139911418979776 monitored_session.py:240] Graph was finalized.
I0814 17:17:54.779870 139911418979776 session_manager.py:500] Running local_init_op.
I0814 17:17:54.843678 139911418979776 session_manager.py:502] Done running local_init_op.
I0814 17:17:57.511703 139911418979776 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:18:09.620331 139911418979776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:18:09.764970 139911418979776 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:18:09.765399 139911418979776 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:18:09.765847: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:18:09.770905 139911418979776 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:18:09.773080 139911418979776 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:18:09.776981 139911418979776 tpu_estimator.py:557] Init TPU system
I0814 17:18:52.086215 139911418979776 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:18:52.087101 139910657058560 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:18:52.087595 139910648665856 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:18:52.147006 139910170277632 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:18:52.151338 139911418979776 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:18:52.152616 139911418979776 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:18:52.273020 139910170277632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:18:56.869394 139910648665856 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:19:01.520112 139911418979776 basic_session_run_hooks.py:262] loss = 0.091256216, step = 30
I0814 17:19:01.522463 139911418979776 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:19:15.072783 139911418979776 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:19:15.073061 139911418979776 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:19:15.073380 139910657058560 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:19:15.073745 139910657058560 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:19:15.073970 139911418979776 error_handling.py:96] infeed marked as finished
I0814 17:19:15.074227 139911418979776 tpu_estimator.py:602] Stop output thread controller
I0814 17:19:15.074289 139911418979776 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:19:15.074496 139910648665856 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:19:15.074702 139910648665856 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:19:15.074913 139911418979776 error_handling.py:96] outfeed marked as finished
I0814 17:19:15.075107 139911418979776 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:19:22.391129 139911418979776 estimator.py:368] Loss for final step: 0.091256216.
I0814 17:19:22.392044 139911418979776 error_handling.py:96] training_loop marked as finished
I0814 17:19:23.253281 139911418979776 estimator.py:1145] Calling model_fn.
E0814 17:19:23.946413 139911418979776 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:19:24.176263 139911418979776 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:19:24.198594 139911418979776 estimator.py:1147] Done calling model_fn.
I0814 17:19:24.215348 139911418979776 evaluation.py:255] Starting evaluation at 2019-08-14T17:19:24Z
I0814 17:19:24.215605 139911418979776 tpu_estimator.py:499] TPU job name worker
I0814 17:19:24.295516 139911418979776 monitored_session.py:240] Graph was finalized.
W0814 17:19:24.296338 139911418979776 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:19:24.476139 139911418979776 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:19:27.196732 139911418979776 session_manager.py:500] Running local_init_op.
I0814 17:19:27.221304 139911418979776 session_manager.py:502] Done running local_init_op.
I0814 17:19:27.276333 139911418979776 tpu_estimator.py:557] Init TPU system
I0814 17:20:36.050715 139911418979776 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:20:36.051727 139910653388544 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:20:36.052491 139910170277632 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:20:36.119791 139911418979776 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:20:36.148749 139911418979776 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:20:36.149090 139911418979776 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:20:36.184448 139910161622784 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:20:36.362215 139910161622784 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:20:36.915397 139910170277632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:20:37.393472 139911418979776 evaluation.py:167] Evaluation [10/10]
I0814 17:20:37.393874 139911418979776 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:20:37.393951 139911418979776 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:20:37.394141 139910653388544 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:20:37.394237 139910653388544 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:20:37.394375 139911418979776 error_handling.py:96] infeed marked as finished
I0814 17:20:37.394464 139911418979776 tpu_estimator.py:602] Stop output thread controller
I0814 17:20:37.394511 139911418979776 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:20:37.394623 139910170277632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:20:37.394701 139910170277632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:20:37.394818 139911418979776 error_handling.py:96] outfeed marked as finished
I0814 17:20:37.394896 139911418979776 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:21:06.456993 139911418979776 evaluation.py:275] Finished evaluation at 2019-08-14-17:21:06
I0814 17:21:06.457410 139911418979776 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9755, global_step = 30, loss = 0.08571314
I0814 17:21:10.990874 139911418979776 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:21:11.833761 139911418979776 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08571314, 'global_step': 30, 'accuracy': 0.9755}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565803084660092...
Removing gs://yangyou-mnist/log/#1565803072061382...
Removing gs://yangyou-mnist/log/checkpoint#1565803151586052...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565803072.v3-8-tpu#1565803154768548...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565803089113026...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565803148412573...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565803149251596...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565803076936141...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565803083792309...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565803153833282...
Removing gs://yangyou-mnist/log/eval/#1565803268117188...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565803268.v3-8-tpu#1565803271524887...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:21:15.686269 140366740895168 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:21:15.687056 140366740895168 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:21:15.689640 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:21:15.690463 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:21:15.691045 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:21:15.691167 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:21:16.103918 140366740895168 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:21:16.110661 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:21:16.114423 140366740895168 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:21:16.204989 140366740895168 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:21:16.205284 140366740895168 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:21:16.388535 140366740895168 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:21:16.441286 140366740895168 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:21:16.441580 140366740895168 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:21:16.552278 140366740895168 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fa987e40090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fa98a01f210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:21:16.552730 140366740895168 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:21:16.872243 140366740895168 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:21:16.875516: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:21:16.887928 140366740895168 tpu_system_metadata.py:148] Found TPU system:
I0814 17:21:16.888256 140366740895168 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:21:16.888925 140366740895168 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:21:16.888995 140366740895168 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:21:16.889054 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:21:16.889352 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:21:16.889406 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:21:16.889456 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:21:16.889655 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:21:16.889722 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:21:16.889769 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:21:16.889815 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:21:16.889861 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:21:16.889914 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:21:16.889961 140366740895168 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:21:16.896946 140366740895168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:21:16.911609 140366740895168 estimator.py:1145] Calling model_fn.
W0814 17:21:16.912307 140366740895168 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:21:17.188545 140366740895168 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:21:17.600459 140366740895168 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:21:17.662547 140366740895168 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:21:17.668718 140366740895168 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:21:17.851769 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:21:17.865573 140366740895168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:21:17.878103 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:21:17.879152 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:21:17.886132 140366740895168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:21:17.891355 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:21:17.891570 140366740895168 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:21:17.904295 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:21:18.015969 140366740895168 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:21:18.060043 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.105326 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.158780 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.332041 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.382709 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.431303 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.480982 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.526472 140366740895168 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:21:18.567195 140366740895168 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:21:18.583750 140366740895168 estimator.py:1147] Done calling model_fn.
I0814 17:21:21.983916 140366740895168 tpu_estimator.py:499] TPU job name worker
I0814 17:21:22.100236 140366740895168 monitored_session.py:240] Graph was finalized.
I0814 17:21:22.781570 140366740895168 session_manager.py:500] Running local_init_op.
I0814 17:21:22.844115 140366740895168 session_manager.py:502] Done running local_init_op.
I0814 17:21:25.592075 140366740895168 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:21:38.280868 140366740895168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:21:38.422422 140366740895168 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:21:38.422976 140366740895168 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:21:38.423404: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:21:38.428683 140366740895168 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:21:38.430846 140366740895168 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:21:38.434653 140366740895168 tpu_estimator.py:557] Init TPU system
I0814 17:22:20.092253 140366740895168 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:22:20.093377 140365705246464 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:22:20.094083 140365696853760 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:22:20.157777 140366740895168 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:22:20.158971 140366740895168 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:22:20.165999 140365688461056 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:22:20.273763 140365688461056 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:22:24.941093 140365696853760 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:22:29.401257 140366740895168 basic_session_run_hooks.py:262] loss = 0.09757991, step = 30
I0814 17:22:29.403953 140366740895168 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:22:42.586462 140366740895168 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:22:42.586802 140366740895168 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:22:42.587136 140365705246464 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:22:42.587452 140365705246464 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:22:42.587658 140366740895168 error_handling.py:96] infeed marked as finished
I0814 17:22:42.587830 140366740895168 tpu_estimator.py:602] Stop output thread controller
I0814 17:22:42.587904 140366740895168 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:22:42.588077 140365696853760 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:22:42.588244 140365696853760 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:22:42.588485 140366740895168 error_handling.py:96] outfeed marked as finished
I0814 17:22:42.588668 140366740895168 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:22:50.411436 140366740895168 estimator.py:368] Loss for final step: 0.09757991.
I0814 17:22:50.412564 140366740895168 error_handling.py:96] training_loop marked as finished
I0814 17:22:51.197225 140366740895168 estimator.py:1145] Calling model_fn.
E0814 17:22:51.928376 140366740895168 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:22:52.152635 140366740895168 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:22:52.173708 140366740895168 estimator.py:1147] Done calling model_fn.
I0814 17:22:52.191521 140366740895168 evaluation.py:255] Starting evaluation at 2019-08-14T17:22:52Z
I0814 17:22:52.191761 140366740895168 tpu_estimator.py:499] TPU job name worker
I0814 17:22:52.269105 140366740895168 monitored_session.py:240] Graph was finalized.
W0814 17:22:52.269901 140366740895168 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:22:52.454760 140366740895168 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:22:54.995395 140366740895168 session_manager.py:500] Running local_init_op.
I0814 17:22:55.025033 140366740895168 session_manager.py:502] Done running local_init_op.
I0814 17:22:55.079135 140366740895168 tpu_estimator.py:557] Init TPU system
I0814 17:24:04.037775 140366740895168 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:24:04.038681 140365705246464 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:24:04.039098 140365696853760 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:24:04.108310 140366740895168 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:24:04.136717 140366740895168 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:24:04.137053 140366740895168 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:24:04.233702 140365688461056 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:24:04.348570 140365688461056 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:24:04.931909 140365696853760 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:24:05.215960 140366740895168 evaluation.py:167] Evaluation [10/10]
I0814 17:24:05.216296 140366740895168 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:24:05.216379 140366740895168 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:24:05.216583 140365705246464 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:24:05.216674 140365705246464 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:24:05.216819 140366740895168 error_handling.py:96] infeed marked as finished
I0814 17:24:05.216907 140366740895168 tpu_estimator.py:602] Stop output thread controller
I0814 17:24:05.216957 140366740895168 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:24:05.217066 140365696853760 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:24:05.217138 140365696853760 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:24:05.217259 140366740895168 error_handling.py:96] outfeed marked as finished
I0814 17:24:05.217354 140366740895168 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:24:34.445499 140366740895168 evaluation.py:275] Finished evaluation at 2019-08-14-17:24:34
I0814 17:24:34.445897 140366740895168 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9733, global_step = 30, loss = 0.086111695
I0814 17:24:38.611504 140366740895168 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:24:39.412214 140366740895168 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.086111695, 'global_step': 30, 'accuracy': 0.9733}

Removing gs://yangyou-mnist/log/#1565803280136326...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565803293184443...
Removing gs://yangyou-mnist/log/checkpoint#1565803359135664...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565803280.v3-8-tpu#1565803362279737...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565803285014487...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565803292306996...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565803297762400...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565803356977026...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565803356150434...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565803361346696...
Removing gs://yangyou-mnist/log/eval/#1565803476071538...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565803476.v3-8-tpu#1565803479107542...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:24:43.287883 140124188980672 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:24:43.288727 140124188980672 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:24:43.291373 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:24:43.292224 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:24:43.293026 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:24:43.293173 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:24:43.707947 140124188980672 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:24:43.715718 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:24:43.719655 140124188980672 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:24:43.777534 140124188980672 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:24:43.777853 140124188980672 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:24:44.083183 140124188980672 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:24:44.138108 140124188980672 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:24:44.138439 140124188980672 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:24:44.251061 140124188980672 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f710eaa1250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f7110c971d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:24:44.251473 140124188980672 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:24:44.574264 140124188980672 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:24:44.578308: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:24:44.591403 140124188980672 tpu_system_metadata.py:148] Found TPU system:
I0814 17:24:44.591669 140124188980672 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:24:44.592361 140124188980672 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:24:44.592458 140124188980672 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:24:44.592519 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:24:44.592828 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:24:44.592886 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:24:44.592938 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:24:44.592987 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:24:44.593034 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:24:44.593081 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:24:44.593128 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:24:44.593174 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:24:44.593240 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:24:44.593302 140124188980672 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:24:44.599833 140124188980672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:24:44.613702 140124188980672 estimator.py:1145] Calling model_fn.
W0814 17:24:44.614418 140124188980672 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:24:44.901822 140124188980672 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:24:45.345107 140124188980672 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:24:45.412822 140124188980672 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:24:45.419327 140124188980672 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:24:45.600752 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:24:45.614423 140124188980672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:24:45.626499 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:24:45.627585 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:24:45.634658 140124188980672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:24:45.639950 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:24:45.640172 140124188980672 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:24:45.652650 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:24:45.763581 140124188980672 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:24:45.805367 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:45.849154 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:45.900100 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.067106 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.118139 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.165707 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.214927 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.259244 140124188980672 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:24:46.300767 140124188980672 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:24:46.317773 140124188980672 estimator.py:1147] Done calling model_fn.
I0814 17:24:49.818206 140124188980672 tpu_estimator.py:499] TPU job name worker
I0814 17:24:49.931848 140124188980672 monitored_session.py:240] Graph was finalized.
I0814 17:24:50.614583 140124188980672 session_manager.py:500] Running local_init_op.
I0814 17:24:50.662431 140124188980672 session_manager.py:502] Done running local_init_op.
I0814 17:24:53.452644 140124188980672 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:25:06.462443 140124188980672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:25:06.622266 140124188980672 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:25:06.622814 140124188980672 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:25:06.623221: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:25:06.628654 140124188980672 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:25:06.630887 140124188980672 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:25:06.635034 140124188980672 tpu_estimator.py:557] Init TPU system
I0814 17:25:48.102138 140124188980672 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:25:48.103224 140123282851584 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:25:48.104012 140123274458880 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:25:48.164693 140123266066176 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:25:48.168474 140124188980672 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:25:48.169795 140124188980672 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:25:48.316625 140123266066176 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:25:52.898765 140123274458880 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:25:57.262574 140124188980672 basic_session_run_hooks.py:262] loss = 0.112192675, step = 30
I0814 17:25:57.265330 140124188980672 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:26:10.353666 140124188980672 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:26:10.353951 140124188980672 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:26:10.354149 140123282851584 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:26:10.354255 140123282851584 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:26:10.354388 140124188980672 error_handling.py:96] infeed marked as finished
I0814 17:26:10.354487 140124188980672 tpu_estimator.py:602] Stop output thread controller
I0814 17:26:10.354540 140124188980672 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:26:10.354667 140123274458880 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:26:10.354741 140123274458880 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:26:10.354861 140124188980672 error_handling.py:96] outfeed marked as finished
I0814 17:26:10.354964 140124188980672 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:26:18.454653 140124188980672 estimator.py:368] Loss for final step: 0.112192675.
I0814 17:26:18.455544 140124188980672 error_handling.py:96] training_loop marked as finished
I0814 17:26:19.172034 140124188980672 estimator.py:1145] Calling model_fn.
E0814 17:26:19.918620 140124188980672 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:26:20.149413 140124188980672 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:26:20.171088 140124188980672 estimator.py:1147] Done calling model_fn.
I0814 17:26:20.188594 140124188980672 evaluation.py:255] Starting evaluation at 2019-08-14T17:26:20Z
I0814 17:26:20.188831 140124188980672 tpu_estimator.py:499] TPU job name worker
I0814 17:26:20.271215 140124188980672 monitored_session.py:240] Graph was finalized.
W0814 17:26:20.271989 140124188980672 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:26:20.443401 140124188980672 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:26:23.174102 140124188980672 session_manager.py:500] Running local_init_op.
I0814 17:26:23.204190 140124188980672 session_manager.py:502] Done running local_init_op.
I0814 17:26:23.256814 140124188980672 tpu_estimator.py:557] Init TPU system
I0814 17:27:32.036911 140124188980672 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:27:32.037992 140123282851584 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:27:32.038707 140123274458880 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:27:32.107906 140124188980672 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:27:32.131774 140124188980672 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:27:32.132111 140124188980672 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:27:32.172214 140123266066176 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:27:32.348787 140123266066176 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:27:32.880029 140123274458880 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:27:33.393889 140124188980672 evaluation.py:167] Evaluation [10/10]
I0814 17:27:33.394239 140124188980672 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:27:33.394326 140124188980672 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:27:33.394638 140123282851584 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:27:33.394920 140123282851584 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:27:33.395178 140124188980672 error_handling.py:96] infeed marked as finished
I0814 17:27:33.395380 140124188980672 tpu_estimator.py:602] Stop output thread controller
I0814 17:27:33.395437 140124188980672 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:27:33.395632 140123274458880 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:27:33.395829 140123274458880 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:27:33.395998 140124188980672 error_handling.py:96] outfeed marked as finished
I0814 17:27:33.396117 140124188980672 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:28:02.439544 140124188980672 evaluation.py:275] Finished evaluation at 2019-08-14-17:28:02
I0814 17:28:02.439909 140124188980672 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9684, global_step = 30, loss = 0.10927965
I0814 17:28:07.266041 140124188980672 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:28:08.115511 140124188980672 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.10927965, 'global_step': 30, 'accuracy': 0.9684}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565803501121907...
Removing gs://yangyou-mnist/log/#1565803487824831...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565803505939073...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565803492871580...
Removing gs://yangyou-mnist/log/checkpoint#1565803567087142...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565803488.v3-8-tpu#1565803570067018...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565803564246492...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565803565201625...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565803500229005...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565803569209409...
Removing gs://yangyou-mnist/log/eval/#1565803684051455...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565803684.v3-8-tpu#1565803687783286...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:28:12.000243 139837891179968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:28:12.001075 139837891179968 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:28:12.003699 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:28:12.004683 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:28:12.005301 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:28:12.005450 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:28:12.424093 139837891179968 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:28:12.431343 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:28:12.435425 139837891179968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:28:12.488934 139837891179968 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:28:12.489209 139837891179968 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:28:12.810646 139837891179968 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:28:12.863229 139837891179968 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:28:12.863497 139837891179968 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:28:12.987401 139837891179968 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2e65fdc250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2e681bb1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:28:12.987752 139837891179968 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:28:13.323230 139837891179968 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:28:13.326121: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:28:13.340434 139837891179968 tpu_system_metadata.py:148] Found TPU system:
I0814 17:28:13.340687 139837891179968 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:28:13.341181 139837891179968 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:28:13.341243 139837891179968 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:28:13.341310 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:28:13.341649 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:28:13.341715 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:28:13.341768 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:28:13.341820 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:28:13.341875 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:28:13.341928 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:28:13.341983 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:28:13.342036 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:28:13.342086 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:28:13.342154 139837891179968 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:28:13.348165 139837891179968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:28:13.361063 139837891179968 estimator.py:1145] Calling model_fn.
W0814 17:28:13.361692 139837891179968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:28:13.633209 139837891179968 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:28:14.143802 139837891179968 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:28:14.206367 139837891179968 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:28:14.212515 139837891179968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:28:14.398480 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:28:14.412390 139837891179968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:28:14.425263 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:28:14.426472 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:28:14.433938 139837891179968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:28:14.439374 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:28:14.439593 139837891179968 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:28:14.452312 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:28:14.563901 139837891179968 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:28:14.606654 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:14.652847 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:14.705395 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:14.870141 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:14.921066 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:14.969708 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:15.020042 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:15.066854 139837891179968 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:28:15.108639 139837891179968 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:28:15.124660 139837891179968 estimator.py:1147] Done calling model_fn.
I0814 17:28:18.622997 139837891179968 tpu_estimator.py:499] TPU job name worker
I0814 17:28:18.737811 139837891179968 monitored_session.py:240] Graph was finalized.
I0814 17:28:19.410353 139837891179968 session_manager.py:500] Running local_init_op.
I0814 17:28:19.470479 139837891179968 session_manager.py:502] Done running local_init_op.
I0814 17:28:22.137332 139837891179968 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:28:34.245296 139837891179968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:28:34.387614 139837891179968 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:28:34.388092 139837891179968 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:28:34.388602: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:28:34.393625 139837891179968 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:28:34.395803 139837891179968 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:28:34.399629 139837891179968 tpu_estimator.py:557] Init TPU system
I0814 17:29:16.101196 139837891179968 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:29:16.102174 139836986476288 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:29:16.102849 139836978083584 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:29:16.154066 139836969690880 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:29:16.164942 139837891179968 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:29:16.165955 139837891179968 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:29:16.309259 139836969690880 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:29:20.900809 139836978083584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:29:25.620521 139837891179968 basic_session_run_hooks.py:262] loss = 2.3542833, step = 30
I0814 17:29:25.622683 139837891179968 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:29:39.775696 139837891179968 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:29:39.775970 139837891179968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:29:39.776171 139836986476288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:29:39.776276 139836986476288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:29:39.776438 139837891179968 error_handling.py:96] infeed marked as finished
I0814 17:29:39.776551 139837891179968 tpu_estimator.py:602] Stop output thread controller
I0814 17:29:39.776602 139837891179968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:29:39.776717 139836978083584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:29:39.776793 139836978083584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:29:39.776909 139837891179968 error_handling.py:96] outfeed marked as finished
I0814 17:29:39.776990 139837891179968 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:29:46.429600 139837891179968 estimator.py:368] Loss for final step: 2.3542833.
I0814 17:29:46.430394 139837891179968 error_handling.py:96] training_loop marked as finished
I0814 17:29:47.438707 139837891179968 estimator.py:1145] Calling model_fn.
E0814 17:29:48.362667 139837891179968 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:29:48.593086 139837891179968 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:29:48.614583 139837891179968 estimator.py:1147] Done calling model_fn.
I0814 17:29:48.631386 139837891179968 evaluation.py:255] Starting evaluation at 2019-08-14T17:29:48Z
I0814 17:29:48.631613 139837891179968 tpu_estimator.py:499] TPU job name worker
I0814 17:29:48.711632 139837891179968 monitored_session.py:240] Graph was finalized.
W0814 17:29:48.712425 139837891179968 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:29:48.899358 139837891179968 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:29:51.628572 139837891179968 session_manager.py:500] Running local_init_op.
I0814 17:29:51.652705 139837891179968 session_manager.py:502] Done running local_init_op.
I0814 17:29:51.700587 139837891179968 tpu_estimator.py:557] Init TPU system
I0814 17:31:00.059973 139837891179968 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:31:00.061120 139836986476288 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:31:00.061950 139836978083584 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:31:00.127468 139837891179968 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:31:00.155272 139837891179968 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:31:00.155637 139837891179968 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:31:00.178862 139836969690880 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:31:00.373028 139836969690880 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:31:00.950532 139836978083584 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:31:01.246465 139837891179968 evaluation.py:167] Evaluation [10/10]
I0814 17:31:01.246845 139837891179968 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:31:01.246942 139837891179968 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:31:01.247263 139836986476288 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:31:01.247575 139836986476288 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:31:01.247805 139837891179968 error_handling.py:96] infeed marked as finished
I0814 17:31:01.248008 139837891179968 tpu_estimator.py:602] Stop output thread controller
I0814 17:31:01.248091 139837891179968 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:31:01.248286 139836978083584 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:31:01.248534 139836978083584 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:31:01.248699 139837891179968 error_handling.py:96] outfeed marked as finished
I0814 17:31:01.248867 139837891179968 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:31:30.470509 139837891179968 evaluation.py:275] Finished evaluation at 2019-08-14-17:31:30
I0814 17:31:30.470866 139837891179968 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 2.3169105
I0814 17:31:37.172061 139837891179968 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:31:37.950676 139837891179968 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.3169105, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/checkpoint#1565803776339723...
Removing gs://yangyou-mnist/log/#1565803696643453...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565803696.v3-8-tpu#1565803779467779...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565803701554290...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565803708540431...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565803709401359...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565803773188316...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565803713736736...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565803774175624...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565803778569525...
Removing gs://yangyou-mnist/log/eval/#1565803892169593...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565803892.v3-8-tpu#1565803897638742...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:31:41.891532 140041883088320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:31:41.892317 140041883088320 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:31:41.894957 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:31:41.895767 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:31:41.896342 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:31:41.896533 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:31:42.317686 140041883088320 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:31:42.325027 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:31:42.328960 140041883088320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:31:42.378104 140041883088320 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:31:42.378413 140041883088320 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:31:42.495249 140041883088320 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:31:42.603075 140041883088320 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:31:42.603359 140041883088320 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:31:42.900064 140041883088320 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5de4db4150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5de6f931d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:31:42.900546 140041883088320 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:31:43.227422 140041883088320 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:31:43.230529: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:31:43.243803 140041883088320 tpu_system_metadata.py:148] Found TPU system:
I0814 17:31:43.244046 140041883088320 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:31:43.244759 140041883088320 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:31:43.244834 140041883088320 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:31:43.244890 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:31:43.245244 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:31:43.245300 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:31:43.245351 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:31:43.245407 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:31:43.245455 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:31:43.245501 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:31:43.245548 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:31:43.245605 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:31:43.245654 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:31:43.245701 140041883088320 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:31:43.251919 140041883088320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:31:43.264955 140041883088320 estimator.py:1145] Calling model_fn.
W0814 17:31:43.265592 140041883088320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:31:43.531404 140041883088320 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:31:43.950836 140041883088320 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:31:44.014863 140041883088320 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:31:44.020816 140041883088320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:31:44.205799 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:31:44.220101 140041883088320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:31:44.232538 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:31:44.233639 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:31:44.241003 140041883088320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:31:44.246539 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:31:44.246776 140041883088320 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:31:44.267385 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:31:44.378849 140041883088320 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:31:44.422199 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.467134 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.518852 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.685764 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.738936 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.788688 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.838946 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.885138 140041883088320 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:31:44.927210 140041883088320 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:31:44.943434 140041883088320 estimator.py:1147] Done calling model_fn.
I0814 17:31:48.234118 140041883088320 tpu_estimator.py:499] TPU job name worker
I0814 17:31:48.348567 140041883088320 monitored_session.py:240] Graph was finalized.
I0814 17:31:49.048276 140041883088320 session_manager.py:500] Running local_init_op.
I0814 17:31:49.097182 140041883088320 session_manager.py:502] Done running local_init_op.
I0814 17:31:51.893796 140041883088320 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:32:04.199779 140041883088320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:32:04.347640 140041883088320 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:32:04.348050 140041883088320 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:32:04.348477: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:32:04.353686 140041883088320 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:32:04.355753 140041883088320 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:32:04.359864 140041883088320 tpu_estimator.py:557] Init TPU system
I0814 17:32:44.123450 140041883088320 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 17:32:44.124284 140041121146624 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:32:44.125085 140041112753920 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:32:44.187477 140040629909248 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:32:44.188205 140041883088320 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:32:44.189522 140041883088320 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:32:44.311422 140040629909248 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:32:48.879442 140041112753920 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:32:53.748475 140041883088320 basic_session_run_hooks.py:262] loss = 18.998346, step = 30
I0814 17:32:53.751205 140041883088320 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:33:08.294626 140041883088320 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:33:08.294948 140041883088320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:33:08.295166 140041121146624 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:33:08.295281 140041121146624 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:33:08.295425 140041883088320 error_handling.py:96] infeed marked as finished
I0814 17:33:08.295521 140041883088320 tpu_estimator.py:602] Stop output thread controller
I0814 17:33:08.295568 140041883088320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:33:08.295679 140041112753920 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:33:08.295748 140041112753920 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:33:08.295861 140041883088320 error_handling.py:96] outfeed marked as finished
I0814 17:33:08.295941 140041883088320 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:33:14.451994 140041883088320 estimator.py:368] Loss for final step: 18.998346.
I0814 17:33:14.452866 140041883088320 error_handling.py:96] training_loop marked as finished
I0814 17:33:15.136044 140041883088320 estimator.py:1145] Calling model_fn.
E0814 17:33:15.820146 140041883088320 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:33:16.046036 140041883088320 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:33:16.067612 140041883088320 estimator.py:1147] Done calling model_fn.
I0814 17:33:16.086215 140041883088320 evaluation.py:255] Starting evaluation at 2019-08-14T17:33:16Z
I0814 17:33:16.086458 140041883088320 tpu_estimator.py:499] TPU job name worker
I0814 17:33:16.170747 140041883088320 monitored_session.py:240] Graph was finalized.
W0814 17:33:16.171525 140041883088320 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:33:16.358639 140041883088320 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:33:19.200000 140041883088320 session_manager.py:500] Running local_init_op.
I0814 17:33:19.224653 140041883088320 session_manager.py:502] Done running local_init_op.
I0814 17:33:19.278007 140041883088320 tpu_estimator.py:557] Init TPU system
I0814 17:34:28.038456 140041883088320 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:34:28.039442 140041117476608 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:34:28.039913 140040629909248 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:34:28.106909 140041883088320 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:34:28.131489 140041883088320 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:34:28.131910 140041883088320 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:34:28.158693 140040621516544 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:34:28.331486 140040621516544 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:34:28.942460 140040629909248 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:34:29.241261 140041883088320 evaluation.py:167] Evaluation [10/10]
I0814 17:34:29.241600 140041883088320 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:34:29.241678 140041883088320 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:34:29.241983 140041117476608 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:34:29.242115 140041117476608 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:34:29.242257 140041883088320 error_handling.py:96] infeed marked as finished
I0814 17:34:29.242356 140041883088320 tpu_estimator.py:602] Stop output thread controller
I0814 17:34:29.242413 140041883088320 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:34:29.242527 140040629909248 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:34:29.242598 140040629909248 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:34:29.242711 140041883088320 error_handling.py:96] outfeed marked as finished
I0814 17:34:29.242803 140041883088320 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:34:58.429954 140041883088320 evaluation.py:275] Finished evaluation at 2019-08-14-17:34:58
I0814 17:34:58.430309 140041883088320 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0974, global_step = 30, loss = 16.230158
I0814 17:35:02.799137 140041883088320 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:35:03.556171 140041883088320 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 16.230158, 'global_step': 30, 'accuracy': 0.0974}

Removing gs://yangyou-mnist/log/#1565803906413195...
Removing gs://yangyou-mnist/log/checkpoint#1565803984045556...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565803906.v3-8-tpu#1565803987991997...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565803911314563...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565803918402028...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565803919412776...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565803923692859...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565803980876719...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565803981809155...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565803986307637...
Removing gs://yangyou-mnist/log/eval/#1565804100100804...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565804100.v3-8-tpu#1565804103250604...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:35:07.382810 140042374657472 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:35:07.383601 140042374657472 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:35:07.386313 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:35:07.387183 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:35:07.387795 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:35:07.387933 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:35:07.799711 140042374657472 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:35:07.806894 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:35:07.811022 140042374657472 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:35:07.921689 140042374657472 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:35:07.921987 140042374657472 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:35:08.030267 140042374657472 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:35:08.070624 140042374657472 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:35:08.070908 140042374657472 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:35:08.210504 140042374657472 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5e02280150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5e0445f1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:35:08.210870 140042374657472 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:35:08.546307 140042374657472 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:35:08.549202: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:35:08.562336 140042374657472 tpu_system_metadata.py:148] Found TPU system:
I0814 17:35:08.562611 140042374657472 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:35:08.564560 140042374657472 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:35:08.564701 140042374657472 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:35:08.564773 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:35:08.565258 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:35:08.565354 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:35:08.565408 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:35:08.565459 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:35:08.565506 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:35:08.565553 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:35:08.565610 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:35:08.565665 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:35:08.565718 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:35:08.565862 140042374657472 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:35:08.571950 140042374657472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:35:08.584718 140042374657472 estimator.py:1145] Calling model_fn.
W0814 17:35:08.585320 140042374657472 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:35:08.854366 140042374657472 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:35:09.270458 140042374657472 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:35:09.332889 140042374657472 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:35:09.339616 140042374657472 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:35:09.524328 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:35:09.538583 140042374657472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:35:09.550812 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:35:09.551867 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:35:09.559053 140042374657472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:35:09.564366 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:35:09.564630 140042374657472 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:35:09.577254 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:35:09.687572 140042374657472 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:35:09.729355 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:09.773395 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:09.823683 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:09.990750 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:10.041848 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:10.090754 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:10.141963 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:10.188664 140042374657472 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:35:10.230971 140042374657472 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:35:10.247811 140042374657472 estimator.py:1147] Done calling model_fn.
I0814 17:35:13.742944 140042374657472 tpu_estimator.py:499] TPU job name worker
I0814 17:35:13.858665 140042374657472 monitored_session.py:240] Graph was finalized.
I0814 17:35:14.522151 140042374657472 session_manager.py:500] Running local_init_op.
I0814 17:35:14.570074 140042374657472 session_manager.py:502] Done running local_init_op.
I0814 17:35:17.378190 140042374657472 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:35:32.135451 140042374657472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:35:32.274919 140042374657472 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:35:32.275352 140042374657472 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:35:32.275743: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:35:32.280765 140042374657472 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:35:32.283054 140042374657472 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:35:32.286623 140042374657472 tpu_estimator.py:557] Init TPU system
I0814 17:36:12.107536 140042374657472 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 17:36:12.108709 140041478461184 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:36:12.109549 140041470068480 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:36:12.166553 140041461675776 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:36:12.172889 140042374657472 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:36:12.173716 140042374657472 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:36:12.278002 140041461675776 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:36:17.162273 140041470068480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:36:22.000138 140042374657472 basic_session_run_hooks.py:262] loss = 438662.12, step = 30
I0814 17:36:22.003149 140042374657472 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:36:35.396635 140042374657472 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:36:35.396939 140042374657472 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:36:35.397229 140041478461184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:36:35.397532 140041478461184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:36:35.397876 140042374657472 error_handling.py:96] infeed marked as finished
I0814 17:36:35.398106 140042374657472 tpu_estimator.py:602] Stop output thread controller
I0814 17:36:35.398175 140042374657472 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:36:35.398349 140041470068480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:36:35.398519 140041470068480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:36:35.398669 140042374657472 error_handling.py:96] outfeed marked as finished
I0814 17:36:35.398803 140042374657472 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:36:42.419684 140042374657472 estimator.py:368] Loss for final step: 438662.12.
I0814 17:36:42.420577 140042374657472 error_handling.py:96] training_loop marked as finished
I0814 17:36:43.201194 140042374657472 estimator.py:1145] Calling model_fn.
E0814 17:36:43.941668 140042374657472 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:36:44.162260 140042374657472 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:36:44.183747 140042374657472 estimator.py:1147] Done calling model_fn.
I0814 17:36:44.200850 140042374657472 evaluation.py:255] Starting evaluation at 2019-08-14T17:36:44Z
I0814 17:36:44.201077 140042374657472 tpu_estimator.py:499] TPU job name worker
I0814 17:36:44.278979 140042374657472 monitored_session.py:240] Graph was finalized.
W0814 17:36:44.279714 140042374657472 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:36:44.441605 140042374657472 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:36:47.164918 140042374657472 session_manager.py:500] Running local_init_op.
I0814 17:36:47.190996 140042374657472 session_manager.py:502] Done running local_init_op.
I0814 17:36:47.244111 140042374657472 tpu_estimator.py:557] Init TPU system
I0814 17:37:56.062367 140042374657472 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:37:56.063277 140041474791168 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:37:56.063796 140041466398464 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:37:56.131396 140042374657472 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:37:56.161092 140042374657472 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:37:56.161436 140042374657472 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:37:56.246680 140041453020928 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:37:56.382666 140041453020928 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:37:56.930010 140041466398464 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:37:57.464221 140042374657472 evaluation.py:167] Evaluation [10/10]
I0814 17:37:57.464607 140042374657472 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:37:57.464684 140042374657472 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:37:57.464900 140041474791168 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:37:57.464996 140041474791168 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:37:57.465154 140042374657472 error_handling.py:96] infeed marked as finished
I0814 17:37:57.465245 140042374657472 tpu_estimator.py:602] Stop output thread controller
I0814 17:37:57.465321 140042374657472 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:37:57.465440 140041466398464 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:37:57.465517 140041466398464 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:37:57.465691 140042374657472 error_handling.py:96] outfeed marked as finished
I0814 17:37:57.465787 140042374657472 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:38:26.477191 140042374657472 evaluation.py:275] Finished evaluation at 2019-08-14-17:38:26
I0814 17:38:26.477540 140042374657472 estimator.py:2039] Saving dict for global step 30: accuracy = 0.1028, global_step = 30, loss = 309284.56
I0814 17:38:30.911732 140042374657472 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:38:31.767348 140042374657472 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 309284.56, 'global_step': 30, 'accuracy': 0.1028}

Removing gs://yangyou-mnist/log/checkpoint#1565804191971865...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565804112.v3-8-tpu#1565804195094604...
Removing gs://yangyou-mnist/log/#1565804111859680...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565804124787325...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565804130887876...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565804116797466...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565804189018013...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565804123908485...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565804189844535...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565804194181266...
Removing gs://yangyou-mnist/log/eval/#1565804308192282...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565804308.v3-8-tpu#1565804311458162...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:38:35.571763 140575797831104 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:38:35.572841 140575797831104 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:38:35.575404 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:38:35.576242 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:38:35.576884 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:38:35.577018 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:38:35.989207 140575797831104 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:38:35.996022 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:38:36.000057 140575797831104 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:38:36.508347 140575797831104 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:38:36.508686 140575797831104 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:38:36.817897 140575797831104 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:38:36.868443 140575797831104 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:38:36.868761 140575797831104 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:38:37.085180 140575797831104 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fda34a7b150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fda36c5a1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:38:37.085537 140575797831104 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:38:37.440650 140575797831104 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:38:37.443620: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:38:37.457835 140575797831104 tpu_system_metadata.py:148] Found TPU system:
I0814 17:38:37.458072 140575797831104 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:38:37.458547 140575797831104 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:38:37.458707 140575797831104 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:38:37.458772 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:38:37.459095 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:38:37.459155 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:38:37.459204 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:38:37.459253 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:38:37.459299 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:38:37.459343 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:38:37.459388 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:38:37.459434 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:38:37.459480 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:38:37.459526 140575797831104 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:38:37.465651 140575797831104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:38:37.478424 140575797831104 estimator.py:1145] Calling model_fn.
W0814 17:38:37.479057 140575797831104 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:38:37.753762 140575797831104 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:38:38.159540 140575797831104 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:38:38.224433 140575797831104 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:38:38.230644 140575797831104 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:38:38.419029 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:38:38.433188 140575797831104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:38:38.445301 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:38:38.446362 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:38:38.453440 140575797831104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:38:38.458688 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:38:38.458889 140575797831104 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:38:38.471319 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:38:38.581207 140575797831104 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:38:38.622505 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:38.666842 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:38.718838 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:38.889569 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:38.940316 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:38.989892 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:39.040884 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:39.087657 140575797831104 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:38:39.135282 140575797831104 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:38:39.151521 140575797831104 estimator.py:1147] Done calling model_fn.
I0814 17:38:42.611171 140575797831104 tpu_estimator.py:499] TPU job name worker
I0814 17:38:42.719130 140575797831104 monitored_session.py:240] Graph was finalized.
I0814 17:38:43.388798 140575797831104 session_manager.py:500] Running local_init_op.
I0814 17:38:43.435919 140575797831104 session_manager.py:502] Done running local_init_op.
I0814 17:38:46.189246 140575797831104 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:38:58.451277 140575797831104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:38:58.594968 140575797831104 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:38:58.595424 140575797831104 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:38:58.595855: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:38:58.601260 140575797831104 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:38:58.603324 140575797831104 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:38:58.607321 140575797831104 tpu_estimator.py:557] Init TPU system
I0814 17:39:40.102077 140575797831104 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:39:40.102993 140575035860736 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:39:40.103471 140575027468032 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:39:40.166793 140575797831104 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:39:40.168556 140575797831104 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:39:40.174278 140574548031232 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:39:40.405221 140574548031232 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:39:44.917798 140575027468032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:39:49.451988 140575797831104 basic_session_run_hooks.py:262] loss = 2856.1465, step = 30
I0814 17:39:49.454143 140575797831104 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:40:02.502904 140575797831104 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:40:02.503223 140575797831104 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:40:02.503458 140575035860736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:40:02.503566 140575035860736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:40:02.503715 140575797831104 error_handling.py:96] infeed marked as finished
I0814 17:40:02.503818 140575797831104 tpu_estimator.py:602] Stop output thread controller
I0814 17:40:02.503866 140575797831104 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:40:02.503983 140575027468032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:40:02.504054 140575027468032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:40:02.504169 140575797831104 error_handling.py:96] outfeed marked as finished
I0814 17:40:02.504264 140575797831104 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:40:10.543489 140575797831104 estimator.py:368] Loss for final step: 2856.1465.
I0814 17:40:10.544261 140575797831104 error_handling.py:96] training_loop marked as finished
I0814 17:40:11.335225 140575797831104 estimator.py:1145] Calling model_fn.
E0814 17:40:12.027327 140575797831104 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:40:12.259115 140575797831104 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:40:12.282341 140575797831104 estimator.py:1147] Done calling model_fn.
I0814 17:40:12.300519 140575797831104 evaluation.py:255] Starting evaluation at 2019-08-14T17:40:12Z
I0814 17:40:12.300779 140575797831104 tpu_estimator.py:499] TPU job name worker
I0814 17:40:12.385576 140575797831104 monitored_session.py:240] Graph was finalized.
W0814 17:40:12.386352 140575797831104 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:40:12.573699 140575797831104 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:40:15.258687 140575797831104 session_manager.py:500] Running local_init_op.
I0814 17:40:15.283283 140575797831104 session_manager.py:502] Done running local_init_op.
I0814 17:40:15.334286 140575797831104 tpu_estimator.py:557] Init TPU system
I0814 17:41:24.070118 140575797831104 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:41:24.071172 140575032190720 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:41:24.071856 140574548031232 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:41:24.140057 140575797831104 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:41:24.169665 140575797831104 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:41:24.170061 140575797831104 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:41:24.200217 140574539638528 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:41:24.436645 140574539638528 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:41:25.001924 140574548031232 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:41:25.378427 140575797831104 evaluation.py:167] Evaluation [10/10]
I0814 17:41:25.378832 140575797831104 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:41:25.378914 140575797831104 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:41:25.379184 140575032190720 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:41:25.379477 140575032190720 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:41:25.379704 140575797831104 error_handling.py:96] infeed marked as finished
I0814 17:41:25.380023 140575797831104 tpu_estimator.py:602] Stop output thread controller
I0814 17:41:25.380091 140575797831104 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:41:25.380249 140574548031232 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:41:25.380388 140574548031232 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:41:25.380701 140575797831104 error_handling.py:96] outfeed marked as finished
I0814 17:41:25.381010 140575797831104 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:41:54.520745 140575797831104 evaluation.py:275] Finished evaluation at 2019-08-14-17:41:54
I0814 17:41:54.521138 140575797831104 estimator.py:2039] Saving dict for global step 30: accuracy = 0.098, global_step = 30, loss = 2982.6396
I0814 17:41:58.612622 140575797831104 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:41:59.372227 140575797831104 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2982.6396, 'global_step': 30, 'accuracy': 0.098}

Removing gs://yangyou-mnist/log/#1565804320722778...
Removing gs://yangyou-mnist/log/checkpoint#1565804399127598...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565804320.v3-8-tpu#1565804402163082...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565804333421353...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565804397062435...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565804396230431...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565804337938612...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565804325599438...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565804332488203...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565804401249912...
Removing gs://yangyou-mnist/log/eval/#1565804516141783...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565804516.v3-8-tpu#1565804519065542...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:42:03.226680 139894822974912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:42:03.227452 139894822974912 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:42:03.230191 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:42:03.231062 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:42:03.231643 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:42:03.231796 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:42:03.645872 139894822974912 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:42:03.653012 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:42:03.657151 139894822974912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:42:03.711834 139894822974912 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:42:03.712106 139894822974912 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:42:03.828300 139894822974912 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:42:03.942184 139894822974912 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:42:03.942467 139894822974912 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:42:04.059900 139894822974912 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3ba7640250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3ba981f1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:42:04.060271 139894822974912 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:42:04.386739 139894822974912 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:42:04.389625: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:42:04.401642 139894822974912 tpu_system_metadata.py:148] Found TPU system:
I0814 17:42:04.401879 139894822974912 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:42:04.402368 139894822974912 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:42:04.402426 139894822974912 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:42:04.402481 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:42:04.402782 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:42:04.402841 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:42:04.402892 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:42:04.402940 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:42:04.402988 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:42:04.403039 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:42:04.403088 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:42:04.403135 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:42:04.403182 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:42:04.403306 139894822974912 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:42:04.409326 139894822974912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:42:04.422133 139894822974912 estimator.py:1145] Calling model_fn.
W0814 17:42:04.422744 139894822974912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:42:04.699726 139894822974912 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:42:05.219965 139894822974912 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:42:05.288543 139894822974912 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:42:05.295068 139894822974912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:42:05.474369 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:42:05.488215 139894822974912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:42:05.500722 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:42:05.501939 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:42:05.509177 139894822974912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:42:05.514524 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:42:05.514753 139894822974912 optimization.py:36] ++++++ warmup starts at step 0, for 2 steps ++++++
W0814 17:42:05.527519 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:42:05.638425 139894822974912 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:42:05.679651 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:05.724591 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:05.775340 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:05.936393 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:05.986706 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:06.035902 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:06.086462 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:06.132339 139894822974912 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:42:06.173558 139894822974912 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:42:06.190171 139894822974912 estimator.py:1147] Done calling model_fn.
I0814 17:42:09.606687 139894822974912 tpu_estimator.py:499] TPU job name worker
I0814 17:42:09.720432 139894822974912 monitored_session.py:240] Graph was finalized.
I0814 17:42:10.452481 139894822974912 session_manager.py:500] Running local_init_op.
I0814 17:42:10.501282 139894822974912 session_manager.py:502] Done running local_init_op.
I0814 17:42:13.354233 139894822974912 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:42:25.807972 139894822974912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:42:25.974025 139894822974912 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:42:25.974535 139894822974912 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:42:25.974930: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:42:25.980006 139894822974912 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:42:25.982182 139894822974912 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:42:25.985817 139894822974912 tpu_estimator.py:557] Init TPU system
I0814 17:43:08.117136 139894822974912 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:43:08.118087 139893787322112 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:43:08.118612 139893778929408 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:43:08.181006 139893770536704 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:43:08.187119 139894822974912 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:43:08.188961 139894822974912 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:43:08.290844 139893770536704 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:43:12.919740 139893778929408 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:43:17.437957 139894822974912 basic_session_run_hooks.py:262] loss = 274920.97, step = 30
I0814 17:43:17.440859 139894822974912 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:43:31.098445 139894822974912 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:43:31.098748 139894822974912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:43:31.098993 139893787322112 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:43:31.099122 139893787322112 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:43:31.099281 139894822974912 error_handling.py:96] infeed marked as finished
I0814 17:43:31.099385 139894822974912 tpu_estimator.py:602] Stop output thread controller
I0814 17:43:31.099438 139894822974912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:43:31.099562 139893778929408 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:43:31.099638 139893778929408 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:43:31.099757 139894822974912 error_handling.py:96] outfeed marked as finished
I0814 17:43:31.099862 139894822974912 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:43:38.423779 139894822974912 estimator.py:368] Loss for final step: 274920.97.
I0814 17:43:38.424679 139894822974912 error_handling.py:96] training_loop marked as finished
I0814 17:43:39.219192 139894822974912 estimator.py:1145] Calling model_fn.
E0814 17:43:39.933130 139894822974912 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:43:40.169569 139894822974912 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:43:40.192032 139894822974912 estimator.py:1147] Done calling model_fn.
I0814 17:43:40.209883 139894822974912 evaluation.py:255] Starting evaluation at 2019-08-14T17:43:40Z
I0814 17:43:40.210140 139894822974912 tpu_estimator.py:499] TPU job name worker
I0814 17:43:40.291867 139894822974912 monitored_session.py:240] Graph was finalized.
W0814 17:43:40.292701 139894822974912 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:43:40.490685 139894822974912 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:43:43.293124 139894822974912 session_manager.py:500] Running local_init_op.
I0814 17:43:43.323575 139894822974912 session_manager.py:502] Done running local_init_op.
I0814 17:43:43.378623 139894822974912 tpu_estimator.py:557] Init TPU system
I0814 17:44:52.100712 139894822974912 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:44:52.101881 139893787322112 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:44:52.102696 139893778929408 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:44:52.168483 139894822974912 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:44:52.196681 139894822974912 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:44:52.197077 139894822974912 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:44:52.234298 139893770536704 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:44:52.316509 139893770536704 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:44:52.973578 139893778929408 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:44:53.269551 139894822974912 evaluation.py:167] Evaluation [10/10]
I0814 17:44:53.269896 139894822974912 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:44:53.269965 139894822974912 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:44:53.270214 139893787322112 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:44:53.270559 139893787322112 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:44:53.270771 139894822974912 error_handling.py:96] infeed marked as finished
I0814 17:44:53.271078 139894822974912 tpu_estimator.py:602] Stop output thread controller
I0814 17:44:53.271132 139894822974912 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:44:53.271289 139893778929408 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:44:53.271512 139893778929408 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:44:53.271693 139894822974912 error_handling.py:96] outfeed marked as finished
I0814 17:44:53.271909 139894822974912 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:45:22.394087 139894822974912 evaluation.py:275] Finished evaluation at 2019-08-14-17:45:22
I0814 17:45:22.394428 139894822974912 estimator.py:2039] Saving dict for global step 30: accuracy = 0.0892, global_step = 30, loss = 200682.31
I0814 17:45:26.606761 139894822974912 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:45:27.377006 139894822974912 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 200682.31, 'global_step': 30, 'accuracy': 0.0892}

Removing gs://yangyou-mnist/log/#1565804527749436...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565804527.v3-8-tpu#1565804610785742...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565804540907949...
Removing gs://yangyou-mnist/log/checkpoint#1565804607678632...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565804604461982...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565804545288857...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565804605320590...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565804532770466...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565804539959400...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565804609876004...
Removing gs://yangyou-mnist/log/eval/#1565804724011906...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565804724.v3-8-tpu#1565804727048213...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:45:31.155704 139938102109632 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:45:31.156552 139938102109632 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:45:31.159198 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:45:31.160028 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:45:31.160945 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:45:31.161087 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:45:31.565706 139938102109632 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:45:31.572508 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:45:31.576076 139938102109632 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:45:31.679526 139938102109632 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:45:31.679805 139938102109632 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:45:31.850732 139938102109632 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:45:31.963239 139938102109632 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:45:31.963511 139938102109632 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:45:32.073729 139938102109632 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f45bb073190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f45bd252210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:45:32.074065 139938102109632 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:45:32.397964 139938102109632 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:45:32.400743: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:45:32.412563 139938102109632 tpu_system_metadata.py:148] Found TPU system:
I0814 17:45:32.412823 139938102109632 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:45:32.413362 139938102109632 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:45:32.413419 139938102109632 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:45:32.413471 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:45:32.413891 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:45:32.413949 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:45:32.413999 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:45:32.414047 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:45:32.414096 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:45:32.414160 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:45:32.414207 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:45:32.414254 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:45:32.414302 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:45:32.414349 139938102109632 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:45:32.420463 139938102109632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:45:32.433161 139938102109632 estimator.py:1145] Calling model_fn.
W0814 17:45:32.433788 139938102109632 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:45:32.703704 139938102109632 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:45:33.129522 139938102109632 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:45:33.190404 139938102109632 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:45:33.196429 139938102109632 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:45:33.385653 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:45:33.399363 139938102109632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:45:33.411377 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:45:33.412478 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:45:33.419657 139938102109632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:45:33.424992 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:45:33.425223 139938102109632 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 17:45:33.437710 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:45:33.546449 139938102109632 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:45:33.587610 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.632289 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.683020 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.844594 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.894586 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.941497 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:33.990885 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:34.035991 139938102109632 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:45:34.076162 139938102109632 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:45:34.092207 139938102109632 estimator.py:1147] Done calling model_fn.
I0814 17:45:38.436458 139938102109632 tpu_estimator.py:499] TPU job name worker
I0814 17:45:38.544878 139938102109632 monitored_session.py:240] Graph was finalized.
I0814 17:45:39.227183 139938102109632 session_manager.py:500] Running local_init_op.
I0814 17:45:39.287369 139938102109632 session_manager.py:502] Done running local_init_op.
I0814 17:45:42.133191 139938102109632 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:45:53.983195 139938102109632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:45:54.152751 139938102109632 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:45:54.153222 139938102109632 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:45:54.153699: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:45:54.158395 139938102109632 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:45:54.160495 139938102109632 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:45:54.164544 139938102109632 tpu_estimator.py:557] Init TPU system
I0814 17:46:36.121292 139938102109632 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 17:46:36.122193 139937189971712 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:46:36.122878 139937181579008 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:46:36.186428 139938102109632 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:46:36.187294 139938102109632 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:46:36.253182 139937173186304 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:46:36.439450 139937173186304 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:46:41.044446 139937181579008 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:46:45.857594 139938102109632 basic_session_run_hooks.py:262] loss = 2.1417282, step = 30
I0814 17:46:45.860230 139938102109632 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:46:58.729213 139938102109632 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:46:58.729515 139938102109632 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:46:58.729746 139937189971712 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:46:58.729857 139937189971712 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:46:58.729993 139938102109632 error_handling.py:96] infeed marked as finished
I0814 17:46:58.730098 139938102109632 tpu_estimator.py:602] Stop output thread controller
I0814 17:46:58.730145 139938102109632 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:46:58.730262 139937181579008 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:46:58.730349 139937181579008 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:46:58.730463 139938102109632 error_handling.py:96] outfeed marked as finished
I0814 17:46:58.730552 139938102109632 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:47:06.580017 139938102109632 estimator.py:368] Loss for final step: 2.1417282.
I0814 17:47:06.580842 139938102109632 error_handling.py:96] training_loop marked as finished
I0814 17:47:07.272459 139938102109632 estimator.py:1145] Calling model_fn.
E0814 17:47:08.007642 139938102109632 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:47:08.242865 139938102109632 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:47:08.266958 139938102109632 estimator.py:1147] Done calling model_fn.
I0814 17:47:08.285918 139938102109632 evaluation.py:255] Starting evaluation at 2019-08-14T17:47:08Z
I0814 17:47:08.286181 139938102109632 tpu_estimator.py:499] TPU job name worker
I0814 17:47:08.372951 139938102109632 monitored_session.py:240] Graph was finalized.
W0814 17:47:08.373768 139938102109632 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:47:08.540229 139938102109632 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:47:11.851591 139938102109632 session_manager.py:500] Running local_init_op.
I0814 17:47:11.877760 139938102109632 session_manager.py:502] Done running local_init_op.
I0814 17:47:11.926246 139938102109632 tpu_estimator.py:557] Init TPU system
I0814 17:48:20.038640 139938102109632 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:48:20.039645 139937198364416 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:48:20.040134 139937189971712 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:48:20.131820 139938102109632 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:48:20.160727 139938102109632 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:48:20.161140 139938102109632 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:48:20.194849 139937181579008 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:48:20.317217 139937181579008 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:48:20.947518 139937189971712 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:48:21.251693 139938102109632 evaluation.py:167] Evaluation [10/10]
I0814 17:48:21.252011 139938102109632 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:48:21.252083 139938102109632 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:48:21.252300 139937198364416 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:48:21.252434 139937198364416 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:48:21.252743 139938102109632 error_handling.py:96] infeed marked as finished
I0814 17:48:21.252931 139938102109632 tpu_estimator.py:602] Stop output thread controller
I0814 17:48:21.253006 139938102109632 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:48:21.253142 139937189971712 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:48:21.253226 139937189971712 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:48:21.253578 139938102109632 error_handling.py:96] outfeed marked as finished
I0814 17:48:21.253865 139938102109632 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:48:50.400371 139938102109632 evaluation.py:275] Finished evaluation at 2019-08-14-17:48:50
I0814 17:48:50.401134 139938102109632 estimator.py:2039] Saving dict for global step 30: accuracy = 0.6722, global_step = 30, loss = 2.1346107
I0814 17:48:54.734021 139938102109632 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:48:55.518728 139938102109632 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 2.1346107, 'global_step': 30, 'accuracy': 0.6722}

Removing gs://yangyou-mnist/log/#1565804735684601...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565804749458223...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565804753461729...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565804735.v3-8-tpu#1565804818440689...
Removing gs://yangyou-mnist/log/checkpoint#1565804815548075...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565804741539227...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565804812681813...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565804748604786...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565804813566662...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565804817568393...
Removing gs://yangyou-mnist/log/eval/#1565804932119996...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565804932.v3-8-tpu#1565804935196257...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:48:59.321764 139754750731712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:48:59.322526 139754750731712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:48:59.325383 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:48:59.326219 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:48:59.326786 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:48:59.326911 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:48:59.734651 139754750731712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:48:59.741355 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:48:59.745131 139754750731712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:48:59.797450 139754750731712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:48:59.797734 139754750731712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:48:59.891968 139754750731712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:48:59.944180 139754750731712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:48:59.944494 139754750731712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:49:00.111449 139754750731712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f1b0a6f3350>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f1b0c8d2210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:49:00.111819 139754750731712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:49:00.457084 139754750731712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:49:00.459993: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:49:00.474510 139754750731712 tpu_system_metadata.py:148] Found TPU system:
I0814 17:49:00.474760 139754750731712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:49:00.475322 139754750731712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:49:00.475380 139754750731712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:49:00.475434 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:49:00.475857 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:49:00.475924 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:49:00.475975 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:49:00.476025 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:49:00.476073 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:49:00.476123 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:49:00.476171 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:49:00.476217 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:49:00.476263 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:49:00.476310 139754750731712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:49:00.482557 139754750731712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:49:00.495445 139754750731712 estimator.py:1145] Calling model_fn.
W0814 17:49:00.496078 139754750731712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:49:00.780488 139754750731712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:49:01.299232 139754750731712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:49:01.360899 139754750731712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:49:01.366858 139754750731712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:49:01.549089 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:49:01.562983 139754750731712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:49:01.575047 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:49:01.576088 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:49:01.582971 139754750731712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:49:01.588150 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:49:01.588376 139754750731712 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 17:49:01.600879 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:49:01.710273 139754750731712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:49:01.751261 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:01.795449 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:01.846235 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.014059 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.064224 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.113863 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.164427 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.210832 139754750731712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:49:02.252057 139754750731712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:49:02.268625 139754750731712 estimator.py:1147] Done calling model_fn.
I0814 17:49:05.662265 139754750731712 tpu_estimator.py:499] TPU job name worker
I0814 17:49:05.771939 139754750731712 monitored_session.py:240] Graph was finalized.
I0814 17:49:06.433213 139754750731712 session_manager.py:500] Running local_init_op.
I0814 17:49:06.484270 139754750731712 session_manager.py:502] Done running local_init_op.
I0814 17:49:09.282258 139754750731712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:49:20.910053 139754750731712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:49:21.073530 139754750731712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:49:21.074014 139754750731712 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:49:21.074419: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:49:21.079359 139754750731712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:49:21.081660 139754750731712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:49:21.086714 139754750731712 tpu_estimator.py:557] Init TPU system
I0814 17:50:04.125765 139754750731712 tpu_estimator.py:566] Initialized TPU in 43 seconds
I0814 17:50:04.126715 139753854588672 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:50:04.127151 139753846195968 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:50:04.192447 139754750731712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:50:04.193361 139754750731712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 17:50:04.252717 139753837803264 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:50:04.402867 139753837803264 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:50:08.897512 139753846195968 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:50:13.384923 139754750731712 basic_session_run_hooks.py:262] loss = 1.9154099, step = 30
I0814 17:50:13.387166 139754750731712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:50:26.890656 139754750731712 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:50:26.890959 139754750731712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:50:26.891182 139753854588672 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:50:26.891299 139753854588672 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:50:26.891446 139754750731712 error_handling.py:96] infeed marked as finished
I0814 17:50:26.891562 139754750731712 tpu_estimator.py:602] Stop output thread controller
I0814 17:50:26.891618 139754750731712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:50:26.891729 139753846195968 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:50:26.891804 139753846195968 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:50:26.891916 139754750731712 error_handling.py:96] outfeed marked as finished
I0814 17:50:26.891993 139754750731712 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:50:34.809513 139754750731712 estimator.py:368] Loss for final step: 1.9154099.
I0814 17:50:34.810400 139754750731712 error_handling.py:96] training_loop marked as finished
I0814 17:50:35.516103 139754750731712 estimator.py:1145] Calling model_fn.
E0814 17:50:36.232307 139754750731712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:50:36.461837 139754750731712 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:50:36.483678 139754750731712 estimator.py:1147] Done calling model_fn.
I0814 17:50:36.501022 139754750731712 evaluation.py:255] Starting evaluation at 2019-08-14T17:50:36Z
I0814 17:50:36.501261 139754750731712 tpu_estimator.py:499] TPU job name worker
I0814 17:50:36.579961 139754750731712 monitored_session.py:240] Graph was finalized.
W0814 17:50:36.580741 139754750731712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:50:36.771752 139754750731712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:50:39.260004 139754750731712 session_manager.py:500] Running local_init_op.
I0814 17:50:39.284558 139754750731712 session_manager.py:502] Done running local_init_op.
I0814 17:50:39.342138 139754750731712 tpu_estimator.py:557] Init TPU system
I0814 17:51:48.043863 139754750731712 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:51:48.044944 139753850918656 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:51:48.045831 139753842525952 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:51:48.113940 139754750731712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:51:48.138303 139754750731712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:51:48.138660 139754750731712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:51:48.166533 139753829148416 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:51:48.286889 139753829148416 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:51:48.938724 139753842525952 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:51:49.251777 139754750731712 evaluation.py:167] Evaluation [10/10]
I0814 17:51:49.252146 139754750731712 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:51:49.252237 139754750731712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:51:49.252623 139753850918656 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:51:49.252904 139753850918656 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:51:49.253174 139754750731712 error_handling.py:96] infeed marked as finished
I0814 17:51:49.253406 139754750731712 tpu_estimator.py:602] Stop output thread controller
I0814 17:51:49.253469 139754750731712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:51:49.253664 139753842525952 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:51:49.253823 139753842525952 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:51:49.254014 139754750731712 error_handling.py:96] outfeed marked as finished
I0814 17:51:49.254194 139754750731712 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:52:18.375199 139754750731712 evaluation.py:275] Finished evaluation at 2019-08-14-17:52:18
I0814 17:52:18.375638 139754750731712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.7591, global_step = 30, loss = 1.9054855
I0814 17:52:22.641433 139754750731712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:52:23.432240 139754750731712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.9054855, 'global_step': 30, 'accuracy': 0.7591}

Removing gs://yangyou-mnist/log/#1565804943747625...
Removing gs://yangyou-mnist/log/checkpoint#1565805023212619...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565804943.v3-8-tpu#1565805026582005...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565804956084903...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565804955248473...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565804948694840...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565805020180789...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565805021040445...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565804960400009...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565805025542644...
Removing gs://yangyou-mnist/log/eval/#1565805140019242...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565805140.v3-8-tpu#1565805143128684...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:52:27.534907 140044267435456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:52:27.535721 140044267435456 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:52:27.538322 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:52:27.539139 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:52:27.539722 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:52:27.539849 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:52:27.953311 140044267435456 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:52:27.960894 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:52:27.965190 140044267435456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:52:28.020525 140044267435456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:52:28.020831 140044267435456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:52:28.134306 140044267435456 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:52:28.244190 140044267435456 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:52:28.244514 140044267435456 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:52:28.414736 140044267435456 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5e72f81250>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5e75177210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:52:28.415117 140044267435456 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:52:28.739953 140044267435456 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:52:28.743256: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:52:28.758064 140044267435456 tpu_system_metadata.py:148] Found TPU system:
I0814 17:52:28.758310 140044267435456 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:52:28.758910 140044267435456 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:52:28.758970 140044267435456 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:52:28.759028 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:52:28.759392 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:52:28.759449 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:52:28.759499 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:52:28.759547 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:52:28.759594 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:52:28.759640 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:52:28.759686 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:52:28.759742 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:52:28.759788 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:52:28.759836 140044267435456 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:52:28.765902 140044267435456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:52:28.780167 140044267435456 estimator.py:1145] Calling model_fn.
W0814 17:52:28.780853 140044267435456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:52:29.045900 140044267435456 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:52:29.452647 140044267435456 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:52:29.513274 140044267435456 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:52:29.519110 140044267435456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:52:29.699728 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:52:29.713315 140044267435456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:52:29.725603 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:52:29.726681 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:52:29.733864 140044267435456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:52:29.739155 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:52:29.739377 140044267435456 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 17:52:29.751935 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:52:29.862751 140044267435456 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:52:29.904246 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:29.948836 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.000261 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.169646 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.219403 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.269484 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.320096 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.366811 140044267435456 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:52:30.409003 140044267435456 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:52:30.425591 140044267435456 estimator.py:1147] Done calling model_fn.
I0814 17:52:33.859828 140044267435456 tpu_estimator.py:499] TPU job name worker
I0814 17:52:33.972203 140044267435456 monitored_session.py:240] Graph was finalized.
I0814 17:52:34.642605 140044267435456 session_manager.py:500] Running local_init_op.
I0814 17:52:34.702327 140044267435456 session_manager.py:502] Done running local_init_op.
I0814 17:52:37.480849 140044267435456 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:52:49.559148 140044267435456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:52:49.723694 140044267435456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:52:49.724189 140044267435456 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:52:49.724726: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:52:49.730525 140044267435456 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:52:49.733606 140044267435456 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:52:49.742607 140044267435456 tpu_estimator.py:557] Init TPU system
I0814 17:53:32.132013 140044267435456 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:53:32.132934 140043364587264 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:53:32.133501 140043356194560 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:53:32.197379 140043347801856 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:53:32.200249 140044267435456 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:53:32.201755 140044267435456 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:53:32.379008 140043347801856 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:53:36.932826 140043356194560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:53:41.658951 140044267435456 basic_session_run_hooks.py:262] loss = 1.4342101, step = 30
I0814 17:53:41.661727 140044267435456 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:53:54.988013 140044267435456 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:53:54.988336 140044267435456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:53:54.988703 140043364587264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:53:54.989001 140043364587264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:53:54.989232 140044267435456 error_handling.py:96] infeed marked as finished
I0814 17:53:54.989487 140044267435456 tpu_estimator.py:602] Stop output thread controller
I0814 17:53:54.989550 140044267435456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:53:54.989748 140043356194560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:53:54.990016 140043356194560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:53:54.990252 140044267435456 error_handling.py:96] outfeed marked as finished
I0814 17:53:54.990410 140044267435456 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:54:02.518925 140044267435456 estimator.py:368] Loss for final step: 1.4342101.
I0814 17:54:02.519736 140044267435456 error_handling.py:96] training_loop marked as finished
I0814 17:54:03.325839 140044267435456 estimator.py:1145] Calling model_fn.
E0814 17:54:04.022561 140044267435456 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:54:04.254884 140044267435456 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:54:04.277719 140044267435456 estimator.py:1147] Done calling model_fn.
I0814 17:54:04.294838 140044267435456 evaluation.py:255] Starting evaluation at 2019-08-14T17:54:04Z
I0814 17:54:04.295070 140044267435456 tpu_estimator.py:499] TPU job name worker
I0814 17:54:04.372792 140044267435456 monitored_session.py:240] Graph was finalized.
W0814 17:54:04.373531 140044267435456 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:54:04.597706 140044267435456 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:54:07.246196 140044267435456 session_manager.py:500] Running local_init_op.
I0814 17:54:07.277206 140044267435456 session_manager.py:502] Done running local_init_op.
I0814 17:54:07.333537 140044267435456 tpu_estimator.py:557] Init TPU system
I0814 17:55:16.094132 140044267435456 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:55:16.095051 140043364587264 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:55:16.095592 140043356194560 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:55:16.161449 140044267435456 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:55:16.189199 140044267435456 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:55:16.189547 140044267435456 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:55:16.215007 140043347801856 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:55:16.423830 140043347801856 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0814 17:55:16.939863 140043356194560 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:55:17.344589 140044267435456 evaluation.py:167] Evaluation [10/10]
I0814 17:55:17.345068 140044267435456 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:55:17.345145 140044267435456 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:55:17.345357 140043364587264 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:55:17.345462 140043364587264 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:55:17.345598 140044267435456 error_handling.py:96] infeed marked as finished
I0814 17:55:17.345706 140044267435456 tpu_estimator.py:602] Stop output thread controller
I0814 17:55:17.345756 140044267435456 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:55:17.345891 140043356194560 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:55:17.346040 140043356194560 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:55:17.346159 140044267435456 error_handling.py:96] outfeed marked as finished
I0814 17:55:17.346246 140044267435456 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:55:46.520782 140044267435456 evaluation.py:275] Finished evaluation at 2019-08-14-17:55:46
I0814 17:55:46.521114 140044267435456 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8168, global_step = 30, loss = 1.3891516
I0814 17:55:50.791774 140044267435456 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:55:51.696712 140044267435456 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 1.3891516, 'global_step': 30, 'accuracy': 0.8168}

Removing gs://yangyou-mnist/log/#1565805151976443...
Removing gs://yangyou-mnist/log/checkpoint#1565805231421089...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565805164526685...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565805152.v3-8-tpu#1565805234677201...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565805156909479...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565805228297926...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565805169044167...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565805163653464...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565805229190821...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565805233735107...
Removing gs://yangyou-mnist/log/eval/#1565805348177390...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565805348.v3-8-tpu#1565805351407197...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:55:55.421936 139978773259712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:55:55.422710 139978773259712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:55:55.425340 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:55:55.426166 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:55:55.426754 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:55:55.426886 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:55:55.830066 139978773259712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:55:55.838129 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:55:55.842586 139978773259712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:55:55.890080 139978773259712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:55:55.890412 139978773259712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:55:56.008471 139978773259712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:55:56.064191 139978773259712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:55:56.064507 139978773259712 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:55:56.160876 139978773259712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4f33364310>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4f3555a210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:55:56.161222 139978773259712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:55:56.483733 139978773259712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:55:56.486742: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:55:56.499314 139978773259712 tpu_system_metadata.py:148] Found TPU system:
I0814 17:55:56.499564 139978773259712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:55:56.500179 139978773259712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:55:56.500236 139978773259712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:55:56.500291 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:55:56.500674 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:55:56.500744 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:55:56.500794 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:55:56.500859 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:55:56.500907 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:55:56.500955 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:55:56.501002 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:55:56.501055 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:55:56.501104 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:55:56.501152 139978773259712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:55:56.507160 139978773259712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:55:56.519784 139978773259712 estimator.py:1145] Calling model_fn.
W0814 17:55:56.520395 139978773259712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:55:56.789361 139978773259712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:55:57.229922 139978773259712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:55:57.297715 139978773259712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:55:57.303733 139978773259712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:55:57.484189 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:55:57.497734 139978773259712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:55:57.509710 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:55:57.510788 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:55:57.517916 139978773259712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:55:57.523189 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:55:57.523403 139978773259712 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 17:55:57.535967 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:55:57.645834 139978773259712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:55:57.687509 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:57.732070 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:57.783286 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:57.949615 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:57.999414 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:58.047832 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:58.104615 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:58.150274 139978773259712 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:55:58.192296 139978773259712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:55:58.208782 139978773259712 estimator.py:1147] Done calling model_fn.
I0814 17:56:01.708295 139978773259712 tpu_estimator.py:499] TPU job name worker
I0814 17:56:01.820060 139978773259712 monitored_session.py:240] Graph was finalized.
I0814 17:56:02.470223 139978773259712 session_manager.py:500] Running local_init_op.
I0814 17:56:02.520301 139978773259712 session_manager.py:502] Done running local_init_op.
I0814 17:56:05.170803 139978773259712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:56:17.229655 139978773259712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:56:17.373357 139978773259712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:56:17.375197 139978773259712 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:56:17.375760: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:56:17.380500 139978773259712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:56:17.382719 139978773259712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:56:17.386861 139978773259712 tpu_estimator.py:557] Init TPU system
I0814 17:57:00.118247 139978773259712 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 17:57:00.119313 139977732118272 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:57:00.119862 139977723725568 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:57:00.180111 139977715332864 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:57:00.186314 139978773259712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 17:57:00.187046 139978773259712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 17:57:00.433883 139977715332864 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:57:04.849188 139977723725568 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:57:09.568948 139978773259712 basic_session_run_hooks.py:262] loss = 0.8892836, step = 30
I0814 17:57:09.571723 139978773259712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 17:57:24.628309 139978773259712 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:57:24.628686 139978773259712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:57:24.630331 139977732118272 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:57:24.630480 139977732118272 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:57:24.630621 139978773259712 error_handling.py:96] infeed marked as finished
I0814 17:57:24.630738 139978773259712 tpu_estimator.py:602] Stop output thread controller
I0814 17:57:24.630876 139978773259712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:57:24.631002 139977723725568 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:57:24.631079 139977723725568 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:57:24.631195 139978773259712 error_handling.py:96] outfeed marked as finished
I0814 17:57:24.631288 139978773259712 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:57:30.566610 139978773259712 estimator.py:368] Loss for final step: 0.8892836.
I0814 17:57:30.567394 139978773259712 error_handling.py:96] training_loop marked as finished
I0814 17:57:31.401679 139978773259712 estimator.py:1145] Calling model_fn.
E0814 17:57:32.100879 139978773259712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:57:32.337479 139978773259712 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 17:57:32.360277 139978773259712 estimator.py:1147] Done calling model_fn.
I0814 17:57:32.377051 139978773259712 evaluation.py:255] Starting evaluation at 2019-08-14T17:57:32Z
I0814 17:57:32.377307 139978773259712 tpu_estimator.py:499] TPU job name worker
I0814 17:57:32.458324 139978773259712 monitored_session.py:240] Graph was finalized.
W0814 17:57:32.459121 139978773259712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 17:57:32.652923 139978773259712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 17:57:35.228755 139978773259712 session_manager.py:500] Running local_init_op.
I0814 17:57:35.253137 139978773259712 session_manager.py:502] Done running local_init_op.
I0814 17:57:35.312235 139978773259712 tpu_estimator.py:557] Init TPU system
I0814 17:58:44.137368 139978773259712 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 17:58:44.138483 139977732118272 tpu_estimator.py:514] Starting infeed thread controller.
I0814 17:58:44.139298 139977723725568 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 17:58:44.207206 139978773259712 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:58:44.236723 139978773259712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 17:58:44.237102 139978773259712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 17:58:44.268162 139977715332864 transport.py:157] Attempting refresh to obtain initial access_token
W0814 17:58:44.424520 139977715332864 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 17:58:45.022901 139977723725568 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 17:58:45.341099 139978773259712 evaluation.py:167] Evaluation [10/10]
I0814 17:58:45.341542 139978773259712 tpu_estimator.py:598] Stop infeed thread controller
I0814 17:58:45.341634 139978773259712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 17:58:45.341928 139977732118272 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 17:58:45.342228 139977732118272 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 17:58:45.342494 139978773259712 error_handling.py:96] infeed marked as finished
I0814 17:58:45.342653 139978773259712 tpu_estimator.py:602] Stop output thread controller
I0814 17:58:45.342704 139978773259712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 17:58:45.342885 139977723725568 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 17:58:45.343077 139977723725568 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 17:58:45.343278 139978773259712 error_handling.py:96] outfeed marked as finished
I0814 17:58:45.343488 139978773259712 tpu_estimator.py:606] Shutdown TPU system.
I0814 17:59:14.523720 139978773259712 evaluation.py:275] Finished evaluation at 2019-08-14-17:59:14
I0814 17:59:14.524111 139978773259712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.8264, global_step = 30, loss = 0.82866657
I0814 17:59:19.090161 139978773259712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 17:59:19.925352 139978773259712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.82866657, 'global_step': 30, 'accuracy': 0.8264}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565805372422049...
Removing gs://yangyou-mnist/log/#1565805359659163...
Removing gs://yangyou-mnist/log/checkpoint#1565805440958132...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565805359.v3-8-tpu#1565805444316370...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565805376745936...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565805364626294...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565805437908010...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565805371601891...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565805438736792...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565805443265152...
Removing gs://yangyou-mnist/log/eval/#1565805556227118...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565805556.v3-8-tpu#1565805559569515...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 17:59:23.759295 140206887175616 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 17:59:23.760107 140206887175616 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 17:59:23.762710 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 17:59:23.763530 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 17:59:23.764100 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 17:59:23.764230 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 17:59:24.168870 140206887175616 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 17:59:24.176397 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 17:59:24.180644 140206887175616 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:59:24.297714 140206887175616 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:59:24.297991 140206887175616 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:59:24.396243 140206887175616 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 17:59:24.450087 140206887175616 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 17:59:24.450382 140206887175616 transport.py:157] Attempting refresh to obtain initial access_token
I0814 17:59:24.587450 140206887175616 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f844fddd190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8451fbc210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 17:59:24.587868 140206887175616 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 17:59:24.912631 140206887175616 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 17:59:24.915411: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:59:24.928338 140206887175616 tpu_system_metadata.py:148] Found TPU system:
I0814 17:59:24.928621 140206887175616 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 17:59:24.929104 140206887175616 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 17:59:24.929161 140206887175616 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 17:59:24.929219 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 17:59:24.929506 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 17:59:24.929560 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 17:59:24.929621 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 17:59:24.929670 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 17:59:24.929717 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 17:59:24.929761 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 17:59:24.929807 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 17:59:24.929860 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 17:59:24.929904 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 17:59:24.929964 140206887175616 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 17:59:24.936110 140206887175616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 17:59:24.948633 140206887175616 estimator.py:1145] Calling model_fn.
W0814 17:59:24.949229 140206887175616 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 17:59:25.219566 140206887175616 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 17:59:25.675761 140206887175616 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 17:59:25.737804 140206887175616 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 17:59:25.743889 140206887175616 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 17:59:25.922068 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 17:59:25.935549 140206887175616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 17:59:25.947722 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 17:59:25.948823 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 17:59:25.955697 140206887175616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 17:59:25.960922 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 17:59:25.961138 140206887175616 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 17:59:25.973278 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 17:59:26.081175 140206887175616 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 17:59:26.129235 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.172955 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.224886 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.389008 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.439383 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.488027 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.538151 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.583607 140206887175616 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 17:59:26.624222 140206887175616 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 17:59:26.639998 140206887175616 estimator.py:1147] Done calling model_fn.
I0814 17:59:30.030416 140206887175616 tpu_estimator.py:499] TPU job name worker
I0814 17:59:30.147332 140206887175616 monitored_session.py:240] Graph was finalized.
I0814 17:59:30.817852 140206887175616 session_manager.py:500] Running local_init_op.
I0814 17:59:30.866223 140206887175616 session_manager.py:502] Done running local_init_op.
I0814 17:59:35.552565 140206887175616 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 17:59:48.122467 140206887175616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 17:59:48.292033 140206887175616 util.py:98] Initialized dataset iterators in 0 seconds
I0814 17:59:48.292555 140206887175616 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 17:59:48.292971: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 17:59:48.298837 140206887175616 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 17:59:48.301492 140206887175616 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 17:59:48.306266 140206887175616 tpu_estimator.py:557] Init TPU system
I0814 18:00:28.033720 140206887175616 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0814 18:00:28.034861 140205851932416 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:00:28.035896 140205843539712 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:00:28.097999 140205835147008 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:00:28.124742 140206887175616 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:00:28.125600 140206887175616 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:00:28.216713 140205835147008 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:00:32.877161 140205843539712 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:00:37.516247 140206887175616 basic_session_run_hooks.py:262] loss = 0.6425506, step = 30
I0814 18:00:37.519373 140206887175616 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:00:51.256309 140206887175616 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:00:51.256638 140206887175616 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:00:51.256824 140205851932416 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:00:51.256912 140205851932416 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:00:51.257035 140206887175616 error_handling.py:96] infeed marked as finished
I0814 18:00:51.257133 140206887175616 tpu_estimator.py:602] Stop output thread controller
I0814 18:00:51.257196 140206887175616 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:00:51.257309 140205843539712 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:00:51.257390 140205843539712 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:00:51.257505 140206887175616 error_handling.py:96] outfeed marked as finished
I0814 18:00:51.257586 140206887175616 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:00:58.347961 140206887175616 estimator.py:368] Loss for final step: 0.6425506.
I0814 18:00:58.348810 140206887175616 error_handling.py:96] training_loop marked as finished
I0814 18:00:59.229146 140206887175616 estimator.py:1145] Calling model_fn.
E0814 18:00:59.914640 140206887175616 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:01:00.142427 140206887175616 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:01:00.163611 140206887175616 estimator.py:1147] Done calling model_fn.
I0814 18:01:00.179620 140206887175616 evaluation.py:255] Starting evaluation at 2019-08-14T18:01:00Z
I0814 18:01:00.179856 140206887175616 tpu_estimator.py:499] TPU job name worker
I0814 18:01:00.258059 140206887175616 monitored_session.py:240] Graph was finalized.
W0814 18:01:00.258817 140206887175616 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:01:00.453092 140206887175616 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:01:03.110733 140206887175616 session_manager.py:500] Running local_init_op.
I0814 18:01:03.135641 140206887175616 session_manager.py:502] Done running local_init_op.
I0814 18:01:03.192315 140206887175616 tpu_estimator.py:557] Init TPU system
I0814 18:02:12.031619 140206887175616 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:02:12.032782 140205851932416 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:02:12.033715 140205843539712 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:02:12.108459 140206887175616 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:02:12.135737 140206887175616 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:02:12.136121 140206887175616 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:02:12.169275 140205835147008 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:02:12.276494 140205835147008 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:02:12.904613 140205843539712 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:02:13.208710 140206887175616 evaluation.py:167] Evaluation [10/10]
I0814 18:02:13.209112 140206887175616 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:02:13.209203 140206887175616 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:02:13.209527 140205851932416 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:02:13.209855 140205851932416 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:02:13.210099 140206887175616 error_handling.py:96] infeed marked as finished
I0814 18:02:13.210304 140206887175616 tpu_estimator.py:602] Stop output thread controller
I0814 18:02:13.210431 140206887175616 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:02:13.210864 140205843539712 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:02:13.211050 140205843539712 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:02:13.211267 140206887175616 error_handling.py:96] outfeed marked as finished
I0814 18:02:13.211457 140206887175616 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:02:42.373843 140206887175616 evaluation.py:275] Finished evaluation at 2019-08-14-18:02:42
I0814 18:02:42.374193 140206887175616 estimator.py:2039] Saving dict for global step 30: accuracy = 0.863, global_step = 30, loss = 0.5889317
I0814 18:02:46.574275 140206887175616 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:02:47.485526 140206887175616 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.5889317, 'global_step': 30, 'accuracy': 0.863}

Removing gs://yangyou-mnist/log/events.out.tfevents.1565805568.v3-8-tpu#1565805650936187...
Removing gs://yangyou-mnist/log/checkpoint#1565805647559200...
Removing gs://yangyou-mnist/log/#1565805568193983...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565805574954987...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565805582226769...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565805587597361...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565805583117780...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565805644433157...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565805645311565...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565805649938279...
Removing gs://yangyou-mnist/log/eval/#1565805764033407...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565805764.v3-8-tpu#1565805767159112...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:02:51.286230 140390262437312 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:02:51.286993 140390262437312 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:02:51.289588 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:02:51.290422 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:02:51.291006 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:02:51.291136 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:02:51.698998 140390262437312 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:02:51.706862 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:02:51.710732 140390262437312 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:02:51.763158 140390262437312 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:02:51.763437 140390262437312 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:02:51.869345 140390262437312 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:02:51.988166 140390262437312 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:02:51.988467 140390262437312 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:02:52.192657 140390262437312 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7faf01e0d3d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7faf04003210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:02:52.193048 140390262437312 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:02:52.519264 140390262437312 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:02:52.522415: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:02:52.536528 140390262437312 tpu_system_metadata.py:148] Found TPU system:
I0814 18:02:52.536765 140390262437312 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:02:52.537249 140390262437312 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:02:52.537307 140390262437312 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:02:52.537362 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:02:52.537640 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:02:52.537695 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:02:52.537745 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:02:52.537792 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:02:52.537839 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:02:52.537885 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:02:52.537931 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:02:52.537977 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:02:52.538022 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:02:52.538069 140390262437312 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:02:52.543984 140390262437312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:02:52.556174 140390262437312 estimator.py:1145] Calling model_fn.
W0814 18:02:52.556807 140390262437312 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:02:52.828882 140390262437312 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:02:53.272891 140390262437312 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:02:53.334518 140390262437312 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:02:53.340364 140390262437312 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:02:53.520879 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:02:53.534506 140390262437312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:02:53.546706 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:02:53.547751 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:02:53.554769 140390262437312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:02:53.560014 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:02:53.560239 140390262437312 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:02:53.572567 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:02:53.680984 140390262437312 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:02:53.721893 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:53.766500 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:53.818775 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:53.982589 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:54.032246 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:54.081012 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:54.138721 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:54.184432 140390262437312 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:02:54.226469 140390262437312 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:02:54.243412 140390262437312 estimator.py:1147] Done calling model_fn.
I0814 18:02:57.712296 140390262437312 tpu_estimator.py:499] TPU job name worker
I0814 18:02:57.820007 140390262437312 monitored_session.py:240] Graph was finalized.
I0814 18:02:58.487760 140390262437312 session_manager.py:500] Running local_init_op.
I0814 18:02:58.547858 140390262437312 session_manager.py:502] Done running local_init_op.
I0814 18:03:01.346405 140390262437312 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:03:13.539187 140390262437312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:03:13.696787 140390262437312 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:03:13.697242 140390262437312 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:03:13.697651: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:03:13.702663 140390262437312 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:03:13.704878 140390262437312 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:03:13.710359 140390262437312 tpu_estimator.py:557] Init TPU system
I0814 18:03:56.116142 140390262437312 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0814 18:03:56.117345 140389366089472 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:03:56.118129 140389357696768 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:03:56.182048 140390262437312 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:03:56.184341 140390262437312 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0814 18:03:56.191678 140389349304064 transport.py:157] Attempting refresh to obtain initial access_token
W0814 18:03:56.355429 140389349304064 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:04:00.932945 140389357696768 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:04:05.572829 140390262437312 basic_session_run_hooks.py:262] loss = 0.4675296, step = 30
I0814 18:04:05.575110 140390262437312 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:04:19.202739 140390262437312 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:04:19.203238 140390262437312 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:04:19.203558 140389366089472 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:04:19.204008 140389366089472 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:04:19.204530 140390262437312 error_handling.py:96] infeed marked as finished
I0814 18:04:19.204725 140390262437312 tpu_estimator.py:602] Stop output thread controller
I0814 18:04:19.204782 140390262437312 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:04:19.204977 140389357696768 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:04:19.205255 140389357696768 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:04:19.205497 140390262437312 error_handling.py:96] outfeed marked as finished
I0814 18:04:19.205648 140390262437312 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:04:26.504281 140390262437312 estimator.py:368] Loss for final step: 0.4675296.
I0814 18:04:26.505197 140390262437312 error_handling.py:96] training_loop marked as finished
I0814 18:04:27.286472 140390262437312 estimator.py:1145] Calling model_fn.
E0814 18:04:27.976898 140390262437312 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:04:28.202512 140390262437312 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:04:28.223458 140390262437312 estimator.py:1147] Done calling model_fn.
I0814 18:04:28.239397 140390262437312 evaluation.py:255] Starting evaluation at 2019-08-14T18:04:28Z
I0814 18:04:28.239650 140390262437312 tpu_estimator.py:499] TPU job name worker
I0814 18:04:28.317456 140390262437312 monitored_session.py:240] Graph was finalized.
W0814 18:04:28.318239 140390262437312 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:04:29.102158 140390262437312 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:04:31.634990 140390262437312 session_manager.py:500] Running local_init_op.
I0814 18:04:31.659962 140390262437312 session_manager.py:502] Done running local_init_op.
I0814 18:04:31.710313 140390262437312 tpu_estimator.py:557] Init TPU system
I0814 18:05:40.045058 140390262437312 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0814 18:05:40.045918 140389362419456 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:05:40.046380 140389354026752 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:05:40.112601 140390262437312 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:05:40.137510 140390262437312 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0814 18:05:40.137862 140390262437312 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0814 18:05:40.177469 140389340649216 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:05:40.940011 140389354026752 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
W0814 18:05:41.054797 140389340649216 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:05:41.277532 140390262437312 evaluation.py:167] Evaluation [10/10]
I0814 18:05:41.277863 140390262437312 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:05:41.277937 140390262437312 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:05:41.278121 140389362419456 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:05:41.278213 140389362419456 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:05:41.278352 140390262437312 error_handling.py:96] infeed marked as finished
I0814 18:05:41.278439 140390262437312 tpu_estimator.py:602] Stop output thread controller
I0814 18:05:41.278486 140390262437312 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:05:41.278599 140389354026752 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:05:41.278696 140389354026752 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:05:41.278814 140390262437312 error_handling.py:96] outfeed marked as finished
I0814 18:05:41.278898 140390262437312 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:06:11.128855 140390262437312 evaluation.py:275] Finished evaluation at 2019-08-14-18:06:11
I0814 18:06:11.129178 140390262437312 estimator.py:2039] Saving dict for global step 30: accuracy = 0.891, global_step = 30, loss = 0.44235554
I0814 18:06:15.531778 140390262437312 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0814 18:06:16.353367 140390262437312 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.44235554, 'global_step': 30, 'accuracy': 0.891}

Removing gs://yangyou-mnist/log/#1565805775735127...
Removing gs://yangyou-mnist/log/checkpoint#1565805855755329...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565805788696956...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565805775.v3-8-tpu#1565805858898423...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565805780761491...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565805793016242...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565805787790347...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565805852589398...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565805853462109...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565805857925459...
Removing gs://yangyou-mnist/log/eval/#1565805972808075...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565805972.v3-8-tpu#1565805976061593...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0814 18:06:20.038815 139883997414848 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0814 18:06:20.039621 139883997414848 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0814 18:06:20.042355 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:83: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0814 18:06:20.043200 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0814 18:06:20.043812 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0814 18:06:20.043943 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0814 18:06:20.465480 139883997414848 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0814 18:06:20.472888 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0814 18:06:20.476984 139883997414848 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:06:20.535749 139883997414848 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:06:20.536058 139883997414848 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:06:20.793981 139883997414848 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0814 18:06:20.852302 139883997414848 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0814 18:06:20.852615 139883997414848 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:06:21.116167 139883997414848 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f3922231210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f3924410210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0814 18:06:21.116569 139883997414848 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0814 18:06:21.426177 139883997414848 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-14 18:06:21.429307: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:06:21.441313 139883997414848 tpu_system_metadata.py:148] Found TPU system:
I0814 18:06:21.441555 139883997414848 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0814 18:06:21.442075 139883997414848 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0814 18:06:21.442142 139883997414848 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0814 18:06:21.442194 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0814 18:06:21.442476 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0814 18:06:21.442533 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0814 18:06:21.442595 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0814 18:06:21.442646 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0814 18:06:21.442727 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0814 18:06:21.442774 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0814 18:06:21.442820 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0814 18:06:21.442864 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0814 18:06:21.442917 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0814 18:06:21.442966 139883997414848 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0814 18:06:21.449471 139883997414848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0814 18:06:21.462338 139883997414848 estimator.py:1145] Calling model_fn.
W0814 18:06:21.462940 139883997414848 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0814 18:06:21.759181 139883997414848 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0814 18:06:22.240303 139883997414848 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0814 18:06:22.302462 139883997414848 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0814 18:06:22.308450 139883997414848 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:06:22.488965 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0814 18:06:22.502866 139883997414848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0814 18:06:22.515089 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:17: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0814 18:06:22.516153 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:22: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0814 18:06:22.523165 139883997414848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0814 18:06:22.528512 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:36: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0814 18:06:22.528723 139883997414848 optimization.py:36] ++++++ warmup starts at step 0, for 4 steps ++++++
W0814 18:06:22.541446 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:66: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0814 18:06:22.651530 139883997414848 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb/optimization.py:118: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0814 18:06:22.693516 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:22.738815 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:22.789917 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:22.956257 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:23.006417 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:23.055577 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:23.106450 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:23.153737 139883997414848 optimization.py:160] *********** I'm using LAMB correction ***********
I0814 18:06:23.195669 139883997414848 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0814 18:06:23.212061 139883997414848 estimator.py:1147] Done calling model_fn.
I0814 18:06:26.588330 139883997414848 tpu_estimator.py:499] TPU job name worker
I0814 18:06:26.700690 139883997414848 monitored_session.py:240] Graph was finalized.
I0814 18:06:27.344583 139883997414848 session_manager.py:500] Running local_init_op.
I0814 18:06:27.393368 139883997414848 session_manager.py:502] Done running local_init_op.
I0814 18:06:29.967585 139883997414848 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0814 18:06:42.190201 139883997414848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0814 18:06:42.355948 139883997414848 util.py:98] Initialized dataset iterators in 0 seconds
I0814 18:06:42.356380 139883997414848 session_support.py:332] Installing graceful shutdown hook.
2019-08-14 18:06:42.356803: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0814 18:06:42.361701 139883997414848 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0814 18:06:42.363876 139883997414848 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0814 18:06:42.368297 139883997414848 tpu_estimator.py:557] Init TPU system
I0814 18:07:24.129581 139883997414848 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0814 18:07:24.130548 139883101280000 tpu_estimator.py:514] Starting infeed thread controller.
I0814 18:07:24.131004 139883092887296 tpu_estimator.py:533] Starting outfeed thread controller.
I0814 18:07:24.194194 139883084494592 transport.py:157] Attempting refresh to obtain initial access_token
I0814 18:07:24.196741 139883997414848 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0814 18:07:24.197928 139883997414848 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0814 18:07:24.386814 139883084494592 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0814 18:07:28.925771 139883092887296 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0814 18:07:33.593555 139883997414848 basic_session_run_hooks.py:262] loss = 0.22694764, step = 30
I0814 18:07:33.596000 139883997414848 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0814 18:07:48.401870 139883997414848 tpu_estimator.py:598] Stop infeed thread controller
I0814 18:07:48.402172 139883997414848 tpu_estimator.py:430] Shutting down InfeedController thread.
I0814 18:07:48.402391 139883101280000 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0814 18:07:48.402503 139883101280000 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0814 18:07:48.402640 139883997414848 error_handling.py:96] infeed marked as finished
I0814 18:07:48.402736 139883997414848 tpu_estimator.py:602] Stop output thread controller
I0814 18:07:48.402785 139883997414848 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0814 18:07:48.402892 139883092887296 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0814 18:07:48.402962 139883092887296 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0814 18:07:48.403069 139883997414848 error_handling.py:96] outfeed marked as finished
I0814 18:07:48.403151 139883997414848 tpu_estimator.py:606] Shutdown TPU system.
I0814 18:07:54.522712 139883997414848 estimator.py:368] Loss for final step: 0.22694764.
I0814 18:07:54.523653 139883997414848 error_handling.py:96] training_loop marked as finished
I0814 18:07:55.335495 139883997414848 estimator.py:1145] Calling model_fn.
E0814 18:07:56.031929 139883997414848 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0814 18:07:56.258137 139883997414848 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0814 18:07:56.279787 139883997414848 estimator.py:1147] Done calling model_fn.
I0814 18:07:56.296125 139883997414848 evaluation.py:255] Starting evaluation at 2019-08-14T18:07:56Z
I0814 18:07:56.296370 139883997414848 tpu_estimator.py:499] TPU job name worker
I0814 18:07:56.373168 139883997414848 monitored_session.py:240] Graph was finalized.
W0814 18:07:56.373950 139883997414848 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0814 18:07:56.564754 139883997414848 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0814 18:07:59.355593 139883997414848 session_manager.py:500] Running local_init_op.
I0814 18:07:59.379395 139883997414848 session_manager.py:502] Done running local_init_op.
I0814 18:07:59.434596 139883997414848 tpu_estimator.py:557] Init TPU system
