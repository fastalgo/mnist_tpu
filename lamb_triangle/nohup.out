Removing gs://yangyou-mnist/log/#1565828760412935...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565828760.v3-8-tpu#1565828843874814...
Removing gs://yangyou-mnist/log/checkpoint#1565828840571453...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565828773635860...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565828765402152...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565828779350452...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565828774575533...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565828837596854...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565828836671581...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565828842916292...
Removing gs://yangyou-mnist/log/eval/#1565828956499884...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565828956.v3-8-tpu#1565828959928433...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:37:41.099581 140376033035712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:37:41.100358 140376033035712 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:37:41.104023 140376033035712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:37:41.105056 140376033035712 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:37:41.105669 140376033035712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:37:41.105808 140376033035712 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:37:41.523756 140376033035712 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:37:41.530576 140376033035712 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:37:41.534564 140376033035712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:37:41.590720 140376033035712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:37:41.591006 140376033035712 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:37:41.904347 140376033035712 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:37:41.957583 140376033035712 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:37:41.957856 140376033035712 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:37:42.229886 140376033035712 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fabb1bee210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fabb3dcc210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:37:42.230241 140376033035712 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:37:42.556828 140376033035712 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:37:42.559785: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:37:42.575850 140376033035712 tpu_system_metadata.py:148] Found TPU system:
I0815 00:37:42.576087 140376033035712 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:37:42.576673 140376033035712 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:37:42.576734 140376033035712 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:37:42.576792 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:37:42.577090 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:37:42.577150 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:37:42.577199 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:37:42.577248 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:37:42.577295 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:37:42.577342 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:37:42.577388 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:37:42.577446 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:37:42.577492 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:37:42.577548 140376033035712 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:37:42.583667 140376033035712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:37:42.596673 140376033035712 estimator.py:1145] Calling model_fn.
W0815 00:37:42.597290 140376033035712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:37:42.872659 140376033035712 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:37:43.393699 140376033035712 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:37:43.456357 140376033035712 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:37:43.462378 140376033035712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:37:43.644159 140376033035712 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:37:43.657875 140376033035712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:37:43.670073 140376033035712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:37:43.675599 140376033035712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:37:43.681195 140376033035712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:37:43.699042 140376033035712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:37:43.699281 140376033035712 optimization.py:32] ++++++ warmup starts at step 0, for 8 steps ++++++
W0815 00:37:43.699412 140376033035712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:37:43.810735 140376033035712 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:37:43.853240 140376033035712 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:37:43.898133 140376033035712 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:37:43.949975 140376033035712 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:37:44.118328 140376033035712 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:37:44.167692 140376033035712 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:37:44.217499 140376033035712 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:37:44.275079 140376033035712 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:37:44.320947 140376033035712 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:37:44.362047 140376033035712 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:37:44.378477 140376033035712 estimator.py:1147] Done calling model_fn.
I0815 00:37:48.022214 140376033035712 tpu_estimator.py:499] TPU job name worker
I0815 00:37:48.142713 140376033035712 monitored_session.py:240] Graph was finalized.
I0815 00:37:48.839586 140376033035712 session_manager.py:500] Running local_init_op.
I0815 00:37:48.894030 140376033035712 session_manager.py:502] Done running local_init_op.
I0815 00:37:51.760250 140376033035712 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:38:04.372392 140376033035712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:38:04.544487 140376033035712 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:38:04.544930 140376033035712 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:38:04.545354: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:38:04.550606 140376033035712 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:38:04.552778 140376033035712 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:38:04.557770 140376033035712 tpu_estimator.py:557] Init TPU system
I0815 00:38:10.551481 140376033035712 tpu_estimator.py:566] Initialized TPU in 5 seconds
I0815 00:38:10.552613 140375136913152 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:38:10.553113 140375128520448 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:38:10.623059 140376033035712 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:38:10.623961 140376033035712 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 00:38:10.680809 140375120127744 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:38:11.026670 140375120127744 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:38:15.451421 140375128520448 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:38:20.226903 140376033035712 basic_session_run_hooks.py:262] loss = 0.11415524, step = 30
I0815 00:38:20.229547 140376033035712 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:38:34.642978 140376033035712 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:38:34.643305 140376033035712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:38:34.643687 140375136913152 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:38:34.644090 140375136913152 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:38:34.644324 140376033035712 error_handling.py:96] infeed marked as finished
I0815 00:38:34.644608 140376033035712 tpu_estimator.py:602] Stop output thread controller
I0815 00:38:34.644665 140376033035712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:38:34.644903 140375128520448 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:38:34.645127 140375128520448 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:38:34.645334 140376033035712 error_handling.py:96] outfeed marked as finished
I0815 00:38:34.645478 140376033035712 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:38:41.161245 140376033035712 estimator.py:368] Loss for final step: 0.11415524.
I0815 00:38:41.162200 140376033035712 error_handling.py:96] training_loop marked as finished
I0815 00:38:41.975742 140376033035712 estimator.py:1145] Calling model_fn.
E0815 00:38:42.679806 140376033035712 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:38:42.907458 140376033035712 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:38:42.929779 140376033035712 estimator.py:1147] Done calling model_fn.
I0815 00:38:42.948652 140376033035712 evaluation.py:255] Starting evaluation at 2019-08-15T00:38:42Z
I0815 00:38:42.948905 140376033035712 tpu_estimator.py:499] TPU job name worker
I0815 00:38:43.031162 140376033035712 monitored_session.py:240] Graph was finalized.
W0815 00:38:43.031898 140376033035712 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:38:43.245037 140376033035712 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:38:46.221261 140376033035712 session_manager.py:500] Running local_init_op.
I0815 00:38:46.251015 140376033035712 session_manager.py:502] Done running local_init_op.
I0815 00:38:46.307270 140376033035712 tpu_estimator.py:557] Init TPU system
I0815 00:38:55.293987 140376033035712 tpu_estimator.py:566] Initialized TPU in 8 seconds
I0815 00:38:55.294769 140375133243136 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:38:55.295169 140375124850432 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:38:55.364098 140376033035712 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:38:55.389529 140376033035712 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:38:55.389875 140376033035712 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:38:55.493706 140375111472896 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:38:55.722389 140375111472896 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:38:56.151458 140375124850432 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:38:56.659367 140376033035712 evaluation.py:167] Evaluation [10/10]
I0815 00:38:56.659703 140376033035712 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:38:56.659785 140376033035712 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:38:56.660053 140375133243136 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:38:56.660332 140375133243136 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:38:56.660602 140376033035712 error_handling.py:96] infeed marked as finished
I0815 00:38:56.660830 140376033035712 tpu_estimator.py:602] Stop output thread controller
I0815 00:38:56.660892 140376033035712 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:38:56.661086 140375124850432 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:38:56.661354 140375124850432 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:38:56.661650 140376033035712 error_handling.py:96] outfeed marked as finished
I0815 00:38:56.661839 140376033035712 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:39:25.818624 140376033035712 evaluation.py:275] Finished evaluation at 2019-08-15-00:39:25
I0815 00:39:25.818933 140376033035712 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9701, global_step = 30, loss = 0.09451322
I0815 00:39:30.458401 140376033035712 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:39:31.336065 140376033035712 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09451322, 'global_step': 30, 'accuracy': 0.9701}

Removing gs://yangyou-mnist/log/#1565829465969233...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565829479222103...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565829471179131...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565829483866054...
Removing gs://yangyou-mnist/log/checkpoint#1565829511084510...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565829466.v3-8-tpu#1565829514338459...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565829507960814...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565829478344628...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565829508909026...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565829513311732...
Removing gs://yangyou-mnist/log/eval/#1565829567507555...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565829567.v3-8-tpu#1565829571029161...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:39:35.233414 140384619771328 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:39:35.234234 140384619771328 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:39:35.237067 140384619771328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:39:35.237936 140384619771328 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:39:35.238527 140384619771328 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:39:35.238648 140384619771328 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:39:35.665576 140384619771328 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:39:35.673484 140384619771328 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:39:35.677459 140384619771328 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:39:35.735049 140384619771328 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:39:35.735382 140384619771328 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:39:35.980989 140384619771328 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:39:36.098220 140384619771328 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:39:36.098507 140384619771328 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:39:36.417910 140384619771328 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fadb18e1190>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fadb3abf210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:39:36.418330 140384619771328 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:39:36.749901 140384619771328 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:39:36.752754: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:39:36.765804 140384619771328 tpu_system_metadata.py:148] Found TPU system:
I0815 00:39:36.766057 140384619771328 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:39:36.766601 140384619771328 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:39:36.766664 140384619771328 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:39:36.766724 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:39:36.767028 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:39:36.767085 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:39:36.767136 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:39:36.767183 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:39:36.767230 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:39:36.767276 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:39:36.767319 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:39:36.767364 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:39:36.767410 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:39:36.767456 140384619771328 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:39:36.774313 140384619771328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:39:36.787372 140384619771328 estimator.py:1145] Calling model_fn.
W0815 00:39:36.788027 140384619771328 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:39:37.054682 140384619771328 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:39:37.453018 140384619771328 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:39:37.518028 140384619771328 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:39:37.523986 140384619771328 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:39:37.716058 140384619771328 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:39:37.729970 140384619771328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:39:37.742547 140384619771328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:39:37.749893 140384619771328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:39:37.755484 140384619771328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:39:37.773139 140384619771328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:39:37.773350 140384619771328 optimization.py:32] ++++++ warmup starts at step 0, for 8 steps ++++++
W0815 00:39:37.773479 140384619771328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:39:37.884366 140384619771328 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:39:37.926409 140384619771328 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:39:37.971329 140384619771328 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:39:38.023796 140384619771328 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:39:38.201884 140384619771328 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:39:38.255918 140384619771328 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:39:38.305963 140384619771328 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:39:38.358537 140384619771328 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:39:38.406507 140384619771328 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:39:38.449600 140384619771328 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:39:38.466340 140384619771328 estimator.py:1147] Done calling model_fn.
I0815 00:39:43.761904 140384619771328 tpu_estimator.py:499] TPU job name worker
I0815 00:39:43.875677 140384619771328 monitored_session.py:240] Graph was finalized.
I0815 00:39:44.563946 140384619771328 session_manager.py:500] Running local_init_op.
I0815 00:39:44.627007 140384619771328 session_manager.py:502] Done running local_init_op.
I0815 00:39:47.509407 140384619771328 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:40:00.217595 140384619771328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:40:00.379228 140384619771328 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:40:00.379681 140384619771328 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:40:00.380150: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:40:00.384819 140384619771328 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:40:00.386986 140384619771328 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:40:00.392036 140384619771328 tpu_estimator.py:557] Init TPU system
I0815 00:40:12.023827 140384619771328 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0815 00:40:12.024910 140383723439872 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:40:12.025485 140383715047168 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:40:12.089421 140383706654464 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:40:12.096271 140384619771328 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:40:12.097831 140384619771328 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 00:40:12.349704 140383706654464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:40:16.967636 140383715047168 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:40:21.542464 140384619771328 basic_session_run_hooks.py:262] loss = 0.08110168, step = 30
I0815 00:40:21.545396 140384619771328 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:40:42.394661 140384619771328 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:40:42.395174 140384619771328 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:40:42.396684 140383723439872 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:40:42.396891 140383723439872 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:40:42.397064 140384619771328 error_handling.py:96] infeed marked as finished
I0815 00:40:42.397195 140384619771328 tpu_estimator.py:602] Stop output thread controller
I0815 00:40:42.397252 140384619771328 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:40:42.397403 140383715047168 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:40:42.397484 140383715047168 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:40:42.397608 140384619771328 error_handling.py:96] outfeed marked as finished
I0815 00:40:42.397697 140384619771328 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:40:42.517784 140383706654464 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:40:42.741017 140383706654464 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:41:12.881828 140384619771328 estimator.py:368] Loss for final step: 0.08110168.
I0815 00:41:12.882597 140384619771328 error_handling.py:96] training_loop marked as finished
I0815 00:41:13.623708 140384619771328 estimator.py:1145] Calling model_fn.
E0815 00:41:14.422898 140384619771328 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:41:14.657568 140384619771328 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:41:14.680131 140384619771328 estimator.py:1147] Done calling model_fn.
I0815 00:41:14.697390 140384619771328 evaluation.py:255] Starting evaluation at 2019-08-15T00:41:14Z
I0815 00:41:14.697638 140384619771328 tpu_estimator.py:499] TPU job name worker
I0815 00:41:14.776973 140384619771328 monitored_session.py:240] Graph was finalized.
W0815 00:41:14.777697 140384619771328 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:41:14.982036 140384619771328 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:41:17.773360 140384619771328 session_manager.py:500] Running local_init_op.
I0815 00:41:17.799550 140384619771328 session_manager.py:502] Done running local_init_op.
I0815 00:41:17.856736 140384619771328 tpu_estimator.py:557] Init TPU system
I0815 00:41:26.790621 140384619771328 tpu_estimator.py:566] Initialized TPU in 8 seconds
I0815 00:41:26.791476 140383720032000 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:41:26.791929 140383711639296 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:41:26.862793 140384619771328 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:41:26.889703 140384619771328 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:41:26.890032 140384619771328 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:41:26.996680 140383354877696 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:41:27.196162 140383354877696 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:41:27.681405 140383711639296 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:41:28.108201 140384619771328 evaluation.py:167] Evaluation [10/10]
I0815 00:41:28.108570 140384619771328 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:41:28.108648 140384619771328 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:41:28.108850 140383720032000 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:41:28.109082 140383720032000 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:41:28.109365 140384619771328 error_handling.py:96] infeed marked as finished
I0815 00:41:28.109585 140384619771328 tpu_estimator.py:602] Stop output thread controller
I0815 00:41:28.109703 140384619771328 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:41:28.109867 140383711639296 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:41:28.109960 140383711639296 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:41:28.110107 140384619771328 error_handling.py:96] outfeed marked as finished
I0815 00:41:28.110203 140384619771328 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:41:57.292462 140384619771328 evaluation.py:275] Finished evaluation at 2019-08-15-00:41:57
I0815 00:41:57.292797 140384619771328 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9764, global_step = 30, loss = 0.07259252
I0815 00:42:01.771877 140384619771328 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:42:02.615693 140384619771328 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07259252, 'global_step': 30, 'accuracy': 0.9764}

Removing gs://yangyou-mnist/log/#1565829581687243...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565829595073317...
Removing gs://yangyou-mnist/log/checkpoint#1565829638803104...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565829599696218...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565829581.v3-8-tpu#1565829642076651...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565829586921310...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565829628254260...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565829594132468...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565829629168590...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565829641014003...
Removing gs://yangyou-mnist/log/eval/#1565829719011178...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565829719.v3-8-tpu#1565829722307151...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:42:06.526302 139697657685440 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:42:06.527065 139697657685440 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:42:06.529751 139697657685440 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:42:06.530587 139697657685440 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:42:06.531153 139697657685440 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:42:06.531291 139697657685440 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:42:06.947864 139697657685440 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:42:06.955816 139697657685440 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:42:06.960086 139697657685440 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:42:07.016294 139697657685440 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:42:07.016628 139697657685440 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:42:07.283864 139697657685440 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:42:07.337789 139697657685440 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:42:07.338104 139697657685440 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:42:07.605503 139697657685440 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0dbf6c8290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0dc18a61d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:42:07.605895 139697657685440 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:42:07.927526 139697657685440 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:42:07.931005: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:42:07.951685 139697657685440 tpu_system_metadata.py:148] Found TPU system:
I0815 00:42:07.951994 139697657685440 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:42:07.952567 139697657685440 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:42:07.952627 139697657685440 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:42:07.952680 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:42:07.952984 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:42:07.953048 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:42:07.953099 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:42:07.953147 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:42:07.953196 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:42:07.953242 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:42:07.953289 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:42:07.953334 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:42:07.953387 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:42:07.953434 139697657685440 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:42:07.959569 139697657685440 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:42:07.972259 139697657685440 estimator.py:1145] Calling model_fn.
W0815 00:42:07.972975 139697657685440 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:42:08.237248 139697657685440 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:42:08.672717 139697657685440 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:42:08.735148 139697657685440 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:42:08.741166 139697657685440 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:42:08.921874 139697657685440 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:42:08.935846 139697657685440 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:42:08.948477 139697657685440 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:42:08.954107 139697657685440 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:42:08.959530 139697657685440 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:42:08.977233 139697657685440 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:42:08.977473 139697657685440 optimization.py:32] ++++++ warmup starts at step 0, for 8 steps ++++++
W0815 00:42:08.977606 139697657685440 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:42:09.087035 139697657685440 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:42:09.133174 139697657685440 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:42:09.178952 139697657685440 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:42:09.228831 139697657685440 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:42:09.401377 139697657685440 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:42:09.450210 139697657685440 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:42:09.497752 139697657685440 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:42:09.546454 139697657685440 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:42:09.590742 139697657685440 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:42:09.631460 139697657685440 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:42:09.648082 139697657685440 estimator.py:1147] Done calling model_fn.
I0815 00:42:14.353935 139697657685440 tpu_estimator.py:499] TPU job name worker
I0815 00:42:14.469773 139697657685440 monitored_session.py:240] Graph was finalized.
I0815 00:42:15.175549 139697657685440 session_manager.py:500] Running local_init_op.
I0815 00:42:15.225264 139697657685440 session_manager.py:502] Done running local_init_op.
I0815 00:42:17.812186 139697657685440 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:42:30.428299 139697657685440 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:42:30.575974 139697657685440 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:42:30.576481 139697657685440 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:42:30.576884: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:42:30.582248 139697657685440 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:42:30.584369 139697657685440 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:42:30.588349 139697657685440 tpu_estimator.py:557] Init TPU system
I0815 00:42:39.877928 139697657685440 tpu_estimator.py:566] Initialized TPU in 9 seconds
I0815 00:42:39.878993 139696621479680 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:42:39.879585 139696613086976 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:42:39.951441 139697657685440 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:42:39.952382 139697657685440 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 00:42:40.004385 139696604694272 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:42:40.305927 139696604694272 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:42:44.812987 139696613086976 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:42:49.344883 139697657685440 basic_session_run_hooks.py:262] loss = 0.079089016, step = 30
I0815 00:42:49.347501 139697657685440 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:43:02.833857 139697657685440 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:43:02.834232 139697657685440 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:43:02.835716 139696621479680 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:43:02.835886 139696621479680 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:43:02.836045 139697657685440 error_handling.py:96] infeed marked as finished
I0815 00:43:02.836203 139697657685440 tpu_estimator.py:602] Stop output thread controller
I0815 00:43:02.836283 139697657685440 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:43:02.836543 139696613086976 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:43:02.836709 139696613086976 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:43:02.836844 139697657685440 error_handling.py:96] outfeed marked as finished
I0815 00:43:02.836951 139697657685440 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:43:10.449229 139697657685440 estimator.py:368] Loss for final step: 0.079089016.
I0815 00:43:10.450113 139697657685440 error_handling.py:96] training_loop marked as finished
I0815 00:43:11.239835 139697657685440 estimator.py:1145] Calling model_fn.
E0815 00:43:11.919249 139697657685440 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:43:12.144789 139697657685440 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:43:12.166790 139697657685440 estimator.py:1147] Done calling model_fn.
I0815 00:43:12.183624 139697657685440 evaluation.py:255] Starting evaluation at 2019-08-15T00:43:12Z
I0815 00:43:12.183876 139697657685440 tpu_estimator.py:499] TPU job name worker
I0815 00:43:12.262516 139697657685440 monitored_session.py:240] Graph was finalized.
W0815 00:43:12.263324 139697657685440 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:43:12.463604 139697657685440 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:43:15.112807 139697657685440 session_manager.py:500] Running local_init_op.
I0815 00:43:15.137866 139697657685440 session_manager.py:502] Done running local_init_op.
I0815 00:43:15.193161 139697657685440 tpu_estimator.py:557] Init TPU system
I0815 00:43:26.867135 139697657685440 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0815 00:43:26.868057 139696621479680 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:43:26.868596 139696613086976 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:43:26.939434 139697657685440 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:43:26.970386 139697657685440 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:43:26.970750 139697657685440 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:43:27.060889 139696604694272 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:43:27.389019 139696604694272 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:43:27.729404 139696613086976 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:43:28.251151 139697657685440 evaluation.py:167] Evaluation [10/10]
I0815 00:43:28.251518 139697657685440 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:43:28.251590 139697657685440 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:43:28.251774 139696621479680 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:43:28.251979 139696621479680 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:43:28.252130 139697657685440 error_handling.py:96] infeed marked as finished
I0815 00:43:28.252240 139697657685440 tpu_estimator.py:602] Stop output thread controller
I0815 00:43:28.252358 139697657685440 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:43:28.252525 139696613086976 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:43:28.252602 139696613086976 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:43:28.252724 139697657685440 error_handling.py:96] outfeed marked as finished
I0815 00:43:28.252825 139697657685440 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:43:57.485965 139697657685440 evaluation.py:275] Finished evaluation at 2019-08-15-00:43:57
I0815 00:43:57.486337 139697657685440 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9751, global_step = 30, loss = 0.088248804
I0815 00:44:02.254683 139697657685440 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:44:03.212058 139697657685440 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.088248804, 'global_step': 30, 'accuracy': 0.9751}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565829745205976...
Removing gs://yangyou-mnist/log/#1565829731230947...
Removing gs://yangyou-mnist/log/checkpoint#1565829779181035...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565829737241499...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565829749920392...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565829776063417...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565829776926129...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565829731.v3-8-tpu#1565829782519678...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565829744216564...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565829781492437...
Removing gs://yangyou-mnist/log/eval/#1565829839402896...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565829839.v3-8-tpu#1565829842902713...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:44:07.131247 139651843904960 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:44:07.132069 139651843904960 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:44:07.134773 139651843904960 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:44:07.135612 139651843904960 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:44:07.136228 139651843904960 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:44:07.136358 139651843904960 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:44:07.559439 139651843904960 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:44:07.566824 139651843904960 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:44:07.570976 139651843904960 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:44:07.690026 139651843904960 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:44:07.690356 139651843904960 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:44:08.038121 139651843904960 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:44:08.157069 139651843904960 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:44:08.157394 139651843904960 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:44:08.463756 139651843904960 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f0314b44590>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f0316d39210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:44:08.464219 139651843904960 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:44:08.787415 139651843904960 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:44:08.790510: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:44:08.803975 139651843904960 tpu_system_metadata.py:148] Found TPU system:
I0815 00:44:08.804230 139651843904960 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:44:08.804955 139651843904960 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:44:08.805022 139651843904960 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:44:08.805075 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:44:08.805397 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:44:08.805453 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:44:08.805502 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:44:08.805574 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:44:08.805632 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:44:08.805679 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:44:08.805726 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:44:08.805772 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:44:08.805818 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:44:08.805866 139651843904960 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:44:08.812303 139651843904960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:44:08.825294 139651843904960 estimator.py:1145] Calling model_fn.
W0815 00:44:08.825937 139651843904960 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:44:09.119019 139651843904960 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:44:09.648308 139651843904960 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:44:09.711124 139651843904960 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:44:09.717693 139651843904960 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:44:09.900571 139651843904960 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:44:09.914782 139651843904960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:44:09.926805 139651843904960 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:44:09.932285 139651843904960 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:44:09.937714 139651843904960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:44:09.955322 139651843904960 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:44:09.955532 139651843904960 optimization.py:32] ++++++ warmup starts at step 0, for 8 steps ++++++
W0815 00:44:09.955674 139651843904960 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:44:10.067960 139651843904960 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:44:10.110061 139651843904960 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:44:10.155253 139651843904960 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:44:10.207087 139651843904960 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:44:10.376725 139651843904960 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:44:10.428325 139651843904960 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:44:10.477257 139651843904960 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:44:10.527915 139651843904960 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:44:10.574917 139651843904960 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:44:10.617877 139651843904960 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:44:10.634354 139651843904960 estimator.py:1147] Done calling model_fn.
I0815 00:44:14.302823 139651843904960 tpu_estimator.py:499] TPU job name worker
I0815 00:44:14.417117 139651843904960 monitored_session.py:240] Graph was finalized.
I0815 00:44:15.099245 139651843904960 session_manager.py:500] Running local_init_op.
I0815 00:44:15.161246 139651843904960 session_manager.py:502] Done running local_init_op.
I0815 00:44:17.867639 139651843904960 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:44:30.249445 139651843904960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:44:30.397793 139651843904960 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:44:30.398216 139651843904960 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:44:30.398617: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:44:30.404292 139651843904960 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:44:30.406550 139651843904960 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:44:30.410478 139651843904960 tpu_estimator.py:557] Init TPU system
I0815 00:44:41.693804 139651843904960 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0815 00:44:41.694669 139651081807616 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:44:41.695388 139651073414912 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:44:41.765613 139651843904960 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:44:41.766397 139651843904960 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 00:44:41.819629 139650593191680 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:44:42.192660 139650593191680 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:44:46.508848 139651073414912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:44:51.409703 139651843904960 basic_session_run_hooks.py:262] loss = 0.08234118, step = 30
I0815 00:44:51.412174 139651843904960 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:45:05.895970 139651843904960 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:45:05.896259 139651843904960 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:45:05.896629 139651081807616 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:45:05.896943 139651081807616 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:45:05.897176 139651843904960 error_handling.py:96] infeed marked as finished
I0815 00:45:05.897430 139651843904960 tpu_estimator.py:602] Stop output thread controller
I0815 00:45:05.897492 139651843904960 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:45:05.897665 139651073414912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:45:05.897828 139651073414912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:45:05.898015 139651843904960 error_handling.py:96] outfeed marked as finished
I0815 00:45:05.898154 139651843904960 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:45:12.337677 139651843904960 estimator.py:368] Loss for final step: 0.08234118.
I0815 00:45:12.338602 139651843904960 error_handling.py:96] training_loop marked as finished
I0815 00:45:13.062546 139651843904960 estimator.py:1145] Calling model_fn.
E0815 00:45:13.801800 139651843904960 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:45:14.025248 139651843904960 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:45:14.047156 139651843904960 estimator.py:1147] Done calling model_fn.
I0815 00:45:14.063940 139651843904960 evaluation.py:255] Starting evaluation at 2019-08-15T00:45:14Z
I0815 00:45:14.064177 139651843904960 tpu_estimator.py:499] TPU job name worker
I0815 00:45:14.145569 139651843904960 monitored_session.py:240] Graph was finalized.
W0815 00:45:14.146362 139651843904960 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:45:14.370634 139651843904960 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:45:17.002330 139651843904960 session_manager.py:500] Running local_init_op.
I0815 00:45:17.027909 139651843904960 session_manager.py:502] Done running local_init_op.
I0815 00:45:17.082942 139651843904960 tpu_estimator.py:557] Init TPU system
I0815 00:45:27.847402 139651843904960 tpu_estimator.py:566] Initialized TPU in 10 seconds
I0815 00:45:27.848433 139651078137600 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:45:27.849334 139650593191680 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:45:27.918946 139651843904960 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:45:27.946744 139651843904960 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:45:27.947141 139651843904960 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:45:28.050128 139650584798976 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:45:28.314560 139650584798976 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:45:28.764734 139650593191680 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:45:29.027338 139651843904960 evaluation.py:167] Evaluation [10/10]
I0815 00:45:29.027717 139651843904960 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:45:29.027789 139651843904960 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:45:29.028100 139651078137600 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:45:29.028429 139651078137600 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:45:29.028665 139651843904960 error_handling.py:96] infeed marked as finished
I0815 00:45:29.028853 139651843904960 tpu_estimator.py:602] Stop output thread controller
I0815 00:45:29.028918 139651843904960 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:45:29.029092 139650593191680 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:45:29.029263 139650593191680 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:45:29.029517 139651843904960 error_handling.py:96] outfeed marked as finished
I0815 00:45:29.029660 139651843904960 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:45:58.415591 139651843904960 evaluation.py:275] Finished evaluation at 2019-08-15-00:45:58
I0815 00:45:58.415981 139651843904960 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9782, global_step = 30, loss = 0.07694923
I0815 00:46:02.963040 139651843904960 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:46:03.805883 139651843904960 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07694923, 'global_step': 30, 'accuracy': 0.9782}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565829865186178...
Removing gs://yangyou-mnist/log/#1565829852244698...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565829869735548...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565829898314058...
Removing gs://yangyou-mnist/log/checkpoint#1565829901419840...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565829899183056...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565829857285916...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565829852.v3-8-tpu#1565829905586355...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565829864237795...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565829904614815...
Removing gs://yangyou-mnist/log/eval/#1565829960152317...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565829960.v3-8-tpu#1565829963492716...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:46:07.739691 139621295736256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:46:07.740534 139621295736256 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:46:07.743180 139621295736256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:46:07.744039 139621295736256 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:46:07.744728 139621295736256 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:46:07.744868 139621295736256 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:46:08.160980 139621295736256 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:46:08.167979 139621295736256 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:46:08.171916 139621295736256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:46:08.231548 139621295736256 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:46:08.231832 139621295736256 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:46:08.500933 139621295736256 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:46:08.621822 139621295736256 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:46:08.622086 139621295736256 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:46:08.976460 139621295736256 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7efbf7e5a1d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7efbfa038210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:46:08.976854 139621295736256 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:46:09.301232 139621295736256 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:46:09.303966: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:46:09.319020 139621295736256 tpu_system_metadata.py:148] Found TPU system:
I0815 00:46:09.319262 139621295736256 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:46:09.319741 139621295736256 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:46:09.319797 139621295736256 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:46:09.319858 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:46:09.320153 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:46:09.320210 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:46:09.320262 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:46:09.320311 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:46:09.320358 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:46:09.320445 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:46:09.320514 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:46:09.320563 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:46:09.320611 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:46:09.320660 139621295736256 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:46:09.326562 139621295736256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:46:09.339004 139621295736256 estimator.py:1145] Calling model_fn.
W0815 00:46:09.339627 139621295736256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:46:09.607357 139621295736256 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:46:10.042960 139621295736256 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:46:10.106189 139621295736256 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:46:10.112328 139621295736256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:46:10.307435 139621295736256 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:46:10.322689 139621295736256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:46:10.335629 139621295736256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:46:10.341620 139621295736256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:46:10.347275 139621295736256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:46:10.365505 139621295736256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:46:10.365739 139621295736256 optimization.py:32] ++++++ warmup starts at step 0, for 8 steps ++++++
W0815 00:46:10.365869 139621295736256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:46:10.477833 139621295736256 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:46:10.520018 139621295736256 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:46:10.565006 139621295736256 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:46:10.617604 139621295736256 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:46:10.778997 139621295736256 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:46:10.829457 139621295736256 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:46:10.878201 139621295736256 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:46:10.928679 139621295736256 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:46:10.975666 139621295736256 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:46:11.018466 139621295736256 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:46:11.035200 139621295736256 estimator.py:1147] Done calling model_fn.
I0815 00:46:14.627300 139621295736256 tpu_estimator.py:499] TPU job name worker
I0815 00:46:14.739352 139621295736256 monitored_session.py:240] Graph was finalized.
I0815 00:46:15.408674 139621295736256 session_manager.py:500] Running local_init_op.
I0815 00:46:15.463228 139621295736256 session_manager.py:502] Done running local_init_op.
I0815 00:46:18.235114 139621295736256 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:46:30.778992 139621295736256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:46:30.950716 139621295736256 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:46:30.951128 139621295736256 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:46:30.951507: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:46:30.957077 139621295736256 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:46:30.959213 139621295736256 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:46:30.962872 139621295736256 tpu_estimator.py:557] Init TPU system
I0815 00:46:42.860379 139621295736256 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0815 00:46:42.861430 139620259985152 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:46:42.862164 139620251592448 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:46:42.928880 139620243199744 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:46:42.929660 139621295736256 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:46:42.931020 139621295736256 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 00:46:43.206808 139620243199744 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:46:47.832921 139620251592448 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:46:52.489382 139621295736256 basic_session_run_hooks.py:262] loss = 0.06783343, step = 30
I0815 00:46:52.492252 139621295736256 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:47:05.993477 139621295736256 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:47:05.993765 139621295736256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:47:05.994083 139620259985152 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:47:05.994366 139620259985152 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:47:05.994693 139621295736256 error_handling.py:96] infeed marked as finished
I0815 00:47:05.994915 139621295736256 tpu_estimator.py:602] Stop output thread controller
I0815 00:47:05.994976 139621295736256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:47:05.995146 139620251592448 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:47:05.995307 139620251592448 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:47:05.995579 139621295736256 error_handling.py:96] outfeed marked as finished
I0815 00:47:05.995819 139621295736256 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:47:13.353759 139621295736256 estimator.py:368] Loss for final step: 0.06783343.
I0815 00:47:13.354583 139621295736256 error_handling.py:96] training_loop marked as finished
I0815 00:47:14.177139 139621295736256 estimator.py:1145] Calling model_fn.
E0815 00:47:14.857460 139621295736256 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:47:15.082638 139621295736256 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:47:15.105406 139621295736256 estimator.py:1147] Done calling model_fn.
I0815 00:47:15.122323 139621295736256 evaluation.py:255] Starting evaluation at 2019-08-15T00:47:15Z
I0815 00:47:15.122622 139621295736256 tpu_estimator.py:499] TPU job name worker
I0815 00:47:15.207026 139621295736256 monitored_session.py:240] Graph was finalized.
W0815 00:47:15.207776 139621295736256 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:47:15.414544 139621295736256 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:47:18.207868 139621295736256 session_manager.py:500] Running local_init_op.
I0815 00:47:18.238923 139621295736256 session_manager.py:502] Done running local_init_op.
I0815 00:47:18.291589 139621295736256 tpu_estimator.py:557] Init TPU system
I0815 00:47:29.669595 139621295736256 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0815 00:47:29.670553 139620259985152 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:47:29.671818 139620251592448 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:47:29.741461 139621295736256 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:47:29.770284 139621295736256 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:47:29.770648 139621295736256 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:47:29.810508 139620243199744 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:47:30.094935 139620243199744 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:47:30.556603 139620251592448 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:47:30.996299 139621295736256 evaluation.py:167] Evaluation [10/10]
I0815 00:47:30.996732 139621295736256 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:47:30.996818 139621295736256 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:47:30.997087 139620259985152 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:47:30.997356 139620259985152 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:47:30.997560 139621295736256 error_handling.py:96] infeed marked as finished
I0815 00:47:30.997816 139621295736256 tpu_estimator.py:602] Stop output thread controller
I0815 00:47:30.997874 139621295736256 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:47:30.998030 139620251592448 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:47:30.998167 139620251592448 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:47:30.998320 139621295736256 error_handling.py:96] outfeed marked as finished
I0815 00:47:30.998450 139621295736256 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:48:00.199395 139621295736256 evaluation.py:275] Finished evaluation at 2019-08-15-00:48:00
I0815 00:48:00.199816 139621295736256 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9836, global_step = 30, loss = 0.047744825
I0815 00:48:04.518182 139621295736256 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:48:05.301299 139621295736256 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.047744825, 'global_step': 30, 'accuracy': 0.9836}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565829985816338...
Removing gs://yangyou-mnist/log/#1565829972593483...
Removing gs://yangyou-mnist/log/checkpoint#1565830022462776...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565829972.v3-8-tpu#1565830025686949...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565829977652113...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565829990251164...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565829984845183...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565830020157011...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565830019268375...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565830024741974...
Removing gs://yangyou-mnist/log/eval/#1565830081882286...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565830082.v3-8-tpu#1565830084994999...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:48:09.176172 140155192956352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:48:09.177088 140155192956352 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:48:09.179657 140155192956352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:48:09.180605 140155192956352 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:48:09.181185 140155192956352 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:48:09.181308 140155192956352 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:48:09.588834 140155192956352 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:48:09.596497 140155192956352 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:48:09.600215 140155192956352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:48:09.716150 140155192956352 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:48:09.716459 140155192956352 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:48:10.084666 140155192956352 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:48:10.159534 140155192956352 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:48:10.159825 140155192956352 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:48:10.483977 140155192956352 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f7846a6b150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f7848c49210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:48:10.484394 140155192956352 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:48:10.801031 140155192956352 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:48:10.803798: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:48:10.817312 140155192956352 tpu_system_metadata.py:148] Found TPU system:
I0815 00:48:10.817548 140155192956352 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:48:10.818032 140155192956352 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:48:10.818099 140155192956352 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:48:10.818157 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:48:10.818438 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:48:10.818494 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:48:10.818542 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:48:10.818609 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:48:10.818659 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:48:10.818703 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:48:10.818749 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:48:10.818794 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:48:10.818840 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:48:10.818902 140155192956352 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:48:10.824846 140155192956352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:48:10.837346 140155192956352 estimator.py:1145] Calling model_fn.
W0815 00:48:10.837961 140155192956352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:48:11.114252 140155192956352 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:48:11.536592 140155192956352 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:48:11.598321 140155192956352 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:48:11.604352 140155192956352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:48:11.785387 140155192956352 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:48:11.799148 140155192956352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:48:11.811024 140155192956352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:48:11.816392 140155192956352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:48:11.821662 140155192956352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:48:11.839076 140155192956352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:48:11.839301 140155192956352 optimization.py:32] ++++++ warmup starts at step 0, for 8 steps ++++++
W0815 00:48:11.839423 140155192956352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:48:11.948699 140155192956352 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:48:11.990320 140155192956352 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:48:12.033832 140155192956352 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:48:12.091670 140155192956352 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:48:12.252226 140155192956352 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:48:12.303193 140155192956352 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:48:12.351381 140155192956352 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:48:12.401949 140155192956352 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:48:12.448613 140155192956352 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:48:12.489763 140155192956352 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:48:12.505996 140155192956352 estimator.py:1147] Done calling model_fn.
I0815 00:48:15.923016 140155192956352 tpu_estimator.py:499] TPU job name worker
I0815 00:48:16.030842 140155192956352 monitored_session.py:240] Graph was finalized.
I0815 00:48:16.695045 140155192956352 session_manager.py:500] Running local_init_op.
I0815 00:48:16.749418 140155192956352 session_manager.py:502] Done running local_init_op.
I0815 00:48:19.520505 140155192956352 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:48:32.196989 140155192956352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:48:32.361051 140155192956352 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:48:32.361510 140155192956352 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:48:32.361924: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:48:32.366965 140155192956352 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:48:32.369107 140155192956352 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:48:32.373408 140155192956352 tpu_estimator.py:557] Init TPU system
I0815 00:48:44.185556 140155192956352 tpu_estimator.py:566] Initialized TPU in 11 seconds
I0815 00:48:44.186793 140154295539456 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:48:44.187663 140154287146752 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:48:44.252804 140154278754048 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:48:44.253571 140155192956352 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:48:44.254493 140155192956352 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 00:48:44.592843 140154278754048 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:48:48.959458 140154287146752 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:48:53.697582 140155192956352 basic_session_run_hooks.py:262] loss = 0.07196966, step = 30
I0815 00:48:53.700489 140155192956352 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:49:07.406452 140155192956352 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:49:07.406738 140155192956352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:49:07.406948 140154295539456 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:49:07.407072 140154295539456 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:49:07.407217 140155192956352 error_handling.py:96] infeed marked as finished
I0815 00:49:07.407336 140155192956352 tpu_estimator.py:602] Stop output thread controller
I0815 00:49:07.407387 140155192956352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:49:07.407499 140154287146752 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:49:07.407571 140154287146752 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:49:07.407681 140155192956352 error_handling.py:96] outfeed marked as finished
I0815 00:49:07.407784 140155192956352 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:49:14.716842 140155192956352 estimator.py:368] Loss for final step: 0.07196966.
I0815 00:49:14.717554 140155192956352 error_handling.py:96] training_loop marked as finished
I0815 00:49:15.514331 140155192956352 estimator.py:1145] Calling model_fn.
E0815 00:49:16.212600 140155192956352 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:49:16.436059 140155192956352 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:49:16.457844 140155192956352 estimator.py:1147] Done calling model_fn.
I0815 00:49:16.474358 140155192956352 evaluation.py:255] Starting evaluation at 2019-08-15T00:49:16Z
I0815 00:49:16.474596 140155192956352 tpu_estimator.py:499] TPU job name worker
I0815 00:49:16.553026 140155192956352 monitored_session.py:240] Graph was finalized.
W0815 00:49:16.553803 140155192956352 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:49:16.765577 140155192956352 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:49:19.632821 140155192956352 session_manager.py:500] Running local_init_op.
I0815 00:49:19.658524 140155192956352 session_manager.py:502] Done running local_init_op.
I0815 00:49:19.706609 140155192956352 tpu_estimator.py:557] Init TPU system
I0815 00:49:31.929142 140155192956352 tpu_estimator.py:566] Initialized TPU in 12 seconds
I0815 00:49:31.930078 140154292918016 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:49:31.931083 140154284525312 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:49:32.003429 140155192956352 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:49:32.030199 140155192956352 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:49:32.030553 140155192956352 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:49:32.068514 140154276132608 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:49:32.347434 140154276132608 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:49:32.824582 140154284525312 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:49:33.184051 140155192956352 evaluation.py:167] Evaluation [10/10]
I0815 00:49:33.184385 140155192956352 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:49:33.184520 140155192956352 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:49:33.184778 140154292918016 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:49:33.185070 140154292918016 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:49:33.185309 140155192956352 error_handling.py:96] infeed marked as finished
I0815 00:49:33.185517 140155192956352 tpu_estimator.py:602] Stop output thread controller
I0815 00:49:33.185600 140155192956352 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:49:33.185832 140154284525312 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:49:33.185977 140154284525312 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:49:33.186151 140155192956352 error_handling.py:96] outfeed marked as finished
I0815 00:49:33.186292 140155192956352 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:50:02.447520 140155192956352 evaluation.py:275] Finished evaluation at 2019-08-15-00:50:02
I0815 00:50:02.447940 140155192956352 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9802, global_step = 30, loss = 0.06109934
I0815 00:50:06.907639 140155192956352 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:50:07.738116 140155192956352 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06109934, 'global_step': 30, 'accuracy': 0.9802}

Removing gs://yangyou-mnist/log/#1565830094025903...
Removing gs://yangyou-mnist/log/checkpoint#1565830143998274...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565830094.v3-8-tpu#1565830147096698...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565830098911667...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565830106035476...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565830106923415...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565830141795385...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565830140913108...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565830111681192...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565830146180743...
Removing gs://yangyou-mnist/log/eval/#1565830204143187...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565830204.v3-8-tpu#1565830207425717...
/ [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:50:11.776312 140687269807552 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:50:11.777160 140687269807552 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:50:11.780255 140687269807552 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:50:11.781691 140687269807552 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:50:11.782326 140687269807552 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:50:11.782485 140687269807552 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:50:12.218106 140687269807552 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:50:12.227035 140687269807552 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:50:12.231653 140687269807552 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:50:12.349755 140687269807552 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:50:12.350054 140687269807552 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:50:12.626199 140687269807552 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:50:12.680685 140687269807552 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:50:12.680994 140687269807552 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:50:13.040394 140687269807552 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7ff428e72210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7ff42b050210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:50:13.040862 140687269807552 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:50:13.368305 140687269807552 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:50:13.371326: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:50:13.385598 140687269807552 tpu_system_metadata.py:148] Found TPU system:
I0815 00:50:13.385868 140687269807552 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:50:13.386441 140687269807552 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:50:13.386502 140687269807552 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:50:13.386554 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:50:13.386843 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:50:13.386929 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:50:13.386981 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:50:13.387031 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:50:13.387084 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:50:13.387130 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:50:13.387176 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:50:13.387223 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:50:13.387275 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:50:13.387325 140687269807552 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:50:13.393532 140687269807552 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:50:13.406029 140687269807552 estimator.py:1145] Calling model_fn.
W0815 00:50:13.406651 140687269807552 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:50:13.726725 140687269807552 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:50:14.137940 140687269807552 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:50:14.205941 140687269807552 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:50:14.211818 140687269807552 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:50:14.391716 140687269807552 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:50:14.405164 140687269807552 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:50:14.416887 140687269807552 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:50:14.422262 140687269807552 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:50:14.427448 140687269807552 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:50:14.444549 140687269807552 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:50:14.444777 140687269807552 optimization.py:32] ++++++ warmup starts at step 0, for 8 steps ++++++
W0815 00:50:14.444900 140687269807552 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:50:14.552083 140687269807552 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:50:14.593126 140687269807552 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:50:14.636307 140687269807552 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:50:14.686470 140687269807552 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:50:14.856992 140687269807552 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:50:14.906069 140687269807552 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:50:14.952940 140687269807552 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:50:15.001611 140687269807552 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:50:15.046001 140687269807552 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:50:15.086901 140687269807552 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:50:15.102993 140687269807552 estimator.py:1147] Done calling model_fn.
I0815 00:50:18.583400 140687269807552 tpu_estimator.py:499] TPU job name worker
I0815 00:50:18.709455 140687269807552 monitored_session.py:240] Graph was finalized.
I0815 00:50:19.375600 140687269807552 session_manager.py:500] Running local_init_op.
I0815 00:50:19.439372 140687269807552 session_manager.py:502] Done running local_init_op.
I0815 00:50:22.252729 140687269807552 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:50:37.545593 140687269807552 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:50:37.699237 140687269807552 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:50:37.699681 140687269807552 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:50:37.700155: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:50:37.705485 140687269807552 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:50:37.707601 140687269807552 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:50:37.711970 140687269807552 tpu_estimator.py:557] Init TPU system
I0815 00:51:16.037792 140687269807552 tpu_estimator.py:566] Initialized TPU in 38 seconds
I0815 00:51:16.038806 140686507878144 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:51:16.039580 140686499485440 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:51:16.102520 140686015854336 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:51:16.108340 140687269807552 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:51:16.109332 140687269807552 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 00:51:16.398572 140686015854336 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:51:20.933548 140686499485440 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:51:25.345701 140687269807552 basic_session_run_hooks.py:262] loss = 0.087388605, step = 30
I0815 00:51:25.348185 140687269807552 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:51:43.428384 140687269807552 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:51:43.428765 140687269807552 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:51:43.429086 140686507878144 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:51:43.429378 140686507878144 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:51:43.429563 140687269807552 error_handling.py:96] infeed marked as finished
I0815 00:51:43.429733 140687269807552 tpu_estimator.py:602] Stop output thread controller
I0815 00:51:43.429789 140687269807552 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:51:43.430001 140686499485440 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:51:43.430196 140686499485440 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:51:43.430382 140687269807552 error_handling.py:96] outfeed marked as finished
I0815 00:51:43.430520 140687269807552 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:51:46.537636 140687269807552 estimator.py:368] Loss for final step: 0.087388605.
I0815 00:51:46.538532 140687269807552 error_handling.py:96] training_loop marked as finished
I0815 00:51:47.378195 140687269807552 estimator.py:1145] Calling model_fn.
E0815 00:51:48.083136 140687269807552 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:51:48.318929 140687269807552 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:51:48.340742 140687269807552 estimator.py:1147] Done calling model_fn.
I0815 00:51:48.357141 140687269807552 evaluation.py:255] Starting evaluation at 2019-08-15T00:51:48Z
I0815 00:51:48.357408 140687269807552 tpu_estimator.py:499] TPU job name worker
I0815 00:51:48.435255 140687269807552 monitored_session.py:240] Graph was finalized.
W0815 00:51:48.435971 140687269807552 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:51:48.663578 140687269807552 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:51:51.363215 140687269807552 session_manager.py:500] Running local_init_op.
I0815 00:51:51.388875 140687269807552 session_manager.py:502] Done running local_init_op.
I0815 00:51:51.437508 140687269807552 tpu_estimator.py:557] Init TPU system
I0815 00:53:00.060863 140687269807552 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:53:00.061801 140686504208128 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:53:00.062288 140686015854336 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:53:00.133254 140687269807552 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:53:00.161489 140687269807552 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:53:00.161848 140687269807552 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:53:00.198329 140686007461632 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:53:00.523364 140686007461632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:53:00.931432 140686015854336 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:53:01.337810 140687269807552 evaluation.py:167] Evaluation [10/10]
I0815 00:53:01.338157 140687269807552 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:53:01.338247 140687269807552 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:53:01.338447 140686504208128 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:53:01.338542 140686504208128 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:53:01.338728 140687269807552 error_handling.py:96] infeed marked as finished
I0815 00:53:01.338824 140687269807552 tpu_estimator.py:602] Stop output thread controller
I0815 00:53:01.338892 140687269807552 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:53:01.339005 140686015854336 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:53:01.339091 140686015854336 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:53:01.339207 140687269807552 error_handling.py:96] outfeed marked as finished
I0815 00:53:01.339297 140687269807552 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:53:30.616592 140687269807552 evaluation.py:275] Finished evaluation at 2019-08-15-00:53:30
I0815 00:53:30.616940 140687269807552 estimator.py:2039] Saving dict for global step 30: accuracy = 0.977, global_step = 30, loss = 0.078708805
I0815 00:53:35.210073 140687269807552 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:53:36.120650 140687269807552 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.078708805, 'global_step': 30, 'accuracy': 0.977}

Removing gs://yangyou-mnist/log/#1565830216662652...
Removing gs://yangyou-mnist/log/checkpoint#1565830299948550...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565830216.v3-8-tpu#1565830303125884...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565830221627377...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565830231505925...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565830295322545...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565830232337752...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565830296208821...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565830237023084...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565830302065357...
Removing gs://yangyou-mnist/log/eval/#1565830412355061...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565830412.v3-8-tpu#1565830415812890...
/ [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:53:39.966443 140320939656640 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:53:39.967217 140320939656640 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:53:39.969851 140320939656640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:53:39.970702 140320939656640 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:53:39.971301 140320939656640 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:53:39.971438 140320939656640 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:53:40.396377 140320939656640 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:53:40.403259 140320939656640 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:53:40.407428 140320939656640 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:53:40.458535 140320939656640 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:53:40.458822 140320939656640 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:53:40.811319 140320939656640 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:53:40.865364 140320939656640 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:53:40.865653 140320939656640 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:53:41.274490 140320939656640 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f9eddeca0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f9ee00a8210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:53:41.274852 140320939656640 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:53:41.613502 140320939656640 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:53:41.616429: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:53:41.630722 140320939656640 tpu_system_metadata.py:148] Found TPU system:
I0815 00:53:41.630961 140320939656640 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:53:41.631546 140320939656640 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:53:41.631613 140320939656640 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:53:41.631668 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:53:41.631961 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:53:41.632019 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:53:41.632077 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:53:41.632127 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:53:41.632174 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:53:41.632236 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:53:41.632291 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:53:41.632338 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:53:41.632385 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:53:41.632502 140320939656640 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:53:41.638890 140320939656640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:53:41.651861 140320939656640 estimator.py:1145] Calling model_fn.
W0815 00:53:41.652512 140320939656640 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:53:41.918457 140320939656640 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:53:42.421247 140320939656640 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:53:42.484527 140320939656640 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:53:42.490475 140320939656640 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:53:42.674099 140320939656640 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:53:42.688184 140320939656640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:53:42.700789 140320939656640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:53:42.706581 140320939656640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:53:42.712276 140320939656640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:53:42.730206 140320939656640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:53:42.730451 140320939656640 optimization.py:32] ++++++ warmup starts at step 0, for 8 steps ++++++
W0815 00:53:42.730585 140320939656640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:53:42.840854 140320939656640 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:53:42.883436 140320939656640 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:53:42.929404 140320939656640 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:53:42.982388 140320939656640 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:53:43.150749 140320939656640 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:53:43.202200 140320939656640 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:53:43.252285 140320939656640 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:53:43.303544 140320939656640 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:53:43.349785 140320939656640 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:53:43.391988 140320939656640 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:53:43.408585 140320939656640 estimator.py:1147] Done calling model_fn.
I0815 00:53:46.975528 140320939656640 tpu_estimator.py:499] TPU job name worker
I0815 00:53:47.087013 140320939656640 monitored_session.py:240] Graph was finalized.
I0815 00:53:47.831847 140320939656640 session_manager.py:500] Running local_init_op.
I0815 00:53:47.885749 140320939656640 session_manager.py:502] Done running local_init_op.
I0815 00:53:50.666733 140320939656640 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:54:03.189879 140320939656640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:54:03.363291 140320939656640 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:54:03.363790 140320939656640 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:54:03.364217: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:54:03.369041 140320939656640 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:54:03.371500 140320939656640 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:54:03.375709 140320939656640 tpu_estimator.py:557] Init TPU system
I0815 00:54:44.132225 140320939656640 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 00:54:44.133388 140320043419392 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:54:44.134217 140320035026688 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:54:44.204629 140320939656640 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:54:44.205543 140320939656640 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 00:54:44.257733 140320026633984 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:54:44.675860 140320026633984 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:54:49.090250 140320035026688 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:54:53.887232 140320939656640 basic_session_run_hooks.py:262] loss = 0.13195942, step = 30
I0815 00:54:53.890103 140320939656640 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:55:07.450618 140320939656640 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:55:07.450906 140320939656640 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:55:07.451236 140320043419392 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:55:07.451529 140320043419392 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:55:07.451812 140320939656640 error_handling.py:96] infeed marked as finished
I0815 00:55:07.452022 140320939656640 tpu_estimator.py:602] Stop output thread controller
I0815 00:55:07.452076 140320939656640 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:55:07.452241 140320035026688 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:55:07.452435 140320035026688 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:55:07.452605 140320939656640 error_handling.py:96] outfeed marked as finished
I0815 00:55:07.452826 140320939656640 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:55:14.825792 140320939656640 estimator.py:368] Loss for final step: 0.13195942.
I0815 00:55:14.826699 140320939656640 error_handling.py:96] training_loop marked as finished
I0815 00:55:15.638170 140320939656640 estimator.py:1145] Calling model_fn.
E0815 00:55:16.335205 140320939656640 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:55:16.568479 140320939656640 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:55:16.591909 140320939656640 estimator.py:1147] Done calling model_fn.
I0815 00:55:16.609448 140320939656640 evaluation.py:255] Starting evaluation at 2019-08-15T00:55:16Z
I0815 00:55:16.609688 140320939656640 tpu_estimator.py:499] TPU job name worker
I0815 00:55:16.691346 140320939656640 monitored_session.py:240] Graph was finalized.
W0815 00:55:16.692121 140320939656640 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:55:16.898821 140320939656640 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:55:19.707837 140320939656640 session_manager.py:500] Running local_init_op.
I0815 00:55:19.734002 140320939656640 session_manager.py:502] Done running local_init_op.
I0815 00:55:19.795433 140320939656640 tpu_estimator.py:557] Init TPU system
I0815 00:56:28.073841 140320939656640 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:56:28.074955 140320039749376 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:56:28.075927 140320031356672 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:56:28.142532 140320939656640 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:56:28.173671 140320939656640 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:56:28.174062 140320939656640 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:56:28.207747 140320017979136 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:56:28.538201 140320017979136 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:56:29.001856 140320031356672 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:56:29.244216 140320939656640 evaluation.py:167] Evaluation [10/10]
I0815 00:56:29.244590 140320939656640 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:56:29.244673 140320939656640 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:56:29.245008 140320039749376 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:56:29.245291 140320039749376 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:56:29.245563 140320939656640 error_handling.py:96] infeed marked as finished
I0815 00:56:29.246131 140320939656640 tpu_estimator.py:602] Stop output thread controller
I0815 00:56:29.246248 140320939656640 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:56:29.246464 140320031356672 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:56:29.246637 140320031356672 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:56:29.246833 140320939656640 error_handling.py:96] outfeed marked as finished
I0815 00:56:29.246992 140320939656640 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:56:58.639915 140320939656640 evaluation.py:275] Finished evaluation at 2019-08-15-00:56:58
I0815 00:56:58.640263 140320939656640 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9715, global_step = 30, loss = 0.1069446
I0815 00:57:03.189044 140320939656640 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 00:57:03.948637 140320939656640 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.1069446, 'global_step': 30, 'accuracy': 0.9715}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565830438117094...
Removing gs://yangyou-mnist/log/#1565830424939696...
Removing gs://yangyou-mnist/log/checkpoint#1565830503901306...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565830442676843...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565830425.v3-8-tpu#1565830507147031...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565830500799006...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565830430090852...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565830501657438...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565830437247789...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565830506165800...
Removing gs://yangyou-mnist/log/eval/#1565830620325487...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565830620.v3-8-tpu#1565830623641664...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 00:57:07.750711 140137295173056 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 00:57:07.751492 140137295173056 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 00:57:07.754095 140137295173056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 00:57:07.754951 140137295173056 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 00:57:07.755558 140137295173056 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 00:57:07.755686 140137295173056 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 00:57:08.168066 140137295173056 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 00:57:08.175992 140137295173056 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 00:57:08.180355 140137295173056 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:57:08.298248 140137295173056 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:57:08.298556 140137295173056 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:57:08.534956 140137295173056 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 00:57:08.585731 140137295173056 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 00:57:08.586009 140137295173056 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:57:08.794811 140137295173056 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f741bdc31d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f741dfa1210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 00:57:08.795147 140137295173056 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 00:57:09.130639 140137295173056 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 00:57:09.133564: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:57:09.146881 140137295173056 tpu_system_metadata.py:148] Found TPU system:
I0815 00:57:09.147113 140137295173056 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 00:57:09.147584 140137295173056 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 00:57:09.147644 140137295173056 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 00:57:09.147696 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 00:57:09.147979 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 00:57:09.148035 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 00:57:09.148092 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 00:57:09.148142 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 00:57:09.148190 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 00:57:09.148236 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 00:57:09.148282 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 00:57:09.148341 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 00:57:09.148389 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 00:57:09.148494 140137295173056 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 00:57:09.154540 140137295173056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 00:57:09.167161 140137295173056 estimator.py:1145] Calling model_fn.
W0815 00:57:09.167766 140137295173056 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 00:57:09.434180 140137295173056 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 00:57:09.856890 140137295173056 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 00:57:09.918231 140137295173056 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 00:57:09.924526 140137295173056 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:57:10.107002 140137295173056 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 00:57:10.120660 140137295173056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 00:57:10.132807 140137295173056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 00:57:10.138257 140137295173056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 00:57:10.143621 140137295173056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 00:57:10.161183 140137295173056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 00:57:10.161408 140137295173056 optimization.py:32] ++++++ warmup starts at step 0, for 8 steps ++++++
W0815 00:57:10.161539 140137295173056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 00:57:10.272233 140137295173056 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 00:57:10.315242 140137295173056 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:57:10.359958 140137295173056 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:57:10.410506 140137295173056 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:57:10.584099 140137295173056 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:57:10.635476 140137295173056 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:57:10.684338 140137295173056 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:57:10.734694 140137295173056 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:57:10.780756 140137295173056 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 00:57:10.821516 140137295173056 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 00:57:10.837673 140137295173056 estimator.py:1147] Done calling model_fn.
I0815 00:57:14.362768 140137295173056 tpu_estimator.py:499] TPU job name worker
I0815 00:57:14.474062 140137295173056 monitored_session.py:240] Graph was finalized.
I0815 00:57:15.144314 140137295173056 session_manager.py:500] Running local_init_op.
I0815 00:57:15.196754 140137295173056 session_manager.py:502] Done running local_init_op.
I0815 00:57:20.769145 140137295173056 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 00:57:33.202552 140137295173056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 00:57:33.372814 140137295173056 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:57:33.373234 140137295173056 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 00:57:33.373667: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 00:57:33.378221 140137295173056 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 00:57:33.380390 140137295173056 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 00:57:33.384315 140137295173056 tpu_estimator.py:557] Init TPU system
I0815 00:58:12.112622 140137295173056 tpu_estimator.py:566] Initialized TPU in 38 seconds
I0815 00:58:12.113503 140136260040448 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:58:12.114093 140136251647744 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:58:12.177499 140136243255040 transport.py:157] Attempting refresh to obtain initial access_token
I0815 00:58:12.185280 140137295173056 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 00:58:12.186120 140137295173056 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 00:58:12.480220 140136243255040 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:58:16.984055 140136251647744 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:58:21.631547 140137295173056 basic_session_run_hooks.py:262] loss = 0.077011906, step = 30
I0815 00:58:21.633898 140137295173056 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 00:58:39.420160 140137295173056 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:58:39.420531 140137295173056 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:58:39.421950 140136260040448 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:58:39.422118 140136260040448 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:58:39.422369 140137295173056 error_handling.py:96] infeed marked as finished
I0815 00:58:39.422523 140137295173056 tpu_estimator.py:602] Stop output thread controller
I0815 00:58:39.422611 140137295173056 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:58:39.422899 140136251647744 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:58:39.422996 140136251647744 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:58:39.423127 140137295173056 error_handling.py:96] outfeed marked as finished
I0815 00:58:39.423222 140137295173056 tpu_estimator.py:606] Shutdown TPU system.
I0815 00:58:42.622072 140137295173056 estimator.py:368] Loss for final step: 0.077011906.
I0815 00:58:42.622961 140137295173056 error_handling.py:96] training_loop marked as finished
I0815 00:58:43.344086 140137295173056 estimator.py:1145] Calling model_fn.
E0815 00:58:44.139694 140137295173056 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 00:58:44.372004 140137295173056 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 00:58:44.393876 140137295173056 estimator.py:1147] Done calling model_fn.
I0815 00:58:44.409778 140137295173056 evaluation.py:255] Starting evaluation at 2019-08-15T00:58:44Z
I0815 00:58:44.410026 140137295173056 tpu_estimator.py:499] TPU job name worker
I0815 00:58:44.485044 140137295173056 monitored_session.py:240] Graph was finalized.
W0815 00:58:44.485843 140137295173056 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 00:58:44.691062 140137295173056 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 00:58:47.299206 140137295173056 session_manager.py:500] Running local_init_op.
I0815 00:58:47.324318 140137295173056 session_manager.py:502] Done running local_init_op.
I0815 00:58:47.375977 140137295173056 tpu_estimator.py:557] Init TPU system
I0815 00:59:56.046277 140137295173056 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 00:59:56.047240 140136260040448 tpu_estimator.py:514] Starting infeed thread controller.
I0815 00:59:56.047712 140136251647744 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 00:59:56.116900 140137295173056 util.py:98] Initialized dataset iterators in 0 seconds
I0815 00:59:56.187711 140137295173056 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 00:59:56.188049 140137295173056 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 00:59:56.226576 140136243255040 transport.py:157] Attempting refresh to obtain initial access_token
W0815 00:59:56.516556 140136243255040 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 00:59:56.975344 140136251647744 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 00:59:57.282659 140137295173056 evaluation.py:167] Evaluation [10/10]
I0815 00:59:57.282968 140137295173056 tpu_estimator.py:598] Stop infeed thread controller
I0815 00:59:57.283036 140137295173056 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 00:59:57.283245 140136260040448 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 00:59:57.283351 140136260040448 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 00:59:57.283488 140137295173056 error_handling.py:96] infeed marked as finished
I0815 00:59:57.283581 140137295173056 tpu_estimator.py:602] Stop output thread controller
I0815 00:59:57.283629 140137295173056 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 00:59:57.283845 140136251647744 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 00:59:57.283942 140136251647744 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 00:59:57.284071 140137295173056 error_handling.py:96] outfeed marked as finished
I0815 00:59:57.284151 140137295173056 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:00:26.616101 140137295173056 evaluation.py:275] Finished evaluation at 2019-08-15-01:00:26
I0815 01:00:26.616468 140137295173056 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9806, global_step = 30, loss = 0.061552487
I0815 01:00:31.679609 140137295173056 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:00:32.520040 140137295173056 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.061552487, 'global_step': 30, 'accuracy': 0.9806}

Removing gs://yangyou-mnist/log/#1565830632410310...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565830648065441...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565830652685521...
Removing gs://yangyou-mnist/log/checkpoint#1565830715734813...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565830712504752...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565830632.v3-8-tpu#1565830719111283...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565830713365345...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565830640188364...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565830647172966...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565830718125712...
Removing gs://yangyou-mnist/log/eval/#1565830828285344...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565830828.v3-8-tpu#1565830832214675...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:00:36.335690 140253840389568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:00:36.336677 140253840389568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:00:36.339297 140253840389568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:00:36.340131 140253840389568 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:00:36.340744 140253840389568 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:00:36.340878 140253840389568 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:00:36.750824 140253840389568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:00:36.760138 140253840389568 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:00:36.764786 140253840389568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:00:36.820995 140253840389568 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:00:36.821278 140253840389568 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:00:37.102891 140253840389568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:00:37.155419 140253840389568 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:00:37.155688 140253840389568 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:00:37.528506 140253840389568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8f3e7f1110>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8f409cf210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:00:37.528841 140253840389568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:00:37.859607 140253840389568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:00:37.862453: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:00:37.876378 140253840389568 tpu_system_metadata.py:148] Found TPU system:
I0815 01:00:37.876661 140253840389568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:00:37.877151 140253840389568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:00:37.877232 140253840389568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:00:37.877285 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:00:37.877576 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:00:37.877635 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:00:37.877687 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:00:37.877737 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:00:37.877784 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:00:37.877831 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:00:37.877878 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:00:37.877926 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:00:37.877973 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:00:37.878021 140253840389568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:00:37.883907 140253840389568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:00:37.896609 140253840389568 estimator.py:1145] Calling model_fn.
W0815 01:00:37.897207 140253840389568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:00:38.166816 140253840389568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:00:38.581945 140253840389568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:00:38.642622 140253840389568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:00:38.648538 140253840389568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:00:38.837968 140253840389568 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:00:38.851347 140253840389568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:00:38.863068 140253840389568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:00:38.868580 140253840389568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:00:38.873889 140253840389568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:00:38.890799 140253840389568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:00:38.891016 140253840389568 optimization.py:32] ++++++ warmup starts at step 0, for 9 steps ++++++
W0815 01:00:38.891149 140253840389568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:00:38.998759 140253840389568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:00:39.039555 140253840389568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:00:39.082782 140253840389568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:00:39.133465 140253840389568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:00:39.291480 140253840389568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:00:39.340717 140253840389568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:00:39.390687 140253840389568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:00:39.441473 140253840389568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:00:39.486468 140253840389568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:00:39.527563 140253840389568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:00:39.543639 140253840389568 estimator.py:1147] Done calling model_fn.
I0815 01:00:43.057460 140253840389568 tpu_estimator.py:499] TPU job name worker
I0815 01:00:43.168582 140253840389568 monitored_session.py:240] Graph was finalized.
I0815 01:00:43.853514 140253840389568 session_manager.py:500] Running local_init_op.
I0815 01:00:43.904202 140253840389568 session_manager.py:502] Done running local_init_op.
I0815 01:00:46.973493 140253840389568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:01:00.336072 140253840389568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:01:00.506688 140253840389568 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:01:00.507101 140253840389568 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:01:00.507637: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:01:00.513343 140253840389568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:01:00.515552 140253840389568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:01:00.520159 140253840389568 tpu_estimator.py:557] Init TPU system
I0815 01:01:40.136516 140253840389568 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0815 01:01:40.137403 140252944258816 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:01:40.137875 140252935866112 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:01:40.203850 140253840389568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:01:40.204699 140253840389568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 01:01:40.264597 140252927473408 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:01:40.410063 140252927473408 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:01:44.909018 140252935866112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:01:49.579400 140253840389568 basic_session_run_hooks.py:262] loss = 0.08925287, step = 30
I0815 01:01:49.581813 140253840389568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:02:10.347204 140253840389568 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:02:10.347470 140253840389568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:02:10.347692 140252944258816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:02:10.347801 140252944258816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:02:10.347935 140253840389568 error_handling.py:96] infeed marked as finished
I0815 01:02:10.348047 140253840389568 tpu_estimator.py:602] Stop output thread controller
I0815 01:02:10.348104 140253840389568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:02:10.348218 140252935866112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:02:10.348293 140252935866112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:02:10.348429 140253840389568 error_handling.py:96] outfeed marked as finished
I0815 01:02:10.348527 140253840389568 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:02:10.547322 140253840389568 estimator.py:368] Loss for final step: 0.08925287.
I0815 01:02:10.548126 140253840389568 error_handling.py:96] training_loop marked as finished
I0815 01:02:11.358346 140253840389568 estimator.py:1145] Calling model_fn.
E0815 01:02:12.043534 140253840389568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:02:12.277257 140253840389568 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:02:12.299596 140253840389568 estimator.py:1147] Done calling model_fn.
I0815 01:02:12.316000 140253840389568 evaluation.py:255] Starting evaluation at 2019-08-15T01:02:12Z
I0815 01:02:12.316282 140253840389568 tpu_estimator.py:499] TPU job name worker
I0815 01:02:12.394531 140253840389568 monitored_session.py:240] Graph was finalized.
W0815 01:02:12.395323 140253840389568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:02:12.609733 140253840389568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:02:15.324120 140253840389568 session_manager.py:500] Running local_init_op.
I0815 01:02:15.349526 140253840389568 session_manager.py:502] Done running local_init_op.
I0815 01:02:15.405816 140253840389568 tpu_estimator.py:557] Init TPU system
I0815 01:03:24.147669 140253840389568 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:03:24.148730 140252940588800 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:03:24.149585 140252932196096 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:03:24.219357 140253840389568 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:03:24.246342 140253840389568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:03:24.246711 140253840389568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:03:24.283921 140252918818560 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:03:24.531867 140252918818560 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:03:25.009494 140252932196096 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:03:25.428673 140253840389568 evaluation.py:167] Evaluation [10/10]
I0815 01:03:25.428998 140253840389568 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:03:25.429079 140253840389568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:03:25.429500 140252940588800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:03:25.429764 140252940588800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:03:25.429992 140253840389568 error_handling.py:96] infeed marked as finished
I0815 01:03:25.430506 140253840389568 tpu_estimator.py:602] Stop output thread controller
I0815 01:03:25.430577 140253840389568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:03:25.430824 140252932196096 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:03:25.431018 140252932196096 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:03:25.431221 140253840389568 error_handling.py:96] outfeed marked as finished
I0815 01:03:25.431406 140253840389568 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:03:54.638804 140253840389568 evaluation.py:275] Finished evaluation at 2019-08-15-01:03:54
I0815 01:03:54.639175 140253840389568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9757, global_step = 30, loss = 0.08415782
I0815 01:03:59.377830 140253840389568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:04:00.272777 140253840389568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08415782, 'global_step': 30, 'accuracy': 0.9757}

Removing gs://yangyou-mnist/log/#1565830841159154...
Removing gs://yangyou-mnist/log/checkpoint#1565830926830273...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565830841.v3-8-tpu#1565830930037867...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565830846393077...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565830923811506...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565830924695510...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565830859801296...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565830854237983...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565830853275776...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565830929080301...
Removing gs://yangyou-mnist/log/eval/#1565831036472884...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565831036.v3-8-tpu#1565831039963918...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:04:04.210000 140232684189120 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:04:04.210825 140232684189120 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:04:04.213475 140232684189120 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:04:04.214358 140232684189120 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:04:04.214953 140232684189120 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:04:04.215097 140232684189120 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:04:04.639895 140232684189120 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:04:04.647222 140232684189120 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:04:04.651199 140232684189120 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:04:04.704349 140232684189120 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:04:04.704667 140232684189120 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:04:04.973999 140232684189120 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:04:05.095136 140232684189120 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:04:05.095412 140232684189120 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:04:05.260970 140232684189120 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f8a517d11d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f8a539af210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:04:05.261384 140232684189120 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:04:05.586121 140232684189120 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:04:05.589411: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:04:05.601639 140232684189120 tpu_system_metadata.py:148] Found TPU system:
I0815 01:04:05.601874 140232684189120 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:04:05.602349 140232684189120 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:04:05.602406 140232684189120 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:04:05.602459 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:04:05.602816 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:04:05.602874 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:04:05.602926 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:04:05.602974 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:04:05.603022 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:04:05.603080 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:04:05.603128 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:04:05.603176 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:04:05.603224 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:04:05.603271 140232684189120 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:04:05.609445 140232684189120 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:04:05.622760 140232684189120 estimator.py:1145] Calling model_fn.
W0815 01:04:05.623395 140232684189120 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:04:05.894450 140232684189120 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:04:06.331923 140232684189120 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:04:06.393459 140232684189120 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:04:06.399269 140232684189120 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:04:06.581351 140232684189120 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:04:06.595244 140232684189120 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:04:06.607228 140232684189120 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:04:06.612682 140232684189120 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:04:06.618160 140232684189120 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:04:06.635580 140232684189120 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:04:06.635795 140232684189120 optimization.py:32] ++++++ warmup starts at step 0, for 9 steps ++++++
W0815 01:04:06.635919 140232684189120 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:04:06.745536 140232684189120 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:04:06.788954 140232684189120 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:04:06.834430 140232684189120 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:04:06.887780 140232684189120 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:04:07.056288 140232684189120 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:04:07.115827 140232684189120 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:04:07.164467 140232684189120 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:04:07.215965 140232684189120 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:04:07.263124 140232684189120 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:04:07.304673 140232684189120 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:04:07.321337 140232684189120 estimator.py:1147] Done calling model_fn.
I0815 01:04:10.939462 140232684189120 tpu_estimator.py:499] TPU job name worker
I0815 01:04:11.053246 140232684189120 monitored_session.py:240] Graph was finalized.
I0815 01:04:11.768351 140232684189120 session_manager.py:500] Running local_init_op.
I0815 01:04:11.821847 140232684189120 session_manager.py:502] Done running local_init_op.
I0815 01:04:14.715533 140232684189120 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:04:27.709850 140232684189120 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:04:27.882164 140232684189120 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:04:27.882677 140232684189120 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:04:27.883109: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:04:27.888747 140232684189120 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:04:27.891091 140232684189120 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:04:27.894928 140232684189120 tpu_estimator.py:557] Init TPU system
I0815 01:05:08.113289 140232684189120 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 01:05:08.114454 140231787923200 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:05:08.115304 140231779530496 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:05:08.186538 140232684189120 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:05:08.187465 140232684189120 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 01:05:08.240742 140231771137792 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:05:08.600713 140231771137792 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:05:13.036787 140231779530496 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:05:17.862174 140232684189120 basic_session_run_hooks.py:262] loss = 0.10462548, step = 30
I0815 01:05:17.864681 140232684189120 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:05:31.549966 140232684189120 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:05:31.550278 140232684189120 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:05:31.550515 140231787923200 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:05:31.550618 140231787923200 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:05:31.550760 140232684189120 error_handling.py:96] infeed marked as finished
I0815 01:05:31.550859 140232684189120 tpu_estimator.py:602] Stop output thread controller
I0815 01:05:31.550910 140232684189120 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:05:31.551024 140231779530496 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:05:31.551100 140231779530496 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:05:31.551229 140232684189120 error_handling.py:96] outfeed marked as finished
I0815 01:05:31.551318 140232684189120 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:05:38.748620 140232684189120 estimator.py:368] Loss for final step: 0.10462548.
I0815 01:05:38.749479 140232684189120 error_handling.py:96] training_loop marked as finished
I0815 01:05:39.589876 140232684189120 estimator.py:1145] Calling model_fn.
E0815 01:05:40.346206 140232684189120 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:05:40.570395 140232684189120 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:05:40.591454 140232684189120 estimator.py:1147] Done calling model_fn.
I0815 01:05:40.607352 140232684189120 evaluation.py:255] Starting evaluation at 2019-08-15T01:05:40Z
I0815 01:05:40.607577 140232684189120 tpu_estimator.py:499] TPU job name worker
I0815 01:05:40.684396 140232684189120 monitored_session.py:240] Graph was finalized.
W0815 01:05:40.685154 140232684189120 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:05:40.900613 140232684189120 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:05:43.823462 140232684189120 session_manager.py:500] Running local_init_op.
I0815 01:05:43.849124 140232684189120 session_manager.py:502] Done running local_init_op.
I0815 01:05:43.908299 140232684189120 tpu_estimator.py:557] Init TPU system
I0815 01:06:52.093719 140232684189120 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:06:52.094691 140231784253184 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:06:52.095108 140231775860480 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:06:52.161199 140232684189120 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:06:52.191332 140232684189120 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:06:52.191677 140232684189120 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:06:52.223953 140231420409600 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:06:52.399240 140231420409600 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:06:52.997479 140231775860480 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:06:53.317408 140232684189120 evaluation.py:167] Evaluation [10/10]
I0815 01:06:53.317873 140232684189120 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:06:53.317987 140232684189120 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:06:53.318187 140231784253184 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:06:53.318295 140231784253184 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:06:53.318427 140232684189120 error_handling.py:96] infeed marked as finished
I0815 01:06:53.318531 140232684189120 tpu_estimator.py:602] Stop output thread controller
I0815 01:06:53.318578 140232684189120 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:06:53.318692 140231775860480 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:06:53.318767 140231775860480 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:06:53.318893 140232684189120 error_handling.py:96] outfeed marked as finished
I0815 01:06:53.318980 140232684189120 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:07:22.496905 140232684189120 evaluation.py:275] Finished evaluation at 2019-08-15-01:07:22
I0815 01:07:22.497282 140232684189120 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9712, global_step = 30, loss = 0.09107694
I0815 01:07:26.791040 140232684189120 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:07:27.607795 140232684189120 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09107694, 'global_step': 30, 'accuracy': 0.9712}

Removing gs://yangyou-mnist/log/#1565831048978006...
Removing gs://yangyou-mnist/log/checkpoint#1565831128146790...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565831062480061...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565831049.v3-8-tpu#1565831131247390...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565831054119760...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565831067186248...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565831125141501...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565831061507797...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565831126050136...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565831130360067...
Removing gs://yangyou-mnist/log/eval/#1565831244110463...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565831244.v3-8-tpu#1565831247316713...
/ [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:07:31.218930 140584850650560 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:07:31.219773 140584850650560 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:07:31.222609 140584850650560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:07:31.223454 140584850650560 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:07:31.224056 140584850650560 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:07:31.224181 140584850650560 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:07:31.643697 140584850650560 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:07:31.650393 140584850650560 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:07:31.654284 140584850650560 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:07:31.778477 140584850650560 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:07:31.778752 140584850650560 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:07:32.063482 140584850650560 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:07:32.115528 140584850650560 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:07:32.115823 140584850650560 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:07:32.463294 140584850650560 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fdc503ed150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fdc525cb1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:07:32.463624 140584850650560 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:07:32.762522 140584850650560 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:07:32.765501: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:07:32.779015 140584850650560 tpu_system_metadata.py:148] Found TPU system:
I0815 01:07:32.779258 140584850650560 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:07:32.779706 140584850650560 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:07:32.779762 140584850650560 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:07:32.779815 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:07:32.780101 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:07:32.780158 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:07:32.780209 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:07:32.780261 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:07:32.780322 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:07:32.780369 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:07:32.780459 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:07:32.780517 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:07:32.780565 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:07:32.780613 140584850650560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:07:32.787353 140584850650560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:07:32.800046 140584850650560 estimator.py:1145] Calling model_fn.
W0815 01:07:32.800719 140584850650560 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:07:33.096983 140584850650560 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:07:33.540154 140584850650560 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:07:33.601020 140584850650560 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:07:33.606978 140584850650560 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:07:33.785742 140584850650560 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:07:33.799194 140584850650560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:07:33.811299 140584850650560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:07:33.816926 140584850650560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:07:33.822365 140584850650560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:07:33.839761 140584850650560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:07:33.839973 140584850650560 optimization.py:32] ++++++ warmup starts at step 0, for 9 steps ++++++
W0815 01:07:33.840112 140584850650560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:07:33.949192 140584850650560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:07:33.990072 140584850650560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:07:34.034548 140584850650560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:07:34.085669 140584850650560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:07:34.254698 140584850650560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:07:34.305427 140584850650560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:07:34.354566 140584850650560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:07:34.405483 140584850650560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:07:34.451461 140584850650560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:07:34.491894 140584850650560 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:07:34.508105 140584850650560 estimator.py:1147] Done calling model_fn.
I0815 01:07:37.839226 140584850650560 tpu_estimator.py:499] TPU job name worker
I0815 01:07:37.950560 140584850650560 monitored_session.py:240] Graph was finalized.
I0815 01:07:38.660630 140584850650560 session_manager.py:500] Running local_init_op.
I0815 01:07:38.713988 140584850650560 session_manager.py:502] Done running local_init_op.
I0815 01:07:41.468312 140584850650560 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:07:53.223134 140584850650560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:07:53.367587 140584850650560 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:07:53.367990 140584850650560 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:07:53.368361: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:07:53.374130 140584850650560 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:07:53.376596 140584850650560 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:07:53.380345 140584850650560 tpu_estimator.py:557] Init TPU system
I0815 01:08:36.023564 140584850650560 tpu_estimator.py:566] Initialized TPU in 42 seconds
I0815 01:08:36.024580 140584155879168 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:08:36.025091 140583674836736 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:08:36.087996 140583666444032 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:08:36.092556 140584850650560 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:08:36.093744 140584850650560 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 01:08:36.459280 140583666444032 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:08:40.933233 140583674836736 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:08:45.579689 140584850650560 basic_session_run_hooks.py:262] loss = 0.09844299, step = 30
I0815 01:08:45.582040 140584850650560 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:08:58.939779 140584850650560 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:08:58.940064 140584850650560 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:08:58.940269 140584155879168 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:08:58.940376 140584155879168 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:08:58.940558 140584850650560 error_handling.py:96] infeed marked as finished
I0815 01:08:58.940665 140584850650560 tpu_estimator.py:602] Stop output thread controller
I0815 01:08:58.940716 140584850650560 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:08:58.940831 140583674836736 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:08:58.940907 140583674836736 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:08:58.941016 140584850650560 error_handling.py:96] outfeed marked as finished
I0815 01:08:58.941092 140584850650560 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:09:06.597641 140584850650560 estimator.py:368] Loss for final step: 0.09844299.
I0815 01:09:06.598438 140584850650560 error_handling.py:96] training_loop marked as finished
I0815 01:09:07.398065 140584850650560 estimator.py:1145] Calling model_fn.
E0815 01:09:08.089381 140584850650560 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:09:08.319848 140584850650560 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:09:08.341840 140584850650560 estimator.py:1147] Done calling model_fn.
I0815 01:09:08.358431 140584850650560 evaluation.py:255] Starting evaluation at 2019-08-15T01:09:08Z
I0815 01:09:08.358683 140584850650560 tpu_estimator.py:499] TPU job name worker
I0815 01:09:08.436134 140584850650560 monitored_session.py:240] Graph was finalized.
W0815 01:09:08.436940 140584850650560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:09:08.680841 140584850650560 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:09:11.816447 140584850650560 session_manager.py:500] Running local_init_op.
I0815 01:09:11.842468 140584850650560 session_manager.py:502] Done running local_init_op.
I0815 01:09:11.898433 140584850650560 tpu_estimator.py:557] Init TPU system
I0815 01:10:20.058279 140584850650560 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:10:20.059417 140583674836736 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:10:20.060705 140583666444032 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:10:20.135586 140584850650560 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:10:20.167248 140584850650560 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:10:20.167721 140584850650560 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:10:20.266374 140583658051328 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:10:20.525636 140583658051328 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:10:20.978652 140583666444032 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:10:21.283235 140584850650560 evaluation.py:167] Evaluation [10/10]
I0815 01:10:21.283596 140584850650560 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:10:21.283670 140584850650560 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:10:21.283943 140583674836736 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:10:21.284252 140583674836736 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:10:21.284487 140584850650560 error_handling.py:96] infeed marked as finished
I0815 01:10:21.284682 140584850650560 tpu_estimator.py:602] Stop output thread controller
I0815 01:10:21.284743 140584850650560 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:10:21.284934 140583666444032 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:10:21.285120 140583666444032 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:10:21.285342 140584850650560 error_handling.py:96] outfeed marked as finished
I0815 01:10:21.285499 140584850650560 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:10:50.626501 140584850650560 evaluation.py:275] Finished evaluation at 2019-08-15-01:10:50
I0815 01:10:50.626825 140584850650560 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9756, global_step = 30, loss = 0.09149282
I0815 01:10:55.833204 140584850650560 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:10:56.643703 140584850650560 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.09149282, 'global_step': 30, 'accuracy': 0.9756}

Removing gs://yangyou-mnist/log/#1565831255998689...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565831268668173...
Removing gs://yangyou-mnist/log/checkpoint#1565831335343031...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565831272766951...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565831256.v3-8-tpu#1565831338635038...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565831260955531...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565831267700716...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565831332257300...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565831333171781...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565831337589718...
Removing gs://yangyou-mnist/log/eval/#1565831452338537...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565831452.v3-8-tpu#1565831456338944...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:11:00.539702 140492283086272 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:11:00.540586 140492283086272 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:11:00.543258 140492283086272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:11:00.544095 140492283086272 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:11:00.544787 140492283086272 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:11:00.544929 140492283086272 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:11:00.952471 140492283086272 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:11:00.960726 140492283086272 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:11:00.968930 140492283086272 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:11:01.024343 140492283086272 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:11:01.024646 140492283086272 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:11:01.367274 140492283086272 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:11:01.484983 140492283086272 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:11:01.485261 140492283086272 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:11:01.865999 140492283086272 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc6c2c9e150>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc6c4e7c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:11:01.866358 140492283086272 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:11:02.206355 140492283086272 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:11:02.210113: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:11:02.225553 140492283086272 tpu_system_metadata.py:148] Found TPU system:
I0815 01:11:02.225841 140492283086272 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:11:02.226490 140492283086272 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:11:02.226562 140492283086272 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:11:02.226619 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:11:02.227005 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:11:02.227066 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:11:02.227116 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:11:02.227164 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:11:02.227210 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:11:02.227257 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:11:02.227313 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:11:02.227365 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:11:02.227415 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:11:02.227463 140492283086272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:11:02.234066 140492283086272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:11:02.247109 140492283086272 estimator.py:1145] Calling model_fn.
W0815 01:11:02.247781 140492283086272 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:11:02.522133 140492283086272 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:11:02.946114 140492283086272 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:11:03.008713 140492283086272 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:11:03.014933 140492283086272 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:11:03.203531 140492283086272 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:11:03.217636 140492283086272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:11:03.230129 140492283086272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:11:03.235848 140492283086272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:11:03.241523 140492283086272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:11:03.259572 140492283086272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:11:03.259810 140492283086272 optimization.py:32] ++++++ warmup starts at step 0, for 9 steps ++++++
W0815 01:11:03.259955 140492283086272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:11:03.372550 140492283086272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:11:03.414589 140492283086272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:11:03.459273 140492283086272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:11:03.509915 140492283086272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:11:03.683675 140492283086272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:11:03.733052 140492283086272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:11:03.780670 140492283086272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:11:03.829828 140492283086272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:11:03.874685 140492283086272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:11:03.915110 140492283086272 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:11:03.931575 140492283086272 estimator.py:1147] Done calling model_fn.
I0815 01:11:07.462368 140492283086272 tpu_estimator.py:499] TPU job name worker
I0815 01:11:07.573932 140492283086272 monitored_session.py:240] Graph was finalized.
I0815 01:11:08.249430 140492283086272 session_manager.py:500] Running local_init_op.
I0815 01:11:08.307296 140492283086272 session_manager.py:502] Done running local_init_op.
I0815 01:11:11.163759 140492283086272 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:11:23.787935 140492283086272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:11:23.937376 140492283086272 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:11:23.937783 140492283086272 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:11:23.938157: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:11:23.942589 140492283086272 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:11:23.944868 140492283086272 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:11:23.949023 140492283086272 tpu_estimator.py:557] Init TPU system
I0815 01:12:04.130084 140492283086272 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 01:12:04.131006 140491383363328 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:12:04.131902 140491374970624 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:12:04.197323 140492283086272 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:12:04.198293 140492283086272 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 01:12:04.261255 140491366577920 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:12:04.648734 140491366577920 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:12:09.216753 140491374970624 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:12:14.298583 140492283086272 basic_session_run_hooks.py:262] loss = 0.079689145, step = 30
I0815 01:12:14.301446 140492283086272 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:12:29.498126 140492283086272 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:12:29.498403 140492283086272 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:12:29.498645 140491383363328 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:12:29.498752 140491383363328 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:12:29.498884 140492283086272 error_handling.py:96] infeed marked as finished
I0815 01:12:29.498986 140492283086272 tpu_estimator.py:602] Stop output thread controller
I0815 01:12:29.499034 140492283086272 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:12:29.499155 140491374970624 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:12:29.499232 140491374970624 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:12:29.499357 140492283086272 error_handling.py:96] outfeed marked as finished
I0815 01:12:29.499439 140492283086272 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:12:34.794688 140492283086272 estimator.py:368] Loss for final step: 0.079689145.
I0815 01:12:34.795547 140492283086272 error_handling.py:96] training_loop marked as finished
I0815 01:12:36.338486 140492283086272 estimator.py:1145] Calling model_fn.
E0815 01:12:37.035443 140492283086272 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:12:37.262856 140492283086272 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:12:37.284337 140492283086272 estimator.py:1147] Done calling model_fn.
I0815 01:12:37.301422 140492283086272 evaluation.py:255] Starting evaluation at 2019-08-15T01:12:37Z
I0815 01:12:37.301664 140492283086272 tpu_estimator.py:499] TPU job name worker
I0815 01:12:37.379868 140492283086272 monitored_session.py:240] Graph was finalized.
W0815 01:12:37.380641 140492283086272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:12:37.593556 140492283086272 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:12:40.313488 140492283086272 session_manager.py:500] Running local_init_op.
I0815 01:12:40.339565 140492283086272 session_manager.py:502] Done running local_init_op.
I0815 01:12:40.390419 140492283086272 tpu_estimator.py:557] Init TPU system
I0815 01:13:48.079238 140492283086272 tpu_estimator.py:566] Initialized TPU in 67 seconds
I0815 01:13:48.080059 140491382839040 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:13:48.080472 140491374446336 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:13:48.154211 140492283086272 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:13:48.179609 140492283086272 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:13:48.179933 140492283086272 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:13:48.285106 140491366053632 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:13:48.659753 140491366053632 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:13:48.962660 140491374446336 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:13:49.280872 140492283086272 evaluation.py:167] Evaluation [10/10]
I0815 01:13:49.281210 140492283086272 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:13:49.281320 140492283086272 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:13:49.281563 140491382839040 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:13:49.281673 140491382839040 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:13:49.281822 140492283086272 error_handling.py:96] infeed marked as finished
I0815 01:13:49.281923 140492283086272 tpu_estimator.py:602] Stop output thread controller
I0815 01:13:49.281976 140492283086272 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:13:49.282089 140491374446336 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:13:49.282171 140491374446336 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:13:49.282286 140492283086272 error_handling.py:96] outfeed marked as finished
I0815 01:13:49.282372 140492283086272 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:14:18.759464 140492283086272 evaluation.py:275] Finished evaluation at 2019-08-15-01:14:18
I0815 01:14:18.759807 140492283086272 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9791, global_step = 30, loss = 0.057233654
I0815 01:14:23.320925 140492283086272 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:14:24.251463 140492283086272 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.057233654, 'global_step': 30, 'accuracy': 0.9791}

Removing gs://yangyou-mnist/log/#1565831465490845...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565831465.v3-8-tpu#1565831549151485...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565831470566574...
Removing gs://yangyou-mnist/log/checkpoint#1565831545026254...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565831477600341...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565831542741645...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565831483278897...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565831478586801...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565831541814260...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565831548129277...
Removing gs://yangyou-mnist/log/eval/#1565831660553021...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565831660.v3-8-tpu#1565831663862838...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:14:28.186126 140288059573696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:14:28.186904 140288059573696 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:14:28.189867 140288059573696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:14:28.191241 140288059573696 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:14:28.191843 140288059573696 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:14:28.191977 140288059573696 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:14:28.603265 140288059573696 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:14:28.610145 140288059573696 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:14:28.613991 140288059573696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:14:28.670269 140288059573696 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:14:28.670545 140288059573696 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:14:28.947211 140288059573696 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:14:29.062031 140288059573696 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:14:29.062304 140288059573696 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:14:29.496196 140288059573696 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f97361e61d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f97383c4210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:14:29.496686 140288059573696 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:14:29.822206 140288059573696 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:14:29.825016: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:14:29.838198 140288059573696 tpu_system_metadata.py:148] Found TPU system:
I0815 01:14:29.838440 140288059573696 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:14:29.838922 140288059573696 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:14:29.838980 140288059573696 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:14:29.839034 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:14:29.839317 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:14:29.839379 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:14:29.839430 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:14:29.839478 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:14:29.839524 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:14:29.839579 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:14:29.839624 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:14:29.839678 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:14:29.839725 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:14:29.839772 140288059573696 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:14:29.845932 140288059573696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:14:29.858500 140288059573696 estimator.py:1145] Calling model_fn.
W0815 01:14:29.859106 140288059573696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:14:30.152590 140288059573696 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:14:30.571233 140288059573696 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:14:30.635930 140288059573696 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:14:30.642066 140288059573696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:14:30.828314 140288059573696 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:14:30.842792 140288059573696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:14:30.855828 140288059573696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:14:30.861339 140288059573696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:14:30.866929 140288059573696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:14:30.884769 140288059573696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:14:30.884983 140288059573696 optimization.py:32] ++++++ warmup starts at step 0, for 9 steps ++++++
W0815 01:14:30.885111 140288059573696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:14:30.996459 140288059573696 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:14:31.039633 140288059573696 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:14:31.092377 140288059573696 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:14:31.145495 140288059573696 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:14:31.305450 140288059573696 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:14:31.356601 140288059573696 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:14:31.406609 140288059573696 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:14:31.458097 140288059573696 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:14:31.504666 140288059573696 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:14:31.546001 140288059573696 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:14:31.562210 140288059573696 estimator.py:1147] Done calling model_fn.
I0815 01:14:35.071866 140288059573696 tpu_estimator.py:499] TPU job name worker
I0815 01:14:35.185919 140288059573696 monitored_session.py:240] Graph was finalized.
I0815 01:14:35.853611 140288059573696 session_manager.py:500] Running local_init_op.
I0815 01:14:35.903981 140288059573696 session_manager.py:502] Done running local_init_op.
I0815 01:14:38.687953 140288059573696 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:14:50.979691 140288059573696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:14:51.152919 140288059573696 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:14:51.153326 140288059573696 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:14:51.153725: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:14:51.159135 140288059573696 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:14:51.161283 140288059573696 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:14:51.165690 140288059573696 tpu_estimator.py:557] Init TPU system
I0815 01:15:32.116689 140288059573696 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 01:15:32.117635 140287163225856 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:15:32.118098 140287154833152 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:15:32.182344 140287146440448 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:15:32.184272 140288059573696 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:15:32.185497 140288059573696 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 01:15:32.523056 140287146440448 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:15:37.078893 140287154833152 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:15:41.419785 140288059573696 basic_session_run_hooks.py:262] loss = 0.07735126, step = 30
I0815 01:15:41.422800 140288059573696 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:15:54.604895 140288059573696 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:15:54.605159 140288059573696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:15:54.605437 140287163225856 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:15:54.605561 140287163225856 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:15:54.605748 140288059573696 error_handling.py:96] infeed marked as finished
I0815 01:15:54.605875 140288059573696 tpu_estimator.py:602] Stop output thread controller
I0815 01:15:54.605933 140288059573696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:15:54.606076 140287154833152 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:15:54.606154 140287154833152 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:15:54.606302 140288059573696 error_handling.py:96] outfeed marked as finished
I0815 01:15:54.606395 140288059573696 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:16:02.635555 140288059573696 estimator.py:368] Loss for final step: 0.07735126.
I0815 01:16:02.636275 140288059573696 error_handling.py:96] training_loop marked as finished
I0815 01:16:03.462251 140288059573696 estimator.py:1145] Calling model_fn.
E0815 01:16:04.257030 140288059573696 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:16:04.487399 140288059573696 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:16:04.509917 140288059573696 estimator.py:1147] Done calling model_fn.
I0815 01:16:04.526896 140288059573696 evaluation.py:255] Starting evaluation at 2019-08-15T01:16:04Z
I0815 01:16:04.527134 140288059573696 tpu_estimator.py:499] TPU job name worker
I0815 01:16:04.608206 140288059573696 monitored_session.py:240] Graph was finalized.
W0815 01:16:04.608978 140288059573696 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:16:04.818650 140288059573696 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:16:07.464149 140288059573696 session_manager.py:500] Running local_init_op.
I0815 01:16:07.494699 140288059573696 session_manager.py:502] Done running local_init_op.
I0815 01:16:07.550177 140288059573696 tpu_estimator.py:557] Init TPU system
I0815 01:17:16.050378 140288059573696 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:17:16.051440 140287159555840 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:17:16.052221 140287151163136 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:17:16.133373 140288059573696 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:17:16.161614 140288059573696 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:17:16.163012 140288059573696 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:17:16.263567 140287137785600 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:17:16.536932 140287137785600 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:17:16.949486 140287151163136 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:17:17.228456 140288059573696 evaluation.py:167] Evaluation [10/10]
I0815 01:17:17.228874 140288059573696 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:17:17.228951 140288059573696 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:17:17.229223 140287159555840 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:17:17.229496 140287159555840 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:17:17.229765 140288059573696 error_handling.py:96] infeed marked as finished
I0815 01:17:17.229980 140288059573696 tpu_estimator.py:602] Stop output thread controller
I0815 01:17:17.230040 140288059573696 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:17:17.230196 140287151163136 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:17:17.230436 140287151163136 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:17:17.230613 140288059573696 error_handling.py:96] outfeed marked as finished
I0815 01:17:17.230827 140288059573696 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:17:46.641913 140288059573696 evaluation.py:275] Finished evaluation at 2019-08-15-01:17:46
I0815 01:17:46.642292 140288059573696 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9774, global_step = 30, loss = 0.07034166
I0815 01:17:51.249443 140288059573696 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:17:52.038321 140288059573696 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07034166, 'global_step': 30, 'accuracy': 0.9774}

Removing gs://yangyou-mnist/log/#1565831673161331...
Removing gs://yangyou-mnist/log/checkpoint#1565831751176244...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565831673.v3-8-tpu#1565831754302128...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565831685872136...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565831690452906...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565831678110182...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565831748246477...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565831684997952...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565831749133849...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565831753402060...
/ [1/12 objects]   8% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565831868423814...
/ [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565831868.v3-8-tpu#1565831871718481...
/ [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:17:55.885016 140165560829376 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:17:55.885802 140165560829376 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:17:55.888571 140165560829376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:17:55.889429 140165560829376 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:17:55.890017 140165560829376 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:17:55.890149 140165560829376 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:17:56.305193 140165560829376 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:17:56.313704 140165560829376 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:17:56.318173 140165560829376 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:17:56.373584 140165560829376 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:17:56.373894 140165560829376 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:17:56.737234 140165560829376 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:17:56.788474 140165560829376 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:17:56.788799 140165560829376 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:17:57.058466 140165560829376 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f7ab09fe210>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f7ab2bdc210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:17:57.058912 140165560829376 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:17:57.387612 140165560829376 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:17:57.390502: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:17:57.404258 140165560829376 tpu_system_metadata.py:148] Found TPU system:
I0815 01:17:57.404541 140165560829376 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:17:57.405047 140165560829376 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:17:57.405108 140165560829376 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:17:57.405162 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:17:57.405455 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:17:57.405509 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:17:57.405585 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:17:57.405635 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:17:57.405682 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:17:57.405728 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:17:57.405774 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:17:57.405818 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:17:57.405864 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:17:57.405910 140165560829376 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:17:57.412152 140165560829376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:17:57.425097 140165560829376 estimator.py:1145] Calling model_fn.
W0815 01:17:57.425725 140165560829376 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:17:57.705539 140165560829376 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:17:58.110383 140165560829376 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:17:58.173022 140165560829376 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:17:58.178903 140165560829376 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:17:58.361500 140165560829376 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:17:58.375248 140165560829376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:17:58.387397 140165560829376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:17:58.393294 140165560829376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:17:58.398662 140165560829376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:17:58.415908 140165560829376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:17:58.416135 140165560829376 optimization.py:32] ++++++ warmup starts at step 0, for 9 steps ++++++
W0815 01:17:58.416266 140165560829376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:17:58.526109 140165560829376 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:17:58.567930 140165560829376 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:17:58.612776 140165560829376 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:17:58.663743 140165560829376 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:17:58.827264 140165560829376 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:17:58.877626 140165560829376 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:17:58.926559 140165560829376 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:17:58.976918 140165560829376 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:17:59.024231 140165560829376 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:17:59.066663 140165560829376 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:17:59.083003 140165560829376 estimator.py:1147] Done calling model_fn.
I0815 01:18:02.845259 140165560829376 tpu_estimator.py:499] TPU job name worker
I0815 01:18:02.955470 140165560829376 monitored_session.py:240] Graph was finalized.
I0815 01:18:03.632677 140165560829376 session_manager.py:500] Running local_init_op.
I0815 01:18:03.683486 140165560829376 session_manager.py:502] Done running local_init_op.
I0815 01:18:06.402642 140165560829376 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:18:18.864456 140165560829376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:18:19.030307 140165560829376 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:18:19.030847 140165560829376 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:18:19.031285: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:18:19.035891 140165560829376 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:18:19.038166 140165560829376 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:18:19.041992 140165560829376 tpu_estimator.py:557] Init TPU system
I0815 01:19:00.118303 140165560829376 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0815 01:19:00.119138 140164798850816 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:19:00.119584 140164790458112 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:19:00.189490 140164311545600 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:19:00.195462 140165560829376 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:19:00.196881 140165560829376 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 01:19:00.486664 140164311545600 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:19:05.177207 140164790458112 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:19:09.963732 140165560829376 basic_session_run_hooks.py:262] loss = 0.10311507, step = 30
I0815 01:19:09.966769 140165560829376 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:19:23.981214 140165560829376 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:19:23.981489 140165560829376 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:19:23.981717 140164798850816 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:19:23.981827 140164798850816 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:19:23.981964 140165560829376 error_handling.py:96] infeed marked as finished
I0815 01:19:23.982068 140165560829376 tpu_estimator.py:602] Stop output thread controller
I0815 01:19:23.982116 140165560829376 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:19:23.982228 140164790458112 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:19:23.982297 140164790458112 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:19:23.982410 140165560829376 error_handling.py:96] outfeed marked as finished
I0815 01:19:23.982485 140165560829376 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:19:30.631746 140165560829376 estimator.py:368] Loss for final step: 0.10311507.
I0815 01:19:30.632498 140165560829376 error_handling.py:96] training_loop marked as finished
I0815 01:19:31.424616 140165560829376 estimator.py:1145] Calling model_fn.
E0815 01:19:32.116971 140165560829376 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:19:32.348357 140165560829376 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:19:32.370187 140165560829376 estimator.py:1147] Done calling model_fn.
I0815 01:19:32.386182 140165560829376 evaluation.py:255] Starting evaluation at 2019-08-15T01:19:32Z
I0815 01:19:32.386440 140165560829376 tpu_estimator.py:499] TPU job name worker
I0815 01:19:32.463335 140165560829376 monitored_session.py:240] Graph was finalized.
W0815 01:19:32.464114 140165560829376 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:19:32.666850 140165560829376 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:19:35.217505 140165560829376 session_manager.py:500] Running local_init_op.
I0815 01:19:35.243546 140165560829376 session_manager.py:502] Done running local_init_op.
I0815 01:19:35.293452 140165560829376 tpu_estimator.py:557] Init TPU system
I0815 01:20:44.045305 140165560829376 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:20:44.046367 140164795180800 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:20:44.047115 140164311545600 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:20:44.116338 140165560829376 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:20:44.141947 140165560829376 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:20:44.142308 140165560829376 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:20:44.190301 140164303152896 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:20:44.356020 140164303152896 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:20:44.982197 140164311545600 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:20:45.304847 140165560829376 evaluation.py:167] Evaluation [10/10]
I0815 01:20:45.305222 140165560829376 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:20:45.305365 140165560829376 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:20:45.305708 140164795180800 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:20:45.306242 140164795180800 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:20:45.306438 140165560829376 error_handling.py:96] infeed marked as finished
I0815 01:20:45.306603 140165560829376 tpu_estimator.py:602] Stop output thread controller
I0815 01:20:45.306655 140165560829376 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:20:45.306839 140164311545600 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:20:45.307013 140164311545600 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:20:45.307204 140165560829376 error_handling.py:96] outfeed marked as finished
I0815 01:20:45.307353 140165560829376 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:21:14.436567 140165560829376 evaluation.py:275] Finished evaluation at 2019-08-15-01:21:14
I0815 01:21:14.436954 140165560829376 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9766, global_step = 30, loss = 0.07823879
I0815 01:21:18.932063 140165560829376 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:21:19.683029 140165560829376 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07823879, 'global_step': 30, 'accuracy': 0.9766}

Removing gs://yangyou-mnist/log/#1565831880644088...
Removing gs://yangyou-mnist/log/checkpoint#1565831960517239...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565831880.v3-8-tpu#1565831963673131...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565831885823448...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565831893708727...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565831958335195...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565831898356229...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565831957403990...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565831892746223...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565831962664899...
Removing gs://yangyou-mnist/log/eval/#1565832076137448...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565832076.v3-8-tpu#1565832079374820...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:21:23.603440 140500588918208 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:21:23.604309 140500588918208 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:21:23.606982 140500588918208 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:21:23.607841 140500588918208 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:21:23.608474 140500588918208 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:21:23.608607 140500588918208 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:21:24.021974 140500588918208 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:21:24.029994 140500588918208 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:21:24.034795 140500588918208 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:21:24.087856 140500588918208 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:21:24.088125 140500588918208 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:21:24.341588 140500588918208 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:21:24.459115 140500588918208 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:21:24.459382 140500588918208 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:21:24.671468 140500588918208 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc8b1d96450>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc8b3f8b210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:21:24.671839 140500588918208 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:21:25.044936 140500588918208 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:21:25.048067: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:21:25.060987 140500588918208 tpu_system_metadata.py:148] Found TPU system:
I0815 01:21:25.061456 140500588918208 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:21:25.062136 140500588918208 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:21:25.062201 140500588918208 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:21:25.062263 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:21:25.062591 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:21:25.062648 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:21:25.062699 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:21:25.062747 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:21:25.062796 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:21:25.062858 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:21:25.062906 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:21:25.062953 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:21:25.063002 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:21:25.063050 140500588918208 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:21:25.069262 140500588918208 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:21:25.081964 140500588918208 estimator.py:1145] Calling model_fn.
W0815 01:21:25.082577 140500588918208 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:21:25.355247 140500588918208 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:21:25.785417 140500588918208 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:21:25.846616 140500588918208 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:21:25.852566 140500588918208 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:21:26.031069 140500588918208 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:21:26.044785 140500588918208 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:21:26.056731 140500588918208 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:21:26.062269 140500588918208 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:21:26.067718 140500588918208 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:21:26.085148 140500588918208 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:21:26.085391 140500588918208 optimization.py:32] ++++++ warmup starts at step 0, for 9 steps ++++++
W0815 01:21:26.085525 140500588918208 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:21:26.195955 140500588918208 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:21:26.237689 140500588918208 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:21:26.282663 140500588918208 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:21:26.335609 140500588918208 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:21:26.510087 140500588918208 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:21:26.559528 140500588918208 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:21:26.607949 140500588918208 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:21:26.657816 140500588918208 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:21:26.703459 140500588918208 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:21:26.745102 140500588918208 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:21:26.762073 140500588918208 estimator.py:1147] Done calling model_fn.
I0815 01:21:30.317773 140500588918208 tpu_estimator.py:499] TPU job name worker
I0815 01:21:30.434250 140500588918208 monitored_session.py:240] Graph was finalized.
I0815 01:21:31.137388 140500588918208 session_manager.py:500] Running local_init_op.
I0815 01:21:31.187695 140500588918208 session_manager.py:502] Done running local_init_op.
I0815 01:21:33.868192 140500588918208 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:21:46.132797 140500588918208 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:21:46.300211 140500588918208 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:21:46.300909 140500588918208 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:21:46.301449: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:21:46.306119 140500588918208 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:21:46.308319 140500588918208 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:21:46.312282 140500588918208 tpu_estimator.py:557] Init TPU system
I0815 01:22:28.176605 140500588918208 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0815 01:22:28.177840 140499692799744 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:22:28.178647 140499684407040 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:22:28.247704 140500588918208 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:22:28.248716 140500588918208 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 01:22:28.302216 140499676014336 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:22:28.556977 140499676014336 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:22:33.101629 140499684407040 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:22:37.983581 140500588918208 basic_session_run_hooks.py:262] loss = 0.08932392, step = 30
I0815 01:22:37.986010 140500588918208 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:22:52.237835 140500588918208 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:22:52.238162 140500588918208 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:22:52.240258 140499692799744 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:22:52.240701 140499692799744 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:22:52.240982 140500588918208 error_handling.py:96] infeed marked as finished
I0815 01:22:52.241113 140500588918208 tpu_estimator.py:602] Stop output thread controller
I0815 01:22:52.241183 140500588918208 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:22:52.241305 140499684407040 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:22:52.241409 140499684407040 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:22:52.241533 140500588918208 error_handling.py:96] outfeed marked as finished
I0815 01:22:52.241617 140500588918208 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:22:58.701987 140500588918208 estimator.py:368] Loss for final step: 0.08932392.
I0815 01:22:58.702841 140500588918208 error_handling.py:96] training_loop marked as finished
I0815 01:22:59.411788 140500588918208 estimator.py:1145] Calling model_fn.
E0815 01:23:00.105232 140500588918208 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:23:00.334465 140500588918208 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:23:00.355818 140500588918208 estimator.py:1147] Done calling model_fn.
I0815 01:23:00.372150 140500588918208 evaluation.py:255] Starting evaluation at 2019-08-15T01:23:00Z
I0815 01:23:00.372443 140500588918208 tpu_estimator.py:499] TPU job name worker
I0815 01:23:00.449031 140500588918208 monitored_session.py:240] Graph was finalized.
W0815 01:23:00.449840 140500588918208 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:23:00.645490 140500588918208 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:23:03.273812 140500588918208 session_manager.py:500] Running local_init_op.
I0815 01:23:03.298273 140500588918208 session_manager.py:502] Done running local_init_op.
I0815 01:23:03.344947 140500588918208 tpu_estimator.py:557] Init TPU system
I0815 01:24:12.068742 140500588918208 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:24:12.069770 140499689129728 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:24:12.070545 140499680737024 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:24:12.141845 140500588918208 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:24:12.173444 140500588918208 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:24:12.173793 140500588918208 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:24:12.196547 140499667359488 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:24:12.540452 140499667359488 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0815 01:24:13.003323 140499680737024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:24:13.289666 140500588918208 evaluation.py:167] Evaluation [10/10]
I0815 01:24:13.290137 140500588918208 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:24:13.290226 140500588918208 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:24:13.290527 140499689129728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:24:13.290805 140499689129728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:24:13.290997 140500588918208 error_handling.py:96] infeed marked as finished
I0815 01:24:13.291174 140500588918208 tpu_estimator.py:602] Stop output thread controller
I0815 01:24:13.291265 140500588918208 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:24:13.291461 140499680737024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:24:13.291610 140499680737024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:24:13.291779 140500588918208 error_handling.py:96] outfeed marked as finished
I0815 01:24:13.291927 140500588918208 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:24:42.625732 140500588918208 evaluation.py:275] Finished evaluation at 2019-08-15-01:24:42
I0815 01:24:42.626060 140500588918208 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9765, global_step = 30, loss = 0.095907725
I0815 01:24:47.310976 140500588918208 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:24:48.219050 140500588918208 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.095907725, 'global_step': 30, 'accuracy': 0.9765}

Removing gs://yangyou-mnist/log/#1565832088320533...
Removing gs://yangyou-mnist/log/checkpoint#1565832168674527...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565832088.v3-8-tpu#1565832171930808...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565832101152807...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565832105632897...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565832165452264...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565832166367944...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565832093288929...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565832100261498...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565832170945003...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565832284.v3-8-tpu#1565832287914398...
Removing gs://yangyou-mnist/log/eval/#1565832284331963...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:24:52.077136 139837660366272 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:24:52.077925 139837660366272 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:24:52.080673 139837660366272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:24:52.081511 139837660366272 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:24:52.082097 139837660366272 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:24:52.082226 139837660366272 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:24:52.505171 139837660366272 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:24:52.513134 139837660366272 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:24:52.517700 139837660366272 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:24:52.563836 139837660366272 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:24:52.564133 139837660366272 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:24:52.810985 139837660366272 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:24:52.919871 139837660366272 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:24:52.920155 139837660366272 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:24:53.266712 139837660366272 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f2e583be0d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f2e5a59c210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:24:53.267093 139837660366272 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:24:53.580519 139837660366272 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:24:53.583309: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:24:53.596576 139837660366272 tpu_system_metadata.py:148] Found TPU system:
I0815 01:24:53.596828 139837660366272 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:24:53.597301 139837660366272 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:24:53.597366 139837660366272 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:24:53.597426 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:24:53.597841 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:24:53.597899 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:24:53.597949 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:24:53.597999 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:24:53.598047 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:24:53.598093 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:24:53.598140 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:24:53.598191 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:24:53.598256 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:24:53.598304 139837660366272 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:24:53.604574 139837660366272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:24:53.617767 139837660366272 estimator.py:1145] Calling model_fn.
W0815 01:24:53.618396 139837660366272 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:24:53.894745 139837660366272 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:24:54.315202 139837660366272 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:24:54.379818 139837660366272 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:24:54.386082 139837660366272 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:24:54.569262 139837660366272 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:24:54.583076 139837660366272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:24:54.595207 139837660366272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:24:54.600702 139837660366272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:24:54.606267 139837660366272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:24:54.623930 139837660366272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:24:54.624150 139837660366272 optimization.py:32] ++++++ warmup starts at step 0, for 9 steps ++++++
W0815 01:24:54.624281 139837660366272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:24:54.736067 139837660366272 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:24:54.778187 139837660366272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:24:54.823105 139837660366272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:24:54.874799 139837660366272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:24:55.042232 139837660366272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:24:55.094897 139837660366272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:24:55.143994 139837660366272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:24:55.195240 139837660366272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:24:55.243396 139837660366272 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:24:55.285356 139837660366272 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:24:55.302577 139837660366272 estimator.py:1147] Done calling model_fn.
I0815 01:24:58.759396 139837660366272 tpu_estimator.py:499] TPU job name worker
I0815 01:24:58.871786 139837660366272 monitored_session.py:240] Graph was finalized.
I0815 01:24:59.590524 139837660366272 session_manager.py:500] Running local_init_op.
I0815 01:24:59.645773 139837660366272 session_manager.py:502] Done running local_init_op.
I0815 01:25:02.465810 139837660366272 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:25:15.332036 139837660366272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:25:15.481940 139837660366272 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:25:15.482429 139837660366272 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:25:15.482830: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:25:15.488301 139837660366272 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:25:15.490844 139837660366272 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:25:15.495305 139837660366272 tpu_estimator.py:557] Init TPU system
I0815 01:25:56.034260 139837660366272 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 01:25:56.035363 139836965594880 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:25:56.036202 139836484744960 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:25:56.097254 139836476352256 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:25:56.105534 139837660366272 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:25:56.107059 139837660366272 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 01:25:56.430150 139836476352256 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0815 01:26:01.028460 139836484744960 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:26:05.710799 139837660366272 basic_session_run_hooks.py:262] loss = 0.084049195, step = 30
I0815 01:26:05.713767 139837660366272 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:26:19.124476 139837660366272 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:26:19.124900 139837660366272 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:26:19.125303 139836965594880 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:26:19.125621 139836965594880 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:26:19.125961 139837660366272 error_handling.py:96] infeed marked as finished
I0815 01:26:19.126156 139837660366272 tpu_estimator.py:602] Stop output thread controller
I0815 01:26:19.126219 139837660366272 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:26:19.126477 139836484744960 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:26:19.126638 139836484744960 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:26:19.126894 139837660366272 error_handling.py:96] outfeed marked as finished
I0815 01:26:19.127033 139837660366272 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:26:26.559401 139837660366272 estimator.py:368] Loss for final step: 0.084049195.
I0815 01:26:26.560242 139837660366272 error_handling.py:96] training_loop marked as finished
I0815 01:26:27.405184 139837660366272 estimator.py:1145] Calling model_fn.
E0815 01:26:28.093733 139837660366272 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:26:28.315294 139837660366272 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:26:28.338481 139837660366272 estimator.py:1147] Done calling model_fn.
I0815 01:26:28.354371 139837660366272 evaluation.py:255] Starting evaluation at 2019-08-15T01:26:28Z
I0815 01:26:28.354626 139837660366272 tpu_estimator.py:499] TPU job name worker
I0815 01:26:28.430521 139837660366272 monitored_session.py:240] Graph was finalized.
W0815 01:26:28.431269 139837660366272 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:26:28.643418 139837660366272 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:26:31.515839 139837660366272 session_manager.py:500] Running local_init_op.
I0815 01:26:31.542721 139837660366272 session_manager.py:502] Done running local_init_op.
I0815 01:26:31.598931 139837660366272 tpu_estimator.py:557] Init TPU system
I0815 01:27:40.058470 139837660366272 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:27:40.059401 139836484744960 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:27:40.059874 139836476352256 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:27:40.131453 139837660366272 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:27:40.161919 139837660366272 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:27:40.162252 139837660366272 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:27:40.189045 139836467959552 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:27:40.457837 139836467959552 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:27:40.970880 139836476352256 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:27:41.222212 139837660366272 evaluation.py:167] Evaluation [10/10]
I0815 01:27:41.222558 139837660366272 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:27:41.222632 139837660366272 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:27:41.222826 139836484744960 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:27:41.222922 139836484744960 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:27:41.223093 139837660366272 error_handling.py:96] infeed marked as finished
I0815 01:27:41.223186 139837660366272 tpu_estimator.py:602] Stop output thread controller
I0815 01:27:41.223306 139837660366272 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:27:41.223432 139836476352256 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:27:41.223511 139836476352256 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:27:41.223629 139837660366272 error_handling.py:96] outfeed marked as finished
I0815 01:27:41.223706 139837660366272 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:28:10.548130 139837660366272 evaluation.py:275] Finished evaluation at 2019-08-15-01:28:10
I0815 01:28:10.548537 139837660366272 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9775, global_step = 30, loss = 0.07562932
I0815 01:28:15.010705 139837660366272 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:28:15.976227 139837660366272 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.07562932, 'global_step': 30, 'accuracy': 0.9775}

Removing gs://yangyou-mnist/log/#1565832296868116...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565832310157192...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565832314813614...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565832373248303...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565832372378212...
Removing gs://yangyou-mnist/log/checkpoint#1565832375635617...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565832297.v3-8-tpu#1565832378809321...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565832301889287...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565832308877761...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565832377863549...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      Removing gs://yangyou-mnist/log/eval/#1565832492248543...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565832492.v3-8-tpu#1565832495670341...
/ [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:28:19.819598 140540690949568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:28:19.820374 140540690949568 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:28:19.823510 140540690949568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:28:19.824342 140540690949568 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:28:19.824956 140540690949568 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:28:19.825086 140540690949568 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:28:20.237905 140540690949568 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:28:20.244858 140540690949568 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:28:20.249190 140540690949568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:28:20.355246 140540690949568 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:28:20.355546 140540690949568 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:28:20.690956 140540690949568 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:28:20.798201 140540690949568 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:28:20.798506 140540690949568 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:28:20.961201 140540690949568 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd2081f40d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd20a3d2210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:28:20.961585 140540690949568 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:28:21.286356 140540690949568 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:28:21.289695: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:28:21.305182 140540690949568 tpu_system_metadata.py:148] Found TPU system:
I0815 01:28:21.305478 140540690949568 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:28:21.305994 140540690949568 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:28:21.306054 140540690949568 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:28:21.306107 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:28:21.306438 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:28:21.306503 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:28:21.306552 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:28:21.306601 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:28:21.306649 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:28:21.306696 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:28:21.306742 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:28:21.306790 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:28:21.306849 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:28:21.306896 140540690949568 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:28:21.312998 140540690949568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:28:21.325370 140540690949568 estimator.py:1145] Calling model_fn.
W0815 01:28:21.325980 140540690949568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:28:21.595004 140540690949568 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:28:22.031944 140540690949568 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:28:22.092478 140540690949568 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:28:22.098167 140540690949568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:28:22.275192 140540690949568 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:28:22.288542 140540690949568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:28:22.300189 140540690949568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:28:22.305778 140540690949568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:28:22.311424 140540690949568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:28:22.328427 140540690949568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:28:22.328666 140540690949568 optimization.py:32] ++++++ warmup starts at step 0, for 9 steps ++++++
W0815 01:28:22.328795 140540690949568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:28:22.436700 140540690949568 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:28:22.477807 140540690949568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:28:22.522372 140540690949568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:28:22.572909 140540690949568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:28:22.745388 140540690949568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:28:22.795145 140540690949568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:28:22.842386 140540690949568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:28:22.890898 140540690949568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:28:22.935801 140540690949568 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:28:22.976571 140540690949568 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:28:22.992815 140540690949568 estimator.py:1147] Done calling model_fn.
I0815 01:28:26.398029 140540690949568 tpu_estimator.py:499] TPU job name worker
I0815 01:28:26.517576 140540690949568 monitored_session.py:240] Graph was finalized.
I0815 01:28:27.194681 140540690949568 session_manager.py:500] Running local_init_op.
I0815 01:28:27.256954 140540690949568 session_manager.py:502] Done running local_init_op.
I0815 01:28:29.986279 140540690949568 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:28:42.577398 140540690949568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:28:42.724848 140540690949568 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:28:42.725351 140540690949568 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:28:42.725767: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:28:42.731301 140540690949568 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:28:42.733441 140540690949568 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:28:42.737112 140540690949568 tpu_estimator.py:557] Init TPU system
I0815 01:29:24.127563 140540690949568 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0815 01:29:24.128514 140539996178176 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:29:24.129004 140539517204224 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:29:24.184223 140539508811520 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:29:24.201965 140540690949568 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:29:24.202877 140540690949568 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 01:29:24.453531 140539508811520 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:29:29.231728 140539517204224 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:29:33.927963 140540690949568 basic_session_run_hooks.py:262] loss = 0.08559624, step = 30
I0815 01:29:33.930507 140540690949568 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:29:49.006472 140540690949568 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:29:49.006789 140540690949568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:29:49.007021 140539996178176 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:29:49.007138 140539996178176 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:29:49.007281 140540690949568 error_handling.py:96] infeed marked as finished
I0815 01:29:49.007383 140540690949568 tpu_estimator.py:602] Stop output thread controller
I0815 01:29:49.007432 140540690949568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:29:49.007548 140539517204224 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:29:49.007623 140539517204224 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:29:49.007735 140540690949568 error_handling.py:96] outfeed marked as finished
I0815 01:29:49.007824 140540690949568 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:29:54.574903 140540690949568 estimator.py:368] Loss for final step: 0.08559624.
I0815 01:29:54.575706 140540690949568 error_handling.py:96] training_loop marked as finished
I0815 01:29:55.413733 140540690949568 estimator.py:1145] Calling model_fn.
E0815 01:29:56.216099 140540690949568 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:29:56.443401 140540690949568 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:29:56.465332 140540690949568 estimator.py:1147] Done calling model_fn.
I0815 01:29:56.482100 140540690949568 evaluation.py:255] Starting evaluation at 2019-08-15T01:29:56Z
I0815 01:29:56.482347 140540690949568 tpu_estimator.py:499] TPU job name worker
I0815 01:29:56.559165 140540690949568 monitored_session.py:240] Graph was finalized.
W0815 01:29:56.559952 140540690949568 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:29:56.757778 140540690949568 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:29:59.458020 140540690949568 session_manager.py:500] Running local_init_op.
I0815 01:29:59.489131 140540690949568 session_manager.py:502] Done running local_init_op.
I0815 01:29:59.544203 140540690949568 tpu_estimator.py:557] Init TPU system
I0815 01:31:08.059103 140540690949568 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:31:08.059981 140539517204224 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:31:08.060539 140539508811520 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:31:08.130767 140540690949568 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:31:08.160204 140540690949568 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:31:08.160656 140540690949568 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:31:08.184956 140539500418816 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:31:08.494930 140539500418816 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:31:08.952538 140539508811520 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:31:09.355696 140540690949568 evaluation.py:167] Evaluation [10/10]
I0815 01:31:09.356065 140540690949568 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:31:09.356153 140540690949568 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:31:09.356323 140539517204224 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:31:09.356450 140539517204224 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:31:09.356592 140540690949568 error_handling.py:96] infeed marked as finished
I0815 01:31:09.356687 140540690949568 tpu_estimator.py:602] Stop output thread controller
I0815 01:31:09.356734 140540690949568 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:31:09.356842 140539508811520 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:31:09.356925 140539508811520 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:31:09.357040 140540690949568 error_handling.py:96] outfeed marked as finished
I0815 01:31:09.357127 140540690949568 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:31:38.595820 140540690949568 evaluation.py:275] Finished evaluation at 2019-08-15-01:31:38
I0815 01:31:38.596172 140540690949568 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9755, global_step = 30, loss = 0.087171406
I0815 01:31:43.851087 140540690949568 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:31:44.773864 140540690949568 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.087171406, 'global_step': 30, 'accuracy': 0.9755}

Removing gs://yangyou-mnist/log/#1565832504554709...
Removing gs://yangyou-mnist/log/checkpoint#1565832584358990...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565832504.v3-8-tpu#1565832588699429...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565832509414198...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565832517357576...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565832522065056...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565832581097944...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565832516416066...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565832582038035...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565832586692353...
Removing gs://yangyou-mnist/log/eval/#1565832700302824...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565832700.v3-8-tpu#1565832704465419...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:31:48.528290 140092581385664 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:31:48.529618 140092581385664 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:31:48.532293 140092581385664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:31:48.533169 140092581385664 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:31:48.533771 140092581385664 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:31:48.533898 140092581385664 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:31:48.951807 140092581385664 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:31:48.958503 140092581385664 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:31:48.962276 140092581385664 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:31:49.008239 140092581385664 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:31:49.008546 140092581385664 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:31:49.198724 140092581385664 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:31:49.242336 140092581385664 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:31:49.242620 140092581385664 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:31:49.439126 140092581385664 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f69b2b5f290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f69b4d3d210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:31:49.439508 140092581385664 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:31:49.764895 140092581385664 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:31:49.767988: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:31:49.779737 140092581385664 tpu_system_metadata.py:148] Found TPU system:
I0815 01:31:49.779977 140092581385664 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:31:49.780536 140092581385664 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:31:49.780607 140092581385664 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:31:49.780673 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:31:49.780991 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:31:49.781049 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:31:49.781105 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:31:49.781152 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:31:49.781200 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:31:49.781246 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:31:49.781292 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:31:49.781338 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:31:49.781384 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:31:49.781431 140092581385664 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:31:49.787606 140092581385664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:31:49.800461 140092581385664 estimator.py:1145] Calling model_fn.
W0815 01:31:49.801125 140092581385664 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:31:50.069348 140092581385664 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:31:50.476731 140092581385664 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:31:50.539542 140092581385664 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:31:50.545582 140092581385664 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:31:50.728116 140092581385664 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:31:50.741981 140092581385664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:31:50.754481 140092581385664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:31:50.759912 140092581385664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:31:50.765378 140092581385664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:31:50.783047 140092581385664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:31:50.783265 140092581385664 optimization.py:32] ++++++ warmup starts at step 0, for 10 steps ++++++
W0815 01:31:50.783390 140092581385664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:31:50.894819 140092581385664 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:31:50.937925 140092581385664 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:31:50.982928 140092581385664 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:31:51.035028 140092581385664 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:31:51.205274 140092581385664 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:31:51.264141 140092581385664 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:31:51.314291 140092581385664 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:31:51.366401 140092581385664 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:31:51.413225 140092581385664 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:31:51.454935 140092581385664 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:31:51.471286 140092581385664 estimator.py:1147] Done calling model_fn.
I0815 01:31:54.799195 140092581385664 tpu_estimator.py:499] TPU job name worker
I0815 01:31:54.912724 140092581385664 monitored_session.py:240] Graph was finalized.
I0815 01:31:55.621602 140092581385664 session_manager.py:500] Running local_init_op.
I0815 01:31:55.674014 140092581385664 session_manager.py:502] Done running local_init_op.
I0815 01:31:58.320301 140092581385664 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:32:12.220271 140092581385664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:32:12.390136 140092581385664 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:32:12.390589 140092581385664 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:32:12.391090: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:32:12.396060 140092581385664 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:32:12.398154 140092581385664 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:32:12.403903 140092581385664 tpu_estimator.py:557] Init TPU system
I0815 01:32:52.126482 140092581385664 tpu_estimator.py:566] Initialized TPU in 39 seconds
I0815 01:32:52.127644 140091682969344 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:32:52.128451 140091674576640 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:32:52.191453 140091666183936 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:32:52.197762 140092581385664 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:32:52.199009 140092581385664 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 01:32:52.485161 140091666183936 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health UNHEALTHY_TENSORFLOW.
I0815 01:32:56.970648 140091674576640 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:33:01.880949 140092581385664 basic_session_run_hooks.py:262] loss = 0.09338787, step = 30
I0815 01:33:01.883613 140092581385664 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:33:18.047681 140092581385664 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:33:18.047960 140092581385664 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:33:18.048280 140091682969344 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:33:18.048670 140091682969344 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:33:18.048890 140092581385664 error_handling.py:96] infeed marked as finished
I0815 01:33:18.049108 140092581385664 tpu_estimator.py:602] Stop output thread controller
I0815 01:33:18.049180 140092581385664 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:33:18.049350 140091674576640 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:33:18.049591 140091674576640 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:33:18.049742 140092581385664 error_handling.py:96] outfeed marked as finished
I0815 01:33:18.049874 140092581385664 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:33:22.632608 140092581385664 estimator.py:368] Loss for final step: 0.09338787.
I0815 01:33:22.633660 140092581385664 error_handling.py:96] training_loop marked as finished
I0815 01:33:23.479314 140092581385664 estimator.py:1145] Calling model_fn.
E0815 01:33:24.221734 140092581385664 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:33:24.448986 140092581385664 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:33:24.471746 140092581385664 estimator.py:1147] Done calling model_fn.
I0815 01:33:24.490025 140092581385664 evaluation.py:255] Starting evaluation at 2019-08-15T01:33:24Z
I0815 01:33:24.490298 140092581385664 tpu_estimator.py:499] TPU job name worker
I0815 01:33:24.574603 140092581385664 monitored_session.py:240] Graph was finalized.
W0815 01:33:24.575325 140092581385664 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:33:24.843969 140092581385664 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:33:27.549803 140092581385664 session_manager.py:500] Running local_init_op.
I0815 01:33:27.574542 140092581385664 session_manager.py:502] Done running local_init_op.
I0815 01:33:27.634561 140092581385664 tpu_estimator.py:557] Init TPU system
I0815 01:34:36.050520 140092581385664 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:34:36.051563 140091681134336 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:34:36.051950 140091672741632 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:34:36.121143 140092581385664 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:34:36.147830 140092581385664 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:34:36.148202 140092581385664 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:34:36.246908 140091664348928 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:34:36.533688 140091664348928 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:34:36.971080 140091672741632 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:34:37.248310 140092581385664 evaluation.py:167] Evaluation [10/10]
I0815 01:34:37.248667 140092581385664 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:34:37.248754 140092581385664 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:34:37.248924 140091681134336 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:34:37.249007 140091681134336 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:34:37.249140 140092581385664 error_handling.py:96] infeed marked as finished
I0815 01:34:37.249228 140092581385664 tpu_estimator.py:602] Stop output thread controller
I0815 01:34:37.249274 140092581385664 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:34:37.249380 140091672741632 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:34:37.249452 140091672741632 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:34:37.249562 140092581385664 error_handling.py:96] outfeed marked as finished
I0815 01:34:37.249640 140092581385664 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:35:06.621366 140092581385664 evaluation.py:275] Finished evaluation at 2019-08-15-01:35:06
I0815 01:35:06.621695 140092581385664 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9745, global_step = 30, loss = 0.08567171
I0815 01:35:11.084733 140092581385664 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:35:11.877625 140092581385664 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08567171, 'global_step': 30, 'accuracy': 0.9745}

Removing gs://yangyou-mnist/log/checkpoint#1565832793572206...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565832717743898...
Removing gs://yangyou-mnist/log/#1565832712958938...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565832713.v3-8-tpu#1565832797742033...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565832727216627...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565832731709777...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565832790471281...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565832726361683...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565832791459831...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565832796674311...
Removing gs://yangyou-mnist/log/eval/#1565832908318039...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565832908.v3-8-tpu#1565832911569252...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:35:15.695059 139788900894144 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:35:15.695838 139788900894144 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:35:15.698470 139788900894144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:35:15.699290 139788900894144 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:35:15.699866 139788900894144 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:35:15.699995 139788900894144 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:35:16.105652 139788900894144 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:35:16.118305 139788900894144 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:35:16.131823 139788900894144 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:35:16.185204 139788900894144 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:35:16.185512 139788900894144 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:35:16.537755 139788900894144 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:35:16.591465 139788900894144 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:35:16.591723 139788900894144 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:35:16.993253 139788900894144 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f22fdf161d0>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f23000f4210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:35:16.993674 139788900894144 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:35:17.326174 139788900894144 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:35:17.329091: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:35:17.341197 139788900894144 tpu_system_metadata.py:148] Found TPU system:
I0815 01:35:17.341442 139788900894144 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:35:17.341962 139788900894144 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:35:17.342020 139788900894144 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:35:17.342080 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:35:17.342369 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:35:17.342425 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:35:17.342474 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:35:17.342523 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:35:17.342571 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:35:17.342637 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:35:17.342684 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:35:17.342730 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:35:17.342776 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:35:17.342822 139788900894144 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:35:17.348757 139788900894144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:35:17.361238 139788900894144 estimator.py:1145] Calling model_fn.
W0815 01:35:17.361836 139788900894144 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:35:17.625682 139788900894144 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:35:18.046310 139788900894144 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:35:18.108365 139788900894144 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:35:18.114443 139788900894144 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:35:18.295038 139788900894144 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:35:18.308859 139788900894144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:35:18.320972 139788900894144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:35:18.326488 139788900894144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:35:18.332009 139788900894144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:35:18.349381 139788900894144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:35:18.349594 139788900894144 optimization.py:32] ++++++ warmup starts at step 0, for 10 steps ++++++
W0815 01:35:18.349716 139788900894144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:35:18.458117 139788900894144 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:35:18.499542 139788900894144 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:35:18.543724 139788900894144 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:35:18.594611 139788900894144 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:35:18.753511 139788900894144 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:35:18.803795 139788900894144 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:35:18.853010 139788900894144 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:35:18.903978 139788900894144 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:35:18.950062 139788900894144 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:35:18.991209 139788900894144 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:35:19.007281 139788900894144 estimator.py:1147] Done calling model_fn.
I0815 01:35:22.507066 139788900894144 tpu_estimator.py:499] TPU job name worker
I0815 01:35:22.617958 139788900894144 monitored_session.py:240] Graph was finalized.
I0815 01:35:23.275836 139788900894144 session_manager.py:500] Running local_init_op.
I0815 01:35:23.324861 139788900894144 session_manager.py:502] Done running local_init_op.
I0815 01:35:26.018887 139788900894144 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:35:38.726869 139788900894144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:35:38.906632 139788900894144 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:35:38.907166 139788900894144 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:35:38.907539: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:35:38.912519 139788900894144 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:35:38.914586 139788900894144 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:35:38.919301 139788900894144 tpu_estimator.py:557] Init TPU system
I0815 01:36:20.134545 139788900894144 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0815 01:36:20.135509 139788004607744 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:36:20.135909 139787996215040 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:36:20.200826 139787987822336 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:36:20.207056 139788900894144 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:36:20.207813 139788900894144 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 01:36:20.487199 139787987822336 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:36:25.027590 139787996215040 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:36:29.721977 139788900894144 basic_session_run_hooks.py:262] loss = 0.09256174, step = 30
I0815 01:36:29.724577 139788900894144 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:36:43.161670 139788900894144 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:36:43.161962 139788900894144 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:36:43.162296 139788004607744 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:36:43.162677 139788004607744 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:36:43.163163 139788900894144 error_handling.py:96] infeed marked as finished
I0815 01:36:43.163522 139788900894144 tpu_estimator.py:602] Stop output thread controller
I0815 01:36:43.163583 139788900894144 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:36:43.163768 139787996215040 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:36:43.163949 139787996215040 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:36:43.164161 139788900894144 error_handling.py:96] outfeed marked as finished
I0815 01:36:43.164355 139788900894144 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:36:50.636902 139788900894144 estimator.py:368] Loss for final step: 0.09256174.
I0815 01:36:50.637751 139788900894144 error_handling.py:96] training_loop marked as finished
I0815 01:36:51.341643 139788900894144 estimator.py:1145] Calling model_fn.
E0815 01:36:52.131635 139788900894144 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:36:52.361411 139788900894144 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:36:52.383747 139788900894144 estimator.py:1147] Done calling model_fn.
I0815 01:36:52.401072 139788900894144 evaluation.py:255] Starting evaluation at 2019-08-15T01:36:52Z
I0815 01:36:52.401312 139788900894144 tpu_estimator.py:499] TPU job name worker
I0815 01:36:52.480731 139788900894144 monitored_session.py:240] Graph was finalized.
W0815 01:36:52.481492 139788900894144 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:36:52.690828 139788900894144 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:36:55.518450 139788900894144 session_manager.py:500] Running local_init_op.
I0815 01:36:55.549207 139788900894144 session_manager.py:502] Done running local_init_op.
I0815 01:36:55.603032 139788900894144 tpu_estimator.py:557] Init TPU system
I0815 01:38:04.031388 139788900894144 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:38:04.032311 139788000937728 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:38:04.032780 139787992545024 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:38:04.103136 139788900894144 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:38:04.129461 139788900894144 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:38:04.129897 139788900894144 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:38:04.229010 139787979167488 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:38:04.683855 139787979167488 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:38:04.945808 139787992545024 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:38:05.251997 139788900894144 evaluation.py:167] Evaluation [10/10]
I0815 01:38:05.252319 139788900894144 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:38:05.252424 139788900894144 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:38:05.252598 139788000937728 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:38:05.252691 139788000937728 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:38:05.252921 139788900894144 error_handling.py:96] infeed marked as finished
I0815 01:38:05.253036 139788900894144 tpu_estimator.py:602] Stop output thread controller
I0815 01:38:05.253088 139788900894144 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:38:05.253204 139787992545024 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:38:05.253283 139787992545024 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:38:05.253393 139788900894144 error_handling.py:96] outfeed marked as finished
I0815 01:38:05.253470 139788900894144 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:38:34.790555 139788900894144 evaluation.py:275] Finished evaluation at 2019-08-15-01:38:34
I0815 01:38:34.790901 139788900894144 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9734, global_step = 30, loss = 0.08696289
I0815 01:38:39.426371 139788900894144 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:38:40.264147 139788900894144 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.08696289, 'global_step': 30, 'accuracy': 0.9734}

Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565832933696684...
Removing gs://yangyou-mnist/log/#1565832920554376...
Removing gs://yangyou-mnist/log/checkpoint#1565832999798827...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565832938145568...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565832925408997...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565832920.v3-8-tpu#1565833002852542...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565832996632743...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565832997543307...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565832932689085...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565833001913000...
Removing gs://yangyou-mnist/log/eval/#1565833116571558...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565833116.v3-8-tpu#1565833119955178...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:38:44.557645 140046340289984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:38:44.558480 140046340289984 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:38:44.561273 140046340289984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:38:44.562105 140046340289984 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:38:44.562699 140046340289984 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:38:44.562844 140046340289984 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:38:44.983922 140046340289984 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:38:44.990549 140046340289984 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:38:44.994133 140046340289984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:38:45.113976 140046340289984 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:38:45.114289 140046340289984 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:38:45.473383 140046340289984 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:38:45.589737 140046340289984 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:38:45.590051 140046340289984 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:38:45.737967 140046340289984 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f5eee86d090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f5ef0a4b1d0>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:38:45.738337 140046340289984 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:38:46.063630 140046340289984 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:38:46.066799: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:38:46.078469 140046340289984 tpu_system_metadata.py:148] Found TPU system:
I0815 01:38:46.078741 140046340289984 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:38:46.079271 140046340289984 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:38:46.079440 140046340289984 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:38:46.079534 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:38:46.079937 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:38:46.080003 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:38:46.080054 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:38:46.080131 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:38:46.080179 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:38:46.080244 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:38:46.080300 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:38:46.080360 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:38:46.080452 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:38:46.080517 140046340289984 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:38:46.087045 140046340289984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:38:46.099978 140046340289984 estimator.py:1145] Calling model_fn.
W0815 01:38:46.100651 140046340289984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:38:46.371931 140046340289984 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:38:46.850179 140046340289984 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:38:46.912007 140046340289984 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:38:46.917938 140046340289984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:38:47.104765 140046340289984 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:38:47.118997 140046340289984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:38:47.131222 140046340289984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:38:47.137001 140046340289984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:38:47.142615 140046340289984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:38:47.160528 140046340289984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:38:47.160770 140046340289984 optimization.py:32] ++++++ warmup starts at step 0, for 10 steps ++++++
W0815 01:38:47.160908 140046340289984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:38:47.272013 140046340289984 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:38:47.313345 140046340289984 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:38:47.358387 140046340289984 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:38:47.410305 140046340289984 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:38:47.586690 140046340289984 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:38:47.637578 140046340289984 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:38:47.686677 140046340289984 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:38:47.737821 140046340289984 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:38:47.783369 140046340289984 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:38:47.825615 140046340289984 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:38:47.842041 140046340289984 estimator.py:1147] Done calling model_fn.
I0815 01:38:51.342199 140046340289984 tpu_estimator.py:499] TPU job name worker
I0815 01:38:51.453705 140046340289984 monitored_session.py:240] Graph was finalized.
I0815 01:38:52.208813 140046340289984 session_manager.py:500] Running local_init_op.
I0815 01:38:52.261509 140046340289984 session_manager.py:502] Done running local_init_op.
I0815 01:38:55.079740 140046340289984 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:39:07.602386 140046340289984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:39:07.783164 140046340289984 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:39:07.783682 140046340289984 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:39:07.784091: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:39:07.789627 140046340289984 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:39:07.791625 140046340289984 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:39:07.796534 140046340289984 tpu_estimator.py:557] Init TPU system
I0815 01:39:48.128359 140046340289984 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 01:39:48.129486 140045444175616 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:39:48.130398 140045435782912 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:39:48.192749 140045427390208 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:39:48.201060 140046340289984 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:39:48.202539 140046340289984 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 01:39:48.373784 140045427390208 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:39:53.201800 140045435782912 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:39:57.855226 140046340289984 basic_session_run_hooks.py:262] loss = 0.08205709, step = 30
I0815 01:39:57.857700 140046340289984 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:40:12.497169 140046340289984 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:40:12.497487 140046340289984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:40:12.497881 140045444175616 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:40:12.498193 140045444175616 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:40:12.498394 140046340289984 error_handling.py:96] infeed marked as finished
I0815 01:40:12.498608 140046340289984 tpu_estimator.py:602] Stop output thread controller
I0815 01:40:12.498672 140046340289984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:40:12.498840 140045435782912 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:40:12.499010 140045435782912 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:40:12.499159 140046340289984 error_handling.py:96] outfeed marked as finished
I0815 01:40:12.499285 140046340289984 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:40:18.519313 140046340289984 estimator.py:368] Loss for final step: 0.08205709.
I0815 01:40:18.520153 140046340289984 error_handling.py:96] training_loop marked as finished
I0815 01:40:19.330158 140046340289984 estimator.py:1145] Calling model_fn.
E0815 01:40:20.012557 140046340289984 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:40:20.237396 140046340289984 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:40:20.259445 140046340289984 estimator.py:1147] Done calling model_fn.
I0815 01:40:20.275993 140046340289984 evaluation.py:255] Starting evaluation at 2019-08-15T01:40:20Z
I0815 01:40:20.276242 140046340289984 tpu_estimator.py:499] TPU job name worker
I0815 01:40:20.353482 140046340289984 monitored_session.py:240] Graph was finalized.
W0815 01:40:20.354284 140046340289984 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:40:20.564747 140046340289984 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:40:23.523251 140046340289984 session_manager.py:500] Running local_init_op.
I0815 01:40:23.554126 140046340289984 session_manager.py:502] Done running local_init_op.
I0815 01:40:23.614082 140046340289984 tpu_estimator.py:557] Init TPU system
I0815 01:41:32.043477 140046340289984 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:41:32.044359 140045440505600 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:41:32.044768 140045432112896 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:41:32.117510 140046340289984 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:41:32.148068 140046340289984 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:41:32.148514 140046340289984 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:41:32.169672 140045418735360 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:41:32.607426 140045418735360 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:41:32.915452 140045432112896 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:41:33.321770 140046340289984 evaluation.py:167] Evaluation [10/10]
I0815 01:41:33.322081 140046340289984 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:41:33.322176 140046340289984 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:41:33.322361 140045440505600 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:41:33.322451 140045440505600 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:41:33.322674 140046340289984 error_handling.py:96] infeed marked as finished
I0815 01:41:33.322777 140046340289984 tpu_estimator.py:602] Stop output thread controller
I0815 01:41:33.322834 140046340289984 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:41:33.322947 140045432112896 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:41:33.323019 140045432112896 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:41:33.323138 140046340289984 error_handling.py:96] outfeed marked as finished
I0815 01:41:33.323225 140046340289984 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:42:02.674318 140046340289984 evaluation.py:275] Finished evaluation at 2019-08-15-01:42:02
I0815 01:42:02.674783 140046340289984 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9775, global_step = 30, loss = 0.06947495
I0815 01:42:07.192789 140046340289984 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:42:07.994827 140046340289984 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06947495, 'global_step': 30, 'accuracy': 0.9775}

Removing gs://yangyou-mnist/log/#1565833129434455...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565833134500163...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565833141677143...
Removing gs://yangyou-mnist/log/checkpoint#1565833208765173...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565833129.v3-8-tpu#1565833212179438...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565833142647908...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565833205549305...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565833204634108...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565833147089606...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565833211141469...
Removing gs://yangyou-mnist/log/eval/#1565833324401211...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565833324.v3-8-tpu#1565833327678187...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:42:11.881578 140551315531200 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:42:11.882394 140551315531200 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:42:11.885514 140551315531200 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:42:11.886358 140551315531200 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:42:11.886967 140551315531200 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:42:11.887100 140551315531200 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:42:12.315488 140551315531200 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:42:12.323767 140551315531200 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:42:12.328166 140551315531200 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:42:12.376645 140551315531200 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:42:12.376938 140551315531200 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:42:12.604891 140551315531200 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:42:12.646465 140551315531200 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:42:12.646776 140551315531200 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:42:12.799213 140551315531200 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fd481658090>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fd483836210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:42:12.799608 140551315531200 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:42:13.123415 140551315531200 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:42:13.126818: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:42:13.140727 140551315531200 tpu_system_metadata.py:148] Found TPU system:
I0815 01:42:13.140966 140551315531200 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:42:13.141457 140551315531200 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:42:13.141515 140551315531200 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:42:13.141594 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:42:13.141884 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:42:13.141940 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:42:13.141990 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:42:13.142039 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:42:13.142090 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:42:13.142144 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:42:13.142193 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:42:13.142240 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:42:13.142286 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:42:13.142334 140551315531200 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:42:13.148776 140551315531200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:42:13.161753 140551315531200 estimator.py:1145] Calling model_fn.
W0815 01:42:13.162367 140551315531200 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:42:13.435889 140551315531200 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:42:13.938458 140551315531200 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:42:14.001230 140551315531200 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:42:14.007328 140551315531200 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:42:14.189183 140551315531200 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:42:14.203210 140551315531200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:42:14.215533 140551315531200 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:42:14.221141 140551315531200 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:42:14.226599 140551315531200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:42:14.245090 140551315531200 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:42:14.245312 140551315531200 optimization.py:32] ++++++ warmup starts at step 0, for 10 steps ++++++
W0815 01:42:14.245440 140551315531200 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:42:14.363702 140551315531200 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:42:14.405639 140551315531200 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:42:14.450189 140551315531200 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:42:14.502118 140551315531200 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:42:14.668894 140551315531200 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:42:14.719322 140551315531200 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:42:14.769689 140551315531200 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:42:14.821302 140551315531200 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:42:14.867671 140551315531200 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:42:14.911653 140551315531200 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:42:14.928220 140551315531200 estimator.py:1147] Done calling model_fn.
I0815 01:42:18.536465 140551315531200 tpu_estimator.py:499] TPU job name worker
I0815 01:42:18.646684 140551315531200 monitored_session.py:240] Graph was finalized.
I0815 01:42:19.372915 140551315531200 session_manager.py:500] Running local_init_op.
I0815 01:42:19.423466 140551315531200 session_manager.py:502] Done running local_init_op.
I0815 01:42:22.242157 140551315531200 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:42:35.183701 140551315531200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:42:35.358951 140551315531200 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:42:35.359378 140551315531200 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:42:35.359769: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:42:35.364377 140551315531200 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:42:35.366841 140551315531200 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:42:35.370976 140551315531200 tpu_estimator.py:557] Init TPU system
I0815 01:43:16.078915 140551315531200 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 01:43:16.079735 140550553450240 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:43:16.080188 140550545057536 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:43:16.133634 140550536664832 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:43:16.150830 140551315531200 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:43:16.151633 140551315531200 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 01:43:16.418128 140550536664832 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:43:21.076426 140550545057536 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:43:25.685887 140551315531200 basic_session_run_hooks.py:262] loss = 0.081399776, step = 30
I0815 01:43:25.688899 140551315531200 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:43:39.601325 140551315531200 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:43:39.601640 140551315531200 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:43:39.602000 140550553450240 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:43:39.602348 140550553450240 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:43:39.602560 140551315531200 error_handling.py:96] infeed marked as finished
I0815 01:43:39.602752 140551315531200 tpu_estimator.py:602] Stop output thread controller
I0815 01:43:39.602835 140551315531200 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:43:39.603060 140550545057536 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:43:39.603254 140550545057536 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:43:39.603426 140551315531200 error_handling.py:96] outfeed marked as finished
I0815 01:43:39.603557 140551315531200 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:43:46.562454 140551315531200 estimator.py:368] Loss for final step: 0.081399776.
I0815 01:43:46.563380 140551315531200 error_handling.py:96] training_loop marked as finished
I0815 01:43:47.396456 140551315531200 estimator.py:1145] Calling model_fn.
E0815 01:43:48.086725 140551315531200 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:43:48.316963 140551315531200 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:43:48.339226 140551315531200 estimator.py:1147] Done calling model_fn.
I0815 01:43:48.355837 140551315531200 evaluation.py:255] Starting evaluation at 2019-08-15T01:43:48Z
I0815 01:43:48.356090 140551315531200 tpu_estimator.py:499] TPU job name worker
I0815 01:43:48.432818 140551315531200 monitored_session.py:240] Graph was finalized.
W0815 01:43:48.433608 140551315531200 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:43:48.646333 140551315531200 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:43:51.446324 140551315531200 session_manager.py:500] Running local_init_op.
I0815 01:43:51.473581 140551315531200 session_manager.py:502] Done running local_init_op.
I0815 01:43:51.533525 140551315531200 tpu_estimator.py:557] Init TPU system
I0815 01:45:00.080585 140551315531200 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:45:00.081702 140550549780224 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:45:00.082539 140550541387520 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:45:00.155909 140551315531200 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:45:00.184938 140551315531200 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:45:00.185309 140551315531200 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:45:00.214303 140550053295872 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:45:00.519145 140550053295872 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:45:00.992856 140550541387520 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:45:01.436503 140551315531200 evaluation.py:167] Evaluation [10/10]
I0815 01:45:01.436966 140551315531200 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:45:01.437060 140551315531200 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:45:01.437344 140550549780224 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:45:01.437629 140550549780224 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:45:01.437931 140551315531200 error_handling.py:96] infeed marked as finished
I0815 01:45:01.438162 140551315531200 tpu_estimator.py:602] Stop output thread controller
I0815 01:45:01.438230 140551315531200 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:45:01.438512 140550541387520 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:45:01.438703 140550541387520 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:45:01.438903 140551315531200 error_handling.py:96] outfeed marked as finished
I0815 01:45:01.439201 140551315531200 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:45:30.605876 140551315531200 evaluation.py:275] Finished evaluation at 2019-08-15-01:45:30
I0815 01:45:30.606178 140551315531200 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9791, global_step = 30, loss = 0.06120693
I0815 01:45:35.438216 140551315531200 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:45:36.300559 140551315531200 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06120693, 'global_step': 30, 'accuracy': 0.9791}

Removing gs://yangyou-mnist/log/#1565833336536170...
Removing gs://yangyou-mnist/log/checkpoint#1565833416070112...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565833341617675...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565833354676635...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565833350304713...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565833336.v3-8-tpu#1565833419293984...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565833349436385...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565833412851764...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565833413823737...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565833418302048...
Removing gs://yangyou-mnist/log/eval/#1565833532461435...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565833532.v3-8-tpu#1565833535970255...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:45:40.126513 139778199958976 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:45:40.127302 139778199958976 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:45:40.129935 139778199958976 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:45:40.130825 139778199958976 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:45:40.131520 139778199958976 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:45:40.131654 139778199958976 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:45:40.558954 139778199958976 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:45:40.567121 139778199958976 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:45:40.571336 139778199958976 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:45:40.629196 139778199958976 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:45:40.629509 139778199958976 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:45:41.009485 139778199958976 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:45:41.129425 139778199958976 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:45:41.129712 139778199958976 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:45:41.441939 139778199958976 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f20801e1290>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f20823bf210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:45:41.442378 139778199958976 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:45:41.779881 139778199958976 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:45:41.782825: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:45:41.795223 139778199958976 tpu_system_metadata.py:148] Found TPU system:
I0815 01:45:41.795484 139778199958976 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:45:41.796109 139778199958976 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:45:41.796175 139778199958976 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:45:41.796235 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:45:41.796629 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:45:41.796689 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:45:41.796741 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:45:41.796806 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:45:41.796854 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:45:41.796902 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:45:41.796948 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:45:41.797003 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:45:41.797049 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:45:41.797101 139778199958976 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:45:41.803184 139778199958976 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:45:41.816091 139778199958976 estimator.py:1145] Calling model_fn.
W0815 01:45:41.816812 139778199958976 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:45:42.093199 139778199958976 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:45:42.747268 139778199958976 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:45:42.810108 139778199958976 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:45:42.816350 139778199958976 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:45:42.999248 139778199958976 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:45:43.013592 139778199958976 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:45:43.026149 139778199958976 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:45:43.031827 139778199958976 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:45:43.037475 139778199958976 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:45:43.055193 139778199958976 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:45:43.055413 139778199958976 optimization.py:32] ++++++ warmup starts at step 0, for 10 steps ++++++
W0815 01:45:43.055538 139778199958976 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:45:43.176075 139778199958976 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:45:43.219480 139778199958976 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:45:43.264177 139778199958976 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:45:43.316447 139778199958976 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:45:43.485496 139778199958976 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:45:43.536789 139778199958976 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:45:43.585839 139778199958976 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:45:43.636761 139778199958976 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:45:43.683437 139778199958976 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:45:43.725852 139778199958976 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:45:43.742213 139778199958976 estimator.py:1147] Done calling model_fn.
I0815 01:45:47.230137 139778199958976 tpu_estimator.py:499] TPU job name worker
I0815 01:45:47.344341 139778199958976 monitored_session.py:240] Graph was finalized.
I0815 01:45:48.076122 139778199958976 session_manager.py:500] Running local_init_op.
I0815 01:45:48.140557 139778199958976 session_manager.py:502] Done running local_init_op.
I0815 01:45:50.716053 139778199958976 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:46:03.601223 139778199958976 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:46:03.794732 139778199958976 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:46:03.795223 139778199958976 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:46:03.795649: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:46:03.800812 139778199958976 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:46:03.803014 139778199958976 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:46:03.807071 139778199958976 tpu_estimator.py:557] Init TPU system
I0815 01:46:44.127454 139778199958976 tpu_estimator.py:566] Initialized TPU in 40 seconds
I0815 01:46:44.128307 139777505187584 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:46:44.128825 139777026291456 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:46:44.195458 139778199958976 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:46:44.196355 139778199958976 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
I0815 01:46:44.250593 139777017898752 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:46:44.549240 139777017898752 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:46:48.974013 139777026291456 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:46:53.645111 139778199958976 basic_session_run_hooks.py:262] loss = 0.07003707, step = 30
I0815 01:46:53.647675 139778199958976 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:47:07.822123 139778199958976 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:47:07.822423 139778199958976 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:47:07.823824 139777505187584 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:47:07.824006 139777505187584 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:47:07.824162 139778199958976 error_handling.py:96] infeed marked as finished
I0815 01:47:07.824274 139778199958976 tpu_estimator.py:602] Stop output thread controller
I0815 01:47:07.824336 139778199958976 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:47:07.824548 139777026291456 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:47:07.824656 139777026291456 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:47:07.824798 139778199958976 error_handling.py:96] outfeed marked as finished
I0815 01:47:07.824897 139778199958976 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:47:14.697010 139778199958976 estimator.py:368] Loss for final step: 0.07003707.
I0815 01:47:14.697876 139778199958976 error_handling.py:96] training_loop marked as finished
I0815 01:47:15.444632 139778199958976 estimator.py:1145] Calling model_fn.
E0815 01:47:16.160986 139778199958976 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:47:16.391880 139778199958976 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:47:16.413008 139778199958976 estimator.py:1147] Done calling model_fn.
I0815 01:47:16.429683 139778199958976 evaluation.py:255] Starting evaluation at 2019-08-15T01:47:16Z
I0815 01:47:16.429927 139778199958976 tpu_estimator.py:499] TPU job name worker
I0815 01:47:16.507878 139778199958976 monitored_session.py:240] Graph was finalized.
W0815 01:47:16.508611 139778199958976 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:47:16.721857 139778199958976 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:47:19.498060 139778199958976 session_manager.py:500] Running local_init_op.
I0815 01:47:19.526345 139778199958976 session_manager.py:502] Done running local_init_op.
I0815 01:47:19.580785 139778199958976 tpu_estimator.py:557] Init TPU system
I0815 01:48:28.077230 139778199958976 tpu_estimator.py:566] Initialized TPU in 68 seconds
I0815 01:48:28.078318 139777026291456 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:48:28.079128 139777017898752 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:48:28.147032 139778199958976 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:48:28.176448 139778199958976 tpu_estimator.py:590] Enqueue next (10) batch(es) of data to infeed.
I0815 01:48:28.176877 139778199958976 tpu_estimator.py:594] Dequeue next (10) batch(es) of data from outfeed.
I0815 01:48:28.271799 139777009506048 transport.py:157] Attempting refresh to obtain initial access_token
W0815 01:48:28.572644 139777009506048 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:48:28.990084 139777017898752 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:48:29.456537 139778199958976 evaluation.py:167] Evaluation [10/10]
I0815 01:48:29.456892 139778199958976 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:48:29.456971 139778199958976 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:48:29.457279 139777026291456 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:48:29.457592 139777026291456 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:48:29.457866 139778199958976 error_handling.py:96] infeed marked as finished
I0815 01:48:29.458054 139778199958976 tpu_estimator.py:602] Stop output thread controller
I0815 01:48:29.458107 139778199958976 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:48:29.458271 139777017898752 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:48:29.458452 139777017898752 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:48:29.458605 139778199958976 error_handling.py:96] outfeed marked as finished
I0815 01:48:29.458745 139778199958976 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:48:58.671719 139778199958976 evaluation.py:275] Finished evaluation at 2019-08-15-01:48:58
I0815 01:48:58.672197 139778199958976 estimator.py:2039] Saving dict for global step 30: accuracy = 0.9801, global_step = 30, loss = 0.06697492
I0815 01:49:03.113917 139778199958976 estimator.py:2099] Saving 'checkpoint_path' summary for global step 30: gs://yangyou-mnist/log/model.ckpt-30
I0815 01:49:03.994172 139778199958976 error_handling.py:96] evaluation_loop marked as finished

Evaluation results:
	{'loss': 0.06697492, 'global_step': 30, 'accuracy': 0.9801}

Removing gs://yangyou-mnist/log/#1565833545307393...
Removing gs://yangyou-mnist/log/checkpoint#1565833624137775...
Removing gs://yangyou-mnist/log/model.ckpt-0.index#1565833558360162...
Removing gs://yangyou-mnist/log/model.ckpt-0.meta#1565833563089417...
Removing gs://yangyou-mnist/log/events.out.tfevents.1565833545.v3-8-tpu#1565833627511518...
Removing gs://yangyou-mnist/log/graph.pbtxt#1565833550134131...
Removing gs://yangyou-mnist/log/model.ckpt-30.data-00000-of-00001#1565833620892735...
Removing gs://yangyou-mnist/log/model.ckpt-0.data-00000-of-00001#1565833557412019...
Removing gs://yangyou-mnist/log/model.ckpt-30.index#1565833621936174...
Removing gs://yangyou-mnist/log/model.ckpt-30.meta#1565833626482634...
Removing gs://yangyou-mnist/log/eval/#1565833740331734...
Removing gs://yangyou-mnist/log/eval/events.out.tfevents.1565833740.v3-8-tpu#1565833743688304...
/ [1/12 objects]   8% Done                                                      / [2/12 objects]  16% Done                                                      / [3/12 objects]  25% Done                                                      / [4/12 objects]  33% Done                                                      / [5/12 objects]  41% Done                                                      / [6/12 objects]  50% Done                                                      / [7/12 objects]  58% Done                                                      / [8/12 objects]  66% Done                                                      / [9/12 objects]  75% Done                                                      / [10/12 objects]  83% Done                                                     / [11/12 objects]  91% Done                                                     / [12/12 objects] 100% Done                                                     
Operation completed over 12 objects.                                             
WARNING: Logging before flag parsing goes to stderr.
W0815 01:49:07.821634 139979491546560 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/hooks.py:28: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

W0815 01:49:07.822477 139979491546560 deprecation_wrapper.py:119] From /usr/share/models/official/utils/logs/metric_hook.py:24: The name tf.train.LoggingTensorHook is deprecated. Please use tf.estimator.LoggingTensorHook instead.

W0815 01:49:07.825196 139979491546560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:62: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

W0815 01:49:07.826056 139979491546560 deprecation_wrapper.py:119] From mnist_tpu.py:401: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

W0815 01:49:07.826683 139979491546560 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.

W0815 01:49:07.826817 139979491546560 deprecation_wrapper.py:119] From mnist_tpu.py:343: The name tf.logging.INFO is deprecated. Please use tf.compat.v1.logging.INFO instead.

W0815 01:49:08.254559 139979491546560 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0815 01:49:08.262537 139979491546560 deprecation_wrapper.py:119] From mnist_tpu.py:362: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

I0815 01:49:08.266463 139979491546560 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:49:08.320430 139979491546560 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:49:08.320694 139979491546560 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:49:08.625332 139979491546560 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1alpha1/rest
I0815 01:49:08.807084 139979491546560 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1alpha1/projects/forrestchina1/locations/europe-west4-a/nodes/v3-8-tpu?alt=json
I0815 01:49:08.807357 139979491546560 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:49:09.082442 139979491546560 estimator.py:209] Using config: {'_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
log_device_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
, '_keep_checkpoint_max': 5, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7f4f5e07f050>, '_model_dir': 'gs://yangyou-mnist/log', '_protocol': None, '_save_checkpoints_steps': None, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=500, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=2, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7f4f6025d210>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I0815 01:49:09.082889 139979491546560 tpu_context.py:209] _TPUContext: eval_on_tpu True
I0815 01:49:09.399380 139979491546560 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-08-15 01:49:09.402473: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:49:09.415729 139979491546560 tpu_system_metadata.py:148] Found TPU system:
I0815 01:49:09.415956 139979491546560 tpu_system_metadata.py:149] *** Num TPU Cores: 8
I0815 01:49:09.416580 139979491546560 tpu_system_metadata.py:150] *** Num TPU Workers: 1
I0815 01:49:09.416644 139979491546560 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
I0815 01:49:09.416699 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 15204817921114204117)
I0815 01:49:09.417033 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 2680777371666110490)
I0815 01:49:09.417089 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 12025882551870802931)
I0815 01:49:09.417150 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 16328273150686492245)
I0815 01:49:09.417197 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 11312502552981462146)
I0815 01:49:09.417246 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 2080909194370277036)
I0815 01:49:09.417293 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 4516989559839486208)
I0815 01:49:09.417339 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 13571779821327919489)
I0815 01:49:09.417386 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 709291024602036289)
I0815 01:49:09.417431 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 15214971673601676433)
I0815 01:49:09.417479 139979491546560 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 13955710024387679972)
W0815 01:49:09.423314 139979491546560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
I0815 01:49:09.435813 139979491546560 estimator.py:1145] Calling model_fn.
W0815 01:49:09.436521 139979491546560 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:65: The name tf.gfile.Exists is deprecated. Please use tf.io.gfile.exists instead.

W0815 01:49:09.712532 139979491546560 deprecation_wrapper.py:119] From /usr/share/models/official/mnist/dataset.py:38: The name tf.gfile.Open is deprecated. Please use tf.io.gfile.GFile instead.

W0815 01:49:10.117172 139979491546560 deprecation.py:323] From /usr/share/models/official/mnist/dataset.py:100: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W0815 01:49:10.179462 139979491546560 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/init_ops.py:1251: calling __init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
E0815 01:49:10.185327 139979491546560 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:49:10.367290 139979491546560 deprecation_wrapper.py:119] From mnist_tpu.py:281: The name tf.losses.sparse_softmax_cross_entropy is deprecated. Please use tf.compat.v1.losses.sparse_softmax_cross_entropy instead.

W0815 01:49:10.381025 139979491546560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/ops/losses/losses_impl.py:121: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0815 01:49:10.392955 139979491546560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:15: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W0815 01:49:10.398478 139979491546560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:20: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W0815 01:49:10.403918 139979491546560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/keras/optimizer_v2/learning_rate_schedule.py:409: div (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Deprecated in favor of operator or tf.math.divide.
W0815 01:49:10.421180 139979491546560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:32: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

I0815 01:49:10.421386 139979491546560 optimization.py:32] ++++++ warmup starts at step 0, for 10 steps ++++++
W0815 01:49:10.421509 139979491546560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:45: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

W0815 01:49:10.531593 139979491546560 deprecation_wrapper.py:119] From /home/chinayouyang1991/mnist_tpu/lamb_triangle/optimization.py:97: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

I0815 01:49:10.574440 139979491546560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:49:10.618400 139979491546560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:49:10.669040 139979491546560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:49:10.832782 139979491546560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:49:10.882714 139979491546560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:49:10.932029 139979491546560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:49:10.982259 139979491546560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:49:11.028594 139979491546560 optimization.py:139] *********** I'm using LAMB correction ***********
I0815 01:49:11.071130 139979491546560 basic_session_run_hooks.py:541] Create CheckpointSaverHook.
I0815 01:49:11.087421 139979491546560 estimator.py:1147] Done calling model_fn.
I0815 01:49:14.619255 139979491546560 tpu_estimator.py:499] TPU job name worker
I0815 01:49:14.726560 139979491546560 monitored_session.py:240] Graph was finalized.
I0815 01:49:15.423300 139979491546560 session_manager.py:500] Running local_init_op.
I0815 01:49:15.483894 139979491546560 session_manager.py:502] Done running local_init_op.
I0815 01:49:18.577482 139979491546560 basic_session_run_hooks.py:606] Saving checkpoints for 0 into gs://yangyou-mnist/log/model.ckpt.
W0815 01:49:30.921878 139979491546560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py:741: load (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Prefer Variable.assign which has equivalent behavior in 2.X.
I0815 01:49:31.099864 139979491546560 util.py:98] Initialized dataset iterators in 0 seconds
I0815 01:49:31.100280 139979491546560 session_support.py:332] Installing graceful shutdown hook.
2019-08-15 01:49:31.100712: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:356] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
I0815 01:49:31.105941 139979491546560 session_support.py:82] Creating heartbeat manager for ['/job:worker/replica:0/task:0/device:CPU:0']
I0815 01:49:31.108242 139979491546560 session_support.py:105] Configuring worker heartbeat: shutdown_mode: WAIT_FOR_COORDINATOR

I0815 01:49:31.112309 139979491546560 tpu_estimator.py:557] Init TPU system
I0815 01:50:12.134522 139979491546560 tpu_estimator.py:566] Initialized TPU in 41 seconds
I0815 01:50:12.135500 139978595358464 tpu_estimator.py:514] Starting infeed thread controller.
I0815 01:50:12.135986 139978586965760 tpu_estimator.py:533] Starting outfeed thread controller.
I0815 01:50:12.195215 139978578573056 transport.py:157] Attempting refresh to obtain initial access_token
I0815 01:50:12.204896 139979491546560 tpu_estimator.py:590] Enqueue next (30) batch(es) of data to infeed.
I0815 01:50:12.205816 139979491546560 tpu_estimator.py:594] Dequeue next (30) batch(es) of data from outfeed.
W0815 01:50:12.456516 139978578573056 preempted_hook.py:89] TPUPollingThread found TPU v3-8-tpu in state READY, and health HEALTHY.
I0815 01:50:17.085244 139978586965760 tpu_estimator.py:275] Outfeed finished for iteration (0, 0)
I0815 01:50:21.743066 139979491546560 basic_session_run_hooks.py:262] loss = 0.07270785, step = 30
I0815 01:50:21.746668 139979491546560 basic_session_run_hooks.py:606] Saving checkpoints for 30 into gs://yangyou-mnist/log/model.ckpt.
I0815 01:50:35.937467 139979491546560 tpu_estimator.py:598] Stop infeed thread controller
I0815 01:50:35.937743 139979491546560 tpu_estimator.py:430] Shutting down InfeedController thread.
I0815 01:50:35.937975 139978595358464 tpu_estimator.py:425] InfeedController received shutdown signal, stopping.
I0815 01:50:35.938081 139978595358464 tpu_estimator.py:530] Infeed thread finished, shutting down.
I0815 01:50:35.938221 139979491546560 error_handling.py:96] infeed marked as finished
I0815 01:50:35.938316 139979491546560 tpu_estimator.py:602] Stop output thread controller
I0815 01:50:35.938364 139979491546560 tpu_estimator.py:430] Shutting down OutfeedController thread.
I0815 01:50:35.938482 139978586965760 tpu_estimator.py:425] OutfeedController received shutdown signal, stopping.
I0815 01:50:35.938555 139978586965760 tpu_estimator.py:541] Outfeed thread finished, shutting down.
I0815 01:50:35.938678 139979491546560 error_handling.py:96] outfeed marked as finished
I0815 01:50:35.938766 139979491546560 tpu_estimator.py:606] Shutdown TPU system.
I0815 01:50:42.598203 139979491546560 estimator.py:368] Loss for final step: 0.07270785.
I0815 01:50:42.598969 139979491546560 error_handling.py:96] training_loop marked as finished
I0815 01:50:43.200038 139979491546560 estimator.py:1145] Calling model_fn.
E0815 01:50:43.883560 139979491546560 tpu.py:376] Operation of type Placeholder (reshape_input) is not supported on the TPU. Execution will fail if this op is used in the graph. 
W0815 01:50:44.110572 139979491546560 deprecation_wrapper.py:119] From mnist_tpu.py:258: The name tf.metrics.accuracy is deprecated. Please use tf.compat.v1.metrics.accuracy instead.

I0815 01:50:44.131992 139979491546560 estimator.py:1147] Done calling model_fn.
I0815 01:50:44.148010 139979491546560 evaluation.py:255] Starting evaluation at 2019-08-15T01:50:44Z
I0815 01:50:44.148245 139979491546560 tpu_estimator.py:499] TPU job name worker
I0815 01:50:44.226073 139979491546560 monitored_session.py:240] Graph was finalized.
W0815 01:50:44.226778 139979491546560 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow/python/training/saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
I0815 01:50:44.438478 139979491546560 saver.py:1280] Restoring parameters from gs://yangyou-mnist/log/model.ckpt-30
I0815 01:50:47.190489 139979491546560 session_manager.py:500] Running local_init_op.
I0815 01:50:47.221041 139979491546560 session_manager.py:502] Done running local_init_op.
I0815 01:50:47.272684 139979491546560 tpu_estimator.py:557] Init TPU system
